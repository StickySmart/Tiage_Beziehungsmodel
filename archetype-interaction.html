<!--
 * © 2025 Ti-age.de Alle Rechte vorbehalten.
 * Dieses Werk ist urheberrechtlich geschützt.
 * Jegliche Nutzung ohne ausdrückliche Genehmigung ist untersagt.
 -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Archetypen-Beziehungsqualität | Swipe</title>
    <style>
        :root {
            --primary: #457B9D;
            --primary-light: #A8D5E2;
            --bg-dark: #0f0f1a;
            --bg-card: #1a1a2e;
            --bg-hover: #252542;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0b0;
            --text-muted: #9a9aaa;
            --border: rgba(255,255,255,0.1);
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;

            /* Responsive Typography with clamp() */
            --font-xs: clamp(0.75rem, 1.2vw + 0.5rem, 0.9rem);
            --font-sm: clamp(0.85rem, 1.3vw + 0.5rem, 1rem);
            --font-base: clamp(0.95rem, 1.6vw + 0.55rem, 1.15rem);
            --font-md: clamp(1.05rem, 1.9vw + 0.55rem, 1.3rem);
            --font-lg: clamp(1.25rem, 2.6vw + 0.55rem, 1.65rem);
            --font-xl: clamp(1.55rem, 3.1vw + 0.55rem, 2.25rem);
            --font-label: clamp(0.8rem, 1.1vw + 0.45rem, 0.95rem);

            /* Responsive Bar Height */
            --bar-height: clamp(16px, 1.5vw + 12px, 22px);
            --bar-radius: calc(var(--bar-height) / 2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* Theme Colors */
        body.theme-single { --primary: #E63946; --primary-light: #FFB4A2; }
        body.theme-duo { --primary: #E84393; --primary-light: #FDA7DF; }
        body.theme-duo_flex { --primary: #FF6B6B; --primary-light: #FFA5A5; }
        body.theme-solopoly { --primary: #2A9D8F; --primary-light: #A8DADC; }
        body.theme-poly_hedo { --primary: #9B5DE5; --primary-light: #D4A5FF; }
        body.theme-polyamor { --primary: #F4A261; --primary-light: #FFE5B4; }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            text-align: center;
            padding: 12px 15px;
            background: rgba(15,15,26,0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-size: var(--font-base);
            font-weight: 400;
            letter-spacing: 2px;
            color: var(--text-secondary);
        }

        /* Help Button */
        .help-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--danger);
            background: transparent;
            color: var(--danger);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 8px auto 0 auto;
        }

        .help-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Quick Guide Styles */
        .quick-guide {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
            border: 1px solid var(--success);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .quick-guide h3 {
            color: var(--success);
            margin: 0 0 10px 0;
            font-size: var(--font-md);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-guide ul {
            margin: 0;
            padding-left: 20px;
        }

        .quick-guide li {
            margin-bottom: 6px;
            color: var(--text-secondary);
            font-size: var(--font-sm);
        }

        /* Comment Button Section */
        .comment-section {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.05));
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .comment-section p {
            color: var(--text-secondary);
            font-size: var(--font-sm);
            margin: 0 0 12px 0;
        }

        .comment-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: var(--font-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .comment-btn:hover {
            background: #3a7bc8;
            transform: translateY(-1px);
        }

        /* View Comments Button (Yellow) */
        .view-comments-btn {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #1a1a2e;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: var(--font-sm);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .view-comments-btn:hover {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.4);
        }

        /* Comments List Modal */
        .comments-list-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2200;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .comments-list-overlay.active {
            display: flex;
        }

        .comments-list-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            margin: 40px auto;
            border: 1px solid var(--border);
        }

        .comments-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(243, 156, 18, 0.05));
        }

        .comments-list-header h2 {
            color: #f1c40f;
            margin: 0;
            font-size: var(--font-lg);
        }

        .comments-search-container {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .comments-search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .comments-search-input {
            width: 100%;
            padding: 10px 40px 10px 35px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .comments-search-input:focus {
            outline: none;
            border-color: #f1c40f;
            box-shadow: 0 0 0 3px rgba(241, 196, 15, 0.15);
        }

        .comments-search-input::placeholder {
            color: var(--text-muted);
        }

        .comments-search-icon {
            position: absolute;
            left: 12px;
            color: var(--text-muted);
            pointer-events: none;
        }

        .comments-search-clear {
            position: absolute;
            right: 8px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 5px;
            font-size: 16px;
            display: none;
        }

        .comments-search-clear:hover {
            color: var(--text-primary);
        }

        .comments-search-clear.visible {
            display: block;
        }

        .comments-search-hint {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .comments-search-results {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 8px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }

        .search-highlight {
            background: rgba(241, 196, 15, 0.3);
            padding: 0 2px;
            border-radius: 2px;
        }

        .comments-list-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .comments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comment-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .comment-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid var(--border);
        }

        .comment-author {
            font-weight: 600;
            color: var(--primary);
        }

        .comment-date {
            font-size: 11px;
            color: var(--text-muted);
        }

        .comment-type-badge {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .comment-type-badge.type-fehler {
            background: #dc3545;
        }

        .comment-type-badge.type-frage {
            background: #17a2b8;
        }

        .comment-type-badge.type-verbesserung {
            background: #28a745;
        }

        .comment-type-badge.type-doku {
            background: #6c757d;
        }

        .comment-type-badge.type-antwort {
            background: #6f42c1;
        }

        .comment-card-body {
            padding: 15px;
        }

        .comment-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .comment-text {
            color: var(--text-secondary);
            line-height: 1.5;
            font-size: var(--font-sm);
        }

        .comment-context {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .comment-card-footer {
            padding: 10px 15px;
            background: rgba(255,255,255,0.02);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reply-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reply-btn:hover {
            background: var(--primary);
            color: white;
        }

        .replies-section {
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid var(--primary);
            margin-top: 10px;
        }

        .reply-card {
            background: rgba(69, 123, 157, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .reply-author {
            font-weight: 600;
            color: var(--primary);
            font-size: 12px;
        }

        .reply-date {
            font-size: 10px;
            color: var(--text-muted);
        }

        .reply-text {
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.4;
        }

        .reply-form {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            display: none;
        }

        .reply-form.active {
            display: block;
        }

        .reply-form textarea {
            width: 100%;
            min-height: 80px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-primary);
            font-size: 13px;
            resize: vertical;
            margin-bottom: 10px;
        }

        .reply-form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .reply-cancel-btn {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .reply-submit-btn {
            background: var(--primary);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .no-comments {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .no-comments-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* Documentation Section */
        .documentation-section {
            border-top: 2px solid var(--border);
            padding-top: 20px;
            margin-top: 10px;
        }

        .documentation-section > h3 {
            color: var(--text-muted);
            font-size: var(--font-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        /* Comment Modal Styles */
        .comment-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .comment-modal-overlay.active {
            display: flex;
        }

        .comment-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--border);
        }

        .comment-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .comment-modal-header h3 {
            font-size: var(--font-md);
            color: var(--text-primary);
            margin: 0;
        }

        .comment-modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }

        .comment-modal-body {
            padding: 20px;
        }

        .comment-form-group {
            margin-bottom: 15px;
        }

        .comment-form-group label {
            display: block;
            color: var(--text-secondary);
            font-size: var(--font-sm);
            margin-bottom: 6px;
        }

        .comment-form-group input,
        .comment-form-group textarea,
        .comment-form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: var(--font-sm);
            box-sizing: border-box;
        }

        .comment-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .comment-submit-btn {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: var(--font-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .comment-submit-btn:hover {
            background: #3a7bc8;
        }

        .comment-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Help Modal */
        .help-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .help-modal-overlay.active {
            display: flex;
        }

        .help-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            margin: 40px auto;
            max-height: none;
            border: 1px solid var(--border);
        }

        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            border-radius: 16px 16px 0 0;
        }

        .help-modal-header h2 {
            font-size: var(--font-lg);
            color: var(--text-primary);
            margin: 0;
        }

        .help-modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .help-modal-close:hover {
            color: var(--text-primary);
        }

        .help-modal-content {
            padding: 20px;
        }

        .help-section {
            margin-bottom: 25px;
        }

        .help-section h3 {
            font-size: var(--font-md);
            color: var(--primary);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        .help-section p, .help-section li {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .help-section ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .help-section li {
            margin-bottom: 8px;
        }

        .help-formula {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .help-example {
            background: rgba(69,123,157,0.1);
            border-left: 3px solid var(--primary);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .help-example-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Carousel Container */
        .carousel-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding-top: 60px;
            height: 100vh;
        }

        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        /* Cards */
        .card {
            flex: 0 0 100vw;
            width: 100vw;
            scroll-snap-align: start;
            padding: 15px;
            overflow-y: auto;
            height: calc(100vh - 60px);
        }

        .card-inner {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            min-height: 100%;
            overflow: hidden;
        }

        .card-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: var(--font-sm);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
        }

        .card-body {
            padding: 20px;
        }

        /* Navigation Dots */
        .nav-dots {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
            background: rgba(26,26,46,0.9);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid var(--border);
        }

        .nav-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot.active {
            background: var(--primary);
            transform: scale(1.3);
        }

        .nav-dot-label {
            display: none;
        }

        .nav-arrow {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 0;
            line-height: 1;
        }

        .nav-arrow:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .nav-arrow:active {
            transform: scale(0.95);
        }

        .nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .nav-arrow:disabled:hover {
            background: transparent;
            border-color: var(--border);
            color: var(--text-secondary);
        }

        /* Main Select in Card 1 */
        .main-select {
            margin-bottom: 20px;
        }

        .main-select-label {
            font-size: var(--font-base);
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        #archetypeSelect {
            width: 100%;
            appearance: none;
            background: var(--bg-dark);
            border: 2px solid var(--primary);
            color: var(--text-primary);
            padding: 14px 45px 14px 18px;
            font-size: var(--font-md);
            border-radius: 12px;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0a0b0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
        }

        /* My Type Display */
        .my-type-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .my-type-icon {
            width: 55px;
            height: 55px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            background: var(--primary);
        }

        .my-type-name {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--primary);
        }

        .my-type-desc {
            color: var(--text-secondary);
            font-size: var(--font-base);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Collapsible Sections */
        .collapsible {
            border-top: 1px solid var(--border);
        }

        .collapsible-header {
            padding: 14px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: var(--font-base);
        }

        .collapsible-icon {
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .collapsible.open .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible.open .collapsible-content {
            max-height: 600px;
        }

        .pro-contra-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            padding-bottom: 15px;
        }

        .mini-list {
            font-size: var(--font-base);
        }

        .mini-list-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .mini-list-title.pro { color: var(--success); }
        .mini-list-title.contra { color: var(--danger); }

        .mini-list ul {
            list-style: none;
            color: var(--text-muted);
        }

        .mini-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .mini-list li::before {
            content: '•';
            position: absolute;
            left: 0;
        }

        .pathos-logos-content {
            font-size: var(--font-base);
            color: var(--text-muted);
            padding-bottom: 15px;
        }

        .pathos-logos-content p {
            margin-bottom: 10px;
            font-style: italic;
            line-height: 1.5;
        }

        /* Match Cards - HIDDEN FOR NOW (can be re-enabled later) */
        .match-section {
            margin-top: 20px;
            display: none; /* Temporarily hidden - remove this line to show again */
        }

        .match-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .match-card:active {
            transform: translateY(0);
        }

        .match-card.top {
            background: rgba(0,206,201,0.1);
            border: 1px solid rgba(0,206,201,0.3);
        }

        .match-card.challenge {
            background: rgba(231,76,60,0.1);
            border: 1px solid rgba(231,76,60,0.3);
        }

        .match-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .match-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .match-label-text {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .match-name {
            font-size: var(--font-base);
            font-weight: 500;
        }

        .match-score {
            font-size: var(--font-md);
            font-weight: 700;
        }

        .match-score.excellent { color: #00cec9; }
        .match-score.low { color: #e74c3c; }

        /* Card 2: Partner Selector */
        .partner-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .partner-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 20px;
            cursor: pointer;
            font-size: var(--font-base);
            transition: all 0.3s ease;
        }

        .partner-btn:hover {
            border-color: var(--text-muted);
            background: var(--bg-hover);
        }

        .partner-btn.active {
            border-color: var(--primary);
            background: rgba(69,123,157,0.2);
            color: var(--text-primary);
        }

        .partner-btn .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Radar Chart */
        .radar-section {
            margin-bottom: 25px;
        }

        .radar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .radar-title {
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .radar-score {
            font-size: var(--font-xl);
            font-weight: 700;
        }

        .radar-score-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
        }

        #radarChart {
            width: 100%;
            max-width: 280px;
            margin: 0 auto;
            display: block;
        }

        /* Category Bars */
        .category-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .category-label {
            width: clamp(20px, 3vw + 10px, 28px);
            font-weight: 700;
            font-size: var(--font-sm);
            color: var(--primary);
        }

        .category-bar-wrap {
            flex: 1;
        }

        .category-bar-container {
            height: var(--bar-height);
            background: rgba(255,255,255,0.05);
            border-radius: var(--bar-radius);
            overflow: hidden;
        }

        .category-bar {
            height: 100%;
            border-radius: var(--bar-radius);
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .category-bar-value {
            font-size: var(--font-xs);
            font-weight: 600;
            color: white;
        }

        .category-name {
            font-size: var(--font-sm);
            color: var(--text-muted);
            margin-top: 2px;
        }

        .bar-excellent { background: linear-gradient(90deg, #00cec9, #0984e3); }
        .bar-good { background: linear-gradient(90deg, #27ae60, #1e8449); }
        .bar-medium { background: linear-gradient(90deg, #f39c12, #d68910); }
        .bar-low { background: linear-gradient(90deg, #e74c3c, #c0392b); }

        /* Pro/Contra Analysis */
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .analysis-section {
            padding: 14px;
            border-radius: 10px;
        }

        .analysis-section.pro {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .analysis-section.contra {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .analysis-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .analysis-section.pro .analysis-title { color: var(--success); }
        .analysis-section.contra .analysis-title { color: var(--danger); }

        .analysis-list {
            list-style: none;
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .analysis-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .analysis-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 9px;
            width: 5px;
            height: 5px;
            border-radius: 50%;
        }

        .analysis-section.pro .analysis-list li::before { background: var(--success); }
        .analysis-section.contra .analysis-list li::before { background: var(--danger); }

        /* Card 3: Alle Typen - Mini Cards Grid */
        .mini-cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .mini-card {
            background: var(--bg-dark);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .mini-card:hover {
            border-color: var(--text-muted);
        }

        .mini-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .mini-card-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .mini-card-name {
            font-size: var(--font-base);
            font-weight: 600;
        }

        .mini-card-desc {
            font-size: var(--font-sm);
            color: var(--text-muted);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .mini-card-self-score {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .mini-card-self-score span {
            font-weight: 700;
            color: var(--primary);
        }

        /* Swipe Hint */
        .swipe-hint {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--text-muted);
            opacity: 0.7;
            animation: fadeOut 3s forwards;
            animation-delay: 2s;
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        /* Info Icon */
        .section-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .info-icon:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Clickable Category Row */
        .category-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 4px;
            margin: -4px;
            margin-bottom: 6px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .category-row:hover {
            background: rgba(255,255,255,0.05);
        }

        .category-row:active {
            background: rgba(255,255,255,0.1);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .modal-title {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        /* Archetype Navigation Buttons */
        .archetype-nav-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .archetype-nav-btn:hover {
            background: var(--primary);
            color: white;
        }

        .archetype-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .archetype-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .archetype-dot.active {
            background: var(--primary);
            transform: scale(1.3);
        }

        .archetype-dot:hover {
            background: var(--primary-light);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-subtitle {
            color: var(--text-muted);
            font-size: var(--font-sm);
            font-style: italic;
            margin-bottom: 16px;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 24px 0;
            color: var(--primary);
        }

        .explanation {
            margin-top: 20px;
        }

        .explanation h4 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-size: var(--font-base);
        }

        .explanation p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .explanation ul {
            margin: 12px 0;
            padding-left: 20px;
        }

        .explanation li {
            margin: 8px 0;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .modal-feedback-btn {
            margin-top: 20px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .modal-feedback-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary);
            border-color: var(--primary);
        }

        .category-nav-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 8px;
            background: var(--bg-dark);
            border-radius: 10px;
        }

        .category-nav-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: var(--font-sm);
        }

        .category-nav-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .category-nav-indicator {
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        /* Definition Modal */
        .definition-modal {
            max-width: 500px;
        }

        .definition-section {
            margin-bottom: 20px;
        }

        .definition-section-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }

        .definition-long {
            font-size: var(--font-base);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .definition-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .definition-list li {
            padding: 8px 0 8px 20px;
            position: relative;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .definition-list.principles li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--success);
        }

        .definition-list.not-same li::before {
            content: '✗';
            position: absolute;
            left: 0;
            color: var(--danger);
        }

        .definition-list.variants li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .type-info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s;
        }

        .type-info-icon:hover {
            background: var(--primary);
            color: white;
        }

        .type-tooltip {
            position: relative;
            display: inline-block;
        }

        .type-tooltip .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: var(--bg-dark);
            color: var(--text-secondary);
            text-align: left;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: var(--font-sm);
            line-height: 1.4;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .type-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .modal-category {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-category:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .modal-category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .modal-category-letter {
            width: clamp(24px, 3vw + 14px, 32px);
            height: clamp(24px, 3vw + 14px, 32px);
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-sm);
        }

        .modal-category-name {
            font-weight: 600;
            font-size: var(--font-base);
            color: var(--text-primary);
        }

        .modal-category-desc {
            font-size: var(--font-base);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .modal-subdimensions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .modal-subdim-tag {
            font-size: var(--font-sm);
            padding: 6px 10px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .modal-subdim-tag:hover {
            background: rgba(255,255,255,0.15);
        }

        .modal-subdim-tag.active {
            background: var(--primary);
            color: white;
        }

        /* Tag Tooltip Container */
        .tag-tooltip-container {
            position: relative;
            display: inline-block;
        }

        /* Tag Tooltip - Click to open, stays open */
        .tag-tooltip {
            display: none;
            position: fixed;
            z-index: 1001;
            width: min(360px, 92vw);
            max-width: 92vw;
            max-height: 85vh;
            overflow-y: auto;
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        .tag-tooltip.active {
            display: block;
        }

        .tag-tooltip-close {
            position: absolute;
            top: 6px;
            right: 8px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 22px;
            cursor: pointer;
            padding: 4px 8px;
            line-height: 1;
            z-index: 10;
        }

        .tag-tooltip-close:hover {
            color: var(--text-primary);
        }

        /* Tooltip Header */
        .tag-tooltip-header {
            padding: 10px 12px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid var(--border);
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }

        /* Tooltip Body */
        .tag-tooltip-body {
            padding: 12px;
        }

        /* Type Perspective */
        .tag-tooltip-perspective {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .tag-tooltip-perspective:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .tag-tooltip-type-name {
            font-weight: 600;
            font-size: var(--font-xs);
            margin-bottom: 4px;
            display: block;
        }

        .tag-tooltip-type-text {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Dynamic Summary */
        .tag-tooltip-dynamic {
            background: rgba(69, 123, 157, 0.15);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: var(--font-xs);
            line-height: 1.4;
        }

        .tag-tooltip-dynamic::before {
            content: '→ ';
            color: var(--primary);
            font-weight: 600;
        }

        /* Type Switcher in Tooltip */
        .tag-tooltip-type-switcher {
            display: flex;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            flex-wrap: wrap;
            -webkit-overflow-scrolling: touch;
        }

        .type-switch-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 16px;
            cursor: pointer;
            font-size: var(--font-xs);
            transition: all 0.2s ease;
            pointer-events: auto;
        }

        .type-switch-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--text-secondary);
        }

        .type-switch-btn.active {
            border-color: currentColor;
            background: rgba(255,255,255,0.08);
        }

        .type-switch-btn .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .type-switch-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-right: auto;
            display: flex;
            align-items: center;
        }

        /* Responsive: Position tooltip above or below based on space */
        @media (max-width: 480px) {
            .tag-tooltip {
                width: 280px;
                left: 0;
                transform: translateX(-20%);
            }
        }

        /* Match Modal Content */
        .match-modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .match-modal-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .match-modal-info h3 {
            font-size: var(--font-lg);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .match-modal-info p {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .match-modal-score {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .match-modal-score-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .match-modal-score-value {
            font-size: var(--font-xl);
            font-weight: 700;
        }

        .match-modal-categories {
            margin-bottom: 20px;
        }

        .match-modal-categories-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .match-modal-bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .match-modal-bar-row.clickable {
            cursor: pointer;
            padding: 6px;
            margin: -6px;
            margin-bottom: 2px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .match-modal-bar-row.clickable:hover {
            background: rgba(255,255,255,0.08);
        }

        .match-modal-bar-row.clickable:active {
            background: rgba(255,255,255,0.12);
        }

        .match-modal-bar-label {
            width: 24px;
            font-weight: 700;
            font-size: var(--font-sm);
            color: var(--primary);
        }

        .match-modal-bar-container {
            flex: 1;
            height: var(--bar-height);
            background: rgba(255,255,255,0.05);
            border-radius: var(--bar-radius);
            overflow: hidden;
        }

        .match-modal-bar {
            height: 100%;
            border-radius: var(--bar-radius);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .match-modal-bar-value {
            font-size: var(--font-xs);
            font-weight: 600;
            color: white;
        }

        .match-modal-bar-name {
            width: 120px;
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-align: right;
        }

        .match-modal-section {
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .match-modal-section.pro {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .match-modal-section.contra {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .match-modal-section-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .match-modal-section.pro .match-modal-section-title { color: var(--success); }
        .match-modal-section.contra .match-modal-section-title { color: var(--danger); }

        .match-modal-list {
            list-style: none;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .match-modal-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .match-modal-list li::before {
            content: '•';
            position: absolute;
            left: 0;
        }

        /* Legend Page */
        .legend-section {
            margin-bottom: 25px;
        }

        .legend-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .color-scale {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .color-scale-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .color-scale-bar {
            width: clamp(50px, 8vw + 20px, 80px);
            height: var(--bar-height);
            border-radius: var(--bar-radius);
        }

        .color-scale-label {
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .color-scale-range {
            font-size: var(--font-sm);
            color: var(--text-muted);
            margin-left: auto;
        }

        .legend-category-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .legend-category-item:hover {
            background: var(--bg-hover);
        }

        .legend-category-letter {
            width: clamp(28px, 4vw + 16px, 36px);
            height: clamp(28px, 4vw + 16px, 36px);
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-base);
            flex-shrink: 0;
        }

        .legend-category-content {
            flex: 1;
        }

        .legend-category-name {
            font-weight: 600;
            font-size: var(--font-md);
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .legend-category-desc {
            font-size: var(--font-base);
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Responsive - Mobile (larger fonts for readability) */
        @media (max-width: 599px) {
            :root {
                --font-xs: 0.85rem;
                --font-sm: 0.95rem;
                --font-base: 1.05rem;
                --font-md: 1.15rem;
                --font-lg: 1.4rem;
                --font-xl: 1.8rem;
                --bar-height: 20px;
            }

            .modal {
                max-width: 95vw;
                max-height: 90vh;
            }

            .match-modal-bar-name {
                width: auto;
                min-width: 80px;
            }
        }

        /* Responsive - Tablet+ */
        @media (min-width: 600px) {
            .mini-cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .analysis-grid {
                grid-template-columns: 1fr 1fr;
            }

            .pro-contra-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .mini-list {
                font-size: var(--font-sm);
            }

            .mini-list-title {
                font-size: var(--font-sm);
            }
        }

        @media (min-width: 900px) {
            .card {
                padding: 20px 10%;
            }

            .mini-cards-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        /* Feedback Modal */
        .feedback-modal {
            max-width: 420px;
        }

        .feedback-context-id {
            display: inline-block;
            padding: 4px 10px;
            background: var(--bg-dark);
            border-radius: 6px;
            font-size: var(--font-xs);
            color: var(--primary);
            font-family: monospace;
            margin-bottom: 16px;
        }

        .feedback-form-group {
            margin-bottom: 16px;
        }

        .feedback-label {
            display: block;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .feedback-label .required {
            color: var(--danger);
        }

        .feedback-input,
        .feedback-textarea {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 14px;
            color: var(--text-primary);
            font-size: var(--font-base);
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .feedback-input:focus,
        .feedback-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .feedback-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Star Rating */
        .star-rating-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .star-rating-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            min-width: 80px;
        }

        .star-rating {
            display: flex;
            gap: 4px;
        }

        .star-rating .star {
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .star-rating .star:hover,
        .star-rating .star.active {
            color: #f1c40f;
            transform: scale(1.1);
        }

        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .feedback-btn-cancel,
        .feedback-btn-submit {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-btn-cancel {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .feedback-btn-cancel:hover {
            background: var(--bg-hover);
        }

        .feedback-btn-submit {
            background: var(--primary);
            border: none;
            color: white;
        }

        .feedback-btn-submit:hover {
            filter: brightness(1.1);
        }

        .feedback-btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Feedback Page (Card 4) */
        .feedback-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .feedback-filter-btn {
            padding: 8px 14px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 20px;
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-filter-btn:hover {
            background: var(--bg-hover);
        }

        .feedback-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .feedback-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .feedback-item {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid var(--border);
        }

        .feedback-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .feedback-item-context {
            font-size: var(--font-xs);
            color: var(--primary);
            font-family: monospace;
            background: rgba(255,255,255,0.05);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .feedback-item-name {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .feedback-item-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .feedback-item-comment {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .feedback-item-ratings {
            display: flex;
            gap: 20px;
            font-size: var(--font-sm);
        }

        .feedback-rating {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
        }

        .feedback-rating .stars {
            color: #f1c40f;
        }

        .feedback-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .feedback-loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        /* Advanced Feedback Filters */
        .feedback-search {
            margin-bottom: 15px;
        }

        .feedback-search-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }

        .feedback-search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .feedback-advanced-filters {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .feedback-filter-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .feedback-filter-row:last-child {
            margin-bottom: 0;
        }

        .feedback-filter-row label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            min-width: 90px;
        }

        .feedback-select {
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: var(--font-sm);
            cursor: pointer;
        }

        .filter-separator {
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        .feedback-category-btns {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cat-filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 16px;
            font-size: var(--font-xs);
            cursor: pointer;
            transition: all 0.2s;
        }

        .cat-filter-btn:hover {
            background: var(--bg-hover);
        }

        .cat-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Reply/Thread Styles */
        .feedback-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .feedback-reply-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-muted);
            font-size: var(--font-xs);
            cursor: pointer;
            transition: all 0.2s;
        }

        .feedback-reply-btn:hover {
            background: var(--bg-hover);
            color: var(--primary);
            border-color: var(--primary);
        }

        .feedback-replies {
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid var(--border);
            margin-top: 12px;
        }

        .feedback-item.reply {
            background: rgba(255,255,255,0.02);
            padding: 12px;
        }

        .feedback-item.reply .feedback-item-context {
            font-size: 10px;
        }

        .reply-indicator {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .feedback-timestamp {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Age Verification Modal */
        .age-verification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .age-verification-overlay.hidden {
            display: none;
        }

        .age-verification-modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10001;
        }

        .age-verification-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .age-verification-modal h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: var(--font-lg);
        }

        .age-verification-modal p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: var(--font-sm);
        }

        .age-verification-question {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .age-verification-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .age-btn {
            padding: 14px 20px;
            border-radius: 10px;
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer !important;
            border: none;
            transition: all 0.2s ease;
            position: relative;
            z-index: 10002 !important;
            pointer-events: auto !important;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
            /* Ensure button is always clickable */
            display: block;
            width: 100%;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .age-btn-yes {
            background: var(--success);
            color: white;
        }

        .age-btn-yes:hover {
            background: #27ae60;
            transform: scale(1.02);
        }

        .age-btn-no {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .age-btn-no:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Ad container around buttons */
        .age-verification-ad-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            margin: 10px 0;
        }
        .age-verification-ad-left,
        .age-verification-ad-right {
            flex: 0 0 120px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .age-verification-buttons-center {
            flex: 0 0 auto;
            min-width: 200px;
        }
        @media (max-width: 768px) {
            .age-verification-ad-container {
                flex-direction: column;
            }
            .age-verification-ad-left,
            .age-verification-ad-right {
                flex: 0 0 auto;
                width: 100%;
                min-height: 100px;
            }
            /* Mobile: Larger fonts for age verification */
            .age-verification-modal h2 {
                font-size: 22px;
            }
            .age-verification-modal p {
                font-size: 16px;
            }
            .age-verification-question {
                font-size: 17px;
                padding: 18px;
            }
            .age-btn {
                font-size: 17px;
                padding: 16px 24px;
            }
            .age-verification-note {
                font-size: 13px !important;
            }
        }

        .age-verification-note {
            font-size: var(--font-xs) !important;
            color: var(--text-muted) !important;
            margin-top: 15px !important;
            margin-bottom: 0 !important;
        }

        /* Hide Vercel Toolbar */
        #vercel-live-feedback-button,
        [data-vercel-toolbar],
        iframe[src*="vercel.live"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* ========================================
           Extended Dimensions UI
           ======================================== */

        .dimensions-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .dimensions-section-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: rgba(69, 123, 157, 0.15);
            border-left: 3px solid var(--primary);
            border-radius: 0 8px 8px 0;
        }

        .dimensions-section-title.ich-title {
            color: var(--success);
            background: rgba(46, 204, 113, 0.15);
            border-left-color: var(--success);
        }

        .dimensions-section-title.partner-title {
            color: var(--accent);
            background: rgba(231, 76, 60, 0.15);
            border-left-color: var(--accent);
        }

        .dimension-group {
            margin-bottom: 18px;
        }

        .dimension-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .dimension-info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            color: var(--text-muted);
            font-size: 10px;
            cursor: help;
            transition: all 0.2s ease;
        }

        .dimension-info-icon:hover {
            background: var(--primary);
            color: white;
        }

        .dimension-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .dimension-radio {
            display: none;
        }

        .dimension-option {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: transparent;
            color: var(--text-secondary);
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dimension-option:hover {
            border-color: var(--text-muted);
            background: var(--bg-hover);
        }

        .dimension-radio:checked + .dimension-option {
            border-color: var(--primary);
            background: rgba(69,123,157,0.2);
            color: var(--text-primary);
        }

        .dimension-option.highlight-change {
            animation: highlightPulse 0.3s ease;
        }

        @keyframes highlightPulse {
            0% { border-color: var(--primary); box-shadow: 0 0 0 0 rgba(69,123,157,0.4); }
            50% { border-color: var(--success); box-shadow: 0 0 0 4px rgba(46,204,113,0.3); }
            100% { border-color: var(--primary); box-shadow: 0 0 0 0 rgba(69,123,157,0); }
        }

        /* Blinking animation for unselected dimension groups */
        .dimension-group.needs-selection .dimension-option,
        .dimension-status-group.needs-selection .dimension-option {
            animation: needsAttention 1.5s ease-in-out infinite;
        }

        .dimension-group.needs-selection .dimension-label,
        .dimension-status-group.needs-selection .dimension-status-label {
            color: var(--warning);
        }

        @keyframes needsAttention {
            0%, 100% {
                border-color: var(--border);
                box-shadow: 0 0 0 0 rgba(243, 156, 18, 0);
            }
            50% {
                border-color: var(--warning);
                box-shadow: 0 0 8px 2px rgba(243, 156, 18, 0.3);
            }
        }

        /* Status sub-options (indented) */
        .dimension-status-group {
            margin-left: 20px;
            margin-top: 10px;
            padding-left: 10px;
            border-left: 2px solid var(--border);
        }

        .dimension-status-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        /* Compact Overview Box */
        .analysis-overview {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .analysis-overview:hover {
            border-color: var(--primary);
            background: var(--bg-hover);
        }

        .analysis-overview-title {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .analysis-overview-content {
            font-size: var(--font-sm);
            color: var(--text-primary);
            line-height: 1.4;
        }

        .analysis-overview-content .type-name {
            color: var(--primary);
            font-weight: 500;
        }

        .analysis-overview-content .dim-info {
            color: var(--text-secondary);
            font-size: var(--font-xs);
        }

        .analysis-overview-edit {
            font-size: var(--font-xs);
            color: var(--primary);
            margin-top: 6px;
            display: inline-block;
        }

        /* Dimension Tooltip */
        .dimension-tooltip-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .dimension-tooltip-overlay.active {
            display: flex;
        }

        .dimension-tooltip-content {
            background: var(--bg-card);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            max-width: 320px;
            width: 100%;
        }

        .dimension-tooltip-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .dimension-tooltip-text {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .dimension-tooltip-close {
            display: block;
            margin-top: 15px;
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: var(--font-sm);
            cursor: pointer;
            width: 100%;
        }

        /* Status Popup Styles */
        .status-popup-content {
            max-width: 380px;
        }

        .status-popup-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .status-popup-btn {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 15px;
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s ease;
        }

        .status-popup-btn:hover {
            border-color: var(--primary);
            background: rgba(var(--primary-rgb), 0.1);
        }

        .status-popup-btn.interessiert:hover {
            border-color: var(--warning);
            background: rgba(255, 193, 7, 0.1);
        }

        .status-popup-btn-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
        }

        .status-popup-btn-desc {
            font-size: var(--font-xs);
            color: var(--text-muted);
            line-height: 1.4;
        }

        /* Responsive: Two columns on larger screens */
        @media (min-width: 500px) {
            .dimensions-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .dimension-group.full-width {
                grid-column: 1 / -1;
            }
        }

        /* ========================================
           Pathos/Logos Check System
           ======================================== */

        /* Pathos Blocker (K.O. - No Compatibility) */
        .pathos-blocker {
            background: rgba(231, 76, 60, 0.1);
            border: 2px solid var(--danger);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .pathos-blocker.active {
            display: block;
        }

        .pathos-blocker-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .pathos-blocker-icon {
            font-size: 1.8rem;
        }

        .pathos-blocker-title {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--danger);
        }

        .pathos-blocker-reason {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .pathos-blocker-persons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
        }

        .pathos-blocker-person {
            font-size: var(--font-sm);
            color: var(--text-primary);
        }

        .pathos-blocker-person-label {
            color: var(--text-muted);
            margin-right: 8px;
        }

        .pathos-blocker-divider {
            height: 1px;
            background: var(--border);
            margin: 15px 0;
        }

        .pathos-blocker-explanation {
            margin-bottom: 15px;
        }

        .pathos-blocker-explanation h4 {
            font-size: var(--font-sm);
            color: var(--text-primary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pathos-blocker-explanation p {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .pathos-blocker-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .pathos-blocker-btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .pathos-blocker-btn-primary {
            background: var(--primary);
            color: white;
        }

        .pathos-blocker-btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .pathos-blocker-btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .pathos-blocker-btn-secondary:hover {
            background: var(--bg-hover);
        }

        /* Logos Warning (Warning, but analysis continues) */
        .logos-warning {
            background: rgba(243, 156, 18, 0.1);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .logos-warning.active {
            display: block;
        }

        .logos-warning-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
        }

        .logos-warning-icon {
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        .logos-warning-content {
            flex: 1;
        }

        .logos-warning-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 4px;
        }

        .logos-warning-subtitle {
            font-size: var(--font-xs);
            color: var(--text-secondary);
        }

        .logos-warning-toggle {
            font-size: var(--font-xs);
            color: var(--text-muted);
            transition: transform 0.2s ease;
        }

        .logos-warning.expanded .logos-warning-toggle {
            transform: rotate(180deg);
        }

        .logos-warning-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .logos-warning.expanded .logos-warning-details {
            max-height: 400px;
        }

        .logos-warning-details-inner {
            padding-top: 15px;
            border-top: 1px solid rgba(243, 156, 18, 0.3);
            margin-top: 15px;
        }

        .logos-warning-score {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .logos-warning-score-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
        }

        .logos-warning-score-value {
            font-size: var(--font-md);
            font-weight: 700;
            color: var(--warning);
        }

        .logos-warning-text {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .logos-warning-positive {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 10px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .logos-warning-positive-icon {
            color: var(--success);
        }

        .logos-warning-positive-text {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .logos-warning-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .logos-warning-list li {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            padding: 4px 0 4px 20px;
            position: relative;
        }

        .logos-warning-list li::before {
            content: '•';
            position: absolute;
            left: 6px;
            color: var(--warning);
        }

        .logos-warning-quote {
            font-style: italic;
            font-size: var(--font-sm);
            color: var(--text-muted);
            padding: 10px;
            border-left: 2px solid var(--warning);
            margin-top: 12px;
        }

        /* Double Warning (Pathos uncertain + Logos low) */
        .double-warning {
            background: rgba(231, 76, 60, 0.08);
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .double-warning.active {
            display: block;
        }

        .double-warning-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .double-warning-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--danger);
        }

        .double-warning-item {
            padding: 10px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .double-warning-item-title {
            font-size: var(--font-xs);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .double-warning-item-text {
            font-size: var(--font-xs);
            color: var(--text-secondary);
        }

        /* Pathos uncertain warning (less severe than blocker) */
        .pathos-uncertain {
            background: rgba(243, 156, 18, 0.08);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 15px;
            display: none;
        }

        .pathos-uncertain.active {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .pathos-uncertain-icon {
            font-size: 1rem;
            flex-shrink: 0;
        }

        .pathos-uncertain-text {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Dimension Modifier Display */
        .modifier-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: var(--font-xs);
            font-weight: 500;
        }

        .modifier-badge.positive {
            background: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }

        .modifier-badge.negative {
            background: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }

        .modifier-badge.neutral {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
        }

        .modifier-summary {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            display: none;
        }

        .modifier-summary.active {
            display: block;
        }

        .modifier-summary-title {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .modifier-summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .modifier-summary-item .modifier-icon {
            width: 20px;
            text-align: center;
        }

        .category-modifier {
            font-size: var(--font-xs);
            margin-left: 6px;
        }

        .category-modifier.positive {
            color: var(--success);
        }

        .category-modifier.negative {
            color: var(--danger);
        }

        /* ========================================
           NEW: Side-by-Side Comparison Layout
           ======================================== */

        .comparison-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 15px;
            padding-top: 70px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .comparison-column {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 15px;
        }

        .comparison-column.ich-column {
            border-top: 3px solid var(--success);
        }

        .comparison-column.partner-column {
            border-top: 3px solid var(--accent);
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .column-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .ich-column .column-icon {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }

        .partner-column .column-icon {
            background: rgba(231, 76, 60, 0.2);
            color: var(--accent);
        }

        .column-title {
            font-size: var(--font-lg);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .ich-column .column-title {
            color: #2ecc71;
        }

        .partner-column .column-title {
            color: #e74c3c;
        }

        .select-with-info {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }

        .select-with-info .column-select {
            margin-bottom: 0;
        }

        .archetype-info-btn {
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .archetype-info-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .column-select {
            width: auto;
            min-width: 100px;
            max-width: 140px;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: var(--font-sm);
            margin-bottom: 12px;
            cursor: pointer;
        }

        .column-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .column-dimensions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .compact-dimension {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .compact-dimension-label {
            font-size: 11px;
            color: var(--warning);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .compact-options {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .compact-option {
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .compact-option:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .compact-radio:checked + .compact-option {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .compact-radio {
            display: none;
        }

        /* Compact dimension blinking for unselected */
        .compact-dimension.needs-selection .compact-option {
            animation: needsAttention 1.5s ease-in-out infinite;
        }

        .compact-dimension.needs-selection .compact-dimension-label {
            color: var(--warning);
        }

        /* Dominanz Multi-Select */
        .dominanz-multi-select {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dominanz-option-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: var(--bg-dark);
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        .dominanz-option-row:has(.dominanz-checkbox:checked) {
            background: rgba(139, 92, 246, 0.15);
            border-color: var(--primary);
        }

        .dominanz-checkbox {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .dominanz-label {
            flex: 1;
            font-size: var(--font-sm);
            color: var(--text-primary);
            cursor: pointer;
        }

        .dominanz-status-select {
            padding: 4px 8px;
            font-size: 11px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .dominanz-status-select option {
            background: var(--bg-card);
        }

        /* Toggle Buttons for Status (Fakt/Interessiert) */
        .status-toggle-group {
            display: none;
            gap: 4px;
            margin-left: auto;
        }

        .status-toggle-btn {
            padding: 4px 10px;
            font-size: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-dark);
            color: var(--text-muted);
        }

        .status-toggle-btn:hover {
            border-color: var(--primary);
        }

        .status-toggle-btn.active-fakt {
            background: rgba(139, 92, 246, 0.3);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .status-toggle-btn.active-interessiert {
            background: rgba(234, 179, 8, 0.25);
            border-color: #eab308;
            color: #eab308;
            animation: yellowPulse 1.5s ease-in-out infinite;
        }

        @keyframes yellowPulse {
            0%, 100% {
                box-shadow: 0 0 5px rgba(234, 179, 8, 0.4);
                opacity: 1;
            }
            50% {
                box-shadow: 0 0 15px rgba(234, 179, 8, 0.7);
                opacity: 0.85;
            }
        }

        /* Result Bar */
        .result-bar {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 15px 20px;
            margin-bottom: 15px;
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .result-title {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .result-title .type-name {
            color: var(--text-primary);
            font-weight: 600;
        }

        .result-percentage {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .result-percentage.excellent { color: var(--success); }
        .result-percentage.good { color: var(--primary); }
        .result-percentage.moderate { color: var(--warning); }
        .result-percentage.low { color: var(--danger); }

        .result-progress {
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
        }

        .result-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease, background 0.3s ease;
        }

        /* Expandable Sections */
        .expandable-sections {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .expand-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .expand-btn:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .expand-btn.active {
            border-color: var(--primary);
            background: rgba(69, 123, 157, 0.1);
        }

        .expand-icon {
            transition: transform 0.3s ease;
        }

        .expand-btn.active .expand-icon {
            transform: rotate(180deg);
        }

        .expand-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .expand-content.active {
            max-height: 2000px;
        }

        .expand-content-inner {
            padding: 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 12px 12px;
            margin-top: -12px;
        }

        /* Warnings in new layout */
        .warning-box {
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: var(--font-sm);
        }

        .warning-box.pathos-warning {
            background: rgba(231, 76, 60, 0.15);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .warning-box.logos-warning {
            background: rgba(243, 156, 18, 0.15);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .warning-box.incomplete-warning {
            background: rgba(69, 123, 157, 0.15);
            border: 1px solid var(--primary);
            color: var(--text-secondary);
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .comparison-grid {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .comparison-column {
                padding: 10px;
            }

            .column-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .column-icon {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }

            .column-title {
                font-size: 12px;
            }

            .column-select {
                padding: 8px 10px;
                font-size: 13px;
            }

            .compact-option {
                padding: 10px 14px;
                font-size: 15px;
            }

            .compact-dimension-label {
                font-size: 14px;
                margin-bottom: 6px;
            }

            .result-bar {
                padding: 12px 15px;
            }

            .result-percentage {
                font-size: 1.2rem;
            }
        }

        /* ========================================
           MULTI-PAGE MOBILE LAYOUT
           ======================================== */

        /* Mobile: Hide desktop, show multi-page */
        @media (max-width: 768px) {
            /* Hide desktop comparison layout on mobile */
            .comparison-container.desktop-mode {
                display: none !important;
            }

            /* Show mobile multi-page container */
            .mobile-multipage {
                display: block !important;
            }

            /* Page Container */
            .mobile-multipage {
                min-height: 100vh;
                padding-top: 60px;
                position: relative;
            }

            /* Individual Pages */
            .mobile-page {
                display: none;
                min-height: calc(100vh - 60px);
                padding: 15px;
                padding-bottom: 80px;
                animation: slideInPage 0.3s ease;
            }

            .mobile-page.active {
                display: block;
            }

            @keyframes slideInPage {
                from { transform: translateX(30px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }

            /* Page Indicator Dots */
            .page-indicator {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 8px;
                z-index: 100;
                background: rgba(26,26,46,0.95);
                padding: 10px 20px;
                border-radius: 25px;
                border: 1px solid var(--border);
            }

            .page-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: var(--text-muted);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .page-dot.active {
                background: var(--primary);
                width: 24px;
                border-radius: 4px;
            }

            /* Page Headers */
            .page-header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 20px;
            }

            .btn-back {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: var(--bg-card);
                border: 1px solid var(--border);
                color: var(--text-secondary);
                font-size: 1.2rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
            }

            .btn-back:hover {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }

            .page-title {
                font-size: var(--font-lg);
                font-weight: 600;
                color: var(--text-primary);
            }

            /* Score Circle (Page 2) */
            .score-circle-container {
                text-align: center;
                margin: 20px 0;
            }

            .score-circle {
                width: 140px;
                height: 140px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2.5rem;
                font-weight: 700;
                margin: 0 auto 10px;
                background: linear-gradient(135deg, var(--primary), var(--primary-light));
                color: white;
                box-shadow: 0 8px 30px rgba(69, 123, 157, 0.4);
            }

            .score-label {
                font-size: var(--font-sm);
                color: var(--text-muted);
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            /* Score Breakdown with Sublabels (Page 2) */
            .score-breakdown {
                background: var(--bg-card);
                border-radius: 16px;
                border: 1px solid var(--border);
                padding: 15px;
                margin: 20px 0;
            }

            .score-factor {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                padding: 12px 0;
                border-bottom: 1px solid var(--border);
            }

            .score-factor:last-child {
                border-bottom: none;
            }

            .score-factor-label {
                display: flex;
                flex-direction: column;
                gap: 2px;
                flex: 1;
            }

            .score-factor-main {
                font-size: var(--font-sm);
                color: var(--text-primary);
                font-weight: 500;
            }

            .score-factor-sub {
                font-size: var(--font-xs);
                color: var(--text-muted);
                font-style: italic;
            }

            .score-factor-value {
                font-size: var(--font-md);
                font-weight: 700;
                color: var(--primary);
                min-width: 50px;
                text-align: right;
            }

            /* Quality Quote (Pirsig-Style) */
            .quality-quote {
                margin: 20px 0;
                padding: 16px;
                background: rgba(69, 123, 157, 0.1);
                border-left: 3px solid var(--primary);
                border-radius: 0 12px 12px 0;
            }

            .quality-quote p {
                font-size: var(--font-sm);
                color: var(--text-secondary);
                font-style: italic;
                line-height: 1.6;
            }

            /* Primary Button (Mobile Pages) */
            .btn-primary-mobile {
                display: block;
                width: 100%;
                padding: 14px 20px;
                background: var(--primary);
                border: none;
                border-radius: 12px;
                color: white;
                font-size: var(--font-base);
                font-weight: 600;
                cursor: pointer;
                margin-top: 20px;
                transition: all 0.3s ease;
            }

            .btn-primary-mobile:hover {
                opacity: 0.9;
                transform: translateY(-1px);
            }

            .btn-secondary-mobile {
                display: block;
                width: 100%;
                padding: 14px 20px;
                background: transparent;
                border: 1px solid var(--border);
                border-radius: 12px;
                color: var(--text-secondary);
                font-size: var(--font-base);
                font-weight: 500;
                cursor: pointer;
                margin-top: 10px;
                transition: all 0.3s ease;
            }

            .btn-secondary-mobile:hover {
                border-color: var(--primary);
                color: var(--text-primary);
            }

            /* Pro/Contra Cards (Page 3) */
            .pro-section-mobile, .contra-section-mobile {
                padding: 16px;
                border-radius: 12px;
                margin-bottom: 15px;
            }

            .pro-section-mobile {
                background: rgba(46, 204, 113, 0.1);
                border: 1px solid rgba(46, 204, 113, 0.3);
            }

            .contra-section-mobile {
                background: rgba(231, 76, 60, 0.1);
                border: 1px solid rgba(231, 76, 60, 0.3);
            }

            .pro-section-mobile h3 {
                color: var(--success);
                font-size: var(--font-base);
                margin-bottom: 12px;
            }

            .contra-section-mobile h3 {
                color: var(--danger);
                font-size: var(--font-base);
                margin-bottom: 12px;
            }

            .pro-list-mobile, .contra-list-mobile {
                list-style: none;
                font-size: var(--font-sm);
                color: var(--text-secondary);
            }

            .pro-list-mobile li, .contra-list-mobile li {
                padding: 6px 0 6px 18px;
                position: relative;
            }

            .pro-list-mobile li::before {
                content: '✓';
                position: absolute;
                left: 0;
                color: var(--success);
            }

            .contra-list-mobile li::before {
                content: '✗';
                position: absolute;
                left: 0;
                color: var(--danger);
            }

            /* Categories Accordion (Page 4) */
            .categories-accordion {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .category-accordion-item {
                background: var(--bg-card);
                border: 1px solid var(--border);
                border-radius: 12px;
                overflow: hidden;
            }

            .category-accordion-header {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 14px 16px;
                cursor: pointer;
                transition: background 0.2s ease;
            }

            .category-accordion-header:hover {
                background: var(--bg-hover);
            }

            .category-accordion-letter {
                width: 32px;
                height: 32px;
                border-radius: 8px;
                background: var(--primary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 700;
                font-size: var(--font-sm);
                color: white;
                flex-shrink: 0;
            }

            .category-accordion-name {
                flex: 1;
                font-size: var(--font-sm);
                color: var(--text-primary);
            }

            .category-accordion-score {
                font-size: var(--font-md);
                font-weight: 700;
                color: var(--primary);
            }

            .category-accordion-icon {
                font-size: 0.8rem;
                color: var(--text-muted);
                transition: transform 0.3s ease;
            }

            .category-accordion-item.open .category-accordion-icon {
                transform: rotate(180deg);
            }

            .category-accordion-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }

            .category-accordion-item.open .category-accordion-content {
                max-height: 300px;
            }

            .category-accordion-inner {
                padding: 0 16px 16px;
                border-top: 1px solid var(--border);
            }

            .category-accordion-desc {
                font-size: var(--font-sm);
                color: var(--text-secondary);
                line-height: 1.5;
                margin-top: 12px;
            }

            .category-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
                margin-top: 12px;
            }

            .category-tag {
                padding: 4px 10px;
                background: rgba(255,255,255,0.05);
                border-radius: 12px;
                font-size: 11px;
                color: var(--text-muted);
            }

            /* Types Display (Page 2) */
            .types-display {
                text-align: center;
                font-size: var(--font-lg);
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 10px;
            }

            .types-display .type-name {
                color: var(--primary);
            }

            /* Mobile: Larger fonts for better readability */
            .compact-dimension-label {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .compact-option {
                padding: 12px 16px;
                font-size: 16px;
            }

            .compact-options {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            /* 4-button groups (Dominanz) get 2x2 grid */
            .compact-dimension:has([value="ausgeglichen"]) .compact-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .compact-option {
                text-align: center;
                justify-content: center;
            }

            .compact-dimension {
                gap: 8px;
                margin-bottom: 12px;
            }

            /* Mobile Page 1: Fix heading overflow */
            #mobilePage1 h2 {
                font-size: 18px !important;
                line-height: 1.3;
                word-wrap: break-word;
                padding: 0 10px;
            }

            /* Mobile Pro/Contra: Larger fonts */
            .pro-list-mobile li, .contra-list-mobile li {
                font-size: 15px;
                padding: 10px 0 10px 24px;
                line-height: 1.5;
            }

            .pro-section-mobile h3, .contra-section-mobile h3 {
                font-size: 17px;
            }

            /* Mobile Score factors: Larger fonts */
            .score-factor-main {
                font-size: 15px;
            }

            .score-factor-sub {
                font-size: 13px;
            }

            .score-factor-value {
                font-size: 18px;
            }

            /* Mobile Page title */
            .page-title {
                font-size: 18px;
            }

            /* Mobile: Larger dropdown */
            .column-select {
                font-size: 16px;
                padding: 12px 14px;
                max-width: 160px;
            }

            /* Mobile: Larger INFO button */
            .archetype-info-btn {
                font-size: 13px;
                padding: 10px 14px;
            }

            /* Mobile column-dimensions more spacing */
            .column-dimensions {
                gap: 20px;
            }
        }

        /* Desktop: Keep single-page layout, hide mobile */
        @media (min-width: 769px) {
            .mobile-multipage {
                display: none !important;
            }

            .comparison-container.desktop-mode {
                display: block !important;
            }

            .page-indicator {
                display: none !important;
            }
        }

        /* Validation Warning Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
        }

        /* Footer / Impressum Styles */
        .app-footer {
            text-align: center;
            padding: 20px 15px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }
        .app-footer a {
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            margin: 0 10px;
        }
        .app-footer a:hover {
            color: #4A90E2;
            text-decoration: underline;
        }
        .impressum-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        .impressum-modal.active {
            display: flex;
        }
        .impressum-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .impressum-content h3 {
            margin: 0 0 20px 0;
            color: #fff;
            font-size: 20px;
        }
        .impressum-content p {
            margin: 10px 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }
        .impressum-content a {
            color: #4A90E2;
        }
        .impressum-close {
            margin-top: 20px;
            padding: 10px 30px;
            background: linear-gradient(135deg, #4A90E2, #357ABD);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Age Verification - Inline Script BEFORE modal for onclick to work -->
    <script>
        // Define confirmAge immediately so onclick handlers work
        // Modal appears on EVERY visit (no localStorage storage)
        window.confirmAge = function(isAdult) {
            console.log('confirmAge called:', isAdult);
            try {
                var modal = document.getElementById('ageVerificationModal');
                if (isAdult) {
                    // Just hide the modal for this session - no localStorage
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        modal.style.pointerEvents = 'none';
                    }
                    document.body.style.overflow = 'auto';
                } else {
                    window.location.href = 'https://www.google.com';
                }
            } catch(e) {
                console.error('confirmAge error:', e);
                var m = document.getElementById('ageVerificationModal');
                if (m) m.style.display = 'none';
            }
        };
    </script>

    <!-- Help Modal -->
    <div class="help-modal-overlay" id="helpModal" onclick="closeHelpModal(event)">
        <div class="help-modal" onclick="event.stopPropagation()">
            <div class="help-modal-header">
                <h2>Hilfe & Dokumentation</h2>
                <button class="help-modal-close" onclick="closeHelpModal()">&times;</button>
            </div>
            <div class="help-modal-content">

                <!-- KURZANLEITUNG -->
                <div class="quick-guide">
                    <h3>Kurzanleitung</h3>
                    <ul>
                        <li><strong>ICH</strong> = Dein Archetyp + Eigenschaften (links/oben)</li>
                        <li><strong>PARTNER</strong> = Archetyp + Eigenschaften des Partners (rechts/unten)</li>
                        <li><strong>INFO</strong>-Button = Details zum gewählten Archetyp</li>
                        <li><strong>Ergebnis</strong> = Automatische Berechnung der Kompatibilität</li>
                        <li><strong>Prozentwerte</strong> anklicken = Detaillierte Erklärung pro Faktor</li>
                    </ul>
                </div>

                <!-- KOMMENTAR-SEKTION -->
                <div class="comment-section">
                    <p>Fragen, Feedback oder Verbesserungsvorschläge?</p>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="comment-btn" onclick="openCommentModal()">
                            Kommentar senden
                        </button>
                        <button class="view-comments-btn" onclick="openCommentsListModal()">
                            📋 Alle Kommentare
                        </button>
                    </div>
                </div>

                <!-- DOKUMENTATION -->
                <div class="documentation-section">
                    <h3>Dokumentation</h3>

                    <div class="help-section">
                        <h3>Das Tiage-Beziehungsmodell</h3>
                        <p>Eine <strong>eigenständige Synthese</strong> von Tiage, entwickelt durch Online-Recherche und persönliche Reflexion. Das Modell verbindet zwei philosophische Traditionen zu einem praktischen Analyse-Tool:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>MOQ (Robert M. Pirsig):</strong> Metaphysik der Qualität - statische vs. dynamische Qualität als Grundstruktur</li>
                            <li><strong>OSHO:</strong> Bewusstsein durch Meditation - Polarität, Balance, Schwingung</li>
                        </ul>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Tiage's Beitrag: Die Verbindung beider Philosophien zu einem konkreten Beziehungs-Rechner mit eigener Gewichtung und Archetypen-Matrix.</p>
                    </div>

                    <div class="help-section">
                        <h3>Logos vs. Pathos (40:60)</h3>
                        <p><strong>Logos (40% - Verstand):</strong> Die rationale, strukturgebende Dimension. Pirsig nennt dies "statische Qualität" - bewährte Muster, die Stabilität schaffen.</p>
                        <p style="margin-top: 8px;"><strong>Pathos (60% - Gefühl):</strong> Die emotionale, anziehende Dimension. Pirsig nennt dies "dynamische Qualität" - die Kraft, die Veränderung und Wachstum antreibt.</p>
                        <p style="margin-top: 8px; font-style: italic; color: var(--text-muted);">OSHO: "Bewusstsein durch Meditation - Loslassen (Let Go) ermöglicht echte Verbindung."</p>
                    </div>

                    <div class="help-section">
                        <h3>Die 4 Qualitätsfaktoren</h3>
                        <ul>
                            <li><strong>Archetyp-Übereinstimmung</strong> (40% Logos) - Fundamentale Beziehungsphilosophie: "Wie wollen wir Beziehung leben?"</li>
                            <li><strong>Orientierungs-Kompatibilität</strong> (25% Pathos) - Körperliche Polarität und Anziehung. OSHO: "Nur Extreme können sich wirklich anziehen."</li>
                            <li><strong>Dominanz-Harmonie</strong> (20% Pathos) - Energetische Dynamik. OSHO: "Tao - eine Energie, zwei Ausdrucksformen."</li>
                            <li><strong>Geschlechts-Attraktion</strong> (15% Pathos) - Gender-Chemie als Feinabstimmung der Orientierung.</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>Berechnung</h3>
                        <div class="help-formula">
                            Qualitätsindex = (Archetyp × 40%) + (Orientierung × 25%) + (Dominanz × 20%) + (Geschlecht × 15%)
                        </div>
                        <p>Jeder Faktor wird einzeln auf 0-100% bewertet. Der Gesamtindex ist die gewichtete Summe aller vier Faktoren.</p>
                    </div>

                    <div class="help-section">
                        <h3>Rechenbeispiel</h3>
                        <div class="help-example">
                            <div class="help-example-title">Duo (Frau, Submissiv, Hetero) × Duo-Flex (Mann, Dominant, Hetero)</div>
                            <ul>
                                <li>Archetyp: 75% × 0.40 = 30 (Duo ↔ Duo-Flex = nah verwandt)</li>
                                <li>Orientierung: 100% × 0.25 = 25 (Hetero + Hetero bei M/F)</li>
                                <li>Dominanz: 100% × 0.20 = 20 (Submissiv + Dominant = Ergänzung)</li>
                                <li>Geschlecht: 100% × 0.15 = 15 (Frau × Mann passt)</li>
                            </ul>
                            <div class="help-formula">
                                30 + 25 + 20 + 15 = 90%
                            </div>
                        </div>
                    </div>

                    <div class="help-section">
                        <h3>Die 6 Archetypen</h3>
                        <ul>
                            <li><strong>Single</strong> - Autonomes Leben ohne Primärbeziehung</li>
                            <li><strong>Duo</strong> - Monogame Zweierbeziehung mit Exklusivität</li>
                            <li><strong>Duo-Flex</strong> - Primärbeziehung mit vereinbarten Öffnungen</li>
                            <li><strong>Solopoly</strong> - Mehrere gleichwertige Beziehungen, Fokus Autonomie</li>
                            <li><strong>Poly-Hedo</strong> - Polyamorie mit Fokus auf Genuss</li>
                            <li><strong>Polyamor</strong> - Tiefe emotionale Bindungen zu mehreren Partnern</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>Ergebnis-Interpretation</h3>
                        <ul>
                            <li><strong>80-100%</strong> - Exzellent: Wenige Herausforderungen</li>
                            <li><strong>60-79%</strong> - Gut: Mit Kommunikation machbar</li>
                            <li><strong>40-59%</strong> - Moderat: Erfordert bewusste Arbeit</li>
                            <li><strong>0-39%</strong> - Herausfordernd: Fundamentale Unterschiede</li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">Der Qualitätsindex ist ein Orientierungswert. Echte Beziehungen hängen von vielen weiteren Faktoren ab.</p>
                    </div>

                    <div class="help-section">
                        <h3>Philosophische Quellen</h3>
                        <h4 style="margin-top: 15px;">Robert M. Pirsig (1928-2017) - Metaphysik der Qualität</h4>
                        <p>Pirsig entwickelte ein philosophisches System, das <strong>Qualität</strong> als fundamentale Realität betrachtet:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Statische Qualität:</strong> Strukturierte, wiederholbare Muster die Stabilität schaffen → im Tiage-Modell: <strong>Logos</strong></li>
                            <li><strong>Dynamische Qualität:</strong> Die kreative Kraft für Wachstum und Veränderung → im Tiage-Modell: <strong>Pathos</strong></li>
                        </ul>
                        <h4 style="margin-top: 15px;">OSHO - Bewusstsein durch Meditation</h4>
                        <p>OSHO lehrte Bewusstsein über Polarität, Balance und Schwingung - Meditation als Weg zur Klarheit:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Bewusstsein:</strong> Klarheit durch Meditation und Loslassen (Let Go)</li>
                            <li><strong>Polarität & Schwingung:</strong> Energetische Balance in Beziehungen</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Tiage's Synthese:</strong> Die Verbindung von Pirsigs Qualitäts-Philosophie mit OSHOs Bewusstseins-Konzept zu einem praktischen Beziehungs-Rechner mit konkreter Gewichtung (40:60 Logos:Pathos) und 6 Archetypen.</p>
                    </div>

                    <div class="help-section">
                        <h3>Literatur von Robert M. Pirsig</h3>
                        <ul>
                            <li>
                                <strong>Zen und die Kunst ein Motorrad zu warten</strong> (1974)<br>
                                <span style="color: var(--text-muted); font-size: 0.9em;">Originaltitel: "Zen and the Art of Motorcycle Maintenance: An Inquiry into Values"</span><br>
                                <span style="margin-top: 5px; display: inline-block;">Ein philosophischer Roman, der Pirsigs erste Erkundung der Qualität als metaphysisches Konzept darstellt. Das Buch verbindet eine Motorradreise mit tiefgreifenden philosophischen Betrachtungen über Rationalität, Romantik und die Natur der Qualität.</span>
                            </li>
                            <li style="margin-top: 15px;">
                                <strong>Lila – oder ein Versuch über Moral</strong> (1991)<br>
                                <span style="color: var(--text-muted); font-size: 0.9em;">Originaltitel: "Lila: An Inquiry into Morals"</span><br>
                                <span style="margin-top: 5px; display: inline-block;">Die Fortsetzung und systematische Ausarbeitung der Metaphysik der Qualität. Pirsig entwickelt hier eine vollständige philosophische Theorie, die statische und dynamische Qualitätsmuster auf biologischer, sozialer und intellektueller Ebene unterscheidet.</span>
                            </li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>OSHO: Bewusstsein und Beziehung</h3>
                        <p><strong>Bhagwan Shree Rajneesh (OSHO)</strong> (1931-1990) war ein indischer spiritueller Lehrer, dessen Philosophie über Bewusstsein und Meditation das Tiage-Modell beeinflusst.</p>
                        <p style="margin-top: 10px;">Zentrale Konzepte für das Modell:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Bewusstsein durch Meditation:</strong> Klarheit über sich selbst ermöglicht authentische Beziehungen. Loslassen (Let Go) als Weg zur Verbindung.</li>
                            <li style="margin-top: 8px;"><strong>Polarität & Schwingung:</strong> Energetische Balance zwischen Gegensätzen. Tao als eine Energie in zwei Ausdrucksformen.</li>
                            <li style="margin-top: 8px;"><strong>Balance:</strong> Harmonie entsteht durch bewusstes Wahrnehmen der eigenen Energie und der des Partners.</li>
                        </ul>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">"Bewusstsein ist der Schlüssel. Wenn du bewusst bist, kannst du loslassen und echte Verbindung entstehen lassen."</p>
                    </div>

                    <div class="help-section">
                        <h3>Quellen & Weiterführende Ressourcen</h3>
                        <ul>
                            <li><strong>Pirsig, Robert M.</strong> (1974): <em>Zen and the Art of Motorcycle Maintenance: An Inquiry into Values.</em> William Morrow and Company, New York.</li>
                            <li><strong>Pirsig, Robert M.</strong> (1991): <em>Lila: An Inquiry into Morals.</em> Bantam Books, New York.</li>
                            <li><strong>McWatt, Anthony</strong> (2004): <em>An Introduction to Robert Pirsig's Metaphysics of Quality.</em> Dissertation, University of Liverpool.</li>
                            <li style="margin-top: 10px;"><strong>Schupp, Hans</strong>: <em>Elemente der Logik.</em> <span style="color: var(--text-muted); font-size: 0.85em;">(Indirekte Quelle – als Grundlage für logische Strukturierung und formale Denkprinzipien)</span></li>
                            <li style="margin-top: 10px;"><strong>OSHO:</strong>
                                <ul style="margin-top: 5px;">
                                    <li><a href="https://oshofriends.com/love" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">OSHO on Love and Relationships</a></li>
                                    <li><a href="https://www.oshonews.com/2021/03/07/man-and-woman/" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Man and Woman - Polarity</a></li>
                                </ul>
                            </li>
                            <li style="margin-top: 10px;"><strong>MOQ Online-Ressourcen:</strong>
                                <ul style="margin-top: 5px;">
                                    <li><a href="https://www.moq.org" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">moq.org</a> – Metaphysics of Quality Community</li>
                                    <li><a href="https://en.wikipedia.org/wiki/Robert_M._Pirsig" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Wikipedia: Robert M. Pirsig</a></li>
                                </ul>
                            </li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">Das Tiage-Beziehungsmodell ist eine eigenständige Interpretation und Anwendung philosophischer Konzepte auf zwischenmenschliche Beziehungen und erhebt keinen Anspruch auf wissenschaftliche Validierung.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div class="comment-modal-overlay" id="commentModal" onclick="closeCommentModal(event)">
        <div class="comment-modal" onclick="event.stopPropagation()">
            <div class="comment-modal-header">
                <h3>Kommentar senden</h3>
                <button class="comment-modal-close" onclick="closeCommentModal()">&times;</button>
            </div>
            <div class="comment-modal-body">
                <div class="comment-form-group">
                    <label for="commentName">Name / Kürzel *</label>
                    <input type="text" id="commentName" placeholder="z.B. Max oder Anonym">
                </div>
                <div class="comment-form-group">
                    <label for="commentType">Art des Kommentars</label>
                    <select id="commentType">
                        <option value="frage">Frage zur Bedienung</option>
                        <option value="feedback">Allgemeines Feedback</option>
                        <option value="fehler">Fehler melden</option>
                        <option value="verbesserung">Verbesserungsvorschlag</option>
                        <option value="doku">Frage zur Dokumentation</option>
                    </select>
                </div>
                <div class="comment-form-group">
                    <label for="commentText">Dein Kommentar *</label>
                    <textarea id="commentText" placeholder="Schreibe hier deine Frage oder dein Feedback..."></textarea>
                </div>
                <button class="comment-submit-btn" id="commentSubmitBtn" onclick="submitComment()">Absenden</button>
            </div>
        </div>
    </div>

    <!-- Comments List Modal -->
    <div class="comments-list-overlay" id="commentsListModal" onclick="closeCommentsListModal(event)">
        <div class="comments-list-modal" onclick="event.stopPropagation()">
            <div class="comments-list-header">
                <h2>📋 Alle Kommentare</h2>
                <button class="help-modal-close" onclick="closeCommentsListModal()">&times;</button>
            </div>
            <div class="comments-search-container">
                <div class="comments-search-wrapper">
                    <span class="comments-search-icon">🔍</span>
                    <input type="text"
                           id="commentsSearchInput"
                           class="comments-search-input"
                           placeholder="Suche... (* als Platzhalter)"
                           oninput="filterComments(this.value)">
                    <button class="comments-search-clear" id="commentsSearchClear" onclick="clearCommentsSearch()">&times;</button>
                </div>
                <div class="comments-search-hint">Beispiel: *fehler* findet alle Kommentare mit "fehler" im Text</div>
            </div>
            <div class="comments-search-results" id="commentsSearchResults" style="display: none;"></div>
            <div class="comments-list-body" id="commentsListBody">
                <div class="no-comments">
                    <div class="no-comments-icon">💬</div>
                    <p>Lade Kommentare...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Age Verification Modal -->
    <div class="age-verification-overlay" id="ageVerificationModal">
        <div class="age-verification-modal" onclick="event.stopPropagation()">
            <div class="age-verification-icon">🔞</div>
            <h2>Altersverifikation</h2>
            <p>Diese Seite enthält Inhalte über Beziehungsmodelle und ist nur für Personen ab 18 Jahren bestimmt.</p>
            <div class="age-verification-question">
                <strong>Bist du mindestens 18 Jahre alt?</strong>
            </div>
            <!-- Buttons -->
            <div class="age-verification-buttons">
                <button class="age-btn age-btn-yes" id="ageVerifyYes" type="button" onclick="window.confirmAge(true); return false;">
                    Ja, ich bin 18+
                </button>
                <button class="age-btn age-btn-no" id="ageVerifyNo" type="button" onclick="window.confirmAge(false); return false;">
                    Nein, ich bin unter 18
                </button>
            </div>
            <p class="age-verification-note">
                Mit dem Klick auf "Ja" bestätigst du, dass du:<br>
                • volljährig bist (mindestens 18 Jahre alt)<br>
                • die <a href="datenschutz.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Nutzungsbedingungen und Datenschutzerklaerung</a> akzeptierst<br>
                • zur Kenntnis nimmst, dass alle Inhalte urheberrechtlich geschützt sind<br>
                • die Inhalte nur für persönliche, nicht-kommerzielle Zwecke nutzt
            </p>
        </div>
    </div>

    <!-- Factor Detail Modal (Feature 1) -->
    <div class="modal-overlay" id="factorModal" onclick="closeFactorModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="factorModalTitle">Faktor-Details</span>
                <button class="modal-close" onclick="closeFactorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle" id="factorModalSubtitle"></p>
                <div id="factorModalComboCode" style="font-size: 11px; color: var(--text-muted); background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 6px; display: inline-block; margin-bottom: 10px; font-family: monospace;"></div>
                <div class="score-display" id="factorModalScore">0%</div>
                <div class="explanation">
                    <h4>Warum dieser Score?</h4>
                    <p id="factorModalExplanation"></p>
                    <h4>Was bedeutet das?</h4>
                    <ul id="factorModalMeaning"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Archetype Info Modal (Feature 4) -->
    <div class="modal-overlay" id="archetypeInfoModal" onclick="closeArchetypeInfoModal(event)">
        <div class="modal" onclick="event.stopPropagation()" style="position: relative;">
            <div class="modal-header">
                <button class="archetype-nav-btn" onclick="navigateArchetype(-1)" title="Vorheriger Archetyp">&#8249;</button>
                <span class="modal-title" id="archetypeInfoTitle">Archetyp-Info</span>
                <button class="archetype-nav-btn" onclick="navigateArchetype(1)" title="Nächster Archetyp">&#8250;</button>
                <button class="modal-close" onclick="closeArchetypeInfoModal()">&times;</button>
            </div>
            <div class="modal-body" id="archetypeInfoBody">
                <div class="archetype-dots" id="archetypeDots"></div>
                <h3>Definition</h3>
                <p id="archetypeInfoDefinition"></p>
                <h3>Merkmale</h3>
                <ul id="archetypeInfoFeatures"></ul>
                <h3>Passt zu dir?</h3>
                <p id="archetypeInfoMatch"></p>
            </div>
        </div>
    </div>

    <header>
        <h1>ARCHETYPEN-BEZIEHUNGSQUALITÄT</h1>
        <button class="help-btn" onclick="openHelpModal()" title="Hilfe & Dokumentation">?</button>
    </header>

    <!-- NEW: Side-by-Side Comparison Layout (Desktop) -->
    <div class="comparison-container desktop-mode" id="comparisonView">
        <!-- Two Column Grid -->
        <div class="comparison-grid">
            <!-- ICH Column -->
            <div class="comparison-column ich-column">
                <div class="column-header">
                    <div class="column-icon">👤</div>
                    <div class="column-title">ICH</div>
                </div>
                <div class="select-with-info">
                    <select class="column-select" id="ichSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="poly_hedo" title="Freiheitsorientierte Poly-Orientierung mit Fokus auf Genuss">Poly Hedo</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                    </select>
                    <button class="archetype-info-btn" onclick="showArchetypeInfo('ich')" title="Info zum Archetyp">INFO</button>
                </div>
                <div class="column-dimensions">
                    <div class="compact-dimension needs-selection" data-dimension="ich-geschlecht-new">
                        <div class="compact-dimension-label">Geschlecht</div>
                        <div class="compact-options">
                            <input type="radio" name="ich-geschlecht-new" id="ich-g-m" value="männlich" class="compact-radio">
                            <label for="ich-g-m" class="compact-option">männlich</label>
                            <input type="radio" name="ich-geschlecht-new" id="ich-g-w" value="weiblich" class="compact-radio">
                            <label for="ich-g-w" class="compact-option">weiblich</label>
                            <input type="radio" name="ich-geschlecht-new" id="ich-g-nb" value="non-binär" class="compact-radio">
                            <label for="ich-g-nb" class="compact-option">non-binär</label>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="ich-dominanz-multi">
                        <div class="compact-dimension-label">Dominanz <span class="dimension-info-icon" onclick="showDimensionTooltip('dominanz')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="ich-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleDominanzMultiChange('ich', 'dominant', this.checked)">
                                <label for="ich-d-dom" class="dominanz-label">dominant</label>
                                <div id="ich-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('ich', 'dominant', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="ich-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleDominanzMultiChange('ich', 'submissiv', this.checked)">
                                <label for="ich-d-sub" class="dominanz-label">submissiv</label>
                                <div id="ich-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="ich-d-sw" value="switch" class="dominanz-checkbox" onchange="handleDominanzMultiChange('ich', 'switch', this.checked)">
                                <label for="ich-d-sw" class="dominanz-label">switch</label>
                                <div id="ich-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('ich', 'switch', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="ich-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleDominanzMultiChange('ich', 'ausgeglichen', this.checked)">
                                <label for="ich-d-aus" class="dominanz-label">ausgeglichen</label>
                                <div id="ich-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="ich-orientierung-multi">
                        <div class="compact-dimension-label">Orientierung <span class="dimension-info-icon" onclick="showDimensionTooltip('orientierung')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="ich-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleOrientierungMultiChange('ich', 'heterosexuell', this.checked)">
                                <label for="ich-o-het" class="dominanz-label">heterosexuell</label>
                                <select id="ich-o-het-status" class="dominanz-status-select" style="display: none;" onchange="handleOrientierungStatusChange('ich', 'heterosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="ich-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleOrientierungMultiChange('ich', 'homosexuell', this.checked)">
                                <label for="ich-o-hom" class="dominanz-label">homosexuell</label>
                                <select id="ich-o-hom-status" class="dominanz-status-select" style="display: none;" onchange="handleOrientierungStatusChange('ich', 'homosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="ich-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleOrientierungMultiChange('ich', 'bisexuell', this.checked)">
                                <label for="ich-o-bi" class="dominanz-label">bisexuell</label>
                                <select id="ich-o-bi-status" class="dominanz-status-select" style="display: none;" onchange="handleOrientierungStatusChange('ich', 'bisexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PARTNER Column -->
            <div class="comparison-column partner-column">
                <div class="column-header">
                    <div class="column-icon">👥</div>
                    <div class="column-title">PARTNER</div>
                </div>
                <div class="select-with-info">
                    <select class="column-select" id="partnerSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" selected title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="poly_hedo" title="Freiheitsorientierte Poly-Orientierung mit Fokus auf Genuss">Poly Hedo</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                    </select>
                    <button class="archetype-info-btn" onclick="showArchetypeInfo('partner')" title="Info zum Archetyp">INFO</button>
                </div>
                <div class="column-dimensions">
                    <div class="compact-dimension needs-selection" data-dimension="partner-geschlecht-new">
                        <div class="compact-dimension-label">Geschlecht</div>
                        <div class="compact-options">
                            <input type="radio" name="partner-geschlecht-new" id="partner-g-m" value="männlich" class="compact-radio">
                            <label for="partner-g-m" class="compact-option">männlich</label>
                            <input type="radio" name="partner-geschlecht-new" id="partner-g-w" value="weiblich" class="compact-radio">
                            <label for="partner-g-w" class="compact-option">weiblich</label>
                            <input type="radio" name="partner-geschlecht-new" id="partner-g-nb" value="non-binär" class="compact-radio">
                            <label for="partner-g-nb" class="compact-option">non-binär</label>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="partner-dominanz-multi">
                        <div class="compact-dimension-label">Dominanz <span class="dimension-info-icon" onclick="showDimensionTooltip('dominanz')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="partner-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleDominanzMultiChange('partner', 'dominant', this.checked)">
                                <label for="partner-d-dom" class="dominanz-label">dominant</label>
                                <div id="partner-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('partner', 'dominant', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="partner-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleDominanzMultiChange('partner', 'submissiv', this.checked)">
                                <label for="partner-d-sub" class="dominanz-label">submissiv</label>
                                <div id="partner-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="partner-d-sw" value="switch" class="dominanz-checkbox" onchange="handleDominanzMultiChange('partner', 'switch', this.checked)">
                                <label for="partner-d-sw" class="dominanz-label">switch</label>
                                <div id="partner-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('partner', 'switch', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="partner-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleDominanzMultiChange('partner', 'ausgeglichen', this.checked)">
                                <label for="partner-d-aus" class="dominanz-label">ausgeglichen</label>
                                <div id="partner-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="partner-orientierung-multi">
                        <div class="compact-dimension-label">Orientierung <span class="dimension-info-icon" onclick="showDimensionTooltip('orientierung')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="partner-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleOrientierungMultiChange('partner', 'heterosexuell', this.checked)">
                                <label for="partner-o-het" class="dominanz-label">heterosexuell</label>
                                <select id="partner-o-het-status" class="dominanz-status-select" style="display: none;" onchange="handleOrientierungStatusChange('partner', 'heterosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="partner-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleOrientierungMultiChange('partner', 'homosexuell', this.checked)">
                                <label for="partner-o-hom" class="dominanz-label">homosexuell</label>
                                <select id="partner-o-hom-status" class="dominanz-status-select" style="display: none;" onchange="handleOrientierungStatusChange('partner', 'homosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="partner-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleOrientierungMultiChange('partner', 'bisexuell', this.checked)">
                                <label for="partner-o-bi" class="dominanz-label">bisexuell</label>
                                <select id="partner-o-bi-status" class="dominanz-status-select" style="display: none;" onchange="handleOrientierungStatusChange('partner', 'bisexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Bar -->
        <div class="result-bar">
            <div id="warningsContainer"></div>
            <div class="result-header">
                <div class="result-title">
                    <span class="type-name" id="resultIchType">Single</span>
                    <span> × </span>
                    <span class="type-name" id="resultPartnerType">Duo</span>
                    <span style="font-size: var(--font-xs); color: var(--text-muted); margin-left: 8px;">Qualitätsindex</span>
                </div>
                <div class="result-percentage" id="resultPercentage">0%</div>
            </div>
            <div class="result-progress">
                <div class="result-progress-fill" id="resultProgressFill" style="width: 0%; background: var(--primary);"></div>
            </div>

            <!-- 4-Factor Breakdown with Sublabels -->
            <div id="desktopFactorBreakdown" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                <div onclick="openFactorModal('archetyp', 'desktop')" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.08)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <span style="font-size: var(--font-sm); color: var(--text-primary);">Archetyp-Übereinstimmung</span>
                        <span style="font-size: var(--font-xs); color: var(--text-muted); font-style: italic;">(Beziehungsphilosophie - Verstand/Logos)</span>
                    </div>
                    <span id="desktopFactorArchetyp" style="font-size: var(--font-base); font-weight: 700; color: var(--primary);">0%</span>
                </div>
                <div onclick="openFactorModal('dominanz', 'desktop')" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.08)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <span style="font-size: var(--font-sm); color: var(--text-primary);">Dominanz-Harmonie</span>
                        <span style="font-size: var(--font-xs); color: var(--text-muted); font-style: italic;">(Emotionale Dynamik - Gefühl/Pathos)</span>
                    </div>
                    <span id="desktopFactorDominanz" style="font-size: var(--font-base); font-weight: 700; color: var(--primary);">0%</span>
                </div>
                <div onclick="openFactorModal('orientierung', 'desktop')" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.08)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <span style="font-size: var(--font-sm); color: var(--text-primary);">Orientierungs-Kompatibilität</span>
                        <span style="font-size: var(--font-xs); color: var(--text-muted); font-style: italic;">(Körperliche Anziehung - Gefühl/Pathos)</span>
                    </div>
                    <span id="desktopFactorOrientierung" style="font-size: var(--font-base); font-weight: 700; color: var(--primary);">0%</span>
                </div>
                <div onclick="openFactorModal('geschlecht', 'desktop')" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.08)'" onmouseout="this.style.background='rgba(255,255,255,0.03)'">
                    <div style="display: flex; flex-direction: column; gap: 2px;">
                        <span style="font-size: var(--font-sm); color: var(--text-primary);">Geschlechts-Attraktion</span>
                        <span style="font-size: var(--font-xs); color: var(--text-muted); font-style: italic;">(Gender-Chemie - Gefühl/Pathos)</span>
                    </div>
                    <span id="desktopFactorGeschlecht" style="font-size: var(--font-base); font-weight: 700; color: var(--primary);">0%</span>
                </div>
            </div>

            <!-- Pathos & Logos - Always Visible -->
            <div id="pathosLogosInline" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                <div id="pathosLogosContent">
                    <!-- Will be filled dynamically -->
                </div>
            </div>
        </div>

        <!-- Expandable Sections -->
        <div class="expandable-sections">
            <div class="expand-section">
                <button class="expand-btn" onclick="toggleExpandSection('proContraSection')">
                    <span>Pro & Contra – Qualitätsfaktoren</span>
                    <span class="expand-icon">▼</span>
                </button>
                <div class="expand-content" id="proContraSection">
                    <div class="expand-content-inner">
                        <div class="pro-contra-grid">
                            <div class="mini-list">
                                <div class="mini-list-title pro">✓ Was funktioniert</div>
                                <ul id="expandProList"></ul>
                            </div>
                            <div class="mini-list">
                                <div class="mini-list-title contra">✗ Herausforderungen</div>
                                <ul id="expandContraList"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- A-F Kategorien entfernt - neues 4-Faktoren-Modell verwendet stattdessen -->
        </div>
    </div>

    <!-- MOBILE: Multi-Page Swipe Interface -->
    <div class="mobile-multipage" id="mobileMultipage" style="display: none;">

        <!-- PAGE 1: Auswahl -->
        <div class="mobile-page active" id="mobilePage1" data-page="1">
            <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 20px; font-size: var(--font-lg);">Beziehungsqualität analysieren</h2>

            <!-- ICH Auswahl -->
            <div style="background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); border-top: 3px solid var(--success); padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: var(--success); font-weight: 700; font-size: var(--font-lg);">
                    <span>👤</span> ICH
                </div>
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
                    <select class="column-select" id="mobileIchSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="poly_hedo" title="Freiheitsorientierte Poly-Orientierung mit Fokus auf Genuss">Poly Hedo</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                    </select>
                    <button onclick="openArchetypeInfo(document.getElementById('mobileIchSelect').value)" style="padding: 12px 16px; background: rgba(255,255,255,0.1); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 14px; font-weight: 600; letter-spacing: 0.5px;" title="Info zum Archetyp">INFO</button>
                </div>
                <div class="column-dimensions" id="mobileIchDimensions">
                    <div class="compact-dimension needs-selection">
                        <div class="compact-dimension-label">Geschlecht</div>
                        <div class="compact-options">
                            <input type="radio" name="mobile-ich-geschlecht" id="m-ich-g-m" value="männlich" class="compact-radio">
                            <label for="m-ich-g-m" class="compact-option">männlich</label>
                            <input type="radio" name="mobile-ich-geschlecht" id="m-ich-g-w" value="weiblich" class="compact-radio">
                            <label for="m-ich-g-w" class="compact-option">weiblich</label>
                            <input type="radio" name="mobile-ich-geschlecht" id="m-ich-g-nb" value="non-binär" class="compact-radio">
                            <label for="m-ich-g-nb" class="compact-option">non-binär</label>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="mobile-ich-dominanz-multi">
                        <div class="compact-dimension-label">Dominanz <span class="dimension-info-icon" onclick="showDimensionTooltip('dominanz')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-ich-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('ich', 'dominant', this.checked)">
                                <label for="m-ich-d-dom" class="dominanz-label">dominant</label>
                                <div id="m-ich-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('ich', 'dominant', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('ich', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-ich-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('ich', 'submissiv', this.checked)">
                                <label for="m-ich-d-sub" class="dominanz-label">submissiv</label>
                                <div id="m-ich-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('ich', 'submissiv', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('ich', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-ich-d-sw" value="switch" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('ich', 'switch', this.checked)">
                                <label for="m-ich-d-sw" class="dominanz-label">switch</label>
                                <div id="m-ich-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('ich', 'switch', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('ich', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-ich-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('ich', 'ausgeglichen', this.checked)">
                                <label for="m-ich-d-aus" class="dominanz-label">ausgeglichen</label>
                                <div id="m-ich-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('ich', 'ausgeglichen', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('ich', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="mobile-ich-orientierung-multi">
                        <div class="compact-dimension-label">Sexuelle Orientierung <span class="dimension-info-icon" onclick="showDimensionTooltip('orientierung')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-ich-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleMobileOrientierungMultiChange('ich', 'heterosexuell', this.checked)">
                                <label for="m-ich-o-het" class="dominanz-label">heterosexuell</label>
                                <select id="m-ich-o-het-status" class="dominanz-status-select" style="display: none;" onchange="handleMobileOrientierungStatusChange('ich', 'heterosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-ich-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleMobileOrientierungMultiChange('ich', 'homosexuell', this.checked)">
                                <label for="m-ich-o-hom" class="dominanz-label">homosexuell</label>
                                <select id="m-ich-o-hom-status" class="dominanz-status-select" style="display: none;" onchange="handleMobileOrientierungStatusChange('ich', 'homosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-ich-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleMobileOrientierungMultiChange('ich', 'bisexuell', this.checked)">
                                <label for="m-ich-o-bi" class="dominanz-label">bisexuell</label>
                                <select id="m-ich-o-bi-status" class="dominanz-status-select" style="display: none;" onchange="handleMobileOrientierungStatusChange('ich', 'bisexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PARTNER Auswahl -->
            <div style="background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); border-top: 3px solid var(--danger); padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: var(--danger); font-weight: 700; font-size: var(--font-lg);">
                    <span>👥</span> DEIN PARTNER
                </div>
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
                    <select class="column-select" id="mobilePartnerSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" selected title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="poly_hedo" title="Freiheitsorientierte Poly-Orientierung mit Fokus auf Genuss">Poly Hedo</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                    </select>
                    <button onclick="openArchetypeInfo(document.getElementById('mobilePartnerSelect').value)" style="padding: 12px 16px; background: rgba(255,255,255,0.1); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 14px; font-weight: 600; letter-spacing: 0.5px;" title="Info zum Archetyp">INFO</button>
                </div>
                <div class="column-dimensions" id="mobilePartnerDimensions">
                    <div class="compact-dimension needs-selection">
                        <div class="compact-dimension-label">Geschlecht</div>
                        <div class="compact-options">
                            <input type="radio" name="mobile-partner-geschlecht" id="m-partner-g-m" value="männlich" class="compact-radio">
                            <label for="m-partner-g-m" class="compact-option">männlich</label>
                            <input type="radio" name="mobile-partner-geschlecht" id="m-partner-g-w" value="weiblich" class="compact-radio">
                            <label for="m-partner-g-w" class="compact-option">weiblich</label>
                            <input type="radio" name="mobile-partner-geschlecht" id="m-partner-g-nb" value="non-binär" class="compact-radio">
                            <label for="m-partner-g-nb" class="compact-option">non-binär</label>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="mobile-partner-dominanz-multi">
                        <div class="compact-dimension-label">Dominanz <span class="dimension-info-icon" onclick="showDimensionTooltip('dominanz')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-partner-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('partner', 'dominant', this.checked)">
                                <label for="m-partner-d-dom" class="dominanz-label">dominant</label>
                                <div id="m-partner-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('partner', 'dominant', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('partner', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-partner-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('partner', 'submissiv', this.checked)">
                                <label for="m-partner-d-sub" class="dominanz-label">submissiv</label>
                                <div id="m-partner-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('partner', 'submissiv', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('partner', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-partner-d-sw" value="switch" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('partner', 'switch', this.checked)">
                                <label for="m-partner-d-sw" class="dominanz-label">switch</label>
                                <div id="m-partner-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('partner', 'switch', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('partner', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-partner-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleMobileDominanzMultiChange('partner', 'ausgeglichen', this.checked)">
                                <label for="m-partner-d-aus" class="dominanz-label">ausgeglichen</label>
                                <div id="m-partner-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleMobileDominanzStatusToggle('partner', 'ausgeglichen', 'fakt', this)">Fakt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleMobileDominanzStatusToggle('partner', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection" data-dimension="mobile-partner-orientierung-multi">
                        <div class="compact-dimension-label">Sexuelle Orientierung <span class="dimension-info-icon" onclick="showDimensionTooltip('orientierung')">ℹ</span> <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-partner-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleMobileOrientierungMultiChange('partner', 'heterosexuell', this.checked)">
                                <label for="m-partner-o-het" class="dominanz-label">heterosexuell</label>
                                <select id="m-partner-o-het-status" class="dominanz-status-select" style="display: none;" onchange="handleMobileOrientierungStatusChange('partner', 'heterosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-partner-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleMobileOrientierungMultiChange('partner', 'homosexuell', this.checked)">
                                <label for="m-partner-o-hom" class="dominanz-label">homosexuell</label>
                                <select id="m-partner-o-hom-status" class="dominanz-status-select" style="display: none;" onchange="handleMobileOrientierungStatusChange('partner', 'homosexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                            <div class="dominanz-option-row">
                                <input type="checkbox" id="m-partner-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleMobileOrientierungMultiChange('partner', 'bisexuell', this.checked)">
                                <label for="m-partner-o-bi" class="dominanz-label">bisexuell</label>
                                <select id="m-partner-o-bi-status" class="dominanz-status-select" style="display: none;" onchange="handleMobileOrientierungStatusChange('partner', 'bisexuell', this.value)">
                                    <option value="fakt">Fakt</option>
                                    <option value="interessiert">Interessiert</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-primary-mobile" onclick="mobileGoToPage(2)">Analysieren →</button>

            <!-- Reset Button -->
            <button onclick="resetAll()" style="width: 100%; padding: 14px; margin-top: 12px; background: transparent; border: 1px solid rgba(255,255,255,0.3); border-radius: 12px; color: rgba(255,255,255,0.7); font-size: var(--font-base); cursor: pointer; transition: all 0.2s;">
                🔄 Auswahl zurücksetzen
            </button>
        </div>

        <!-- PAGE 2: Ergebnis-Übersicht -->
        <div class="mobile-page" id="mobilePage2" data-page="2">
            <div class="page-header">
                <button class="btn-back" onclick="mobileGoToPage(1)">←</button>
                <span class="page-title">Ergebnis</span>
            </div>

            <div class="types-display">
                <span class="type-name" id="mobileResultIch">Single</span>
                <span> × </span>
                <span class="type-name" id="mobileResultPartner">Duo</span>
            </div>

            <div class="score-circle-container">
                <div class="score-circle" id="mobileScoreCircle">0%</div>
                <p class="score-label">Beziehungsqualität</p>
            </div>

            <!-- Score Breakdown with Sublabels -->
            <div class="score-breakdown">
                <div class="score-factor" onclick="openFactorModal('archetyp')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Archetyp-Übereinstimmung</span>
                        <span class="score-factor-sub">(Beziehungsphilosophie - Verstand/Logos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorArchetyp">0%</span>
                </div>
                <div class="score-factor" onclick="openFactorModal('dominanz')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Dominanz-Harmonie</span>
                        <span class="score-factor-sub">(Emotionale Dynamik - Gefühl/Pathos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorDominanz">0%</span>
                </div>
                <div class="score-factor" onclick="openFactorModal('orientierung')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Orientierungs-Kompatibilität</span>
                        <span class="score-factor-sub">(Körperliche Anziehung - Gefühl/Pathos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorOrientierung">0%</span>
                </div>
                <div class="score-factor" onclick="openFactorModal('geschlecht')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Geschlechts-Attraktion</span>
                        <span class="score-factor-sub">(Gender-Chemie - Gefühl/Pathos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorGeschlecht">0%</span>
                </div>
            </div>

            <!-- Pathos & Logos - Always Visible -->
            <div id="mobilePathosLogosContent" style="margin-top: 15px; padding: 15px; background: var(--bg-card); border-radius: 12px;">
                <!-- Will be filled dynamically -->
            </div>

            <!-- Pirsig-Style Quote -->
            <div class="quality-quote" id="mobileQualityQuote">
                <p>"Diese Beziehung zeigt eine Balance zwischen statischen Mustern (Archetypen) und dynamischem Potenzial."</p>
            </div>

            <button class="btn-primary-mobile" onclick="mobileGoToPage(3)">Pro & Contra →</button>
        </div>

        <!-- PAGE 3: Pro & Contra -->
        <div class="mobile-page" id="mobilePage3" data-page="3">
            <div class="page-header">
                <button class="btn-back" onclick="mobileGoToPage(2)">←</button>
                <span class="page-title" id="mobileProContraTitle">Single × Duo</span>
            </div>

            <div class="pro-section-mobile">
                <h3>✓ Was funktioniert</h3>
                <ul class="pro-list-mobile" id="mobileProList">
                    <li>Wird geladen...</li>
                </ul>
            </div>

            <div class="contra-section-mobile">
                <h3>✗ Herausforderungen</h3>
                <ul class="contra-list-mobile" id="mobileContraList">
                    <li>Wird geladen...</li>
                </ul>
            </div>

            <button class="btn-secondary-mobile" onclick="mobileGoToPage(1)">← Neue Analyse</button>
        </div>

        <!-- PAGE 4 entfernt - A-F Kategorien nicht mehr verwendet -->

        <!-- Page Indicator -->
        <div class="page-indicator">
            <span class="page-dot active" onclick="mobileGoToPage(1)"></span>
            <span class="page-dot" onclick="mobileGoToPage(2)"></span>
            <span class="page-dot" onclick="mobileGoToPage(3)"></span>
        </div>
    </div>

    <!-- OLD Carousel (hidden) -->
    <div class="carousel-container" id="carousel" style="display: none;">
        <!-- CARD 1: MEIN TYP -->
        <div class="card" data-card="0">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Mein Typ</span>
                </div>
                <div class="card-body">
                    <div class="main-select">
                        <label class="main-select-label">Ich bin...</label>
                        <select id="archetypeSelect">
                            <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                            <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                            <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                            <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                            <option value="poly_hedo" title="Freiheitsorientierte Poly-Orientierung mit Fokus auf Genuss">Poly Hedo</option>
                            <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                        </select>
                    </div>

                    <!-- Extended Dimensions: ICH -->
                    <div class="dimensions-section">
                        <div class="dimensions-section-title ich-title">Meine Eigenschaften</div>
                        <div class="dimensions-grid">
                            <!-- Geschlecht -->
                            <div class="dimension-group needs-selection" data-dimension="ich-geschlecht">
                                <div class="dimension-label">
                                    Geschlecht
                                    <span class="dimension-info-icon" onclick="showDimensionTooltip('geschlecht')">ℹ</span>
                                </div>
                                <div class="dimension-options">
                                    <input type="radio" name="ich-geschlecht" id="ich-geschlecht-m" value="männlich" class="dimension-radio">
                                    <label for="ich-geschlecht-m" class="dimension-option">männlich</label>

                                    <input type="radio" name="ich-geschlecht" id="ich-geschlecht-w" value="weiblich" class="dimension-radio">
                                    <label for="ich-geschlecht-w" class="dimension-option">weiblich</label>

                                    <input type="radio" name="ich-geschlecht" id="ich-geschlecht-nb" value="non-binär" class="dimension-radio">
                                    <label for="ich-geschlecht-nb" class="dimension-option">non-binär</label>
                                </div>
                            </div>

                            <!-- Dominanz Multi-Select -->
                            <div class="dimension-group needs-selection" data-dimension="modal-ich-dominanz-multi">
                                <div class="dimension-label">
                                    Dominanz
                                    <span class="dimension-info-icon" onclick="showDimensionTooltip('dominanz')">ℹ</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-ich-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('ich', 'dominant', this.checked)">
                                        <label for="modal-ich-d-dom" class="dominanz-label">dominant</label>
                                        <div id="modal-ich-d-dom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('ich', 'dominant', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('ich', 'dominant', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-ich-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('ich', 'submissiv', this.checked)">
                                        <label for="modal-ich-d-sub" class="dominanz-label">submissiv</label>
                                        <div id="modal-ich-d-sub-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('ich', 'submissiv', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('ich', 'submissiv', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-ich-d-sw" value="switch" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('ich', 'switch', this.checked)">
                                        <label for="modal-ich-d-sw" class="dominanz-label">switch</label>
                                        <div id="modal-ich-d-sw-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('ich', 'switch', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('ich', 'switch', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-ich-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('ich', 'ausgeglichen', this.checked)">
                                        <label for="modal-ich-d-aus" class="dominanz-label">ausgeglichen</label>
                                        <div id="modal-ich-d-aus-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('ich', 'ausgeglichen', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('ich', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sexuelle Orientierung -->
                            <div class="dimension-group full-width needs-selection" data-dimension="modal-ich-orientierung-multi">
                                <div class="dimension-label">
                                    Sexuelle Orientierung
                                    <span class="dimension-info-icon" onclick="showDimensionTooltip('orientierung')">ℹ</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-ich-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('ich', 'heterosexuell', this.checked)">
                                        <label for="modal-ich-o-het" class="dominanz-label">heterosexuell</label>
                                        <select id="modal-ich-o-het-status" class="dominanz-status-select" style="display: none;" onchange="handleModalOrientierungStatusChange('ich', 'heterosexuell', this.value)">
                                            <option value="fakt">Fakt</option>
                                            <option value="interessiert">Interessiert</option>
                                        </select>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-ich-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('ich', 'homosexuell', this.checked)">
                                        <label for="modal-ich-o-hom" class="dominanz-label">homosexuell</label>
                                        <select id="modal-ich-o-hom-status" class="dominanz-status-select" style="display: none;" onchange="handleModalOrientierungStatusChange('ich', 'homosexuell', this.value)">
                                            <option value="fakt">Fakt</option>
                                            <option value="interessiert">Interessiert</option>
                                        </select>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-ich-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('ich', 'bisexuell', this.checked)">
                                        <label for="modal-ich-o-bi" class="dominanz-label">bisexuell</label>
                                        <select id="modal-ich-o-bi-status" class="dominanz-status-select" style="display: none;" onchange="handleModalOrientierungStatusChange('ich', 'bisexuell', this.value)">
                                            <option value="fakt">Fakt</option>
                                            <option value="interessiert">Interessiert</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="my-type-header">
                        <div class="my-type-icon" id="myTypeIcon">★</div>
                        <div class="type-tooltip">
                            <div class="my-type-name" id="myTypeName">Single</div>
                            <span class="tooltip-text" id="myTypeTooltip"></span>
                        </div>
                        <span class="type-info-icon" id="myTypeInfoIcon" onclick="openDefinitionModal(currentArchetype)" title="Was bedeutet dieser Typ?">ℹ</span>
                    </div>
                    <p class="my-type-desc" id="myTypeDesc">...</p>

                    <!-- Collapsible: Pro/Contra -->
                    <div class="collapsible" id="proContraCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('proContraCollapse')">
                            <span>Pro & Contra – Qualitätsfaktoren</span>
                            <span class="collapsible-icon">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pro-contra-grid">
                                <div class="mini-list">
                                    <div class="mini-list-title pro">✓ Pro</div>
                                    <ul id="myTypePro"></ul>
                                </div>
                                <div class="mini-list">
                                    <div class="mini-list-title contra">✗ Contra</div>
                                    <ul id="myTypeContra"></ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Collapsible: Pathos/Logos -->
                    <div class="collapsible" id="pathosLogosCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('pathosLogosCollapse')">
                            <span>Pathos & Logos – Dynamische Qualität</span>
                            <span class="collapsible-icon">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pathos-logos-content">
                                <p id="myTypePathos"></p>
                                <p id="myTypeLogos"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Match Section -->
                    <div class="match-section">
                        <div class="match-card top" id="topMatchCard" onclick="openMatchModal('top')">
                            <div class="match-info">
                                <div class="match-dot" id="topMatchDot"></div>
                                <div>
                                    <div class="match-label-text">Top Match</div>
                                    <div class="match-name" id="topMatchName">...</div>
                                </div>
                            </div>
                            <div class="match-score excellent" id="topMatchScore">0%</div>
                        </div>

                        <div class="match-card challenge" id="challengeCard" onclick="openMatchModal('challenge')">
                            <div class="match-info">
                                <div class="match-dot" id="challengeDot"></div>
                                <div>
                                    <div class="match-label-text">Challenge</div>
                                    <div class="match-name" id="challengeName">...</div>
                                </div>
                            </div>
                            <div class="match-score low" id="challengeScore">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 2: BEZIEHUNGSQUALITÄT -->
        <div class="card" data-card="1">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Beziehungsqualität</span>
                </div>
                <div class="card-body">
                    <!-- Partner Selector -->
                    <div class="partner-selector" id="partnerSelector"></div>

                    <!-- Extended Dimensions: PARTNER -->
                    <div class="dimensions-section" style="margin-top: 0; padding-top: 15px; border-top: none;">
                        <div class="dimensions-section-title partner-title">Partner-Eigenschaften</div>
                        <div class="dimensions-grid">
                            <!-- Geschlecht -->
                            <div class="dimension-group needs-selection" data-dimension="partner-geschlecht">
                                <div class="dimension-label">
                                    Geschlecht
                                    <span class="dimension-info-icon" onclick="showDimensionTooltip('geschlecht')">ℹ</span>
                                </div>
                                <div class="dimension-options">
                                    <input type="radio" name="partner-geschlecht" id="partner-geschlecht-m" value="männlich" class="dimension-radio">
                                    <label for="partner-geschlecht-m" class="dimension-option">männlich</label>

                                    <input type="radio" name="partner-geschlecht" id="partner-geschlecht-w" value="weiblich" class="dimension-radio">
                                    <label for="partner-geschlecht-w" class="dimension-option">weiblich</label>

                                    <input type="radio" name="partner-geschlecht" id="partner-geschlecht-nb" value="non-binär" class="dimension-radio">
                                    <label for="partner-geschlecht-nb" class="dimension-option">non-binär</label>
                                </div>
                            </div>

                            <!-- Dominanz Multi-Select -->
                            <div class="dimension-group needs-selection" data-dimension="modal-partner-dominanz-multi">
                                <div class="dimension-label">
                                    Dominanz
                                    <span class="dimension-info-icon" onclick="showDimensionTooltip('dominanz')">ℹ</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-partner-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'dominant', this.checked)">
                                        <label for="modal-partner-d-dom" class="dominanz-label">dominant</label>
                                        <div id="modal-partner-d-dom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('partner', 'dominant', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('partner', 'dominant', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-partner-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'submissiv', this.checked)">
                                        <label for="modal-partner-d-sub" class="dominanz-label">submissiv</label>
                                        <div id="modal-partner-d-sub-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('partner', 'submissiv', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('partner', 'submissiv', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-partner-d-sw" value="switch" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'switch', this.checked)">
                                        <label for="modal-partner-d-sw" class="dominanz-label">switch</label>
                                        <div id="modal-partner-d-sw-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('partner', 'switch', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('partner', 'switch', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-partner-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'ausgeglichen', this.checked)">
                                        <label for="modal-partner-d-aus" class="dominanz-label">ausgeglichen</label>
                                        <div id="modal-partner-d-aus-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-fakt" data-status="fakt" onclick="handleModalDominanzStatusToggle('partner', 'ausgeglichen', 'fakt', this)">Fakt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleModalDominanzStatusToggle('partner', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sexuelle Orientierung -->
                            <div class="dimension-group full-width needs-selection" data-dimension="modal-partner-orientierung-multi">
                                <div class="dimension-label">
                                    Sexuelle Orientierung
                                    <span class="dimension-info-icon" onclick="showDimensionTooltip('orientierung')">ℹ</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(Mehrfachauswahl)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-partner-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'heterosexuell', this.checked)">
                                        <label for="modal-partner-o-het" class="dominanz-label">heterosexuell</label>
                                        <select id="modal-partner-o-het-status" class="dominanz-status-select" style="display: none;" onchange="handleModalOrientierungStatusChange('partner', 'heterosexuell', this.value)">
                                            <option value="fakt">Fakt</option>
                                            <option value="interessiert">Interessiert</option>
                                        </select>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-partner-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'homosexuell', this.checked)">
                                        <label for="modal-partner-o-hom" class="dominanz-label">homosexuell</label>
                                        <select id="modal-partner-o-hom-status" class="dominanz-status-select" style="display: none;" onchange="handleModalOrientierungStatusChange('partner', 'homosexuell', this.value)">
                                            <option value="fakt">Fakt</option>
                                            <option value="interessiert">Interessiert</option>
                                        </select>
                                    </div>
                                    <div class="dominanz-option-row">
                                        <input type="checkbox" id="modal-partner-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'bisexuell', this.checked)">
                                        <label for="modal-partner-o-bi" class="dominanz-label">bisexuell</label>
                                        <select id="modal-partner-o-bi-status" class="dominanz-status-select" style="display: none;" onchange="handleModalOrientierungStatusChange('partner', 'bisexuell', this.value)">
                                            <option value="fakt">Fakt</option>
                                            <option value="interessiert">Interessiert</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Overview Box -->
                    <div class="analysis-overview" id="analysisOverview" onclick="scrollToCard(0)">
                        <div class="analysis-overview-title">
                            <span>🔍</span> Analysiere:
                        </div>
                        <div class="analysis-overview-content" id="analysisOverviewContent">
                            <span class="type-name">Single</span> <span class="dim-info">(?, ?, ?)</span>
                            <span> × </span>
                            <span class="type-name">Duo</span> <span class="dim-info">(?, ?, ?)</span>
                        </div>
                        <span class="analysis-overview-edit">Bearbeiten →</span>
                    </div>

                    <!-- PATHOS BLOCKER (K.O. - replaces entire analysis) -->
                    <div class="pathos-blocker" id="pathosBlocker">
                        <div class="pathos-blocker-header">
                            <span class="pathos-blocker-icon">⛔</span>
                            <span class="pathos-blocker-title">Keine romantische Beziehung möglich</span>
                        </div>
                        <div class="pathos-blocker-reason" id="pathosBlockerReason">
                            Grund: Keine körperliche Anziehung möglich aufgrund der sexuellen Orientierungen
                        </div>
                        <div class="pathos-blocker-persons">
                            <div class="pathos-blocker-person">
                                <span class="pathos-blocker-person-label">ICH:</span>
                                <span id="pathosBlockerPerson1">männlich, heterosexuell (Fakt)</span>
                            </div>
                            <div class="pathos-blocker-person">
                                <span class="pathos-blocker-person-label">PARTNER:</span>
                                <span id="pathosBlockerPerson2">männlich, heterosexuell (Fakt)</span>
                            </div>
                        </div>
                        <div class="pathos-blocker-divider"></div>
                        <div class="pathos-blocker-explanation">
                            <h4>Pathos vs. Logos</h4>
                            <p>Ohne körperliche und emotionale Anziehung (Gefühlsebene) kann keine romantische Beziehung entstehen.</p>
                            <p>Im Gegensatz zu philosophischen Differenzen (Verstandsebene), die durch Kommunikation und Lernen überbrückt werden können, ist sexuelle Orientierung (Gefühlsebene) keine Wahl und nicht veränderbar.</p>
                            <p>Das Tiage-Modell analysiert romantische Beziehungen und ist für diese Konstellation nicht anwendbar.</p>
                        </div>
                        <div class="pathos-blocker-actions">
                            <button class="pathos-blocker-btn pathos-blocker-btn-primary" onclick="scrollToCard(0)">
                                Angaben korrigieren
                            </button>
                            <button class="pathos-blocker-btn pathos-blocker-btn-secondary" onclick="showPathosLogosInfo()">
                                Mehr über Pathos/Logos
                            </button>
                        </div>
                    </div>

                    <!-- LOGOS WARNING (Warning, analysis continues) -->
                    <div class="logos-warning" id="logosWarning" onclick="toggleLogosWarning()">
                        <div class="logos-warning-header">
                            <span class="logos-warning-icon">⚠️</span>
                            <div class="logos-warning-content">
                                <div class="logos-warning-title" id="logosWarningTitle">Verstandsebene-Warnung: Fundamentale philosophische Unterschiede</div>
                                <div class="logos-warning-subtitle" id="logosWarningSubtitle">Beziehungsphilosophie: 25%</div>
                            </div>
                            <span class="logos-warning-toggle">▼</span>
                        </div>
                        <div class="logos-warning-details">
                            <div class="logos-warning-details-inner">
                                <div class="logos-warning-score">
                                    <span class="logos-warning-score-label">Philosophie-Qualität:</span>
                                    <span class="logos-warning-score-value" id="logosWarningScore">25%</span>
                                </div>
                                <p class="logos-warning-text" id="logosWarningText">
                                    Eure Grundüberzeugungen über Beziehungen sind sehr unterschiedlich. Dies erfordert intensive Kommunikation und Kompromissbereitschaft.
                                </p>
                                <div class="logos-warning-positive">
                                    <span class="logos-warning-positive-icon">✓</span>
                                    <span class="logos-warning-positive-text">ABER: Körperliche Anziehung ist vorhanden!</span>
                                </div>
                                <p class="logos-warning-text">Eine Beziehung ist möglich, erfordert aber:</p>
                                <ul class="logos-warning-list">
                                    <li>Intensive Kommunikation</li>
                                    <li>Fundamentale Kompromisse</li>
                                    <li>Gegenseitiges tiefes Verständnis</li>
                                </ul>
                                <div class="logos-warning-quote">
                                    "Gefühl kann Brücken bauen, wo der Verstand Widersprüche sieht - aber es wird nicht leicht."
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PATHOS UNCERTAIN (Exploration phase warning) -->
                    <div class="pathos-uncertain" id="pathosUncertain">
                        <span class="pathos-uncertain-icon">🔄</span>
                        <span class="pathos-uncertain-text" id="pathosUncertainText">
                            Mindestens eine Person ist in der Explorationsphase (Status: "Interessiert"). Die tatsächliche körperliche Anziehung ist noch unklar.
                        </span>
                    </div>

                    <!-- DOUBLE WARNING (Both Pathos uncertain + Logos low) -->
                    <div class="double-warning" id="doubleWarning">
                        <div class="double-warning-header">
                            <span>⚠️</span>
                            <span class="double-warning-title">Doppelte Herausforderung</span>
                        </div>
                        <div class="double-warning-item">
                            <div class="double-warning-item-title">1. Gefühlsebene: Unsichere körperliche Anziehung</div>
                            <div class="double-warning-item-text" id="doubleWarningPathos">
                                Partner: bisexuell (interessiert) → Exploration-Phase
                            </div>
                        </div>
                        <div class="double-warning-item">
                            <div class="double-warning-item-title">2. Verstandsebene: Philosophische Konflikte</div>
                            <div class="double-warning-item-text" id="doubleWarningLogos">
                                Beziehungsphilosophie: 25% → DUO vs. POLYAMOR
                            </div>
                        </div>
                        <p class="logos-warning-text" style="margin-top: 10px; font-size: var(--font-xs);">
                            Sowohl körperliche als auch philosophische Ebene haben Unsicherheiten.
                        </p>
                    </div>

                    <!-- Compatibility Content Wrapper (hidden when pathos blocked) -->
                    <div id="compatibilityContent">

                    <!-- Modifier Summary (shows dimension influences) -->
                    <div class="modifier-summary" id="modifierSummary">
                        <div class="modifier-summary-title">Dimensions-Einflüsse</div>
                        <div id="modifierSummaryContent">
                            <!-- Dynamically filled -->
                        </div>
                    </div>

                    <!-- Radar Chart -->
                    <div class="radar-section">
                        <div class="radar-header">
                            <div>
                                <div class="radar-title">
                                    <span class="type-tooltip"><span id="myTypeNameDisplay">...</span><span class="tooltip-text" id="myTypeTooltipPage3"></span></span>
                                    mit
                                    <span class="type-tooltip"><span id="partnerNameDisplay">...</span><span class="tooltip-text" id="partnerTooltipPage3"></span></span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="radar-score" id="overallScore" style="color: var(--primary);">0%</div>
                                <div class="radar-score-label">Gesamt</div>
                            </div>
                        </div>
                        <svg id="radarChart" viewBox="0 0 280 260"></svg>
                    </div>

                    <!-- Category Bars -->
                    <div class="category-section">
                        <div class="section-title-row">
                            <div class="section-title" style="margin-bottom: 0;">Kategorie-Details</div>
                            <div class="info-icon" onclick="openCategoryModal()">ℹ</div>
                        </div>
                        <div id="categoryBars"></div>
                    </div>

                    <!-- Pro/Contra Analysis -->
                    <div class="analysis-grid">
                        <div class="analysis-section pro">
                            <div class="analysis-title">✓ Was funktioniert</div>
                            <ul class="analysis-list" id="partnerPro"></ul>
                        </div>
                        <div class="analysis-section contra">
                            <div class="analysis-title">✗ Herausforderungen</div>
                            <ul class="analysis-list" id="partnerContra"></ul>
                        </div>
                    </div>
                    </div><!-- End compatibilityContent -->
                </div>
            </div>
        </div>

        <!-- CARD 3: LEGENDE -->
        <div class="card" data-card="2">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Legende</span>
                </div>
                <div class="card-body">
                    <!-- Farbskala -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungsskala</div>
                        <div class="color-scale">
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-excellent"></div>
                                <span class="color-scale-label">Exzellent</span>
                                <span class="color-scale-range">78-100%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-good"></div>
                                <span class="color-scale-label">Gut</span>
                                <span class="color-scale-range">70-77%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-medium"></div>
                                <span class="color-scale-label">Mittel</span>
                                <span class="color-scale-range">60-69%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-low"></div>
                                <span class="color-scale-label">Herausfordernd</span>
                                <span class="color-scale-range">&lt;60%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Kategorien -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungskategorien</div>
                        <div id="legendCategories"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 4: FEEDBACK -->
        <div class="card" data-card="3">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Feedback</span>
                </div>
                <div class="card-body">
                    <!-- Search -->
                    <div class="feedback-search">
                        <input type="text" id="feedbackSearch" placeholder="🔍 Suche nach Name, Titel oder Inhalt..." class="feedback-search-input">
                    </div>

                    <!-- Advanced Filters -->
                    <div class="feedback-advanced-filters">
                        <div class="feedback-filter-row">
                            <label>Kombination:</label>
                            <select id="filterMyType" class="feedback-select">
                                <option value="all">Alle Typen</option>
                            </select>
                            <span class="filter-separator">mit</span>
                            <select id="filterPartnerType" class="feedback-select">
                                <option value="all">Alle Partner</option>
                            </select>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Kategorie:</label>
                            <div class="feedback-category-btns" id="categoryFilterBtns">
                                <button class="cat-filter-btn active" data-cat="all">Alle</button>
                                <button class="cat-filter-btn" data-cat="A" title="Beziehungsphilosophie">A Philosophie</button>
                                <button class="cat-filter-btn" data-cat="B" title="Werte-Alignment">B Werte</button>
                                <button class="cat-filter-btn" data-cat="C" title="Nähe-Distanz">C Nähe</button>
                                <button class="cat-filter-btn" data-cat="D" title="Autonomie">D Autonomie</button>
                                <button class="cat-filter-btn" data-cat="E" title="Kommunikation">E Kommunik.</button>
                                <button class="cat-filter-btn" data-cat="F" title="Soziale Kompatibilität">F Sozial</button>
                                <!-- Hidden for now - can be re-enabled later -->
                                <button class="cat-filter-btn" data-cat="TM" title="Top Match" style="display:none">Top Match</button>
                                <button class="cat-filter-btn" data-cat="CH" title="Challenge" style="display:none">Challenge</button>
                            </div>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Sortieren:</label>
                            <select id="filterSort" class="feedback-select">
                                <option value="newest">Neueste zuerst</option>
                                <option value="oldest">Älteste zuerst</option>
                                <option value="rating">Beste Bewertung</option>
                            </select>
                        </div>
                    </div>

                    <!-- Feedback List -->
                    <div class="feedback-list" id="feedbackList">
                        <div class="feedback-loading">Lade Feedback...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="categoryModal" onclick="closeCategoryModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">Kategorie-Details</span>
                <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal-overlay" id="feedbackModal" onclick="closeFeedbackModal(event)">
        <div class="modal feedback-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title">Feedback geben</span>
                <button class="modal-close" onclick="closeFeedbackModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="feedback-context-id" id="feedbackContextId">S1-SINGLE</div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Name/Kürzel <span class="required">*</span></label>
                    <input type="text" class="feedback-input" id="feedbackName" placeholder="z.B. Max, Anna, M.S." maxlength="20">
                </div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Titel <span class="required">*</span></label>
                    <input type="text" class="feedback-input" id="feedbackTitle" placeholder="Kurze Zusammenfassung" maxlength="50">
                </div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Kommentar</label>
                    <textarea class="feedback-textarea" id="feedbackComment" placeholder="Dein Feedback zu dieser Ansicht..."></textarea>
                </div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Bewertung</label>
                    <div class="star-rating-group">
                        <span class="star-rating-label">Verstand</span>
                        <span style="font-size: 1rem;">😕</span>
                        <div class="star-rating" id="ratingVerstand">
                            <span class="star" data-value="1">★</span>
                            <span class="star" data-value="2">★</span>
                            <span class="star" data-value="3">★</span>
                            <span class="star" data-value="4">★</span>
                            <span class="star" data-value="5">★</span>
                        </div>
                        <span style="font-size: 1rem;">🤩</span>
                    </div>
                    <div class="star-rating-group" style="margin-top: 10px;">
                        <span class="star-rating-label">Gefühl</span>
                        <span style="font-size: 1rem;">😕</span>
                        <div class="star-rating" id="ratingGefuehl">
                            <span class="star" data-value="1">★</span>
                            <span class="star" data-value="2">★</span>
                            <span class="star" data-value="3">★</span>
                            <span class="star" data-value="4">★</span>
                            <span class="star" data-value="5">★</span>
                        </div>
                        <span style="font-size: 1rem;">🤩</span>
                    </div>
                </div>

                <div class="feedback-buttons">
                    <button class="feedback-btn-cancel" onclick="closeFeedbackModal()">Abbrechen</button>
                    <button class="feedback-btn-submit" id="feedbackSubmitBtn" onclick="submitFeedback()">Senden</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Definition Modal -->
    <div class="modal-overlay" id="definitionModal" onclick="closeDefinitionModal(event)">
        <div class="modal definition-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="definitionModalTitle">Typ-Definition</span>
                <button class="modal-close" onclick="closeDefinitionModal()">&times;</button>
            </div>
            <div class="modal-body" id="definitionModalBody"></div>
        </div>
    </div>

    <!-- Dimension Info Tooltip Modal -->
    <div class="dimension-tooltip-overlay" id="dimensionTooltipOverlay" onclick="closeDimensionTooltip()">
        <div class="dimension-tooltip-content" onclick="event.stopPropagation()">
            <div class="dimension-tooltip-title" id="dimensionTooltipTitle">Info</div>
            <div class="dimension-tooltip-text" id="dimensionTooltipText">...</div>
            <button class="dimension-tooltip-close" onclick="closeDimensionTooltip()">Verstanden</button>
        </div>
    </div>

    <!-- Status Selection Popup for Homo/Bi -->
    <div class="dimension-tooltip-overlay" id="statusPopupOverlay" onclick="closeStatusPopup()">
        <div class="dimension-tooltip-content status-popup-content" onclick="event.stopPropagation()">
            <div class="dimension-tooltip-title">Orientierungs-Status</div>
            <div class="dimension-tooltip-text" style="margin-bottom: 20px;">
                Wie sicher bist du dir bei dieser Orientierung?
            </div>
            <div class="status-popup-options">
                <button class="status-popup-btn" id="statusPopupFakt" onclick="selectStatusFromPopup('fakt')">
                    <span class="status-popup-btn-title">Fakt</span>
                    <span class="status-popup-btn-desc">Du lebst diese Orientierung und bist dir sicher.</span>
                </button>
                <button class="status-popup-btn interessiert" id="statusPopupInteressiert" onclick="selectStatusFromPopup('interessiert')">
                    <span class="status-popup-btn-title">Interessiert</span>
                    <span class="status-popup-btn-desc">Du bist neugierig oder in einer Explorationsphase. Die tatsächliche Anziehung ist noch unklar.</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Dominanz-Status Selection Popup -->
    <div class="dimension-tooltip-overlay" id="dominanzStatusPopupOverlay" onclick="closeDominanzStatusPopup()">
        <div class="dimension-tooltip-content status-popup-content" onclick="event.stopPropagation()">
            <div class="dimension-tooltip-title">Dominanz-Status</div>
            <div class="dimension-tooltip-text" style="margin-bottom: 20px;">
                Wie sicher bist du dir bei deiner Dominanz-Präferenz?
            </div>
            <div class="status-popup-options">
                <button class="status-popup-btn" id="dominanzStatusPopupFakt" onclick="selectDominanzStatusFromPopup('fakt')">
                    <span class="status-popup-btn-title">Fakt</span>
                    <span class="status-popup-btn-desc">Du kennst und lebst deine Dominanz-Präferenz aktiv. Die Profilaussagen haben hohe Konfidenz.</span>
                </button>
                <button class="status-popup-btn interessiert" id="dominanzStatusPopupInteressiert" onclick="selectDominanzStatusFromPopup('interessiert')">
                    <span class="status-popup-btn-title">Interessiert</span>
                    <span class="status-popup-btn-desc">Du bist noch am Erkunden oder unsicher. Die Konfidenz der Profilaussagen ist reduziert (höhere Varianz).</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Dots with Arrows (hidden - old carousel nav) -->
    <div class="nav-dots" style="display: none;">
        <button class="nav-arrow" onclick="navigatePrev()">‹</button>
        <div class="nav-dot active" data-card="0" onclick="scrollToCard(0)"></div>
        <div class="nav-dot" data-card="1" onclick="scrollToCard(1)"></div>
        <div class="nav-dot" data-card="2" onclick="scrollToCard(2)"></div>
        <div class="nav-dot" data-card="3" onclick="scrollToCard(3)"></div>
        <button class="nav-arrow" onclick="navigateNext()">›</button>
    </div>

    <div class="swipe-hint" style="display: none;">← Swipe →</div>

    <!-- Footer with Impressum -->
    <footer class="app-footer">
        <!-- JOYclub Siegel -->
        <div style="margin-bottom: 15px;">
            <a href="https://www.joyclub.de/" target="_blank" rel="noopener">
                <img src="//cfnimg.joyclub.de/partner/joyclub_backlink_mitglied_120x120.png" width="120" height="120" alt="Lebe deine Lust!" style="border-radius: 50%;" />
            </a>
        </div>
        <div style="margin-bottom: 10px;">© 2025 Ti-Age – Alle Rechte vorbehalten</div>
        <div style="margin-bottom: 10px; font-size: 11px; opacity: 0.7;">Version 1.3.0</div>
        <a href="#" onclick="document.getElementById('impressumModal').classList.add('active'); return false;">Impressum</a>
        <span>|</span>
        <a href="datenschutz.html">Datenschutz</a>
        <span>|</span>
        <a href="nutzungsbedingungen.html">Nutzungsbedingungen</a>
    </footer>

    <!-- Impressum Modal -->
    <div class="impressum-modal" id="impressumModal" onclick="this.classList.remove('active')">
        <div class="impressum-content" onclick="event.stopPropagation()">
            <h3>Impressum</h3>
            <p><strong>Betreiber:</strong> Ti-Age</p>
            <p><strong>Projekt:</strong> Ti-age</p>
            <p><strong>Kontakt:</strong> <a href="mailto:nerd@ti-age.de">nerd@ti-age.de</a></p>
            <button class="impressum-close" onclick="document.getElementById('impressumModal').classList.remove('active')">Schließen</button>
        </div>
    </div>

    <script>
        let data = null;
        let currentArchetype = 'single';
        let selectedPartner = 'duo';

        // Extended Person Dimensions (null = not yet selected)
        // dominanz and orientierung are now objects with status per preference (multi-select)
        const personDimensions = {
            ich: {
                geschlecht: null,
                dominanz: {
                    dominant: null,      // null, 'fakt', oder 'interessiert'
                    submissiv: null,
                    switch: null,
                    ausgeglichen: null
                },
                orientierung: {
                    heterosexuell: null, // null, 'fakt', oder 'interessiert'
                    homosexuell: null,
                    bisexuell: null
                }
            },
            partner: {
                geschlecht: null,
                dominanz: {
                    dominant: null,
                    submissiv: null,
                    switch: null,
                    ausgeglichen: null
                },
                orientierung: {
                    heterosexuell: null,
                    homosexuell: null,
                    bisexuell: null
                }
            }
        };

        // Dimension tooltip content
        const dimensionTooltips = {
            geschlecht: {
                title: "Geschlecht",
                text: "Dein Geschlecht. Dies beeinflusst die körperliche Anziehung zusammen mit der sexuellen Orientierung."
            },
            dominanz: {
                title: "Dominanz-Präferenz",
                text: "Welche Rolle bevorzugst du in der emotionalen und praktischen Beziehungsdynamik?\n\n• Dominant: Du übernimmst gerne Führung und Verantwortung\n• Submissiv: Du lässt dich gerne führen und vertraust auf deinen Partner\n• Switch: Du genießt beide Rollen je nach Situation\n• Ausgeglichen: Du bevorzugst eine gleichberechtigte Dynamik ohne feste Rollen\n\nDie Dominanz-Harmonie beeinflusst die energetische Dynamik einer Beziehung. Komplementäre Präferenzen (z.B. dominant + submissiv) können starke Anziehung erzeugen."
            },
            orientierung: {
                title: "Sexuelle Orientierung",
                text: "Zu welchem Geschlecht fühlst du dich romantisch und/oder sexuell hingezogen?\n\n• Heterosexuell: Anziehung zum anderen Geschlecht\n• Homosexuell: Anziehung zum gleichen Geschlecht\n• Bisexuell: Anziehung zu beiden Geschlechtern\n\nDie sexuelle Orientierung beeinflusst, ob eine körperliche/romantische Anziehung zwischen zwei Personen möglich ist. Bei inkompatiblen Orientierungen zeigt das Modell dies als Blocker an."
            },
            status: {
                title: "Orientierungs-Status",
                text: "Fakt: Du lebst diese Orientierung und bist dir sicher.\n\nInteressiert: Du bist neugierig oder in einer Explorationsphase. Die tatsächliche Anziehung ist noch unklar."
            },
            dominanzStatus: {
                title: "Dominanz-Status",
                text: "Fakt: Du kennst deine Dominanz-Präferenz und lebst sie aktiv. Die Werte des psychologischen Profils treffen mit hoher Wahrscheinlichkeit zu.\n\nInteressiert: Du bist noch am Erkunden oder unsicher über deine Präferenz. Die Konfidenz der Profilaussagen ist reduziert (höhere Varianz in deinem Verhalten).\n\nWissenschaftliche Basis: Big Five Forschung zeigt, dass Menschen in Explorationsphasen konsistent höhere Verhaltensvarianzen aufweisen (McCrae & Costa, 1997)."
            }
        };

        const icons = {
            single: '★',
            duo: '♡',
            duo_flex: '⚡',
            solopoly: '◆',
            poly_hedo: '☀',
            polyamor: '♥'
        };

        const categoryNames = {
            A: 'Beziehungsphilosophie',
            B: 'Werte-Alignment',
            C: 'Nähe-Distanz',
            D: 'Autonomie',
            E: 'Kommunikation',
            F: 'Soziale Kompatibilität'
        };

        // ═══════════════════════════════════════════════════════════════════════
        // MICRO-STATEMENTS DATABASE für dynamische Text-Generierung
        // Philosophische Grundlage: Pirsig (MOQ) + OSHO
        // ═══════════════════════════════════════════════════════════════════════

        const archetypeStatements = {
            "single_single": {
                pathos: {
                    gemeinsam: ["Zwei Seelen, die dieselbe Sprache der Freiheit sprechen.", "Die gegenseitige Anerkennung der Unabhängigkeit schafft Respekt."],
                    spannung: ["Ohne Polarität fehlt die magnetische Kraft der Anziehung.", "Die Freiheit wird zum Gefängnis, wenn niemand sie herausfordert."]
                },
                logos: {
                    gemeinsam: ["Strukturell identisch: Beide priorisieren Autonomie über Bindung.", "Keine fundamentalen Konflikte, da keine fundamentalen Erwartungen."],
                    unterschied: ["Individuelle Unterschiede in Lebensphasen können variieren."]
                },
                pro: ["Identische Beziehungsphilosophie", "Gegenseitiger Respekt für Autonomie", "Keine unerfüllbaren Erwartungen", "Freiheit bleibt erhalten"],
                contra: ["Fehlende Polarität", "Keiner gibt Impuls zur Vertiefung", "Risiko der Unverbindlichkeit"]
            },
            "single_duo": {
                pathos: {
                    gemeinsam: ["Der Single spürt die Wärme der Geborgenheit, die das Duo bietet."],
                    spannung: ["Die Angst vor Vereinnahmung trifft auf das Bedürfnis nach Verschmelzung.", "Freiheitsdrang kollidiert mit Exklusivitätserwartung."]
                },
                logos: {
                    unterschied: ["Fundamentaler Konflikt: Unabhängigkeit vs. Exklusivität", "Single sieht Beziehung als Option, Duo als Notwendigkeit."]
                },
                pro: ["Duo bietet Stabilität", "Potenzial für transformative Erfahrung"],
                contra: ["Fundamentaler Konflikt: Freiheit vs. Exklusivität", "Single fühlt sich eingeengt", "Duo fühlt sich nicht priorisiert", "Keine gemeinsame Beziehungsvision"]
            },
            "single_duo_flex": {
                pathos: {
                    gemeinsam: ["Duo-Flex versteht die Sehnsucht nach Freiheit – zumindest teilweise."],
                    spannung: ["Die 'Flex'-Komponente reicht dem Single oft nicht aus.", "Single kann sich als 'der Außenseiter' fühlen."]
                },
                logos: {
                    gemeinsam: ["Duo-Flex zeigt Offenheit für alternative Modelle."],
                    unterschied: ["Single will keine Hierarchie, Duo-Flex hat eine eingebaute."]
                },
                pro: ["Situative Nähe möglich", "Keine Erwartung an vollständige Bindung"],
                contra: ["Single ist strukturell 'zweite Wahl'", "Primärbeziehung hat immer Vorrang", "Emotionale Asymmetrie"]
            },
            "single_solopoly": {
                pathos: {
                    gemeinsam: ["Tiefe Resonanz auf der Ebene der Autonomie.", "Beide schätzen Freiheit als höchsten Wert."],
                    spannung: ["Solopoly erwartet Beziehungsarbeit, die der Single meidet."]
                },
                logos: {
                    gemeinsam: ["Beide lehnen traditionelle Beziehungsmodelle ab.", "Autonomie ist das gemeinsame Fundament."],
                    unterschied: ["Solopoly hat multiple Beziehungen, Single oft keine."]
                },
                pro: ["Maximale Übereinstimmung in Autonomie", "Keine Hierarchie-Problematik", "Beziehung als Bereicherung"],
                contra: ["Single könnte von Aktivität überfordert sein", "Asymmetrische Beziehungsbereitschaft"]
            },
            "single_poly_hedo": {
                pathos: {
                    gemeinsam: ["Beide feiern den Moment, nicht die Ewigkeit.", "Freiheit und Spontaneität verbinden."],
                    spannung: ["Poly Hedo's Intensität kann überfordern."]
                },
                logos: {
                    gemeinsam: ["Beide lehnen starre Strukturen ab."],
                    unterschied: ["Unterschiedliche Energielevel."]
                },
                pro: ["Gemeinsame Wertschätzung von Freiheit", "Potenzial für intensive Begegnungen"],
                contra: ["Unterschiedliche Energielevel", "Single sucht oft Ruhe, Poly Hedo Stimulation"]
            },
            "single_polyamor": {
                pathos: {
                    gemeinsam: ["Single spürt die Wärme der polyamoren Community."],
                    spannung: ["Die strukturierte Komplexität überfordert den Single."]
                },
                logos: {
                    unterschied: ["Polyamor ist hochstrukturiert, Single sucht Einfachheit.", "Kommunikationsintensität radikal unterschiedlich."]
                },
                pro: ["Keine Exklusivitätserwartung", "Community kann bereichernd sein"],
                contra: ["Hoher Kommunikationsaufwand überfordert", "Kalendermanagement unattraktiv"]
            },
            "duo_single": {
                pathos: {
                    spannung: ["Die Angst, nicht genug zu sein für jemanden, der alles haben kann.", "Der Wunsch nach Exklusivität trifft auf Mauern."]
                },
                logos: {
                    unterschied: ["Fundamentale Inkompatibilität der Beziehungsmodelle.", "Duo braucht Commitment, Single meidet es."]
                },
                pro: ["Potenzial für transformative Erfahrung"],
                contra: ["Duo investiert mehr als zurückkommt", "Single erwidert Exklusivität nicht", "Herzschmerz vorprogrammiert"]
            },
            "duo_duo": {
                pathos: {
                    gemeinsam: ["Zwei Seelen, die dasselbe suchen: Ankommen, Verschmelzen, Heimat.", "Exklusivität als gemeinsame Sprache der Liebe."],
                    spannung: ["Hohe Erwartungen können zu hohem Druck führen."]
                },
                logos: {
                    gemeinsam: ["Strukturell perfekt abgestimmt.", "Gesellschaftlich maximal unterstützt.", "Gemeinsame Lebensplanung ist selbstverständlich."]
                },
                pro: ["Identische Beziehungsphilosophie", "Maximale gesellschaftliche Akzeptanz", "Klare, geteilte Erwartungen", "Rechtliche Absicherung möglich"],
                contra: ["Hohe Erwartungen können zu Druck führen", "Eine Person muss alle Bedürfnisse erfüllen"]
            },
            "duo_duo_flex": {
                pathos: {
                    gemeinsam: ["Das Duo erkennt im Duo-Flex einen nahen Verwandten."],
                    spannung: ["Die 'Flex'-Komponente verunsichert das Duo.", "Duo fürchtet: 'Bin ich nicht genug?'"]
                },
                logos: {
                    gemeinsam: ["Beide priorisieren eine Primärbeziehung."],
                    unterschied: ["Die 'Flex'-Option ist für das Duo ein No-Go."]
                },
                pro: ["Grundverständnis für Primärbeziehungs-Priorität", "Ähnliche Vorstellungen von Stabilität"],
                contra: ["Duo erlebt Flex-Öffnung als Vertrauensbruch", "Unterschiedliche Treue-Definitionen", "Eifersucht vorprogrammiert"]
            },
            "duo_solopoly": {
                pathos: {
                    spannung: ["Das Duo fühlt sich als Option, nicht als Priorität.", "Tiefe Verunsicherung durch Gleichwertigkeit anderer Beziehungen."]
                },
                logos: {
                    unterschied: ["Fundamentale Inkompatibilität: Exklusivität vs. Gleichwertigkeit.", "Zusammenleben ist für Solopoly ausgeschlossen."]
                },
                pro: ["Solopoly bietet klare Kommunikation"],
                contra: ["Duo fühlt sich als 'einer von vielen'", "Keine Sonderstellung möglich", "Kein Zusammenleben möglich"]
            },
            "duo_poly_hedo": {
                pathos: {
                    spannung: ["Das Duo fühlt sich unsichtbar im hedonistischen Wirbel.", "Die Spontaneität wirkt chaotisch und beängstigend."]
                },
                logos: {
                    unterschied: ["Maximal unterschiedliche Beziehungsphilosophien.", "Duo sucht Struktur, Poly Hedo flieht sie."]
                },
                pro: ["Potenzial für Horizonterweiterung"],
                contra: ["Fundamentale Unvereinbarkeit", "Duo sucht Tiefe, Poly Hedo Breite", "Völlig unterschiedliche Lebensrhythmen"]
            },
            "duo_polyamor": {
                pathos: {
                    gemeinsam: ["Beide schätzen tiefe emotionale Verbindungen."],
                    spannung: ["Das Duo kann die geteilte Aufmerksamkeit nicht ertragen."]
                },
                logos: {
                    gemeinsam: ["Beide schätzen Kommunikation und Verbindlichkeit."],
                    unterschied: ["Exklusivität vs. ethische Nicht-Exklusivität."]
                },
                pro: ["Beide schätzen emotionale Tiefe", "Kommunikation ist beiden wichtig"],
                contra: ["Duo erlebt geteilte Aufmerksamkeit als Verrat", "Eifersucht unvermeidlich"]
            },
            "duo_flex_single": {
                pathos: {
                    gemeinsam: ["Duo-Flex erkennt im Single den Freiheitsdrang."],
                    spannung: ["Single könnte die Primärbeziehung bedrohen."]
                },
                logos: {
                    gemeinsam: ["Beide haben ein gewisses Maß an Flexibilität."],
                    unterschied: ["Single will keine zweite Wahl sein."]
                },
                pro: ["Gemeinsames Verständnis für Flexibilität", "Single kann bereichernde Begegnungen bieten"],
                contra: ["Single könnte mehr wollen", "Hierarchie-Problem", "Single fühlt sich als 'Spielzeug'"]
            },
            "duo_flex_duo": {
                pathos: {
                    gemeinsam: ["Grundverständnis für die Wichtigkeit einer Primärbeziehung."],
                    spannung: ["Duo kann die Flex-Öffnung nicht akzeptieren."]
                },
                logos: {
                    gemeinsam: ["Ähnliche Strukturen mit einer Hauptbeziehung."],
                    unterschied: ["Was für Duo-Flex 'Flexibilität' ist, ist für Duo 'Betrug'."]
                },
                pro: ["Gemeinsame Wertschätzung von Primärbeziehungen", "Duo-Flex könnte exklusiver werden"],
                contra: ["Duo erlebt Flex-Anteil als Vertrauensbruch", "Konstantes Konfliktpotenzial"]
            },
            "duo_flex_duo_flex": {
                pathos: {
                    gemeinsam: ["Perfekte Resonanz: Beide verstehen den Balanceakt.", "Die Suche nach dem Besten aus beiden Welten verbindet."],
                    spannung: ["Konkurrenz um Flex-Partner kann entstehen."]
                },
                logos: {
                    gemeinsam: ["Identische Struktur: Primärbeziehung + situative Öffnung.", "Gemeinsames Regelwerk ist verhandelbar."]
                },
                pro: ["Identische Beziehungsphilosophie", "Gegenseitiges Verständnis für Öffnungen", "Symmetrische Freiheiten"],
                contra: ["Eifersucht kann trotzdem auftreten", "Flex-Regeln müssen ständig verhandelt werden"]
            },
            "duo_flex_solopoly": {
                pathos: {
                    gemeinsam: ["Beide schätzen Flexibilität und Offenheit."],
                    spannung: ["Solopoly lehnt Hierarchien ab, Duo-Flex basiert darauf."]
                },
                logos: {
                    unterschied: ["Hierarchie vs. Gleichwertigkeit ist der Kernkonflikt."]
                },
                pro: ["Gemeinsame Offenheit für nicht-exklusive Beziehungen", "Kommunikation über Grenzen ist beiden vertraut"],
                contra: ["Solopoly gibt keinen Primary-Status", "Duo-Flex will mehr Sicherheit als Solopoly bietet"]
            },
            "duo_flex_poly_hedo": {
                pathos: {
                    gemeinsam: ["Beide genießen Vielfalt in Beziehungen."],
                    spannung: ["Poly Hedo's Spontaneität überfordert Duo-Flex's Regelwerk."]
                },
                logos: {
                    unterschied: ["Strukturierte Öffnung vs. spontane Freiheit."]
                },
                pro: ["Gemeinsame Wertschätzung von Vielfalt", "Beide sind offen für Experimente"],
                contra: ["Strukturkonflikt ist fundamental", "Duo-Flex braucht Planung, Poly Hedo hasst sie"]
            },
            "duo_flex_polyamor": {
                pathos: {
                    gemeinsam: ["Beide kennen die Komplexität von Mehrfachbeziehungen."],
                    spannung: ["Unterschiedliche Tiefe der Nicht-Primär-Beziehungen."]
                },
                logos: {
                    gemeinsam: ["Beide arbeiten mit Regeln und Absprachen."],
                    unterschied: ["Polyamor's Secondary-Beziehungen sind tiefer als Duo-Flex's Flex-Kontakte."]
                },
                pro: ["Gemeinsame Wertschätzung von Kommunikation und Struktur", "Regeln und Grenzen sind beiden vertraut"],
                contra: ["Unterschiedliche Tiefe der Nebenbeziehungen", "Zeitmanagement ist herausfordernd"]
            },
            "solopoly_single": {
                pathos: {
                    gemeinsam: ["Tiefe Verwandtschaft im Autonomie-Bedürfnis.", "Beide verstehen: 'Ich gehöre mir selbst.'"],
                    spannung: ["Solopoly erwartet Beziehungsarbeit, die der Single meidet."]
                },
                logos: {
                    gemeinsam: ["Beide priorisieren Selbstständigkeit über Verschmelzung."],
                    unterschied: ["Solopoly führt aktiv Beziehungen, Single nicht unbedingt."]
                },
                pro: ["Maximale Übereinstimmung bei Autonomie", "Keine Verschmelzungserwartung"],
                contra: ["Single könnte Aktivität nicht erwidern", "Asymmetrische Beziehungsbereitschaft"]
            },
            "solopoly_duo": {
                pathos: {
                    spannung: ["Duo's Exklusivitätsbedürfnis kollidiert mit Solopoly's Lebensmodell.", "Das Duo wird immer mehr wollen."]
                },
                logos: {
                    unterschied: ["Fundamentale Inkompatibilität der Beziehungsmodelle.", "Zusammenleben ist für Solopoly ausgeschlossen."]
                },
                pro: ["Duo könnte von Solopoly's Klarheit lernen"],
                contra: ["Strukturelle Inkompatibilität", "Duo erwartet Exklusivität", "Herzschmerz wahrscheinlich"]
            },
            "solopoly_duo_flex": {
                pathos: {
                    gemeinsam: ["Beide kennen nicht-exklusive Beziehungen."],
                    spannung: ["Duo-Flex erwartet Hierarchie, Solopoly gibt keine."]
                },
                logos: {
                    unterschied: ["Hierarchie vs. Gleichwertigkeit."]
                },
                pro: ["Gemeinsame Erfahrung mit nicht-exklusiven Beziehungen", "Potenzial für bereichernde Verbindung"],
                contra: ["Duo-Flex erwartet Sonderstellung, die Solopoly nicht gibt"]
            },
            "solopoly_solopoly": {
                pathos: {
                    gemeinsam: ["Perfekte Spiegelung: Beide verstehen zutiefst, was der andere braucht.", "Freiheit als höchster Wert – geteilt und respektiert.", "Liebe als Geschenk, nicht als Forderung."],
                    spannung: ["Beide sind so autonom, dass manchmal niemand Initiative ergreift."]
                },
                logos: {
                    gemeinsam: ["Identische Beziehungsphilosophie.", "Keine Hierarchie-Diskussionen nötig."]
                },
                pro: ["Maximale philosophische Übereinstimmung", "Gegenseitiger Respekt für Autonomie", "Keine Hierarchie-Konflikte"],
                contra: ["Manchmal fehlt Initiative für Vertiefung", "Zu viel Distanz möglich"]
            },
            "solopoly_poly_hedo": {
                pathos: {
                    gemeinsam: ["Beide feiern Vielfalt und Freiheit."],
                    spannung: ["Solopoly's bewusste Struktur vs. Poly Hedo's Spontaneität."]
                },
                logos: {
                    unterschied: ["Unterschiedliche Tiefe der Reflexion."]
                },
                pro: ["Gemeinsame Wertschätzung von Freiheit und Vielfalt", "Keine Eifersuchtsprobleme erwartet"],
                contra: ["Unterschiedliche Tiefe der Beziehungen", "Solopoly könnte Poly Hedo als oberflächlich empfinden"]
            },
            "solopoly_polyamor": {
                pathos: {
                    gemeinsam: ["Beide teilen polyamore Werte: Ehrlichkeit, Kommunikation, Consent."],
                    spannung: ["Hierarchie-Differenzen können belasten."]
                },
                logos: {
                    gemeinsam: ["Beide reflektieren bewusst über ihre Beziehungsform."],
                    unterschied: ["Solopoly lehnt Hierarchien ab, Polyamor hat oft Primary/Secondary."]
                },
                pro: ["Gemeinsame polyamore Grundwerte", "Hohe Kommunikationskompetenz beiderseits"],
                contra: ["Hierarchie-Diskussionen unvermeidlich", "Solopoly will keine Primary-Position"]
            },
            "poly_hedo_single": {
                pathos: {
                    gemeinsam: ["Beide feiern die Freiheit des Moments."],
                    spannung: ["Single sucht oft Ruhe, Poly Hedo sucht Stimulation."]
                },
                logos: {
                    gemeinsam: ["Beide lehnen starre Strukturen ab."],
                    unterschied: ["Unterschiedliche Energielevel und Aktivität."]
                },
                pro: ["Gemeinsame Wertschätzung von Freiheit", "Potenzial für unverbindliche Begegnungen"],
                contra: ["Energielevel-Unterschiede können ermüden", "Single könnte als 'langweilig' wahrgenommen werden"]
            },
            "poly_hedo_duo": {
                pathos: {
                    spannung: ["Duo's Erwartungen an Tiefe sind für Poly Hedo einengend.", "Duo wird als 'zu ernst' empfunden."]
                },
                logos: {
                    unterschied: ["Fundamentale Inkompatibilität.", "Poly Hedo flieht Struktur, Duo braucht sie."]
                },
                pro: ["Potenzial für Horizonterweiterung"],
                contra: ["Fundamentale Lebensphilosophie-Konflikte", "Duo's Exklusivität ist ein Käfig", "Völlig unterschiedliche Welten"]
            },
            "poly_hedo_duo_flex": {
                pathos: {
                    gemeinsam: ["Gemeinsame Offenheit für Vielfalt."],
                    spannung: ["Duo-Flex's Regeln sind für Poly Hedo einengend."]
                },
                logos: {
                    unterschied: ["Struktur vs. Spontaneität."]
                },
                pro: ["Gemeinsame Offenheit für nicht-exklusive Begegnungen"],
                contra: ["Poly Hedo hasst Regelwerk", "Spontaneität wird durch Absprachen gebremst"]
            },
            "poly_hedo_solopoly": {
                pathos: {
                    gemeinsam: ["Beide feiern Freiheit und Vielfalt."],
                    spannung: ["Solopoly's Planung vs. Poly Hedo's Spontaneität."]
                },
                logos: {
                    unterschied: ["Unterschiedliche Reflexionstiefe."]
                },
                pro: ["Gemeinsame Wertschätzung von Freiheit", "Beide offen für multiple Verbindungen"],
                contra: ["Tiefe der Beziehung kann unterschiedlich sein", "Solopoly's Kommunikationsbedürfnis kann überfordern"]
            },
            "poly_hedo_poly_hedo": {
                pathos: {
                    gemeinsam: ["Perfekte Resonanz: Beide leben im Moment.", "Spontaneität trifft auf Spontaneität.", "Ekstase und Lebensfreude werden geteilt."],
                    spannung: ["Manchmal fehlt Tiefe für langfristige Bindung."]
                },
                logos: {
                    gemeinsam: ["Identische Lebensphilosophie: Genuss und Freiheit."]
                },
                pro: ["Maximale philosophische Übereinstimmung", "Gemeinsame Lebensfreude", "Spontane, intensive Erlebnisse"],
                contra: ["Langfristige Tiefe kann fehlen", "Potenzial für Oberflächlichkeit"]
            },
            "poly_hedo_polyamor": {
                pathos: {
                    gemeinsam: ["Beide teilen Offenheit für multiple Verbindungen."],
                    spannung: ["Polyamor's Struktur wirkt wie ein Gefängnis.", "Die Kalenderverwaltung ist unerträglich."]
                },
                logos: {
                    unterschied: ["Strukturiert vs. spontan.", "Polyamor braucht Regeln, Poly Hedo flieht sie."]
                },
                pro: ["Gemeinsame Offenheit für Polyamorie"],
                contra: ["Fundamentaler Strukturkonflikt", "Poly Hedo erlebt Polyamor als zu ernst", "Kalendermanagement unmöglich"]
            },
            "polyamor_single": {
                pathos: {
                    gemeinsam: ["Polyamor kann dem Single Wärme bieten ohne Exklusivitätsdruck."],
                    spannung: ["Single meidet die Komplexität, die Polyamor mitbringt."]
                },
                logos: {
                    unterschied: ["Polyamor ist hochstrukturiert, Single sucht Einfachheit."]
                },
                pro: ["Keine Exklusivitätserwartung", "Community kann unterstützend sein"],
                contra: ["Single wird von Kommunikationsintensität überfordert", "Polyamor's Struktur ist zu viel"]
            },
            "polyamor_duo": {
                pathos: {
                    gemeinsam: ["Beide schätzen tiefe emotionale Verbindungen."],
                    spannung: ["Duo's Eifersucht ist für Polyamor frustrierend."]
                },
                logos: {
                    unterschied: ["Exklusivität vs. ethische Mehrfachbeziehungen."]
                },
                pro: ["Beide schätzen emotionale Tiefe", "Duo könnte als Primary Sicherheit finden"],
                contra: ["Duo kann Nicht-Exklusivität nicht akzeptieren", "Eifersucht unvermeidlich"]
            },
            "polyamor_duo_flex": {
                pathos: {
                    gemeinsam: ["Beide kennen die Komplexität von Mehrfachbeziehungen."],
                    spannung: ["Tiefe der Nebenbeziehungen unterscheidet sich."]
                },
                logos: {
                    gemeinsam: ["Beide arbeiten mit Regeln und Strukturen."]
                },
                pro: ["Gemeinsames Verständnis für strukturierte Offenheit", "Potenzial für komplementäre Verbindung"],
                contra: ["Tiefe-Unterschiede der Nebenbeziehungen", "Unterschiedliche Zeit-Investments"]
            },
            "polyamor_solopoly": {
                pathos: {
                    gemeinsam: ["Tiefe Verwandtschaft in polyamoren Werten."],
                    spannung: ["Solopoly lehnt ab, was Polyamor praktiziert: Primary/Secondary."]
                },
                logos: {
                    gemeinsam: ["Beide reflektieren bewusst über Beziehungsformen."],
                    unterschied: ["Hierarchie vs. Gleichwertigkeit."]
                },
                pro: ["Gemeinsame polyamore Grundwerte", "Ethische Grundlage ist identisch"],
                contra: ["Hierarchie-Diskussionen unvermeidlich", "Strukturkonflikte möglich"]
            },
            "polyamor_poly_hedo": {
                pathos: {
                    spannung: ["Polyamor erlebt Poly Hedo als zu oberflächlich.", "Die fehlende Struktur ist chaotisch."]
                },
                logos: {
                    unterschied: ["Maximaler Strukturkonflikt.", "Polyamor ist hochorganisiert, Poly Hedo spontan."]
                },
                pro: ["Gemeinsame Offenheit für multiple Verbindungen"],
                contra: ["Fundamentaler Strukturkonflikt", "Polyamor braucht Planung, Poly Hedo meidet sie", "Unterschiedliche Erwartungen an Tiefe"]
            },
            "polyamor_polyamor": {
                pathos: {
                    gemeinsam: ["Perfekte Resonanz: Beide sprechen dieselbe Sprache der Liebe.", "Tiefe Liebe zu Mehreren ist natürlich und verstanden.", "Compersion ist beidseitig möglich."],
                    spannung: ["Manchmal Überforderung durch die vielen emotionalen Fäden."]
                },
                logos: {
                    gemeinsam: ["Identische Beziehungsphilosophie.", "Beide verstehen Hierarchien, Agreements, Kommunikationsstrukturen."]
                },
                pro: ["Maximale philosophische Übereinstimmung", "Identisches Beziehungsmodell", "Compersion beiderseits möglich", "Keine Erklärungen nötig"],
                contra: ["Hoher Koordinationsaufwand", "Kalenderkomplexität verdoppelt sich", "Viele emotionale Fäden"]
            }
        };

        const dominanceStatements = {
            "dominant_submissiv": { score: 100, pathos: ["Die perfekte Polarität: Führung trifft auf Hingabe.", "OSHO's Weisheit manifestiert sich hier – Extreme ziehen sich an.", "Eine magnetische Kraft entsteht aus der Gegensätzlichkeit."], logos: ["Komplementarität führt zu höherer Sympathie (Tiedens & Fragale, 2003).", "Klare Rollenverteilung minimiert Entscheidungskonflikte."], pro: ["Optimale Rollenverteilung", "Natürliche Dynamik", "Hohe gegenseitige Anziehung", "Wissenschaftlich belegte höhere Zufriedenheit"], contra: ["Balance muss bewusst gehalten werden"] },
            "submissiv_dominant": { score: 100, pathos: ["Hingabe trifft auf Führung – eine tiefe Resonanz.", "Das Vertrauen, sich führen zu lassen, schafft Intimität."], logos: ["Komplementäre Dynamik ist strukturell am stabilsten."], pro: ["Natürliche Harmonie", "Klare Rollenverteilung", "Tiefes Vertrauen möglich"], contra: ["Abhängigkeitsdynamiken müssen reflektiert werden"] },
            "ausgeglichen_ausgeglichen": { score: 95, pathos: ["Zwei Seelen in Balance – ein stiller Tanz der Gleichheit.", "Harmonie durch gemeinsame Mitte."], logos: ["Flexible Dynamik ohne starre Hierarchie.", "Entscheidungen werden gemeinsam getroffen."], pro: ["Gleichberechtigte Partnerschaft", "Flexible Rollenverteilung", "Keine Machtkämpfe erwartet", "Stabile Grunddynamik"], contra: ["Manchmal fehlt klare Führung", "Weniger 'Feuer' durch fehlende Polarität"] },
            "switch_switch": { score: 90, pathos: ["Spielerische Dynamik – heute führst du, morgen ich.", "Die Freude am Rollenwechsel verbindet."], logos: ["Hohe Anpassungsfähigkeit auf beiden Seiten."], pro: ["Vielfalt in der Dynamik", "Gegenseitiges Verständnis für Rollenwechsel", "Hohe Flexibilität"], contra: ["Manchmal unklar, wer gerade führt", "Koordination nötig"] },
            "switch_ausgeglichen": { score: 88, pathos: ["Flexibilität trifft auf Balance."], logos: ["Switch kann sich an die Balance anpassen."], pro: ["Hohe Anpassungsfähigkeit", "Ausgeglichener bietet Stabilität"], contra: ["Switch könnte manchmal mehr Polarität vermissen"] },
            "ausgeglichen_switch": { score: 88, pathos: ["Balance begegnet Vielseitigkeit."], logos: ["Beide können sich situativ anpassen."], pro: ["Hohe gegenseitige Anpassungsfähigkeit", "Flexible Rollenverteilung"], contra: ["Manchmal unklar, wer führt"] },
            "dominant_ausgeglichen": { score: 85, pathos: ["Führung trifft auf Gelassenheit."], logos: ["Dominanter gibt Richtung, Ausgeglichener stabilisiert."], pro: ["Klare Führung mit stabilem Fundament", "Harmonische Grunddynamik"], contra: ["Dominanter könnte mehr Polarität vermissen"] },
            "ausgeglichen_dominant": { score: 85, pathos: ["Balance begegnet Stärke."], logos: ["Strukturell kompatibel."], pro: ["Harmonische Dynamik möglich", "Ausgeglichener behält Autonomie"], contra: ["Dominanter könnte mehr Gegenpol vermissen"] },
            "submissiv_ausgeglichen": { score: 85, pathos: ["Hingabebereitschaft trifft auf sanfte Führung."], logos: ["Ausgeglichener kann situativ Führung übernehmen."], pro: ["Sanfte Führungsdynamik", "Submissiver fühlt sich sicher"], contra: ["Submissiver könnte stärkere Führung vermissen"] },
            "ausgeglichen_submissiv": { score: 85, pathos: ["Balance kann sanft führen."], logos: ["Ausgeglichener kann Führung übernehmen wenn nötig."], pro: ["Weiche, liebevolle Dynamik"], contra: ["Submissiver könnte klarere Führung wünschen"] },
            "switch_dominant": { score: 80, pathos: ["Flexibilität begegnet fester Führung."], logos: ["Switch kann submissive Rolle übernehmen."], pro: ["Switch kann sich anpassen", "Dominanter bekommt oft Führungsrolle"], contra: ["Switch könnte eigene dominante Seite vermissen", "Potenzial für Frustration"] },
            "dominant_switch": { score: 80, pathos: ["Führung trifft auf Vielseitigkeit."], logos: ["Switch's dominante Phasen können Konflikte schaffen."], pro: ["Grunddynamik kann funktionieren"], contra: ["Machtkonflikte wenn Switch dominant sein will"] },
            "switch_submissiv": { score: 80, pathos: ["Vielseitigkeit begegnet Hingabe."], logos: ["Switch kann dominant sein wenn nötig."], pro: ["Switch kann führen", "Flexibilität kann bereichernd sein"], contra: ["Inkonsistenz kann verunsichern", "Submissiver wünscht sich beständigere Dominanz"] },
            "submissiv_switch": { score: 80, pathos: ["Hingabe trifft auf Wechselhaftigkeit."], logos: ["Inkonsistenz kann strukturell herausfordernd sein."], pro: ["Grunddynamik kann funktionieren"], contra: ["Inkonsistenz kann frustrieren", "Führungsvakuum in Switch's submissiven Phasen"] },
            "dominant_dominant": { score: 55, pathos: ["Zwei Alphas treffen aufeinander – Funken fliegen.", "Machtkampf ist unvermeidlich, aber auch aufregend.", "Die Energie ist hoch, aber die Reibung auch."], logos: ["Sadikaj et al. (2017): Gleiche hohe Dominanz korreliert mit niedrigerer Zufriedenheit.", "Strukturelles Problem: Zwei Führer, keine Folger."], pro: ["Starke Persönlichkeiten können sich inspirieren", "Hohe Energie"], contra: ["Machtkämpfe unvermeidlich", "Wissenschaftlich belegte niedrigere Zufriedenheit", "Entscheidungskonflikte vorprogrammiert", "Bewusste Regeln erforderlich"] },
            "submissiv_submissiv": { score: 55, pathos: ["Zwei, die auf Führung warten – wer beginnt?", "Führungsvakuum kann lähmend wirken.", "Die Sehnsucht nach Führung bleibt unerfüllt."], logos: ["Strukturelles Führungsvakuum.", "Entscheidungsprozesse können stagnieren."], pro: ["Keine Machtkämpfe", "Harmonische, sanfte Grundstimmung", "Gegenseitige Empathie"], contra: ["Führungsvakuum", "Stagnation in Entscheidungsprozessen", "Beide warten auf Initiative des anderen", "Externe Struktur oft nötig"] },
            "default": { score: 75, pathos: ["Die Dominanz-Dynamik ist noch nicht vollständig erkennbar."], logos: ["Standardwert wird verwendet bis alle Dimensionen ausgewählt sind."], pro: ["Neutrale Ausgangssituation"], contra: ["Unvollständige Information"] }
        };

        // Hilfsfunktion: Hole Statements für Archetyp-Kombination
        function getArchetypeStatements(type1, type2) {
            const key = `${type1}_${type2}`;
            return archetypeStatements[key] || null;
        }

        // Hilfsfunktion: Hole Statements für Dominanz-Kombination
        function getDominanceStatements(dom1, dom2) {
            if (!dom1 || !dom2) return dominanceStatements.default;
            const key = `${dom1}_${dom2}`;
            return dominanceStatements[key] || dominanceStatements.default;
        }

        // Archetype definitions
        const archetypeDefinitions = {
            single: {
                name: "Single",
                shortDef: "Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung als dauerhafte Lebensform.",
                longDef: "Single-orientierte Menschen haben sich aktiv für ein Leben ohne dauerhafte romantische Partnerschaft entschieden. Dies ist keine Übergangsphase ('zwischen Beziehungen'), sondern eine bewusste Lebensform, die Selbstgenügsamkeit und persönliche Autonomie als zentrale Werte sieht. Soziale Kontakte, Freundschaften und gelegentliche romantische/sexuelle Begegnungen sind möglich, aber keine feste Partnerschaft wird angestrebt.",
                keyPrinciples: [
                    "Selbstgenügsamkeit als Wert, nicht als Mangel",
                    "Persönliche Autonomie über Verbindlichkeit",
                    "Beziehungen als Option, nicht als Notwendigkeit",
                    "Erfüllung durch Selbst, Freunde, Projekte"
                ],
                notTheSameAs: [
                    "'Zwischen Beziehungen' sein",
                    "'Noch nicht den Richtigen gefunden'",
                    "Beziehungsunfähig oder bindungsängstlich",
                    "Einsam oder unglücklich"
                ],
                variants: [
                    "Aromantisch-Single: Keine romantischen Gefühle, kein Bedürfnis danach",
                    "Bewusst-autonom: Positive Entscheidung für Freiheit",
                    "Beziehungs-kritisch: Bevorzugt Unabhängigkeit"
                ]
            },
            duo: {
                name: "Duo",
                shortDef: "Traditionelle monogame Zweierbeziehung mit Exklusivität und gemeinsamer Lebensgestaltung als Kernprinzip.",
                longDef: "Duo-orientierte Menschen leben in oder suchen eine klassische Zweierbeziehung mit romantischer und sexueller Exklusivität. Die Partnerschaft steht im Zentrum der Lebensgestaltung und wird als primäre emotionale und soziale Einheit verstanden. Gemeinsame Ziele, Alltag und Zukunftsplanung werden als Paar gestaltet.",
                keyPrinciples: [
                    "Exklusivität als Ausdruck von Verbindlichkeit",
                    "'Wir' als zentrale Einheit über 'Ich'",
                    "Tiefe durch Fokussierung auf eine Person",
                    "Gemeinsame Lebensgestaltung und Zukunftsplanung",
                    "Treue als emotionale und sexuelle Exklusivität"
                ],
                notTheSameAs: [
                    "Besitzdenken oder Kontrolle",
                    "Verlust der eigenen Identität",
                    "'Alte' oder 'überholte' Beziehungsform",
                    "Langweilig oder unerfüllt"
                ],
                variants: [
                    "Traditionell-Duo: Klassisches Ehe-Modell",
                    "Modern-Duo: Ohne Trauschein, flexiblere Rollen",
                    "Intensiv-Duo: Sehr enge emotionale Verschmelzung"
                ]
            },
            duo_flex: {
                name: "Duo-Flex",
                shortDef: "Primäre Zweierbeziehung mit vereinbarten Öffnungen für zusätzliche Kontakte unter klaren Regeln.",
                longDef: "Duo-Flex-orientierte Menschen leben in einer Hauptbeziehung mit einem Primärpartner, öffnen diese aber bewusst und einvernehmlich für weitere Kontakte. Die Primärbeziehung bleibt zentral und privilegiert. Alle Öffnungen erfolgen transparent und nach gemeinsam vereinbarten Regeln.",
                keyPrinciples: [
                    "Primärbeziehung als Anker und Priorität",
                    "Sexuelle/romantische Vielfalt ohne Hierarchie-Aufgabe",
                    "Ehrlichkeit und Transparenz über alle Kontakte",
                    "Regeln schützen die Hauptbeziehung",
                    "Freiheit innerhalb vereinbarter Grenzen"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alles ist abgesprochen!)",
                    "'Beziehung retten' durch Öffnung",
                    "Fehlende Verbindlichkeit",
                    "Übergangsphase zu Polyamorie"
                ],
                variants: [
                    "Swinging/Lifestyle: Gemeinsame sexuelle Erlebnisse",
                    "Open Relationship: Individuelle sexuelle Freiheit",
                    "Hierarchisches Poly: Primärpartner + Nebenbeziehungen"
                ]
            },
            solopoly: {
                name: "Solopoly",
                shortDef: "Mehrere gleichwertige Beziehungen bei bewusster Bewahrung der eigenen Autonomie - keine Primärpartner.",
                longDef: "Solopoly-orientierte Menschen führen mehrere romantische und/oder sexuelle Beziehungen parallel, ohne eine davon als 'Hauptbeziehung' zu priorisieren. Die persönliche Autonomie steht im Zentrum: Kein Zusammenziehen, keine gemeinsame Haushaltsführung. 'Ich bin mein eigener Primärpartner'.",
                keyPrinciples: [
                    "Autonomie als höchster Wert - auch in Beziehungen",
                    "Mehrere gleichwertige Beziehungen ohne Hierarchie",
                    "Keine Verschmelzung oder gemeinsame Haushalte",
                    "'Ich bin mein eigener Primärpartner'",
                    "Liebe ohne Aufgabe der Unabhängigkeit"
                ],
                notTheSameAs: [
                    "Bindungsangst oder Commitment-Probleme",
                    "'Light-Version' von Polyamorie",
                    "Egoistisch oder beziehungsunfähig",
                    "Zwischenstufe zu 'richtiger' Partnerschaft"
                ],
                variants: [
                    "Stark-autonom: Sehr klare Grenzen",
                    "Beziehungs-balanciert: Tiefe Beziehungen, getrennte Wohnungen",
                    "Netzwerk-orientiert: Viele gleichwertige Connections"
                ]
            },
            poly_hedo: {
                name: "Poly Hedo",
                shortDef: "Freiheitsorientierte Poly-Orientierung mit Fokus auf Genuss, Spontaneität und lebensbereichernde Erfahrungen.",
                longDef: "Poly-Hedo-orientierte Menschen leben multiple Beziehungen mit Betonung auf Lebensfreude, Spontaneität und genussvolle Erfahrungen. Weniger Regelwerk als bei anderen Poly-Formen, mehr Flow und Intuition. Die Freude am Moment und an vielfältigen Verbindungen steht im Vordergrund.",
                keyPrinciples: [
                    "Lebensfreude und Genuss als zentrale Werte",
                    "Spontaneität über starre Regeln",
                    "Vielfalt der Erfahrungen bereichert das Leben",
                    "Freiheit in Verbindungen",
                    "Intensität des Moments"
                ],
                notTheSameAs: [
                    "Verantwortungslos oder rücksichtslos",
                    "'Nur Sex ohne Gefühle'",
                    "Oberflächlich oder bindungsunfähig",
                    "Chaotisch oder planlos"
                ],
                variants: [
                    "Erlebnis-orientiert: Fokus auf gemeinsame Abenteuer",
                    "Genuss-zentriert: Sinnlichkeit und Lebensfreude",
                    "Freigeist: Maximale Spontaneität und Offenheit"
                ]
            },
            polyamor: {
                name: "Polyamor",
                shortDef: "Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen mit Transparenz und emotionalem Commitment.",
                longDef: "Polyamor-orientierte Menschen führen mehrere romantische Beziehungen parallel, die alle auf Ehrlichkeit, Einvernehmlichkeit und Transparenz basieren. Tiefe Verschmelzung, Zusammenleben und gemeinsame Zukunftsplanung mit mehreren Partnern sind möglich und erwünscht. Alle Beteiligten wissen voneinander.",
                keyPrinciples: [
                    "Liebe ist nicht begrenzt oder exklusiv",
                    "Ehrlichkeit und Transparenz gegenüber allen",
                    "Konsens und Einvernehmlichkeit als Basis",
                    "Emotionale Tiefe zu mehreren Menschen",
                    "Kommunikation als zentrale Kompetenz"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alle wissen Bescheid!)",
                    "Bindungsunfähigkeit",
                    "Nur Sex ohne Gefühle",
                    "Chaotisch oder unkontrolliert"
                ],
                variants: [
                    "Hierarchisches Poly: Primär-, Sekundärpartner",
                    "Nicht-hierarchisches Poly: Alle gleichwertig",
                    "Kitchen-Table-Poly: Alle Partner verstehen sich",
                    "Parallel-Poly: Partner kennen sich, wenig Kontakt"
                ]
            }
        };

        // Tag tooltip content for type combinations
        // Keys: "type1-type2" (alphabetically sorted), categories: A-F, tags: normalized tag names
        const tagTooltipContent = {
            // Single × Polyamor (niedrige Kompatibilität - Priorität)
            "polyamor-single": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Singles haben keine aktive Exklusivitäts-Erwartung, da sie bewusst ohne Primärbeziehung leben.",
                        type2Perspective: "Polyamor-Menschen lehnen Exklusivität als Grundprinzip ab - Liebe wird als nicht-begrenzt verstanden.",
                        dynamic: "Beide lehnen Exklusivität ab, aber aus völlig verschiedenen Gründen: Single will keine Beziehung, Polyamor will mehrere gleichzeitig."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Singles sind theoretisch offen, haben aber keine aktive Beziehungspraxis.",
                        type2Perspective: "Polyamor lebt alternative Modelle aktiv mit mehreren gleichzeitigen Liebesbeziehungen.",
                        dynamic: "Potenzielle Brücke: Ein Single könnte Polyamorie entdecken, wenn die Autonomie gewahrt bleibt."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Für Singles ist Beziehung kein zentraler Lebensinhalt - Selbstgenügsamkeit steht im Vordergrund.",
                        type2Perspective: "Für Polyamor sind Beziehungen sehr zentral, aber als Netzwerk statt als einzelne Partnerschaft.",
                        dynamic: "Grundlegend verschiedene Lebensentwürfe: Beziehungsfreiheit vs. Beziehungsvielfalt als Ideal."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue ist für Singles kein relevantes Konzept, da keine Beziehungsverpflichtungen bestehen.",
                        type2Perspective: "Treue bedeutet für Polyamor Ehrlichkeit und Transparenz, nicht Exklusivität.",
                        dynamic: "Verschiedene Bedeutungen: Für Single irrelevant, für Polyamor transformiert - aber nicht abwesend."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Singles praktizieren Selbstverantwortung ohne Rechenschaftspflicht gegenüber Partnern.",
                        type2Perspective: "Polyamor betont ethische Verantwortung gegenüber allen Beziehungspartnern.",
                        dynamic: "Single lebt für sich, Polyamor für ein Netzwerk - unterschiedliche ethische Bezugsrahmen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung liegt primär bei sich selbst und eigenen Lebensentscheidungen.",
                        type2Perspective: "Verantwortung erstreckt sich auf mehrere Partner und deren emotionale Bedürfnisse.",
                        dynamic: "Einzelverantwortung vs. Netzwerkverantwortung - fundamental verschiedene Komplexitätsgrade."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Singles meiden emotionale Verschmelzung zugunsten von Selbstgenügsamkeit.",
                        type2Perspective: "Polyamor sucht emotionale Tiefe mit mehreren Menschen gleichzeitig.",
                        dynamic: "Singles wahren Distanz, Polyamor sucht Nähe - aber verteilt auf mehrere Personen."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe ist für Singles optional und situativ, nicht strukturell verankert.",
                        type2Perspective: "Polyamor hat oft hohe physische Nähe-Bedürfnisse zu mehreren Partnern.",
                        dynamic: "Singles regulieren Nähe selbst, Polyamor jongliert Nähe-Bedürfnisse im Netzwerk."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Singles brauchen viel Raum und sind geübt darin, diesen zu verteidigen.",
                        type2Perspective: "Polyamor gibt Raum durch verteilte Aufmerksamkeit auf mehrere Partner.",
                        dynamic: "Beide können Raum geben - Single durch Abwesenheit, Polyamor durch Verteilung."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Maximale Freiheit ohne Kompromisse - Singles gestalten ihr Leben vollständig selbst.",
                        type2Perspective: "Freiheit innerhalb eines ethischen Beziehungsnetzwerks mit Absprachen.",
                        dynamic: "Absolute vs. verhandelte Freiheit - Singles haben mehr, müssen aber auf Beziehungstiefe verzichten."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Volle Entscheidungsautonomie ohne Rücksprache oder Kompromisse.",
                        type2Perspective: "Entscheidungsautonomie mit Transparenzpflicht gegenüber allen Partnern.",
                        dynamic: "Singles entscheiden allein, Polyamor kommuniziert - verschiedene Autonomie-Definitionen."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Singles respektieren Autonomie anderer, da sie selbst maximale Autonomie leben.",
                        type2Perspective: "Polyamor fördert aktiv die Autonomie aller Partner im Netzwerk.",
                        dynamic: "Passives Respektieren vs. aktives Fördern von Autonomie."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Singles kommunizieren situativ und bei Bedarf, ohne dauerhafte Verpflichtung.",
                        type2Perspective: "Polyamor erfordert tiefe, kontinuierliche Kommunikation mit allen Partnern.",
                        dynamic: "Verschiedene Kommunikationskulturen: Bedarfsorientiert vs. strukturell verankert."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Singles können Konflikte durch Rückzug vermeiden - keine Beziehungspflicht.",
                        type2Perspective: "Polyamor muss Konflikte aktiv lösen, um das Netzwerk zu erhalten.",
                        dynamic: "Exit-Option vs. Konfliktlösung als Notwendigkeit - sehr verschiedene Strategien."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz ist optional, da keine festen Beziehungspflichten bestehen.",
                        type2Perspective: "Maximale emotionale Transparenz als ethische Grundlage aller Beziehungen.",
                        dynamic: "Freiwillige vs. verpflichtende Transparenz - unterschiedliche Grundhaltungen."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Singles sind gesellschaftlich akzeptiert, wenn auch manchmal bedauert.",
                        type2Perspective: "Polyamor erfährt oft Stigmatisierung und Unverständnis.",
                        dynamic: "Single ist 'normal', Polyamor muss sich erklären - verschiedene gesellschaftliche Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Singles integrieren sich individuell und flexibel in soziale Kreise.",
                        type2Perspective: "Polyamor bringt komplexe Beziehungsstrukturen in soziale Kontexte ein.",
                        dynamic: "Einfache vs. komplexe soziale Integration - Singles haben es leichter."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Singles erleben mildes Stigma ('Wann heiratest du?'), aber keine starke Ablehnung.",
                        type2Perspective: "Polyamor muss aktiv mit Vorurteilen und Abwertung umgehen.",
                        dynamic: "Leichtes vs. starkes Stigma - Polyamor braucht mehr Resilienz."
                    }
                }
            },
            // Duo × Polyamor (maximaler Konflikt - Priorität)
            "duo-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo sieht Exklusivität als fundamentalen Ausdruck von Liebe und Verbindlichkeit.",
                        type2Perspective: "Polyamor versteht Liebe als nicht-begrenzte Ressource, die sich auf mehrere Menschen erstrecken kann.",
                        dynamic: "Fundamentaler Konflikt: Was für Duo Treue bedeutet, ist für Polyamor eine künstliche Beschränkung."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo bevorzugt das bewährte Zweiermodell und sieht wenig Grund zur Öffnung.",
                        type2Perspective: "Polyamor lebt aktiv ein alternatives Modell und hinterfragt Monogamie-Normen.",
                        dynamic: "Tradition vs. Alternative: Duo fragt 'Warum ändern?', Polyamor fragt 'Warum beschränken?'"
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Für Duo ist DIE Beziehung zentraler Lebensinhalt - 'Wir' als Einheit.",
                        type2Perspective: "Für Polyamor sind Beziehungen plural - mehrere gleichwertige 'Wirs'.",
                        dynamic: "Singuläres 'Wir' vs. plurales 'Wir' - grundverschiedene Beziehungsarchitekturen."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet exklusive emotionale und sexuelle Bindung an eine Person.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit, Transparenz und Einhalten von Absprachen - nicht Exklusivität.",
                        dynamic: "Maximaler Definitionskonflikt: Duo sieht Untreue, wo Polyamor Transparenz sieht."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen, Verbindlichkeit und Fokussierung auf einen Partner.",
                        type2Perspective: "Ethik basiert auf Ehrlichkeit, Konsens und Verantwortung gegenüber allen Beteiligten.",
                        dynamic: "Verschiedene ethische Fundamente: Exklusivitätsethik vs. Transparenzethik."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung konzentriert sich auf einen Partner und die gemeinsame Zukunft.",
                        type2Perspective: "Verantwortung verteilt sich auf mehrere Partner und komplexe Beziehungsdynamiken.",
                        dynamic: "Fokussierte vs. verteilte Verantwortung - unterschiedliche Kapazitätsanforderungen."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Duo strebt tiefe emotionale Verschmelzung mit einem Partner an.",
                        type2Perspective: "Polyamor erlebt emotionale Tiefe mit mehreren Menschen, aber weniger Verschmelzung pro Person.",
                        dynamic: "Intensive Tiefe zu einem vs. verteilte Tiefe zu mehreren - verschiedene emotionale Ökonomien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe fokussiert sich exklusiv auf den Partner.",
                        type2Perspective: "Physische Nähe verteilt sich auf mehrere Partner nach Bedarf und Absprache.",
                        dynamic: "Exklusive vs. geteilte Intimität - kann für Duo als Verlust erlebt werden."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Duo gibt Raum innerhalb der Partnerschaft, aber nicht für andere Beziehungen.",
                        type2Perspective: "Polyamor muss Raum für alle Partner schaffen und ausbalancieren.",
                        dynamic: "Raum für Individuum vs. Raum für andere Beziehungen - verschiedene Raumkonzepte."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert und gelebt.",
                        type2Perspective: "Individuelle Freiheit schließt Freiheit für mehrere Liebesbeziehungen ein.",
                        dynamic: "Paar-Freiheit vs. individuelle Beziehungsfreiheit - verschiedene Freiheitsbegriffe."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen werden als Paar getroffen.",
                        type2Perspective: "Individuelle Autonomie auch bei Beziehungsentscheidungen, mit Transparenz.",
                        dynamic: "Gemeinsame vs. individuelle Entscheidungsmacht - kann zu Konflikten führen."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie des Partners wird anerkannt, aber nicht für andere Beziehungen.",
                        type2Perspective: "Autonomie schließt explizit die Freiheit für weitere Liebesbeziehungen ein.",
                        dynamic: "Begrenzte vs. unbegrenzte Autonomie-Akzeptanz - Kernkonflikt dieser Kombination."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit einem Partner über alle Lebensaspekte.",
                        type2Perspective: "Tiefe Kommunikation mit mehreren Partnern, plus Meta-Kommunikation über Beziehungen.",
                        dynamic: "Verschiedene Kommunikationsanforderungen: Duo ist intensiv, Polyamor ist extensiv."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gelöst, ohne externe Beziehungen.",
                        type2Perspective: "Konflikte können mehrere Partner betreffen und erfordern komplexe Lösungen.",
                        dynamic: "Bilaterale vs. multilaterale Konfliktlösung - verschiedene Komplexitätsgrade."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz primär gegenüber dem einen Partner.",
                        type2Perspective: "Emotionale Transparenz gegenüber allen Partnern als ethische Basis.",
                        dynamic: "Duo kann Transparenz gegenüber 'Dritten' als Verrat empfinden - Polyamor als Grundlage."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo entspricht der gesellschaftlichen Norm und genießt volle Akzeptanz.",
                        type2Perspective: "Polyamor muss gegen Vorurteile und mangelndes Verständnis kämpfen.",
                        dynamic: "Norm vs. Abweichung - Duo hat soziale Vorteile, Polyamor soziale Hürden."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Duo wird als 'normales' Paar problemlos in alle Kontexte integriert.",
                        type2Perspective: "Polyamor muss erklären, verbergen oder mit Unverständnis umgehen.",
                        dynamic: "Reibungslose vs. erklärungsbedürftige Integration - verschiedene soziale Belastungen."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Duo erfährt kein Stigma, sondern gesellschaftliche Unterstützung.",
                        type2Perspective: "Polyamor muss aktiv mit Stigmatisierung und Diskriminierung umgehen.",
                        dynamic: "Privilegierte vs. marginalisierte Position - kann zu Unverständnis führen."
                    }
                }
            },
            // Duo-Flex × Solopoly (interessante Balance - Priorität)
            "duo_flex-solopoly": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo-Flex hält an einer Primärbeziehung fest, öffnet aber für Zusatzkontakte.",
                        type2Perspective: "Solopoly lehnt jede Form von Primärhierarchie ab - alle Beziehungen sind gleichwertig.",
                        dynamic: "Hierarchie vs. Gleichwertigkeit: Duo-Flex braucht einen Anker, Solopoly will keinen."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo-Flex ist offen, aber innerhalb eines strukturierten Rahmens mit Primärpartner.",
                        type2Perspective: "Solopoly lebt maximale Offenheit ohne Verpflichtung zu einer Hauptbeziehung.",
                        dynamic: "Gerahmte vs. ungerahmte Offenheit - beide alternativ, aber verschieden strukturiert."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Primärbeziehung ist Lebensinhalt, andere Kontakte sind Bereicherung.",
                        type2Perspective: "Alle Beziehungen sind Lebensbereiche, keiner ist zentraler Lebensinhalt.",
                        dynamic: "Zentrale vs. dezentrale Beziehungsarchitektur - verschiedene Lebensmodelle."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet Ehrlichkeit und Prioririsierung des Hauptpartners.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit gegenüber allen, ohne Hierarchie der Wichtigkeit.",
                        dynamic: "Hierarchische vs. egalitäre Treue-Definition - beide ehrlich, anders strukturiert."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik schützt die Primärbeziehung, Öffnungen erfolgen im Rahmen.",
                        type2Perspective: "Ethik behandelt alle Partner gleich, ohne Vorrang einer Beziehung.",
                        dynamic: "Schutzethik vs. Gleichheitsethik - verschiedene ethische Prioritäten."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Höchste Verantwortung gegenüber dem Primärpartner, dann anderen.",
                        type2Perspective: "Gleiche Verantwortung gegenüber allen Partnern, kein 'mehr' oder 'weniger'.",
                        dynamic: "Gestufte vs. gleiche Verantwortung - kann zu Missverständnissen führen."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Verschmelzung primär mit dem Hauptpartner.",
                        type2Perspective: "Solopoly meidet Verschmelzung bewusst, um Autonomie zu bewahren.",
                        dynamic: "Selektive Verschmelzung vs. generelle Distanz - verschiedene Nähe-Strategien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe hauptsächlich mit Primärpartner, situativ mit anderen.",
                        type2Perspective: "Physische Nähe gleichmäßig verteilt, kein 'Zuhause' bei einem Partner.",
                        dynamic: "Zentrierte vs. verteilte Intimität - verschiedene Nähe-Modelle."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum wird innerhalb der Primärbeziehung verhandelt.",
                        type2Perspective: "Raum ist strukturell gegeben durch separate Lebensräume.",
                        dynamic: "Verhandelter vs. struktureller Raum - Solopoly hat mehr eingebaute Distanz."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit innerhalb der Primärbeziehungs-Struktur.",
                        type2Perspective: "Maximale individuelle Freiheit als Grundprinzip des Lebens.",
                        dynamic: "Gerahmte vs. maximale Freiheit - verschiedene Autonomie-Level."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen mit Primärpartner, aber mehr Freiraum als Duo.",
                        type2Perspective: "Volle Entscheidungsautonomie, Transparenz statt Absprache.",
                        dynamic: "Abgestimmte vs. informierte Autonomie - verschiedene Entscheidungsprozesse."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie wird akzeptiert, solange die Primärbeziehung Priorität bleibt.",
                        type2Perspective: "Autonomie wird bedingungslos akzeptiert - keine Hierarchie-Erwartung.",
                        dynamic: "Bedingte vs. bedingungslose Autonomie-Akzeptanz."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit Primärpartner über alle Aspekte.",
                        type2Perspective: "Situative Kommunikationstiefe je nach Beziehung und Bedarf.",
                        dynamic: "Zentrierte vs. verteilte Kommunikationstiefe."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte primär im Kontext der Hauptbeziehung lösen.",
                        type2Perspective: "Konflikte individuell mit jedem Partner, ohne zentrale Instanz.",
                        dynamic: "Zentralisierte vs. dezentralisierte Konfliktlösung."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegenüber Primärpartner, selektiv gegenüber anderen.",
                        type2Perspective: "Gleichmäßige Transparenz gegenüber allen Partnern.",
                        dynamic: "Gestufte vs. gleiche Transparenz - verschiedene Informationsflüsse."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo-Flex kann als 'offene Ehe' noch relativ akzeptiert werden.",
                        type2Perspective: "Solopoly ist schwer zu erklären und wird oft missverstanden.",
                        dynamic: "Relativ akzeptiert vs. erklärungsbedürftig - verschiedene soziale Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Primärpaar wird integriert, Zusatzkontakte bleiben oft privat.",
                        type2Perspective: "Alle Beziehungen gleichwertig in soziale Kreise integrieren ist komplex.",
                        dynamic: "Einfachere vs. komplexere soziale Integration."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Mildes Stigma, wenn Öffnung bekannt wird.",
                        type2Perspective: "Stärkeres Stigma durch unkonventionelle Lebensform ohne 'Hauptpartner'.",
                        dynamic: "Verschiedene Stigma-Level - Solopoly ist gesellschaftlich unbekannter."
                    }
                }
            },
            // Polyamor × Polyamor (hohe Kompatibilität - Test)
            "polyamor-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Keine Exklusivitäts-Erwartung, Liebe wird als nicht-begrenzt verstanden.",
                        type2Perspective: "Gleiche Grundhaltung: Liebe zu mehreren Menschen ist möglich und ethisch.",
                        dynamic: "Volle Übereinstimmung: Beide verstehen und leben nicht-exklusive Liebe."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Lebt aktiv ein alternatives Beziehungsmodell.",
                        type2Perspective: "Teilt diese Lebensrealität und die damit verbundenen Werte.",
                        dynamic: "Maximale Synergie: Beide haben den gleichen Referenzrahmen für Beziehungen."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Beziehungen sind zentraler Lebensinhalt, aber als Netzwerk.",
                        type2Perspective: "Versteht und teilt diese Beziehungsarchitektur vollständig.",
                        dynamic: "Geteiltes Verständnis: Beziehungsnetzwerk als gemeinsamer Lebensraum."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = Ehrlichkeit, Transparenz, Einhalten von Agreements.",
                        type2Perspective: "Gleiche Definition von Treue, ohne Exklusivitätskomponente.",
                        dynamic: "Übereinstimmung bei einem der kritischsten Beziehungskonzepte."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Konsens, Kommunikation und Respekt.",
                        type2Perspective: "Teilt diese ethischen Grundlagen und praktiziert sie aktiv.",
                        dynamic: "Gemeinsame ethische Basis erleichtert Verhandlungen und Absprachen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung für ein Netzwerk von Beziehungen und Gefühlen.",
                        type2Perspective: "Versteht diese Komplexität und trägt sie mit.",
                        dynamic: "Geteilte Erfahrung mit der Komplexität polyamorer Verantwortung."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Tiefe mit mehreren Menschen, bewusst dosiert.",
                        type2Perspective: "Gleiche Erfahrung und Kompetenz im Umgang mit verteilter Intimität.",
                        dynamic: "Beide verstehen, wie Tiefe in einem Poly-Kontext funktioniert."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe verteilt sich auf mehrere Partner.",
                        type2Perspective: "Akzeptiert und praktiziert geteilte Intimität.",
                        dynamic: "Keine Eifersucht auf physische Nähe mit anderen - geteilte Norm."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum für andere Beziehungen ist selbstverständlich.",
                        type2Perspective: "Erwartet und gibt gleichermaßen Raum für das Beziehungsnetzwerk.",
                        dynamic: "Strukturelle Übereinstimmung: Beide brauchen und geben Beziehungs-Raum."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit für mehrere Liebesbeziehungen als Grundrecht.",
                        type2Perspective: "Teilt dieses Freiheitsverständnis vollständig.",
                        dynamic: "Keine Einschränkung der romantischen Freiheit - beidseitiges Verständnis."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Autonomie bei Beziehungsentscheidungen, mit Transparenzpflicht.",
                        type2Perspective: "Gleiche Balance zwischen Autonomie und Verantwortung.",
                        dynamic: "Geteilte Entscheidungskultur: Autonom, aber transparent."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Volle Akzeptanz der Beziehungsfreiheit des Partners.",
                        type2Perspective: "Erwartet und praktiziert die gleiche Akzeptanz.",
                        dynamic: "Wechselseitige Autonomie-Akzeptanz als Fundament der Beziehung."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation als Kernkompetenz polyanorer Beziehungen.",
                        type2Perspective: "Bringt gleiche Kommunikationsfähigkeiten und -erwartungen mit.",
                        dynamic: "Hohe Kommunikationskompetenz auf beiden Seiten - ideale Voraussetzung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Erfahrung mit komplexen, multilateralen Konflikten.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten Lösungsstrategien.",
                        dynamic: "Beide sind 'Poly-geprüft' in Konfliktsituationen - große Resilienz."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Maximale Transparenz als ethische Grundlage.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Praxis.",
                        dynamic: "Keine versteckten Emotionen, keine versteckten Beziehungen - klare Basis."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Muss mit gesellschaftlicher Stigmatisierung umgehen.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten Coping-Strategien.",
                        dynamic: "Gemeinsame Außenseiter-Position kann verbinden und stärken."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Komplexe Beziehungsstrukturen in soziale Kontexte einbringen.",
                        type2Perspective: "Versteht und teilt diese Herausforderung.",
                        dynamic: "Gegenseitige Unterstützung bei sozialer Navigation."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Aktiver Umgang mit Vorurteilen und Diskriminierung.",
                        type2Perspective: "Teilt diese Erfahrung und die Resilienz-Strategien.",
                        dynamic: "Gemeinsame Stärke gegen gesellschaftlichen Druck."
                    }
                }
            },
            // Duo × Duo (hohe Kompatibilität - Test)
            "duo-duo": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Exklusivität als fundamentaler Ausdruck von Liebe.",
                        type2Perspective: "Teilt dieses Verständnis von Exklusivität vollständig.",
                        dynamic: "Perfekte Übereinstimmung: Beide verstehen und wünschen Exklusivität."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Bevorzugt das klassische Zweiermodell.",
                        type2Perspective: "Gleiche Präferenz für monogame Partnerschaft.",
                        dynamic: "Geteilte Wertschätzung für traditionelles Beziehungsmodell."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Partnerschaft ist zentraler Lebensinhalt.",
                        type2Perspective: "Teilt diese Priorisierung der Beziehung.",
                        dynamic: "Gemeinsames 'Wir' als Lebensmittelpunkt - perfekte Synergie."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = exklusive emotionale und sexuelle Bindung.",
                        type2Perspective: "Gleiche Definition, gleiche Erwartung.",
                        dynamic: "Keine Definitions-Konflikte bei diesem zentralen Thema."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen und Verbindlichkeit.",
                        type2Perspective: "Teilt diese ethischen Grundwerte.",
                        dynamic: "Gemeinsame ethische Basis für eine stabile Partnerschaft."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Fokussierte Verantwortung füreinander.",
                        type2Perspective: "Gleiche Verantwortungsbereitschaft.",
                        dynamic: "Gegenseitige, konzentrierte Verantwortung - klare Struktur."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Wünscht tiefe emotionale Verschmelzung.",
                        type2Perspective: "Teilt dieses Bedürfnis nach Nähe und Verbundenheit.",
                        dynamic: "Beidseitiges Streben nach emotionaler Tiefe."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe exklusiv mit dem Partner.",
                        type2Perspective: "Gleiche Exklusivitäts-Erwartung bei Intimität.",
                        dynamic: "Keine Konkurrenz um Nähe - ungeteilte Aufmerksamkeit."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum innerhalb der Partnerschaft.",
                        type2Perspective: "Gleiche Balance zwischen Nähe und individuellem Raum.",
                        dynamic: "Ähnliche Raum-Bedürfnisse erleichtern das Zusammenleben."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert.",
                        type2Perspective: "Teilt dieses Verständnis von Paar-Freiheit.",
                        dynamic: "Gemeinsame Freiheits-Definition als 'Wir'."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen gemeinsam treffen.",
                        type2Perspective: "Gleiche Erwartung an gemeinsame Entscheidungsfindung.",
                        dynamic: "Geteilte Entscheidungsmacht ohne Autonomie-Konflikte."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie innerhalb des Paar-Rahmens.",
                        type2Perspective: "Gleiche Balance zwischen Individualität und Partnerschaft.",
                        dynamic: "Ähnliche Autonomie-Grenzen erleichtern das Zusammenleben."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation zu zweit.",
                        type2Perspective: "Gleicher Wunsch nach intensivem Austausch.",
                        dynamic: "Fokussierte, tiefe Kommunikation ohne Verteilung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gelöst.",
                        type2Perspective: "Gleiche Erwartung an bilaterale Konfliktlösung.",
                        dynamic: "Klare Konflikt-Struktur ohne externe Komplexität."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegenüber dem Partner.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Bereitschaft.",
                        dynamic: "Gegenseitige Offenheit ohne konkurrierende Loyalitäten."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Volle gesellschaftliche Akzeptanz.",
                        type2Perspective: "Teilt diese privilegierte Position.",
                        dynamic: "Keine externen Hürden durch gesellschaftliche Normen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Als Paar problemlos integriert.",
                        type2Perspective: "Gleiche einfache soziale Integration.",
                        dynamic: "Gesellschaftliche Normalität als gemeinsame Basis."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Kein Stigma, sondern gesellschaftliche Unterstützung.",
                        type2Perspective: "Teilt diese Stigma-freie Erfahrung.",
                        dynamic: "Kein externer Druck - Fokus auf die Beziehung selbst."
                    }
                }
            }
        };

        // Helper function to normalize tag names for lookup
        function normalizeTagName(tag) {
            return tag.toLowerCase()
                .replace(/ä/g, 'ae').replace(/ö/g, 'oe').replace(/ü/g, 'ue').replace(/ß/g, 'ss')
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
        }

        // Get tooltip content for a specific tag
        function getTagTooltip(type1Id, type2Id, category, tagName) {
            const normalizedTag = normalizeTagName(tagName);

            // Sort type IDs alphabetically for consistent key lookup
            const sortedTypes = [type1Id, type2Id].sort();
            const comboKey = sortedTypes.join('-');

            // Try to find specific tooltip
            const comboData = tagTooltipContent[comboKey];
            if (comboData && comboData[category] && comboData[category][normalizedTag]) {
                const tooltip = comboData[category][normalizedTag];
                const type1 = data.archetypes[type1Id];
                const type2 = data.archetypes[type2Id];

                // Swap perspectives if types were reordered
                if (sortedTypes[0] === type2Id) {
                    return {
                        type1Name: type1?.name || type1Id,
                        type2Name: type2?.name || type2Id,
                        type1Perspective: tooltip.type2Perspective,
                        type2Perspective: tooltip.type1Perspective,
                        dynamic: tooltip.dynamic
                    };
                }

                return {
                    type1Name: type1?.name || type1Id,
                    type2Name: type2?.name || type2Id,
                    type1Perspective: tooltip.type1Perspective,
                    type2Perspective: tooltip.type2Perspective,
                    dynamic: tooltip.dynamic
                };
            }

            // Fallback: Generate generic tooltip
            return generateFallbackTooltip(type1Id, type2Id, category, tagName);
        }

        // Generate fallback tooltip when no specific content exists
        function generateFallbackTooltip(type1Id, type2Id, category, tagName) {
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const type1Def = archetypeDefinitions[type1Id];
            const type2Def = archetypeDefinitions[type2Id];

            const interactionKey = `${type1Id}_${type2Id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const catScore = scores[category]?.value || 50;

            // Generate context-aware fallback
            let dynamicText = '';
            if (catScore >= 85) {
                dynamicText = `Hohe Übereinstimmung (${catScore}%) in diesem Bereich - beide Typen haben ähnliche Ansätze.`;
            } else if (catScore >= 70) {
                dynamicText = `Moderate Übereinstimmung (${catScore}%) - einige gemeinsame Grundlagen, aber auch Unterschiede.`;
            } else if (catScore >= 50) {
                dynamicText = `Mittlere Beziehungsqualität (${catScore}%) - deutliche Unterschiede, die Kompromisse erfordern.`;
            } else {
                dynamicText = `Herausfordernde Konstellation (${catScore}%) - grundlegend verschiedene Ansätze in diesem Bereich.`;
            }

            return {
                type1Name: type1?.name || type1Id,
                type2Name: type2?.name || type2Id,
                type1Perspective: type1Def?.keyPrinciples?.[0] || `${type1?.name || type1Id} hat eigene Präferenzen in diesem Bereich.`,
                type2Perspective: type2Def?.keyPrinciples?.[0] || `${type2?.name || type2Id} hat eigene Präferenzen in diesem Bereich.`,
                dynamic: dynamicText
            };
        }

        // Category descriptions loaded from data
        let categoryDescriptions = {};

        async function loadData() {
            try {
                const response = await fetch('archetype-matrix.json');
                data = await response.json();
                // Load category descriptions from data
                if (data.categories) {
                    categoryDescriptions = data.categories;
                }
            } catch (error) {
                console.error('Error loading data:', error);
                data = getFallbackData();
            }
            initApp();
        }

        function getFallbackData() {
            return {
                archetypes: {
                    single: { id: "single", name: "Single", color: "#E63946", shortDescription: "Fokus auf Selbstentwicklung", pro: [], contra: [], pathos: "", logos: "" },
                    duo: { id: "duo", name: "Duo", color: "#E84393", shortDescription: "Klassische monogame Zweierbeziehung", pro: [], contra: [], pathos: "", logos: "" },
                    duo_flex: { id: "duo_flex", name: "Duo-Flex", color: "#FF6B6B", shortDescription: "Primär Zweierbeziehung mit situativer Öffnung", pro: [], contra: [], pathos: "", logos: "" },
                    solopoly: { id: "solopoly", name: "Solopoly", color: "#2A9D8F", shortDescription: "Polyamor mit Autonomie", pro: [], contra: [], pathos: "", logos: "" },
                    poly_hedo: { id: "poly_hedo", name: "Poly Hedo", color: "#9B5DE5", shortDescription: "Lustorientierte Mehrfachbeziehungen", pro: [], contra: [], pathos: "", logos: "" },
                    polyamor: { id: "polyamor", name: "Polyamor", color: "#F4A261", shortDescription: "Strukturierte Mehrfachbeziehungen", pro: [], contra: [], pathos: "", logos: "" }
                },
                categories: {},
                interactions: {},
                aggregatedMatrix: { rows: [], cols: [], values: [] }
            };
        }

        function initApp() {
            const archetypeSelect = document.getElementById('archetypeSelect');
            if (archetypeSelect) {
                archetypeSelect.addEventListener('change', (e) => {
                    currentArchetype = e.target.value;
                    updateAll();
                });
            }

            // Carousel scroll detection
            const carousel = document.getElementById('carousel');
            if (carousel) {
                carousel.addEventListener('scroll', updateNavDots);
            }

            updateAll();
        }

        function updateAll() {
            updateTheme();
            updateMyType();
            updatePartnerSelector();
            updateTopAndChallenge();
            updatePartnerView();
            updateLegendCategories();
            updateAnalysisOverview();
        }

        function updateTheme() {
            document.body.className = `theme-${currentArchetype}`;
        }

        function updateMyType() {
            const arch = data.archetypes[currentArchetype];
            if (!arch) return;

            const myTypeIcon = document.getElementById('myTypeIcon');
            if (myTypeIcon) {
                myTypeIcon.textContent = icons[currentArchetype];
                myTypeIcon.style.background = arch.color;
            }

            const myTypeName = document.getElementById('myTypeName');
            if (myTypeName) {
                myTypeName.textContent = arch.name;
                myTypeName.style.color = arch.color;
            }

            const myTypeDesc = document.getElementById('myTypeDesc');
            if (myTypeDesc) myTypeDesc.textContent = arch.shortDescription || '';

            const myTypeTooltip = document.getElementById('myTypeTooltip');
            if (myTypeTooltip) myTypeTooltip.textContent = getShortDef(currentArchetype);

            const proList = document.getElementById('myTypePro');
            if (proList) proList.innerHTML = (arch.pro || []).slice(0, 4).map(p => `<li>${p}</li>`).join('');

            const contraList = document.getElementById('myTypeContra');
            if (contraList) contraList.innerHTML = (arch.contra || []).slice(0, 4).map(c => `<li>${c}</li>`).join('');

            const myTypePathos = document.getElementById('myTypePathos');
            if (myTypePathos) myTypePathos.textContent = arch.pathos || '';

            const myTypeLogos = document.getElementById('myTypeLogos');
            if (myTypeLogos) myTypeLogos.textContent = arch.logos || '';
        }

        // Fixed archetype order to ensure all types are shown
        const archetypeOrder = ['single', 'duo', 'duo_flex', 'solopoly', 'poly_hedo', 'polyamor'];

        function updatePartnerSelector() {
            const container = document.getElementById('partnerSelector');
            // Show ALL archetypes as partner options (including own type for self-matching)
            const allPartners = archetypeOrder
                .map(id => data.archetypes[id])
                .filter(arch => arch); // Remove any undefined

            if (!allPartners.find(o => o.id === selectedPartner)) {
                selectedPartner = allPartners[0]?.id || 'duo';
            }

            container.innerHTML = allPartners.map(arch => `
                <button class="partner-btn ${arch.id === selectedPartner ? 'active' : ''}"
                        onclick="selectPartner('${arch.id}')"
                        data-id="${arch.id}">
                    <span class="dot" style="background: ${arch.color}"></span>
                    ${arch.name}
                </button>
            `).join('');
        }

        function selectPartner(partnerId) {
            selectedPartner = partnerId;
            document.querySelectorAll('.partner-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.id === partnerId);
            });
            updatePartnerView();
            updateAnalysisOverview();
        }

        function updateTopAndChallenge() {
            // Include all types (including self) for top match and challenge
            const others = archetypeOrder;
            let topMatch = { id: null, score: 0 };
            let challenge = { id: null, score: 100 };

            others.forEach(otherId => {
                const key = `${currentArchetype}_${otherId}`;
                const interaction = data.interactions[key];
                const score = interaction?.overall || 0;

                if (score > topMatch.score) {
                    topMatch = { id: otherId, score };
                }
                if (score < challenge.score) {
                    challenge = { id: otherId, score };
                }
            });

            // Store for modal access
            currentTopMatch = topMatch;
            currentChallenge = challenge;

            const myArch = data.archetypes[currentArchetype];

            if (topMatch.id) {
                const arch = data.archetypes[topMatch.id];
                document.getElementById('topMatchDot').style.background = arch.color;
                document.getElementById('topMatchName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('topMatchScore').textContent = topMatch.score + '%';
            }

            if (challenge.id) {
                const arch = data.archetypes[challenge.id];
                document.getElementById('challengeDot').style.background = arch.color;
                document.getElementById('challengeName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('challengeScore').textContent = challenge.score + '%';
            }
        }

        function updatePartnerView() {
            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};

            // Run Pathos/Logos checks first
            const checkResult = runCompatibilityChecks();
            if (checkResult && checkResult.blocked) {
                // Pathos blocked - don't render the rest
                return;
            }

            document.getElementById('myTypeNameDisplay').textContent = myArch?.name || '...';
            document.getElementById('partnerNameDisplay').textContent = partnerArch?.name || '...';
            document.getElementById('myTypeTooltipPage3').textContent = getShortDef(currentArchetype);
            document.getElementById('partnerTooltipPage3').textContent = getShortDef(selectedPartner);

            const score = interaction.overall || 0;
            const scoreEl = document.getElementById('overallScore');
            scoreEl.textContent = score + '%';
            scoreEl.style.color = getScoreColor(score);

            drawRadarChart(interaction.scores || {}, partnerArch?.color || '#457B9D');
            updateCategoryBars(interaction.scores || {});

            const proList = document.getElementById('partnerPro');
            proList.innerHTML = (interaction.pro || []).map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';

            const contraList = document.getElementById('partnerContra');
            contraList.innerHTML = (interaction.contra || []).map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';
        }

        function drawRadarChart(scores, color) {
            const svg = document.getElementById('radarChart');
            const cx = 140, cy = 120, maxR = 90;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const n = categories.length;

            let html = '';

            for (let r = 18; r <= maxR; r += 18) {
                html += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
            }

            categories.forEach((cat, i) => {
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * maxR;
                const y = cy + Math.sin(angle) * maxR;
                const labelX = cx + Math.cos(angle) * (maxR + 18);
                const labelY = cy + Math.sin(angle) * (maxR + 18);

                html += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
                html += `<text x="${labelX}" y="${labelY}" fill="var(--text-muted)" font-size="10" text-anchor="middle" dominant-baseline="middle">${cat}</text>`;
            });

            const points = categories.map((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                return `${cx + Math.cos(angle) * r},${cy + Math.sin(angle) * r}`;
            }).join(' ');

            html += `<polygon points="${points}" fill="${color}33" stroke="${color}" stroke-width="2"/>`;

            categories.forEach((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;
                html += `<circle cx="${x}" cy="${y}" r="4" fill="${color}"/>`;
            });

            if (svg) svg.innerHTML = html;

            // Also draw on expandRadarChart (smaller version)
            const expandSvg = document.getElementById('expandRadarChart');
            if (expandSvg) expandSvg.innerHTML = html;
        }

        function updateCategoryBars(scores) {
            const container = document.getElementById('categoryBars');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            container.innerHTML = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                return `
                    <div class="category-row" onclick="openSingleCategoryModal('${cat}')">
                        <span class="category-label">${cat}</span>
                        <div class="category-bar-wrap">
                            <div class="category-bar-container">
                                <div class="category-bar ${barClass}" style="width: ${value}%">
                                    <span class="category-bar-value">${value}%</span>
                                </div>
                            </div>
                            <div class="category-name">${name}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getScoreColor(score) {
            if (score >= 78) return '#00cec9';
            if (score >= 70) return '#27ae60';
            if (score >= 60) return '#f39c12';
            return '#e74c3c';
        }

        function getBarClass(value) {
            if (value >= 78) return 'bar-excellent';
            if (value >= 70) return 'bar-good';
            if (value >= 60) return 'bar-medium';
            return 'bar-low';
        }

        function toggleCollapsible(id) {
            document.getElementById(id).classList.toggle('open');
        }

        function scrollToCard(index) {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            carousel.scrollTo({ left: cardWidth * index, behavior: 'smooth' });
        }

        const TOTAL_PAGES = 4;

        function updateNavDots() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);

            document.querySelectorAll('.nav-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentCard);
            });

            // Update arrow states
            const arrows = document.querySelectorAll('.nav-arrow');
            if (arrows.length >= 2) {
                arrows[0].disabled = currentCard === 0;
                arrows[1].disabled = currentCard === TOTAL_PAGES - 1;
            }

            // Load feedback when on page 4
            if (currentCard === 3) {
                loadFeedback();
            }
        }

        function navigatePrev() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard > 0) {
                scrollToCard(currentCard - 1);
            }
        }

        function navigateNext() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard < TOTAL_PAGES - 1) {
                scrollToCard(currentCard + 1);
            }
        }

        // Legend Categories
        function updateLegendCategories() {
            const container = document.getElementById('legendCategories');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            // Get current interaction scores
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const myName = myArch?.name || currentArchetype;
            const partnerName = partnerArch?.name || selectedPartner;

            // Show which combination is displayed
            const headerText = currentArchetype === selectedPartner
                ? `${myName} (Ich) mit ${myName}`
                : `${myName} (Ich) mit ${partnerName}`;

            container.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: var(--bg-dark); border-radius: 10px; text-align: center;">
                    <span style="color: var(--text-muted); font-size: var(--font-sm);">Aktuelle Auswahl:</span>
                    <div style="color: var(--primary); font-weight: 600; font-size: var(--font-base);">${headerText}</div>
                </div>
            ` + categories.map(cat => {
                const catData = categoryDescriptions[cat] || {};
                const name = catData.name || categoryNames[cat] || cat;
                const desc = catData.description || 'Beschreibung nicht verfügbar';
                const value = scores[cat]?.value || 0;
                const scoreColor = getScoreColor(value);

                return `
                    <div class="legend-category-item" onclick="openSingleCategoryModal('${cat}')">
                        <div class="legend-category-letter">${cat}</div>
                        <div class="legend-category-content">
                            <div class="legend-category-name">${name}</div>
                            <div class="legend-category-desc">${desc}</div>
                        </div>
                        <div style="font-weight: 700; font-size: var(--font-md); color: ${scoreColor}; min-width: 50px; text-align: right;">${value}%</div>
                    </div>
                `;
            }).join('');
        }

        // Modal Functions
        function openCategoryModal() {
            // Reset modal context when opening directly (uses page 2 selection)
            modalContextPartner = null;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            document.getElementById('modalTitle').textContent = 'Alle Kategorien';
            document.getElementById('modalBody').innerHTML = categories.map(cat => getCategoryModalContent(cat)).join('');
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        let currentModalCategory = 'A'; // Track current category for navigation

        function openSingleCategoryModal(category) {
            currentModalCategory = category;
            // Don't reset modalContextPartner here - it may be set from match modal
            const catData = categoryDescriptions[category] || {};
            const name = catData.name || categoryNames[category] || category;
            document.getElementById('modalTitle').textContent = `Kategorie ${category}`;
            document.getElementById('modalBody').innerHTML = getCategoryModalContent(category);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function navigateCategoryPrev() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : categories.length - 1;
            openSingleCategoryModal(categories[prevIndex]);
        }

        function navigateCategoryNext() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const nextIndex = currentIndex < categories.length - 1 ? currentIndex + 1 : 0;
            openSingleCategoryModal(categories[nextIndex]);
        }

        function getCategoryModalContent(cat) {
            const catData = categoryDescriptions[cat] || {};
            const name = catData.name || categoryNames[cat] || cat;
            const desc = catData.description || 'Beschreibung nicht verfügbar';
            const subDims = catData.subDimensions || [];

            // Use modalContextPartner if set (from match modal), otherwise use selectedPartner (from page 2)
            const partnerId = modalContextPartner || selectedPartner;
            const interactionKey = `${currentArchetype}_${partnerId}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const value = scores[cat]?.value || 0;
            const scoreColor = getScoreColor(value);
            const barClass = getBarClass(value);

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[partnerId];
            const comboText = `${myArch?.name || '?'} + ${partnerArch?.name || '?'}`;
            const contextText = `${comboText} | ${name}`;

            // Get category position for navigation
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const catIndex = categories.indexOf(cat);
            const prevCat = categories[catIndex > 0 ? catIndex - 1 : categories.length - 1];
            const nextCat = categories[catIndex < categories.length - 1 ? catIndex + 1 : 0];
            const prevName = categoryNames[prevCat] || prevCat;
            const nextName = categoryNames[nextCat] || nextCat;

            return `
                <div class="category-nav-row">
                    <button class="category-nav-btn" onclick="navigateCategoryPrev()">
                        ‹ ${prevCat}
                    </button>
                    <span class="category-nav-indicator">${catIndex + 1} / 6</span>
                    <button class="category-nav-btn" onclick="navigateCategoryNext()">
                        ${nextCat} ›
                    </button>
                </div>

                <div class="modal-feedback-btn" onclick="openFeedbackModalWithContext('${contextText}')">
                    💬 Feedback zu ${comboText} | ${name}
                </div>

                <div class="modal-category">
                    <div class="modal-category-header">
                        <div class="modal-category-letter">${cat}</div>
                        <div class="modal-category-name">${name}</div>
                    </div>
                    <div class="match-modal-score" style="margin: 12px 0;">
                        <span class="match-modal-score-label">${comboText}</span>
                        <span class="match-modal-score-value" style="color: ${scoreColor}">${value}%</span>
                    </div>
                    <div class="modal-category-desc">${desc}</div>
                    ${subDims.length > 0 ? `
                        <div class="modal-subdimensions">
                            ${subDims.map(sd => renderTagWithTooltip(sd, cat, currentArchetype, partnerId)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Render a tag with tooltip
        function renderTagWithTooltip(tagName, category, type1Id, type2Id) {
            const tooltip = getTagTooltip(type1Id, type2Id, category, tagName);
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const color1 = type1?.color || 'var(--primary)';
            const color2 = type2?.color || 'var(--primary)';

            // Build type switcher options
            const allTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type1Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'ich', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            const partnerTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type2Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'partner', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            return `
                <span class="tag-tooltip-container">
                    <span class="modal-subdim-tag" onclick="openTagTooltip(this.parentElement, '${category}')">${tagName}</span>
                    <div class="tag-tooltip">
                        <button class="tag-tooltip-close" onclick="closeTagTooltip()">&times;</button>
                        <div class="tag-tooltip-header">${tagName}</div>

                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Ich:</span>
                            ${allTypes}
                        </div>
                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Partner:</span>
                            ${partnerTypes}
                        </div>

                        <div class="tag-tooltip-body">
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color1}">${tooltip.type1Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type1Perspective}</span>
                            </div>
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color2}">${tooltip.type2Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type2Perspective}</span>
                            </div>
                            <div class="tag-tooltip-dynamic">${tooltip.dynamic}</div>
                        </div>
                    </div>
                </span>
            `;
        }

        // Switch type from tooltip and refresh modal
        function switchTooltipType(typeId, role, category) {
            if (role === 'ich') {
                currentArchetype = typeId;
                // Update main UI
                document.getElementById('archetypeSelect').value = typeId;
                updateTheme();
                updateMyType();
                updatePartnerSelector();
                updateTopAndChallenge();
                updatePartnerView();
            } else {
                selectedPartner = typeId;
                modalContextPartner = typeId;
                // Update partner selection buttons
                document.querySelectorAll('.partner-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.id === typeId);
                });
                updatePartnerView();
            }

            // Refresh the category modal with new types
            openSingleCategoryModal(category);
        }

        // Active tooltip tracking
        let activeTooltipElement = null;
        let activeTagElement = null;

        // Toggle tag tooltip on click
        function openTagTooltip(container, category) {
            const tooltip = container.querySelector('.tag-tooltip');
            const tag = container.querySelector('.modal-subdim-tag');
            if (!tooltip || !tag) return;

            // If this tooltip is already open, close it
            if (activeTooltipElement === tooltip) {
                closeTagTooltip();
                return;
            }

            // Close any other open tooltip first
            closeTagTooltip();

            // Activate this tooltip and tag
            activeTooltipElement = tooltip;
            activeTagElement = tag;
            tooltip.classList.add('active');
            tag.classList.add('active');

            // Position at top of viewport so it doesn't get cut off
            const tooltipWidth = Math.min(360, window.innerWidth * 0.92);
            const left = (window.innerWidth - tooltipWidth) / 2;
            const top = 60; // Fixed position near top

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.style.width = tooltipWidth + 'px';
        }

        // Close tag tooltip
        function closeTagTooltip() {
            if (activeTooltipElement) {
                activeTooltipElement.classList.remove('active');
                activeTooltipElement = null;
            }
            if (activeTagElement) {
                activeTagElement.classList.remove('active');
                activeTagElement = null;
            }
            // Also close any other open tooltips and tags
            document.querySelectorAll('.tag-tooltip.active').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.modal-subdim-tag.active').forEach(t => t.classList.remove('active'));
        }

        function closeCategoryModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('categoryModal').classList.remove('active');
            document.body.style.overflow = '';
            // Reset modal context when closing
            modalContextPartner = null;
        }

        // Definition Modal Functions
        function openDefinitionModal(archetypeId) {
            const def = archetypeDefinitions[archetypeId];
            if (!def) return;

            const arch = data.archetypes[archetypeId];
            const color = arch?.color || 'var(--primary)';
            const icon = icons[archetypeId] || '?';

            document.getElementById('definitionModalTitle').innerHTML = `
                <span style="color: ${color}">${icon}</span> ${def.name}
            `;

            document.getElementById('definitionModalBody').innerHTML = `
                <div class="definition-long">${def.longDef}</div>

                <div class="definition-section">
                    <div class="definition-section-title">Kernprinzipien</div>
                    <ul class="definition-list principles">
                        ${def.keyPrinciples.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Das ist NICHT dasselbe wie</div>
                    <ul class="definition-list not-same">
                        ${def.notTheSameAs.map(n => `<li>${n}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Varianten</div>
                    <ul class="definition-list variants">
                        ${def.variants.map(v => `<li>${v}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDefinitionModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('definitionModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ========================================
        // Definition Modal Swipe Navigation
        // ========================================
        let currentDefinitionIndex = 0;
        let currentDefinitionPerson = 'ich'; // Track whether showing 'ich' or 'partner'
        let definitionTouchStartX = 0;

        function handleDefinitionTouchStart(e) {
            definitionTouchStartX = e.touches[0].clientX;
        }

        function handleDefinitionTouchEnd(e) {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = definitionTouchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                navigateDefinition(diff > 0 ? 1 : -1);
            }
        }

        function navigateDefinition(direction) {
            currentDefinitionIndex += direction;
            if (currentDefinitionIndex < 0) currentDefinitionIndex = archetypeOrder.length - 1;
            if (currentDefinitionIndex >= archetypeOrder.length) currentDefinitionIndex = 0;

            const newArchetype = archetypeOrder[currentDefinitionIndex];
            showArchetypeInfoByType(newArchetype);
        }

        function showArchetypeInfoByType(archetypeId) {
            if (!data || !data.archetypes || !data.archetypes[archetypeId]) {
                console.error('Data not available for archetype:', archetypeId);
                return;
            }

            const arch = data.archetypes[archetypeId];
            const def = archetypeDefinitions[archetypeId];

            // Top navigation dots and swipe hint
            let topNav = `
                <div class="definition-nav-dots" style="display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                    ${archetypeOrder.map((id, index) => `
                        <span class="definition-dot${index === currentDefinitionIndex ? ' active' : ''}"
                              onclick="navigateDefinitionToIndex(${index})"
                              style="width: 10px; height: 10px; border-radius: 50%; background: ${index === currentDefinitionIndex ? 'var(--primary)' : 'var(--border)'}; cursor: pointer; transition: all 0.2s;"></span>
                    `).join('')}
                </div>
                <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-bottom: 15px;">← Wischen zum Navigieren →</div>
            `;

            let modalContent = topNav + `
                <div class="modal-category">
                    <div class="modal-category-header">
                        <div class="modal-category-letter" style="background: ${arch.color}; width: 40px; height: 40px; font-size: 20px;">${icons[archetypeId]}</div>
                        <div class="modal-category-name">${arch.name}</div>
                    </div>
                    <div class="modal-category-desc">${arch.shortDescription || ''}</div>
            `;

            if (def) {
                modalContent += `
                    <div class="definition-long" style="margin-top: 15px;">${def.longDef || ''}</div>
                `;

                if (def.keyPrinciples && def.keyPrinciples.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">Kernprinzipien</div>
                            <ul class="definition-list principles">
                                ${def.keyPrinciples.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }

                if (def.notTheSameAs && def.notTheSameAs.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">Das ist NICHT</div>
                            <ul class="definition-list not-same">
                                ${def.notTheSameAs.map(n => `<li>${n}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }

                if (def.variants && def.variants.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">Varianten</div>
                            <ul class="definition-list variants">
                                ${def.variants.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            // Add Pathos & Logos section
            const pathos = arch.pathos || '';
            const logos = arch.logos || '';

            if (pathos || logos) {
                modalContent += `
                    <div class="definition-section" style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px;">
                        <div class="definition-section-title" style="margin-bottom: 15px;">Pathos & Logos</div>
                `;

                if (pathos) {
                    modalContent += `
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(231,76,60,0.1); border-radius: 10px; border-left: 3px solid #e74c3c;">
                            <div style="color: #e74c3c; font-weight: 600; font-size: 13px; margin-bottom: 6px;">Pathos (Emotionale Ebene)</div>
                            <p style="color: var(--text-secondary); font-style: italic; line-height: 1.5; font-size: 12px; margin: 0;">${pathos}</p>
                        </div>
                    `;
                }

                if (logos) {
                    modalContent += `
                        <div style="padding: 12px; background: rgba(52,152,219,0.1); border-radius: 10px; border-left: 3px solid #3498db;">
                            <div style="color: #3498db; font-weight: 600; font-size: 13px; margin-bottom: 6px;">Logos (Rationale Ebene)</div>
                            <p style="color: var(--text-secondary); font-style: italic; line-height: 1.5; font-size: 12px; margin: 0;">${logos}</p>
                        </div>
                    `;
                }

                modalContent += `</div>`;
            }

            modalContent += '</div>';

            // Add navigation dots and confirm button
            modalContent += `
                <div class="definition-nav-dots" style="display: flex; justify-content: center; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                    ${archetypeOrder.map((id, index) => `
                        <span class="definition-dot${index === currentDefinitionIndex ? ' active' : ''}"
                              onclick="navigateDefinitionToIndex(${index})"
                              style="width: 10px; height: 10px; border-radius: 50%; background: ${index === currentDefinitionIndex ? 'var(--primary)' : 'var(--border)'}; cursor: pointer; transition: all 0.2s;"></span>
                    `).join('')}
                </div>
                <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-top: 8px;">← Wischen zum Navigieren →</div>
                <button onclick="confirmDefinitionSelection()" style="
                    display: block;
                    width: 100%;
                    margin-top: 15px;
                    padding: 12px 20px;
                    background: var(--primary);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                    Auswahl übernehmen
                </button>
            `;

            document.getElementById('definitionModalTitle').textContent = `${arch.name} - Definition`;
            document.getElementById('definitionModalBody').innerHTML = modalContent;
        }

        function navigateDefinitionToIndex(index) {
            currentDefinitionIndex = index;
            showArchetypeInfoByType(archetypeOrder[index]);
        }

        function confirmDefinitionSelection() {
            console.log('confirmDefinitionSelection called');
            console.log('currentDefinitionIndex:', currentDefinitionIndex);
            console.log('archetypeOrder:', archetypeOrder);

            const selectedArchetype = archetypeOrder[currentDefinitionIndex];
            console.log('selectedArchetype:', selectedArchetype);
            console.log('currentDefinitionPerson:', currentDefinitionPerson);

            if (currentDefinitionPerson === 'ich') {
                // Update main dropdown
                currentArchetype = selectedArchetype;
                const selectElement = document.getElementById('archetypeSelect');
                if (selectElement) {
                    selectElement.value = selectedArchetype;
                    // Dispatch change event to ensure listeners are notified
                    selectElement.dispatchEvent(new Event('change', { bubbles: true }));
                }
                console.log('Updated currentArchetype to:', currentArchetype);
                updateAll();
            } else {
                // Update partner selection
                console.log('Calling selectPartner with:', selectedArchetype);
                selectPartner(selectedArchetype);
            }

            // Close modal
            document.getElementById('definitionModal').classList.remove('active');
            document.body.style.overflow = '';
            console.log('Modal closed, selection complete');
        }

        // Get short definition for tooltip
        function getShortDef(archetypeId) {
            return archetypeDefinitions[archetypeId]?.shortDef || '';
        }

        // Store current match data for modal access
        let currentTopMatch = { id: null, score: 0 };
        let currentChallenge = { id: null, score: 0 };
        let modalContextPartner = null; // Track which partner to use in category modal

        // Match Modal Functions
        function openMatchModal(type) {
            const matchData = type === 'top' ? currentTopMatch : currentChallenge;
            if (!matchData.id) return;

            // Set the modal context to use this match's partner
            modalContextPartner = matchData.id;

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[matchData.id];
            const interactionKey = `${currentArchetype}_${matchData.id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const title = type === 'top' ? 'Top Match' : 'Challenge';
            const scoreColor = getScoreColor(matchData.score);

            document.getElementById('modalTitle').textContent = `${myArch.name} + ${partnerArch.name}`;
            document.getElementById('modalBody').innerHTML = getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch) {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const overall = interaction.overall || 0;
            const isIdenticalType = myArch.id === partnerArch.id;

            const categoryBars = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                // Special note for identical types on category A (Beziehungsphilosophie)
                const isPhilosophyCategory = cat === 'A' && isIdenticalType;
                const specialNote = isPhilosophyCategory
                    ? '<div style="font-size: 10px; color: var(--success); margin-top: 2px;">Identische Grundüberzeugung</div>'
                    : '';

                return `
                    <div class="match-modal-bar-row clickable" onclick="openSingleCategoryModal('${cat}')">
                        <span class="match-modal-bar-label">${cat}</span>
                        <div class="match-modal-bar-container">
                            <div class="match-modal-bar ${barClass}" style="width: ${value}%">
                                <span class="match-modal-bar-value">${value}%</span>
                            </div>
                            ${specialNote}
                        </div>
                        <span class="match-modal-bar-name">${name}</span>
                    </div>
                `;
            }).join('');

            const proItems = (interaction.pro || []).map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';
            const contraItems = (interaction.contra || []).map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';

            // Special banner for identical types
            const identicalTypeBanner = isIdenticalType ? `
                <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(46, 204, 113, 0.05));
                            border: 1px solid var(--success); border-radius: 10px; padding: 12px; margin-bottom: 15px; text-align: center;">
                    <div style="font-weight: 600; color: var(--success); margin-bottom: 4px;">✓ Identischer Beziehungstyp</div>
                    <div style="font-size: var(--font-sm); color: var(--text-secondary);">
                        Ihr teilt dieselbe Grundüberzeugung über Beziehungen
                    </div>
                </div>
            ` : '';

            const comboText = `${myArch.name} + ${partnerArch.name}`;
            const myDef = archetypeDefinitions[myArch.id]?.shortDef || '';
            const partnerDef = archetypeDefinitions[partnerArch.id]?.shortDef || '';

            return `
                <div class="modal-feedback-btn" onclick="openFeedbackModalWithContext('${comboText}')">
                    💬 Feedback zu ${comboText}
                </div>

                <div class="match-modal-header">
                    <div class="match-modal-icon" style="background: ${partnerArch.color}">${icons[partnerArch.id]}</div>
                    <div class="match-modal-info">
                        <h3 style="color: ${partnerArch.color}">
                            ${partnerArch.name}
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" title="Definition anzeigen">ℹ</span>
                        </h3>
                        <p>${partnerArch.shortDescription || ''}</p>
                    </div>
                </div>

                ${identicalTypeBanner}

                <div class="type-definitions-compact" style="background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 15px; font-size: var(--font-sm);">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${myArch.color}; font-weight: 600;">${icons[myArch.id]} ${myArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${myArch.id}')" style="margin-left: 4px;">ℹ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${myDef}</div>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${partnerArch.color}; font-weight: 600;">${icons[partnerArch.id]} ${partnerArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" style="margin-left: 4px;">ℹ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${partnerDef}</div>
                        </div>
                    </div>
                </div>

                <div class="match-modal-score">
                    <span class="match-modal-score-label">Beziehungsqualität ${isIdenticalType ? '(gleicher Typ)' : 'mit ' + myArch.name}</span>
                    <span class="match-modal-score-value" style="color: ${scoreColor}">${overall}%</span>
                </div>

                <div class="match-modal-categories">
                    <div class="match-modal-categories-title">Kategorie-Bewertungen</div>
                    ${categoryBars}
                </div>

                <div class="match-modal-section pro">
                    <div class="match-modal-section-title">✓ Was funktioniert</div>
                    <ul class="match-modal-list">${proItems}</ul>
                </div>

                <div class="match-modal-section contra">
                    <div class="match-modal-section-title">✗ Herausforderungen</div>
                    <ul class="match-modal-list">${contraItems}</ul>
                </div>
            `;
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCategoryModal();
                closeFeedbackModal();
            }
        });

        // ==========================================
        // FEEDBACK SYSTEM
        // ==========================================

        // Google Apps Script URL für Feedback
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzVTunE4KlRRmxtjgUU-MoT-Xpz6TuyYKoNmWEnDpO0KsL2S2R00DQcX3USFCA3W07m/exec';

        let feedbackData = [];
        let feedbackRatings = { verstand: 0, gefuehl: 0 };
        let replyToId = null; // For reply functionality

        // Advanced filter state
        let feedbackFilters = {
            search: '',
            myType: 'all',
            partnerType: 'all',
            category: 'all',
            sort: 'newest'
        };

        // Get current context ID based on what's visible
        function getCurrentContextId() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);

            const myType = currentArchetype.toUpperCase();
            const partner = selectedPartner.toUpperCase();

            switch(currentCard) {
                case 0:
                    return `S1-${myType}`;
                case 1:
                    return `S2-${myType}-${partner}`;
                case 2:
                    return `S3`;
                case 3:
                    return `S4`;
                default:
                    return `S${currentCard + 1}`;
            }
        }

        // Get context ID for modals
        function getModalContextId() {
            const categoryModal = document.getElementById('categoryModal');
            if (categoryModal.classList.contains('active')) {
                const modalTitle = document.getElementById('modalTitle').textContent;
                const myArch = data.archetypes[currentArchetype];
                const partnerId = modalContextPartner || selectedPartner;
                const partnerArch = data.archetypes[partnerId];
                const combo = `${myArch?.name || '?'} (Ich) mit ${partnerArch?.name || '?'}`;

                if (modalTitle.includes('Kategorie')) {
                    const cat = modalTitle.replace('Kategorie ', '').trim();
                    const catName = categoryNames[cat] || cat;
                    return `${combo} | ${catName}`;
                } else if (modalTitle.includes('+')) {
                    // Match modal (Top Match or Challenge)
                    const matchType = (currentTopMatch.id && modalContextPartner === currentTopMatch.id) ? 'Top Match' : 'Challenge';
                    return `${combo} | ${matchType}`;
                }
            }
            return getCurrentContextId();
        }

        // Open feedback modal
        function openFeedbackModal() {
            replyToId = null; // Reset reply state for new feedback
            const contextId = getModalContextId();
            document.getElementById('feedbackContextId').textContent = contextId;
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackTitle').value = '';
            document.getElementById('feedbackComment').value = '';
            feedbackRatings = { verstand: 0, gefuehl: 0 };
            updateStarDisplay('ratingVerstand', 0);
            updateStarDisplay('ratingGefuehl', 0);
        }

        // Open feedback modal with specific context
        function openFeedbackModalWithContext(contextText) {
            replyToId = null;
            document.getElementById('feedbackContextId').textContent = contextText;
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackTitle').value = '';
            document.getElementById('feedbackComment').value = '';
            feedbackRatings = { verstand: 0, gefuehl: 0 };
            updateStarDisplay('ratingVerstand', 0);
            updateStarDisplay('ratingGefuehl', 0);
        }

        function closeFeedbackModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('feedbackModal').classList.remove('active');
            document.body.style.overflow = '';
            replyToId = null; // Reset on close
        }

        // Star rating functionality
        function updateStarDisplay(containerId, value) {
            const container = document.getElementById(containerId);
            container.querySelectorAll('.star').forEach((star, i) => {
                star.classList.toggle('active', i < value);
            });
        }

        function initStarRatings() {
            ['ratingVerstand', 'ratingGefuehl'].forEach(containerId => {
                const container = document.getElementById(containerId);
                const ratingKey = containerId === 'ratingVerstand' ? 'verstand' : 'gefuehl';

                container.querySelectorAll('.star').forEach(star => {
                    star.addEventListener('click', () => {
                        const value = parseInt(star.dataset.value);
                        feedbackRatings[ratingKey] = value;
                        updateStarDisplay(containerId, value);
                    });

                    star.addEventListener('mouseenter', () => {
                        const value = parseInt(star.dataset.value);
                        container.querySelectorAll('.star').forEach((s, i) => {
                            s.style.color = i < value ? '#f1c40f' : '';
                        });
                    });

                    star.addEventListener('mouseleave', () => {
                        container.querySelectorAll('.star').forEach((s, i) => {
                            s.style.color = i < feedbackRatings[ratingKey] ? '#f1c40f' : '';
                        });
                    });
                });
            });
        }

        // Submit feedback
        // Generate unique ID
        function generateFeedbackId() {
            return 'fb_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        async function submitFeedback() {
            const name = document.getElementById('feedbackName').value.trim();
            const titel = document.getElementById('feedbackTitle').value.trim();
            const kommentar = document.getElementById('feedbackComment').value.trim();
            const kontextId = replyToId
                ? document.getElementById('feedbackContextId').textContent
                : getModalContextId();

            // Validation
            if (!name) {
                alert('Bitte gib deinen Namen/Kürzel ein.');
                return;
            }
            if (!titel) {
                alert('Bitte gib einen Titel ein.');
                return;
            }

            const feedbackEntry = {
                id: generateFeedbackId(),
                kontextId,
                name,
                titel,
                kommentar,
                verstand: feedbackRatings.verstand,
                gefuehl: feedbackRatings.gefuehl,
                antwortAuf: replyToId || ''
            };

            const submitBtn = document.getElementById('feedbackSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sende...';

            try {
                if (GOOGLE_SCRIPT_URL) {
                    // Send to Google Sheets
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(feedbackEntry)
                    });
                }

                // Also save locally as backup
                saveLocalFeedback(feedbackEntry);

                alert('Danke für dein Feedback!');
                replyToId = null; // Reset reply state
                closeFeedbackModal();

                // Reload feedback to show the new entry
                setTimeout(() => loadFeedback(), 500);

            } catch (error) {
                console.error('Feedback error:', error);
                // Save locally on error
                saveLocalFeedback(feedbackEntry);
                alert('Feedback lokal gespeichert. (Server nicht erreichbar)');
                replyToId = null;
                closeFeedbackModal();
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Senden';
        }

        // Local storage backup - alles in tiage_comments
        function saveLocalFeedback(entry) {
            const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
            entry.timestamp = new Date().toISOString();
            entry.Typ = 'comment';  // Einheitlicher Typ
            stored.unshift(entry);
            localStorage.setItem('tiage_comments', JSON.stringify(stored));
        }

        function getLocalFeedback() {
            return JSON.parse(localStorage.getItem('tiage_comments') || '[]');
        }

        // Load and display feedback
        async function loadFeedback() {
            const container = document.getElementById('feedbackList');

            try {
                if (GOOGLE_SCRIPT_URL) {
                    // Try to load from Google Sheets
                    const response = await fetch(GOOGLE_SCRIPT_URL);
                    const serverData = await response.json();
                    feedbackData = serverData.reverse(); // Newest first
                } else {
                    // Use local data only
                    feedbackData = getLocalFeedback();
                }
            } catch (error) {
                console.error('Load feedback error:', error);
                // Fallback to local
                feedbackData = getLocalFeedback();
            }

            // Populate type filter dropdowns
            populateTypeFilters();
            renderFeedbackList();
        }

        // Populate type dropdowns for filters
        function populateTypeFilters() {
            const archetypes = Object.values(data?.archetypes || {});
            const myTypeSelect = document.getElementById('filterMyType');
            const partnerTypeSelect = document.getElementById('filterPartnerType');

            const options = archetypes.map(a =>
                `<option value="${a.id}">${a.name}</option>`
            ).join('');

            myTypeSelect.innerHTML = `<option value="all">Alle Typen</option>${options}`;
            partnerTypeSelect.innerHTML = `<option value="all">Alle Partner</option>${options}`;
        }

        function renderFeedbackList() {
            const container = document.getElementById('feedbackList');

            // Apply all filters
            let filtered = feedbackData.filter(f => {
                const kontextId = (f.KontextID || f.kontextId || '').toLowerCase();
                const name = (f.Name || f.name || '').toLowerCase();
                const titel = (f.Titel || f.titel || '').toLowerCase();
                const kommentar = (f.Kommentar || f.kommentar || '').toLowerCase();
                const antwortAuf = f.AntwortAuf || f.antwortAuf || '';

                // Skip replies in main list (they'll be shown as threads)
                if (antwortAuf) return false;

                // Search filter
                if (feedbackFilters.search) {
                    const search = feedbackFilters.search.toLowerCase();
                    if (!name.includes(search) && !titel.includes(search) && !kommentar.includes(search)) {
                        return false;
                    }
                }

                // Type filters (parse from context ID like "Single (Ich) mit Duo")
                if (feedbackFilters.myType !== 'all' || feedbackFilters.partnerType !== 'all') {
                    const myTypeName = data?.archetypes?.[feedbackFilters.myType]?.name?.toLowerCase();
                    const partnerTypeName = data?.archetypes?.[feedbackFilters.partnerType]?.name?.toLowerCase();

                    if (feedbackFilters.myType !== 'all' && myTypeName) {
                        if (!kontextId.includes(myTypeName)) return false;
                    }
                    if (feedbackFilters.partnerType !== 'all' && partnerTypeName) {
                        if (!kontextId.includes('mit ' + partnerTypeName)) return false;
                    }
                }

                // Category filter
                if (feedbackFilters.category !== 'all') {
                    const cat = feedbackFilters.category;
                    if (cat === 'TM') {
                        if (!kontextId.includes('top match')) return false;
                    } else if (cat === 'CH') {
                        if (!kontextId.includes('challenge')) return false;
                    } else {
                        // Category A-F: check for category name
                        const catName = categoryNames[cat]?.toLowerCase();
                        if (catName && !kontextId.includes(catName)) return false;
                    }
                }

                return true;
            });

            // Sort
            if (feedbackFilters.sort === 'oldest') {
                filtered = filtered.reverse();
            } else if (feedbackFilters.sort === 'rating') {
                filtered.sort((a, b) => {
                    const aRating = (a.Verstand || a.verstand || 0) + (a.Gefuehl || a.gefuehl || 0);
                    const bRating = (b.Verstand || b.verstand || 0) + (b.Gefuehl || b.gefuehl || 0);
                    return bRating - aRating;
                });
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="feedback-empty">
                        ${feedbackData.length === 0
                            ? 'Noch kein Feedback vorhanden.<br>Sei der Erste!'
                            : 'Kein Feedback für diesen Filter.'}
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(f => renderFeedbackItem(f)).join('');
        }

        // Render single feedback item with replies
        function renderFeedbackItem(f, isReply = false) {
            const id = f.Id || f.id || f.timestamp || '';
            const kontextId = f.KontextID || f.kontextId || '-';
            const name = f.Name || f.name || 'Anonym';
            const titel = f.Titel || f.titel || '';
            const kommentar = f.Kommentar || f.kommentar || '';
            const verstand = f.Verstand || f.verstand || 0;
            const gefuehl = f.Gefuehl || f.gefuehl || 0;
            const timestamp = f.Timestamp || f.timestamp || '';

            // Find replies to this item
            const replies = feedbackData.filter(r =>
                (r.AntwortAuf || r.antwortAuf) === id
            );

            const timeStr = timestamp ? new Date(timestamp).toLocaleDateString('de-DE') : '';

            return `
                <div class="feedback-item ${isReply ? 'reply' : ''}" data-id="${id}">
                    <div class="feedback-item-header">
                        <span class="feedback-item-context">${kontextId}</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="feedback-item-name">${name}</span>
                            ${timeStr ? `<span class="feedback-timestamp">${timeStr}</span>` : ''}
                        </div>
                    </div>
                    <div class="feedback-item-title">${titel}</div>
                    ${kommentar ? `<div class="feedback-item-comment">${kommentar}</div>` : ''}
                    <div class="feedback-item-footer">
                        <div class="feedback-item-ratings">
                            <div class="feedback-rating">
                                <span>Verstand:</span>
                                <span class="stars">${'★'.repeat(verstand)}${'☆'.repeat(5-verstand)}</span>
                            </div>
                            <div class="feedback-rating">
                                <span>Gefühl:</span>
                                <span class="stars">${'★'.repeat(gefuehl)}${'☆'.repeat(5-gefuehl)}</span>
                            </div>
                        </div>
                        <button class="feedback-reply-btn" onclick="openReplyModal('${id}', '${name}')">
                            ↩ Antworten
                        </button>
                    </div>
                    ${replies.length > 0 ? `
                        <div class="feedback-replies">
                            ${replies.map(r => renderFeedbackItem(r, true)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Open reply modal
        function openReplyModal(parentId, parentName) {
            replyToId = parentId;
            document.getElementById('feedbackContextId').innerHTML =
                `<span class="reply-indicator">↩ Antwort auf ${parentName}</span>`;
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackTitle').value = '';
            document.getElementById('feedbackComment').value = '';
            feedbackRatings = { verstand: 0, gefuehl: 0 };
            updateStarDisplay('ratingVerstand', 0);
            updateStarDisplay('ratingGefuehl', 0);
        }

        // Initialize advanced filters
        function initAdvancedFilters() {
            // Search input
            document.getElementById('feedbackSearch').addEventListener('input', (e) => {
                feedbackFilters.search = e.target.value;
                renderFeedbackList();
            });

            // Type selects
            document.getElementById('filterMyType').addEventListener('change', (e) => {
                feedbackFilters.myType = e.target.value;
                renderFeedbackList();
            });

            document.getElementById('filterPartnerType').addEventListener('change', (e) => {
                feedbackFilters.partnerType = e.target.value;
                renderFeedbackList();
            });

            // Category buttons
            document.querySelectorAll('.cat-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.cat-filter-btn').forEach(b =>
                        b.classList.remove('active')
                    );
                    btn.classList.add('active');
                    feedbackFilters.category = btn.dataset.cat;
                    renderFeedbackList();
                });
            });

            // Sort select
            document.getElementById('filterSort').addEventListener('change', (e) => {
                feedbackFilters.sort = e.target.value;
                renderFeedbackList();
            });
        }

        // Initialize feedback system
        function initFeedbackSystem() {
            initStarRatings();
            initAdvancedFilters();
        }

        // Age Verification - Modal shows on EVERY visit (no localStorage)
        function checkAgeVerification() {
            // Modal always shows - no localStorage check
            const modal = document.getElementById('ageVerificationModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
                document.body.style.overflow = 'hidden';
            }
        }

        // Make confirmAge globally available - no localStorage storage
        window.confirmAge = function(isAdult) {
            console.log('confirmAge called with:', isAdult);
            if (isAdult) {
                var modal = document.getElementById('ageVerificationModal');
                if (modal) {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                }
                document.body.style.overflow = 'auto';
            } else {
                window.location.href = 'https://www.google.com';
            }
        };

        // Also keep the regular function reference
        function confirmAge(isAdult) {
            window.confirmAge(isAdult);
        }

        // Initialize age verification - robust version with multiple fallbacks
        function initAgeVerification() {
            const modal = document.getElementById('ageVerificationModal');
            const yesButton = document.getElementById('ageVerifyYes');
            const noButton = document.getElementById('ageVerifyNo');

            // Helper function to handle age confirmation - no localStorage
            function handleAgeConfirm(isAdult, event) {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                console.log('handleAgeConfirm called:', isAdult);

                if (isAdult) {
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        modal.style.pointerEvents = 'none';
                    }
                    document.body.style.overflow = 'auto';
                } else {
                    window.location.href = 'https://www.google.com';
                }
            }

            // Add event listeners to YES button
            if (yesButton) {
                yesButton.style.pointerEvents = 'auto';
                yesButton.style.cursor = 'pointer';
                yesButton.style.position = 'relative';
                yesButton.style.zIndex = '10002';

                // Remove old onclick to prevent double-firing
                yesButton.removeAttribute('onclick');

                // Add multiple event types for maximum compatibility
                yesButton.addEventListener('click', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });

                yesButton.addEventListener('touchend', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });

                // Also handle mousedown as fallback
                yesButton.addEventListener('mousedown', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });
            }

            // Add event listeners to NO button
            if (noButton) {
                noButton.style.pointerEvents = 'auto';
                noButton.style.cursor = 'pointer';
                noButton.style.position = 'relative';
                noButton.style.zIndex = '10002';

                // Remove old onclick
                noButton.removeAttribute('onclick');

                noButton.addEventListener('click', function(e) {
                    handleAgeConfirm(false, e);
                }, { passive: false, capture: true });

                noButton.addEventListener('touchend', function(e) {
                    handleAgeConfirm(false, e);
                }, { passive: false, capture: true });
            }

            // Always show modal on page load - no localStorage check
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
                document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
            }
        }

        // ========================================
        // Extended Dimensions Functions
        // ========================================

        function showDimensionTooltip(type) {
            const tooltip = dimensionTooltips[type];
            if (!tooltip) return;

            document.getElementById('dimensionTooltipTitle').textContent = tooltip.title;
            document.getElementById('dimensionTooltipText').textContent = tooltip.text;
            document.getElementById('dimensionTooltipOverlay').classList.add('active');
        }

        function closeDimensionTooltip() {
            document.getElementById('dimensionTooltipOverlay').classList.remove('active');
        }

        // ========================================
        // Status Popup Functions (for all orientations)
        // ========================================
        let currentStatusPopupPerson = null;

        function showStatusPopup(person) {
            currentStatusPopupPerson = person;
            document.getElementById('statusPopupOverlay').classList.add('active');
        }

        function closeStatusPopup() {
            document.getElementById('statusPopupOverlay').classList.remove('active');
            currentStatusPopupPerson = null;
        }

        function selectStatusFromPopup(status) {
            if (!currentStatusPopupPerson) return;

            const person = currentStatusPopupPerson;
            personDimensions[person].orientierungStatus = status;
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].orientierungStatus = status;
            }

            // Update the corresponding desktop radio button
            const desktopRadioId = person === 'ich'
                ? (status === 'fakt' ? 'ich-s-fakt' : 'ich-s-int')
                : (status === 'fakt' ? 'partner-s-fakt' : 'partner-s-int');
            const desktopRadio = document.getElementById(desktopRadioId);
            if (desktopRadio) {
                desktopRadio.checked = true;
            }

            // Update the corresponding mobile radio button
            const mobileRadioId = person === 'ich'
                ? (status === 'fakt' ? 'm-ich-s-fakt' : 'm-ich-s-int')
                : (status === 'fakt' ? 'm-partner-s-fakt' : 'm-partner-s-int');
            const mobileRadio = document.getElementById(mobileRadioId);
            if (mobileRadio) {
                mobileRadio.checked = true;
            }

            // Update the corresponding modal radio button
            const modalRadioId = person + '-status-' + (status === 'fakt' ? 'fakt' : 'interessiert');
            const modalRadio = document.getElementById(modalRadioId);
            if (modalRadio) {
                modalRadio.checked = true;
            }

            // Remove needs-selection class from all sections
            const desktopStatusSection = document.getElementById(person + '-status-section');
            if (desktopStatusSection) {
                desktopStatusSection.classList.remove('needs-selection');
            }
            const mobileStatusSection = document.getElementById('mobile-' + person + '-status-section');
            if (mobileStatusSection) {
                mobileStatusSection.classList.remove('needs-selection');
            }
            const modalStatusSection = document.getElementById('modal-' + person + '-status-section');
            if (modalStatusSection) {
                modalStatusSection.classList.remove('needs-selection');
            }

            closeStatusPopup();
            updateComparisonView();

            // Save to localStorage
            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        function handleOrientationChange(person, orientation, isMobile = false) {
            personDimensions[person].orientierung = orientation;
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].orientierung = orientation;
            }

            // Get all status sections (desktop, mobile, modal)
            const desktopStatusSection = document.getElementById(person + '-status-section');
            const mobileStatusSection = document.getElementById('mobile-' + person + '-status-section');
            const modalStatusSection = document.getElementById('modal-' + person + '-status-section');

            // Show status section and popup for all orientations (hetero, homo, bi)
            if (desktopStatusSection) {
                desktopStatusSection.style.display = 'block';
            }
            if (mobileStatusSection) {
                mobileStatusSection.style.display = 'block';
            }
            if (modalStatusSection) {
                modalStatusSection.style.display = 'block';
            }
            showStatusPopup(person);

            // Sync orientation to desktop if called from mobile
            if (isMobile) {
                syncDimensionToDesktop(person + '-orientierung-new', orientation);
            }

            updateComparisonView();

            // Save to localStorage
            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // ========================================
        // Dominanz Multi-Select Functions
        // ========================================

        // Handle checkbox change for dominanz multi-select
        function handleDominanzMultiChange(person, dominanzType, isChecked) {
            if (isChecked) {
                // Show status toggle and default to 'fakt'
                personDimensions[person].dominanz[dominanzType] = 'fakt';
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].dominanz[dominanzType] = 'fakt';
                }

                // Show the status toggle group
                const statusGroup = document.getElementById(person + '-d-' + getShortDominanzId(dominanzType) + '-status');
                if (statusGroup) {
                    statusGroup.style.display = 'flex';
                }
            } else {
                // Remove selection
                personDimensions[person].dominanz[dominanzType] = null;
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].dominanz[dominanzType] = null;
                }

                // Hide the status toggle group
                const statusGroup = document.getElementById(person + '-d-' + getShortDominanzId(dominanzType) + '-status');
                if (statusGroup) {
                    statusGroup.style.display = 'none';
                }
            }

            // Sync all UIs (Desktop, Mobile, Modal)
            if (typeof syncDominanzUI === 'function') {
                syncDominanzUI(person);
            }

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Handle status toggle button click for dominanz
        function handleDominanzStatusToggle(person, dominanzType, status, btn) {
            personDimensions[person].dominanz[dominanzType] = status;
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].dominanz[dominanzType] = status;
            }

            // Sync all UIs
            if (typeof syncDominanzUI === 'function') {
                syncDominanzUI(person);
            }

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Handle status change for a specific dominanz type (backwards compatibility)
        function handleDominanzStatusChange(person, dominanzType, status) {
            handleDominanzStatusToggle(person, dominanzType, status, null);
        }

        // Mobile: Handle checkbox change for multi-select dominanz
        function handleMobileDominanzMultiChange(person, dominanzType, isChecked) {
            if (isChecked) {
                // Set default status to 'fakt'
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].dominanz[dominanzType] = 'fakt';
                }
                personDimensions[person].dominanz[dominanzType] = 'fakt';

                // Show the status toggle group
                const statusGroup = document.getElementById('m-' + person + '-d-' + getShortDominanzId(dominanzType) + '-status');
                if (statusGroup) {
                    statusGroup.style.display = 'flex';
                }
            } else {
                // Remove selection
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].dominanz[dominanzType] = null;
                }
                personDimensions[person].dominanz[dominanzType] = null;

                // Hide the status toggle group
                const statusGroup = document.getElementById('m-' + person + '-d-' + getShortDominanzId(dominanzType) + '-status');
                if (statusGroup) {
                    statusGroup.style.display = 'none';
                }
            }

            // Sync all UIs (Desktop, Mobile, Modal)
            if (typeof syncDominanzUI === 'function') {
                syncDominanzUI(person);
            }

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Mobile: Handle status toggle button click for dominanz
        function handleMobileDominanzStatusToggle(person, dominanzType, status, btn) {
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].dominanz[dominanzType] = status;
            }
            personDimensions[person].dominanz[dominanzType] = status;

            // Sync all UIs
            if (typeof syncDominanzUI === 'function') {
                syncDominanzUI(person);
            }

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Mobile: Handle status change for a specific dominanz type (backwards compatibility)
        function handleMobileDominanzStatusChange(person, dominanzType, status) {
            handleMobileDominanzStatusToggle(person, dominanzType, status, null);
        }

        // Modal: Handle checkbox change for multi-select dominanz
        function handleModalDominanzMultiChange(person, dominanzType, isChecked) {
            if (isChecked) {
                // Set default status to 'fakt'
                personDimensions[person].dominanz[dominanzType] = 'fakt';
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].dominanz[dominanzType] = 'fakt';
                }

                // Show the status toggle group
                const statusGroup = document.getElementById('modal-' + person + '-d-' + getShortDominanzId(dominanzType) + '-status');
                if (statusGroup) {
                    statusGroup.style.display = 'flex';
                }
            } else {
                // Remove selection
                personDimensions[person].dominanz[dominanzType] = null;
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].dominanz[dominanzType] = null;
                }

                // Hide the status toggle group
                const statusGroup = document.getElementById('modal-' + person + '-d-' + getShortDominanzId(dominanzType) + '-status');
                if (statusGroup) {
                    statusGroup.style.display = 'none';
                }
            }

            // Remove needs-selection if at least one dominanz is selected
            const dimensionContainer = document.querySelector(`[data-dimension="modal-${person}-dominanz-multi"]`);
            if (dimensionContainer && hasAnyDominanzSelected(person)) {
                dimensionContainer.classList.remove('needs-selection');
            }

            // Sync Desktop and Mobile UIs
            syncDominanzUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Modal: Handle status toggle button click for dominanz
        function handleModalDominanzStatusToggle(person, dominanzType, status, btn) {
            personDimensions[person].dominanz[dominanzType] = status;
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].dominanz[dominanzType] = status;
            }

            // Sync Desktop and Mobile UIs
            syncDominanzUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Modal: Handle status change for a specific dominanz type (backwards compatibility)
        function handleModalDominanzStatusChange(person, dominanzType, status) {
            handleModalDominanzStatusToggle(person, dominanzType, status, null);
        }

        // Helper: Update toggle button states for a status group
        function updateStatusToggleButtons(statusGroup, status) {
            if (!statusGroup) return;
            const buttons = statusGroup.querySelectorAll('.status-toggle-btn');
            buttons.forEach(btn => {
                const btnStatus = btn.getAttribute('data-status');
                btn.classList.remove('active-fakt', 'active-interessiert');
                if (btnStatus === status) {
                    btn.classList.add('active-' + status);
                }
            });
        }

        // Sync all Dominanz UIs (Desktop, Mobile, Modal)
        function syncDominanzUI(person) {
            const shortIdMap = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'aus' };
            const dom = personDimensions[person].dominanz;

            for (const [type, status] of Object.entries(dom)) {
                const shortId = shortIdMap[type];

                // Desktop
                const desktopCheckbox = document.getElementById(person + '-d-' + shortId);
                if (desktopCheckbox) desktopCheckbox.checked = !!status;
                const desktopStatus = document.getElementById(person + '-d-' + shortId + '-status');
                if (desktopStatus) {
                    desktopStatus.style.display = status ? 'flex' : 'none';
                    if (status) updateStatusToggleButtons(desktopStatus, status);
                }

                // Mobile
                const mobileCheckbox = document.getElementById('m-' + person + '-d-' + shortId);
                if (mobileCheckbox) mobileCheckbox.checked = !!status;
                const mobileStatus = document.getElementById('m-' + person + '-d-' + shortId + '-status');
                if (mobileStatus) {
                    mobileStatus.style.display = status ? 'flex' : 'none';
                    if (status) updateStatusToggleButtons(mobileStatus, status);
                }

                // Modal
                const modalCheckbox = document.getElementById('modal-' + person + '-d-' + shortId);
                if (modalCheckbox) modalCheckbox.checked = !!status;
                const modalStatus = document.getElementById('modal-' + person + '-d-' + shortId + '-status');
                if (modalStatus) {
                    modalStatus.style.display = status ? 'flex' : 'none';
                    if (status) updateStatusToggleButtons(modalStatus, status);
                }
            }

            // Update needs-selection classes
            const hasSelection = hasAnyDominanzSelected(person);
            ['', 'mobile-', 'modal-'].forEach(prefix => {
                const dim = document.querySelector(`[data-dimension="${prefix}${person}-dominanz-multi"]`);
                if (dim) {
                    if (hasSelection) dim.classList.remove('needs-selection');
                    else dim.classList.add('needs-selection');
                }
            });
        }

        // Helper: Get short ID for dominanz type
        function getShortDominanzId(dominanzType) {
            const map = {
                'dominant': 'dom',
                'submissiv': 'sub',
                'switch': 'sw',
                'ausgeglichen': 'aus'
            };
            return map[dominanzType] || dominanzType;
        }

        // Helper: Check if at least one dominanz is selected
        function hasAnyDominanzSelected(person) {
            const dom = personDimensions[person].dominanz;
            return dom.dominant || dom.submissiv || dom.switch || dom.ausgeglichen;
        }

        // Helper: Get all selected dominanz preferences with status
        function getSelectedDominanzList(person) {
            const dom = personDimensions[person].dominanz;
            const result = [];
            if (dom.dominant) result.push({ type: 'dominant', status: dom.dominant });
            if (dom.submissiv) result.push({ type: 'submissiv', status: dom.submissiv });
            if (dom.switch) result.push({ type: 'switch', status: dom.switch });
            if (dom.ausgeglichen) result.push({ type: 'ausgeglichen', status: dom.ausgeglichen });
            return result;
        }

        // ========================================
        // Orientierung Multi-Select Functions
        // ========================================

        // Helper: Get short ID for orientierung type
        function getShortOrientierungId(orientierungType) {
            const map = {
                'heterosexuell': 'het',
                'homosexuell': 'hom',
                'bisexuell': 'bi'
            };
            return map[orientierungType] || orientierungType;
        }

        // Helper: Check if at least one orientierung is selected
        function hasAnyOrientierungSelected(person) {
            const ori = personDimensions[person].orientierung;
            return ori.heterosexuell || ori.homosexuell || ori.bisexuell;
        }

        // Helper: Get all selected orientierung preferences with status
        function getSelectedOrientierungList(person) {
            const ori = personDimensions[person].orientierung;
            const result = [];
            if (ori.heterosexuell) result.push({ type: 'heterosexuell', status: ori.heterosexuell });
            if (ori.homosexuell) result.push({ type: 'homosexuell', status: ori.homosexuell });
            if (ori.bisexuell) result.push({ type: 'bisexuell', status: ori.bisexuell });
            return result;
        }

        // Handle checkbox change for orientierung multi-select (Desktop)
        function handleOrientierungMultiChange(person, orientierungType, isChecked) {
            if (isChecked) {
                // Set default status to 'fakt'
                personDimensions[person].orientierung[orientierungType] = 'fakt';
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].orientierung[orientierungType] = 'fakt';
                }

                // Show the status dropdown
                const statusSelect = document.getElementById(person + '-o-' + getShortOrientierungId(orientierungType) + '-status');
                if (statusSelect) {
                    statusSelect.style.display = 'inline-block';
                    statusSelect.value = 'fakt';
                }
            } else {
                // Remove selection
                personDimensions[person].orientierung[orientierungType] = null;
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].orientierung[orientierungType] = null;
                }

                // Hide the status dropdown
                const statusSelect = document.getElementById(person + '-o-' + getShortOrientierungId(orientierungType) + '-status');
                if (statusSelect) {
                    statusSelect.style.display = 'none';
                }
            }

            // Remove needs-selection if at least one orientierung is selected
            const dimensionContainer = document.querySelector(`[data-dimension="${person}-orientierung-multi"]`);
            if (dimensionContainer && hasAnyOrientierungSelected(person)) {
                dimensionContainer.classList.remove('needs-selection');
            }

            // Sync all UIs (Desktop, Mobile, Modal)
            syncOrientierungUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Handle status change for a specific orientierung type (Desktop)
        function handleOrientierungStatusChange(person, orientierungType, status) {
            personDimensions[person].orientierung[orientierungType] = status;
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].orientierung[orientierungType] = status;
            }

            // Sync all UIs
            syncOrientierungUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Mobile: Handle checkbox change for multi-select orientierung
        function handleMobileOrientierungMultiChange(person, orientierungType, isChecked) {
            if (isChecked) {
                // Set default status to 'fakt'
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].orientierung[orientierungType] = 'fakt';
                }
                personDimensions[person].orientierung[orientierungType] = 'fakt';

                // Show the status dropdown
                const statusSelect = document.getElementById('m-' + person + '-o-' + getShortOrientierungId(orientierungType) + '-status');
                if (statusSelect) {
                    statusSelect.style.display = 'inline-block';
                    statusSelect.value = 'fakt';
                }
            } else {
                // Remove selection
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].orientierung[orientierungType] = null;
                }
                personDimensions[person].orientierung[orientierungType] = null;

                // Hide the status dropdown
                const statusSelect = document.getElementById('m-' + person + '-o-' + getShortOrientierungId(orientierungType) + '-status');
                if (statusSelect) {
                    statusSelect.style.display = 'none';
                }
            }

            // Remove needs-selection if at least one orientierung is selected
            const dimensionContainer = document.querySelector(`[data-dimension="mobile-${person}-orientierung-multi"]`);
            if (dimensionContainer && hasAnyOrientierungSelected(person)) {
                dimensionContainer.classList.remove('needs-selection');
            }

            // Sync all UIs (Desktop, Mobile, Modal)
            syncOrientierungUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Mobile: Handle status change for a specific orientierung type
        function handleMobileOrientierungStatusChange(person, orientierungType, status) {
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].orientierung[orientierungType] = status;
            }
            personDimensions[person].orientierung[orientierungType] = status;

            // Sync all UIs
            syncOrientierungUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Modal: Handle checkbox change for multi-select orientierung
        function handleModalOrientierungMultiChange(person, orientierungType, isChecked) {
            if (isChecked) {
                // Set default status to 'fakt'
                personDimensions[person].orientierung[orientierungType] = 'fakt';
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].orientierung[orientierungType] = 'fakt';
                }

                // Show the status dropdown
                const statusSelect = document.getElementById('modal-' + person + '-o-' + getShortOrientierungId(orientierungType) + '-status');
                if (statusSelect) {
                    statusSelect.style.display = 'inline-block';
                    statusSelect.value = 'fakt';
                }
            } else {
                // Remove selection
                personDimensions[person].orientierung[orientierungType] = null;
                if (typeof mobilePersonDimensions !== 'undefined') {
                    mobilePersonDimensions[person].orientierung[orientierungType] = null;
                }

                // Hide the status dropdown
                const statusSelect = document.getElementById('modal-' + person + '-o-' + getShortOrientierungId(orientierungType) + '-status');
                if (statusSelect) {
                    statusSelect.style.display = 'none';
                }
            }

            // Remove needs-selection if at least one orientierung is selected
            const dimensionContainer = document.querySelector(`[data-dimension="modal-${person}-orientierung-multi"]`);
            if (dimensionContainer && hasAnyOrientierungSelected(person)) {
                dimensionContainer.classList.remove('needs-selection');
            }

            // Sync Desktop and Mobile UIs
            syncOrientierungUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Modal: Handle status change for a specific orientierung type
        function handleModalOrientierungStatusChange(person, orientierungType, status) {
            personDimensions[person].orientierung[orientierungType] = status;
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].orientierung[orientierungType] = status;
            }

            // Sync Desktop and Mobile UIs
            syncOrientierungUI(person);

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Sync all Orientierung UIs (Desktop, Mobile, Modal)
        function syncOrientierungUI(person) {
            const shortIdMap = { 'heterosexuell': 'het', 'homosexuell': 'hom', 'bisexuell': 'bi' };
            const ori = personDimensions[person].orientierung;

            for (const [type, status] of Object.entries(ori)) {
                const shortId = shortIdMap[type];

                // Desktop
                const desktopCheckbox = document.getElementById(person + '-o-' + shortId);
                if (desktopCheckbox) desktopCheckbox.checked = !!status;
                const desktopStatus = document.getElementById(person + '-o-' + shortId + '-status');
                if (desktopStatus) {
                    desktopStatus.style.display = status ? 'inline-block' : 'none';
                    if (status) desktopStatus.value = status;
                }

                // Mobile
                const mobileCheckbox = document.getElementById('m-' + person + '-o-' + shortId);
                if (mobileCheckbox) mobileCheckbox.checked = !!status;
                const mobileStatus = document.getElementById('m-' + person + '-o-' + shortId + '-status');
                if (mobileStatus) {
                    mobileStatus.style.display = status ? 'inline-block' : 'none';
                    if (status) mobileStatus.value = status;
                }

                // Modal
                const modalCheckbox = document.getElementById('modal-' + person + '-o-' + shortId);
                if (modalCheckbox) modalCheckbox.checked = !!status;
                const modalStatus = document.getElementById('modal-' + person + '-o-' + shortId + '-status');
                if (modalStatus) {
                    modalStatus.style.display = status ? 'inline-block' : 'none';
                    if (status) modalStatus.value = status;
                }
            }

            // Update needs-selection classes
            const hasSelection = hasAnyOrientierungSelected(person);
            ['', 'mobile-', 'modal-'].forEach(prefix => {
                const dim = document.querySelector(`[data-dimension="${prefix}${person}-orientierung-multi"]`);
                if (dim) {
                    if (hasSelection) dim.classList.remove('needs-selection');
                    else dim.classList.add('needs-selection');
                }
            });
        }

        function handleDimensionChange(person, dimension, value, element) {
            // Update state
            personDimensions[person][dimension] = value;

            // Remove needs-selection class from the parent group
            if (element) {
                const dimensionGroup = element.closest('.dimension-group, .dimension-status-group');
                if (dimensionGroup) {
                    dimensionGroup.classList.remove('needs-selection');
                }
            }

            // Visual feedback - highlight animation
            if (element) {
                const label = element.nextElementSibling;
                if (label) {
                    label.classList.add('highlight-change');
                    setTimeout(() => label.classList.remove('highlight-change'), 300);
                }
            }

            // Update overview box
            updateAnalysisOverview();

            // Re-run compatibility checks when dimensions change
            if (data) {
                updatePartnerView();
            }
        }

        function getGeschlechtKurz(geschlecht) {
            if (!geschlecht) return '?';
            const map = {
                'männlich': 'm',
                'weiblich': 'w',
                'non-binär': 'nb'
            };
            return map[geschlecht] || geschlecht;
        }

        function getDominanzKurz(dominanz) {
            // Handle multi-select object
            if (dominanz && typeof dominanz === 'object') {
                const parts = [];
                const map = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'ausg' };

                for (const [type, status] of Object.entries(dominanz)) {
                    if (status) {
                        let kurz = map[type] || type;
                        if (status === 'interessiert') kurz += '?';
                        parts.push(kurz);
                    }
                }

                return parts.length > 0 ? parts.join('+') : '?';
            }

            // Old single-value format (backwards compatibility)
            if (!dominanz) return '?';
            const map = {
                'dominant': 'dom',
                'submissiv': 'sub',
                'switch': 'sw',
                'ausgeglichen': 'ausg'
            };
            return map[dominanz] || dominanz;
        }

        function getOrientierungKurz(orientierung, status) {
            // Handle multi-select orientierung object
            if (orientierung && typeof orientierung === 'object') {
                const map = {
                    'heterosexuell': 'het',
                    'homosexuell': 'hom',
                    'bisexuell': 'bi'
                };
                const parts = [];
                if (orientierung.heterosexuell) {
                    parts.push(map['heterosexuell'] + (orientierung.heterosexuell === 'interessiert' ? '?' : ''));
                }
                if (orientierung.homosexuell) {
                    parts.push(map['homosexuell'] + (orientierung.homosexuell === 'interessiert' ? '?' : ''));
                }
                if (orientierung.bisexuell) {
                    parts.push(map['bisexuell'] + (orientierung.bisexuell === 'interessiert' ? '?' : ''));
                }
                return parts.length > 0 ? parts.join('/') : '?';
            }

            // Backwards compatibility for old single-value format
            if (!orientierung) return '?';
            const map = {
                'heterosexuell': 'hetero',
                'homosexuell': 'homo',
                'bisexuell': 'bi'
            };
            let kurz = map[orientierung] || orientierung;
            if (status === 'interessiert') {
                kurz += '(?)';
            }
            return kurz;
        }

        function updateAnalysisOverview() {
            const ichType = data?.archetypes[currentArchetype]?.name || currentArchetype;
            const partnerType = data?.archetypes[selectedPartner]?.name || selectedPartner;

            const ichDims = personDimensions.ich;
            const partnerDims = personDimensions.partner;

            const ichInfo = `(${getGeschlechtKurz(ichDims.geschlecht)}, ${getDominanzKurz(ichDims.dominanz)}, ${getOrientierungKurz(ichDims.orientierung, ichDims.orientierungStatus)})`;
            const partnerInfo = `(${getGeschlechtKurz(partnerDims.geschlecht)}, ${getDominanzKurz(partnerDims.dominanz)}, ${getOrientierungKurz(partnerDims.orientierung, partnerDims.orientierungStatus)})`;

            const content = document.getElementById('analysisOverviewContent');
            if (content) {
                content.innerHTML = `
                    <span class="type-name">${ichType}</span> <span class="dim-info">${ichInfo}</span>
                    <span> × </span>
                    <span class="type-name">${partnerType}</span> <span class="dim-info">${partnerInfo}</span>
                `;
            }
        }

        function initDimensionListeners() {
            // ICH dimensions
            document.querySelectorAll('input[name="ich-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('ich', 'geschlecht', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="ich-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleDominanzChange('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('ich', 'dominanzStatus', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="ich-orientierung"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleOrientationChange('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('ich', 'orientierungStatus', e.target.value, e.target));
            });

            // PARTNER dimensions
            document.querySelectorAll('input[name="partner-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('partner', 'geschlecht', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="partner-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleDominanzChange('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('partner', 'dominanzStatus', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="partner-orientierung"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleOrientationChange('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('partner', 'orientierungStatus', e.target.value, e.target));
            });
        }

        // ========================================
        // Pathos/Logos Check System
        // ========================================

        function checkPhysicalCompatibility(person1, person2) {
            const g1 = person1.geschlecht;
            const g2 = person2.geschlecht;

            // Get orientierung as multi-select object
            const ori1 = person1.orientierung;
            const ori2 = person2.orientierung;

            // Check for missing values
            if (!g1 || !g2) {
                return {
                    result: 'unvollständig',
                    reason: 'Dimensionen unvollständig',
                    explanation: 'Bitte wähle das Geschlecht für beide Personen aus.'
                };
            }

            // Handle multi-select orientierung
            const oriList1 = [];
            const oriList2 = [];

            if (ori1 && typeof ori1 === 'object') {
                if (ori1.heterosexuell) oriList1.push({ type: 'heterosexuell', status: ori1.heterosexuell });
                if (ori1.homosexuell) oriList1.push({ type: 'homosexuell', status: ori1.homosexuell });
                if (ori1.bisexuell) oriList1.push({ type: 'bisexuell', status: ori1.bisexuell });
            } else if (ori1 && typeof ori1 === 'string') {
                // Backwards compatibility for old single-value format
                oriList1.push({ type: ori1, status: person1.orientierungStatus || 'fakt' });
            }

            if (ori2 && typeof ori2 === 'object') {
                if (ori2.heterosexuell) oriList2.push({ type: 'heterosexuell', status: ori2.heterosexuell });
                if (ori2.homosexuell) oriList2.push({ type: 'homosexuell', status: ori2.homosexuell });
                if (ori2.bisexuell) oriList2.push({ type: 'bisexuell', status: ori2.bisexuell });
            } else if (ori2 && typeof ori2 === 'string') {
                // Backwards compatibility for old single-value format
                oriList2.push({ type: ori2, status: person2.orientierungStatus || 'fakt' });
            }

            // Check if any orientierung is selected
            if (oriList1.length === 0 || oriList2.length === 0) {
                return {
                    result: 'unvollständig',
                    reason: 'Dimensionen unvollständig',
                    explanation: 'Bitte wähle mindestens eine Orientierung für beide Personen aus.'
                };
            }

            // Check all combinations
            let hasPossible = false;
            let hasUnsicher = false;
            let hasInteressiert = false;

            for (const o1 of oriList1) {
                for (const o2 of oriList2) {
                    const result = checkSingleOrientationPair(o1.type, o1.status, o2.type, o2.status, g1, g2);

                    if (result === 'möglich') {
                        hasPossible = true;
                    } else if (result === 'unsicher') {
                        hasUnsicher = true;
                    }

                    if (o1.status === 'interessiert' || o2.status === 'interessiert') {
                        hasInteressiert = true;
                    }
                }
            }

            // Return best result
            if (hasPossible && !hasInteressiert) {
                return { result: 'möglich', confidence: 'hoch' };
            }

            if (hasPossible && hasInteressiert) {
                return {
                    result: 'unsicher',
                    confidence: 'mittel',
                    explanation: 'Anziehung möglich, aber mindestens eine Person ist in der Explorationsphase.',
                    note: 'Status "Interessiert" bedeutet Exploration'
                };
            }

            if (hasUnsicher) {
                return {
                    result: 'unsicher',
                    confidence: 'niedrig',
                    explanation: 'Anziehung ist theoretisch möglich, aber unsicher.',
                    note: 'Exploration-Phase'
                };
            }

            return {
                result: 'unmöglich',
                reason: 'Inkompatible Orientierungen',
                explanation: 'Die sexuellen Orientierungen schließen gegenseitige Anziehung aus.'
            };
        }

        // Helper: Check single pair of orientations
        function checkSingleOrientationPair(type1, status1, type2, status2, g1, g2) {
            // Bisexuell is always compatible
            if (type1 === 'bisexuell' || type2 === 'bisexuell') {
                return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'möglich';
            }

            // Both heterosexuell
            if (type1 === 'heterosexuell' && type2 === 'heterosexuell') {
                if (g1 !== g2) {
                    return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'möglich';
                } else {
                    return 'unmöglich'; // Same gender, both hetero
                }
            }

            // Both homosexuell
            if (type1 === 'homosexuell' && type2 === 'homosexuell') {
                if (g1 === g2) {
                    return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'möglich';
                } else {
                    return 'unmöglich'; // Different gender, both homo
                }
            }

            // Mixed: hetero + homo - generally incompatible
            return 'unmöglich';
        }

        function calculatePhilosophyCompatibility(type1, type2) {
            // Get the philosophy score (Category A) from the matrix
            const key = `${type1}_${type2}`;
            const interaction = data?.interactions[key];

            if (interaction && interaction.scores && interaction.scores.A) {
                return {
                    score: interaction.scores.A.value,
                    note: interaction.scores.A.note
                };
            }

            // Fallback if not found
            return { score: 50, note: 'Keine spezifischen Daten verfügbar' };
        }

        function formatPersonSummary(person) {
            const geschlecht = person.geschlecht || '?';

            // Handle multi-select orientierung object
            let orientierungStr = '?';
            if (person.orientierung && typeof person.orientierung === 'object') {
                const parts = [];
                if (person.orientierung.heterosexuell) {
                    const suffix = person.orientierung.heterosexuell === 'interessiert' ? ' (Interessiert)' : ' (Fakt)';
                    parts.push('heterosexuell' + suffix);
                }
                if (person.orientierung.homosexuell) {
                    const suffix = person.orientierung.homosexuell === 'interessiert' ? ' (Interessiert)' : ' (Fakt)';
                    parts.push('homosexuell' + suffix);
                }
                if (person.orientierung.bisexuell) {
                    const suffix = person.orientierung.bisexuell === 'interessiert' ? ' (Interessiert)' : ' (Fakt)';
                    parts.push('bisexuell' + suffix);
                }
                orientierungStr = parts.length > 0 ? parts.join(', ') : '?';
            } else if (person.orientierung) {
                // Backwards compatibility for old single-value format
                const statusSuffix = person.orientierungStatus === 'interessiert' ? ' (Interessiert)' : person.orientierungStatus === 'fakt' ? ' (Fakt)' : '';
                orientierungStr = person.orientierung + statusSuffix;
            }

            return `${geschlecht}, ${orientierungStr}`;
        }

        function runCompatibilityChecks() {
            const person1 = {
                archetyp: currentArchetype,
                ...personDimensions.ich
            };
            const person2 = {
                archetyp: selectedPartner,
                ...personDimensions.partner
            };

            // Reset all warnings
            document.getElementById('pathosBlocker').classList.remove('active');
            document.getElementById('logosWarning').classList.remove('active');
            document.getElementById('pathosUncertain').classList.remove('active');
            document.getElementById('doubleWarning').classList.remove('active');
            document.getElementById('compatibilityContent').style.display = 'block';

            // 1. PATHOS CHECK
            const pathosCheck = checkPhysicalCompatibility(person1, person2);

            if (pathosCheck.result === 'unvollständig') {
                // Show Pathos Uncertain with incomplete message
                document.getElementById('pathosUncertain').classList.add('active');
                document.getElementById('pathosUncertainText').textContent =
                    pathosCheck.explanation;
                // Continue showing compatibility content since it's just incomplete
            }

            if (pathosCheck.result === 'unmöglich') {
                // Show Pathos Blocker, hide everything else
                document.getElementById('pathosBlocker').classList.add('active');
                document.getElementById('compatibilityContent').style.display = 'none';

                document.getElementById('pathosBlockerReason').textContent =
                    `Grund: ${pathosCheck.reason}`;
                document.getElementById('pathosBlockerPerson1').textContent =
                    formatPersonSummary(person1);
                document.getElementById('pathosBlockerPerson2').textContent =
                    formatPersonSummary(person2);

                return { blocked: true, reason: 'pathos' };
            }

            // 2. LOGOS CHECK
            const logosCheck = calculatePhilosophyCompatibility(person1.archetyp, person2.archetyp);
            const hasLogosWarning = logosCheck.score < 50;
            const hasPathosUncertain = pathosCheck.result === 'unsicher';

            // Handle different warning combinations
            if (hasPathosUncertain && hasLogosWarning) {
                // Double Warning
                document.getElementById('doubleWarning').classList.add('active');
                document.getElementById('doubleWarningPathos').textContent =
                    `${person2.orientierung} (${person2.orientierungStatus}) → Exploration-Phase`;
                document.getElementById('doubleWarningLogos').textContent =
                    `Beziehungsphilosophie: ${logosCheck.score}% → ${data?.archetypes[person1.archetyp]?.name || person1.archetyp} vs. ${data?.archetypes[person2.archetyp]?.name || person2.archetyp}`;
            } else {
                // Single warnings
                if (hasLogosWarning) {
                    document.getElementById('logosWarning').classList.add('active');
                    const warningTitle = logosCheck.score < 30
                        ? 'Verstandsebene-Warnung: Fundamentale philosophische Unterschiede'
                        : 'Verstandsebene-Hinweis: Unterschiedliche philosophische Ansätze';
                    document.getElementById('logosWarningTitle').textContent = warningTitle;
                    document.getElementById('logosWarningSubtitle').textContent =
                        `Beziehungsphilosophie: ${logosCheck.score}%`;
                    document.getElementById('logosWarningScore').textContent = `${logosCheck.score}%`;
                    document.getElementById('logosWarningText').textContent = logosCheck.score < 30
                        ? 'Eure Grundüberzeugungen über Beziehungen sind sehr unterschiedlich. Dies erfordert intensive Kommunikation und Kompromissbereitschaft.'
                        : 'Ihr habt verschiedene Vorstellungen von Beziehungen. Offene Kommunikation ist wichtig.';
                }

                if (hasPathosUncertain) {
                    document.getElementById('pathosUncertain').classList.add('active');
                    document.getElementById('pathosUncertainText').textContent =
                        `Mindestens eine Person ist in der Explorationsphase (Status: "Interessiert"). Die tatsächliche körperliche Anziehung ist noch unklar.`;
                }
            }

            // 3. DISPLAY DIMENSION MODIFIERS
            const modifierSummaries = getModifierSummary(person1, person2);
            const modifierSummaryEl = document.getElementById('modifierSummary');
            const modifierContentEl = document.getElementById('modifierSummaryContent');

            if (modifierSummaries.length > 0) {
                modifierSummaryEl.classList.add('active');
                modifierContentEl.innerHTML = modifierSummaries.map(mod => {
                    const sign = mod.modifier > 0 ? '+' : '';
                    const modClass = mod.modifier > 0 ? 'positive' : (mod.modifier < 0 ? 'negative' : 'neutral');
                    const icon = mod.modifier > 0 ? '↑' : (mod.modifier < 0 ? '↓' : '→');
                    return `
                        <div class="modifier-summary-item">
                            <span class="modifier-icon">${icon}</span>
                            <span>${mod.description}</span>
                            <span class="modifier-badge ${modClass}">${sign}${mod.modifier}%</span>
                        </div>
                    `;
                }).join('');
            } else {
                modifierSummaryEl.classList.remove('active');
            }

            return {
                blocked: false,
                pathosCheck,
                logosCheck,
                warnings: { hasLogosWarning, hasPathosUncertain },
                modifiers: modifierSummaries
            };
        }

        function toggleLogosWarning() {
            const warning = document.getElementById('logosWarning');
            warning.classList.toggle('expanded');
        }

        function showPathosLogosInfo() {
            // Show info modal about Pathos vs Logos
            const title = 'Pathos vs. Logos';
            const content = `
                <div style="line-height: 1.6;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">GEFÜHLSEBENE (Emotion/Körper)</h4>
                    <ul style="margin-bottom: 15px; padding-left: 20px;">
                        <li>Körperliche und emotionale Anziehung</li>
                        <li>Sexuelle Orientierung</li>
                        <li>Nicht durch Lernen oder Kommunikation veränderbar</li>
                        <li><strong>Ohne Gefühlsebene:</strong> Keine romantische Beziehung möglich</li>
                    </ul>

                    <h4 style="color: var(--warning); margin-bottom: 10px;">VERSTANDSEBENE (Philosophie/Überzeugungen)</h4>
                    <ul style="margin-bottom: 15px; padding-left: 20px;">
                        <li>Beziehungsphilosophie und rationale Überzeugungen</li>
                        <li>Überzeugungen und Werte</li>
                        <li>Kann durch Kommunikation und Lernen verändert werden</li>
                        <li><strong>Ohne Verstandsebene:</strong> Schwierige, aber mögliche Beziehung</li>
                    </ul>

                    <p style="font-style: italic; color: var(--text-muted);">
                        "Die Gefühlsebene ist das Fundament - ohne körperliche Anziehung kann keine romantische Beziehung entstehen. Die Verstandsebene ist das Dach - es schützt und strukturiert, kann aber umgebaut werden."
                    </p>
                </div>
            `;

            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('categoryModal').classList.add('active');
        }

        // ========================================
        // Dimensions Modifiers System
        // ========================================

        // Tag dimension relevance mapping
        const tagDimensionRelevance = {
            // KATEGORIE A: Beziehungsphilosophie - KEINE Dimensions-Einflüsse!
            "exklusivitaets-erwartung": [],
            "offenheit-fuer-alternative-modelle": [],
            "beziehung-als-lebensinhalt": [],
            "primaerbeziehung-konzept": [],
            "commitment-tiefe": [],

            // KATEGORIE B: Werte-Alignment
            "fuehrung-und-initiative": ["dominanz"],
            "macht-balance": ["dominanz"],
            "emotionale-reziprozitaet": [],
            "eifersucht-umgang": [],
            "konfliktloesung": ["dominanz"],
            "emotionale-tiefe": [],

            // KATEGORIE C: Nähe-Distanz
            "entscheidungsfindung": ["dominanz"],
            "alltags-organisation": ["dominanz"],
            "autonomie-vs-gemeinsame-zeit": [],
            "finanzielle-organisation": ["dominanz"],
            "wohnform-flexibilitaet": [],
            "zeitmanagement": ["dominanz"],

            // KATEGORIE D: Autonomie
            "koerperliche-anziehung": ["geschlecht", "orientierung", "orientierungStatus"],
            "sexuelle-dominanz-dynamik": ["dominanz"],
            "experimentierfreude": ["orientierungStatus"],
            "intimitaets-frequenz": [],
            "koerperliche-naehe": [],
            "sexuelle-offenheit": ["orientierungStatus"],

            // KATEGORIE E: Kommunikation
            "kommunikations-stil": ["dominanz"],
            "konflikt-kommunikation": ["dominanz"],
            "beduerfnis-artikulation": [],
            "feedback-kultur": [],

            // KATEGORIE F: Soziale Kompatibilität
            "philosophische-entwicklung": [],
            "anpassungsfaehigkeit": ["dominanz"],
            "krisenresilienz": ["dominanz"],
            "gemeinsame-vision": [],
            "soziales-umfeld": [],
            "gesellschaftliche-akzeptanz": []
        };

        // Calculate dominanz modifier
        function getDominanzModifier(dom1, dom2) {
            // Return 0 if either is null/undefined
            if (!dom1 || !dom2) return 0;

            // KOMPLEMENTÄR
            if ((dom1 === "dominant" && dom2 === "submissiv") ||
                (dom1 === "submissiv" && dom2 === "dominant")) {
                return 8;
            }
            // BEIDE GLEICH
            if (dom1 === dom2) {
                if (dom1 === "ausgeglichen") return 5;
                if (dom1 === "switch") return 3;
                if (dom1 === "dominant") return -5;
                if (dom1 === "submissiv") return -5;
            }
            // EINER FLEXIBEL
            if (dom1 === "switch" || dom2 === "switch" ||
                dom1 === "ausgeglichen" || dom2 === "ausgeglichen") {
                return 2;
            }
            return 0;
        }

        // Get dominanz modifier description
        // Basiert auf Forschung: Sadikaj et al. (2017), Tiedens & Fragale (2003)
        function getDominanzDescription(dom1, dom2, modifier) {
            if (modifier === 8) return `Komplementär (${dom1} × ${dom2}): Optimale Rollenverteilung - Forschung zeigt höhere Sympathie und Komfort`;
            if (modifier === 5) return `Beide ausgeglichen: Flexible Dynamik ohne starre Hierarchie`;
            if (modifier === 3) return `Beide switch: Wechselnde Dynamik mit situativer Anpassung`;
            if (modifier === -5 && dom1 === "dominant") return `Beide dominant: Machtkampf-Risiko - bewusste Kommunikationsregeln empfohlen`;
            if (modifier === -5 && dom1 === "submissiv") return `Beide submissiv: Führungsvakuum - klare Aufgabenteilung empfohlen`;
            if (modifier === 2) return `Flexibilität: Ein Partner passt sich situativ an`;
            return "Neutral";
        }

        // Map tag to category
        function getTagCategory(tagId) {
            const mapping = {
                "exklusivitaets-erwartung": "A", "offenheit-fuer-alternative-modelle": "A",
                "beziehung-als-lebensinhalt": "A", "primaerbeziehung-konzept": "A", "commitment-tiefe": "A",
                "fuehrung-und-initiative": "B", "macht-balance": "B", "emotionale-reziprozitaet": "B",
                "eifersucht-umgang": "B", "konfliktloesung": "B", "emotionale-tiefe": "B",
                "entscheidungsfindung": "C", "alltags-organisation": "C", "autonomie-vs-gemeinsame-zeit": "C",
                "finanzielle-organisation": "C", "wohnform-flexibilitaet": "C", "zeitmanagement": "C",
                "koerperliche-anziehung": "D", "sexuelle-dominanz-dynamik": "D", "experimentierfreude": "D",
                "intimitaets-frequenz": "D", "koerperliche-naehe": "D", "sexuelle-offenheit": "D",
                "kommunikations-stil": "E", "konflikt-kommunikation": "E",
                "beduerfnis-artikulation": "E", "feedback-kultur": "E",
                "philosophische-entwicklung": "F", "anpassungsfaehigkeit": "F", "krisenresilienz": "F",
                "gemeinsame-vision": "F", "soziales-umfeld": "F", "gesellschaftliche-akzeptanz": "F"
            };
            return mapping[tagId] || null;
        }

        // Calculate tag score with modifiers
        function calculateTagWithModifiers(tagId, person1, person2, pathosCheck) {
            const interactionKey = `${person1.archetyp}_${person2.archetyp}`;
            const interaction = data?.interactions[interactionKey];
            const tagCategory = getTagCategory(tagId);
            let baseScore = interaction?.scores?.[tagCategory]?.value || 50;

            const relevantDims = tagDimensionRelevance[tagId] || [];
            if (relevantDims.length === 0) {
                return { score: baseScore, baseScore, modifier: 0, dims: [], desc: "Archetyp-basiert" };
            }

            let modifier = 0;
            let descriptions = [];

            // Dominanz modifier
            if (relevantDims.includes("dominanz")) {
                const domMod = getDominanzModifier(person1.dominanz, person2.dominanz);
                modifier += domMod;
                if (domMod !== 0) descriptions.push(getDominanzDescription(person1.dominanz, person2.dominanz, domMod));
            }

            // Physical compatibility (Pathos uncertainty)
            if (relevantDims.some(d => ["geschlecht", "orientierung", "orientierungStatus"].includes(d))) {
                if (pathosCheck?.result === "unsicher") {
                    modifier -= 10;
                    descriptions.push("Unsichere körperliche Anziehung");
                }
            }

            // Orientation status (exploration bonus)
            if (relevantDims.includes("orientierungStatus")) {
                if (person1.orientierungStatus === "interessiert" || person2.orientierungStatus === "interessiert") {
                    if (tagId === "experimentierfreude" || tagId === "sexuelle-offenheit") {
                        modifier += 5;
                        descriptions.push("Explorationsbonus");
                    }
                }
            }

            const finalScore = Math.max(0, Math.min(100, baseScore + modifier));
            return {
                score: finalScore,
                baseScore,
                modifier,
                dims: relevantDims,
                desc: descriptions.length > 0 ? descriptions.join("; ") : "Keine Anpassung"
            };
        }

        // Calculate category with modifiers
        function calculateCategoryWithModifiers(catLetter, person1, person2, pathosCheck) {
            const categoryTags = Object.keys(tagDimensionRelevance).filter(t => getTagCategory(t) === catLetter);

            if (categoryTags.length === 0) {
                const interactionKey = `${person1.archetyp}_${person2.archetyp}`;
                const interaction = data?.interactions[interactionKey];
                return { score: interaction?.scores?.[catLetter]?.value || 50, modifier: 0, tags: [] };
            }

            let totalScore = 0, totalMod = 0;
            const tagDetails = [];

            for (const tagId of categoryTags) {
                const result = calculateTagWithModifiers(tagId, person1, person2, pathosCheck);
                totalScore += result.score;
                totalMod += result.modifier;
                tagDetails.push({ id: tagId, ...result });
            }

            return {
                score: Math.round(totalScore / categoryTags.length),
                modifier: Math.round(totalMod / categoryTags.length),
                tags: tagDetails
            };
        }

        // ========================================
        // NEW: 4-Factor Relationship Quality Model
        // ========================================

        // Factor 1: Archetype Match (40%) - from existing matrix
        function getArchetypeScore(type1, type2) {
            const key = `${type1}_${type2}`;
            const interaction = data?.interactions[key];
            return interaction?.overall || 50;
        }

        // ═══════════════════════════════════════════════════════════════════════
        // Factor 2: Dominance Harmony (20% Gewichtung - Pathos/Gefühl)
        // ═══════════════════════════════════════════════════════════════════════
        // Philosophische Grundlage: OSHO + Metaphysik der Qualität (Pirsig)
        //
        // OSHO: "Nur Extreme können sich wirklich verlieben. Nur Extreme ziehen
        //        sich an. Je weiter sie voneinander entfernt sind, desto tiefer
        //        wird die Anziehung."
        //
        // OSHO: "Es gibt nur eine Energie - Tao. Sie funktioniert auf zwei Arten.
        //        Du kannst Konflikt ODER Harmonie zwischen beiden erschaffen."
        //
        // MOQ (Pirsig): Dynamische Qualität entsteht durch Spannung zwischen
        //               Polen. Statische Qualität bewahrt funktionierende Muster.
        //
        // Werte-Logik:
        // - 100%: Komplementäre Polarität (Dom↔Sub) = maximale dynamische Qualität
        // -  95%: Tao-Balance (Ausgeglichen↔Ausgeglichen) = harmonische Einheit
        // -  90%: Flexible Dynamik (Switch↔Switch) = spielerische Anpassung
        // -  85%: Pol + Balance = stabile Ergänzung
        // -  80%: Switch + Pol = Anpassung möglich, aber Spannung
        // -  60%: Gleiche Pole (Dom↔Dom, Sub↔Sub) = Konflikt, fehlende Spannung
        // ═══════════════════════════════════════════════════════════════════════
        // ═══════════════════════════════════════════════════════════════════════
        // DOMINANZ HARMONY MATRIX
        // ═══════════════════════════════════════════════════════════════════════
        const dominanzHarmonyMatrix = {
            // KOMPLEMENTÄRE POLARITÄT (100%)
            "dominant-submissiv": 100, "submissiv-dominant": 100,
            // TAO-BALANCE (90-95%)
            "ausgeglichen-ausgeglichen": 95, "switch-switch": 90,
            "switch-ausgeglichen": 88, "ausgeglichen-switch": 88,
            // POL + BALANCE (85%)
            "dominant-ausgeglichen": 85, "ausgeglichen-dominant": 85,
            "submissiv-ausgeglichen": 85, "ausgeglichen-submissiv": 85,
            // SWITCH + POL (80%)
            "switch-dominant": 80, "dominant-switch": 80,
            "switch-submissiv": 80, "submissiv-switch": 80,
            // GLEICHE POLE (55%)
            "dominant-dominant": 55, "submissiv-submissiv": 55
        };

        // Calculate harmony between two single dominanz types
        function calculateSingleDominanzHarmony(type1, status1, type2, status2) {
            const key = `${type1}-${type2}`;
            let baseScore = dominanzHarmonyMatrix[key] || dominanzHarmonyMatrix[`${type2}-${type1}`] || 75;

            // STATUS-MODIFIER: Reduzierte Konfidenz bei "interessiert"
            if (status1 === 'interessiert' || status2 === 'interessiert') {
                baseScore = Math.round(baseScore * 0.7);
            }

            return baseScore;
        }

        // Calculate best dominanz harmony for multi-select (finds best combination)
        function calculateDominanceHarmony(domObj1, domObj2) {
            // Handle old single-value format (backwards compatibility)
            if (typeof domObj1 === 'string' || typeof domObj2 === 'string') {
                return calculateSingleDominanzHarmony(domObj1, 'fakt', domObj2, 'fakt');
            }

            // Get selected dominanz preferences for each person
            const list1 = [];
            const list2 = [];

            if (domObj1) {
                if (domObj1.dominant) list1.push({ type: 'dominant', status: domObj1.dominant });
                if (domObj1.submissiv) list1.push({ type: 'submissiv', status: domObj1.submissiv });
                if (domObj1.switch) list1.push({ type: 'switch', status: domObj1.switch });
                if (domObj1.ausgeglichen) list1.push({ type: 'ausgeglichen', status: domObj1.ausgeglichen });
            }

            if (domObj2) {
                if (domObj2.dominant) list2.push({ type: 'dominant', status: domObj2.dominant });
                if (domObj2.submissiv) list2.push({ type: 'submissiv', status: domObj2.submissiv });
                if (domObj2.switch) list2.push({ type: 'switch', status: domObj2.switch });
                if (domObj2.ausgeglichen) list2.push({ type: 'ausgeglichen', status: domObj2.ausgeglichen });
            }

            // Default if no selections
            if (list1.length === 0 || list2.length === 0) return 75;

            // Find best combination
            let bestScore = 0;
            for (const d1 of list1) {
                for (const d2 of list2) {
                    const score = calculateSingleDominanzHarmony(d1.type, d1.status, d2.type, d2.status);
                    if (score > bestScore) {
                        bestScore = score;
                    }
                }
            }

            return bestScore;
        }

        // Factor 3: Orientation Compatibility (25%) - uses existing checkPhysicalCompatibility
        function calculateOrientationScore(person1, person2) {
            const pathosCheck = checkPhysicalCompatibility(person1, person2);

            if (pathosCheck.result === "unmöglich") {
                return 0;  // K.O.-Kriterium!
            }

            if (pathosCheck.result === "unsicher") {
                return 70;  // Exploration-Phase
            }

            return 100;  // Kompatibel
        }

        // Factor 4: Gender Attraction (15%)
        function calculateGenderAttraction(p1, p2) {
            const g1 = p1.geschlecht;
            const g2 = p2.geschlecht;

            // Handle multi-select orientierung
            const oriList1 = [];
            const oriList2 = [];

            if (p1.orientierung && typeof p1.orientierung === 'object') {
                if (p1.orientierung.heterosexuell) oriList1.push('heterosexuell');
                if (p1.orientierung.homosexuell) oriList1.push('homosexuell');
                if (p1.orientierung.bisexuell) oriList1.push('bisexuell');
            } else if (p1.orientierung) {
                oriList1.push(p1.orientierung);
            }

            if (p2.orientierung && typeof p2.orientierung === 'object') {
                if (p2.orientierung.heterosexuell) oriList2.push('heterosexuell');
                if (p2.orientierung.homosexuell) oriList2.push('homosexuell');
                if (p2.orientierung.bisexuell) oriList2.push('bisexuell');
            } else if (p2.orientierung) {
                oriList2.push(p2.orientierung);
            }

            // Return default if values missing
            if (!g1 || !g2 || oriList1.length === 0 || oriList2.length === 0) return 75;

            // Check best combination
            let bestScore = 0;

            for (const o1 of oriList1) {
                for (const o2 of oriList2) {
                    const score = calculateSingleGenderAttraction(g1, o1, g2, o2);
                    if (score > bestScore) {
                        bestScore = score;
                    }
                }
            }

            return bestScore;
        }

        // Helper for single orientierung pair
        function calculateSingleGenderAttraction(g1, o1, g2, o2) {
            // Bi = immer 100%
            if (o1 === "bisexuell" || o2 === "bisexuell") return 100;

            // Hetero
            if (o1 === "heterosexuell" && o2 === "heterosexuell") {
                if ((g1 === "männlich" && g2 === "weiblich") ||
                    (g1 === "weiblich" && g2 === "männlich")) return 100;
                if (g1 === "non-binär" || g2 === "non-binär") return 80;
                return 0;
            }

            // Homo
            if (o1 === "homosexuell" && o2 === "homosexuell") {
                if (g1 === g2 && g1 !== "non-binär") return 100;
                if (g1 === "non-binär" || g2 === "non-binär") return 80;
                return 0;
            }

            return 75;  // Gemischte Orientierungen
        }

        // ═══════════════════════════════════════════════════════════════════════
        // HAUPTBERECHNUNG: 4-Faktoren Beziehungsqualität
        // ═══════════════════════════════════════════════════════════════════════
        // Philosophische Grundlage: Tiage-Modell + MOQ (Pirsig) + OSHO
        //
        // GEWICHTUNG LOGOS vs. PATHOS (40:60)
        // ────────────────────────────────────
        // Pirsig (MOQ): "Qualität ist die Quelle von Subjekt und Objekt."
        //               Statische Qualität (Logos) = Fundament, bewahrt Muster
        //               Dynamische Qualität (Pathos) = Antrieb, erzeugt Anziehung
        //
        // OSHO: "Balance zwischen allen Polaritäten ist Gesundheit."
        //       "Gefühl ist der Antrieb, Verstand gibt Struktur."
        //
        // Tiage: Verbindet rationale Reflexion (Logos) mit emotionaler
        //        Resonanz (Pathos) zu einem ganzheitlichen Modell.
        //
        // FAKTOR-BEGRÜNDUNG:
        // ────────────────────────────────────
        // 1. Archetyp (40% - Logos/Verstand):
        //    → Fundamentale Beziehungsphilosophie
        //    → Statische Qualität: "Wie wollen wir Beziehung leben?"
        //    → Höchste Gewichtung weil strukturgebend
        //
        // 2. Orientierung (25% - Pathos/Gefühl):
        //    → Körperliche Anziehungsmöglichkeit
        //    → Dynamische Qualität: Polarität der Begierde
        //    → OSHO: "Extreme ziehen sich an"
        //
        // 3. Dominanz (20% - Pathos/Gefühl):
        //    → Energetische Dynamik der Interaktion
        //    → Dynamische Qualität: Führen/Folgen-Balance
        //    → OSHO: "Tao - eine Energie, zwei Ausdrucksformen"
        //
        // 4. Geschlecht (15% - Pathos/Gefühl):
        //    → Gender-Chemie als Feinabstimmung
        //    → Ergänzt Orientierung mit Nuancen (z.B. non-binär)
        //    → Niedrigste Gewichtung: weniger fundamental als Philosophie
        //
        // SUMME: Logos 40% + Pathos 60% = 100%
        // → Gefühl als Antrieb, Verstand als Fundament
        // ═══════════════════════════════════════════════════════════════════════
        function calculateRelationshipQuality(person1, person2) {
            // ═══════════════════════════════════════
            // EBENE 1: K.O.-Check (Pathos-Blocker)
            // ═══════════════════════════════════════
            // Ohne körperliche Anziehungsmöglichkeit keine Beziehungsqualität
            // OSHO: "Polarität ist Voraussetzung für Anziehung"

            const orientationScore = calculateOrientationScore(person1, person2);

            if (orientationScore === 0) {
                return {
                    score: 0,
                    blocked: true,
                    reason: "Keine körperliche Anziehung möglich",
                    breakdown: {
                        archetyp: 0,
                        dominanz: 0,
                        orientierung: 0,
                        geschlecht: 0
                    }
                };
            }

            // ═══════════════════════════════════════
            // EBENE 2: 4-Faktoren Qualitätsberechnung
            // ═══════════════════════════════════════

            const archetypeScore = getArchetypeScore(person1.archetyp, person2.archetyp);
            const dominanceScore = calculateDominanceHarmony(person1.dominanz, person2.dominanz);
            const genderScore = calculateGenderAttraction(person1, person2);

            // Gewichtete Summe nach Logos/Pathos-Prinzip
            const totalScore =
                (archetypeScore * 0.40) +      // 40% Logos - Beziehungsphilosophie
                (orientationScore * 0.25) +    // 25% Pathos - Körperliche Polarität
                (dominanceScore * 0.20) +      // 20% Pathos - Energetische Dynamik
                (genderScore * 0.15);          // 15% Pathos - Gender-Chemie

            return {
                score: Math.round(totalScore),
                blocked: false,
                breakdown: {
                    archetyp: archetypeScore,
                    dominanz: dominanceScore,
                    orientierung: orientationScore,
                    geschlecht: genderScore
                }
            };
        }

        // Calculate overall with 4-factor model + category details for UI
        function calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck) {
            // Use new 4-factor model for overall score
            const qualityResult = calculateRelationshipQuality(person1, person2);

            // Calculate category scores for UI display (radar chart, category bars)
            const categories = {};

            // Category A: Philosophy score from matrix
            categories.A = { score: logosCheck.score, modifier: 0, note: "Rein archetyp-basiert" };

            // Other categories with modifiers (for UI display)
            for (const cat of ['B', 'C', 'D', 'E', 'F']) {
                const result = calculateCategoryWithModifiers(cat, person1, person2, pathosCheck);
                categories[cat] = result;
            }

            return {
                overall: qualityResult.score,  // NEW: 4-factor score
                categories,                     // Keep for UI
                breakdown: qualityResult.breakdown  // NEW: factor breakdown
            };
        }

        // Get modifier summary for UI
        function getModifierSummary(person1, person2) {
            const summaries = [];
            const domMod = getDominanzModifier(person1.dominanz, person2.dominanz);
            if (domMod !== 0) {
                summaries.push({
                    type: "Dominanz",
                    modifier: domMod,
                    description: getDominanzDescription(person1.dominanz, person2.dominanz, domMod)
                });
            }
            return summaries;
        }

        // ========================================
        // NEW: Side-by-Side Comparison Functions
        // ========================================

        function toggleExpandSection(sectionId) {
            const content = document.getElementById(sectionId);
            const btn = content.previousElementSibling;
            content.classList.toggle('active');
            btn.classList.toggle('active');
        }

        function initComparisonLayout() {
            // ICH select
            const ichSelect = document.getElementById('ichSelect');
            if (ichSelect) {
                ichSelect.addEventListener('change', (e) => {
                    currentArchetype = e.target.value;
                    // Sync with old select if exists
                    const oldSelect = document.getElementById('archetypeSelect');
                    if (oldSelect) oldSelect.value = e.target.value;
                    updateComparisonView();
                });
            }

            // Partner select
            const partnerSelect = document.getElementById('partnerSelect');
            if (partnerSelect) {
                partnerSelect.addEventListener('change', (e) => {
                    selectedPartner = e.target.value;
                    updateComparisonView();
                });
            }

            // ICH compact dimensions
            document.querySelectorAll('input[name="ich-geschlecht-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.ich.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.ich.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="ich-orientierung-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleOrientationChange('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.ich.orientierungStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });

            // Partner compact dimensions
            document.querySelectorAll('input[name="partner-geschlecht-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.partner.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.partner.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="partner-orientierung-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleOrientationChange('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.partner.orientierungStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
        }

        function updateComparisonView() {
            if (!data) return;

            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];

            // Update type names
            document.getElementById('resultIchType').textContent = ichArch?.name || currentArchetype;
            document.getElementById('resultPartnerType').textContent = partnerArch?.name || selectedPartner;

            // Calculate compatibility
            const person1 = { archetyp: currentArchetype, ...personDimensions.ich };
            const person2 = { archetyp: selectedPartner, ...personDimensions.partner };

            const pathosCheck = checkPhysicalCompatibility(person1, person2);
            const logosCheck = calculatePhilosophyCompatibility(currentArchetype, selectedPartner);

            // Update warnings
            const warningsContainer = document.getElementById('warningsContainer');
            warningsContainer.innerHTML = '';

            if (pathosCheck.result === 'unvollständig') {
                warningsContainer.innerHTML = `<div class="warning-box incomplete-warning">⚠️ ${pathosCheck.explanation}</div>`;
            } else if (pathosCheck.result === 'unmöglich') {
                warningsContainer.innerHTML = `<div class="warning-box pathos-warning">🚫 Keine emotionale/körperliche Anziehung: ${pathosCheck.reason}</div>`;
            } else if (pathosCheck.result === 'unsicher') {
                warningsContainer.innerHTML = `<div class="warning-box logos-warning">⚠️ Unsichere körperliche Anziehung (Exploration-Phase)</div>`;
            }

            // Warnung bei unsicherem Dominanz-Status (prüfe ob mindestens eine Auswahl "interessiert" ist)
            const hasInteressiert1 = person1.dominanz && Object.values(person1.dominanz).some(s => s === 'interessiert');
            const hasInteressiert2 = person2.dominanz && Object.values(person2.dominanz).some(s => s === 'interessiert');
            if (hasInteressiert1 || hasInteressiert2) {
                warningsContainer.innerHTML += `<div class="warning-box logos-warning">⚠️ Unsichere Dominanz-Dynamik (Exploration-Phase – reduzierte Konfidenz)</div>`;
            }

            if (logosCheck.score < 50) {
                warningsContainer.innerHTML += `<div class="warning-box logos-warning">⚠️ Verstandsebene-Warnung: Philosophie nur ${logosCheck.score}%</div>`;
            }

            // If dimensions incomplete, show empty state and return
            if (pathosCheck.result === 'unvollständig') {
                // Clear all expandable sections
                const percentage = document.getElementById('resultPercentage');
                const progressFill = document.getElementById('resultProgressFill');
                percentage.textContent = '–';
                percentage.className = 'result-percentage';
                progressFill.style.width = '0%';

                // Clear sections with placeholder message
                const proList = document.getElementById('expandProList');
                const contraList = document.getElementById('expandContraList');
                if (proList) proList.innerHTML = '<li style="color: var(--text-muted); font-style: italic;">Bitte alle Dimensionen auswählen</li>';
                if (contraList) contraList.innerHTML = '<li style="color: var(--text-muted); font-style: italic;">Bitte alle Dimensionen auswählen</li>';

                const pathosLogosContent = document.getElementById('pathosLogosContent');
                if (pathosLogosContent) pathosLogosContent.innerHTML = '<p style="color: var(--text-muted); font-style: italic; text-align: center; padding: 20px;">Bitte alle Dimensionen auswählen, um die Pathos/Logos-Analyse zu sehen.</p>';

                const categoryBars = document.getElementById('expandCategoryBars');
                if (categoryBars) categoryBars.innerHTML = '<p style="color: var(--text-muted); font-style: italic; text-align: center; padding: 20px;">Bitte alle Dimensionen auswählen</p>';

                const expandRadar = document.getElementById('expandRadarChart');
                if (expandRadar) expandRadar.innerHTML = '';

                return;
            }

            // Calculate overall score
            let overallScore = 0;
            let qualityBreakdown = { archetyp: 0, dominanz: 0, orientierung: 0, geschlecht: 0 };

            if (pathosCheck.result !== 'unmöglich') {
                const result = calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck);
                overallScore = result.overall;
                qualityBreakdown = result.breakdown || qualityBreakdown;

                // Update expandable category bars
                updateExpandableCategoryBars(result.categories);
            }

            // Update 4-Factor Breakdown (Desktop)
            const factorArchetyp = document.getElementById('desktopFactorArchetyp');
            const factorDominanz = document.getElementById('desktopFactorDominanz');
            const factorOrientierung = document.getElementById('desktopFactorOrientierung');
            const factorGeschlecht = document.getElementById('desktopFactorGeschlecht');

            if (factorArchetyp) factorArchetyp.textContent = qualityBreakdown.archetyp + '%';
            if (factorDominanz) factorDominanz.textContent = qualityBreakdown.dominanz + '%';
            if (factorOrientierung) factorOrientierung.textContent = qualityBreakdown.orientierung + '%';
            if (factorGeschlecht) factorGeschlecht.textContent = qualityBreakdown.geschlecht + '%';

            // Update result bar
            const percentage = document.getElementById('resultPercentage');
            const progressFill = document.getElementById('resultProgressFill');

            percentage.textContent = overallScore + '%';
            progressFill.style.width = overallScore + '%';

            // Set color based on score
            let colorClass = 'low';
            let color = 'var(--danger)';
            if (overallScore >= 80) { colorClass = 'excellent'; color = 'var(--success)'; }
            else if (overallScore >= 65) { colorClass = 'good'; color = 'var(--primary)'; }
            else if (overallScore >= 50) { colorClass = 'moderate'; color = 'var(--warning)'; }

            percentage.className = 'result-percentage ' + colorClass;
            progressFill.style.background = color;

            // Update Radar Chart
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions?.[interactionKey] || {};
            drawRadarChart(interaction.scores || {}, partnerArch?.color || '#457B9D');

            // Update Pro/Contra
            updateExpandableProContra();

            // Update Pathos/Logos
            updateExpandablePathosLogos();
        }

        function updateExpandableCategoryBars(categories) {
            const container = document.getElementById('expandCategoryBars');
            if (!container) return;

            const categoryNamesMap = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'Nähe-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilität'
            };

            let html = '';
            for (const [cat, catData] of Object.entries(categories)) {
                const score = catData.score || 0;
                let colorClass = 'low';
                if (score >= 80) colorClass = 'excellent';
                else if (score >= 65) colorClass = 'good';
                else if (score >= 50) colorClass = 'moderate';

                html += `
                    <div class="category-bar-row clickable-bar" style="margin-bottom: 12px; cursor: pointer; padding: 8px; border-radius: 8px; transition: background 0.2s;" onclick="showCategoryDetails('${cat}')" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px; align-items: center;">
                            <span style="font-size: 12px; color: var(--text-secondary);">${cat}: ${categoryNamesMap[cat]}</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; font-weight: 600;" class="${colorClass}">${score}%</span>
                                <span style="font-size: 10px; color: var(--text-muted);">ℹ</span>
                            </div>
                        </div>
                        <div style="height: 6px; background: var(--bg-dark); border-radius: 3px; overflow: hidden;">
                            <div style="height: 100%; width: ${score}%; background: var(--${colorClass === 'excellent' ? 'success' : colorClass === 'good' ? 'primary' : colorClass === 'moderate' ? 'warning' : 'danger'}); border-radius: 3px;"></div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function showArchetypeInfo(person) {
            console.log('showArchetypeInfo called with:', person);
            const archetype = person === 'ich' ? currentArchetype : selectedPartner;
            console.log('archetype:', archetype, 'data:', data);
            if (!data || !data.archetypes || !data.archetypes[archetype]) {
                console.error('Data not available for archetype:', archetype);
                return;
            }

            // Set current index for swipe navigation
            currentDefinitionIndex = archetypeOrder.indexOf(archetype);
            if (currentDefinitionIndex === -1) currentDefinitionIndex = 0;
            currentDefinitionPerson = person;

            // Use the shared function to render content
            showArchetypeInfoByType(archetype);

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Add touch swipe support
            const modal = document.querySelector('#definitionModal .modal');
            modal.ontouchstart = handleDefinitionTouchStart;
            modal.ontouchend = handleDefinitionTouchEnd;
        }

        function showCategoryDetails(cat) {
            if (!data || !data.categories || !data.categories[cat]) return;

            const catInfo = data.categories[cat];
            const catNames = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'Nähe-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilität'
            };

            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const key = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions?.[key] || {};
            const catScore = interaction.scores?.[cat]?.value || 0;

            let scoreClass = 'low';
            let scoreText = 'Herausfordernd';
            if (catScore >= 80) { scoreClass = 'excellent'; scoreText = 'Exzellent'; }
            else if (catScore >= 65) { scoreClass = 'good'; scoreText = 'Gut'; }
            else if (catScore >= 50) { scoreClass = 'moderate'; scoreText = 'Mittel'; }

            let modalContent = `
                <div class="modal-category">
                    <div style="background: rgba(69,123,157,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary); font-size: 12px;">Aktuelle Kombination</span>
                            <span style="font-size: 18px; font-weight: 700; color: var(--${scoreClass === 'excellent' ? 'success' : scoreClass === 'good' ? 'primary' : scoreClass === 'moderate' ? 'warning' : 'danger'});">${catScore}%</span>
                        </div>
                        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);">
                            <span style="color: #2ecc71;">${ichArch?.name || currentArchetype}</span>
                            <span style="color: var(--text-muted);"> × </span>
                            <span style="color: #e74c3c;">${partnerArch?.name || selectedPartner}</span>
                        </div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">${scoreText} in dieser Kategorie</div>
                    </div>

                    <div class="modal-category-header">
                        <div class="modal-category-letter">${cat}</div>
                        <div class="modal-category-name">${catNames[cat]}</div>
                    </div>
                    <div class="modal-category-desc">${catInfo.description || 'Keine Beschreibung verfügbar.'}</div>
            `;

            if (catInfo.subDimensions && catInfo.subDimensions.length > 0) {
                modalContent += `
                    <div class="definition-section">
                        <div class="definition-section-title">Subdimensionen <span style="font-size: 10px; color: var(--text-muted);">(klicken für Details)</span></div>
                        <ul class="definition-list variants clickable-subs">
                            ${catInfo.subDimensions.map(sub => `<li onclick="showSubDimensionInfo('${cat}', '${sub.replace(/'/g, "\\'")}')" style="cursor: pointer; padding: 8px; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">${sub} <span style="color: var(--text-muted); font-size: 10px;">→</span></li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            modalContent += '</div>';

            document.getElementById('modalTitle').textContent = `Qualitätsmuster ${cat}: ${catNames[cat]}`;
            document.getElementById('modalBody').innerHTML = modalContent;
            document.getElementById('categoryModal').classList.add('active');
        }

        const subDimensionData = {
            "Exklusivitäts-Erwartung": {
                was: "Die Erwartung, der einzige romantische/sexuelle Partner zu sein.",
                warum: "Diese Dimension ist fundamental, weil unterschiedliche Erwartungen zu Enttäuschung, Eifersucht und Vertrauensbrüchen führen können.",
                wozu: "Klare Erwartungen verhindern Missverständnisse und schaffen eine gemeinsame Basis für die Beziehungsgestaltung.",
                archetypen: {
                    single: "Flexibel - keine feste Erwartung, offen für verschiedene Modelle",
                    duo: "Hohe Erwartung an vollständige Exklusivität",
                    duo_flex: "Grundsätzlich exklusiv, aber mit Ausnahmen nach Absprache",
                    solopoly: "Keine Exklusivitätserwartung - jede Beziehung ist eigenständig",
                    poly_hedo: "Offenheit für multiple Partner ist Teil des Modells",
                    polyamor: "Bewusste Nicht-Exklusivität mit klaren Strukturen"
                }
            },
            "Offenheit für alternative Modelle": {
                was: "Die Bereitschaft, nicht-traditionelle Beziehungsformen zu akzeptieren oder auszuprobieren.",
                warum: "Unterschiedliche Offenheit kann zu Konflikten führen, wenn ein Partner expandieren möchte und der andere nicht.",
                wozu: "Gemeinsame Offenheit ermöglicht Wachstum und Anpassung der Beziehung an veränderte Bedürfnisse.",
                archetypen: {
                    single: "Oft sehr offen - keine festgelegte Struktur",
                    duo: "Tendenziell geschlossen - Monogamie als Ideal",
                    duo_flex: "Moderat offen - bereit für situative Anpassungen",
                    solopoly: "Sehr offen - lebt bereits alternatives Modell",
                    poly_hedo: "Maximal offen - Experimentierfreude ist zentral",
                    polyamor: "Strukturiert offen - klare Rahmen für Vielfalt"
                }
            },
            "Beziehung als Lebensinhalt vs. Lebensbereich": {
                was: "Wie zentral ist die Beziehung im Leben? Ist sie alles oder ein Teil von vielem?",
                warum: "Wenn einer die Beziehung als Lebensmittelpunkt sieht und der andere als Nebensache, entstehen ungleiche Investitionen.",
                wozu: "Ähnliche Priorisierung schafft Balance und verhindert das Gefühl von Vernachlässigung oder Überforderung.",
                archetypen: {
                    single: "Lebensbereich - das eigene Leben steht im Zentrum",
                    duo: "Oft Lebensinhalt - die Beziehung ist sehr wichtig",
                    duo_flex: "Wichtiger Lebensbereich mit hoher Priorität",
                    solopoly: "Klar Lebensbereich - das Selbst bleibt Zentrum",
                    poly_hedo: "Lebensbereich - Genuss und Freiheit sind zentral",
                    polyamor: "Wichtiger Lebensbereich - aber mit mehreren Beziehungen"
                }
            },
            "Definition von Treue": {
                was: "Was bedeutet 'treu sein' konkret? Körperliche Exklusivität, emotionale Treue, oder Ehrlichkeit?",
                warum: "Unterschiedliche Definitionen führen oft zu den schmerzhaftesten Missverständnissen in Beziehungen.",
                wozu: "Eine gemeinsame Definition von Treue schafft Klarheit und Vertrauen - unabhängig davon, wie sie aussieht.",
                archetypen: {
                    single: "Flexibel - Treue ist kontextabhängig",
                    duo: "Klassisch - körperliche UND emotionale Exklusivität",
                    duo_flex: "Angepasst - emotionale Treue wichtiger als körperliche",
                    solopoly: "Neu definiert - Treue = Ehrlichkeit und Transparenz",
                    poly_hedo: "Erweitert - Treue zu Absprachen, nicht zu Exklusivität",
                    polyamor: "Strukturiert - Treue zu vereinbarten Regeln und Grenzen"
                }
            },
            "Ethische Grundhaltung": {
                was: "Die gemeinsamen Werte wie Ehrlichkeit, Respekt, Consent und Fairness.",
                warum: "Unterschiedliche ethische Grundhaltungen untergraben das Fundament jeder Beziehung und führen zu Vertrauensverlust.",
                wozu: "Geteilte ethische Werte schaffen ein sicheres Fundament für alle anderen Aspekte der Beziehung.",
                archetypen: {
                    single: "Individuell geprägt - eigene ethische Standards",
                    duo: "Traditionell - gesellschaftliche Normen als Leitfaden",
                    duo_flex: "Reflektiert - bewusste Auseinandersetzung mit Normen",
                    solopoly: "Progressiv - aktive ethische Reflexion",
                    poly_hedo: "Consent-fokussiert - Einverständnis als höchster Wert",
                    polyamor: "Strukturiert ethisch - klare Regeln für fairen Umgang"
                }
            },
            "Verantwortungsbewusstsein": {
                was: "Die Bereitschaft, Verantwortung für eigene Handlungen und deren Auswirkungen zu übernehmen.",
                warum: "Ohne Verantwortungsbewusstsein werden Fehler wiederholt und Partner verletzt.",
                wozu: "Verantwortung ermöglicht Wachstum, Reparatur nach Konflikten und nachhaltige Beziehungsqualität.",
                archetypen: {
                    single: "Primär für sich selbst verantwortlich",
                    duo: "Hohe gegenseitige Verantwortung erwartet",
                    duo_flex: "Balancierte Verantwortung mit Flexibilität",
                    solopoly: "Selbstverantwortung betont, aber fair zu Partnern",
                    poly_hedo: "Verantwortung für Consent und Absprachen",
                    polyamor: "Komplexe Verantwortung für mehrere Beziehungen"
                }
            },
            "Emotionale Verschmelzungs-Tendenz": {
                was: "Das Bedürfnis, emotional mit dem Partner zu verschmelzen - von 'wir sind eins' bis 'wir sind zwei'.",
                warum: "Starke Unterschiede führen dazu, dass einer sich eingeengt und der andere sich abgelehnt fühlt.",
                wozu: "Ähnliche Verschmelzungs-Präferenzen ermöglichen eine Nähe, die sich für beide richtig anfühlt.",
                archetypen: {
                    single: "Niedrig - Autonomie steht vor Verschmelzung",
                    duo: "Oft hoch - 'Wir' als zentrale Identität",
                    duo_flex: "Moderat - Nähe mit Grenzen",
                    solopoly: "Niedrig - bewusste Distanz zu Verschmelzung",
                    poly_hedo: "Variabel - situationsabhängig",
                    polyamor: "Differenziert - unterschiedlich mit verschiedenen Partnern"
                }
            },
            "Physische Nähe-Bedürfnisse": {
                was: "Wie viel körperliche Präsenz und Nähe braucht man? Zusammenleben, täglicher Kontakt, wöchentlich?",
                warum: "Mismatches führen zu Einsamkeit (bei zu wenig) oder Erstickung (bei zu viel).",
                wozu: "Abgestimmte Nähe-Bedürfnisse ermöglichen, dass beide sich gesehen und respektiert fühlen.",
                archetypen: {
                    single: "Flexibel - kein konstantes Nähe-Bedürfnis",
                    duo: "Hoch - oft Wunsch nach Zusammenleben",
                    duo_flex: "Moderat bis hoch mit Freiraum-Phasen",
                    solopoly: "Bewusst niedrig - eigener Wohnraum wichtig",
                    poly_hedo: "Situativ - Nähe nach Bedarf, nicht nach Pflicht",
                    polyamor: "Komplex - unterschiedliche Nähe mit verschiedenen Partnern"
                }
            },
            "Fähigkeit, Raum zu geben": {
                was: "Die Fähigkeit, dem Partner Freiraum zu lassen ohne sich vernachlässigt oder unsicher zu fühlen.",
                warum: "Ohne diese Fähigkeit entstehen Kontrolle, Eifersucht und Erstickung der Beziehung.",
                wozu: "Raum geben können ermöglicht individuelle Entwicklung innerhalb der Beziehung.",
                archetypen: {
                    single: "Hoch - Raum ist selbstverständlich",
                    duo: "Muss oft gelernt werden - Nähe ist Standard",
                    duo_flex: "Bewusst entwickelt - wichtig für das Modell",
                    solopoly: "Sehr hoch - Teil der Grundphilosophie",
                    poly_hedo: "Notwendig - mehrere Beziehungen erfordern es",
                    polyamor: "Essentiell - strukturell eingebaut"
                }
            },
            "Individuelle Freiheit": {
                was: "Der Wert, den man persönlicher Freiheit in der Beziehung beimisst - eigene Entscheidungen, Hobbies, Freunde.",
                warum: "Unterschiedliche Freiheitsbedürfnisse führen zu Machtkämpfen oder Entfremdung.",
                wozu: "Respektierte Freiheit ermöglicht authentisches Selbst und verhindert Resentment.",
                archetypen: {
                    single: "Maximale Freiheit - das Kernbedürfnis",
                    duo: "Eingeschränkt - Kompromisse erwartet",
                    duo_flex: "Balanciert - Freiheit mit Rücksichtnahme",
                    solopoly: "Maximal - Autonomie ist nicht verhandelbar",
                    poly_hedo: "Hoch - Freiheit ist Teil des Genusses",
                    polyamor: "Hoch - aber mit Verantwortung verbunden"
                }
            },
            "Entscheidungsautonomie": {
                was: "Wer entscheidet was? Wie viel Mitsprache hat der Partner bei persönlichen Entscheidungen?",
                warum: "Konflikte entstehen, wenn einer Kontrolle erwartet und der andere Autonomie braucht.",
                wozu: "Klare Entscheidungsstrukturen verhindern Machtkämpfe und schaffen Klarheit.",
                archetypen: {
                    single: "Vollständig - alle Entscheidungen selbst",
                    duo: "Oft geteilt - wichtige Dinge gemeinsam",
                    duo_flex: "Hybrid - manche gemeinsam, manche allein",
                    solopoly: "Hoch - Autonomie auch in der Beziehung",
                    poly_hedo: "Individuell - jeder entscheidet für sich",
                    polyamor: "Komplex - unterschiedlich je nach Beziehung"
                }
            },
            "Akzeptanz der Autonomie des anderen": {
                was: "Die Fähigkeit zu akzeptieren, dass der Partner eigene Entscheidungen trifft - auch wenn man nicht zustimmt.",
                warum: "Fehlende Akzeptanz führt zu Kontrolle, Manipulation und Vertrauensverlust.",
                wozu: "Akzeptanz ermöglicht echte Partnerschaft statt Abhängigkeit.",
                archetypen: {
                    single: "Hoch - Autonomie wird geschätzt",
                    duo: "Muss oft gelernt werden",
                    duo_flex: "Bewusst entwickelt",
                    solopoly: "Sehr hoch - zentral für das Modell",
                    poly_hedo: "Notwendig für das Funktionieren",
                    polyamor: "Essentiell - ohne geht es nicht"
                }
            },
            "Kommunikationstiefe": {
                was: "Wie tief gehen Gespräche? Von Alltag bis zu Ängsten, Träumen und Verletzlichkeit.",
                warum: "Unterschiedliche Tiefen-Präferenzen führen zu Frustration - einer will mehr, einer weniger.",
                wozu: "Passende Kommunikationstiefe schafft echte Verbindung und Verständnis.",
                archetypen: {
                    single: "Variabel - je nach Beziehung",
                    duo: "Oft hoch - alles teilen als Ideal",
                    duo_flex: "Selektiv tief - wichtiges wird geteilt",
                    solopoly: "Bewusst tief - Kommunikation ist essentiell",
                    poly_hedo: "Situativ - Tiefe nach Bedarf",
                    polyamor: "Hoch - Komplexität erfordert Kommunikation"
                }
            },
            "Konfliktfähigkeit": {
                was: "Wie geht man mit Konflikten um? Vermeidung, Eskalation, konstruktive Lösung?",
                warum: "Unterschiedliche Stile führen dazu, dass Konflikte ungelöst bleiben oder eskalieren.",
                wozu: "Kompatible Konfliktfähigkeit ermöglicht Wachstum durch Krisen statt Zerstörung.",
                archetypen: {
                    single: "Kann Konflikte vermeiden durch Distanz",
                    duo: "Muss Konflikte lösen - kein Entkommen",
                    duo_flex: "Flexibel - manchmal Distanz, manchmal Lösung",
                    solopoly: "Klar - bei Unlösbarkeit kann man gehen",
                    poly_hedo: "Pragmatisch - Konflikte minimieren",
                    polyamor: "Entwickelt - Kommunikation als Lösung"
                }
            },
            "Emotionale Transparenz": {
                was: "Wie offen teilt man Gefühle? Alles aussprechen oder manches für sich behalten?",
                warum: "Unterschiede führen zu Missverständnissen - einer fühlt sich verschlossen, der andere überfordert.",
                wozu: "Abgestimmte Transparenz schafft Vertrauen ohne Überforderung.",
                archetypen: {
                    single: "Selektiv - teilt was nötig ist",
                    duo: "Oft hohe Erwartung an Transparenz",
                    duo_flex: "Balanciert - wichtiges wird geteilt",
                    solopoly: "Hoch - Ehrlichkeit ist zentral",
                    poly_hedo: "Pragmatisch - Transparenz wo nötig",
                    polyamor: "Sehr hoch - Basis des Modells"
                }
            },
            "Gesellschaftliche Akzeptanz": {
                was: "Wie wichtig ist es, dass Familie, Freunde und Gesellschaft die Beziehung akzeptieren?",
                warum: "Unterschiedliche Wichtigkeit führt zu Konflikten über 'Outing' und öffentliches Auftreten.",
                wozu: "Ähnliche Wichtigkeit ermöglicht einen gemeinsamen Umgang mit dem sozialen Umfeld.",
                archetypen: {
                    single: "Unkompliziert - gesellschaftlich akzeptiert",
                    duo: "Sehr wichtig - passt zur Norm",
                    duo_flex: "Moderat - gewisse Erklärungen nötig",
                    solopoly: "Weniger wichtig - lebt gegen die Norm",
                    poly_hedo: "Gering - Stigma wird akzeptiert",
                    polyamor: "Komplex - manche Offenheit, manche Diskretion"
                }
            },
            "Integration in soziale Kreise": {
                was: "Wie wird die Beziehung in Freundeskreis, Familie und Arbeit integriert und präsentiert?",
                warum: "Unterschiede führen zu Frustration - einer will präsentieren, der andere verstecken.",
                wozu: "Gemeinsame Strategien für soziale Integration schaffen ein einheitliches Auftreten.",
                archetypen: {
                    single: "Einfach - keine komplexe Integration nötig",
                    duo: "Vollständig - Partner wird überall eingeführt",
                    duo_flex: "Weitgehend - mit gewissen Grenzen",
                    solopoly: "Selektiv - nicht überall erklärbar",
                    poly_hedo: "Begrenzt - gesellschaftlich schwierig",
                    polyamor: "Komplex - unterschiedlich je nach Umfeld"
                }
            },
            "Umgang mit Stigma": {
                was: "Wie geht man mit negativen Reaktionen auf die Beziehungsform um? Erklären, ignorieren, kämpfen?",
                warum: "Unterschiedliche Strategien führen zu Konflikten darüber, wie man als Paar auftritt.",
                wozu: "Gemeinsame Strategie stärkt die Beziehung gegen äußeren Druck.",
                archetypen: {
                    single: "Kaum Stigma - gesellschaftlich normal",
                    duo: "Kein Stigma - das Ideal der Gesellschaft",
                    duo_flex: "Leichtes Stigma - 'offene Beziehung'",
                    solopoly: "Erhebliches Stigma - schwer erklärbar",
                    poly_hedo: "Hohes Stigma - moralische Verurteilung",
                    polyamor: "Stigma vorhanden - aber zunehmend bekannt"
                }
            }
        };

        function showSubDimensionInfo(cat, subName) {
            const subData = subDimensionData[subName] || { was: "Keine Beschreibung verfügbar.", warum: "", wozu: "", archetypen: {} };
            const catNames = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'Nähe-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilität'
            };

            const ichArch = data?.archetypes?.[currentArchetype];
            const partnerArch = data?.archetypes?.[selectedPartner];
            const ichId = currentArchetype;
            const partnerId = selectedPartner;

            const ichPerspektive = subData.archetypen?.[ichId] || "Keine Daten";
            const partnerPerspektive = subData.archetypen?.[partnerId] || "Keine Daten";

            let modalContent = `
                <div style="background: rgba(69,123,157,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted);">Teil von Qualitätsmuster ${cat}: ${catNames[cat]}</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WAS?</div>
                    <p style="color: var(--text-primary); line-height: 1.5;">${subData.was}</p>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WARUM WICHTIG?</div>
                    <p style="color: var(--text-secondary); line-height: 1.5;">${subData.warum}</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WOZU?</div>
                    <p style="color: var(--text-secondary); line-height: 1.5;">${subData.wozu}</p>
                </div>

                <div style="background: rgba(46,204,113,0.1); padding: 12px; border-radius: 10px; margin-bottom: 10px;">
                    <div style="font-size: 12px; color: #2ecc71; font-weight: 600; margin-bottom: 8px;">ICH (${ichArch?.name || ichId}):</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${ichPerspektive}</p>
                </div>

                <div style="background: rgba(231,76,60,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="font-size: 12px; color: #e74c3c; font-weight: 600; margin-bottom: 8px;">PARTNER (${partnerArch?.name || partnerId}):</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${partnerPerspektive}</p>
                </div>

                <div style="background: rgba(155,89,182,0.1); padding: 12px; border-radius: 10px;">
                    <div style="font-size: 12px; color: #9b59b6; font-weight: 600; margin-bottom: 8px;">BEDEUTUNG FÜR EURE KOMBINATION:</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${generateCombinationAnalysis(ichId, partnerId, subName, subData)}</p>
                </div>
            `;

            document.getElementById('modalTitle').textContent = subName;
            document.getElementById('modalBody').innerHTML = modalContent;
        }

        function generateCombinationAnalysis(ichId, partnerId, subName, subData) {
            if (ichId === partnerId) {
                return `Da ihr beide denselben Archetyp habt, solltet ihr hier ähnliche Vorstellungen haben. Das reduziert Konfliktpotential in dieser Dimension erheblich.`;
            }

            const polyTypes = ['solopoly', 'poly_hedo', 'polyamor'];
            const monoTypes = ['single', 'duo', 'duo_flex'];
            const ichIsPoly = polyTypes.includes(ichId);
            const partnerIsPoly = polyTypes.includes(partnerId);

            if (ichIsPoly !== partnerIsPoly) {
                return `Hier treffen fundamental unterschiedliche Weltanschauungen aufeinander. Ein Poly-Typ und ein Mono-Typ haben oft gegensätzliche Perspektiven auf "${subName}". Intensive Kommunikation und gegenseitiges Verständnis sind essentiell.`;
            }

            if (ichIsPoly && partnerIsPoly) {
                return `Als zwei Poly-Typen teilt ihr grundsätzlich ähnliche Werte in dieser Dimension. Die Unterschiede liegen eher in der konkreten Ausgestaltung als in den Grundprinzipien.`;
            }

            return `Eure Archetypen haben unterschiedliche Schwerpunkte in dieser Dimension. Offene Gespräche darüber, was euch beiden wichtig ist, helfen, gemeinsame Lösungen zu finden.`;
        }

        function updateExpandableProContra() {
            if (!data) return;

            // Generiere dynamische Pro/Contra aus Micro-Statements
            const dynamicProContra = generateDynamicProContra(
                currentArchetype,
                selectedPartner,
                personDimensions.ich,
                personDimensions.partner
            );

            const proList = document.getElementById('expandProList');
            const contraList = document.getElementById('expandContraList');

            if (proList) {
                if (dynamicProContra.pro && dynamicProContra.pro.length > 0) {
                    proList.innerHTML = dynamicProContra.pro.slice(0, 5).map(s => `<li>${s}</li>`).join('');
                } else {
                    proList.innerHTML = '<li style="color: var(--text-muted);">Keine Daten verfügbar</li>';
                }
            }
            if (contraList) {
                if (dynamicProContra.contra && dynamicProContra.contra.length > 0) {
                    contraList.innerHTML = dynamicProContra.contra.slice(0, 5).map(c => `<li>${c}</li>`).join('');
                } else {
                    contraList.innerHTML = '<li style="color: var(--text-muted);">Keine Daten verfügbar</li>';
                }
            }
        }

        // NEU: Generiere dynamische Pro/Contra aus Micro-Statements
        function generateDynamicProContra(type1, type2, dims1, dims2) {
            const pro = [];
            const contra = [];

            // 1. Archetyp-basierte Pro/Contra
            const archStatements = getArchetypeStatements(type1, type2);
            if (archStatements) {
                pro.push(...(archStatements.pro || []));
                contra.push(...(archStatements.contra || []));
            }

            // 2. Dominanz-basierte Pro/Contra hinzufügen
            const domStatements = getDominanceStatements(dims1?.dominanz, dims2?.dominanz);
            if (domStatements && domStatements.pro) {
                // Füge nur die relevantesten hinzu, um Doppelungen zu vermeiden
                domStatements.pro.slice(0, 2).forEach(p => {
                    if (!pro.includes(p)) pro.push(p);
                });
            }
            if (domStatements && domStatements.contra) {
                domStatements.contra.slice(0, 2).forEach(c => {
                    if (!contra.includes(c)) contra.push(c);
                });
            }

            return { pro, contra };
        }

        function updateExpandablePathosLogos() {
            if (!data) return;

            const container = document.getElementById('pathosLogosContent');
            if (!container) return;

            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];

            // Generate combined Pathos/Logos analysis
            const combinedPathos = generateCombinedPathos(ichArch, partnerArch);
            const combinedLogos = generateCombinedLogos(ichArch, partnerArch);

            container.innerHTML = `
                <div style="margin-bottom: 12px; padding: 12px; background: rgba(46,204,113,0.1); border-radius: 10px; border-left: 3px solid #2ecc71;">
                    <h4 style="color: #2ecc71; margin-bottom: 8px; font-size: 13px;">🔥 GEMEINSAMER PATHOS (Emotionale Ebene)</h4>
                    <p style="color: var(--text-secondary); line-height: 1.5; font-size: 12px; margin: 0;">${combinedPathos}</p>
                </div>

                <div style="padding: 12px; background: rgba(243,156,18,0.1); border-radius: 10px; border-left: 3px solid #f39c12;">
                    <h4 style="color: #f39c12; margin-bottom: 8px; font-size: 13px;">🧠 GEMEINSAMER LOGOS (Rationale Ebene)</h4>
                    <p style="color: var(--text-secondary); line-height: 1.5; font-size: 12px; margin: 0;">${combinedLogos}</p>
                </div>
            `;
        }

        function generateCombinedPathos(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            const ichId = ichArch?.id || '';
            const partnerId = partnerArch?.id || '';

            // Hole Statements aus der Datenbank
            const archStatements = getArchetypeStatements(ichId, partnerId);
            const domStatements = getDominanceStatements(
                personDimensions.ich?.dominanz,
                personDimensions.partner?.dominanz
            );

            const textParts = [];

            // Archetyp-basierte Pathos-Statements
            if (archStatements?.pathos) {
                if (archStatements.pathos.gemeinsam?.length) {
                    textParts.push(archStatements.pathos.gemeinsam[0]);
                }
                if (archStatements.pathos.spannung?.length) {
                    textParts.push(archStatements.pathos.spannung[0]);
                }
            }

            // Dominanz-basierte Pathos-Statements hinzufügen
            if (domStatements?.pathos?.length && personDimensions.ich?.dominanz && personDimensions.partner?.dominanz) {
                textParts.push(domStatements.pathos[0]);
            }

            // Fallback wenn keine Statements gefunden
            if (textParts.length === 0) {
                return `${ichName} und ${partnerName} können emotional zueinander finden, auch wenn ihre Grundhaltungen sich unterscheiden. Die Herausforderung liegt darin, die emotionalen Bedürfnisse des anderen zu verstehen und zu respektieren.`;
            }

            return textParts.join(' ');
        }

        function generateCombinedLogos(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            const ichId = ichArch?.id || '';
            const partnerId = partnerArch?.id || '';

            // Get philosophy score from compatibility matrix
            const key = `${ichId}_${partnerId}`;
            const interaction = data?.interactions?.[key];
            const philScore = interaction?.scores?.A?.value || interaction?.overall || 50;

            // Hole Statements aus der Datenbank
            const archStatements = getArchetypeStatements(ichId, partnerId);
            const domStatements = getDominanceStatements(
                personDimensions.ich?.dominanz,
                personDimensions.partner?.dominanz
            );

            const textParts = [];

            // Archetyp-basierte Logos-Statements
            if (archStatements?.logos) {
                if (archStatements.logos.gemeinsam?.length) {
                    textParts.push(archStatements.logos.gemeinsam[0]);
                }
                if (archStatements.logos.unterschied?.length && philScore < 70) {
                    textParts.push(archStatements.logos.unterschied[0]);
                }
            }

            // Dominanz-basierte Logos-Statements
            if (domStatements?.logos?.length && personDimensions.ich?.dominanz && personDimensions.partner?.dominanz) {
                textParts.push(domStatements.logos[0]);
            }

            // Fallback mit Philosophie-Score
            if (textParts.length === 0) {
                if (philScore >= 80) {
                    return `${ichName} und ${partnerName} teilen viele rationale Grundüberzeugungen über Beziehungen (Philosophie-Score: ${philScore}%). Das bildet eine solide Basis für konstruktive Gespräche.`;
                } else if (philScore < 50) {
                    return `${ichName} und ${partnerName} haben unterschiedliche rationale Vorstellungen von Beziehungen (Philosophie-Score: ${philScore}%). Grundlegende Gespräche über Erwartungen sind wichtig.`;
                }
                return `${ichName} und ${partnerName} haben einige Überschneidungen in ihren rationalen Beziehungsvorstellungen (Philosophie-Score: ${philScore}%), aber auch Unterschiede, die Kommunikation erfordern.`;
            }

            return textParts.join(' ');
        }

        // ========================================
        // MOBILE MULTI-PAGE FUNCTIONS
        // ========================================

        let currentMobilePage = 1;
        let mobilePersonDimensions = {
            ich: {
                geschlecht: null,
                dominanz: { dominant: null, submissiv: null, switch: null, ausgeglichen: null },
                orientierung: { heterosexuell: null, homosexuell: null, bisexuell: null }
            },
            partner: {
                geschlecht: null,
                dominanz: { dominant: null, submissiv: null, switch: null, ausgeglichen: null },
                orientierung: { heterosexuell: null, homosexuell: null, bisexuell: null }
            }
        };
        let mobileIchArchetype = 'single';
        let mobilePartnerArchetype = 'duo';
        let mobileTouchStartX = 0;
        let mobileTouchEndX = 0;

        function validateDimensionsComplete() {
            // Check if we're in mobile mode
            const isMobile = window.innerWidth <= 768;
            const dimensions = isMobile ? mobilePersonDimensions : personDimensions;

            // Check if all required dimensions are selected for both ICH and PARTNER
            const ichComplete =
                dimensions.ich.geschlecht !== null &&
                dimensions.ich.dominanz !== null &&
                dimensions.ich.orientierung !== null &&
                dimensions.ich.orientierungStatus !== null;

            const partnerComplete =
                dimensions.partner.geschlecht !== null &&
                dimensions.partner.dominanz !== null &&
                dimensions.partner.orientierung !== null &&
                dimensions.partner.orientierungStatus !== null;

            return ichComplete && partnerComplete;
        }

        function showValidationWarning() {
            // Find or create warning element
            let warning = document.getElementById('dimensionWarning');
            if (!warning) {
                warning = document.createElement('div');
                warning.id = 'dimensionWarning';
                warning.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(231, 76, 60, 0.95);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    font-size: 14px;
                    font-weight: 600;
                    z-index: 9999;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    animation: slideDown 0.3s ease;
                `;
                warning.textContent = '⚠️ Bitte fülle alle Dimensionen aus, bevor du fortsetzt!';
                document.body.appendChild(warning);

                // Auto-remove after 3 seconds
                setTimeout(() => {
                    warning.style.animation = 'slideUp 0.3s ease';
                    setTimeout(() => warning.remove(), 300);
                }, 3000);
            }
        }

        function mobileGoToPage(pageNumber) {
            // Validate before moving from page 1 to page 2
            if (currentMobilePage === 1 && pageNumber === 2 && !validateDimensionsComplete()) {
                showValidationWarning();
                return;
            }

            // Hide all pages
            document.querySelectorAll('.mobile-page').forEach(p => {
                p.classList.remove('active');
            });

            // Show target page
            const targetPage = document.getElementById(`mobilePage${pageNumber}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update dots
            document.querySelectorAll('.page-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === pageNumber - 1);
            });

            currentMobilePage = pageNumber;

            // Update page content when navigating
            if (pageNumber === 2) {
                updateMobileResultPage();
            } else if (pageNumber === 3) {
                updateMobileProContraPage();
            }
            // Page 4 (A-F Kategorien) entfernt - neues 4-Faktoren-Modell

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function initMobileSwipe() {
            const mobileContainer = document.getElementById('mobileMultipage');
            if (!mobileContainer) return;

            mobileContainer.addEventListener('touchstart', (e) => {
                mobileTouchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            mobileContainer.addEventListener('touchend', (e) => {
                mobileTouchEndX = e.changedTouches[0].screenX;
                handleMobileSwipe();
            }, { passive: true });
        }

        function handleMobileSwipe() {
            const swipeThreshold = 50;
            const diff = mobileTouchStartX - mobileTouchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0 && currentMobilePage < 3) {
                    // Swipe left -> next page (max 3 pages now)
                    mobileGoToPage(currentMobilePage + 1);
                } else if (diff < 0 && currentMobilePage > 1) {
                    // Swipe right -> previous page
                    mobileGoToPage(currentMobilePage - 1);
                }
            }
        }

        function initMobileDimensionListeners() {
            // ICH Select
            const mobileIchSelect = document.getElementById('mobileIchSelect');
            if (mobileIchSelect) {
                mobileIchSelect.addEventListener('change', (e) => {
                    mobileIchArchetype = e.target.value;
                    // Sync with desktop
                    const desktopSelect = document.getElementById('ichSelect');
                    if (desktopSelect) desktopSelect.value = e.target.value;
                    currentArchetype = e.target.value;
                    updateComparisonView();
                });
            }

            // Partner Select
            const mobilePartnerSelect = document.getElementById('mobilePartnerSelect');
            if (mobilePartnerSelect) {
                mobilePartnerSelect.addEventListener('change', (e) => {
                    mobilePartnerArchetype = e.target.value;
                    // Sync with desktop
                    const desktopSelect = document.getElementById('partnerSelect');
                    if (desktopSelect) desktopSelect.value = e.target.value;
                    selectedPartner = e.target.value;
                    updateComparisonView();
                });
            }

            // ICH Dimensions
            document.querySelectorAll('input[name="mobile-ich-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.ich.geschlecht = e.target.value;
                    personDimensions.ich.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('ich-geschlecht-new', e.target.value);
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="mobile-ich-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('ich', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-ich-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.ich.dominanzStatus = e.target.value;
                    personDimensions.ich.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('ich-dominanz-status-new', e.target.value);
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="mobile-ich-orientierung"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleOrientationChange('ich', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-ich-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.ich.orientierungStatus = e.target.value;
                    personDimensions.ich.orientierungStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('ich-status-new', e.target.value);
                    updateComparisonView();
                });
            });

            // Partner Dimensions
            document.querySelectorAll('input[name="mobile-partner-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.partner.geschlecht = e.target.value;
                    personDimensions.partner.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('partner-geschlecht-new', e.target.value);
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="mobile-partner-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('partner', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-partner-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.partner.dominanzStatus = e.target.value;
                    personDimensions.partner.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('partner-dominanz-status-new', e.target.value);
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="mobile-partner-orientierung"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleOrientationChange('partner', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-partner-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.partner.orientierungStatus = e.target.value;
                    personDimensions.partner.orientierungStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('partner-status-new', e.target.value);
                    updateComparisonView();
                });
            });
        }

        function syncDimensionToDesktop(name, value) {
            const desktopRadio = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (desktopRadio) {
                desktopRadio.checked = true;
                const container = desktopRadio.closest('.compact-dimension');
                if (container) container.classList.remove('needs-selection');
            }
        }

        function updateMobileResultPage() {
            if (!data) return;

            const ichArch = data.archetypes[mobileIchArchetype || currentArchetype];
            const partnerArch = data.archetypes[mobilePartnerArchetype || selectedPartner];

            // Update type names
            document.getElementById('mobileResultIch').textContent = ichArch?.name || mobileIchArchetype;
            document.getElementById('mobileResultPartner').textContent = partnerArch?.name || mobilePartnerArchetype;

            // Calculate scores
            const person1 = { archetyp: mobileIchArchetype || currentArchetype, ...personDimensions.ich };
            const person2 = { archetyp: mobilePartnerArchetype || selectedPartner, ...personDimensions.partner };

            const qualityResult = calculateRelationshipQuality(person1, person2);

            // Update score circle
            const scoreCircle = document.getElementById('mobileScoreCircle');
            scoreCircle.textContent = qualityResult.score + '%';

            // Set score circle color
            if (qualityResult.blocked) {
                scoreCircle.style.background = 'linear-gradient(135deg, var(--danger), #c0392b)';
            } else if (qualityResult.score >= 80) {
                scoreCircle.style.background = 'linear-gradient(135deg, var(--success), #1e8449)';
            } else if (qualityResult.score >= 65) {
                scoreCircle.style.background = 'linear-gradient(135deg, var(--primary), var(--primary-light))';
            } else if (qualityResult.score >= 50) {
                scoreCircle.style.background = 'linear-gradient(135deg, var(--warning), #d68910)';
            } else {
                scoreCircle.style.background = 'linear-gradient(135deg, var(--danger), #c0392b)';
            }

            // Update factor breakdown
            document.getElementById('mobileFactorArchetyp').textContent = qualityResult.breakdown.archetyp + '%';
            document.getElementById('mobileFactorDominanz').textContent = qualityResult.breakdown.dominanz + '%';
            document.getElementById('mobileFactorOrientierung').textContent = qualityResult.breakdown.orientierung + '%';
            document.getElementById('mobileFactorGeschlecht').textContent = qualityResult.breakdown.geschlecht + '%';

            // Update mobile Pathos & Logos
            const mobilePathosLogos = document.getElementById('mobilePathosLogosContent');
            if (mobilePathosLogos) {
                const combinedPathos = generateCombinedPathos(ichArch, partnerArch);
                const combinedLogos = generateCombinedLogos(ichArch, partnerArch);
                mobilePathosLogos.innerHTML = `
                    <div style="margin-bottom: 10px; padding: 10px; background: rgba(46,204,113,0.1); border-radius: 8px; border-left: 3px solid #2ecc71;">
                        <h4 style="color: #2ecc71; margin-bottom: 6px; font-size: 12px;">🔥 GEMEINSAMER PATHOS</h4>
                        <p style="color: var(--text-secondary); line-height: 1.4; font-size: 11px; margin: 0;">${combinedPathos}</p>
                    </div>
                    <div style="padding: 10px; background: rgba(243,156,18,0.1); border-radius: 8px; border-left: 3px solid #f39c12;">
                        <h4 style="color: #f39c12; margin-bottom: 6px; font-size: 12px;">🧠 GEMEINSAMER LOGOS</h4>
                        <p style="color: var(--text-secondary); line-height: 1.4; font-size: 11px; margin: 0;">${combinedLogos}</p>
                    </div>
                `;
            }

            // Update Pirsig quote
            const quoteElement = document.getElementById('mobileQualityQuote');
            if (quoteElement) {
                let quoteText = '';
                if (qualityResult.blocked) {
                    quoteText = '"Keine Basis für Resonanz vorhanden – die körperliche oder emotionale Chemie fehlt grundlegend."';
                } else if (qualityResult.score >= 80) {
                    quoteText = `"Diese Beziehung zeigt eine Qualität von ${qualityResult.score}% – eine hohe Resonanz zwischen zwei Menschen, deren Muster sich ergänzen und verstärken."`;
                } else if (qualityResult.score >= 65) {
                    quoteText = `"Diese Beziehung zeigt eine Qualität von ${qualityResult.score}% – eine solide Balance zwischen statischen Mustern und dynamischem Potenzial."`;
                } else if (qualityResult.score >= 50) {
                    quoteText = `"Diese Beziehung zeigt eine Qualität von ${qualityResult.score}% – vorhandene Basis, aber Arbeit an der dynamischen Qualität erforderlich."`;
                } else {
                    quoteText = `"Diese Beziehung zeigt eine Qualität von ${qualityResult.score}% – erhebliche Herausforderungen, die bewusste Reflexion erfordern."`;
                }
                quoteElement.innerHTML = `<p>${quoteText}</p>`;
            }
        }

        function updateMobileProContraPage() {
            if (!data) return;

            const ichArch = data.archetypes[mobileIchArchetype || currentArchetype];
            const partnerArch = data.archetypes[mobilePartnerArchetype || selectedPartner];

            // Update title
            const title = document.getElementById('mobileProContraTitle');
            if (title) {
                title.textContent = `${ichArch?.name || 'ICH'} × ${partnerArch?.name || 'PARTNER'}`;
            }

            // Get interaction data
            const interactionKey = `${mobileIchArchetype || currentArchetype}_${mobilePartnerArchetype || selectedPartner}`;
            const interaction = data.interactions?.[interactionKey];

            const proList = document.getElementById('mobileProList');
            const contraList = document.getElementById('mobileContraList');

            if (interaction) {
                // Pro list
                if (proList && interaction.pros?.length) {
                    proList.innerHTML = interaction.pros.map(p => `<li>${p}</li>`).join('');
                } else if (proList) {
                    proList.innerHTML = '<li>Keine spezifischen Vorteile bekannt</li>';
                }

                // Contra list
                if (contraList && interaction.contras?.length) {
                    contraList.innerHTML = interaction.contras.map(c => `<li>${c}</li>`).join('');
                } else if (contraList) {
                    contraList.innerHTML = '<li>Keine spezifischen Herausforderungen bekannt</li>';
                }
            } else {
                if (proList) proList.innerHTML = '<li>Keine Daten verfügbar</li>';
                if (contraList) contraList.innerHTML = '<li>Keine Daten verfügbar</li>';
            }
        }

        function updateMobileCategoriesPage() {
            if (!data) return;

            const container = document.getElementById('mobileCategoriesAccordion');
            if (!container) return;

            const person1 = { archetyp: mobileIchArchetype || currentArchetype, ...personDimensions.ich };
            const person2 = { archetyp: mobilePartnerArchetype || selectedPartner, ...personDimensions.partner };

            const pathosCheck = checkPhysicalCompatibility(person1, person2);
            const logosCheck = calculatePhilosophyCompatibility(person1.archetyp, person2.archetyp);
            const result = calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck);

            const categoryNamesMap = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'Nähe-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilität'
            };

            const categoryDescMap = {
                A: 'Übereinstimmung in den grundlegenden Beziehungsvorstellungen und -erwartungen.',
                B: 'Wie gut eure moralischen und ethischen Werte übereinstimmen.',
                C: 'Balance zwischen Bedürfnis nach Nähe und Freiraum.',
                D: 'Respekt für individuelle Unabhängigkeit und Selbstbestimmung.',
                E: 'Fähigkeit zur offenen und ehrlichen Kommunikation.',
                F: 'Kompatibilität im sozialen Umfeld und gesellschaftlicher Akzeptanz.'
            };

            // FEATURE 2: Category explanations
            function getCategoryExplanation(cat, score, ich, partner) {
                const ichName = data?.archetypes?.[ich]?.name || ich;
                const partnerName = data?.archetypes?.[partner]?.name || partner;

                const explanations = {
                    A: () => {
                        if (ich === partner) {
                            return `${ichName} und ${partnerName} teilen dieselbe Beziehungsphilosophie (100% Übereinstimmung). Beide haben identische Grundüberzeugungen über Beziehungsstrukturen, was eine solide Basis bietet.`;
                        }
                        if (score >= 80) {
                            return `${ichName} und ${partnerName} haben sehr ähnliche Beziehungsphilosophien (${score}%). Die Grundüberzeugungen passen gut zusammen und schaffen eine harmonische Basis.`;
                        } else if (score >= 60) {
                            return `${ichName} (sucht ${ichName === 'Single' ? 'Freiheit' : ichName === 'Duo' ? 'Exklusivität' : 'Flexibilität'}) und ${partnerName} (sucht ${partnerName === 'Single' ? 'Freiheit' : partnerName === 'Duo' ? 'Exklusivität' : 'Flexibilität'}) haben unterschiedliche, aber vereinbare Beziehungsphilosophien (${score}%). Mit Kommunikation und Verständnis ist eine Brücke möglich.`;
                        } else {
                            return `${ichName} und ${partnerName} haben fundamentale philosophische Unterschiede (${score}%). Die Beziehungsvorstellungen weichen stark voneinander ab. Intensive Kommunikation und große Kompromisse sind nötig.`;
                        }
                    },
                    B: () => `Diese Kategorie misst, wie gut eure moralischen Werte übereinstimmen. Ein Score von ${score}% zeigt ${score >= 70 ? 'starke' : score >= 50 ? 'moderate' : 'schwache'} Übereinstimmung in ethischen Grundfragen.`,
                    C: () => `Nähe-Distanz bewertet das Gleichgewicht zwischen Zusammensein und Freiraum. Bei ${score}% gibt es ${score >= 70 ? 'eine harmonische Balance' : score >= 50 ? 'moderate Abstimmung nötig' : 'deutliche Unterschiede in den Bedürfnissen'}.`,
                    D: () => `Autonomie misst den Respekt für individuelle Freiheit. ${score}% bedeutet ${score >= 70 ? 'hohe gegenseitige Wertschätzung' : score >= 50 ? 'moderate Übereinstimmung' : 'Spannungen durch unterschiedliche Autonomie-Bedürfnisse'}.`,
                    E: () => `Kommunikation bewertet Offenheit und Ehrlichkeit. Ein Score von ${score}% zeigt ${score >= 70 ? 'exzellente Kommunikationsbasis' : score >= 50 ? 'solide, aber ausbaufähige Kommunikation' : 'Herausforderungen in der Verständigung'}.`,
                    F: () => `Soziale Kompatibilität bewertet gesellschaftliche Akzeptanz und Umfeld-Passung. ${score}% bedeutet ${score >= 70 ? 'sehr gute soziale Harmonie' : score >= 50 ? 'akzeptable soziale Integration' : 'potenzielle soziale Herausforderungen'}.`
                };

                return explanations[cat] ? explanations[cat]() : '';
            }

            let html = '';
            for (const [cat, catData] of Object.entries(result.categories)) {
                const score = catData.score || 0;
                const barClass = score >= 80 ? 'bar-excellent' : score >= 65 ? 'bar-good' : score >= 50 ? 'bar-medium' : 'bar-low';
                const explanation = getCategoryExplanation(cat, score, person1.archetyp, person2.archetyp);

                html += `
                    <div class="category-accordion-item">
                        <div class="category-accordion-header" onclick="toggleMobileCategory(this)">
                            <span class="category-accordion-letter">${cat}</span>
                            <span class="category-accordion-name">${categoryNamesMap[cat] || cat}</span>
                            <span class="category-accordion-score">${score}%</span>
                            <span class="category-accordion-icon">▼</span>
                        </div>
                        <div class="category-accordion-content">
                            <div class="category-accordion-inner">
                                <p class="category-accordion-desc">${categoryDescMap[cat] || ''}</p>
                                <div style="margin-top: 10px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                                    <div class="${barClass}" style="height: 100%; width: ${score}%; border-radius: 4px;"></div>
                                </div>
                                <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; border-left: 3px solid var(--primary);">
                                    <h4 style="font-size: var(--font-sm); color: var(--text-primary); margin-bottom: 8px;">Warum ${score}%?</h4>
                                    <p style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5; margin: 0;">${explanation}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function toggleMobileCategory(header) {
            const item = header.closest('.category-accordion-item');
            if (item) {
                item.classList.toggle('open');
            }
        }

        function checkAndShowMobileLayout() {
            const isMobile = window.innerWidth <= 768;
            const desktopView = document.getElementById('comparisonView');
            const mobileView = document.getElementById('mobileMultipage');

            if (isMobile) {
                if (desktopView) desktopView.style.display = 'none';
                if (mobileView) mobileView.style.display = 'block';
            } else {
                if (desktopView) desktopView.style.display = 'block';
                if (mobileView) mobileView.style.display = 'none';
            }
        }

        function initMobileLayout() {
            initMobileSwipe();
            initMobileDimensionListeners();
            checkAndShowMobileLayout();

            // Listen for window resize
            window.addEventListener('resize', checkAndShowMobileLayout);
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            checkAgeVerification();
            initAgeVerification();
            initFeedbackSystem();
            initDimensionListeners();
            initComparisonLayout();
            initMobileLayout();
        });

        // ========================================
        // FEATURE 1: Factor Detail Modal
        // ========================================

        const factorExplanations = {
            archetyp: {
                title: 'Archetyp-Übereinstimmung',
                subtitle: '(Beziehungsphilosophie - Verstand/Logos)',
                getExplanation: (ich, partner, score) => {
                    const ichName = data?.archetypes?.[ich]?.name || ich;
                    const partnerName = data?.archetypes?.[partner]?.name || partner;

                    if (ich === partner) {
                        return `${ichName} und ${partnerName} teilen dieselbe Beziehungsphilosophie. Beide haben identische Grundüberzeugungen über Beziehungsstrukturen.`;
                    }

                    if (score >= 80) {
                        return `${ichName} und ${partnerName} haben sehr ähnliche Beziehungsphilosophien. Die Grundüberzeugungen passen gut zusammen und erfordern nur minimale Kompromisse.`;
                    } else if (score >= 60) {
                        return `${ichName} und ${partnerName} haben unterschiedliche, aber kompatible Beziehungsphilosophien. Beide Archetypen können sich mit Kommunikation und Verständnis ergänzen.`;
                    } else {
                        return `${ichName} und ${partnerName} haben fundamentale philosophische Unterschiede. Die Beziehungsvorstellungen weichen stark voneinander ab und erfordern intensive Kommunikation.`;
                    }
                },
                getMeaning: (score) => {
                    if (score >= 80) {
                        return ['Hohe philosophische Übereinstimmung', 'Wenige grundsätzliche Konflikte', 'Ähnliche Erwartungen an die Beziehung'];
                    } else if (score >= 60) {
                        return ['Mittlere philosophische Übereinstimmung', 'Kompromisse und Kommunikation nötig', 'Unterschiedliche, aber vereinbare Bedürfnisse'];
                    } else {
                        return ['Niedrige philosophische Übereinstimmung', 'Intensive Kommunikation erforderlich', 'Fundamentale Kompromisse notwendig'];
                    }
                }
            },
            dominanz: {
                title: 'Dominanz-Harmonie',
                subtitle: '(Emotionale Dynamik - Gefühl/Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichDom = dims.ich.dominanz;
                    const partnerDom = dims.partner.dominanz;

                    // Translate values to German labels for display
                    const domLabels = {
                        'dominant': 'dominant',
                        'submissiv': 'submissiv',
                        'switch': 'Switch',
                        'ausgeglichen': 'ausgeglichen'
                    };
                    const ichLabel = domLabels[ichDom] || ichDom || 'nicht gewählt';
                    const partnerLabel = domLabels[partnerDom] || partnerDom || 'nicht gewählt';

                    if (ichDom === partnerDom) {
                        if (ichDom === 'ausgeglichen' || ichDom === 'switch') {
                            return `Beide bevorzugen ${ichLabel} - das ermöglicht eine flexible Dynamik, in der beide je nach Situation verschiedene Rollen einnehmen können.`;
                        }
                        if (ichDom === 'dominant') {
                            // Forschung: Sadikaj et al. (2017) - Machtkämpfe bei zwei Dominanten
                            return `Beide sind dominant - das kann zu Machtkämpfen führen, besonders bei wichtigen Entscheidungen. Forschung zeigt: Paare mit zwei dominanten Partnern berichten niedrigere Beziehungszufriedenheit. Funktioniert mit bewussten Kommunikationsregeln und Kompromissbereitschaft.`;
                        }
                        if (ichDom === 'submissiv') {
                            return `Beide sind submissiv - es kann ein Führungsvakuum entstehen, wenn niemand die Initiative übernimmt. Bewusste Aufgabenteilung und klare Absprachen sind wichtig.`;
                        }
                        return `Beide bevorzugen ${ichLabel} - das kann zu Spannungen führen, wenn niemand die komplementäre Rolle übernimmt.`;
                    }

                    if ((ichDom === 'dominant' && partnerDom === 'submissiv') ||
                        (ichDom === 'submissiv' && partnerDom === 'dominant')) {
                        return `Perfekte Komplementarität: ${ichLabel} und ${partnerLabel} ergänzen sich ideal in der emotionalen Dynamik.`;
                    }

                    return `${ichLabel} und ${partnerLabel} - eine interessante Dynamik, die durch Flexibilität und Verständnis gut funktionieren kann.`;
                },
                getMeaning: (score) => {
                    if (score >= 80) {
                        return ['Harmonische emotionale Dynamik', 'Natürliche Rollenverteilung', 'Geringe Reibungspunkte'];
                    } else if (score >= 60) {
                        return ['Funktionale emotionale Dynamik', 'Flexible Anpassung möglich', 'Gelegentliche Abstimmung nötig'];
                    } else {
                        // Forschungsbasiert: Sadikaj et al. (2017) - Machtkämpfe bei gleicher Polarität
                        return ['Machtkampf- oder Führungsvakuum-Risiko', 'Bewusste Kommunikationsregeln wichtig', 'Klare Aufgabenteilung empfohlen'];
                    }
                }
            },
            orientierung: {
                title: 'Orientierungs-Kompatibilität',
                subtitle: '(Körperliche Anziehung - Gefühl/Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichOri = dims.ich.orientierung;
                    const partnerOri = dims.partner.orientierung;

                    // Translate values to German labels for display
                    const oriLabels = {
                        'heterosexuell': 'heterosexuell',
                        'homosexuell': 'homosexuell',
                        'bisexuell': 'bisexuell'
                    };
                    const ichLabel = oriLabels[ichOri] || ichOri || 'nicht gewählt';
                    const partnerLabel = oriLabels[partnerOri] || partnerOri || 'nicht gewählt';

                    if (score === 100) {
                        return `${ichLabel} und ${partnerLabel} - perfekte Kompatibilität! Körperliche Anziehung ist definitiv möglich.`;
                    } else if (score >= 50) {
                        return `${ichLabel} und ${partnerLabel} - Anziehung ist möglich, besonders wenn mindestens eine Person bisexuell orientiert ist.`;
                    } else {
                        return `${ichLabel} und ${partnerLabel} - Keine körperliche Anziehung möglich aufgrund der sexuellen Orientierungen.`;
                    }
                },
                getMeaning: (score) => {
                    if (score === 100) {
                        return ['Vollständige körperliche Kompatibilität', 'Keine Barrieren für Anziehung', 'Basis für romantische Beziehung vorhanden'];
                    } else if (score >= 50) {
                        return ['Mögliche körperliche Kompatibilität', 'Anziehung kann entstehen', 'Hängt von individuellen Präferenzen ab'];
                    } else {
                        return ['Keine körperliche Kompatibilität', 'Romantische Beziehung nicht möglich', 'Freundschaft möglich'];
                    }
                }
            },
            geschlecht: {
                title: 'Geschlechts-Attraktion',
                subtitle: '(Gender-Chemie - Gefühl/Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichG = dims.ich.geschlecht;
                    const partnerG = dims.partner.geschlecht;

                    // Translate values to German labels for display
                    const genderLabels = {
                        'männlich': 'männlich',
                        'weiblich': 'weiblich',
                        'non-binär': 'non-binär'
                    };
                    const ichLabel = genderLabels[ichG] || ichG || 'nicht gewählt';
                    const partnerLabel = genderLabels[partnerG] || partnerG || 'nicht gewählt';

                    if (score === 100) {
                        return `Die Geschlechterkonstellation ${ichLabel} × ${partnerLabel} passt perfekt zu den angegebenen Orientierungen.`;
                    } else if (score >= 50) {
                        return `Die Geschlechterkonstellation ${ichLabel} × ${partnerLabel} ist mit den angegebenen Orientierungen grundsätzlich kompatibel.`;
                    } else {
                        return `Die Geschlechterkonstellation ${ichLabel} × ${partnerLabel} passt nicht zu den angegebenen Orientierungen.`;
                    }
                },
                getMeaning: (score) => {
                    if (score === 100) {
                        return ['Ideale Geschlechterkonstellation', 'Maximale Anziehungskraft möglich', 'Keine gender-bezogenen Barrieren'];
                    } else if (score >= 50) {
                        return ['Akzeptable Geschlechterkonstellation', 'Anziehung möglich', 'Individuelle Präferenzen entscheidend'];
                    } else {
                        return ['Inkompatible Geschlechterkonstellation', 'Anziehung unwahrscheinlich', 'Orientierung passt nicht'];
                    }
                }
            }
        };

        function openFactorModal(factorType, source = 'mobile') {
            const factor = factorExplanations[factorType];
            if (!factor) return;

            const ich = mobileIchArchetype;
            const partner = mobilePartnerArchetype;

            // Use correct dimensions based on source
            const dimensions = source === 'desktop' ? personDimensions : mobilePersonDimensions;

            // Get score from display - support both mobile and desktop
            const prefix = source === 'desktop' ? 'desktopFactor' : 'mobileFactor';
            let score = 0;
            if (factorType === 'archetyp') {
                score = parseInt(document.getElementById(prefix + 'Archetyp').textContent) || 0;
            } else if (factorType === 'dominanz') {
                score = parseInt(document.getElementById(prefix + 'Dominanz').textContent) || 0;
            } else if (factorType === 'orientierung') {
                score = parseInt(document.getElementById(prefix + 'Orientierung').textContent) || 0;
            } else if (factorType === 'geschlecht') {
                score = parseInt(document.getElementById(prefix + 'Geschlecht').textContent) || 0;
            }

            // Update modal content
            document.getElementById('factorModalTitle').textContent = factor.title;
            document.getElementById('factorModalSubtitle').textContent = factor.subtitle;

            // Show combination code for archetyp factor
            const comboCodeEl = document.getElementById('factorModalComboCode');
            if (factorType === 'archetyp' && ich && partner) {
                const comboCode = `${ich}_${partner}`;
                comboCodeEl.textContent = `Code: ${comboCode}`;
                comboCodeEl.style.display = 'inline-block';
            } else {
                comboCodeEl.style.display = 'none';
            }

            document.getElementById('factorModalScore').textContent = score + '%';
            document.getElementById('factorModalExplanation').textContent = factor.getExplanation(ich, partner, score, dimensions);

            const meaningList = document.getElementById('factorModalMeaning');
            meaningList.innerHTML = '';
            factor.getMeaning(score).forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                meaningList.appendChild(li);
            });

            // Show modal
            document.getElementById('factorModal').classList.add('active');
        }

        function closeFactorModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('factorModal').classList.remove('active');
        }

        // ========================================
        // HELP MODAL FUNCTIONS
        // ========================================

        function openHelpModal() {
            console.log('openHelpModal called');
            const modal = document.getElementById('helpModal');
            console.log('helpModal element:', modal);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                console.log('helpModal activated');
            } else {
                console.error('helpModal element not found!');
            }
        }

        function closeHelpModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('helpModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close help modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const helpModal = document.getElementById('helpModal');
                if (helpModal && helpModal.classList.contains('active')) {
                    closeHelpModal();
                }
                const commentModal = document.getElementById('commentModal');
                if (commentModal && commentModal.classList.contains('active')) {
                    closeCommentModal();
                }
            }
        });

        // ========================================
        // COMMENT MODAL FUNCTIONS
        // ========================================

        function openCommentModal() {
            document.getElementById('commentModal').classList.add('active');
        }

        function closeCommentModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('commentModal').classList.remove('active');
            // Reset form
            document.getElementById('commentName').value = '';
            document.getElementById('commentType').value = 'frage';
            document.getElementById('commentText').value = '';
        }

        async function submitComment() {
            const name = document.getElementById('commentName').value.trim();
            const typ = document.getElementById('commentType').value;
            const text = document.getElementById('commentText').value.trim();

            // Validation
            if (!name) {
                alert('Bitte gib deinen Namen/Kürzel ein.');
                return;
            }
            if (!text) {
                alert('Bitte schreibe einen Kommentar.');
                return;
            }

            const commentEntry = {
                type: 'comment',  // Wichtig für das Google Script
                id: 'com_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                kommentarTyp: typ,
                kommentar: text,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent.substring(0, 100),
                page: 'hilfe-modal'
            };

            const submitBtn = document.getElementById('commentSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sende...';

            try {
                if (GOOGLE_SCRIPT_URL) {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(commentEntry)
                    });
                }

                // Also save locally as backup
                const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
                stored.unshift(commentEntry);
                localStorage.setItem('tiage_comments', JSON.stringify(stored));

                alert('Danke für deinen Kommentar!');
                closeCommentModal();

            } catch (error) {
                console.error('Comment error:', error);
                // Save locally on error
                const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
                stored.unshift(commentEntry);
                localStorage.setItem('tiage_comments', JSON.stringify(stored));
                alert('Kommentar lokal gespeichert. (Server nicht erreichbar)');
                closeCommentModal();
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Absenden';
        }

        // ========================================
        // COMMENTS LIST MODAL FUNCTIONS
        // ========================================

        let allCommentsData = [];
        let currentSearchQuery = '';

        function openCommentsListModal() {
            console.log('openCommentsListModal called');
            document.getElementById('commentsListModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset search field
            const searchInput = document.getElementById('commentsSearchInput');
            if (searchInput) searchInput.value = '';
            currentSearchQuery = '';
            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) clearBtn.classList.remove('visible');
            const resultsDiv = document.getElementById('commentsSearchResults');
            if (resultsDiv) resultsDiv.style.display = 'none';

            loadAllComments();
        }

        function closeCommentsListModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('commentsListModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function loadAllComments() {
            const container = document.getElementById('commentsListBody');
            container.innerHTML = '<div class="no-comments"><div class="no-comments-icon">⏳</div><p>Lade Kommentare...</p></div>';

            try {
                // Load from localStorage - nur eine Quelle: tiage_comments
                const localComments = JSON.parse(localStorage.getItem('tiage_comments') || '[]');

                // Deduplizierung basierend auf Name + Titel + Text
                const seen = new Set();
                const getUniqueKey = (item) => {
                    const name = (item.Name || item.name || '').toLowerCase().trim();
                    const titel = (item.Titel || item.titel || '').toLowerCase().trim();
                    const text = (item.Kommentar || item.kommentar || item.text || item.comment || '').toLowerCase().trim();
                    return `${name}|${titel}|${text}`;
                };

                allCommentsData = [];

                // Add local comments
                localComments.forEach(item => {
                    const key = getUniqueKey(item);
                    if (!seen.has(key)) {
                        seen.add(key);
                        allCommentsData.push(item);
                    }
                });

                // Try to load from server if available
                if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                    try {
                        const response = await fetch(GOOGLE_SCRIPT_URL);
                        const serverData = await response.json();
                        // Merge server data (avoiding duplicates)
                        serverData.forEach(item => {
                            const key = getUniqueKey(item);
                            if (!seen.has(key)) {
                                seen.add(key);
                                allCommentsData.push(item);
                            }
                        });
                    } catch (e) {
                        console.log('Server not available, using local data only');
                    }
                }

                // Sort by date (newest first)
                allCommentsData.sort((a, b) => {
                    const dateA = new Date(a.timestamp || a.Timestamp || a.datum || 0);
                    const dateB = new Date(b.timestamp || b.Timestamp || b.datum || 0);
                    return dateB - dateA;
                });

                renderCommentsList();
            } catch (error) {
                console.error('Error loading comments:', error);
                container.innerHTML = '<div class="no-comments"><div class="no-comments-icon">❌</div><p>Fehler beim Laden der Kommentare</p></div>';
            }
        }

        function renderCommentsList() {
            const container = document.getElementById('commentsListBody');

            if (allCommentsData.length === 0) {
                container.innerHTML = `
                    <div class="no-comments">
                        <div class="no-comments-icon">💬</div>
                        <p>Noch keine Kommentare vorhanden.</p>
                        <p style="font-size: 12px; margin-top: 10px;">Sei der Erste, der einen Kommentar hinterlässt!</p>
                    </div>
                `;
                return;
            }

            // Separate main comments from replies
            const mainComments = allCommentsData.filter(c => !(c.AntwortAuf || c.antwortAuf || c.replyTo));
            const replies = allCommentsData.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));

            let html = '';

            mainComments.forEach((comment, index) => {
                const id = comment.id || comment.ID || `comment-${index}`;
                const name = comment.Name || comment.name || 'Anonym';
                const titel = comment.Titel || comment.titel || comment.type || '';
                const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
                const kontext = comment.KontextID || comment.kontextId || comment.context || '';
                const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
                const timestamp = comment.timestamp || comment.Timestamp || comment.datum;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                // Find replies to this comment
                const commentReplies = replies.filter(r =>
                    (r.AntwortAuf || r.antwortAuf || r.replyTo) === id
                );

                html += `
                    <div class="comment-card" data-id="${id}">
                        <div class="comment-card-header">
                            <div>
                                <span class="comment-author">${escapeHtml(name)}</span>
                                <span class="comment-date">${date}</span>
                            </div>
                            <span class="comment-type-badge type-${typ || 'comment'}">${getTypeBadge(typ)}</span>
                        </div>
                        <div class="comment-card-body">
                            ${titel ? `<div class="comment-title">${escapeHtml(titel)}</div>` : ''}
                            <div class="comment-text">${escapeHtml(text)}</div>
                            ${kontext ? `<div class="comment-context">📍 Kontext: ${escapeHtml(kontext)}</div>` : ''}
                        </div>
                        ${commentReplies.length > 0 ? renderReplies(commentReplies) : ''}
                        <div class="comment-card-footer">
                            <span style="font-size: 11px; color: var(--text-muted);">${commentReplies.length} Antwort${commentReplies.length !== 1 ? 'en' : ''}</span>
                            <button class="reply-btn" onclick="toggleReplyForm('${id}')">↩ Antworten</button>
                        </div>
                        <div class="reply-form" id="reply-form-${id}">
                            <input type="text" id="reply-name-${id}" placeholder="Dein Name" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                            <textarea id="reply-text-${id}" placeholder="Deine Antwort..."></textarea>
                            <div class="reply-form-buttons">
                                <button class="reply-cancel-btn" onclick="toggleReplyForm('${id}')">Abbrechen</button>
                                <button class="reply-submit-btn" onclick="submitReply('${id}')">Antworten</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderReplies(replies) {
            let html = '<div class="replies-section">';
            replies.forEach(reply => {
                const name = reply.Name || reply.name || 'Anonym';
                const text = reply.Kommentar || reply.kommentar || reply.text || '';
                const timestamp = reply.timestamp || reply.Timestamp;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                html += `
                    <div class="reply-card">
                        <div class="reply-header">
                            <span class="reply-author">${escapeHtml(name)}</span>
                            <span class="reply-date">${date}</span>
                        </div>
                        <div class="reply-text">${escapeHtml(text)}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        // Convert wildcard pattern to regex
        function wildcardToRegex(pattern) {
            // Escape special regex characters except *
            const escaped = pattern.replace(/[.+?^${}()|[\]\\]/g, '\\$&');
            // Convert * to .* for wildcard matching
            const regex = escaped.replace(/\*/g, '.*');
            return new RegExp(regex, 'i'); // Case insensitive
        }

        // Check if a comment matches the search query
        function commentMatchesSearch(comment, query) {
            if (!query || query.trim() === '') return true;

            const searchPattern = wildcardToRegex(query.trim());

            // Get all searchable fields
            const name = comment.Name || comment.name || '';
            const titel = comment.Titel || comment.titel || comment.type || '';
            const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
            const kontext = comment.KontextID || comment.kontextId || comment.context || '';
            const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
            const typLabel = getTypeBadge(typ);

            // Check if any field matches
            return searchPattern.test(name) ||
                   searchPattern.test(titel) ||
                   searchPattern.test(text) ||
                   searchPattern.test(kontext) ||
                   searchPattern.test(typ) ||
                   searchPattern.test(typLabel);
        }

        // Filter and render comments based on search query
        function filterComments(query) {
            currentSearchQuery = query;

            // Update clear button visibility
            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) {
                clearBtn.classList.toggle('visible', query.length > 0);
            }

            renderFilteredComments();
        }

        // Clear search and show all comments
        function clearCommentsSearch() {
            const input = document.getElementById('commentsSearchInput');
            if (input) {
                input.value = '';
            }
            currentSearchQuery = '';

            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) {
                clearBtn.classList.remove('visible');
            }

            const resultsDiv = document.getElementById('commentsSearchResults');
            if (resultsDiv) {
                resultsDiv.style.display = 'none';
            }

            renderCommentsList();
        }

        // Render comments with current filter applied
        function renderFilteredComments() {
            const container = document.getElementById('commentsListBody');
            const resultsDiv = document.getElementById('commentsSearchResults');

            if (!currentSearchQuery || currentSearchQuery.trim() === '') {
                if (resultsDiv) resultsDiv.style.display = 'none';
                renderCommentsList();
                return;
            }

            // Filter comments
            const filteredComments = allCommentsData.filter(c => commentMatchesSearch(c, currentSearchQuery));

            // Show results count
            if (resultsDiv) {
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = `${filteredComments.length} von ${allCommentsData.length} Kommentare${filteredComments.length !== 1 ? 'n' : ''} gefunden`;
            }

            if (filteredComments.length === 0) {
                container.innerHTML = `
                    <div class="no-comments">
                        <div class="no-comments-icon">🔍</div>
                        <p>Keine Kommentare gefunden.</p>
                        <p style="font-size: 12px; margin-top: 10px;">Versuche einen anderen Suchbegriff oder verwende * als Platzhalter.</p>
                    </div>
                `;
                return;
            }

            // Separate main comments from replies
            const mainComments = filteredComments.filter(c => !(c.AntwortAuf || c.antwortAuf || c.replyTo));
            const allReplies = allCommentsData.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));
            const filteredReplies = filteredComments.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));

            let html = '';

            // Render matching main comments
            mainComments.forEach((comment, index) => {
                const id = comment.id || comment.ID || `comment-${index}`;
                const name = comment.Name || comment.name || 'Anonym';
                const titel = comment.Titel || comment.titel || comment.type || '';
                const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
                const kontext = comment.KontextID || comment.kontextId || comment.context || '';
                const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
                const timestamp = comment.timestamp || comment.Timestamp || comment.datum;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                // Find all replies to this comment (not filtered)
                const commentReplies = allReplies.filter(r =>
                    (r.AntwortAuf || r.antwortAuf || r.replyTo) === id
                );

                html += `
                    <div class="comment-card" data-id="${id}">
                        <div class="comment-card-header">
                            <div>
                                <span class="comment-author">${highlightMatch(escapeHtml(name), currentSearchQuery)}</span>
                                <span class="comment-date">${date}</span>
                            </div>
                            <span class="comment-type-badge type-${typ || 'comment'}">${getTypeBadge(typ)}</span>
                        </div>
                        <div class="comment-card-body">
                            ${titel ? `<div class="comment-title">${highlightMatch(escapeHtml(titel), currentSearchQuery)}</div>` : ''}
                            <div class="comment-text">${highlightMatch(escapeHtml(text), currentSearchQuery)}</div>
                            ${kontext ? `<div class="comment-context">📍 Kontext: ${highlightMatch(escapeHtml(kontext), currentSearchQuery)}</div>` : ''}
                        </div>
                        ${commentReplies.length > 0 ? renderRepliesWithHighlight(commentReplies, currentSearchQuery) : ''}
                        <div class="comment-card-footer">
                            <span style="font-size: 11px; color: var(--text-muted);">${commentReplies.length} Antwort${commentReplies.length !== 1 ? 'en' : ''}</span>
                            <button class="reply-btn" onclick="toggleReplyForm('${id}')">↩ Antworten</button>
                        </div>
                        <div class="reply-form" id="reply-form-${id}">
                            <input type="text" id="reply-name-${id}" placeholder="Dein Name" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                            <textarea id="reply-text-${id}" placeholder="Deine Antwort..."></textarea>
                            <div class="reply-form-buttons">
                                <button class="reply-cancel-btn" onclick="toggleReplyForm('${id}')">Abbrechen</button>
                                <button class="reply-submit-btn" onclick="submitReply('${id}')">Antworten</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Also show replies that match but their parent doesn't
            const orphanReplies = filteredReplies.filter(reply => {
                const parentId = reply.AntwortAuf || reply.antwortAuf || reply.replyTo;
                return !mainComments.some(c => (c.id || c.ID) === parentId);
            });

            if (orphanReplies.length > 0) {
                html += `<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border);">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">Passende Antworten:</div>
                `;
                orphanReplies.forEach(reply => {
                    const name = reply.Name || reply.name || 'Anonym';
                    const text = reply.Kommentar || reply.kommentar || reply.text || '';
                    const timestamp = reply.timestamp || reply.Timestamp;
                    const date = timestamp ? formatCommentDate(timestamp) : '';

                    html += `
                        <div class="reply-card" style="margin-left: 0; background: var(--bg-secondary); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <div class="reply-header">
                                <span class="reply-author">${highlightMatch(escapeHtml(name), currentSearchQuery)}</span>
                                <span class="reply-date">${date}</span>
                            </div>
                            <div class="reply-text">${highlightMatch(escapeHtml(text), currentSearchQuery)}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            container.innerHTML = html;
        }

        // Highlight matching text in search results
        function highlightMatch(text, query) {
            if (!query || query.trim() === '') return text;

            try {
                const pattern = wildcardToRegex(query.trim());
                return text.replace(pattern, match => `<span class="search-highlight">${match}</span>`);
            } catch (e) {
                return text;
            }
        }

        // Render replies with search highlighting
        function renderRepliesWithHighlight(replies, query) {
            let html = '<div class="replies-section">';
            replies.forEach(reply => {
                const name = reply.Name || reply.name || 'Anonym';
                const text = reply.Kommentar || reply.kommentar || reply.text || '';
                const timestamp = reply.timestamp || reply.Timestamp;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                html += `
                    <div class="reply-card">
                        <div class="reply-header">
                            <span class="reply-author">${highlightMatch(escapeHtml(name), query)}</span>
                            <span class="reply-date">${date}</span>
                        </div>
                        <div class="reply-text">${highlightMatch(escapeHtml(text), query)}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function toggleReplyForm(commentId) {
            const form = document.getElementById(`reply-form-${commentId}`);
            if (form) {
                form.classList.toggle('active');
            }
        }

        async function submitReply(parentId) {
            const nameInput = document.getElementById(`reply-name-${parentId}`);
            const textInput = document.getElementById(`reply-text-${parentId}`);

            const name = nameInput?.value.trim() || 'Anonym';
            const text = textInput?.value.trim();

            if (!text) {
                alert('Bitte gib eine Antwort ein.');
                return;
            }

            const reply = {
                id: 'reply_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                Name: name,
                Kommentar: text,
                AntwortAuf: parentId,
                timestamp: new Date().toISOString(),
                Typ: 'antwort'
            };

            // Save locally
            const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
            stored.push(reply);
            localStorage.setItem('tiage_comments', JSON.stringify(stored));

            // Try to save to server
            if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(reply)
                    });
                } catch (e) {
                    console.log('Server save failed, reply saved locally');
                }
            }

            // Clear form and reload
            if (nameInput) nameInput.value = '';
            if (textInput) textInput.value = '';
            toggleReplyForm(parentId);

            // Reload comments
            loadAllComments();
        }

        function formatCommentDate(timestamp) {
            try {
                const date = new Date(timestamp);
                return date.toLocaleDateString('de-DE', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return '';
            }
        }

        function getTypeBadge(typ) {
            const types = {
                'frage': 'Frage',
                'feedback': 'Comment',  // Feedback = Comment (vereinheitlicht)
                'fehler': 'Fehler',
                'verbesserung': 'Vorschlag',
                'doku': 'Doku',
                'antwort': 'Antwort',
                'comment': 'Comment'
            };
            return types[typ] || 'Comment';  // Default ist jetzt "Comment"
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ========================================
        // FEATURE 4: Archetype Info Modal
        // ========================================

        // archetypeOrder is already declared earlier in the code
        let currentArchetypeIndex = 0;

        const archetypeInfoData = {
            single: {
                title: 'Single',
                definition: 'Menschen, die bewusst keine feste Beziehung führen möchten. Sie priorisieren persönliche Freiheit, Unabhängigkeit und Selbstbestimmung.',
                features: [
                    'Vollständige emotionale und sexuelle Autonomie',
                    'Keine Verpflichtungen gegenüber einem Partner',
                    'Fokus auf Selbstentwicklung und persönliche Ziele',
                    'Wechselnde Kontakte oder zeitweise bewusste Abstinenz'
                ],
                match: 'Wenn du maximale Freiheit schätzt, keine Rechenschaft ablegen möchtest und Beziehungsstrukturen als einengend empfindest. Ideal für Menschen, die ihre Unabhängigkeit über alles stellen.'
            },
            duo: {
                title: 'Duo',
                definition: 'Traditionelle monogame Zweierbeziehung mit klaren Exklusivitätserwartungen. Beide Partner investieren emotional und körperlich ausschließlich ineinander.',
                features: [
                    'Emotionale und sexuelle Exklusivität',
                    'Langfristige Verbindlichkeit als Ziel',
                    'Gemeinsame Lebensplanung und Zukunftsvisionen',
                    'Tiefer emotionaler Fokus auf eine Person'
                ],
                match: 'Wenn du eine tiefe, exklusive Bindung suchst und dich am wohlsten fühlst, wenn du deine ganze emotionale Energie einer Person widmen kannst. Ideal für Menschen, die Sicherheit und Beständigkeit schätzen.'
            },
            duo_flex: {
                title: 'Duo-Flex',
                definition: 'Primärbeziehung mit Öffnungsbereitschaft. Ein Hauptpartner steht im Zentrum, aber mit Transparenz und gemeinsamen Regeln sind weitere Kontakte möglich.',
                features: [
                    'Klar definierte Primärbeziehung als Anker',
                    'Öffnung für weitere Kontakte (emotional oder körperlich)',
                    'Transparenz und offene Kommunikation essentiell',
                    'Regeln werden gemeinsam definiert'
                ],
                match: 'Wenn du eine sichere Hauptbeziehung möchtest, aber auch Freiheit für weitere Erfahrungen brauchst. Ideal für Menschen, die Struktur und Flexibilität kombinieren möchten.'
            },
            solopoly: {
                title: 'Solopoly',
                definition: 'Polyamore Orientierung ohne Hierarchien. Keine Primärbeziehung - alle Verbindungen sind gleichwertig und unabhängig voneinander.',
                features: [
                    'Keine Priorisierung einzelner Beziehungen',
                    'Maximale Autonomie in allen Verbindungen',
                    'Jede Beziehung entwickelt sich individuell',
                    'Keine gemeinsame Lebensplanung notwendig'
                ],
                match: 'Wenn du mehrere tiefe Verbindungen leben möchtest, ohne eine über die andere zu stellen. Ideal für Menschen, die Hierarchien ablehnen und absolute Beziehungsfreiheit suchen.'
            },
            poly_hedo: {
                title: 'Poly Hedo',
                definition: 'Menschen mit emotionaler Poly-Orientierung, die diese im Inneren leben. Der Logos (Verstand) hält Gefühle privat, während der Pathos (Emotion) weiterarbeitet. Keine physische Umsetzung - Genuss durch Fantasie und innere Welt.',
                features: [
                    'Emotionale Verbindung zu mehreren Menschen möglich',
                    'Beziehungen bleiben in Gedanken/Fantasie',
                    '"Die Gedanken sind frei" - Schutz der inneren Welt',
                    'Oft Primärpartner nach außen hin monogam'
                ],
                match: 'Wenn du tiefe Gefühle für mehrere Menschen entwickelst, diese aber bewusst nicht physisch auslebst und deine innere Gefühlswelt als wertvoll und privat empfindest.'
            },
            polyamor: {
                title: 'Polyamor',
                definition: 'Liebesbeziehungen zu mehreren Menschen gleichzeitig, mit Wissen und Einverständnis aller Beteiligten. Emotionale und körperliche Mehrfachbeziehungen werden aktiv gelebt.',
                features: [
                    'Mehrere emotionale und körperliche Beziehungen parallel',
                    'Ehrlichkeit und Transparenz mit allen Beteiligten',
                    'Eifersucht wird aktiv bearbeitet',
                    'Kann Hierarchien haben oder gleichwertig sein'
                ],
                match: 'Wenn du die Fähigkeit hast, mehrere Menschen gleichzeitig zu lieben und diese Gefühle auch real ausleben möchtest. Ideal für Menschen mit hoher Kommunikationsbereitschaft und emotionaler Kapazität.'
            }
        };

        function openArchetypeInfo(archetypeId) {
            console.log('openArchetypeInfo called with:', archetypeId);
            const def = archetypeInfoData[archetypeId];
            console.log('archetypeInfoData for', archetypeId, ':', def);
            if (!def) {
                console.error('No archetype info data found for:', archetypeId);
                return;
            }

            // Update current index
            currentArchetypeIndex = archetypeOrder.indexOf(archetypeId);
            if (currentArchetypeIndex === -1) currentArchetypeIndex = 0;

            updateArchetypeContent(archetypeId);
            updateArchetypeDots();

            document.getElementById('archetypeInfoModal').classList.add('active');

            // Add touch swipe support
            const modal = document.querySelector('#archetypeInfoModal .modal');
            modal.ontouchstart = handleArchetypeTouchStart;
            modal.ontouchend = handleArchetypeTouchEnd;
        }

        function updateArchetypeContent(archetypeId) {
            const def = archetypeInfoData[archetypeId];
            if (!def) return;

            document.getElementById('archetypeInfoTitle').textContent = def.title + ' - Definition';
            document.getElementById('archetypeInfoDefinition').textContent = def.definition;

            const featuresList = document.getElementById('archetypeInfoFeatures');
            featuresList.innerHTML = '';
            def.features.forEach(feature => {
                const li = document.createElement('li');
                li.textContent = feature;
                featuresList.appendChild(li);
            });

            document.getElementById('archetypeInfoMatch').textContent = def.match;
        }

        function updateArchetypeDots() {
            const dotsContainer = document.getElementById('archetypeDots');
            dotsContainer.innerHTML = '';
            archetypeOrder.forEach((id, index) => {
                const dot = document.createElement('span');
                dot.className = 'archetype-dot' + (index === currentArchetypeIndex ? ' active' : '');
                dot.onclick = () => {
                    currentArchetypeIndex = index;
                    updateArchetypeContent(archetypeOrder[index]);
                    updateArchetypeDots();
                };
                dotsContainer.appendChild(dot);
            });
        }

        function navigateArchetype(direction) {
            currentArchetypeIndex += direction;
            if (currentArchetypeIndex < 0) currentArchetypeIndex = archetypeOrder.length - 1;
            if (currentArchetypeIndex >= archetypeOrder.length) currentArchetypeIndex = 0;

            updateArchetypeContent(archetypeOrder[currentArchetypeIndex]);
            updateArchetypeDots();
        }

        let archetypeTouchStartX = 0;
        function handleArchetypeTouchStart(e) {
            archetypeTouchStartX = e.touches[0].clientX;
        }

        function handleArchetypeTouchEnd(e) {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = archetypeTouchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                navigateArchetype(diff > 0 ? 1 : -1);
            }
        }

        function closeArchetypeInfoModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('archetypeInfoModal').classList.remove('active');
        }

        // ========================================
        // FEATURE 5: LocalStorage Persistence
        // ========================================

        function saveSelectionToStorage() {
            const selection = {
                ich: {
                    archetyp: mobileIchArchetype,
                    geschlecht: personDimensions.ich.geschlecht,
                    dominanz: personDimensions.ich.dominanz, // Multi-select object
                    orientierung: personDimensions.ich.orientierung // Multi-select object
                },
                partner: {
                    archetyp: mobilePartnerArchetype,
                    geschlecht: personDimensions.partner.geschlecht,
                    dominanz: personDimensions.partner.dominanz, // Multi-select object
                    orientierung: personDimensions.partner.orientierung // Multi-select object
                }
            };

            try {
                localStorage.setItem('tiage-selection', JSON.stringify(selection));
            } catch (e) {
                console.warn('LocalStorage not available:', e);
            }
        }

        function loadSelectionFromStorage() {
            try {
                const saved = localStorage.getItem('tiage-selection');
                if (!saved) return false;

                const selection = JSON.parse(saved);

                // Restore ICH
                if (selection.ich) {
                    mobileIchArchetype = selection.ich.archetyp;
                    document.getElementById('mobileIchSelect').value = selection.ich.archetyp;

                    if (selection.ich.geschlecht) {
                        mobilePersonDimensions.ich.geschlecht = selection.ich.geschlecht;
                        const radio = document.querySelector(`input[name="mobile-ich-geschlecht"][value="${selection.ich.geschlecht}"]`);
                        if (radio) {
                            radio.checked = true;
                            radio.closest('.compact-dimension').classList.remove('needs-selection');
                        }
                    }

                    if (selection.ich.dominanz) {
                        // Handle new multi-select object format
                        if (typeof selection.ich.dominanz === 'object') {
                            mobilePersonDimensions.ich.dominanz = selection.ich.dominanz;
                            personDimensions.ich.dominanz = selection.ich.dominanz;

                            // Restore Desktop & Mobile UI checkboxes and status dropdowns
                            const shortIdMap = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'aus' };
                            let hasSelection = false;
                            for (const [type, status] of Object.entries(selection.ich.dominanz)) {
                                if (status) {
                                    hasSelection = true;
                                    const shortId = shortIdMap[type];
                                    // Desktop checkbox
                                    const checkbox = document.getElementById('ich-d-' + shortId);
                                    if (checkbox) checkbox.checked = true;
                                    // Desktop status dropdown
                                    const statusSelect = document.getElementById('ich-d-' + shortId + '-status');
                                    if (statusSelect) {
                                        statusSelect.style.display = 'inline-block';
                                        statusSelect.value = status;
                                    }
                                    // Mobile checkbox
                                    const mobileCheckbox = document.getElementById('m-ich-d-' + shortId);
                                    if (mobileCheckbox) mobileCheckbox.checked = true;
                                    // Mobile status dropdown
                                    const mobileStatusSelect = document.getElementById('m-ich-d-' + shortId + '-status');
                                    if (mobileStatusSelect) {
                                        mobileStatusSelect.style.display = 'inline-block';
                                        mobileStatusSelect.value = status;
                                    }
                                }
                            }
                            if (hasSelection) {
                                const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                                const mobileDimension = document.querySelector('[data-dimension="mobile-ich-dominanz-multi"]');
                                if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new object format
                            const dominanzObj = { dominant: null, submissiv: null, switch: null, ausgeglichen: null };
                            dominanzObj[selection.ich.dominanz] = selection.ich.dominanzStatus || 'fakt';
                            mobilePersonDimensions.ich.dominanz = dominanzObj;
                            personDimensions.ich.dominanz = dominanzObj;

                            const shortIdMap = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'aus' };
                            const shortId = shortIdMap[selection.ich.dominanz];
                            if (shortId) {
                                // Desktop
                                const checkbox = document.getElementById('ich-d-' + shortId);
                                if (checkbox) checkbox.checked = true;
                                const statusSelect = document.getElementById('ich-d-' + shortId + '-status');
                                if (statusSelect) {
                                    statusSelect.style.display = 'inline-block';
                                    statusSelect.value = selection.ich.dominanzStatus || 'fakt';
                                }
                                // Mobile
                                const mobileCheckbox = document.getElementById('m-ich-d-' + shortId);
                                if (mobileCheckbox) mobileCheckbox.checked = true;
                                const mobileStatusSelect = document.getElementById('m-ich-d-' + shortId + '-status');
                                if (mobileStatusSelect) {
                                    mobileStatusSelect.style.display = 'inline-block';
                                    mobileStatusSelect.value = selection.ich.dominanzStatus || 'fakt';
                                }
                            }
                            const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                            const mobileDimension = document.querySelector('[data-dimension="mobile-ich-dominanz-multi"]');
                            if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.ich.orientierung) {
                        // Handle new multi-select object format
                        if (typeof selection.ich.orientierung === 'object') {
                            mobilePersonDimensions.ich.orientierung = selection.ich.orientierung;
                            personDimensions.ich.orientierung = selection.ich.orientierung;

                            // Restore Desktop & Mobile UI checkboxes and status dropdowns
                            const shortIdMap = { 'heterosexuell': 'het', 'homosexuell': 'hom', 'bisexuell': 'bi' };
                            let hasSelection = false;
                            for (const [type, status] of Object.entries(selection.ich.orientierung)) {
                                if (status) {
                                    hasSelection = true;
                                    const shortId = shortIdMap[type];
                                    // Desktop checkbox
                                    const checkbox = document.getElementById('ich-o-' + shortId);
                                    if (checkbox) checkbox.checked = true;
                                    // Desktop status dropdown
                                    const statusSelect = document.getElementById('ich-o-' + shortId + '-status');
                                    if (statusSelect) {
                                        statusSelect.style.display = 'inline-block';
                                        statusSelect.value = status;
                                    }
                                    // Mobile checkbox
                                    const mobileCheckbox = document.getElementById('m-ich-o-' + shortId);
                                    if (mobileCheckbox) mobileCheckbox.checked = true;
                                    // Mobile status dropdown
                                    const mobileStatusSelect = document.getElementById('m-ich-o-' + shortId + '-status');
                                    if (mobileStatusSelect) {
                                        mobileStatusSelect.style.display = 'inline-block';
                                        mobileStatusSelect.value = status;
                                    }
                                }
                            }
                            if (hasSelection) {
                                const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                                const mobileDimension = document.querySelector('[data-dimension="mobile-ich-orientierung-multi"]');
                                if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new object format
                            const orientierungObj = { heterosexuell: null, homosexuell: null, bisexuell: null };
                            orientierungObj[selection.ich.orientierung] = selection.ich.orientierungStatus || 'fakt';
                            mobilePersonDimensions.ich.orientierung = orientierungObj;
                            personDimensions.ich.orientierung = orientierungObj;

                            const shortIdMap = { 'heterosexuell': 'het', 'homosexuell': 'hom', 'bisexuell': 'bi' };
                            const shortId = shortIdMap[selection.ich.orientierung];
                            if (shortId) {
                                // Desktop
                                const checkbox = document.getElementById('ich-o-' + shortId);
                                if (checkbox) checkbox.checked = true;
                                const statusSelect = document.getElementById('ich-o-' + shortId + '-status');
                                if (statusSelect) {
                                    statusSelect.style.display = 'inline-block';
                                    statusSelect.value = selection.ich.orientierungStatus || 'fakt';
                                }
                                // Mobile
                                const mobileCheckbox = document.getElementById('m-ich-o-' + shortId);
                                if (mobileCheckbox) mobileCheckbox.checked = true;
                                const mobileStatusSelect = document.getElementById('m-ich-o-' + shortId + '-status');
                                if (mobileStatusSelect) {
                                    mobileStatusSelect.style.display = 'inline-block';
                                    mobileStatusSelect.value = selection.ich.orientierungStatus || 'fakt';
                                }
                            }
                            const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                            const mobileDimension = document.querySelector('[data-dimension="mobile-ich-orientierung-multi"]');
                            if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                        }
                    }
                }

                // Restore PARTNER
                if (selection.partner) {
                    mobilePartnerArchetype = selection.partner.archetyp;
                    document.getElementById('mobilePartnerSelect').value = selection.partner.archetyp;

                    if (selection.partner.geschlecht) {
                        mobilePersonDimensions.partner.geschlecht = selection.partner.geschlecht;
                        const radio = document.querySelector(`input[name="mobile-partner-geschlecht"][value="${selection.partner.geschlecht}"]`);
                        if (radio) {
                            radio.checked = true;
                            radio.closest('.compact-dimension').classList.remove('needs-selection');
                        }
                    }

                    if (selection.partner.dominanz) {
                        // Handle new multi-select object format
                        if (typeof selection.partner.dominanz === 'object') {
                            mobilePersonDimensions.partner.dominanz = selection.partner.dominanz;
                            personDimensions.partner.dominanz = selection.partner.dominanz;

                            // Restore Desktop & Mobile UI checkboxes and status dropdowns
                            const shortIdMap = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'aus' };
                            let hasSelection = false;
                            for (const [type, status] of Object.entries(selection.partner.dominanz)) {
                                if (status) {
                                    hasSelection = true;
                                    const shortId = shortIdMap[type];
                                    // Desktop checkbox
                                    const checkbox = document.getElementById('partner-d-' + shortId);
                                    if (checkbox) checkbox.checked = true;
                                    // Desktop status dropdown
                                    const statusSelect = document.getElementById('partner-d-' + shortId + '-status');
                                    if (statusSelect) {
                                        statusSelect.style.display = 'inline-block';
                                        statusSelect.value = status;
                                    }
                                    // Mobile checkbox
                                    const mobileCheckbox = document.getElementById('m-partner-d-' + shortId);
                                    if (mobileCheckbox) mobileCheckbox.checked = true;
                                    // Mobile status dropdown
                                    const mobileStatusSelect = document.getElementById('m-partner-d-' + shortId + '-status');
                                    if (mobileStatusSelect) {
                                        mobileStatusSelect.style.display = 'inline-block';
                                        mobileStatusSelect.value = status;
                                    }
                                }
                            }
                            if (hasSelection) {
                                const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                                const mobileDimension = document.querySelector('[data-dimension="mobile-partner-dominanz-multi"]');
                                if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new object format
                            const dominanzObj = { dominant: null, submissiv: null, switch: null, ausgeglichen: null };
                            dominanzObj[selection.partner.dominanz] = selection.partner.dominanzStatus || 'fakt';
                            mobilePersonDimensions.partner.dominanz = dominanzObj;
                            personDimensions.partner.dominanz = dominanzObj;

                            const shortIdMap = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'aus' };
                            const shortId = shortIdMap[selection.partner.dominanz];
                            if (shortId) {
                                // Desktop
                                const checkbox = document.getElementById('partner-d-' + shortId);
                                if (checkbox) checkbox.checked = true;
                                const statusSelect = document.getElementById('partner-d-' + shortId + '-status');
                                if (statusSelect) {
                                    statusSelect.style.display = 'inline-block';
                                    statusSelect.value = selection.partner.dominanzStatus || 'fakt';
                                }
                                // Mobile
                                const mobileCheckbox = document.getElementById('m-partner-d-' + shortId);
                                if (mobileCheckbox) mobileCheckbox.checked = true;
                                const mobileStatusSelect = document.getElementById('m-partner-d-' + shortId + '-status');
                                if (mobileStatusSelect) {
                                    mobileStatusSelect.style.display = 'inline-block';
                                    mobileStatusSelect.value = selection.partner.dominanzStatus || 'fakt';
                                }
                            }
                            const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                            const mobileDimension = document.querySelector('[data-dimension="mobile-partner-dominanz-multi"]');
                            if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.partner.orientierung) {
                        // Handle new multi-select object format
                        if (typeof selection.partner.orientierung === 'object') {
                            mobilePersonDimensions.partner.orientierung = selection.partner.orientierung;
                            personDimensions.partner.orientierung = selection.partner.orientierung;

                            // Restore Desktop & Mobile UI checkboxes and status dropdowns
                            const shortIdMap = { 'heterosexuell': 'het', 'homosexuell': 'hom', 'bisexuell': 'bi' };
                            let hasSelection = false;
                            for (const [type, status] of Object.entries(selection.partner.orientierung)) {
                                if (status) {
                                    hasSelection = true;
                                    const shortId = shortIdMap[type];
                                    // Desktop checkbox
                                    const checkbox = document.getElementById('partner-o-' + shortId);
                                    if (checkbox) checkbox.checked = true;
                                    // Desktop status dropdown
                                    const statusSelect = document.getElementById('partner-o-' + shortId + '-status');
                                    if (statusSelect) {
                                        statusSelect.style.display = 'inline-block';
                                        statusSelect.value = status;
                                    }
                                    // Mobile checkbox
                                    const mobileCheckbox = document.getElementById('m-partner-o-' + shortId);
                                    if (mobileCheckbox) mobileCheckbox.checked = true;
                                    // Mobile status dropdown
                                    const mobileStatusSelect = document.getElementById('m-partner-o-' + shortId + '-status');
                                    if (mobileStatusSelect) {
                                        mobileStatusSelect.style.display = 'inline-block';
                                        mobileStatusSelect.value = status;
                                    }
                                }
                            }
                            if (hasSelection) {
                                const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                                const mobileDimension = document.querySelector('[data-dimension="mobile-partner-orientierung-multi"]');
                                if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new object format
                            const orientierungObj = { heterosexuell: null, homosexuell: null, bisexuell: null };
                            orientierungObj[selection.partner.orientierung] = selection.partner.orientierungStatus || 'fakt';
                            mobilePersonDimensions.partner.orientierung = orientierungObj;
                            personDimensions.partner.orientierung = orientierungObj;

                            const shortIdMap = { 'heterosexuell': 'het', 'homosexuell': 'hom', 'bisexuell': 'bi' };
                            const shortId = shortIdMap[selection.partner.orientierung];
                            if (shortId) {
                                // Desktop
                                const checkbox = document.getElementById('partner-o-' + shortId);
                                if (checkbox) checkbox.checked = true;
                                const statusSelect = document.getElementById('partner-o-' + shortId + '-status');
                                if (statusSelect) {
                                    statusSelect.style.display = 'inline-block';
                                    statusSelect.value = selection.partner.orientierungStatus || 'fakt';
                                }
                                // Mobile
                                const mobileCheckbox = document.getElementById('m-partner-o-' + shortId);
                                if (mobileCheckbox) mobileCheckbox.checked = true;
                                const mobileStatusSelect = document.getElementById('m-partner-o-' + shortId + '-status');
                                if (mobileStatusSelect) {
                                    mobileStatusSelect.style.display = 'inline-block';
                                    mobileStatusSelect.value = selection.partner.orientierungStatus || 'fakt';
                                }
                            }
                            const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                            const mobileDimension = document.querySelector('[data-dimension="mobile-partner-orientierung-multi"]');
                            if (mobileDimension) mobileDimension.classList.remove('needs-selection');
                        }
                    }
                }

                // Sync mobilePersonDimensions to personDimensions for desktop view
                personDimensions.ich = { ...mobilePersonDimensions.ich };
                personDimensions.partner = { ...mobilePersonDimensions.partner };

                // Sync all UIs (Desktop, Mobile, Modal) for dominanz
                if (typeof syncDominanzUI === 'function') {
                    syncDominanzUI('ich');
                    syncDominanzUI('partner');
                }

                return true;
            } catch (e) {
                console.warn('Failed to load from LocalStorage:', e);
                return false;
            }
        }

        function resetAll() {
            if (!confirm('Möchtest du wirklich alle Eingaben zurücksetzen?')) {
                return;
            }

            // Clear LocalStorage
            try {
                localStorage.removeItem('tiage-selection');
            } catch (e) {
                console.warn('LocalStorage not available:', e);
            }

            // Reset mobile selections
            mobileIchArchetype = 'single';
            mobilePartnerArchetype = 'duo';
            const emptyDominanz = { dominant: null, submissiv: null, switch: null, ausgeglichen: null };
            const emptyOrientierung = { heterosexuell: null, homosexuell: null, bisexuell: null };
            mobilePersonDimensions = {
                ich: { geschlecht: null, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } },
                partner: { geschlecht: null, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } }
            };

            // Reset personDimensions for desktop
            personDimensions.ich = { geschlecht: null, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } };
            personDimensions.partner = { geschlecht: null, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } };

            // Reset dropdowns
            document.getElementById('mobileIchSelect').value = 'single';
            document.getElementById('mobilePartnerSelect').value = 'duo';

            // Reset all radio buttons
            document.querySelectorAll('.mobile-page input[type="radio"]').forEach(radio => {
                radio.checked = false;
                const dimension = radio.closest('.compact-dimension');
                if (dimension) {
                    dimension.classList.add('needs-selection');
                }
            });

            // Reset Desktop, Mobile and Modal multi-select checkboxes and status dropdowns
            const shortIds = ['dom', 'sub', 'sw', 'aus'];
            ['ich', 'partner'].forEach(person => {
                shortIds.forEach(shortId => {
                    // Desktop
                    const checkbox = document.getElementById(person + '-d-' + shortId);
                    if (checkbox) checkbox.checked = false;
                    const statusSelect = document.getElementById(person + '-d-' + shortId + '-status');
                    if (statusSelect) {
                        statusSelect.style.display = 'none';
                        statusSelect.value = 'fakt';
                    }
                    // Mobile
                    const mobileCheckbox = document.getElementById('m-' + person + '-d-' + shortId);
                    if (mobileCheckbox) mobileCheckbox.checked = false;
                    const mobileStatusSelect = document.getElementById('m-' + person + '-d-' + shortId + '-status');
                    if (mobileStatusSelect) {
                        mobileStatusSelect.style.display = 'none';
                        mobileStatusSelect.value = 'fakt';
                    }
                    // Modal
                    const modalCheckbox = document.getElementById('modal-' + person + '-d-' + shortId);
                    if (modalCheckbox) modalCheckbox.checked = false;
                    const modalStatusSelect = document.getElementById('modal-' + person + '-d-' + shortId + '-status');
                    if (modalStatusSelect) {
                        modalStatusSelect.style.display = 'none';
                        modalStatusSelect.value = 'fakt';
                    }
                });
                // Mark dominanz as needing selection (Desktop, Mobile & Modal)
                const dimension = document.querySelector('[data-dimension="' + person + '-dominanz-multi"]');
                if (dimension) dimension.classList.add('needs-selection');
                const mobileDimension = document.querySelector('[data-dimension="mobile-' + person + '-dominanz-multi"]');
                if (mobileDimension) mobileDimension.classList.add('needs-selection');
                const modalDimension = document.querySelector('[data-dimension="modal-' + person + '-dominanz-multi"]');
                if (modalDimension) modalDimension.classList.add('needs-selection');
            });

            // Go to page 1
            mobileGoToPage(1);

            // Show confirmation
            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(46, 204, 113, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            warning.textContent = '✓ Alle Eingaben wurden zurückgesetzt';
            document.body.appendChild(warning);

            setTimeout(() => warning.remove(), 3000);
        }

        // Auto-save on changes
        function initAutoSave() {
            // Save on archetype change
            document.getElementById('mobileIchSelect')?.addEventListener('change', saveSelectionToStorage);
            document.getElementById('mobilePartnerSelect')?.addEventListener('change', saveSelectionToStorage);

            // Save on dimension change
            document.querySelectorAll('.mobile-page input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', saveSelectionToStorage);
            });
        }

        // Load saved data on startup
        setTimeout(() => {
            loadSelectionFromStorage();
            initAutoSave();
        }, 500);

        // Update comparison view when data is loaded
        const originalLoadData = loadData;
        async function loadDataAndUpdateComparison() {
            await originalLoadData();
            setTimeout(updateComparisonView, 100);
        }
        loadDataAndUpdateComparison();

        // Make key functions globally accessible for onclick handlers
        window.openHelpModal = openHelpModal;
        window.closeHelpModal = closeHelpModal;
        window.showArchetypeInfo = showArchetypeInfo;
        window.openArchetypeInfo = openArchetypeInfo;
        window.closeArchetypeInfoModal = closeArchetypeInfoModal;
        window.openFactorModal = openFactorModal;
        window.closeFactorModal = closeFactorModal;
        window.closeCategoryModal = closeCategoryModal;
        window.closeDefinitionModal = closeDefinitionModal;
        window.navigateDefinition = navigateDefinition;
        window.navigateDefinitionToIndex = navigateDefinitionToIndex;
        window.showArchetypeInfoByType = showArchetypeInfoByType;
        window.openCommentModal = openCommentModal;
        window.closeCommentModal = closeCommentModal;
        window.closeFeedbackModal = closeFeedbackModal;
        window.navigateArchetype = navigateArchetype;
        window.openCommentsListModal = openCommentsListModal;
        window.closeCommentsListModal = closeCommentsListModal;
        window.toggleReplyForm = toggleReplyForm;
        window.submitReply = submitReply;

        console.log('All modal functions are now globally available');
    </script>
</body>
</html>
