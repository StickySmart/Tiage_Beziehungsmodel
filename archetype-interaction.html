<!--
 * © 2025 Ti-age.de Alle Rechte vorbehalten.
 * Dieses Werk ist urheberrechtlich geschützt.
 * Jegliche Nutzung ohne ausdrückliche Genehmigung ist untersagt.
 -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Das anarchische Ti-Age Prinzip der Paarung | Swipe</title>
    <link rel="canonical" href="https://ti-age.de/archetype-interaction.html">
    <!-- Zentrale CSS-Variablen - EINZIGE QUELLE -->
    <link rel="stylesheet" href="templates/variables.css">
    <style>
        :root {
            --primary: #457B9D;
            --primary-light: #A8D5E2;
            --bg-dark: #0f0f1a;
            --bg-card: #1a1a2e;
            --bg-hover: #252542;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0b0;
            --text-muted: #9a9aaa;
            --border: rgba(255,255,255,0.1);
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;

            /* Responsive Typography with clamp() - Desktop optimiert */
            --font-xs: clamp(0.75rem, 1.2vw + 0.5rem, 1.05rem);
            --font-sm: clamp(0.85rem, 1.3vw + 0.5rem, 1.15rem);
            --font-base: clamp(0.95rem, 1.6vw + 0.55rem, 1.35rem);
            --font-md: clamp(1.05rem, 1.9vw + 0.55rem, 1.5rem);
            --font-lg: clamp(1.25rem, 2.6vw + 0.55rem, 1.9rem);
            --font-xl: clamp(1.55rem, 3.1vw + 0.55rem, 2.6rem);
            --font-label: clamp(0.8rem, 1.1vw + 0.45rem, 1.1rem);

            /* Responsive Bar Height */
            --bar-height: clamp(16px, 1.5vw + 12px, 22px);
            --bar-radius: calc(var(--bar-height) / 2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* Pirsig Collapsible Blocks */
        .pirsig-collapsible.collapsed .pirsig-content {
            max-height: 0 !important;
            opacity: 0 !important;
            margin-top: 0 !important;
        }
        .pirsig-collapsible.collapsed .pirsig-chevron {
            transform: rotate(-90deg);
        }
        .pirsig-header:hover {
            opacity: 0.8;
        }

        /* Theme Colors */
        body.theme-single { --primary: #E63946; --primary-light: #FFB4A2; }
        body.theme-duo { --primary: #E84393; --primary-light: #FDA7DF; }
        body.theme-duo_flex { --primary: #FF6B6B; --primary-light: #FFA5A5; }
        body.theme-solopoly { --primary: #2A9D8F; --primary-light: #A8DADC; }
        body.theme-polyamor { --primary: #F4A261; --primary-light: #FFE5B4; }
        body.theme-ra { --primary: #9B5DE5; --primary-light: #D4A5FF; }
        body.theme-lat { --primary: #06D6A0; --primary-light: #B5EAD7; }
        body.theme-aromantisch { --primary: #118AB2; --primary-light: #83C5D8; }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
            text-align: center;
            padding: 12px 15px;
            background: rgba(15,15,26,0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 8px;
        }

        h1 {
            font-size: var(--font-base);
            font-weight: 400;
            letter-spacing: 2px;
            color: var(--text-secondary);
        }

        /* Language Button */
        .lang-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 15px;
            border: 2px solid var(--primary);
            background: transparent;
            color: var(--primary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            background: var(--primary);
            color: white;
        }

        .lang-icon {
            font-size: 14px;
        }

        .lang-code {
            font-weight: 700;
            text-transform: uppercase;
        }

        /* Help Button */
        .help-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--danger);
            background: transparent;
            color: var(--danger);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .help-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Header Fold Button */
        .header-fold-btn {
            padding: 4px 12px;
            font-size: 12px;
            height: 28px;
        }

        /* Quick Guide Styles */
        .quick-guide {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
            border: 1px solid var(--success);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .quick-guide h3 {
            color: var(--success);
            margin: 0 0 10px 0;
            font-size: var(--font-md);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-guide ul {
            margin: 0;
            padding-left: 20px;
        }

        .quick-guide li {
            margin-bottom: 6px;
            color: var(--text-secondary);
            font-size: var(--font-sm);
        }

        /* Comment Button Section */
        .comment-section {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.1), rgba(74, 144, 226, 0.05));
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .comment-section p {
            color: var(--text-secondary);
            font-size: var(--font-sm);
            margin: 0 0 12px 0;
        }

        .comment-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: var(--font-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .comment-btn:hover {
            background: #3a7bc8;
            transform: translateY(-1px);
        }

        /* View Comments Button (Yellow) */
        .view-comments-btn {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #1a1a2e;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: var(--font-sm);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .view-comments-btn:hover {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.4);
        }

        /* Comments List Modal */
        .comments-list-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2200;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .comments-list-overlay.active {
            display: flex;
        }

        .comments-list-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            margin: 40px auto;
            border: 1px solid var(--border);
        }

        .comments-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(243, 156, 18, 0.05));
        }

        .comments-list-header h2 {
            color: #f1c40f;
            margin: 0;
            font-size: var(--font-lg);
        }

        .comments-search-container {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
        }

        .comments-search-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .comments-search-input {
            width: 100%;
            padding: 10px 40px 10px 35px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .comments-search-input:focus {
            outline: none;
            border-color: #f1c40f;
            box-shadow: 0 0 0 3px rgba(241, 196, 15, 0.15);
        }

        .comments-search-input::placeholder {
            color: var(--text-muted);
        }

        .comments-search-icon {
            position: absolute;
            left: 12px;
            color: var(--text-muted);
            pointer-events: none;
        }

        .comments-search-clear {
            position: absolute;
            right: 8px;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 5px;
            font-size: 16px;
            display: none;
        }

        .comments-search-clear:hover {
            color: var(--text-primary);
        }

        .comments-search-clear.visible {
            display: block;
        }

        .comments-search-hint {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .comments-search-results {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 8px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }

        .search-highlight {
            background: rgba(241, 196, 15, 0.3);
            padding: 0 2px;
            border-radius: 2px;
        }

        .comments-list-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .comments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comment-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .comment-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid var(--border);
        }

        .comment-author {
            font-weight: 600;
            color: var(--primary);
        }

        .comment-date {
            font-size: 11px;
            color: var(--text-muted);
        }

        .comment-type-badge {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .comment-type-badge.type-fehler {
            background: #dc3545;
        }

        .comment-type-badge.type-frage {
            background: #17a2b8;
        }

        .comment-type-badge.type-verbesserung {
            background: #28a745;
        }

        .comment-type-badge.type-doku {
            background: #6c757d;
        }

        .comment-type-badge.type-antwort {
            background: #6f42c1;
        }

        .comment-card-body {
            padding: 15px;
        }

        .comment-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .comment-text {
            color: var(--text-secondary);
            line-height: 1.5;
            font-size: var(--font-sm);
        }

        .comment-context {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .comment-card-footer {
            padding: 10px 15px;
            background: rgba(255,255,255,0.02);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reply-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reply-btn:hover {
            background: var(--primary);
            color: white;
        }

        .replies-section {
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid var(--primary);
            margin-top: 10px;
        }

        .reply-card {
            background: rgba(69, 123, 157, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .reply-author {
            font-weight: 600;
            color: var(--primary);
            font-size: 12px;
        }

        .reply-date {
            font-size: 10px;
            color: var(--text-muted);
        }

        .reply-text {
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.4;
        }

        .reply-form {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            display: none;
        }

        .reply-form.active {
            display: block;
        }

        .reply-form textarea {
            width: 100%;
            min-height: 80px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            color: var(--text-primary);
            font-size: 13px;
            resize: vertical;
            margin-bottom: 10px;
        }

        .reply-form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .reply-cancel-btn {
            background: transparent;
            border: 1px solid var(--text-muted);
            color: var(--text-muted);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .reply-submit-btn {
            background: var(--primary);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
        }

        .no-comments {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .no-comments-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* Documentation Section */
        .documentation-section {
            border-top: 2px solid var(--border);
            padding-top: 20px;
            margin-top: 10px;
        }

        .documentation-section > h3 {
            color: var(--text-muted);
            font-size: var(--font-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        /* Comment Modal Styles */
        .comment-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .comment-modal-overlay.active {
            display: flex;
        }

        .comment-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--border);
        }

        .comment-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .comment-modal-header h3 {
            font-size: var(--font-md);
            color: var(--text-primary);
            margin: 0;
        }

        .comment-modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }

        .comment-modal-body {
            padding: 20px;
        }

        .comment-form-group {
            margin-bottom: 15px;
        }

        .comment-form-group label {
            display: block;
            color: var(--text-secondary);
            font-size: var(--font-sm);
            margin-bottom: 6px;
        }

        .comment-form-group input,
        .comment-form-group textarea,
        .comment-form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: var(--font-sm);
            box-sizing: border-box;
        }

        .comment-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .comment-submit-btn {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: var(--font-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .comment-submit-btn:hover {
            background: #3a7bc8;
        }

        .comment-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Help Modal */
        .help-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .help-modal-overlay.active {
            display: flex;
        }

        .help-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            margin: 40px auto;
            max-height: none;
            border: 1px solid var(--border);
        }

        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            border-radius: 16px 16px 0 0;
        }

        .help-modal-header h2 {
            font-size: var(--font-lg);
            color: var(--text-primary);
            margin: 0;
        }

        .help-modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .help-modal-close:hover {
            color: var(--text-primary);
        }

        .help-modal-content {
            padding: 20px;
        }

        .help-section {
            margin-bottom: 25px;
        }

        .help-section h3 {
            font-size: var(--font-md);
            color: var(--primary);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 8px;
        }

        .help-section p, .help-section li {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .help-section ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .help-section li {
            margin-bottom: 8px;
        }

        .help-formula {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .help-example {
            background: rgba(69,123,157,0.1);
            border-left: 3px solid var(--primary);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .help-example-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Carousel Container */
        .carousel-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding-top: 60px;
            height: 100vh;
        }

        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        /* Cards */
        .card {
            flex: 0 0 100vw;
            width: 100vw;
            scroll-snap-align: start;
            padding: 15px;
            overflow-y: auto;
            height: calc(100vh - 60px);
        }

        .card-inner {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            min-height: 100%;
            overflow: hidden;
        }

        .card-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: var(--font-sm);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
        }

        .card-body {
            padding: 20px;
        }

        /* Navigation Dots */
        .nav-dots {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
            background: rgba(26,26,46,0.9);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid var(--border);
        }

        .nav-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot.active {
            background: var(--primary);
            transform: scale(1.3);
        }

        .nav-dot-label {
            display: none;
        }

        .nav-arrow {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 0;
            line-height: 1;
        }

        .nav-arrow:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .nav-arrow:active {
            transform: scale(0.95);
        }

        .nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .nav-arrow:disabled:hover {
            background: transparent;
            border-color: var(--border);
            color: var(--text-secondary);
        }

        /* Main Select in Card 1 */
        .main-select {
            margin-bottom: 20px;
        }

        .main-select-label {
            font-size: var(--font-base);
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        #archetypeSelect {
            width: 100%;
            appearance: none;
            background: var(--bg-dark);
            border: 2px solid var(--primary);
            color: var(--text-primary);
            padding: 14px 45px 14px 18px;
            font-size: var(--font-md);
            border-radius: 12px;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0a0b0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
        }

        /* My Type Display */
        .my-type-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .my-type-icon {
            width: 55px;
            height: 55px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            background: var(--primary);
        }

        .my-type-name {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--primary);
        }

        .my-type-desc {
            color: var(--text-secondary);
            font-size: var(--font-base);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Collapsible Sections */
        .collapsible {
            border-top: 1px solid var(--border);
        }

        .collapsible-header {
            padding: 14px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: var(--font-base);
        }

        .collapsible-icon {
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .collapsible.open .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible.open .collapsible-content {
            max-height: 600px;
        }

        .pro-contra-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            padding-bottom: 15px;
        }

        .mini-list {
            font-size: var(--font-base);
        }

        .mini-list-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .mini-list-title.pro { color: var(--success); }
        .mini-list-title.contra { color: var(--danger); }

        .mini-list ul {
            list-style: none;
            color: var(--text-muted);
        }

        .mini-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .mini-list li::before {
            content: '•';
            position: absolute;
            left: 0;
        }

        .pathos-logos-content {
            font-size: var(--font-base);
            color: var(--text-muted);
            padding-bottom: 15px;
        }

        .pathos-logos-content p {
            margin-bottom: 10px;
            font-style: italic;
            line-height: 1.5;
        }

        /* Match Cards - HIDDEN FOR NOW (can be re-enabled later) */
        .match-section {
            margin-top: 20px;
            display: none; /* Temporarily hidden - remove this line to show again */
        }

        .match-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .match-card:active {
            transform: translateY(0);
        }

        .match-card.top {
            background: rgba(0,206,201,0.1);
            border: 1px solid rgba(0,206,201,0.3);
        }

        .match-card.challenge {
            background: rgba(231,76,60,0.1);
            border: 1px solid rgba(231,76,60,0.3);
        }

        .match-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .match-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .match-label-text {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .match-name {
            font-size: var(--font-base);
            font-weight: 500;
        }

        .match-score {
            font-size: var(--font-md);
            font-weight: 700;
        }

        .match-score.excellent { color: #00cec9; }
        .match-score.low { color: #e74c3c; }

        /* Card 2: Partner Selector */
        .partner-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .partner-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 20px;
            cursor: pointer;
            font-size: var(--font-base);
            transition: all 0.3s ease;
        }

        .partner-btn:hover {
            border-color: var(--text-muted);
            background: var(--bg-hover);
        }

        .partner-btn.active {
            border-color: var(--primary);
            background: rgba(69,123,157,0.2);
            color: var(--text-primary);
        }

        .partner-btn .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Radar Chart */
        .radar-section {
            margin-bottom: 25px;
        }

        .radar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .radar-title {
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .radar-score {
            font-size: var(--font-xl);
            font-weight: 700;
        }

        .radar-score-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
        }

        #radarChart {
            width: 100%;
            max-width: 280px;
            margin: 0 auto;
            display: block;
        }

        /* Category Bars */
        .category-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .category-label {
            width: clamp(20px, 3vw + 10px, 28px);
            font-weight: 700;
            font-size: var(--font-sm);
            color: var(--primary);
        }

        .category-bar-wrap {
            flex: 1;
        }

        .category-bar-container {
            height: var(--bar-height);
            background: rgba(255,255,255,0.05);
            border-radius: var(--bar-radius);
            overflow: hidden;
        }

        .category-bar {
            height: 100%;
            border-radius: var(--bar-radius);
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .category-bar-value {
            font-size: var(--font-xs);
            font-weight: 600;
            color: white;
        }

        .category-name {
            font-size: var(--font-sm);
            color: var(--text-muted);
            margin-top: 2px;
        }

        .bar-good { background: linear-gradient(90deg, #457B9D, #5a9bc2); }
        .bar-medium { background: linear-gradient(90deg, #f39c12, #d68910); }
        .bar-low { background: linear-gradient(90deg, #e74c3c, #c0392b); }

        /* Pro/Contra Analysis */
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .analysis-section {
            padding: 14px;
            border-radius: 10px;
        }

        .analysis-section.pro {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .analysis-section.contra {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .analysis-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .analysis-section.pro .analysis-title { color: var(--success); }
        .analysis-section.contra .analysis-title { color: var(--danger); }

        .analysis-list {
            list-style: none;
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .analysis-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .analysis-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 9px;
            width: 5px;
            height: 5px;
            border-radius: 50%;
        }

        .analysis-section.pro .analysis-list li::before { background: var(--success); }
        .analysis-section.contra .analysis-list li::before { background: var(--danger); }

        /* Card 3: Alle Typen - Mini Cards Grid */
        .mini-cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .mini-card {
            background: var(--bg-dark);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .mini-card:hover {
            border-color: var(--text-muted);
        }

        .mini-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .mini-card-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .mini-card-name {
            font-size: var(--font-base);
            font-weight: 600;
        }

        .mini-card-desc {
            font-size: var(--font-sm);
            color: var(--text-muted);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .mini-card-self-score {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .mini-card-self-score span {
            font-weight: 700;
            color: var(--primary);
        }

        /* Swipe Hint */
        .swipe-hint {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--text-muted);
            opacity: 0.7;
            animation: fadeOut 3s forwards;
            animation-delay: 2s;
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        /* Info Icon */
        .section-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .info-icon:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Clickable Category Row */
        .category-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 4px;
            margin: -4px;
            margin-bottom: 6px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .category-row:hover {
            background: rgba(255,255,255,0.05);
        }

        .category-row:active {
            background: rgba(255,255,255,0.1);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .modal-title {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        /* Archetype Navigation Buttons */
        .archetype-nav-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .archetype-nav-btn:hover {
            background: var(--primary);
            color: white;
        }

        .archetype-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .archetype-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .archetype-dot.active {
            background: var(--primary);
            transform: scale(1.3);
        }

        .archetype-dot:hover {
            background: var(--primary-light);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-subtitle {
            color: var(--text-muted);
            font-size: var(--font-sm);
            font-style: italic;
            margin-bottom: 16px;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 24px 0;
            color: var(--primary);
        }

        .explanation {
            margin-top: 20px;
        }

        .explanation h4 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: var(--text-primary);
            font-size: var(--font-base);
        }

        .explanation p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .explanation ul {
            margin: 12px 0;
            padding-left: 20px;
        }

        .explanation li {
            margin: 8px 0;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .modal-feedback-btn {
            margin-top: 20px;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .modal-feedback-btn:hover {
            border-color: var(--primary);
            box-shadow: 0 0 8px rgba(69, 123, 157, 0.3);
        }

        .category-nav-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 8px;
            background: var(--bg-dark);
            border-radius: 10px;
        }

        .category-nav-btn {
            padding: 8px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            font-size: var(--font-sm);
        }

        .category-nav-btn:hover {
            border-color: var(--primary);
            box-shadow: 0 0 8px rgba(69, 123, 157, 0.3);
        }

        .category-nav-indicator {
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        /* Definition Modal */
        .definition-modal {
            max-width: 500px;
        }

        .definition-section {
            margin-bottom: 20px;
        }

        .definition-section-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }

        .definition-long {
            font-size: var(--font-base);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .definition-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .definition-list li {
            padding: 8px 0 8px 20px;
            position: relative;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .definition-list.principles li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--success);
        }

        .definition-list.not-same li::before {
            content: '✗';
            position: absolute;
            left: 0;
            color: var(--danger);
        }

        .definition-list.variants li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .type-info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s;
        }

        .type-info-icon:hover {
            background: var(--primary);
            color: white;
        }

        .type-tooltip {
            position: relative;
            display: inline-block;
        }

        .type-tooltip .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: var(--bg-dark);
            color: var(--text-secondary);
            text-align: left;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: var(--font-sm);
            line-height: 1.4;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .type-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .modal-category {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-category:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .modal-category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .modal-category-letter {
            width: clamp(24px, 3vw + 14px, 32px);
            height: clamp(24px, 3vw + 14px, 32px);
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-sm);
        }

        .modal-category-name {
            font-weight: 600;
            font-size: var(--font-base);
            color: var(--text-primary);
        }

        .modal-category-desc {
            font-size: var(--font-base);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .modal-subdimensions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .modal-subdim-tag {
            font-size: var(--font-sm);
            padding: 6px 10px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .modal-subdim-tag:hover {
            background: rgba(255,255,255,0.15);
        }

        .modal-subdim-tag.active {
            background: var(--primary);
            color: white;
        }

        /* Tag Tooltip Container */
        .tag-tooltip-container {
            position: relative;
            display: inline-block;
        }

        /* Tag Tooltip - Click to open, stays open */
        .tag-tooltip {
            display: none;
            position: fixed;
            z-index: 1001;
            width: min(360px, 92vw);
            max-width: 92vw;
            max-height: 85vh;
            overflow-y: auto;
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        .tag-tooltip.active {
            display: block;
        }

        .tag-tooltip-close {
            position: absolute;
            top: 6px;
            right: 8px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 22px;
            cursor: pointer;
            padding: 4px 8px;
            line-height: 1;
            z-index: 10;
        }

        .tag-tooltip-close:hover {
            color: var(--text-primary);
        }

        /* Tooltip Header */
        .tag-tooltip-header {
            padding: 10px 12px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid var(--border);
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }

        /* Tooltip Body */
        .tag-tooltip-body {
            padding: 12px;
        }

        /* Type Perspective */
        .tag-tooltip-perspective {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .tag-tooltip-perspective:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .tag-tooltip-type-name {
            font-weight: 600;
            font-size: var(--font-xs);
            margin-bottom: 4px;
            display: block;
        }

        .tag-tooltip-type-text {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Dynamic Summary */
        .tag-tooltip-dynamic {
            background: rgba(69, 123, 157, 0.15);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: var(--font-xs);
            line-height: 1.4;
        }

        .tag-tooltip-dynamic::before {
            content: '→ ';
            color: var(--primary);
            font-weight: 600;
        }

        /* Type Switcher in Tooltip */
        .tag-tooltip-type-switcher {
            display: flex;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            flex-wrap: wrap;
            -webkit-overflow-scrolling: touch;
        }

        .type-switch-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 16px;
            cursor: pointer;
            font-size: var(--font-xs);
            transition: all 0.2s ease;
            pointer-events: auto;
        }

        .type-switch-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--text-secondary);
        }

        .type-switch-btn.active {
            border-color: currentColor;
            background: rgba(255,255,255,0.08);
        }

        .type-switch-btn .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .type-switch-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-right: auto;
            display: flex;
            align-items: center;
        }

        /* Responsive: Position tooltip above or below based on space */
        @media (max-width: 480px) {
            .tag-tooltip {
                width: 280px;
                left: 0;
                transform: translateX(-20%);
            }
        }

        /* Match Modal Content */
        .match-modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .match-modal-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .match-modal-info h3 {
            font-size: var(--font-lg);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .match-modal-info p {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .match-modal-score {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .match-modal-score-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .match-modal-score-value {
            font-size: var(--font-xl);
            font-weight: 700;
        }

        .match-modal-categories {
            margin-bottom: 20px;
        }

        .match-modal-categories-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .match-modal-bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .match-modal-bar-row.clickable {
            cursor: pointer;
            padding: 6px;
            margin: -6px;
            margin-bottom: 2px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .match-modal-bar-row.clickable:hover {
            background: rgba(255,255,255,0.08);
        }

        .match-modal-bar-row.clickable:active {
            background: rgba(255,255,255,0.12);
        }

        .match-modal-bar-label {
            width: 24px;
            font-weight: 700;
            font-size: var(--font-sm);
            color: var(--primary);
        }

        .match-modal-bar-container {
            flex: 1;
            height: var(--bar-height);
            background: rgba(255,255,255,0.05);
            border-radius: var(--bar-radius);
            overflow: hidden;
        }

        .match-modal-bar {
            height: 100%;
            border-radius: var(--bar-radius);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .match-modal-bar-value {
            font-size: var(--font-xs);
            font-weight: 600;
            color: white;
        }

        .match-modal-bar-name {
            width: 120px;
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-align: right;
        }

        .match-modal-section {
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .match-modal-section.pro {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .match-modal-section.contra {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .match-modal-section-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .match-modal-section.pro .match-modal-section-title { color: var(--success); }
        .match-modal-section.contra .match-modal-section-title { color: var(--danger); }

        .match-modal-list {
            list-style: none;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .match-modal-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .match-modal-list li::before {
            content: '•';
            position: absolute;
            left: 0;
        }

        /* Legend Page */
        .legend-section {
            margin-bottom: 25px;
        }

        .legend-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .color-scale {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .color-scale-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .color-scale-bar {
            width: clamp(50px, 8vw + 20px, 80px);
            height: var(--bar-height);
            border-radius: var(--bar-radius);
        }

        .color-scale-label {
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .color-scale-range {
            font-size: var(--font-sm);
            color: var(--text-muted);
            margin-left: auto;
        }

        .legend-category-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .legend-category-item:hover {
            background: var(--bg-hover);
        }

        .legend-category-letter {
            width: clamp(28px, 4vw + 16px, 36px);
            height: clamp(28px, 4vw + 16px, 36px);
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-base);
            flex-shrink: 0;
        }

        .legend-category-content {
            flex: 1;
        }

        .legend-category-name {
            font-weight: 600;
            font-size: var(--font-md);
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .legend-category-desc {
            font-size: var(--font-base);
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Responsive - Mobile (larger fonts for readability) */
        @media (max-width: 599px) {
            :root {
                --font-xs: 0.85rem;
                --font-sm: 0.95rem;
                --font-base: 1.05rem;
                --font-md: 1.15rem;
                --font-lg: 1.4rem;
                --font-xl: 1.8rem;
                --bar-height: 20px;
            }

            .modal {
                max-width: 95vw;
                max-height: 90vh;
            }

            .match-modal-bar-name {
                width: auto;
                min-width: 80px;
            }
        }

        /* Responsive - Tablet+ */
        @media (min-width: 600px) {
            .mini-cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .analysis-grid {
                grid-template-columns: 1fr 1fr;
            }

            .pro-contra-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .mini-list {
                font-size: var(--font-sm);
            }

            .mini-list-title {
                font-size: var(--font-sm);
            }
        }

        @media (min-width: 900px) {
            .card {
                padding: 20px 10%;
            }

            .mini-cards-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        /* Feedback Modal */
        .feedback-modal {
            max-width: 420px;
        }

        .feedback-context-id {
            display: inline-block;
            padding: 4px 10px;
            background: var(--bg-dark);
            border-radius: 6px;
            font-size: var(--font-xs);
            color: var(--primary);
            font-family: monospace;
            margin-bottom: 16px;
        }

        .feedback-form-group {
            margin-bottom: 16px;
        }

        .feedback-label {
            display: block;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .feedback-label .required {
            color: var(--danger);
        }

        .feedback-input,
        .feedback-textarea {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 14px;
            color: var(--text-primary);
            font-size: var(--font-base);
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .feedback-input:focus,
        .feedback-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .feedback-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Star Rating */
        .star-rating-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .star-rating-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            min-width: 80px;
        }

        .star-rating {
            display: flex;
            gap: 4px;
        }

        .star-rating .star {
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .star-rating .star:hover,
        .star-rating .star.active {
            color: #f1c40f;
            transform: scale(1.1);
        }

        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .feedback-btn-cancel,
        .feedback-btn-submit {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-btn-cancel {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .feedback-btn-cancel:hover {
            background: var(--bg-hover);
        }

        .feedback-btn-submit {
            background: var(--primary);
            border: none;
            color: white;
        }

        .feedback-btn-submit:hover {
            filter: brightness(1.1);
        }

        .feedback-btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Feedback Page (Card 4) */
        .feedback-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .feedback-filter-btn {
            padding: 8px 14px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 20px;
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-filter-btn:hover {
            background: var(--bg-hover);
        }

        .feedback-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .feedback-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .feedback-item {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid var(--border);
        }

        .feedback-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .feedback-item-context {
            font-size: var(--font-xs);
            color: var(--primary);
            font-family: monospace;
            background: rgba(255,255,255,0.05);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .feedback-item-name {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .feedback-item-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .feedback-item-comment {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .feedback-item-ratings {
            display: flex;
            gap: 20px;
            font-size: var(--font-sm);
        }

        .feedback-rating {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
        }

        .feedback-rating .stars {
            color: #f1c40f;
        }

        .feedback-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .feedback-loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        /* Advanced Feedback Filters */
        .feedback-search {
            margin-bottom: 15px;
        }

        .feedback-search-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }

        .feedback-search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .feedback-advanced-filters {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .feedback-filter-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .feedback-filter-row:last-child {
            margin-bottom: 0;
        }

        .feedback-filter-row label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            min-width: 90px;
        }

        .feedback-select {
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: var(--font-sm);
            cursor: pointer;
        }

        .filter-separator {
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        .feedback-category-btns {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cat-filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 16px;
            font-size: var(--font-xs);
            cursor: pointer;
            transition: all 0.2s;
        }

        .cat-filter-btn:hover {
            background: var(--bg-hover);
        }

        .cat-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Reply/Thread Styles */
        .feedback-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .feedback-reply-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-muted);
            font-size: var(--font-xs);
            cursor: pointer;
            transition: all 0.2s;
        }

        .feedback-reply-btn:hover {
            background: var(--bg-hover);
            color: var(--primary);
            border-color: var(--primary);
        }

        .feedback-replies {
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid var(--border);
            margin-top: 12px;
        }

        .feedback-item.reply {
            background: rgba(255,255,255,0.02);
            padding: 12px;
        }

        .feedback-item.reply .feedback-item-context {
            font-size: 10px;
        }

        .reply-indicator {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .feedback-timestamp {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Age Verification Modal */
        .age-verification-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .age-verification-overlay.hidden {
            display: none;
        }

        .age-verification-modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10001;
        }

        .age-verification-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .age-verification-modal h2 {
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: var(--font-lg);
        }

        .age-verification-modal p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: var(--font-sm);
        }

        .age-verification-question {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .age-verification-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .age-btn {
            padding: 14px 20px;
            border-radius: 10px;
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer !important;
            border: none;
            transition: all 0.2s ease;
            position: relative;
            z-index: 10002 !important;
            pointer-events: auto !important;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
            /* Ensure button is always clickable */
            display: block;
            width: 100%;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .age-btn-yes {
            background: var(--success);
            color: white;
        }

        .age-btn-yes:hover {
            background: #27ae60;
            transform: scale(1.02);
        }

        .age-btn-no {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .age-btn-no:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Ad container around buttons */
        .age-verification-ad-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            width: 100%;
            margin: 10px 0;
        }
        .age-verification-ad-left,
        .age-verification-ad-right {
            flex: 0 0 120px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .age-verification-buttons-center {
            flex: 0 0 auto;
            min-width: 200px;
        }
        /* Desktop: Wider modal without scrolling, ensure red border is fully visible */
        @media (min-width: 769px) {
            .age-verification-overlay {
                padding: 40px;
            }
            .age-verification-modal {
                max-width: 480px;
                max-height: calc(100vh - 80px);
                overflow-y: auto;
                margin: auto;
            }
        }
        @media (max-width: 768px) {
            .age-verification-ad-container {
                flex-direction: column;
            }
            .age-verification-ad-left,
            .age-verification-ad-right {
                flex: 0 0 auto;
                width: 100%;
                min-height: 100px;
            }
            /* Mobile: Larger fonts for age verification */
            .age-verification-modal h2 {
                font-size: 22px;
            }
            .age-verification-modal p {
                font-size: 16px;
            }
            .age-verification-question {
                font-size: 17px;
                padding: 18px;
            }
            .age-btn {
                font-size: 17px;
                padding: 16px 24px;
            }
            .age-verification-note {
                font-size: 13px !important;
            }
        }

        .age-verification-note {
            font-size: var(--font-xs) !important;
            color: var(--text-muted) !important;
            margin-top: 15px !important;
            margin-bottom: 0 !important;
        }

        /* Hide Vercel Toolbar */
        #vercel-live-feedback-button,
        [data-vercel-toolbar],
        iframe[src*="vercel.live"] {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* ========================================
           Extended Dimensions UI
           ======================================== */

        .dimensions-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .dimensions-section-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: rgba(69, 123, 157, 0.15);
            border-left: 3px solid var(--primary);
            border-radius: 0 8px 8px 0;
        }

        .dimensions-section-title.ich-title {
            color: var(--success);
            background: rgba(46, 204, 113, 0.15);
            border-left-color: var(--success);
        }

        .dimensions-section-title.partner-title {
            color: var(--accent);
            background: rgba(231, 76, 60, 0.15);
            border-left-color: var(--accent);
        }

        .dimension-group {
            margin-bottom: 18px;
        }

        .dimension-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .dimension-info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            color: var(--text-muted);
            font-size: 10px;
            cursor: help;
            transition: all 0.2s ease;
        }

        .dimension-info-icon:hover {
            background: var(--primary);
            color: white;
        }

        .dimension-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .dimension-radio {
            display: none;
        }

        .dimension-option {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 20px;
            background: transparent;
            color: var(--text-secondary);
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dimension-option:hover {
            border-color: var(--text-muted);
            background: var(--bg-hover);
        }

        .dimension-radio:checked + .dimension-option {
            border-color: var(--primary);
            background: rgba(69,123,157,0.2);
            color: var(--text-primary);
        }

        .dimension-option.highlight-change {
            animation: highlightPulse 0.3s ease;
        }

        @keyframes highlightPulse {
            0% { border-color: var(--primary); box-shadow: 0 0 0 0 rgba(69,123,157,0.4); }
            50% { border-color: var(--success); box-shadow: 0 0 0 4px rgba(46,204,113,0.3); }
            100% { border-color: var(--primary); box-shadow: 0 0 0 0 rgba(69,123,157,0); }
        }

        /* Blinking animation for unselected dimension groups */
        .dimension-group.needs-selection .dimension-option,
        .dimension-status-group.needs-selection .dimension-option,
        .dimension-group.needs-selection .dominanz-option-row {
            animation: needsAttention 1.5s ease-in-out infinite;
        }

        .dimension-group.needs-selection .dimension-label,
        .dimension-status-group.needs-selection .dimension-status-label {
            color: var(--warning);
        }

        @keyframes needsAttention {
            0%, 100% {
                border-color: var(--border);
                box-shadow: 0 0 0 0 rgba(243, 156, 18, 0);
            }
            50% {
                border-color: var(--warning);
                box-shadow: 0 0 8px 2px rgba(243, 156, 18, 0.3);
            }
        }

        /* Status sub-options (indented) */
        .dimension-status-group {
            margin-left: 20px;
            margin-top: 10px;
            padding-left: 10px;
            border-left: 2px solid var(--border);
        }

        .dimension-status-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        /* Compact Overview Box */
        .analysis-overview {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .analysis-overview:hover {
            border-color: var(--primary);
            background: var(--bg-hover);
        }

        .analysis-overview-title {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .analysis-overview-content {
            font-size: var(--font-sm);
            color: var(--text-primary);
            line-height: 1.4;
        }

        .analysis-overview-content .type-name {
            color: var(--primary);
            font-weight: 500;
        }

        .analysis-overview-content .dim-info {
            color: var(--text-secondary);
            font-size: var(--font-xs);
        }

        .analysis-overview-content .geschlecht-info {
            color: var(--warning);
            font-size: var(--font-xs);
            font-weight: 500;
        }

        .analysis-overview-edit {
            font-size: var(--font-xs);
            color: var(--primary);
            margin-top: 6px;
            display: inline-block;
        }

        /* Dimension Tooltip */
        .dimension-tooltip-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            pointer-events: none;
        }

        .dimension-tooltip-overlay.active {
            display: flex;
            pointer-events: auto;
        }

        .dimension-tooltip-content {
            background: var(--bg-card);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            max-width: 320px;
            width: 100%;
        }

        .dimension-tooltip-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .dimension-tooltip-text {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .dimension-tooltip-close {
            display: block;
            margin-top: 15px;
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: var(--font-sm);
            cursor: pointer;
            width: 100%;
        }

        /* Geschlecht Info Modal (scrollable) */
        .geschlecht-info-modal-content {
            background: var(--bg-card);
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 0;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .geschlecht-info-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .geschlecht-info-modal-header .dimension-tooltip-title {
            margin-bottom: 0;
        }

        .geschlecht-info-close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .geschlecht-info-close-btn:hover {
            color: var(--text-primary);
        }

        .geschlecht-info-scroll-container {
            overflow-y: auto;
            padding: 12px 20px;
            flex: 1;
            max-height: 50vh;
        }

        .geschlecht-info-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .geschlecht-info-item:last-child {
            border-bottom: none;
        }

        .geschlecht-info-name {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 6px;
        }

        .geschlecht-info-desc {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .geschlecht-info-modal-content .dimension-tooltip-close {
            margin: 16px 20px;
            flex-shrink: 0;
        }

        /* Status Popup Styles */
        .status-popup-content {
            max-width: 380px;
        }

        .status-popup-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .status-popup-btn {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 15px;
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s ease;
        }

        .status-popup-btn:hover {
            border-color: var(--primary);
            background: rgba(var(--primary-rgb), 0.1);
        }

        .status-popup-btn.interessiert:hover {
            border-color: var(--warning);
            background: rgba(255, 193, 7, 0.1);
        }

        .status-popup-btn-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
        }

        .status-popup-btn-desc {
            font-size: var(--font-xs);
            color: var(--text-muted);
            line-height: 1.4;
        }

        /* Responsive: Two columns on larger screens */
        @media (min-width: 500px) {
            .dimensions-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }

            .dimension-group.full-width {
                grid-column: 1 / -1;
            }
        }

        /* ========================================
           Pathos/Logos Check System
           ======================================== */

        /* Pathos Blocker (K.O. - No Compatibility) */
        .pathos-blocker {
            background: rgba(231, 76, 60, 0.1);
            border: 2px solid var(--danger);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .pathos-blocker.active {
            display: block;
        }

        .pathos-blocker-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .pathos-blocker-icon {
            font-size: 1.8rem;
        }

        .pathos-blocker-title {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--danger);
        }

        .pathos-blocker-reason {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .pathos-blocker-persons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
        }

        .pathos-blocker-person {
            font-size: var(--font-sm);
            color: var(--text-primary);
        }

        .pathos-blocker-person-label {
            color: var(--text-muted);
            margin-right: 8px;
        }

        .pathos-blocker-divider {
            height: 1px;
            background: var(--border);
            margin: 15px 0;
        }

        .pathos-blocker-explanation {
            margin-bottom: 15px;
        }

        .pathos-blocker-explanation h4 {
            font-size: var(--font-sm);
            color: var(--text-primary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pathos-blocker-explanation p {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .pathos-blocker-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .pathos-blocker-btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .pathos-blocker-btn-primary {
            background: var(--primary);
            color: white;
        }

        .pathos-blocker-btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .pathos-blocker-btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .pathos-blocker-btn-secondary:hover {
            background: var(--bg-hover);
        }

        /* Logos Warning (Warning, but analysis continues) */
        .logos-warning {
            background: rgba(243, 156, 18, 0.1);
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .logos-warning.active {
            display: block;
        }

        .logos-warning-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
        }

        .logos-warning-icon {
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        .logos-warning-content {
            flex: 1;
        }

        .logos-warning-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 4px;
        }

        .logos-warning-subtitle {
            font-size: var(--font-xs);
            color: var(--text-secondary);
        }

        .logos-warning-toggle {
            font-size: var(--font-xs);
            color: var(--text-muted);
            transition: transform 0.2s ease;
        }

        .logos-warning.expanded .logos-warning-toggle {
            transform: rotate(180deg);
        }

        .logos-warning-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .logos-warning.expanded .logos-warning-details {
            max-height: 400px;
        }

        .logos-warning-details-inner {
            padding-top: 15px;
            border-top: 1px solid rgba(243, 156, 18, 0.3);
            margin-top: 15px;
        }

        .logos-warning-score {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .logos-warning-score-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
        }

        .logos-warning-score-value {
            font-size: var(--font-md);
            font-weight: 700;
            color: var(--warning);
        }

        .logos-warning-text {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .logos-warning-positive {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 10px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .logos-warning-positive-icon {
            color: var(--success);
        }

        .logos-warning-positive-text {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .logos-warning-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .logos-warning-list li {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            padding: 4px 0 4px 20px;
            position: relative;
        }

        .logos-warning-list li::before {
            content: '•';
            position: absolute;
            left: 6px;
            color: var(--warning);
        }

        .logos-warning-quote {
            font-style: italic;
            font-size: var(--font-sm);
            color: var(--text-muted);
            padding: 10px;
            border-left: 2px solid var(--warning);
            margin-top: 12px;
        }

        /* Double Warning (Pathos uncertain + Logos low) */
        .double-warning {
            background: rgba(231, 76, 60, 0.08);
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .double-warning.active {
            display: block;
        }

        .double-warning-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .double-warning-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--danger);
        }

        .double-warning-item {
            padding: 10px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .double-warning-item-title {
            font-size: var(--font-xs);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .double-warning-item-text {
            font-size: var(--font-xs);
            color: var(--text-secondary);
        }

        /* Pathos uncertain warning (less severe than blocker) */
        .pathos-uncertain {
            background: rgba(243, 156, 18, 0.08);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 15px;
            display: none;
        }

        .pathos-uncertain.active {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .pathos-uncertain-icon {
            font-size: 1rem;
            flex-shrink: 0;
        }

        .pathos-uncertain-text {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Dimension Modifier Display */
        .modifier-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: var(--font-xs);
            font-weight: 500;
        }

        .modifier-badge.positive {
            background: rgba(46, 204, 113, 0.15);
            color: var(--success);
        }

        .modifier-badge.negative {
            background: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }

        .modifier-badge.neutral {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
        }

        .modifier-summary {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            display: none;
        }

        .modifier-summary.active {
            display: block;
        }

        .modifier-summary-title {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .modifier-summary-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .modifier-summary-item .modifier-icon {
            width: 20px;
            text-align: center;
        }

        .category-modifier {
            font-size: var(--font-xs);
            margin-left: 6px;
        }

        .category-modifier.positive {
            color: var(--success);
        }

        .category-modifier.negative {
            color: var(--danger);
        }

        /* ========================================
           NEW: Side-by-Side Comparison Layout
           ======================================== */

        .comparison-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 15px;
            padding-top: 70px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .comparison-column {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 15px;
        }

        .comparison-column.ich-column {
            border-top: 3px solid var(--success);
        }

        .comparison-column.partner-column {
            border-top: 3px solid var(--accent);
        }

        .column-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .column-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .ich-column .column-icon {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }

        .partner-column .column-icon {
            background: rgba(231, 76, 60, 0.2);
            color: var(--accent);
        }

        .column-title {
            font-size: var(--font-lg);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .ich-column .column-title {
            color: #2ecc71;
        }

        .partner-column .column-title {
            color: #e74c3c;
        }

        .select-with-info {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }

        .select-with-info .column-select {
            margin-bottom: 0;
        }

        /* Geschlechtsidentität Info im Header-Bereich */
        .header-geschlecht-info {
            font-size: 11px;
            color: var(--success);
            padding: 4px 8px;
            margin-bottom: 8px;
            text-align: right;
        }

        .header-geschlecht-info.missing {
            color: var(--warning, #f39c12);
        }

        /* Archetypen-Symbol-Grid */
        .archetype-symbols-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 12px;
            margin: 12px 0;
            background: var(--bg-dark);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .archetype-symbol-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            background: rgba(255, 255, 255, 0.03);
        }

        .archetype-symbol-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: scale(1.05);
        }

        .archetype-symbol-item.active {
            border-color: var(--primary);
            background: rgba(69, 123, 157, 0.2);
            box-shadow: 0 0 12px rgba(69, 123, 157, 0.3);
        }

        .archetype-symbol-icon {
            font-size: 24px;
            margin-bottom: 4px;
            transition: transform 0.2s ease;
        }

        .archetype-symbol-item:hover .archetype-symbol-icon {
            transform: scale(1.1);
        }

        .archetype-symbol-name {
            font-size: 9px;
            color: var(--text-muted);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .archetype-symbol-item.active .archetype-symbol-name {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Colors for each archetype symbol */
        .archetype-symbol-item[data-archetype="single"] .archetype-symbol-icon { color: #E63946; }
        .archetype-symbol-item[data-archetype="duo"] .archetype-symbol-icon { color: #E84393; }
        .archetype-symbol-item[data-archetype="duo_flex"] .archetype-symbol-icon { color: #FF6B6B; }
        .archetype-symbol-item[data-archetype="solopoly"] .archetype-symbol-icon { color: #2A9D8F; }
        .archetype-symbol-item[data-archetype="polyamor"] .archetype-symbol-icon { color: #F4A261; }
        .archetype-symbol-item[data-archetype="ra"] .archetype-symbol-icon { color: #9B5DE5; }
        .archetype-symbol-item[data-archetype="lat"] .archetype-symbol-icon { color: #00B4D8; }
        .archetype-symbol-item[data-archetype="aromantisch"] .archetype-symbol-icon { color: #A8DADC; }

        .archetype-symbol-item.active[data-archetype="single"] { border-color: #E63946; background: rgba(230, 57, 70, 0.2); }
        .archetype-symbol-item.active[data-archetype="duo"] { border-color: #E84393; background: rgba(232, 67, 147, 0.2); }
        .archetype-symbol-item.active[data-archetype="duo_flex"] { border-color: #FF6B6B; background: rgba(255, 107, 107, 0.2); }
        .archetype-symbol-item.active[data-archetype="solopoly"] { border-color: #2A9D8F; background: rgba(42, 157, 143, 0.2); }
        .archetype-symbol-item.active[data-archetype="polyamor"] { border-color: #F4A261; background: rgba(244, 162, 97, 0.2); }
        .archetype-symbol-item.active[data-archetype="ra"] { border-color: #9B5DE5; background: rgba(155, 93, 229, 0.2); }
        .archetype-symbol-item.active[data-archetype="lat"] { border-color: #00B4D8; background: rgba(0, 180, 216, 0.2); }
        .archetype-symbol-item.active[data-archetype="aromantisch"] { border-color: #A8DADC; background: rgba(168, 218, 220, 0.2); }

        .archetype-nav-btn {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .archetype-nav-btn:hover {
            border-color: var(--primary);
            box-shadow: 0 0 8px rgba(69, 123, 157, 0.3);
        }

        .archetype-nav-btn:active {
            transform: scale(0.95);
        }

        .archetype-info-btn {
            padding: 8px 12px;
            border-radius: 6px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .archetype-info-btn:hover {
            border-color: var(--primary);
            box-shadow: 0 0 8px rgba(69, 123, 157, 0.3);
        }

        .column-select {
            width: auto;
            min-width: 100px;
            max-width: 140px;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-primary);
            font-size: var(--font-sm);
            margin-bottom: 12px;
            cursor: pointer;
        }

        .column-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .column-dimensions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .compact-dimension {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .compact-dimension-label {
            font-size: 11px;
            color: var(--warning);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .compact-options {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        /* Klickbarer Geschlechtsidentität-Link mit Hover-Effekt */
        .geschlecht-info-link {
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            transition: all 0.2s ease;
            padding: 2px 4px;
            border-radius: 4px;
            margin: -2px -4px;
        }

        .geschlecht-info-link:hover {
            color: var(--primary);
            background: rgba(69, 123, 157, 0.15);
            text-decoration-color: var(--primary);
        }

        /* Geschlechtsidentität: Grid-Layout für 9 Optionen */
        .geschlecht-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .compact-option {
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .compact-option:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .compact-radio:checked + .compact-option {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .compact-radio {
            display: none;
        }

        /* Geschlechts-Button mit Indikatoren (I = Identität/Primär, G = Sekundär) */
        .geschlecht-btn {
            position: relative;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .geschlecht-btn:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .geschlecht-btn.primary-selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .geschlecht-btn.secondary-selected {
            background: rgba(234, 179, 8, 0.25);
            border-color: rgba(234, 179, 8, 0.6);
            color: var(--text-primary);
        }

        /* Kleine Kreis-Indikatoren für Primary (I) und Secondary (G) */
        .geschlecht-indicator {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 700;
            line-height: 1;
        }

        .geschlecht-indicator.indicator-primary {
            background: var(--primary);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .geschlecht-indicator.indicator-secondary {
            background: #eab308;
            color: #1a1a2e;
            border: 1px solid rgba(0,0,0,0.2);
        }

        /* Dominanz: Grid-Layout für 4 Optionen (2x2) */
        .dominanz-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
        }

        .dominanz-btn {
            position: relative;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .dominanz-btn:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .dominanz-btn.primary-selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .dominanz-btn.secondary-selected {
            background: rgba(234, 179, 8, 0.25);
            border-color: rgba(234, 179, 8, 0.6);
            color: var(--text-primary);
        }

        /* Orientierung: Grid-Layout für 3 Optionen (1x3) */
        .orientierung-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .orientierung-btn {
            position: relative;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-dark);
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .orientierung-btn:hover {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .orientierung-btn.primary-selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .orientierung-btn.secondary-selected {
            background: rgba(234, 179, 8, 0.25);
            border-color: rgba(234, 179, 8, 0.6);
            color: var(--text-primary);
        }

        /* Indikatoren für Dominanz/Orientierung (gleiche wie Geschlecht) */
        .dominanz-btn .geschlecht-indicator,
        .orientierung-btn .geschlecht-indicator {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 700;
            line-height: 1;
        }

        /* Geschlecht Legend Hover Highlights */
        .geschlecht-legend .legend-i,
        .geschlecht-legend .legend-g {
            transition: all 0.2s ease;
        }

        .geschlecht-legend.highlight-i .legend-i {
            color: var(--primary);
            font-weight: 700;
            text-shadow: 0 0 8px var(--primary);
        }

        .geschlecht-legend.highlight-g .legend-g {
            color: #eab308;
            font-weight: 700;
            text-shadow: 0 0 8px #eab308;
        }

        /* Compact dimension blinking for unselected */
        .compact-dimension.needs-selection .compact-option {
            animation: needsAttention 1.5s ease-in-out infinite;
        }

        .compact-dimension.needs-selection .compact-dimension-label {
            color: var(--warning);
        }

        /* Dominanz/Orientierung Multi-Select blinking for unselected */
        .compact-dimension.needs-selection .dominanz-option-row {
            animation: needsAttention 1.5s ease-in-out infinite;
        }

        /* Dominanz Multi-Select */
        .dominanz-multi-select {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dominanz-option-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: var(--bg-dark);
            border-radius: 8px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }

        /* Gelebt state: red background and border - when Gelebt button is active */
        .dominanz-option-row:has(.status-toggle-btn.active-gelebt) {
            background: rgba(231, 76, 60, 0.15);
            border-color: #e74c3c;
        }

        /* Interessiert state: light yellow background and border - when Interessiert button is active */
        .dominanz-option-row:has(.status-toggle-btn.active-interessiert) {
            background: rgba(234, 179, 8, 0.1);
            border-color: rgba(234, 179, 8, 0.4);
        }

        .dominanz-label {
            flex: 1;
            font-size: var(--font-sm);
            color: var(--text-primary);
            cursor: pointer;
        }

        .dominanz-status-select {
            padding: 4px 8px;
            font-size: 11px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .dominanz-status-select option {
            background: var(--bg-card);
        }

        /* Collapsible multi-select sections */
        .compact-dimension.collapsible-dimension .compact-dimension-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .compact-dimension.collapsible-dimension .collapse-toggle {
            font-size: 10px;
            color: var(--text-muted);
            transition: transform 0.3s ease;
            margin-left: 8px;
        }

        .compact-dimension.collapsible-dimension.collapsed .collapse-toggle {
            transform: rotate(-90deg);
        }

        .compact-dimension.collapsible-dimension .dominanz-multi-select {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .compact-dimension.collapsible-dimension.collapsed .dominanz-multi-select {
            max-height: 0;
            opacity: 0;
        }

        /* Geschlechtsidentität collapsible styles */
        .compact-dimension.collapsible-dimension .geschlecht-grid {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .compact-dimension.collapsible-dimension.collapsed .geschlecht-grid {
            max-height: 0;
            opacity: 0;
        }

        /* Dominanz collapsible styles */
        .compact-dimension.collapsible-dimension .dominanz-grid {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .compact-dimension.collapsible-dimension.collapsed .dominanz-grid {
            max-height: 0;
            opacity: 0;
        }

        /* Orientierung collapsible styles */
        .compact-dimension.collapsible-dimension .orientierung-grid {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .compact-dimension.collapsible-dimension.collapsed .orientierung-grid {
            max-height: 0;
            opacity: 0;
        }

        .compact-dimension.collapsible-dimension .collapsed-summary {
            display: none;
            font-size: 11px;
            color: var(--success);
            margin-top: 4px;
            padding: 4px 8px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 6px;
        }

        .compact-dimension.collapsible-dimension.collapsed .collapsed-summary {
            display: block;
        }

        /* Hide grid summary even when selection exists - keep only 'fehlt' messages */
        .compact-dimension.collapsible-dimension .collapsed-summary.has-selection {
            display: none;
        }

        /* Blinking header when collapsed AND incomplete selection */
        @keyframes needsAttentionHeader {
            0%, 100% {
                opacity: 1;
                text-shadow: 0 0 0 transparent;
            }
            50% {
                opacity: 0.6;
                text-shadow: 0 0 8px rgba(243, 156, 18, 0.5);
            }
        }

        .compact-dimension.collapsible-dimension.collapsed.needs-selection .compact-dimension-label {
            animation: needsAttentionHeader 1.5s ease-in-out infinite;
            color: var(--warning);
        }

        .fold-unfold-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--warning);
            border: 1px solid var(--warning);
            border-radius: 8px;
            color: #1a1a2e;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .fold-unfold-btn:hover {
            background: #d68910;
            border-color: #d68910;
            color: #1a1a2e;
        }

        .fold-unfold-icon {
            font-size: 10px;
            transition: transform 0.3s ease;
        }

        .fold-unfold-btn.collapsed-state .fold-unfold-icon {
            transform: rotate(-90deg);
        }

        /* Desktop Expandable Factor Buttons */
        .desktop-factor-item {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            transition: background 0.2s;
            overflow: hidden;
        }

        .desktop-factor-item:hover {
            background: rgba(255,255,255,0.08);
        }

        .desktop-factor-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 8px;
            cursor: pointer;
        }

        .desktop-factor-header .factor-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .desktop-factor-header .factor-title {
            font-size: var(--font-sm);
            color: var(--text-primary);
        }

        .desktop-factor-header .factor-subtitle {
            font-size: var(--font-xs);
            color: var(--text-muted);
            font-style: italic;
        }

        .desktop-factor-header .factor-score {
            font-size: var(--font-base);
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .desktop-factor-header .factor-toggle {
            font-size: 10px;
            color: var(--text-muted);
            transition: transform 0.3s ease;
        }

        .desktop-factor-item.collapsed .factor-toggle {
            transform: rotate(-90deg);
        }

        .desktop-factor-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
            opacity: 1;
            padding: 0 12px 12px 12px;
            border-top: 1px solid var(--border);
            margin-top: 4px;
        }

        .desktop-factor-item.collapsed .desktop-factor-content {
            max-height: 0;
            opacity: 0;
            padding: 0 12px;
            border-top: none;
            margin-top: 0;
        }

        .desktop-factor-content .factor-explanation {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.5;
            padding-top: 8px;
        }

        .desktop-factor-content .factor-meaning-title {
            font-size: var(--font-sm);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .desktop-factor-content .factor-meaning-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: var(--font-xs);
        }

        .desktop-factor-content .factor-meaning-list li {
            color: var(--text-secondary);
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            line-height: 1.4;
        }

        .desktop-factor-content .factor-meaning-list li:last-child {
            border-bottom: none;

        /* Desktop Selection Info Message */
        .selection-info-message {
            color: #ff4444;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            padding: 8px 16px;
            margin: 0;
            display: none;
        }

        .selection-info-message.visible {
            display: block;
        }

        /* Only show on desktop */
        @media (max-width: 600px) {
            .selection-info-message {
                display: none !important;
            }
        }

        /* Toggle Buttons for Status (Gelebt/Interessiert) */
        .status-toggle-group {
            display: flex;
            gap: 4px;
            margin-left: auto;
        }

        .status-toggle-btn {
            padding: 4px 10px;
            font-size: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-dark);
            color: var(--text-muted);
        }

        .status-toggle-btn:hover {
            border-color: var(--primary);
        }

        .status-toggle-btn.active-gelebt {
            background: #2ecc71 !important;
            border-color: #2ecc71 !important;
            color: white !important;
            box-shadow: 0 0 8px rgba(46, 204, 113, 0.5);
            font-weight: 600;
        }

        .status-toggle-btn.active-interessiert {
            background: #f39c12 !important;
            border-color: #f39c12 !important;
            color: #1a1a2e !important;
            box-shadow: 0 0 8px rgba(243, 156, 18, 0.5);
            font-weight: 600;
        }

        @keyframes yellowPulse {
            0%, 100% {
                box-shadow: 0 0 5px rgba(234, 179, 8, 0.4);
                opacity: 1;
            }
            50% {
                box-shadow: 0 0 15px rgba(234, 179, 8, 0.7);
                opacity: 0.85;
            }
        }

        /* Disable status toggle buttons when any popup overlay is active */
        body:has(.dimension-tooltip-overlay.active) .status-toggle-btn,
        body:has(.status-popup-overlay.active) .status-toggle-btn {
            pointer-events: none;
            cursor: default;
        }

        /* Secondary tendency button (only "interessiert" available when a Gelebt exists) */
        .secondary-interessiert-btn {
            display: none;
            padding: 4px 10px;
            font-size: 10px;
            border: 1px solid #eab308;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: #eab308;
            margin-left: auto;
        }

        .secondary-interessiert-btn:hover {
            background: rgba(234, 179, 8, 0.15);
        }

        .secondary-interessiert-btn.active {
            background: rgba(234, 179, 8, 0.25);
            animation: yellowPulse 1.5s ease-in-out infinite;
        }


        .dominanz-option-row.secondary-mode .dominanz-label {
            opacity: 0.7;
        }

        .dominanz-option-row.secondary-mode:has(.secondary-interessiert-btn.active) {
            background: rgba(234, 179, 8, 0.1);
            border-color: rgba(234, 179, 8, 0.4);
        }

        /* Status Selection Popup */
        .status-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.2s ease;
        }

        .status-popup-overlay.active {
            display: flex;
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .status-popup {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            max-width: 360px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.2s ease;
        }

        .status-popup-overlay.active .status-popup {
            transform: scale(1);
        }

        .status-popup-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-align: center;
        }

        .status-popup-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 20px;
            text-align: center;
        }

        .status-popup-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .status-popup-option {
            display: flex;
            flex-direction: column;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-dark);
        }

        .status-popup-option:hover {
            border-color: #6c757d;
            background: rgba(108, 117, 125, 0.1);
        }

        .status-popup-option.gelebt-option:hover {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .status-popup-option.interessiert-option:hover {
            border-color: #eab308;
            background: rgba(234, 179, 8, 0.1);
        }

        .status-popup-option-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .status-popup-option.gelebt-option .status-popup-option-title {
            color: #e74c3c;
        }

        .status-popup-option.interessiert-option .status-popup-option-title {
            color: #eab308;
        }

        .status-popup-option-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .status-popup-cancel {
            margin-top: 16px;
            text-align: center;
        }

        .status-popup-cancel-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .status-popup-cancel-btn:hover {
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }

        /* Result Bar */
        .result-bar {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 15px 20px;
            margin-bottom: 15px;
        }

        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .result-title {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .result-title .type-name {
            color: var(--text-primary);
            font-weight: 600;
        }

        .result-nav-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 2px 6px;
            cursor: pointer;
            font-size: 10px;
            opacity: 0.6;
            transition: all 0.2s ease;
        }

        .result-nav-btn:hover {
            opacity: 1;
            color: var(--primary);
        }

        .result-nav-btn:active {
            transform: scale(0.9);
        }

        .result-percentage {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .result-percentage.excellent { color: var(--success); }
        .result-percentage.good { color: var(--primary); }
        .result-percentage.moderate { color: var(--warning); }
        .result-percentage.low { color: var(--danger); }

        .result-progress {
            height: 8px;
            background: var(--bg-dark);
            border-radius: 4px;
            overflow: hidden;
        }

        .result-progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease, background 0.3s ease;
        }

        /* Desktop Score Circle */
        .desktop-score-circle-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        .desktop-score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            box-shadow: 0 8px 30px rgba(69, 123, 157, 0.4);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .desktop-score-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(69, 123, 157, 0.5);
        }

        .desktop-score-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 8px;
        }

        /* Tiage's Synthese Button in Quality Block */
        .tiage-ansatz-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 12px 20px;
            margin-top: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 70px;
            min-height: 60px;
        }

        .tiage-ansatz-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .tiage-ansatz-icon {
            font-size: 14px;
        }

        .tiage-ansatz-text {
            font-weight: 500;
        }

        /* Result bar new layout with circle */
        .result-bar-with-circle {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .result-types-column {
            flex: 1;
        }

        .result-circle-column {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Warnings in new layout */
        .warning-box {
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-size: var(--font-sm);
        }

        .warning-box.pathos-warning {
            background: rgba(231, 76, 60, 0.15);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .warning-box.logos-warning {
            background: rgba(243, 156, 18, 0.15);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .warning-box.incomplete-warning {
            background: rgba(69, 123, 157, 0.15);
            border: 1px solid var(--primary);
            color: var(--text-secondary);
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .comparison-grid {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .comparison-column {
                padding: 10px;
            }

            .column-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .column-icon {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }

            .column-title {
                font-size: 12px;
            }

            .column-select {
                padding: 8px 10px;
                font-size: 13px;
            }

            .compact-option {
                padding: 10px 14px;
                font-size: 15px;
            }

            .compact-dimension-label {
                font-size: 14px;
                margin-bottom: 6px;
            }

            .result-bar {
                padding: 12px 15px;
            }

            .result-percentage {
                font-size: 1.2rem;
            }
        }

        /* ========================================
           MULTI-PAGE MOBILE LAYOUT
           ======================================== */

        /* Mobile: Hide desktop, show multi-page */
        @media (max-width: 768px) {
            /* Hide desktop comparison layout on mobile */
            .comparison-container.desktop-mode {
                display: none !important;
            }

            /* Show mobile multi-page container */
            .mobile-multipage {
                display: block !important;
            }

            /* Page Container */
            .mobile-multipage {
                min-height: 100vh;
                padding-top: 60px;
                position: relative;
            }

            /* Mobile Fold/Unfold Toolbar - Sticky */
            .mobile-fold-toolbar {
                position: sticky;
                top: 60px;
                z-index: 99;
                justify-content: flex-end;
                padding: 8px 0;
                margin-bottom: 10px;
                background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-primary) 80%, transparent 100%);
            }

            .mobile-fold-toolbar .fold-unfold-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .mobile-fold-toolbar .fold-unfold-icon {
                font-size: 9px;
            }

            /* Individual Pages */
            .mobile-page {
                display: none;
                min-height: calc(100vh - 60px);
                padding: 15px;
                padding-bottom: 80px;
                animation: slideInPage 0.3s ease;
            }

            .mobile-page.active {
                display: block;
            }

            @keyframes slideInPage {
                from { transform: translateX(30px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }

            /* Page Indicator Dots */
            .page-indicator {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 8px;
                z-index: 100;
                background: rgba(26,26,46,0.95);
                padding: 10px 20px;
                border-radius: 25px;
                border: 1px solid var(--border);
            }

            .page-dot {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: var(--text-muted);
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .page-dot.active {
                background: var(--primary);
                width: 24px;
                border-radius: 4px;
            }

            /* Page Headers */
            .page-header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 20px;
            }

            .btn-back {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: var(--bg-card);
                border: 1px solid var(--border);
                color: var(--text-secondary);
                font-size: 1.2rem;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
            }

            .btn-back:hover {
                background: var(--primary);
                color: white;
                border-color: var(--primary);
            }

            .page-title {
                font-size: var(--font-lg);
                font-weight: 600;
                color: var(--text-primary);
            }

            /* Score Circle (Page 2) */
            .score-circle-container {
                text-align: center;
                margin: 20px 0;
            }

            .score-circle {
                width: 140px;
                height: 140px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2.5rem;
                font-weight: 700;
                margin: 0 auto 10px;
                background: linear-gradient(135deg, var(--primary), var(--primary-light));
                color: white;
                box-shadow: 0 8px 30px rgba(69, 123, 157, 0.4);
            }

            .score-label {
                font-size: var(--font-sm);
                color: var(--text-muted);
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            /* Score Breakdown with Sublabels (Page 2) */
            .score-breakdown {
                background: var(--bg-card);
                border-radius: 16px;
                border: 1px solid var(--border);
                padding: 15px;
                margin: 20px 0;
            }

            .score-factor {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                padding: 12px 0;
                border-bottom: 1px solid var(--border);
            }

            .score-factor:last-child {
                border-bottom: none;
            }

            .score-factor-label {
                display: flex;
                flex-direction: column;
                gap: 2px;
                flex: 1;
            }

            .score-factor-main {
                font-size: var(--font-sm);
                color: var(--text-primary);
                font-weight: 500;
            }

            .score-factor-sub {
                font-size: var(--font-xs);
                color: var(--text-muted);
                font-style: italic;
            }

            .score-factor-value {
                font-size: var(--font-md);
                font-weight: 700;
                color: var(--primary);
                min-width: 50px;
                text-align: right;
            }

            /* Quality Quote (Pirsig-Style) */
            .quality-quote {
                margin: 20px 0;
                padding: 16px;
                background: rgba(69, 123, 157, 0.1);
                border-left: 3px solid var(--primary);
                border-radius: 0 12px 12px 0;
            }

            .quality-quote p {
                font-size: var(--font-sm);
                color: var(--text-secondary);
                font-style: italic;
                line-height: 1.6;
            }

            /* Primary Button (Mobile Pages) */
            .btn-primary-mobile {
                display: block;
                width: 100%;
                padding: 14px 20px;
                background: var(--primary);
                border: none;
                border-radius: 12px;
                color: white;
                font-size: var(--font-base);
                font-weight: 600;
                cursor: pointer;
                margin-top: 20px;
                transition: all 0.3s ease;
            }

            .btn-primary-mobile:hover {
                opacity: 0.9;
                transform: translateY(-1px);
            }

            .btn-secondary-mobile {
                display: block;
                width: 100%;
                padding: 14px 20px;
                background: transparent;
                border: 1px solid var(--border);
                border-radius: 12px;
                color: var(--text-secondary);
                font-size: var(--font-base);
                font-weight: 500;
                cursor: pointer;
                margin-top: 10px;
                transition: all 0.3s ease;
            }

            .btn-secondary-mobile:hover {
                border-color: var(--primary);
                color: var(--text-primary);
            }

            /* Pro/Contra Cards (Page 3) */
            .pro-section-mobile, .contra-section-mobile {
                padding: 16px;
                border-radius: 12px;
                margin-bottom: 15px;
            }

            .pro-section-mobile {
                background: rgba(46, 204, 113, 0.1);
                border: 1px solid rgba(46, 204, 113, 0.3);
            }

            .contra-section-mobile {
                background: rgba(231, 76, 60, 0.1);
                border: 1px solid rgba(231, 76, 60, 0.3);
            }

            .pro-section-mobile h3 {
                color: var(--success);
                font-size: var(--font-base);
                margin-bottom: 12px;
            }

            .contra-section-mobile h3 {
                color: var(--danger);
                font-size: var(--font-base);
                margin-bottom: 12px;
            }

            .pro-list-mobile, .contra-list-mobile {
                list-style: none;
                font-size: var(--font-sm);
                color: var(--text-secondary);
            }

            .pro-list-mobile li, .contra-list-mobile li {
                padding: 6px 0 6px 18px;
                position: relative;
            }

            .pro-list-mobile li::before {
                content: '✓';
                position: absolute;
                left: 0;
                color: var(--success);
            }

            .contra-list-mobile li::before {
                content: '✗';
                position: absolute;
                left: 0;
                color: var(--danger);
            }

            /* Categories Accordion (Page 4) */
            .categories-accordion {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .category-accordion-item {
                background: var(--bg-card);
                border: 1px solid var(--border);
                border-radius: 12px;
                overflow: hidden;
            }

            .category-accordion-header {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 14px 16px;
                cursor: pointer;
                transition: background 0.2s ease;
            }

            .category-accordion-header:hover {
                background: var(--bg-hover);
            }

            .category-accordion-letter {
                width: 32px;
                height: 32px;
                border-radius: 8px;
                background: var(--primary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 700;
                font-size: var(--font-sm);
                color: white;
                flex-shrink: 0;
            }

            .category-accordion-name {
                flex: 1;
                font-size: var(--font-sm);
                color: var(--text-primary);
            }

            .category-accordion-score {
                font-size: var(--font-md);
                font-weight: 700;
                color: var(--primary);
            }

            .category-accordion-icon {
                font-size: 0.8rem;
                color: var(--text-muted);
                transition: transform 0.3s ease;
            }

            .category-accordion-item.open .category-accordion-icon {
                transform: rotate(180deg);
            }

            .category-accordion-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }

            .category-accordion-item.open .category-accordion-content {
                max-height: 300px;
            }

            .category-accordion-inner {
                padding: 0 16px 16px;
                border-top: 1px solid var(--border);
            }

            .category-accordion-desc {
                font-size: var(--font-sm);
                color: var(--text-secondary);
                line-height: 1.5;
                margin-top: 12px;
            }

            .category-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 6px;
                margin-top: 12px;
            }

            .category-tag {
                padding: 4px 10px;
                background: rgba(255,255,255,0.05);
                border-radius: 12px;
                font-size: 11px;
                color: var(--text-muted);
            }

            /* Types Display (Page 2) */
            .types-display {
                text-align: center;
                font-size: var(--font-lg);
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 10px;
            }

            .types-display .type-name {
                color: var(--primary);
            }

            /* Mobile: Larger fonts for better readability */
            .compact-dimension-label {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .compact-option {
                padding: 12px 16px;
                font-size: 16px;
            }

            .compact-options {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            /* 4-button groups (Dominanz) get 2x2 grid */
            .compact-dimension:has([value="ausgeglichen"]) .compact-options {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Geschlechtsidentität: 9 buttons in besseres Layout */
            .geschlecht-grid {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 8px;
            }

            /* Mobile: Größere Geschlecht-Buttons */
            .geschlecht-btn {
                padding: 10px 12px;
                font-size: 14px;
            }

            .compact-option {
                text-align: center;
                justify-content: center;
            }

            .compact-dimension {
                gap: 8px;
                margin-bottom: 12px;
            }

            /* Mobile Page 1: Fix heading overflow */
            #mobilePage1 h2 {
                font-size: 18px !important;
                line-height: 1.3;
                word-wrap: break-word;
                padding: 0 10px;
            }

            /* Mobile Pro/Contra: Larger fonts */
            .pro-list-mobile li, .contra-list-mobile li {
                font-size: 15px;
                padding: 10px 0 10px 24px;
                line-height: 1.5;
            }

            .pro-section-mobile h3, .contra-section-mobile h3 {
                font-size: 17px;
            }

            /* Mobile Score factors: Larger fonts */
            .score-factor-main {
                font-size: 15px;
            }

            .score-factor-sub {
                font-size: 13px;
            }

            .score-factor-value {
                font-size: 18px;
            }

            /* Mobile Page title */
            .page-title {
                font-size: 18px;
            }

            /* Mobile: Larger dropdown */
            .column-select {
                font-size: 16px;
                padding: 12px 14px;
                max-width: 160px;
            }

            /* Mobile: Larger INFO button */
            .archetype-info-btn {
                font-size: 13px;
                padding: 10px 14px;
            }

            /* Mobile column-dimensions more spacing */
            .column-dimensions {
                gap: 20px;
            }

            /* Mobile: Größere Dominanz-Labels und Toggle-Buttons */
            .dominanz-label {
                font-size: 15px;
            }

            .status-toggle-btn {
                padding: 8px 14px;
                font-size: 13px;
            }

            .dominanz-option-row {
                padding: 10px 14px;
            }

            /* Mobile: Größere Orientierung-Buttons */
            .orientierung-option-row {
                padding: 10px 14px;
            }

            .orientierung-label {
                font-size: 15px;
            }

            /* Mobile: Größere Geschlechtsidentität Info-Link */
            .geschlecht-info-link {
                font-size: 16px;
            }

            /* Mobile: Größere dimension-info-icon */
            .dimension-info-icon {
                width: 20px;
                height: 20px;
                font-size: 12px;
            }

            /* Mobile: Größere geschlecht-legend */
            .geschlecht-legend {
                font-size: 12px !important;
            }
        }

        /* Desktop: Keep single-page layout, hide mobile */
        @media (min-width: 769px) {
            .mobile-multipage {
                display: none !important;
            }

            .comparison-container.desktop-mode {
                display: block !important;
            }

            .page-indicator {
                display: none !important;
            }
        }

        /* Validation Warning Animations */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
        }

        /* Footer / Impressum Styles */
        .app-footer {
            text-align: center;
            padding: 20px 15px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }
        .app-footer a {
            color: #eab308;
            text-decoration: none;
            margin: 0 10px;
        }
        .app-footer a:hover {
            color: #facc15;
            text-decoration: underline;
        }
        .app-footer span {
            color: #eab308;
        }
        .impressum-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10002;
            justify-content: center;
            align-items: center;
        }
        .impressum-modal.active {
            display: flex;
        }
        .impressum-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .impressum-content h3 {
            margin: 0 0 20px 0;
            color: #fff;
            font-size: 20px;
        }
        .impressum-content p {
            margin: 10px 0;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }
        .impressum-content a {
            color: #eab308;
        }
        .impressum-close {
            margin-top: 20px;
            padding: 10px 30px;
            background: linear-gradient(135deg, #4A90E2, #357ABD);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        /* Pathos/Logos Sticky Toggle Buttons */
        #pathosLogosStickyToggle {
            transition: opacity 0.3s ease;
        }
        #pathosLogosStickyToggle button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
        }
        @media (max-width: 850px) {
            #pathosLogosStickyToggle {
                left: auto !important;
                right: 10px !important;
            }
        }
        @media (max-width: 480px) {
            #pathosLogosStickyToggle {
                top: auto !important;
                bottom: 20px !important;
                left: auto !important;
                right: 15px !important;
                transform: none !important;
                flex-direction: row !important;
            }
            #pathosLogosStickyToggle button {
                padding: 10px 12px !important;
                font-size: 14px !important;
            }
        }
    </style>

    <!-- TIAGE i18n - Internationalisierung -->
    <script src="js/locales/de.js"></script>
    <script src="js/locales/en.js"></script>
    <script src="js/i18n.js"></script>

    <!-- TIAGE SYNTHESE - Zentralisierte Berechnungslogik -->
    <script src="js/synthesis/constants.js"></script>
    <script src="js/synthesis/factors/archetypeFactor.js"></script>
    <script src="js/synthesis/factors/dominanceFactor.js"></script>
    <script src="js/synthesis/factors/orientationFactor.js"></script>
    <script src="js/synthesis/factors/genderFactor.js"></script>
    <script src="js/synthesis/synthesisCalculator.js"></script>
</head>
<body>
    <!-- Age Verification - Inline Script BEFORE modal for onclick to work -->
    <script>
        // Define confirmAge immediately so onclick handlers work
        // Modal appears on EVERY visit (no localStorage storage)
        window.confirmAge = function(isAdult) {
            console.log('confirmAge called:', isAdult);
            try {
                var modal = document.getElementById('ageVerificationModal');
                if (isAdult) {
                    // Just hide the modal for this session - no localStorage
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        modal.style.pointerEvents = 'none';
                    }
                    document.body.style.overflow = 'auto';
                } else {
                    window.location.href = 'https://www.google.com';
                }
            } catch(e) {
                console.error('confirmAge error:', e);
                var m = document.getElementById('ageVerificationModal');
                if (m) m.style.display = 'none';
            }
        };
    </script>

    <!-- Help Modal -->
    <div class="help-modal-overlay" id="helpModal" onclick="closeHelpModal(event)">
        <div class="help-modal" onclick="event.stopPropagation()">
            <div class="help-modal-header">
                <h2>Hilfe & Dokumentation</h2>
                <button class="help-modal-close" onclick="closeHelpModal()">&times;</button>
            </div>
            <div class="help-modal-content">

                <!-- KURZANLEITUNG -->
                <div class="quick-guide">
                    <h3>Kurzanleitung</h3>
                    <ul>
                        <li><strong>Mein Typ</strong> = Dein Archetyp + Eigenschaften (Orientierung, Dominanz, Geschlecht)</li>
                        <li><strong>Beziehungsqualität</strong> = Partner-Archetyp + Eigenschaften und Kompatibilitätsberechnung</li>
                        <li><strong>Gelebt</strong> = Was du aktiv lebst / <strong>Interessiert</strong> = Wofür du offen bist</li>
                        <li><strong>INFO</strong>-Button = Details zum gewählten Archetyp</li>
                        <li><strong>Ergebnis</strong> = Automatische Berechnung der Kompatibilität (4 Faktoren)</li>
                        <li><strong>Prozentwerte</strong> anklicken = Detaillierte Erklärung pro Faktor</li>
                    </ul>
                </div>

                <!-- WAS IST NEU -->
                <div class="help-section" style="background: linear-gradient(135deg, rgba(var(--primary-rgb, 100,100,100), 0.1), transparent); border-left: 3px solid var(--primary);">
                    <h3>Neu in Version 1.4</h3>
                    <ul>
                        <li><strong>Gelebt/Interessiert:</strong> Wähle für jede Eigenschaft, ob du sie aktiv lebst oder nur Interesse hast</li>
                        <li><strong>Auto-Collapse:</strong> Orientierung und Dominanz Sektionen schließen automatisch nach Auswahl</li>
                        <li><strong>Verbesserte Fehlermeldungen:</strong> Fehlende Felder werden übersichtlich aufgelistet</li>
                        <li><strong>Mobile Navigation:</strong> Neue Navigationstasten in Modals für bessere Bedienung</li>
                        <li><strong>Kreisförmige Score-Anzeige:</strong> Kompatibilitätswerte werden visuell ansprechender dargestellt</li>
                    </ul>
                </div>

                <!-- KOMMENTAR-SEKTION -->
                <div class="comment-section">
                    <p>Fragen, Feedback oder Verbesserungsvorschläge?</p>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="comment-btn" onclick="openCommentModal()">
                            Kommentar senden
                        </button>
                        <button class="view-comments-btn" onclick="openCommentsListModal()">
                            📋 Alle Kommentare
                        </button>
                    </div>
                </div>

                <!-- DOKUMENTATION -->
                <div class="documentation-section">
                    <h3>Dokumentation</h3>

                    <div class="help-section">
                        <h3>Das Tiage-Beziehungsmodell</h3>
                        <p>Eine <strong>eigenständige Synthese</strong> von Tiage, entwickelt durch Online-Recherche und persönliche Reflexion. Das Modell verbindet zwei philosophische Traditionen zu einem praktischen Analyse-Tool:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>MOQ (Robert M. Pirsig):</strong> Metaphysik der Qualität - statische vs. dynamische Qualität als Grundstruktur</li>
                            <li><strong>OSHO:</strong> Bewusstsein durch Meditation - Polarität, Balance, Schwingung</li>
                        </ul>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Tiage's Beitrag: Die Verbindung beider Philosophien zu einem konkreten Beziehungs-Rechner mit eigener Gewichtung und Archetypen-Matrix.</p>
                    </div>

                    <div class="help-section">
                        <h3>Logos vs. Pathos (40:60)</h3>
                        <p><strong>Logos (40% - Verstand):</strong> Die rationale, strukturgebende Dimension. Pirsig nennt dies "statische Qualität" - bewährte Muster, die Stabilität schaffen.</p>
                        <p style="margin-top: 8px;"><strong>Pathos (60% - Gefühl):</strong> Die emotionale, anziehende Dimension. Pirsig nennt dies "dynamische Qualität" - die Kraft, die Veränderung und Wachstum antreibt.</p>
                        <p style="margin-top: 8px; font-style: italic; color: var(--text-muted);">OSHO: "Bewusstsein durch Meditation - Loslassen (Let Go) ermöglicht echte Verbindung."</p>
                    </div>

                    <div class="help-section">
                        <h3>Die 4 Qualitätsfaktoren</h3>
                        <ul>
                            <li><strong>Archetyp-Übereinstimmung</strong> (40% Logos) - Fundamentale Beziehungsphilosophie: "Wie wollen wir Beziehung leben?"</li>
                            <li><strong>Orientierungs-Kompatibilität</strong> (25% Pathos) - Körperliche Polarität und Anziehung. OSHO: "Nur Extreme können sich wirklich anziehen."</li>
                            <li><strong>Dominanz-Harmonie</strong> (20% Pathos) - Energetische Dynamik. OSHO: "Tao - eine Energie, zwei Ausdrucksformen."</li>
                            <li><strong>Geschlechts-Attraktion</strong> (15% Pathos) - Gender-Chemie als Feinabstimmung der Orientierung.</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>Berechnung</h3>
                        <div class="help-formula">
                            Qualitätsindex = [(Archetyp × 40%) + (Orientierung × 25%) + (Dominanz × 20%) + (Geschlecht × 15%)] × Resonanz
                        </div>
                        <p>Jeder Faktor wird einzeln auf 0-100% bewertet. Die <strong>Resonanz (R)</strong> ist ein Meta-Faktor (0.9-1.1), der moduliert, wie gut Kopf (Logos) und Herz (Pathos) zusammenschwingen.</p>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <strong>Resonanz-Formel:</strong> R = 0.9 + [(M/100 × 0.5) + (B × 0.5)] × 0.2<br>
                            <small style="opacity: 0.7;">M = Profil-Match (30 Attribute) | B = Logos-Pathos-Balance</small>
                        </div>
                    </div>

                    <div class="help-section">
                        <h3>Rechenbeispiel</h3>
                        <div class="help-example">
                            <div class="help-example-title">Duo (Cis Frau, Submissiv, Hetero) × Duo-Flex (Cis Mann, Dominant, Hetero)</div>
                            <ul>
                                <li>Archetyp: 75% × 0.40 = 30 (Duo ↔ Duo-Flex = nah verwandt)</li>
                                <li>Orientierung: 100% × 0.25 = 25 (Hetero + Hetero bei M/F)</li>
                                <li>Dominanz: 100% × 0.20 = 20 (Submissiv + Dominant = Ergänzung)</li>
                                <li>Geschlecht: 100% × 0.15 = 15 (Cis Frau × Cis Mann passt)</li>
                                <li><strong>Basis-Score: 90</strong></li>
                                <li>Resonanz: R = 1.05 (Leichte Harmonie)</li>
                                <li><strong>Final: 90 × 1.05 = 94.5 ≈ 95</strong></li>
                            </ul>
                            <div class="help-formula">
                                (30 + 25 + 20 + 15) × 1.05 = 94.5 ≈ 95%
                            </div>
                        </div>
                    </div>

                    <div class="help-section">
                        <h3>Die 6 Archetypen</h3>
                        <ul>
                            <li><strong>Single</strong> - Autonomes Leben ohne Primärbeziehung</li>
                            <li><strong>Duo</strong> - Monogame Zweierbeziehung mit Exklusivität</li>
                            <li><strong>Duo-Flex</strong> - Primärbeziehung mit vereinbarten Öffnungen</li>
                            <li><strong>Solopoly</strong> - Mehrere gleichwertige Beziehungen, Fokus Autonomie</li>
                            <li><strong>Poly-Hedo</strong> - Polyamorie mit Fokus auf Genuss</li>
                            <li><strong>Polyamor</strong> - Tiefe emotionale Bindungen zu mehreren Partnern</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>Ergebnis-Interpretation</h3>
                        <ul>
                            <li><strong>70-100%</strong> - Gut: Solide Basis vorhanden</li>
                            <li><strong>50-69%</strong> - Mittel: Erfordert bewusste Arbeit</li>
                            <li><strong>0-49%</strong> - Herausfordernd: Fundamentale Unterschiede</li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">Der Qualitätsindex ist ein Orientierungswert. Echte Beziehungen hängen von vielen weiteren Faktoren ab.</p>
                    </div>

                    <div class="help-section">
                        <h3>Philosophische Quellen</h3>
                        <h4 style="margin-top: 15px;">Robert M. Pirsig (1928-2017) - Metaphysik der Qualität</h4>
                        <p>Pirsig entwickelte ein philosophisches System, das <strong>Qualität</strong> als fundamentale Realität betrachtet:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Statische Qualität:</strong> Strukturierte, wiederholbare Muster die Stabilität schaffen → im Tiage-Modell: <strong>Logos</strong></li>
                            <li><strong>Dynamische Qualität:</strong> Die kreative Kraft für Wachstum und Veränderung → im Tiage-Modell: <strong>Pathos</strong></li>
                        </ul>
                        <h4 style="margin-top: 15px;">OSHO - Bewusstsein durch Meditation</h4>
                        <p>OSHO lehrte Bewusstsein über Polarität, Balance und Schwingung - Meditation als Weg zur Klarheit:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Bewusstsein:</strong> Klarheit durch Meditation und Loslassen (Let Go)</li>
                            <li><strong>Polarität & Schwingung:</strong> Energetische Balance in Beziehungen</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Tiage's Synthese:</strong> Die Verbindung von Pirsigs Qualitäts-Philosophie mit OSHOs Bewusstseins-Konzept zu einem praktischen Beziehungs-Rechner mit konkreter Gewichtung (40:60 Logos:Pathos) und 6 Archetypen.</p>
                    </div>

                    <div class="help-section">
                        <h3>Literatur von Robert M. Pirsig</h3>
                        <ul>
                            <li>
                                <strong>Zen und die Kunst ein Motorrad zu warten</strong> (1974)<br>
                                <span style="color: var(--text-muted); font-size: 0.9em;">Originaltitel: "Zen and the Art of Motorcycle Maintenance: An Inquiry into Values"</span><br>
                                <span style="margin-top: 5px; display: inline-block;">Ein philosophischer Roman, der Pirsigs erste Erkundung der Qualität als metaphysisches Konzept darstellt. Das Buch verbindet eine Motorradreise mit tiefgreifenden philosophischen Betrachtungen über Rationalität, Romantik und die Natur der Qualität.</span>
                            </li>
                            <li style="margin-top: 15px;">
                                <strong>Lila – oder ein Versuch über Moral</strong> (1991)<br>
                                <span style="color: var(--text-muted); font-size: 0.9em;">Originaltitel: "Lila: An Inquiry into Morals"</span><br>
                                <span style="margin-top: 5px; display: inline-block;">Die Fortsetzung und systematische Ausarbeitung der Metaphysik der Qualität. Pirsig entwickelt hier eine vollständige philosophische Theorie, die statische und dynamische Qualitätsmuster auf biologischer, sozialer und intellektueller Ebene unterscheidet.</span>
                            </li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>Ein Widerspruch zu Pirsig</h3>
                        <p>Robert Pirsig argumentierte, dass Definitionen die unmittelbare Qualität des Erlebens zerstören – dass das Benennen dem Fühlen nachgelagert ist und es reduziert.</p>
                        <p style="margin-top: 10px;">Diese App basiert auf der gegenteiligen Erfahrung:</p>
                        <p style="margin-top: 10px;"><strong>Definition und Erleben sind nicht getrennt. Sie entstehen gleichzeitig – im Dialog, in Resonanz, in extremer Kürze.</strong></p>
                        <p style="margin-top: 10px;">Wenn Begriffe aufgefächert werden, wenn Bedeutungsfelder sich öffnen, entsteht nicht weniger Qualität, sondern mehr. Die Sprache ist kein Käfig für das Erleben. Sie ist sein Resonanzraum.</p>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Diese Erkenntnis entstand nicht theoretisch, sondern praktisch – im Arbeiten mit KI-gestütztem Dialog. Das Argument gegen Pirsig ist die Erfahrung selbst.</p>
                    </div>

                    <div class="help-section">
                        <h3>OSHO: Bewusstsein und Beziehung</h3>
                        <p><strong>Bhagwan Shree Rajneesh (OSHO)</strong> (1931-1990) war ein indischer spiritueller Lehrer, dessen Philosophie über Bewusstsein und Liebe das Tiage-Modell prägt.</p>

                        <h4 style="margin-top: 15px;">Kernkonzepte für Beziehungen:</h4>
                        <ul style="margin-top: 10px;">
                            <li><strong>Liebe ohne Besitz:</strong> "Liebe ist keine Bindung, sondern Freiheit. Wenn du jemanden liebst, gibst du ihm Flügel, keinen Käfig." → Basis für die Archetypen-Vielfalt (Single bis Polyamor)</li>
                            <li style="margin-top: 8px;"><strong>Aloneness vs. Loneliness:</strong> Allein-Sein ist nicht Einsamkeit. Nur wer mit sich selbst sein kann, kann wirklich mit anderen sein. → Erklärt warum "Single" ein vollwertiger Archetyp ist</li>
                            <li style="margin-top: 8px;"><strong>Akzeptanz statt Veränderung:</strong> "Liebe den Menschen, wie er ist. Versuch nicht, ihn zu verbessern." → Das Modell bewertet Kompatibilität, nicht "Korrektur"</li>
                            <li style="margin-top: 8px;"><strong>Bewusstheit statt Unbewusstheit:</strong> Die meisten Beziehungsprobleme entstehen durch unbewusstes Handeln. Meditation schafft Klarheit. → Begründung für Pathos-Gewichtung (60%)</li>
                            <li style="margin-top: 8px;"><strong>Polarität als Anziehung:</strong> "Gegensätze ziehen sich an, aber nicht um sich zu bekämpfen – um sich zu ergänzen." → Dominanz-Harmonie Faktor</li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">"Liebe ist eine Blume, die nur in der Freiheit wächst. Im Gefängnis von Erwartungen stirbt sie."</p>
                    </div>

                    <div class="help-section">
                        <h3>OSHO & Tiages Widerspruch: Dialog als Meditation</h3>
                        <p>OSHOs Philosophie verbindet sich überraschend mit Tiages Widerspruch zu Pirsig:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>OSHO:</strong> "Worte können lebendig sein, wenn Bewusstheit dahinter steht. Dann sind sie keine Gefängnisse, sondern Tore."</li>
                            <li style="margin-top: 8px;"><strong>Tiage:</strong> Im bewussten Dialog <em>ist</em> die Definition das Erleben. Begriffe werden aufgefächert, nicht fixiert.</li>
                        </ul>
                        <p style="margin-top: 10px;">Beide sagen: <strong>Sprache muss nicht töten. Sie kann lebendig sein – wenn Bewusstheit da ist.</strong></p>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Die Qualität entsteht nicht trotz der Sprache, sondern <em>durch</em> sie – wenn zwei Menschen auf derselben Wellenlänge schwingen. Das ist OSHOs "Resonanz" und Tiages "Dialog-Erfahrung" zugleich.</p>
                    </div>

                    <div class="help-section">
                        <h3>TIAGE Resonanz-Theorie: Neurowissenschaftliche Grundlagen</h3>
                        <p>Die philosophischen Konzepte werden durch neurowissenschaftliche Forschung untermauert:</p>

                        <h4 style="margin-top: 15px;">Kernthese</h4>
                        <p style="font-style: italic; background: var(--bg-secondary); padding: 10px; border-radius: 5px;">
                            "Wahrnehmung basiert auf Schwingungen und Mustern. Resonanz = Synchronität zwischen inneren neuronalen Rhythmen und äußeren Signalen."
                        </p>

                        <h4 style="margin-top: 15px;">Die Wissenschaftler hinter der Theorie</h4>
                        <ul style="margin-top: 10px;">
                            <li><strong>Buzsáki & Singer</strong> (Neuronale Rhythmen): Gamma-Oszillationen als Basis für "auf einer Wellenlänge sein"</li>
                            <li style="margin-top: 8px;"><strong>Friston</strong> (Predictive Coding): Kompatibilität = niedrige Vorhersage-Fehler im Umgang miteinander</li>
                            <li style="margin-top: 8px;"><strong>Kapur</strong> (Aberrant Salience): Flow vs. Psychose als Spektrum der Synchronität</li>
                            <li style="margin-top: 8px;"><strong>Levitin</strong> (Psychoakustik): Musik als externes Regulierungssystem für Emotionen</li>
                            <li style="margin-top: 8px;"><strong>Aron</strong> (Hochsensitivität): Reizlast-Management als Beziehungsfaktor</li>
                        </ul>

                        <h4 style="margin-top: 15px;">Die Zustands-Skala</h4>
                        <table style="width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: var(--bg-secondary);">
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Zustand</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Beschreibung</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">In Beziehungen</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Flow</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Optimale Synchronität</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Tiefe Verbindung, "im Einklang"</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Hyper-Synchronität</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Übermäßige Muster-Erkennung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Verliebtheit / Abhängigkeit</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Hypo-Synchronität</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Reduzierte Bindung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Entfremdung, "aneinander vorbei"</td>
                            </tr>
                        </table>

                        <h4 style="margin-top: 15px;">Weitere Kernthesen</h4>
                        <ul style="margin-top: 10px;">
                            <li><strong>Zufall</strong> = unerkannte Ordnung (Synchronizitäten als Muster)</li>
                            <li style="margin-top: 8px;"><strong>Hochsensitivität + Reizlast</strong> → Zustandsschwankungen</li>
                        </ul>

                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">
                            Die vollständige wissenschaftliche Dokumentation findet sich in: profiles/research-sources.md (Abschnitt 9)
                        </p>
                    </div>

                    <div class="help-section">
                        <h3>⚡ Resonanz-Override: Jenseits der Konditionierung</h3>
                        <p>OSHO lehrte: <strong>Sexuelle Orientierung ist Konditionierung, nicht Natur.</strong> Der natürliche Mensch ist jenseits von Labels.</p>

                        <h4 style="margin-top: 15px;">Was ist der Resonanz-Override?</h4>
                        <p>Normalerweise gilt: Wenn die Orientierung inkompatibel ist (z.B. zwei heterosexuelle Männer), ergibt das 0% Orientierungs-Score und damit ein K.O.-Kriterium.</p>
                        <p style="margin-top: 10px;">Der <strong>Resonanz-Override</strong> ermöglicht eine Ausnahme: Wenn zwei Menschen auf einer tiefen Ebene resonieren (R ≥ 1.05), kann diese Verbindung die konditionierten Grenzen überschreiten.</p>

                        <h4 style="margin-top: 15px;">Wie funktioniert es?</h4>
                        <table style="width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: var(--bg-secondary);">
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Resonanz (R)</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Override-Effekt</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">O_effektiv</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">< 1.05</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Kein Override</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">0% (K.O.)</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">1.05</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Schwache Öffnung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">5%</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">1.08</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Moderate Öffnung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">8%</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">1.10</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Maximale Öffnung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">10%</td>
                            </tr>
                        </table>

                        <p style="margin-top: 15px;"><strong>Formel:</strong> <code>O_effektiv = (R - 1.0) × 100</code></p>

                        <h4 style="margin-top: 15px;">Philosophische Begründung (OSHO)</h4>
                        <p style="font-style: italic; background: var(--bg-secondary); padding: 10px; border-radius: 5px;">
                            "Liebe kennt keine Grenzen. Wenn zwei Seelen wirklich resonieren, sind alle gesellschaftlichen Kategorien nur noch Schatten an der Wand."
                        </p>
                        <p style="margin-top: 10px;">Resonanz repräsentiert die tiefere, unkonditionierte Ebene der Verbindung – jenseits dessen, was Gesellschaft und Erziehung uns beigebracht haben.</p>

                        <p style="margin-top: 15px; padding: 10px; background: rgba(255,165,0,0.1); border-left: 3px solid orange; font-size: 0.9em;">
                            <strong>Hinweis:</strong> Dies ist keine Empfehlung, sondern eine philosophische Möglichkeit, die das Modell abbildet. Der Override zeigt: Tiefe Resonanz kann konditionierte Muster transzendieren.
                        </p>
                    </div>

                    <div class="help-section">
                        <h3>🔬 R-Berechnung: Die zwei Komponenten</h3>
                        <p>Der Resonanzfaktor R wird aus zwei gleichgewichteten Komponenten berechnet:</p>

                        <h4 style="margin-top: 15px;">Komponente 1: Profil-Match (M)</h4>
                        <p>Ähnlichkeit der 30 Persönlichkeitsattribute zwischen zwei Profilen.</p>
                        <p style="background: var(--bg-secondary); padding: 10px; border-radius: 5px; font-family: monospace;">
                            M = Übereinstimmende Attribute / 30 × 100
                        </p>
                        <p style="margin-top: 5px; font-size: 0.9em; color: var(--text-muted);">Bei 24 von 30 übereinstimmenden Attributen: M = 80</p>

                        <h4 style="margin-top: 15px;">Komponente 2: Logos-Pathos-Balance (B)</h4>
                        <p>Das Verhältnis zwischen rationaler Struktur und emotionaler Dynamik – basierend auf Pirsigs MOQ.</p>
                        <table style="width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: var(--bg-secondary);">
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Konzept</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Definition</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">TIAGE-Zuordnung</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Logos</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Statische Qualität</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">A (Attraction)</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Pathos</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Dynamische Qualität</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">(O + D + G) / 3</td>
                            </tr>
                        </table>
                        <p style="background: var(--bg-secondary); padding: 10px; border-radius: 5px; font-family: monospace; margin-top: 10px;">
                            B = (100 - |Logos - Pathos|) / 100
                        </p>
                        <p style="margin-top: 5px; font-size: 0.9em; color: var(--text-muted);">Bei A=72% und avg(O,D,G)=65%: B = (100 - 7) / 100 = 0.93</p>

                        <h4 style="margin-top: 15px;">Die R-Formel</h4>
                        <p style="background: linear-gradient(90deg, rgba(147,112,219,0.1), rgba(255,215,0,0.1)); padding: 15px; border-radius: 5px; font-family: monospace; font-size: 1.1em; text-align: center; border: 1px solid var(--border);">
                            R = 0.9 + [(M/100 × 0.5) + (B × 0.5)] × 0.2
                        </p>
                        <p style="margin-top: 10px;"><strong>Wertebereich:</strong> R variiert zwischen 0.9 (minimale Resonanz) und 1.1 (maximale Resonanz).</p>

                        <h4 style="margin-top: 15px;">Beispielrechnung</h4>
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 5px; font-size: 0.9em;">
                            <p><strong>Gegeben:</strong> M = 80 (80% Profil-Match), B = 0.93 (7% Logos-Pathos-Differenz)</p>
                            <p style="margin-top: 8px; font-family: monospace;">
                                R = 0.9 + [(80/100 × 0.5) + (0.93 × 0.5)] × 0.2<br>
                                R = 0.9 + [0.4 + 0.465] × 0.2<br>
                                R = 0.9 + 0.173<br>
                                R = <strong>1.073</strong> → Override aktiv!
                            </p>
                        </div>

                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">
                            Die Balance zwischen Profil-Match und Logos-Pathos-Verhältnis erfasst sowohl die äußere Kompatibilität (ähnliche Eigenschaften) als auch die innere Dynamik (Verhältnis von Struktur und Emotion).
                        </p>
                    </div>

                    <div class="help-section">
                        <h3>Quellen & Weiterführende Ressourcen</h3>
                        <ul>
                            <li><strong>Pirsig, Robert M.</strong> (1974): <em>Zen and the Art of Motorcycle Maintenance: An Inquiry into Values.</em> William Morrow and Company, New York.</li>
                            <li><strong>Pirsig, Robert M.</strong> (1991): <em>Lila: An Inquiry into Morals.</em> Bantam Books, New York.</li>
                            <li><strong>McWatt, Anthony</strong> (2004): <em>An Introduction to Robert Pirsig's Metaphysics of Quality.</em> Dissertation, University of Liverpool.</li>
                            <li style="margin-top: 10px;"><strong>Schupp, Hans</strong>: <em>Elemente der Logik.</em> <span style="color: var(--text-muted); font-size: 0.85em;">(Indirekte Quelle – als Grundlage für logische Strukturierung und formale Denkprinzipien)</span></li>
                            <li style="margin-top: 10px;"><strong>OSHO:</strong>
                                <ul style="margin-top: 5px;">
                                    <li><a href="https://oshofriends.com/love" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">OSHO on Love and Relationships</a></li>
                                    <li><a href="https://www.oshonews.com/2021/03/07/man-and-woman/" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Man and Woman - Polarity</a></li>
                                </ul>
                            </li>
                            <li style="margin-top: 10px;"><strong>MOQ Online-Ressourcen:</strong>
                                <ul style="margin-top: 5px;">
                                    <li><a href="https://www.moq.org" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">moq.org</a> – Metaphysics of Quality Community</li>
                                    <li><a href="https://en.wikipedia.org/wiki/Robert_M._Pirsig" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Wikipedia: Robert M. Pirsig</a></li>
                                </ul>
                            </li>
                            <li style="margin-top: 10px;"><strong>Neurowissenschaftliche Resonanz-Theorie:</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Buzsáki, G. (2006): <em>Rhythms of the Brain.</em> Oxford University Press.</li>
                                    <li>Friston, K. (2010): The free-energy principle. <em>Nature Reviews Neuroscience.</em></li>
                                    <li>Kapur, S. (2003): Psychosis as Aberrant Salience. <em>Am J Psychiatry.</em></li>
                                    <li>Levitin, D.J. (2006): <em>This Is Your Brain on Music.</em> Dutton.</li>
                                    <li>Aron, E.N. (1996): <em>The Highly Sensitive Person.</em> Broadway Books.</li>
                                </ul>
                            </li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">Das Tiage-Beziehungsmodell ist eine eigenständige Interpretation und Anwendung philosophischer Konzepte auf zwischenmenschliche Beziehungen und erhebt keinen Anspruch auf wissenschaftliche Validierung.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div class="comment-modal-overlay" id="commentModal" onclick="closeCommentModal(event)">
        <div class="comment-modal" onclick="event.stopPropagation()">
            <div class="comment-modal-header">
                <h3>Kommentar senden</h3>
                <button class="comment-modal-close" onclick="closeCommentModal()">&times;</button>
            </div>
            <div class="comment-modal-body">
                <div class="comment-form-group">
                    <label for="commentName">Name / Kürzel *</label>
                    <input type="text" id="commentName" placeholder="z.B. Max oder Anonym">
                </div>
                <div class="comment-form-group">
                    <label for="commentType">Art des Kommentars</label>
                    <select id="commentType">
                        <option value="frage">Frage zur Bedienung</option>
                        <option value="feedback">Allgemeines Feedback</option>
                        <option value="fehler">Fehler melden</option>
                        <option value="verbesserung">Verbesserungsvorschlag</option>
                        <option value="doku">Frage zur Dokumentation</option>
                    </select>
                </div>
                <div class="comment-form-group">
                    <label for="commentText">Dein Kommentar *</label>
                    <textarea id="commentText" placeholder="Schreibe hier deine Frage oder dein Feedback..."></textarea>
                </div>
                <button class="comment-submit-btn" id="commentSubmitBtn" onclick="submitComment()">Absenden</button>
            </div>
        </div>
    </div>

    <!-- Comments List Modal -->
    <div class="comments-list-overlay" id="commentsListModal" onclick="closeCommentsListModal(event)">
        <div class="comments-list-modal" onclick="event.stopPropagation()">
            <div class="comments-list-header">
                <h2>📋 Alle Kommentare</h2>
                <button class="help-modal-close" onclick="closeCommentsListModal()">&times;</button>
            </div>
            <div class="comments-search-container">
                <div class="comments-search-wrapper">
                    <span class="comments-search-icon">🔍</span>
                    <input type="text"
                           id="commentsSearchInput"
                           class="comments-search-input"
                           placeholder="Suche... (* als Platzhalter)"
                           oninput="filterComments(this.value)">
                    <button class="comments-search-clear" id="commentsSearchClear" onclick="clearCommentsSearch()">&times;</button>
                </div>
                <div class="comments-search-hint">Beispiel: *fehler* findet alle Kommentare mit "fehler" im Text</div>
            </div>
            <div class="comments-search-results" id="commentsSearchResults" style="display: none;"></div>
            <div class="comments-list-body" id="commentsListBody">
                <div class="no-comments">
                    <div class="no-comments-icon">💬</div>
                    <p>Lade Kommentare...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Age Verification Modal -->
    <div class="age-verification-overlay" id="ageVerificationModal">
        <div class="age-verification-modal" onclick="event.stopPropagation()">
            <div class="age-verification-icon">🔞</div>
            <h2>Altersverifikation</h2>
            <p>Diese Seite enthält Inhalte über Beziehungsmodelle und ist nur für Personen ab 18 Jahren bestimmt.</p>
            <div class="age-verification-question">
                <strong>Bist du mindestens 18 Jahre alt?</strong>
            </div>
            <!-- Buttons -->
            <div class="age-verification-buttons">
                <button class="age-btn age-btn-yes" id="ageVerifyYes" type="button" onclick="window.confirmAge(true); return false;">
                    Ja, ich bin 18+
                </button>
                <button class="age-btn age-btn-no" id="ageVerifyNo" type="button" onclick="window.confirmAge(false); return false;">
                    Nein, ich bin unter 18
                </button>
            </div>
            <p class="age-verification-note">
                Mit dem Klick auf "Ja" bestätigst du, dass du:<br>
                • volljährig bist (mindestens 18 Jahre alt)<br>
                • die <a href="datenschutz.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Nutzungsbedingungen und Datenschutzerklaerung</a> akzeptierst<br>
                • zur Kenntnis nimmst, dass alle Inhalte urheberrechtlich geschützt sind<br>
                • die Inhalte nur für persönliche, nicht-kommerzielle Zwecke nutzt
            </p>
        </div>
    </div>

    <!-- Factor Detail Modal (Feature 1) -->
    <div class="modal-overlay" id="factorModal" onclick="closeFactorModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="factorModalTitle">Faktor-Details</span>
                <button class="modal-close" onclick="closeFactorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle" id="factorModalSubtitle"></p>
                <!-- Archetype Selection with Navigation -->
                <div id="factorModalArchetypeNav" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--text-muted); min-width: 50px;">DU:</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('ich', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="factorModalIchCode" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Single</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('ich', 1)" title="Nächster Archetyp">&#8250;</button>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--text-muted); min-width: 50px;">Partner:</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('partner', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="factorModalPartnerCode" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Duo</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('partner', 1)" title="Nächster Archetyp">&#8250;</button>
                    </div>
                </div>
                <div id="factorModalComboCode" style="font-size: 11px; color: var(--text-muted); background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 6px; display: inline-block; margin-bottom: 10px; font-family: monospace;"></div>
                <div class="score-display" id="factorModalScore">0%</div>
                <div class="explanation">
                    <h4>Warum dieser Score?</h4>
                    <p id="factorModalExplanation"></p>
                    <h4>Was bedeutet das?</h4>
                    <ul id="factorModalMeaning"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Pro/Contra Modal (Desktop Circle Click) -->
    <div class="modal-overlay" id="proContraModal" onclick="closeProContraModal(event)">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header">
                <span class="modal-title">Pro & Contra</span>
                <button class="modal-close" onclick="closeProContraModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Archetype Navigation -->
                <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--success); min-width: 50px; font-weight: 600;">ICH:</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('ich', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="proContraModalIch" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Single</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('ich', 1)" title="Nächster Archetyp">&#8250;</button>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--danger); min-width: 50px; font-weight: 600;">Partner:</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('partner', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="proContraModalPartner" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Duo</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('partner', 1)" title="Nächster Archetyp">&#8250;</button>
                    </div>
                </div>
                <!-- Score Display -->
                <div class="score-display" id="proContraModalScore" style="font-size: 2.5rem; margin-bottom: 15px;">0%</div>
                <!-- Pro/Contra Lists -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <h4 style="color: var(--success); margin-bottom: 10px;">✓ Was funktioniert</h4>
                        <ul id="proContraModalProList" style="list-style: none; padding: 0; margin: 0;"></ul>
                    </div>
                    <div>
                        <h4 style="color: var(--danger); margin-bottom: 10px;">✗ Herausforderungen</h4>
                        <ul id="proContraModalContraList" style="list-style: none; padding: 0; margin: 0;"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tiage's Synthese Modal -->
    <div class="modal-overlay" id="pathosLogosModal" onclick="closePathosLogosModal(event)">
        <!-- Sticky side toggle buttons for Pathos and Logos - positioned in overlay, right side of modal -->
        <div id="pathosLogosStickyToggle" onclick="event.stopPropagation()" style="position: fixed; left: min(calc(50% + 360px), calc(100% - 60px)); top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 8px; z-index: 1002;">
            <button id="pathosLogosTogglePathos" onclick="showPathosLogosContent('pathos')" style="padding: 12px 14px; border-radius: 8px; border: 1px solid var(--border); background: rgba(30,30,35,0.95); color: var(--text-primary); cursor: pointer; font-size: 16px; transition: all 0.2s; backdrop-filter: blur(10px); box-shadow: 0 2px 12px rgba(0,0,0,0.4);" title="Pathos - Emotionale Resonanz">🔥</button>
            <button id="pathosLogosToggleLogos" onclick="showPathosLogosContent('logos')" style="padding: 12px 14px; border-radius: 8px; border: 1px solid var(--border); background: rgba(30,30,35,0.95); color: var(--text-muted); cursor: pointer; font-size: 16px; transition: all 0.2s; backdrop-filter: blur(10px); box-shadow: 0 2px 12px rgba(0,0,0,0.4);" title="Logos - Rationale Struktur">🧠</button>
        </div>
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 700px; max-height: 85vh; overflow-y: auto; position: relative;">
            <div class="modal-header">
                <span class="modal-title" id="pathosLogosModalTitle">Tiage's Synthese</span>
                <button class="modal-close" onclick="closePathosLogosModal()">&times;</button>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- Type indicator -->
                <div id="pathosLogosTypeIndicator" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                    <span style="font-size: 24px;" id="pathosLogosIcon">🔥</span>
                    <div>
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;" id="pathosLogosCategory">Dynamische Qualität</div>
                        <div style="font-size: 14px; color: var(--text-primary); font-weight: 600;" id="pathosLogosSubtitle">Emotionale Verbindung</div>
                    </div>
                </div>
                <!-- Archetype context with navigation -->
                <div id="pathosLogosArchetypeContext" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                    <!-- ICH Navigation -->
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <button onclick="navigatePathosLogosArchetype('ich', -1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="Vorheriger Archetyp">‹</button>
                        <div style="text-align: center; min-width: 70px;">
                            <div style="font-size: 10px; color: var(--success); font-weight: 600; margin-bottom: 4px;">ICH</div>
                            <div style="font-size: 13px; color: var(--text-primary);" id="pathosLogosModalIch">Duo</div>
                        </div>
                        <button onclick="navigatePathosLogosArchetype('ich', 1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="Nächster Archetyp">›</button>
                    </div>
                    <div style="font-size: 18px; color: var(--text-muted);">×</div>
                    <!-- PARTNER Navigation -->
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <button onclick="navigatePathosLogosArchetype('partner', -1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="Vorheriger Archetyp">‹</button>
                        <div style="text-align: center; min-width: 70px;">
                            <div style="font-size: 10px; color: var(--danger); font-weight: 600; margin-bottom: 4px;">PARTNER</div>
                            <div style="font-size: 13px; color: var(--text-primary);" id="pathosLogosModalPartner">Poly Hedo</div>
                        </div>
                        <button onclick="navigatePathosLogosArchetype('partner', 1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="Nächster Archetyp">›</button>
                    </div>
                </div>
                <!-- Main content -->
                <div id="pathosLogosModalContent" style="font-size: 15px; line-height: 1.7; color: var(--text-secondary);">
                    <!-- Content will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Archetype Info Modal (Feature 4) -->
    <!-- archetypeInfoModal wurde mit definitionModal zusammengeführt -->

    <header>
        <div class="header-content">
            <h1 data-i18n="ui.title">DAS ANARCHISCHE TI-AGE PRINZIP DER PAARUNG</h1>
            <div class="header-buttons">
                <button class="lang-btn" onclick="TiageI18n.toggle(); updateAllTranslations();" title="Switch Language / Sprache wechseln">
                    <span class="lang-icon">🌐</span>
                    <span class="lang-code" id="currentLangCode">DE</span>
                </button>
                <button class="fold-unfold-btn header-fold-btn" id="foldUnfoldAllBtn" onclick="toggleAllDimensionsCollapse()" title="Fold/Unfold all fields">
                    <span class="fold-unfold-icon">▼</span>
                    <span class="fold-unfold-text">Fold</span>
                </button>
                <button class="help-btn" onclick="openHelpModal()" title="Hilfe & Dokumentation">?</button>
            </div>
        </div>
    </header>

    <!-- Desktop Selection Info Message -->
    <div class="selection-info-message" id="desktopSelectionInfo"></div>

    <!-- NEW: Side-by-Side Comparison Layout (Desktop) -->
    <div class="comparison-container desktop-mode" id="comparisonView">
        <!-- Two Column Grid -->
        <div class="comparison-grid">
            <!-- ICH Column -->
            <div class="comparison-column ich-column">
                <div class="column-header">
                    <div class="column-icon">👤</div>
                    <div class="column-title">DU</div>
                </div>
                <div class="select-with-info">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="ichSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="Relationship Anarchist - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', 1)" title="Nächster Archetyp">&#9654;</button>
                    <button class="archetype-info-btn" onclick="showArchetypeInfo('ich')" title="Info zum Archetyp">INFO</button>
                </div>
                <!-- Archetypen-Symbol-Grid für ICH -->
                <div class="archetype-symbols-grid" id="ich-archetype-grid">
                    <div class="archetype-symbol-item active" data-archetype="single" onclick="selectArchetypeFromGrid('ich', 'single')">
                        <span class="archetype-symbol-icon">★</span>
                        <span class="archetype-symbol-name">Single</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo" onclick="selectArchetypeFromGrid('ich', 'duo')">
                        <span class="archetype-symbol-icon">♡</span>
                        <span class="archetype-symbol-name">Duo</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo_flex" onclick="selectArchetypeFromGrid('ich', 'duo_flex')">
                        <span class="archetype-symbol-icon">⚡</span>
                        <span class="archetype-symbol-name">Duo-Flex</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="solopoly" onclick="selectArchetypeFromGrid('ich', 'solopoly')">
                        <span class="archetype-symbol-icon">◆</span>
                        <span class="archetype-symbol-name">Solopoly</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="polyamor" onclick="selectArchetypeFromGrid('ich', 'polyamor')">
                        <span class="archetype-symbol-icon">♥</span>
                        <span class="archetype-symbol-name">Polyamor</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="ra" onclick="selectArchetypeFromGrid('ich', 'ra')">
                        <span class="archetype-symbol-icon">∞</span>
                        <span class="archetype-symbol-name">RA</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="lat" onclick="selectArchetypeFromGrid('ich', 'lat')">
                        <span class="archetype-symbol-icon">⌂</span>
                        <span class="archetype-symbol-name">LAT</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="aromantisch" onclick="selectArchetypeFromGrid('ich', 'aromantisch')">
                        <span class="archetype-symbol-icon">◇</span>
                        <span class="archetype-symbol-name">Aromantisch</span>
                    </div>
                </div>
                <div class="header-geschlecht-info" id="ich-header-geschlecht"></div>
                <div class="header-geschlecht-info" id="ich-header-dominanz"></div>
                <div class="header-geschlecht-info" id="ich-header-orientierung"></div>
                <div class="column-dimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="ich-geschlecht-new">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showGeschlechtInfoModal()">Geschlechtsidentität</span> <span id="ich-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="ich-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="ich-geschlecht-grid" data-person="ich"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="ich-dominanz-multi">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showDominanzInfoModal()">Dominanz</span> <span id="ich-dominanz-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="ich-dominanz-summary"></div>
                        <div class="dominanz-grid" id="ich-dominanz-grid" data-person="ich"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="ich-orientierung-multi">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showOrientierungInfoModal()">Orientierung</span> <span id="ich-orientierung-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="ich-orientierung-summary"></div>
                        <div class="orientierung-grid" id="ich-orientierung-grid" data-person="ich"></div>
                    </div>
                </div>
            </div>

            <!-- PARTNER Column -->
            <div class="comparison-column partner-column">
                <div class="column-header">
                    <div class="column-icon">👥</div>
                    <div class="column-title">PARTNER</div>
                </div>
                <div class="select-with-info">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="partnerSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" selected title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="Relationship Anarchist - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', 1)" title="Nächster Archetyp">&#9654;</button>
                    <button class="archetype-info-btn" onclick="showArchetypeInfo('partner')" title="Info zum Archetyp">INFO</button>
                </div>
                <!-- Archetypen-Symbol-Grid für PARTNER -->
                <div class="archetype-symbols-grid" id="partner-archetype-grid">
                    <div class="archetype-symbol-item" data-archetype="single" onclick="selectArchetypeFromGrid('partner', 'single')">
                        <span class="archetype-symbol-icon">★</span>
                        <span class="archetype-symbol-name">Single</span>
                    </div>
                    <div class="archetype-symbol-item active" data-archetype="duo" onclick="selectArchetypeFromGrid('partner', 'duo')">
                        <span class="archetype-symbol-icon">♡</span>
                        <span class="archetype-symbol-name">Duo</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo_flex" onclick="selectArchetypeFromGrid('partner', 'duo_flex')">
                        <span class="archetype-symbol-icon">⚡</span>
                        <span class="archetype-symbol-name">Duo-Flex</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="solopoly" onclick="selectArchetypeFromGrid('partner', 'solopoly')">
                        <span class="archetype-symbol-icon">◆</span>
                        <span class="archetype-symbol-name">Solopoly</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="polyamor" onclick="selectArchetypeFromGrid('partner', 'polyamor')">
                        <span class="archetype-symbol-icon">♥</span>
                        <span class="archetype-symbol-name">Polyamor</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="ra" onclick="selectArchetypeFromGrid('partner', 'ra')">
                        <span class="archetype-symbol-icon">∞</span>
                        <span class="archetype-symbol-name">RA</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="lat" onclick="selectArchetypeFromGrid('partner', 'lat')">
                        <span class="archetype-symbol-icon">⌂</span>
                        <span class="archetype-symbol-name">LAT</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="aromantisch" onclick="selectArchetypeFromGrid('partner', 'aromantisch')">
                        <span class="archetype-symbol-icon">◇</span>
                        <span class="archetype-symbol-name">Aromantisch</span>
                    </div>
                </div>
                <div class="header-geschlecht-info" id="partner-header-geschlecht"></div>
                <div class="header-geschlecht-info" id="partner-header-dominanz"></div>
                <div class="header-geschlecht-info" id="partner-header-orientierung"></div>
                <div class="column-dimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="partner-geschlecht-new">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showGeschlechtInfoModal()">Geschlechtsidentität</span> <span id="partner-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="partner-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="partner-geschlecht-grid" data-person="partner"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="partner-dominanz-multi">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showDominanzInfoModal()">Dominanz</span> <span id="partner-dominanz-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="partner-dominanz-summary"></div>
                        <div class="dominanz-grid" id="partner-dominanz-grid" data-person="partner"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="partner-orientierung-multi">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showOrientierungInfoModal()">Orientierung</span> <span id="partner-orientierung-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="partner-orientierung-summary"></div>
                        <div class="orientierung-grid" id="partner-orientierung-grid" data-person="partner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Bar - Simplified Grid -->
        <div class="result-bar">
            <div id="warningsContainer" style="display: none;"></div>

            <!-- Simplified Grid with Score Circle and Tiage's Synthese -->
            <div class="result-score-grid" style="display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: center; padding: 15px;">
                <!-- Score Circle -->
                <div class="result-circle-column" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <div class="desktop-score-circle" id="desktopScoreCircle" onclick="openProContraModal()" title="Klicken für Pro & Contra Details">
                        <span id="desktopCirclePercentage">0%</span>
                    </div>
                    <div class="desktop-score-label">Beziehungsqualität</div>
                </div>

                <!-- Tiage's Synthese Button -->
                <div style="display: flex; align-items: center;">
                    <button class="tiage-ansatz-btn" id="desktopTiageAnsatzBtn" onclick="openPathosLogosModal('pathos')" title="Tiage's Synthese - Pathos & Logos">
                        <span class="tiage-ansatz-icon">💡</span>
                        <span class="tiage-ansatz-text">Tiage's Synthese</span>
                    </button>
                </div>
            </div>

            <!-- Hidden elements for backwards compatibility -->
            <div id="desktopScoreNote" class="score-note" style="display: none;"></div>
            <span id="resultIchType" style="display: none;">Single</span>
            <span id="resultPartnerType" style="display: none;">Duo</span>
            <div class="result-progress" style="display: none;">
                <div class="result-progress-fill" id="resultProgressFill" style="width: 0%; background: var(--primary);"></div>
            </div>
            <div class="result-percentage" id="resultPercentage" style="display: none;">0%</div>

        </div>
    </div>

    <!-- MOBILE: Multi-Page Swipe Interface -->
    <div class="mobile-multipage" id="mobileMultipage" style="display: none;">

        <!-- PAGE 1: Auswahl -->
        <div class="mobile-page active" id="mobilePage1" data-page="1">
            <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 20px; font-size: var(--font-lg);">Beziehungsqualität analysieren</h2>

            <!-- Mobile Fold/Unfold Button -->
            <div class="fold-unfold-toolbar mobile-fold-toolbar" style="display: flex; gap: 10px; align-items: center;">
                <button class="fold-unfold-btn" id="mobileFoldUnfoldBtn" onclick="toggleAllDimensionsCollapse()" title="Fold/Unfold all fields">
                    <span class="fold-unfold-icon">▼</span>
                    <span class="fold-unfold-text">Unfold</span>
                </button>
            </div>

            <!-- ICH Auswahl -->
            <div style="background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); border-top: 3px solid var(--success); padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: var(--success); font-weight: 700; font-size: var(--font-lg);">
                    <span>👤</span> DU
                </div>
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="mobileIchSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="Relationship Anarchist - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', 1)" title="Nächster Archetyp">&#9654;</button>
                    <button onclick="openArchetypeInfo(document.getElementById('mobileIchSelect').value, 'ich')" style="padding: 12px 16px; background: rgba(255,255,255,0.1); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 14px; font-weight: 600; letter-spacing: 0.5px;" title="Info zum Archetyp">INFO</button>
                </div>
                <div class="column-dimensions" id="mobileIchDimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-ich-geschlecht">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showGeschlechtInfoModal()">Geschlechtsidentität</span> <span id="mobile-ich-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="mobile-ich-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="mobile-ich-geschlecht-grid" data-person="ich"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-ich-dominanz-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="geschlecht-info-link" onclick="event.stopPropagation(); showDominanzInfoModal()">Dominanz</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('dominanzStatus')">(I=Identität, G=Sekundär)</span></span>
                            <span class="collapse-toggle">▼</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-ich-dominanz-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-ich-d-dom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</span>
                                <div id="m-ich-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'dominant', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-d-sub-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</span>
                                <div id="m-ich-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-d-sw-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('switch')" style="cursor: pointer;">switch</span>
                                <div id="m-ich-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'switch', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-d-aus-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</span>
                                <div id="m-ich-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-ich-orientierung-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="geschlecht-info-link" onclick="event.stopPropagation(); showOrientierungInfoModal()">Orientierung</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('status')">(I=Identität, G=Sekundär)</span></span>
                            <span class="collapse-toggle">▼</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-ich-orientierung-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-ich-o-het-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</span>
                                <div id="m-ich-o-het-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-o-hom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</span>
                                <div id="m-ich-o-hom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-o-bi-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</span>
                                <div id="m-ich-o-bi-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PARTNER Auswahl -->
            <div style="background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); border-top: 3px solid var(--danger); padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: var(--danger); font-weight: 700; font-size: var(--font-lg);">
                    <span>👥</span> DEIN PARTNER
                </div>
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="mobilePartnerSelect">
                        <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                        <option value="duo" selected title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                        <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="Relationship Anarchist - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', 1)" title="Nächster Archetyp">&#9654;</button>
                    <button onclick="openArchetypeInfo(document.getElementById('mobilePartnerSelect').value, 'partner')" style="padding: 12px 16px; background: rgba(255,255,255,0.1); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 14px; font-weight: 600; letter-spacing: 0.5px;" title="Info zum Archetyp">INFO</button>
                </div>
                <div class="column-dimensions" id="mobilePartnerDimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-partner-geschlecht">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link" onclick="showGeschlechtInfoModal()">Geschlechtsidentität</span> <span id="mobile-partner-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-i">I</span>=Identität, <span class="legend-g">G</span>=Sekundär)</span></div>
                        <div class="collapsed-summary" id="mobile-partner-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="mobile-partner-geschlecht-grid" data-person="partner"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-partner-dominanz-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="geschlecht-info-link" onclick="event.stopPropagation(); showDominanzInfoModal()">Dominanz</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('dominanzStatus')">(I=Identität, G=Sekundär)</span></span>
                            <span class="collapse-toggle">▼</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-partner-dominanz-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-partner-d-dom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</span>
                                <div id="m-partner-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'dominant', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-d-sub-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</span>
                                <div id="m-partner-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-d-sw-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('switch')" style="cursor: pointer;">switch</span>
                                <div id="m-partner-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'switch', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-d-aus-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</span>
                                <div id="m-partner-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-partner-orientierung-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="geschlecht-info-link" onclick="event.stopPropagation(); showOrientierungInfoModal()">Orientierung</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('status')">(I=Identität, G=Sekundär)</span></span>
                            <span class="collapse-toggle">▼</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-partner-orientierung-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-partner-o-het-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</span>
                                <div id="m-partner-o-het-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-o-hom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</span>
                                <div id="m-partner-o-hom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-o-bi-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</span>
                                <div id="m-partner-o-bi-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-primary-mobile" onclick="mobileGoToPage(2)">Analysieren →</button>

            <!-- Reset Button -->
            <button onclick="resetAll()" style="width: 100%; padding: 14px; margin-top: 12px; background: transparent; border: 1px solid rgba(255,255,255,0.3); border-radius: 12px; color: rgba(255,255,255,0.7); font-size: var(--font-base); cursor: pointer; transition: all 0.2s;">
                🔄 Auswahl zurücksetzen
            </button>
        </div>

        <!-- PAGE 2: Ergebnis-Übersicht -->
        <div class="mobile-page" id="mobilePage2" data-page="2">
            <div class="page-header">
                <button class="btn-back" onclick="mobileGoToPage(1)">←</button>
                <span class="page-title">Ergebnis</span>
            </div>

            <div class="types-display" style="flex-direction: column; gap: 8px;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px;">DU:</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('ich', -1)" title="Vorheriger">&#9664;</button>
                    <span class="type-name" id="mobileResultIch" style="min-width: 80px; text-align: center;">Single</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('ich', 1)" title="Nächster">&#9654;</button>
                </div>
                <span style="font-size: 14px; color: var(--text-muted);">×</span>
                <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px;">Partner:</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('partner', -1)" title="Vorheriger">&#9664;</button>
                    <span class="type-name" id="mobileResultPartner" style="min-width: 80px; text-align: center;">Duo</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('partner', 1)" title="Nächster">&#9654;</button>
                </div>
            </div>

            <div class="score-circle-container">
                <div class="score-circle" id="mobileScoreCircle" onclick="openProContraModal()" style="cursor: pointer;" title="Klicken für Pro & Contra Details">0%</div>
                <p class="score-label">Beziehungsqualität <span class="info-icon" onclick="event.stopPropagation(); openHelpModal()" title="Hilfe zur Beziehungsqualität" style="cursor: pointer; font-size: 12px; width: 18px; height: 18px; display: inline-flex; align-items: center; justify-content: center; vertical-align: middle; margin-left: 4px;">?</span></p>
                <button class="tiage-ansatz-btn" id="mobileTiageAnsatzBtn" onclick="openPathosLogosModal('pathos')" title="Tiage's Synthese - Pathos & Logos" style="margin-left: auto; margin-right: auto;">
                    <span class="tiage-ansatz-icon">💡</span>
                    <span class="tiage-ansatz-text">Tiage's Synthese</span>
                </button>
                <div id="mobileScoreNote" class="score-note" style="margin-top: 8px; font-size: 13px; color: var(--text-secondary); font-style: italic; text-align: center; max-width: 280px; line-height: 1.4; margin-left: auto; margin-right: auto;"></div>
            </div>

            <!-- Score Breakdown with Sublabels -->
            <div class="score-breakdown">
                <div class="score-factor" onclick="openFactorModal('archetyp')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Archetyp-Übereinstimmung</span>
                        <span class="score-factor-sub">(Beziehungsphilosophie - Verstand&Logos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorArchetyp">0%</span>
                </div>
                <div class="score-factor" onclick="openFactorModal('dominanz')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Dominanz-Harmonie</span>
                        <span class="score-factor-sub">(Emotionale Dynamik - Gefühl&Pathos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorDominanz">0%</span>
                </div>
                <div class="score-factor" onclick="openFactorModal('orientierung')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Orientierungs-Kompatibilität</span>
                        <span class="score-factor-sub">(Körperliche Anziehung - Gefühl&Pathos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorOrientierung">0%</span>
                </div>
                <div class="score-factor" onclick="openFactorModal('geschlecht')" style="cursor: pointer;">
                    <div class="score-factor-label">
                        <span class="score-factor-main">Geschlechts-Attraktion</span>
                        <span class="score-factor-sub">(Gender-Chemie - Gefühl&Pathos)</span>
                    </div>
                    <span class="score-factor-value" id="mobileFactorGeschlecht">0%</span>
                </div>
            </div>
        </div>

        <!-- PAGE 3: Kategorien-Übersicht -->
        <div class="mobile-page" id="mobilePage3" data-page="3">
            <div class="page-header">
                <button class="btn-back" onclick="mobileGoToPage(2)">←</button>
                <span class="page-title">Kategorien</span>
            </div>

            <div class="types-display" style="flex-direction: column; gap: 8px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px;">DU:</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage3('ich', -1)" title="Vorheriger">&#9664;</button>
                    <span class="type-name" id="mobileResultIch3" style="min-width: 80px; text-align: center;">Single</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage3('ich', 1)" title="Nächster">&#9654;</button>
                </div>
                <span style="font-size: 14px; color: var(--text-muted);">×</span>
                <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px;">Partner:</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage3('partner', -1)" title="Vorheriger">&#9664;</button>
                    <span class="type-name" id="mobileResultPartner3" style="min-width: 80px; text-align: center;">Duo</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage3('partner', 1)" title="Nächster">&#9654;</button>
                </div>
            </div>

            <!-- 6 Kategorien-Balken -->
            <div class="category-bars-container" id="mobileCategoryBars">
                <!-- Wird dynamisch gefüllt von renderCategoryBars() -->
            </div>

            <button class="btn-primary-mobile" onclick="mobileGoToPage(1)" style="margin-top: 20px;">← Zurück zur Auswahl</button>
        </div>

        <!-- Page Indicator -->
        <div class="page-indicator">
            <span class="page-dot active" onclick="mobileGoToPage(1)"></span>
            <span class="page-dot" onclick="mobileGoToPage(2)"></span>
            <span class="page-dot" onclick="mobileGoToPage(3)"></span>
        </div>
    </div>

    <!-- OLD Carousel (hidden) -->
    <div class="carousel-container" id="carousel" style="display: none;">
        <!-- CARD 1: MEIN TYP -->
        <div class="card" data-card="0">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Mein Typ</span>
                </div>
                <div class="card-body">
                    <div class="main-select">
                        <label class="main-select-label">Ich bin...</label>
                        <select id="archetypeSelect">
                            <option value="single" title="Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung">Single</option>
                            <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivität">Duo</option>
                            <option value="duo_flex" title="Primäre Zweierbeziehung mit vereinbarten Öffnungen">Duo-Flex</option>
                            <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                            <option value="polyamor" title="Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen">Polyamor</option>
                            <option value="ra" title="Relationship Anarchist - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                            <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                            <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                        </select>
                    </div>

                    <!-- Extended Dimensions: ICH -->
                    <div class="dimensions-section">
                        <div class="dimensions-section-title ich-title">Meine Eigenschaften</div>
                        <div class="dimensions-grid">
                            <!-- Geschlechtsidentität -->
                            <div class="dimension-group needs-selection" data-dimension="ich-geschlecht">
                                <div class="dimension-label">
                                    <span class="geschlecht-info-link" onclick="showGeschlechtInfoModal()">Geschlechtsidentität</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(I=Identität, G=Sekundär)</span>
                                </div>
                                <div class="geschlecht-grid" id="modal-ich-geschlecht-grid" data-person="ich"></div>
                            </div>

                            <!-- Dominanz Multi-Select -->
                            <div class="dimension-group needs-selection" data-dimension="modal-ich-dominanz-multi">
                                <div class="dimension-label">
                                    Dominanz
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(I=Identität, G=Sekundär)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-ich-d-dom-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</span>
                                        <div id="modal-ich-d-dom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'dominant', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'dominant', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-d-sub-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</span>
                                        <div id="modal-ich-d-sub-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-d-sw-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('switch')" style="cursor: pointer;">switch</span>
                                        <div id="modal-ich-d-sw-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'switch', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'switch', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-d-aus-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</span>
                                        <div id="modal-ich-d-aus-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sexuelle Orientierung -->
                            <div class="dimension-group full-width needs-selection" data-dimension="modal-ich-orientierung-multi">
                                <div class="dimension-label">
                                    Sexuelle Orientierung
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(I=Identität, G=Sekundär)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-ich-o-het-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</span>
                                        <div id="modal-ich-o-het-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-o-hom-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</span>
                                        <div id="modal-ich-o-hom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-o-bi-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</span>
                                        <div id="modal-ich-o-bi-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="my-type-header">
                        <div class="my-type-icon" id="myTypeIcon">★</div>
                        <div class="type-tooltip">
                            <div class="my-type-name" id="myTypeName">Single</div>
                            <span class="tooltip-text" id="myTypeTooltip"></span>
                        </div>
                        <span class="type-info-icon" id="myTypeInfoIcon" onclick="openDefinitionModal(currentArchetype)" title="Was bedeutet dieser Typ?">ℹ</span>
                    </div>
                    <p class="my-type-desc" id="myTypeDesc">...</p>

                    <!-- Collapsible: Pro/Contra -->
                    <div class="collapsible" id="proContraCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('proContraCollapse')">
                            <span>Pro & Contra – Qualitätsfaktoren</span>
                            <span class="collapsible-icon">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pro-contra-grid">
                                <div class="mini-list">
                                    <div class="mini-list-title pro">✓ Pro</div>
                                    <ul id="myTypePro"></ul>
                                </div>
                                <div class="mini-list">
                                    <div class="mini-list-title contra">✗ Contra</div>
                                    <ul id="myTypeContra"></ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Collapsible: Pathos/Logos -->
                    <div class="collapsible" id="pathosLogosCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('pathosLogosCollapse')">
                            <span>Pathos & Logos – Dynamische Qualität</span>
                            <span class="collapsible-icon">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pathos-logos-content">
                                <p id="myTypePathos"></p>
                                <p id="myTypeLogos"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Match Section -->
                    <div class="match-section">
                        <div class="match-card top" id="topMatchCard" onclick="openMatchModal('top')">
                            <div class="match-info">
                                <div class="match-dot" id="topMatchDot"></div>
                                <div>
                                    <div class="match-label-text">Top Match</div>
                                    <div class="match-name" id="topMatchName">...</div>
                                </div>
                            </div>
                            <div class="match-score excellent" id="topMatchScore">0%</div>
                        </div>

                        <div class="match-card challenge" id="challengeCard" onclick="openMatchModal('challenge')">
                            <div class="match-info">
                                <div class="match-dot" id="challengeDot"></div>
                                <div>
                                    <div class="match-label-text">Challenge</div>
                                    <div class="match-name" id="challengeName">...</div>
                                </div>
                            </div>
                            <div class="match-score low" id="challengeScore">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 2: BEZIEHUNGSQUALITÄT -->
        <div class="card" data-card="1">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Beziehungsqualität</span>
                </div>
                <div class="card-body">
                    <!-- Partner Selector -->
                    <div class="partner-selector" id="partnerSelector"></div>

                    <!-- Extended Dimensions: PARTNER -->
                    <div class="dimensions-section" style="margin-top: 0; padding-top: 15px; border-top: none;">
                        <div class="dimensions-section-title partner-title">Partner-Eigenschaften</div>
                        <div class="dimensions-grid">
                            <!-- Geschlecht -->
                            <div class="dimension-group needs-selection" data-dimension="partner-geschlecht">
                                <div class="dimension-label">
                                    <span class="geschlecht-info-link" onclick="showGeschlechtInfoModal()">Geschlechtsidentität</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(I=Identität, G=Sekundär)</span>
                                </div>
                                <div class="geschlecht-grid" id="modal-partner-geschlecht-grid" data-person="partner"></div>
                            </div>

                            <!-- Dominanz Multi-Select -->
                            <div class="dimension-group needs-selection" data-dimension="modal-partner-dominanz-multi">
                                <div class="dimension-label">
                                    Dominanz
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(I=Identität, G=Sekundär)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-partner-d-dom-row">
                                        <input type="checkbox" id="modal-partner-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'dominant', this.checked)">
                                        <label for="modal-partner-d-dom" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</label>
                                        <button type="button" id="modal-partner-d-dom-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'dominant', this)">interessiert</button>
                                        <div id="modal-partner-d-dom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'dominant', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'dominant', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-d-sub-row">
                                        <input type="checkbox" id="modal-partner-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'submissiv', this.checked)">
                                        <label for="modal-partner-d-sub" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</label>
                                        <button type="button" id="modal-partner-d-sub-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'submissiv', this)">interessiert</button>
                                        <div id="modal-partner-d-sub-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-d-sw-row">
                                        <input type="checkbox" id="modal-partner-d-sw" value="switch" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'switch', this.checked)">
                                        <label for="modal-partner-d-sw" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('switch')" style="cursor: pointer;">switch</label>
                                        <button type="button" id="modal-partner-d-sw-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'switch', this)">interessiert</button>
                                        <div id="modal-partner-d-sw-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'switch', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'switch', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-d-aus-row">
                                        <input type="checkbox" id="modal-partner-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'ausgeglichen', this.checked)">
                                        <label for="modal-partner-d-aus" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</label>
                                        <button type="button" id="modal-partner-d-aus-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'ausgeglichen', this)">interessiert</button>
                                        <div id="modal-partner-d-aus-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sexuelle Orientierung -->
                            <div class="dimension-group full-width needs-selection" data-dimension="modal-partner-orientierung-multi">
                                <div class="dimension-label">
                                    Sexuelle Orientierung
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(I=Identität, G=Sekundär)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-partner-o-het-row">
                                        <input type="checkbox" id="modal-partner-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'heterosexuell', this.checked)">
                                        <label for="modal-partner-o-het" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</label>
                                        <button type="button" id="modal-partner-o-het-secondary" class="secondary-interessiert-btn" onclick="handleOrientierungSecondaryInteressiert('partner', 'heterosexuell', this)">interessiert</button>
                                        <div id="modal-partner-o-het-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-o-hom-row">
                                        <input type="checkbox" id="modal-partner-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'homosexuell', this.checked)">
                                        <label for="modal-partner-o-hom" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</label>
                                        <button type="button" id="modal-partner-o-hom-secondary" class="secondary-interessiert-btn" onclick="handleOrientierungSecondaryInteressiert('partner', 'homosexuell', this)">interessiert</button>
                                        <div id="modal-partner-o-hom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-o-bi-row">
                                        <input type="checkbox" id="modal-partner-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'bisexuell', this.checked)">
                                        <label for="modal-partner-o-bi" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</label>
                                        <button type="button" id="modal-partner-o-bi-secondary" class="secondary-interessiert-btn" onclick="handleOrientierungSecondaryInteressiert('partner', 'bisexuell', this)">interessiert</button>
                                        <div id="modal-partner-o-bi-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Overview Box -->
                    <div class="analysis-overview" id="analysisOverview" onclick="scrollToCard(0)">
                        <div class="analysis-overview-title">
                            <span>🔍</span> Analysiere:
                        </div>
                        <div class="analysis-overview-content" id="analysisOverviewContent">
                            <span class="type-name">Single</span> <span class="dim-info">(?, ?, ?)</span>
                            <span> × </span>
                            <span class="type-name">Duo</span> <span class="dim-info">(?, ?, ?)</span>
                        </div>
                        <span class="analysis-overview-edit">Bearbeiten →</span>
                    </div>

                    <!-- PATHOS BLOCKER (K.O. - replaces entire analysis) -->
                    <div class="pathos-blocker" id="pathosBlocker">
                        <div class="pathos-blocker-header">
                            <span class="pathos-blocker-icon">⛔</span>
                            <span class="pathos-blocker-title">Keine romantische Beziehung möglich</span>
                        </div>
                        <div class="pathos-blocker-reason" id="pathosBlockerReason">
                            Grund: Keine körperliche Anziehung möglich aufgrund der sexuellen Orientierungen
                        </div>
                        <div class="pathos-blocker-persons">
                            <div class="pathos-blocker-person">
                                <span class="pathos-blocker-person-label">DU:</span>
                                <span id="pathosBlockerPerson1">männlich, heterosexuell (Gelebt)</span>
                            </div>
                            <div class="pathos-blocker-person">
                                <span class="pathos-blocker-person-label">PARTNER:</span>
                                <span id="pathosBlockerPerson2">männlich, heterosexuell (Gelebt)</span>
                            </div>
                        </div>
                        <div class="pathos-blocker-divider"></div>
                        <div class="pathos-blocker-explanation">
                            <h4>Pathos vs. Logos</h4>
                            <p>Ohne körperliche und emotionale Anziehung (Gefühlsebene) kann keine romantische Beziehung entstehen.</p>
                            <p>Im Gegensatz zu philosophischen Differenzen (Verstandsebene), die durch Kommunikation und Lernen überbrückt werden können, ist sexuelle Orientierung (Gefühlsebene) keine Wahl und nicht veränderbar.</p>
                            <p>Das Tiage-Modell analysiert romantische Beziehungen und ist für diese Konstellation nicht anwendbar.</p>
                        </div>
                        <div class="pathos-blocker-actions">
                            <button class="pathos-blocker-btn pathos-blocker-btn-primary" onclick="scrollToCard(0)">
                                Angaben korrigieren
                            </button>
                            <button class="pathos-blocker-btn pathos-blocker-btn-secondary" onclick="showPathosLogosInfo()">
                                Mehr über Pathos/Logos
                            </button>
                        </div>
                    </div>

                    <!-- LOGOS WARNING (Warning, analysis continues) -->
                    <div class="logos-warning" id="logosWarning" onclick="toggleLogosWarning()">
                        <div class="logos-warning-header">
                            <span class="logos-warning-icon">⚠️</span>
                            <div class="logos-warning-content">
                                <div class="logos-warning-title" id="logosWarningTitle">Verstandsebene-Warnung: Fundamentale philosophische Unterschiede</div>
                                <div class="logos-warning-subtitle" id="logosWarningSubtitle">Beziehungsphilosophie: 25%</div>
                            </div>
                            <span class="logos-warning-toggle">▼</span>
                        </div>
                        <div class="logos-warning-details">
                            <div class="logos-warning-details-inner">
                                <div class="logos-warning-score">
                                    <span class="logos-warning-score-label">Philosophie-Qualität:</span>
                                    <span class="logos-warning-score-value" id="logosWarningScore">25%</span>
                                </div>
                                <p class="logos-warning-text" id="logosWarningText">
                                    Eure Grundüberzeugungen über Beziehungen sind sehr unterschiedlich. Dies erfordert intensive Kommunikation und Kompromissbereitschaft.
                                </p>
                                <div class="logos-warning-positive">
                                    <span class="logos-warning-positive-icon">✓</span>
                                    <span class="logos-warning-positive-text">ABER: Körperliche Anziehung ist vorhanden!</span>
                                </div>
                                <p class="logos-warning-text">Eine Beziehung ist möglich, erfordert aber:</p>
                                <ul class="logos-warning-list">
                                    <li>Intensive Kommunikation</li>
                                    <li>Fundamentale Kompromisse</li>
                                    <li>Gegenseitiges tiefes Verständnis</li>
                                </ul>
                                <div class="logos-warning-quote">
                                    "Gefühl kann Brücken bauen, wo der Verstand Widersprüche sieht - aber es wird nicht leicht."
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PATHOS UNCERTAIN (Exploration phase warning) -->
                    <div class="pathos-uncertain" id="pathosUncertain">
                        <span class="pathos-uncertain-icon">🔄</span>
                        <span class="pathos-uncertain-text" id="pathosUncertainText">
                            Mindestens eine Person ist in der Explorationsphase (Status: "Interessiert"). Die tatsächliche körperliche Anziehung ist noch unklar.
                        </span>
                    </div>

                    <!-- DOUBLE WARNING (Both Pathos uncertain + Logos low) -->
                    <div class="double-warning" id="doubleWarning">
                        <div class="double-warning-header">
                            <span>⚠️</span>
                            <span class="double-warning-title">Doppelte Herausforderung</span>
                        </div>
                        <div class="double-warning-item">
                            <div class="double-warning-item-title">1. Gefühlsebene: Unsichere körperliche Anziehung</div>
                            <div class="double-warning-item-text" id="doubleWarningPathos">
                                Partner: bisexuell (interessiert) → Exploration-Phase
                            </div>
                        </div>
                        <div class="double-warning-item">
                            <div class="double-warning-item-title">2. Verstandsebene: Philosophische Konflikte</div>
                            <div class="double-warning-item-text" id="doubleWarningLogos">
                                Beziehungsphilosophie: 25% → DUO vs. POLYAMOR
                            </div>
                        </div>
                        <p class="logos-warning-text" style="margin-top: 10px; font-size: var(--font-xs);">
                            Sowohl körperliche als auch philosophische Ebene haben Unsicherheiten.
                        </p>
                    </div>

                    <!-- Compatibility Content Wrapper (hidden when pathos blocked) -->
                    <div id="compatibilityContent">

                    <!-- Modifier Summary (shows dimension influences) -->
                    <div class="modifier-summary" id="modifierSummary">
                        <div class="modifier-summary-title">Dimensions-Einflüsse</div>
                        <div id="modifierSummaryContent">
                            <!-- Dynamically filled -->
                        </div>
                    </div>

                    <!-- Radar Chart -->
                    <div class="radar-section">
                        <div class="radar-header">
                            <div>
                                <div class="radar-title">
                                    <span class="type-tooltip"><span id="myTypeNameDisplay">...</span><span class="tooltip-text" id="myTypeTooltipPage3"></span></span>
                                    mit
                                    <span class="type-tooltip"><span id="partnerNameDisplay">...</span><span class="tooltip-text" id="partnerTooltipPage3"></span></span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="radar-score" id="overallScore" style="color: var(--primary);">0%</div>
                                <div class="radar-score-label">Gesamt</div>
                            </div>
                        </div>
                        <svg id="radarChart" viewBox="0 0 280 260"></svg>
                    </div>

                    <!-- Category Bars -->
                    <div class="category-section">
                        <div class="section-title-row">
                            <div class="section-title" style="margin-bottom: 0;">Kategorie-Details</div>
                            <div class="info-icon" onclick="openCategoryModal()">ℹ</div>
                        </div>
                        <div id="categoryBars"></div>
                    </div>

                    <!-- Pro/Contra Analysis -->
                    <div class="analysis-grid">
                        <div class="analysis-section pro">
                            <div class="analysis-title">✓ Was funktioniert</div>
                            <ul class="analysis-list" id="partnerPro"></ul>
                        </div>
                        <div class="analysis-section contra">
                            <div class="analysis-title">✗ Herausforderungen</div>
                            <ul class="analysis-list" id="partnerContra"></ul>
                        </div>
                    </div>
                    </div><!-- End compatibilityContent -->
                </div>
            </div>
        </div>

        <!-- CARD 3: LEGENDE -->
        <div class="card" data-card="2">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Legende</span>
                </div>
                <div class="card-body">
                    <!-- Farbskala -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungsskala</div>
                        <div class="color-scale">
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-good"></div>
                                <span class="color-scale-label">Gut</span>
                                <span class="color-scale-range">70-100%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-medium"></div>
                                <span class="color-scale-label">Mittel</span>
                                <span class="color-scale-range">50-69%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-low"></div>
                                <span class="color-scale-label">Herausfordernd</span>
                                <span class="color-scale-range">&lt;50%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Kategorien -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungskategorien</div>
                        <div id="legendCategories"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 4: FEEDBACK -->
        <div class="card" data-card="3">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Feedback</span>
                </div>
                <div class="card-body">
                    <!-- Search -->
                    <div class="feedback-search">
                        <input type="text" id="feedbackSearch" placeholder="🔍 Suche nach Name, Titel oder Inhalt..." class="feedback-search-input">
                    </div>

                    <!-- Advanced Filters -->
                    <div class="feedback-advanced-filters">
                        <div class="feedback-filter-row">
                            <label>Kombination:</label>
                            <select id="filterMyType" class="feedback-select">
                                <option value="all">Alle Typen</option>
                            </select>
                            <span class="filter-separator">mit</span>
                            <select id="filterPartnerType" class="feedback-select">
                                <option value="all">Alle Partner</option>
                            </select>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Kategorie:</label>
                            <div class="feedback-category-btns" id="categoryFilterBtns">
                                <button class="cat-filter-btn active" data-cat="all">Alle</button>
                                <button class="cat-filter-btn" data-cat="A" title="Beziehungsphilosophie">A Philosophie</button>
                                <button class="cat-filter-btn" data-cat="B" title="Werte-Alignment">B Werte</button>
                                <button class="cat-filter-btn" data-cat="C" title="Nähe-Distanz">C Nähe</button>
                                <button class="cat-filter-btn" data-cat="D" title="Autonomie">D Autonomie</button>
                                <button class="cat-filter-btn" data-cat="E" title="Kommunikation">E Kommunik.</button>
                                <button class="cat-filter-btn" data-cat="F" title="Soziale Kompatibilität">F Sozial</button>
                                <!-- Hidden for now - can be re-enabled later -->
                                <button class="cat-filter-btn" data-cat="TM" title="Top Match" style="display:none">Top Match</button>
                                <button class="cat-filter-btn" data-cat="CH" title="Challenge" style="display:none">Challenge</button>
                            </div>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Sortieren:</label>
                            <select id="filterSort" class="feedback-select">
                                <option value="newest">Neueste zuerst</option>
                                <option value="oldest">Älteste zuerst</option>
                                <option value="rating">Beste Bewertung</option>
                            </select>
                        </div>
                    </div>

                    <!-- Feedback List -->
                    <div class="feedback-list" id="feedbackList">
                        <div class="feedback-loading">Lade Feedback...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="categoryModal" onclick="closeCategoryModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <button class="archetype-nav-btn" onclick="navigateCategoryArchetype(-1)" title="Vorheriger Archetyp">&#8249;</button>
                <span class="modal-title" id="modalTitle">Kategorie-Details</span>
                <button class="archetype-nav-btn" onclick="navigateCategoryArchetype(1)" title="Nächster Archetyp">&#8250;</button>
                <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- feedbackModal entfernt - commentModal wird verwendet -->

    <!-- Definition Modal -->
    <div class="modal-overlay" id="definitionModal" onclick="closeDefinitionModal(event)">
        <div class="modal definition-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <button class="archetype-nav-btn" onclick="navigateDefinitionModal(-1)" title="Vorheriger Archetyp">&#8249;</button>
                <span class="modal-title" id="definitionModalTitle">Typ-Definition</span>
                <button class="archetype-nav-btn" onclick="navigateDefinitionModal(1)" title="Nächster Archetyp">&#8250;</button>
                <button class="modal-close" onclick="closeDefinitionModal()">&times;</button>
            </div>
            <div class="modal-body" id="definitionModalBody"></div>
        </div>
    </div>

    <!-- Dimension Info Tooltip Modal -->
    <div class="dimension-tooltip-overlay" id="dimensionTooltipOverlay" onclick="closeDimensionTooltip()">
        <div class="dimension-tooltip-content" onclick="event.stopPropagation()">
            <div class="dimension-tooltip-title" id="dimensionTooltipTitle">Info</div>
            <div class="dimension-tooltip-text" id="dimensionTooltipText">...</div>
            <button class="dimension-tooltip-close" onclick="closeDimensionTooltip()">Verstanden</button>
        </div>
    </div>

    <!-- Geschlecht Info Modal (scrollable) -->
    <div class="dimension-tooltip-overlay" id="geschlechtInfoModal" onclick="closeGeschlechtInfoModal()">
        <div class="geschlecht-info-modal-content" onclick="event.stopPropagation()">
            <div class="geschlecht-info-modal-header">
                <div class="dimension-tooltip-title">Geschlechtsidentitäten</div>
                <button class="geschlecht-info-close-btn" onclick="closeGeschlechtInfoModal()">&times;</button>
            </div>
            <div class="geschlecht-info-scroll-container">
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Cis Mann</div>
                    <div class="geschlecht-info-desc">Person, die bei Geburt männlich zugewiesen wurde und sich als Mann identifiziert.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Cis Frau</div>
                    <div class="geschlecht-info-desc">Person, die bei Geburt weiblich zugewiesen wurde und sich als Frau identifiziert.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Trans Mann</div>
                    <div class="geschlecht-info-desc">Person, die sich als Mann identifiziert, aber bei Geburt nicht männlich zugewiesen wurde.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Trans Frau</div>
                    <div class="geschlecht-info-desc">Person, die sich als Frau identifiziert, aber bei Geburt nicht weiblich zugewiesen wurde.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Nonbinär</div>
                    <div class="geschlecht-info-desc">Person, die sich weder ausschließlich als Mann noch als Frau identifiziert.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Genderfluid</div>
                    <div class="geschlecht-info-desc">Person, deren Geschlechtsidentität sich über Zeit verändert oder zwischen verschiedenen Identitäten wechselt.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Agender</div>
                    <div class="geschlecht-info-desc">Person, die sich mit keinem Geschlecht identifiziert oder geschlechtslos fühlt.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Intersex</div>
                    <div class="geschlecht-info-desc">Person mit angeborenen körperlichen Geschlechtsmerkmalen, die nicht eindeutig männlich oder weiblich sind.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Divers</div>
                    <div class="geschlecht-info-desc">Offizieller dritter Geschlechtseintrag in Deutschland für Menschen, die sich nicht als männlich oder weiblich identifizieren.</div>
                </div>
            </div>
            <button class="dimension-tooltip-close" onclick="closeGeschlechtInfoModal()">Schließen</button>
        </div>
    </div>

    <!-- Dominanz Info Modal (scrollable) -->
    <div class="dimension-tooltip-overlay" id="dominanzInfoModal" onclick="closeDominanzInfoModal()">
        <div class="geschlecht-info-modal-content" onclick="event.stopPropagation()">
            <div class="geschlecht-info-modal-header">
                <div class="dimension-tooltip-title">Dominanz-Präferenzen</div>
                <button class="geschlecht-info-close-btn" onclick="closeDominanzInfoModal()">&times;</button>
            </div>
            <div class="geschlecht-info-scroll-container">
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Dominant</div>
                    <div class="geschlecht-info-desc"><strong>Der Führende</strong> – Du übernimmst gerne Führung und Verantwortung in Beziehungen. Assertiv, selbstsicher, bestimmend, proaktiv. Direkte Kommunikation, konfrontiert Konflikte aktiv.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Submissiv</div>
                    <div class="geschlecht-info-desc"><strong>Der Folgende</strong> – Du lässt dich gerne führen und vertraust auf deinen Partner. Anpassungsfähig, empathisch, harmonieorientiert. Indirekte, diplomatische Kommunikation.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Switch</div>
                    <div class="geschlecht-info-desc"><strong>Der Flexible</strong> – Du genießt beide Rollen je nach Situation und Partner. Wandelbar, vielseitig, experimentierfreudig. Situativ angepasste Kommunikation.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Ausgeglichen</div>
                    <div class="geschlecht-info-desc"><strong>Der Zentrierte</strong> – Du bevorzugst eine gleichberechtigte Dynamik ohne feste Rollen. Balanciert, harmonisch, stabil. Ruhige, konstruktive Kommunikation.</div>
                </div>
            </div>
            <button class="dimension-tooltip-close" onclick="closeDominanzInfoModal()">Verstanden</button>
        </div>
    </div>

    <!-- Orientierung Info Modal (scrollable) -->
    <div class="dimension-tooltip-overlay" id="orientierungInfoModal" onclick="closeOrientierungInfoModal()">
        <div class="geschlecht-info-modal-content" onclick="event.stopPropagation()">
            <div class="geschlecht-info-modal-header">
                <div class="dimension-tooltip-title">Sexuelle Orientierungen</div>
                <button class="geschlecht-info-close-btn" onclick="closeOrientierungInfoModal()">&times;</button>
            </div>
            <div class="geschlecht-info-scroll-container">
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Heterosexuell</div>
                    <div class="geschlecht-info-desc"><strong>Anziehung zum anderen Geschlecht</strong> – Du fühlst dich romantisch und/oder sexuell zu Menschen des anderen Geschlechts hingezogen.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Homosexuell</div>
                    <div class="geschlecht-info-desc"><strong>Anziehung zum gleichen Geschlecht</strong> – Du fühlst dich romantisch und/oder sexuell zu Menschen des gleichen Geschlechts hingezogen.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Bisexuell</div>
                    <div class="geschlecht-info-desc"><strong>Anziehung zu beiden Geschlechtern</strong> – Du fühlst dich romantisch und/oder sexuell zu Menschen beider Geschlechter hingezogen.</div>
                </div>
            </div>
            <button class="dimension-tooltip-close" onclick="closeOrientierungInfoModal()">Verstanden</button>
        </div>
    </div>

    <!-- Navigation Dots with Arrows (hidden - old carousel nav) -->
    <div class="nav-dots" style="display: none;">
        <button class="nav-arrow" onclick="navigatePrev()">‹</button>
        <div class="nav-dot active" data-card="0" onclick="scrollToCard(0)"></div>
        <div class="nav-dot" data-card="1" onclick="scrollToCard(1)"></div>
        <div class="nav-dot" data-card="2" onclick="scrollToCard(2)"></div>
        <div class="nav-dot" data-card="3" onclick="scrollToCard(3)"></div>
        <button class="nav-arrow" onclick="navigateNext()">›</button>
    </div>

    <div class="swipe-hint" style="display: none;">← Swipe →</div>

    <!-- Footer with Impressum -->
    <footer class="app-footer">
        <!-- JOYclub Siegel -->
        <div style="margin-bottom: 15px; display: flex; justify-content: center;">
            <a href="https://www.joyclub.de/" target="_blank" rel="noopener">
                <img src="//cfnimg.joyclub.de/partner/joyclub_backlink_mitglied_120x120.png" width="120" height="120" alt="Lebe deine Lust!" style="border-radius: 50%;" />
            </a>
        </div>
        <div style="margin-bottom: 10px;">© 2025 Ti-Age – Alle Rechte vorbehalten</div>
        <div style="margin-bottom: 10px; font-size: 11px; opacity: 0.7;">Version 1.4.0</div>
        <a href="#" onclick="document.getElementById('impressumModal').classList.add('active'); return false;">Impressum</a>
        <span>|</span>
        <a href="datenschutz.html">Datenschutz</a>
        <span>|</span>
        <a href="nutzungsbedingungen.html">Nutzungsbedingungen</a>
    </footer>

    <!-- Impressum Modal -->
    <div class="impressum-modal" id="impressumModal" onclick="this.classList.remove('active')">
        <div class="impressum-content" onclick="event.stopPropagation()">
            <h3>Impressum</h3>
            <p><strong>Betreiber:</strong> Ti-Age</p>
            <p><strong>Projekt:</strong> Tiage_Beziehungsmodel</p>
            <p><strong>Kontakt:</strong> <a href="mailto:nerd@ti-age.de">nerd@ti-age.de</a></p>
            <button class="impressum-close" onclick="document.getElementById('impressumModal').classList.remove('active')">Schließen</button>
        </div>
    </div>

    <!-- State Management - Single Source of Truth -->
    <script src="js/state.js"></script>
    <script src="js/markdown-loader.js"></script>

    <!-- i18n Update Functions -->
    <script>
        /**
         * Update all translatable elements on the page
         * Called when language is changed
         */
        function updateAllTranslations() {
            const lang = TiageI18n.getLanguage();

            // Update language code display
            const langCodeEl = document.getElementById('currentLangCode');
            if (langCodeEl) {
                langCodeEl.textContent = lang.toUpperCase();
            }

            // Update HTML lang attribute
            document.documentElement.lang = lang;

            // Update page title
            const h1 = document.querySelector('h1[data-i18n]');
            if (h1) {
                const titleKey = h1.getAttribute('data-i18n');
                const translated = TiageI18n.t(titleKey);
                if (translated && translated !== titleKey) {
                    h1.textContent = translated.toUpperCase();
                }
            }

            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const translated = TiageI18n.t(key);
                if (translated && translated !== key) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translated;
                    } else {
                        el.textContent = translated;
                    }
                }
            });

            // Update all elements with data-i18n-title attribute (for tooltips)
            document.querySelectorAll('[data-i18n-title]').forEach(el => {
                const key = el.getAttribute('data-i18n-title');
                const translated = TiageI18n.t(key);
                if (translated && translated !== key) {
                    el.title = translated;
                }
            });

            // Update person labels (ICH/PARTNER -> ME/PARTNER)
            updatePersonLabels();

            // Update status buttons (Gelebt/Interessiert)
            updateStatusButtons();

            // Update dimension labels and tooltips
            updateDimensionLabels();

            // Update archetype names if displayed
            updateArchetypeNames();

            // Update category names
            updateCategoryNames();

            // Update column headers (DU/YOU, PARTNER)
            updateColumnHeaders();

            // Update dimension section labels
            updateDimensionSectionLabels();

            // Update geschlecht button labels
            updateGeschlechtButtons();

            // Update dominanz labels
            updateDominanzLabels();

            // Update orientierung labels
            updateOrientierungLabels();

            // Update fold/unfold button
            updateFoldUnfoldButton();

            // Update help modal
            updateHelpModal();

            // Update gender info modal
            updateGenderInfoModal();

            // Update impressum modal
            updateImpressumModal();

            // Update age verification modal
            updateAgeVerificationModal();

            // Update analysis overview (Du ein / You a + Geschlecht)
            if (typeof window.updateAnalysisOverview === 'function') {
                window.updateAnalysisOverview();
            }

            // Trigger custom event for other scripts to react
            document.dispatchEvent(new CustomEvent('languageChanged', {
                detail: { language: lang, locale: TiageI18n.getLocale() }
            }));

            console.log('[i18n] All translations updated to:', lang);
        }

        /**
         * Update person labels (ICH/ME, PARTNER)
         */
        function updatePersonLabels() {
            // Desktop ICH/PARTNER labels
            document.querySelectorAll('.person-label-ich, [data-person="ich"] .person-label').forEach(el => {
                el.textContent = TiageI18n.t('ui.ich', 'ICH');
            });
            document.querySelectorAll('.person-label-partner, [data-person="partner"] .person-label').forEach(el => {
                el.textContent = TiageI18n.t('ui.partner', 'PARTNER');
            });

            // Update any elements with explicit data-i18n-person
            document.querySelectorAll('[data-i18n-person="ich"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.ich', 'ICH');
            });
            document.querySelectorAll('[data-i18n-person="partner"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.partner', 'PARTNER');
            });
        }

        /**
         * Update status button labels (Gelebt/Interessiert)
         */
        function updateStatusButtons() {
            document.querySelectorAll('[data-status="gelebt"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.gelebt', 'Gelebt');
            });
            document.querySelectorAll('[data-status="interessiert"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.interessiert', 'Interessiert');
            });
        }

        /**
         * Update dimension labels (Geschlecht, Dominanz, Orientierung)
         */
        function updateDimensionLabels() {
            // Update geschlecht type labels
            const geschlechtTypes = ['cis_mann', 'cis_frau', 'trans_mann', 'trans_frau', 'nonbinaer', 'genderfluid', 'agender', 'intersex', 'divers'];
            geschlechtTypes.forEach(type => {
                document.querySelectorAll(`[data-geschlecht="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`geschlecht.types.${type}`, type);
                });
            });

            // Update dominanz type labels
            const dominanzTypes = ['dominant', 'submissiv', 'switch', 'ausgeglichen'];
            dominanzTypes.forEach(type => {
                document.querySelectorAll(`[data-dominanz="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`dominanz.types.${type}`, type);
                });
            });

            // Update orientierung type labels
            const orientierungTypes = ['heterosexuell', 'homosexuell', 'bisexuell'];
            orientierungTypes.forEach(type => {
                document.querySelectorAll(`[data-orientierung="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`orientierung.types.${type}`, type);
                });
            });
        }

        /**
         * Update archetype names
         */
        function updateArchetypeNames() {
            const archetypes = ['single', 'duo', 'duo_flex', 'solopoly', 'polyamor', 'ra', 'lat', 'aromantisch'];
            archetypes.forEach(type => {
                document.querySelectorAll(`[data-archetype-name="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`archetypes.${type}.name`, type);
                });
            });
        }

        /**
         * Update category names (A-F)
         */
        function updateCategoryNames() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            categories.forEach(cat => {
                document.querySelectorAll(`[data-category-name="${cat}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`categories.${cat}`, cat);
                });
            });
        }

        /**
         * Update column headers (DU/YOU, PARTNER)
         */
        function updateColumnHeaders() {
            // Update ICH/YOU column title
            document.querySelectorAll('.ich-column .column-title').forEach(el => {
                el.textContent = TiageI18n.t('columns.you', 'DU');
            });
            // Update PARTNER column title
            document.querySelectorAll('.partner-column .column-title').forEach(el => {
                el.textContent = TiageI18n.t('columns.partner', 'PARTNER');
            });
            // Update navigation button titles
            document.querySelectorAll('.archetype-nav-btn').forEach(btn => {
                const direction = btn.innerHTML.includes('9664') ? 'previous' : 'next';
                btn.title = TiageI18n.t(`columns.${direction}Archetype`, direction === 'previous' ? 'Vorheriger Archetyp' : 'Nächster Archetyp');
            });
            // Update INFO buttons
            document.querySelectorAll('.archetype-info-btn').forEach(btn => {
                btn.title = TiageI18n.t('columns.archetypeInfo', 'Info zum Archetyp');
            });
        }

        /**
         * Update dimension section labels (Geschlechtsidentität, Dominanz, Orientierung)
         */
        function updateDimensionSectionLabels() {
            // Update Geschlechtsidentität labels
            document.querySelectorAll('.geschlecht-info-link').forEach(el => {
                el.textContent = TiageI18n.t('dimensions.geschlechtLabel', 'Geschlechtsidentität');
            });

            // Update Dominanz section labels
            document.querySelectorAll('[data-dimension$="-dominanz-multi"] > .compact-dimension-label > span:first-child').forEach(el => {
                const hint = el.querySelector('span');
                if (hint) {
                    const i = TiageI18n.t('dimensions.legend.identity', 'I');
                    const g = TiageI18n.t('dimensions.legend.secondary', 'G');
                    const iFull = TiageI18n.t('dimensions.legend.identityFull', 'Identität');
                    const gFull = TiageI18n.t('dimensions.legend.secondaryFull', 'Sekundär');
                    el.innerHTML = TiageI18n.t('dimensions.dominanzLabel', 'Dominanz') +
                        ` <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(${i}=${iFull}, ${g}=${gFull})</span>`;
                }
            });

            // Update Orientierung section labels
            document.querySelectorAll('[data-dimension$="-orientierung-multi"] > .compact-dimension-label > span:first-child').forEach(el => {
                const hint = el.querySelector('span');
                if (hint) {
                    const i = TiageI18n.t('dimensions.legend.identity', 'I');
                    const g = TiageI18n.t('dimensions.legend.secondary', 'G');
                    const iFull = TiageI18n.t('dimensions.legend.identityFull', 'Identität');
                    const gFull = TiageI18n.t('dimensions.legend.secondaryFull', 'Sekundär');
                    el.innerHTML = TiageI18n.t('dimensions.orientierungLabel', 'Orientierung') +
                        ` <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(${i}=${iFull}, ${g}=${gFull})</span>`;
                }
            });

            // Update legend (I=Identität, G=Sekundär)
            document.querySelectorAll('.geschlecht-legend').forEach(el => {
                const i = TiageI18n.t('dimensions.legend.identity', 'I');
                const g = TiageI18n.t('dimensions.legend.secondary', 'G');
                const iFull = TiageI18n.t('dimensions.legend.identityFull', 'Identität');
                const gFull = TiageI18n.t('dimensions.legend.secondaryFull', 'Sekundär');
                el.innerHTML = `(<span class="legend-i">${i}</span>=${iFull}, <span class="legend-g">${g}</span>=${gFull})`;
            });
        }

        /**
         * Update geschlecht button labels
         */
        function updateGeschlechtButtons() {
            const geschlechtTypes = ['cis_mann', 'cis_frau', 'trans_mann', 'trans_frau', 'nonbinaer', 'genderfluid', 'agender', 'intersex', 'divers'];
            geschlechtTypes.forEach(type => {
                document.querySelectorAll(`.geschlecht-btn[data-value="${type}"]`).forEach(btn => {
                    // Preserve indicators if present
                    const indicator = btn.querySelector('.geschlecht-indicator');
                    const indicatorHtml = indicator ? indicator.outerHTML : '';
                    btn.innerHTML = TiageI18n.t(`geschlecht.types.${type}`, type) + indicatorHtml;
                });
            });
        }

        /**
         * Update dominanz labels in the multi-select rows
         */
        function updateDominanzLabels() {
            const dominanzTypes = ['dominant', 'submissiv', 'switch', 'ausgeglichen'];
            dominanzTypes.forEach(type => {
                document.querySelectorAll(`.dominanz-label`).forEach(el => {
                    if (el.textContent.toLowerCase().trim() === type ||
                        el.getAttribute('onclick')?.includes(`'${type}'`)) {
                        el.textContent = TiageI18n.t(`dominanz.types.${type}`, type).toLowerCase();
                    }
                });
            });
        }

        /**
         * Update orientierung labels in the multi-select rows
         */
        function updateOrientierungLabels() {
            const orientierungTypes = ['heterosexuell', 'homosexuell', 'bisexuell'];
            orientierungTypes.forEach(type => {
                document.querySelectorAll(`.dominanz-label`).forEach(el => {
                    if (el.textContent.toLowerCase().trim() === type ||
                        el.getAttribute('onclick')?.includes(`'${type}'`)) {
                        el.textContent = TiageI18n.t(`orientierung.types.${type}`, type).toLowerCase();
                    }
                });
            });
        }

        /**
         * Update fold/unfold button text
         */
        function updateFoldUnfoldButton() {
            const btn = document.getElementById('foldUnfoldAllBtn');
            if (btn) {
                const textEl = btn.querySelector('.fold-unfold-text');
                if (textEl) {
                    const isUnfolded = !btn.classList.contains('folded');
                    textEl.textContent = isUnfolded ?
                        TiageI18n.t('foldUnfold.fold', 'Einklappen') :
                        TiageI18n.t('foldUnfold.unfold', 'Ausklappen');
                }
            }
        }

        /**
         * Update help modal content
         */
        function updateHelpModal() {
            // Update title
            const helpTitle = document.querySelector('#helpModal .help-modal-header h2');
            if (helpTitle) {
                helpTitle.textContent = TiageI18n.t('helpModal.title', 'Hilfe & Dokumentation');
            }

            // Update quick guide title
            const quickGuideTitle = document.querySelector('#helpModal .quick-guide h3');
            if (quickGuideTitle) {
                quickGuideTitle.textContent = TiageI18n.t('helpModal.quickGuideTitle', 'Kurzanleitung');
            }

            // Update feedback prompt
            const feedbackPrompt = document.querySelector('#helpModal .comment-section p');
            if (feedbackPrompt) {
                feedbackPrompt.textContent = TiageI18n.t('helpModal.feedbackPrompt', 'Fragen, Feedback oder Verbesserungsvorschläge?');
            }

            // Update comment button
            const commentBtn = document.querySelector('#helpModal .comment-btn');
            if (commentBtn) {
                commentBtn.innerHTML = TiageI18n.t('helpModal.sendComment', 'Kommentar senden');
            }

            // Update view comments button
            const viewCommentsBtn = document.querySelector('#helpModal .view-comments-btn');
            if (viewCommentsBtn) {
                viewCommentsBtn.innerHTML = '📋 ' + TiageI18n.t('helpModal.viewAllComments', 'Alle Kommentare');
            }
        }

        /**
         * Update gender info modal content
         */
        function updateGenderInfoModal() {
            // Update title
            const title = document.querySelector('#geschlechtInfoModal .dimension-tooltip-title');
            if (title) {
                title.textContent = TiageI18n.t('genderInfoModal.title', 'Geschlechtsidentitäten');
            }

            // Update "Verstanden" button
            const understoodBtn = document.querySelector('#geschlechtInfoModal .dimension-tooltip-close');
            if (understoodBtn) {
                understoodBtn.textContent = TiageI18n.t('genderInfoModal.understood', 'Verstanden');
            }

            // Update gender identity items
            const genderTypes = ['cis_mann', 'cis_frau', 'trans_mann', 'trans_frau', 'nonbinaer', 'genderfluid', 'agender', 'intersex', 'divers'];
            const items = document.querySelectorAll('#geschlechtInfoModal .geschlecht-info-item');
            items.forEach((item, index) => {
                if (index < genderTypes.length) {
                    const type = genderTypes[index];
                    const nameEl = item.querySelector('.geschlecht-info-name');
                    const descEl = item.querySelector('.geschlecht-info-desc');
                    const tooltip = TiageI18n.t(`tooltips.${type}`);
                    if (nameEl && tooltip && tooltip.title) {
                        nameEl.textContent = tooltip.title;
                    }
                    if (descEl && tooltip && tooltip.text) {
                        descEl.textContent = tooltip.text;
                    }
                }
            });
        }

        /**
         * Update impressum modal content
         */
        function updateImpressumModal() {
            const modal = document.getElementById('impressumModal');
            if (!modal) return;

            const title = modal.querySelector('h3');
            if (title) {
                title.textContent = TiageI18n.t('impressum.title', 'Impressum');
            }
        }

        /**
         * Update age verification modal content
         */
        function updateAgeVerificationModal() {
            const modal = document.getElementById('ageVerificationModal');
            if (!modal) return;

            const title = modal.querySelector('h2');
            if (title) {
                title.textContent = TiageI18n.t('ageVerification.title', 'Altersverifikation');
            }

            const question = modal.querySelector('.age-verification-question strong');
            if (question) {
                question.textContent = TiageI18n.t('ageVerification.question', 'Bist du mindestens 18 Jahre alt?');
            }

            const yesBtn = modal.querySelector('.age-btn-yes');
            if (yesBtn) {
                yesBtn.textContent = TiageI18n.t('ageVerification.confirm', 'Ja, ich bin 18+');
            }

            const noBtn = modal.querySelector('.age-btn-no');
            if (noBtn) {
                noBtn.textContent = TiageI18n.t('ageVerification.deny', 'Nein');
            }
        }

        /**
         * Get translated tooltip content
         * @param {string} key - The tooltip key (e.g., 'geschlecht', 'dominant')
         * @returns {Object} { title, text }
         */
        function getTranslatedTooltip(key) {
            const tooltip = TiageI18n.t(`tooltips.${key}`);
            if (tooltip && typeof tooltip === 'object') {
                return tooltip;
            }
            return { title: key, text: '' };
        }

        // Subscribe to language changes for automatic updates
        if (typeof TiageI18n !== 'undefined') {
            TiageI18n.subscribe(function(event) {
                updateAllTranslations();
            });
        }

        // Initialize translations on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Update language code display on load
            const langCodeEl = document.getElementById('currentLangCode');
            if (langCodeEl && typeof TiageI18n !== 'undefined') {
                langCodeEl.textContent = TiageI18n.getLanguage().toUpperCase();
            }
            // Run initial translation update (in case browser language was auto-detected to English)
            if (typeof TiageI18n !== 'undefined' && TiageI18n.getLanguage() !== 'de') {
                setTimeout(updateAllTranslations, 100);
            }
        });
    </script>

    <script>
        let data = null;
        let currentArchetype = 'single';
        let selectedPartner = 'duo';

        // Legacy personDimensions - now a reference to TiageState for backward compatibility
        // TODO: Remove after full migration to TiageState
        const personDimensions = {
            ich: {
                geschlecht: {
                    primary: null,    // Primäre Geschlechtsidentität (I)
                    secondary: null   // Sekundäre Geschlechtsidentität (G)
                },
                dominanz: {
                    primary: null,    // Primäre Dominanz (I)
                    secondary: null   // Sekundäre Dominanz (G)
                },
                orientierung: {
                    primary: null,    // Primäre Orientierung (I)
                    secondary: null   // Sekundäre Orientierung (G)
                }
            },
            partner: {
                geschlecht: {
                    primary: null,
                    secondary: null
                },
                dominanz: {
                    primary: null,
                    secondary: null
                },
                orientierung: {
                    primary: null,
                    secondary: null
                }
            }
        };

        // Dimension tooltip content
        const dimensionTooltips = {
            geschlecht: {
                title: "Geschlecht",
                text: "Dein Geschlecht. Dies beeinflusst die körperliche Anziehung zusammen mit der sexuellen Orientierung."
            },
            dominanz: {
                title: "Dominanz-Präferenz",
                text: "Welche Rolle bevorzugst du in der emotionalen und praktischen Beziehungsdynamik?\n\n• <span style=\"color: #e74c3c; font-weight: bold;\">Dominant</span>: Du übernimmst gerne Führung und Verantwortung\n• <span style=\"color: #e74c3c; font-weight: bold;\">Submissiv</span>: Du lässt dich gerne führen und vertraust auf deinen Partner\n• <span style=\"color: #e74c3c; font-weight: bold;\">Switch</span>: Du genießt beide Rollen je nach Situation\n• <span style=\"color: #e74c3c; font-weight: bold;\">Ausgeglichen</span>: Du bevorzugst eine gleichberechtigte Dynamik ohne feste Rollen\n\nDie Dominanz-Harmonie beeinflusst die energetische Dynamik einer Beziehung. Komplementäre Präferenzen (z.B. dominant + submissiv) können starke Anziehung erzeugen."
            },
            orientierung: {
                title: "Sexuelle Orientierung",
                text: "Zu welchem Geschlecht fühlst du dich romantisch und/oder sexuell hingezogen?\n\n• Heterosexuell: Anziehung zum anderen Geschlecht\n• Homosexuell: Anziehung zum gleichen Geschlecht\n• Bisexuell: Anziehung zu beiden Geschlechtern\n\nDie sexuelle Orientierung beeinflusst, ob eine körperliche/romantische Anziehung zwischen zwei Personen möglich ist. Bei inkompatiblen Orientierungen zeigt das Modell dies als Blocker an."
            },
            status: {
                title: "Orientierungs-Status",
                text: "Gelebt: Du lebst diese Orientierung und bist dir sicher.\n\nInteressiert: Du bist neugierig oder in einer Explorationsphase. Die tatsächliche Anziehung ist noch unklar."
            },
            dominanzStatus: {
                title: "Dominanz-Status",
                text: "Gelebt: Du kennst deine Dominanz-Präferenz und lebst sie aktiv. Die Werte des psychologischen Profils treffen mit hoher Wahrscheinlichkeit zu.\n\nInteressiert: Du bist noch am Erkunden oder unsicher über deine Präferenz. Die Konfidenz der Profilaussagen ist reduziert (höhere Varianz in deinem Verhalten).\n\nWissenschaftliche Basis: Big Five Forschung zeigt, dass Menschen in Explorationsphasen konsistent höhere Verhaltensvarianzen aufweisen (McCrae & Costa, 1997)."
            },
            // Einzelne Dominanz-Typen
            dominant: {
                title: "Dominant",
                text: "<strong>Der Führende</strong>\n\nDu übernimmst gerne Führung und Verantwortung in Beziehungen.\n\n<strong>Merkmale:</strong> Assertiv, führend, selbstsicher, bestimmend, proaktiv, entschlossen\n\n<strong>Kommunikation:</strong> Direkt und unverblümt. Konflikte werden aktiv angegangen, nicht vermieden.\n\n<strong>Energie:</strong> Hoch, spontan, leidenschaftlich. Erholt sich schnell von Konflikten.\n\n<em>Pirsig:</em> Dominanz als dynamische Kraft, die statische Muster durchbricht.\n<em>OSHO:</em> Yang-Energie – natürlich wenn sie aus Bewusstsein kommt, nicht aus Ego."
            },
            submissiv: {
                title: "Submissiv",
                text: "<strong>Der Folgende</strong>\n\nDu lässt dich gerne führen und vertraust auf deinen Partner.\n\n<strong>Merkmale:</strong> Anpassungsfähig, folgend, empathisch, dienend, harmonieorientiert, geduldig\n\n<strong>Kommunikation:</strong> Indirekt und diplomatisch. Konflikte werden eher vermieden oder sanft angesprochen.\n\n<strong>Energie:</strong> Mittel, präferiert Planung. Braucht Zeit zur Erholung nach Konflikten.\n\n<em>Pirsig:</em> Submissivität als statisches Muster, das Stabilität schafft.\n<em>OSHO:</em> Yin-Energie – Empfangen ist genauso wertvoll wie Geben."
            },
            switch: {
                title: "Switch",
                text: "<strong>Der Flexible</strong>\n\nDu genießt beide Rollen je nach Situation und Partner.\n\n<strong>Merkmale:</strong> Flexibel, wandelbar, vielseitig, situativ, kommunikativ, experimentierfreudig\n\n<strong>Kommunikation:</strong> Situativ angepasst – kann sowohl direkt als auch diplomatisch sein.\n\n<strong>Energie:</strong> Hoch und flexibel. Kann sich schnell an verschiedene Situationen anpassen.\n\n<em>Pirsig:</em> Balance zwischen statisch und dynamisch – höchste Adaptivität.\n<em>OSHO:</em> Die Vereinigung von Yin und Yang. Der erleuchtete Mensch trägt beide Polaritäten."
            },
            ausgeglichen: {
                title: "Ausgeglichen",
                text: "<strong>Der Zentrierte</strong>\n\nDu bevorzugst eine gleichberechtigte Dynamik ohne feste Rollen.\n\n<strong>Merkmale:</strong> Balanciert, harmonisch, stabil, ruhig, besonnen, gemäßigt\n\n<strong>Kommunikation:</strong> Ruhig und konstruktiv. Feedback ist ausgewogen zwischen direkt und diplomatisch.\n\n<strong>Energie:</strong> Mittel und stabil – weder übermäßig spontan noch übermäßig planend.\n\n<em>Pirsig:</em> Wahre Balance zwischen statisch und dynamisch.\n<em>OSHO:</em> Jenseits von Yin und Yang – die transzendierte Mitte."
            },
            // Einzelne Orientierungen
            heterosexuell: {
                title: "Heterosexuell",
                text: "<strong>Anziehung zum anderen Geschlecht</strong>\n\nDu fühlst dich romantisch und/oder sexuell zu Menschen des anderen Geschlechts hingezogen.\n\n<strong>Forschung:</strong> Die häufigste sexuelle Orientierung. Studien zeigen tendentiell traditionellere Wertorientierung."
            },
            homosexuell: {
                title: "Homosexuell",
                text: "<strong>Anziehung zum gleichen Geschlecht</strong>\n\nDu fühlst dich romantisch und/oder sexuell zu Menschen des gleichen Geschlechts hingezogen.\n\n<strong>Forschung:</strong> Höhere Offenheit für neue Erfahrungen (Allen et al., 2020). Tendentiell weniger traditionelle Wertorientierung."
            },
            bisexuell: {
                title: "Bisexuell",
                text: "<strong>Anziehung zu beiden Geschlechtern</strong>\n\nDu fühlst dich romantisch und/oder sexuell zu Menschen beider Geschlechter hingezogen.\n\n<strong>Forschung:</strong> Höchste Offenheit aller Orientierungen (Allen et al., 2020). Am experimentierfreudigsten und am wenigsten traditionell."
            }
        };

        const icons = {
            single: '★',
            duo: '♡',
            duo_flex: '⚡',
            solopoly: '◆',
            polyamor: '♥',
            ra: '∞',
            lat: '⌂',
            aromantisch: '◇'
        };

        const categoryNames = {
            A: 'Beziehungsphilosophie',
            B: 'Werte-Alignment',
            C: 'Nähe-Distanz',
            D: 'Autonomie',
            E: 'Kommunikation',
            F: 'Soziale Kompatibilität'
        };

        // ═══════════════════════════════════════════════════════════════════════
        // MICRO-STATEMENTS DATABASE für dynamische Text-Generierung
        // Philosophische Grundlage: Pirsig (MOQ) + OSHO
        // ═══════════════════════════════════════════════════════════════════════

        const archetypeStatements = {
            "single_single": {
                pathos: {
                    gemeinsam: ["Zwei Seelen, die dieselbe Sprache der Freiheit sprechen.", "Die gegenseitige Anerkennung der Unabhängigkeit schafft Respekt."],
                    spannung: ["Ohne Polarität fehlt die magnetische Kraft der Anziehung.", "Die Freiheit wird zum Gefängnis, wenn niemand sie herausfordert."]
                },
                logos: {
                    gemeinsam: ["Strukturell identisch: Beide priorisieren Autonomie über Bindung.", "Keine fundamentalen Konflikte, da keine fundamentalen Erwartungen."],
                    unterschied: ["Individuelle Unterschiede in Lebensphasen können variieren."]
                },
                pro: ["Identische Beziehungsphilosophie", "Gegenseitiger Respekt für Autonomie", "Keine unerfüllbaren Erwartungen", "Freiheit bleibt erhalten"],
                contra: ["Fehlende Polarität", "Keiner gibt Impuls zur Vertiefung", "Risiko der Unverbindlichkeit"]
            },
            "single_duo": {
                pathos: {
                    gemeinsam: ["Der Single spürt die Wärme der Geborgenheit, die das Duo bietet."],
                    spannung: ["Die Angst vor Vereinnahmung trifft auf das Bedürfnis nach Verschmelzung.", "Freiheitsdrang kollidiert mit Exklusivitätserwartung."]
                },
                logos: {
                    unterschied: ["Fundamentaler Konflikt: Unabhängigkeit vs. Exklusivität", "Single sieht Beziehung als Option, Duo als Notwendigkeit."]
                },
                pro: ["Duo bietet Stabilität", "Potenzial für transformative Erfahrung"],
                contra: ["Fundamentaler Konflikt: Freiheit vs. Exklusivität", "Single fühlt sich eingeengt", "Duo fühlt sich nicht priorisiert", "Keine gemeinsame Beziehungsvision"]
            },
            "single_duo_flex": {
                pathos: {
                    gemeinsam: ["Duo-Flex versteht die Sehnsucht nach Freiheit – zumindest teilweise."],
                    spannung: ["Die 'Flex'-Komponente reicht dem Single oft nicht aus.", "Single kann sich als 'der Außenseiter' fühlen."]
                },
                logos: {
                    gemeinsam: ["Duo-Flex zeigt Offenheit für alternative Modelle."],
                    unterschied: ["Single will keine Hierarchie, Duo-Flex hat eine eingebaute."]
                },
                pro: ["Situative Nähe möglich", "Keine Erwartung an vollständige Bindung"],
                contra: ["Single ist strukturell 'zweite Wahl'", "Primärbeziehung hat immer Vorrang", "Emotionale Asymmetrie"]
            },
            "single_solopoly": {
                pathos: {
                    gemeinsam: ["Tiefe Resonanz auf der Ebene der Autonomie.", "Beide schätzen Freiheit als höchsten Wert."],
                    spannung: ["Solopoly erwartet Beziehungsarbeit, die der Single meidet."]
                },
                logos: {
                    gemeinsam: ["Beide lehnen traditionelle Beziehungsmodelle ab.", "Autonomie ist das gemeinsame Fundament."],
                    unterschied: ["Solopoly hat multiple Beziehungen, Single oft keine."]
                },
                pro: ["Maximale Übereinstimmung in Autonomie", "Keine Hierarchie-Problematik", "Beziehung als Bereicherung"],
                contra: ["Single könnte von Aktivität überfordert sein", "Asymmetrische Beziehungsbereitschaft"]
            },
            "single_polyamor": {
                pathos: {
                    gemeinsam: ["Single spürt die Wärme der polyamoren Community."],
                    spannung: ["Die strukturierte Komplexität überfordert den Single."]
                },
                logos: {
                    unterschied: ["Polyamor ist hochstrukturiert, Single sucht Einfachheit.", "Kommunikationsintensität radikal unterschiedlich."]
                },
                pro: ["Keine Exklusivitätserwartung", "Community kann bereichernd sein"],
                contra: ["Hoher Kommunikationsaufwand überfordert", "Kalendermanagement unattraktiv"]
            },
            "duo_single": {
                pathos: {
                    spannung: ["Die Angst, nicht genug zu sein für jemanden, der alles haben kann.", "Der Wunsch nach Exklusivität trifft auf Mauern."]
                },
                logos: {
                    unterschied: ["Fundamentale Inkompatibilität der Beziehungsmodelle.", "Duo braucht Commitment, Single meidet es."]
                },
                pro: ["Potenzial für transformative Erfahrung"],
                contra: ["Duo investiert mehr als zurückkommt", "Single erwidert Exklusivität nicht", "Herzschmerz vorprogrammiert"]
            },
            "duo_duo": {
                pathos: {
                    gemeinsam: ["Zwei Seelen, die dasselbe suchen: Ankommen, Verschmelzen, Heimat.", "Exklusivität als gemeinsame Sprache der Liebe."],
                    spannung: ["Hohe Erwartungen können zu hohem Druck führen."]
                },
                logos: {
                    gemeinsam: ["Strukturell perfekt abgestimmt.", "Gesellschaftlich maximal unterstützt.", "Gemeinsame Lebensplanung ist selbstverständlich."]
                },
                pro: ["Identische Beziehungsphilosophie", "Maximale gesellschaftliche Akzeptanz", "Klare, geteilte Erwartungen", "Rechtliche Absicherung möglich"],
                contra: ["Hohe Erwartungen können zu Druck führen", "Eine Person muss alle Bedürfnisse erfüllen"]
            },
            "duo_duo_flex": {
                pathos: {
                    gemeinsam: ["Das Duo erkennt im Duo-Flex einen nahen Verwandten."],
                    spannung: ["Die 'Flex'-Komponente verunsichert das Duo.", "Duo fürchtet: 'Bin ich nicht genug?'"]
                },
                logos: {
                    gemeinsam: ["Beide priorisieren eine Primärbeziehung."],
                    unterschied: ["Die 'Flex'-Option ist für das Duo ein No-Go."]
                },
                pro: ["Grundverständnis für Primärbeziehungs-Priorität", "Ähnliche Vorstellungen von Stabilität"],
                contra: ["Duo erlebt Flex-Öffnung als Vertrauensbruch", "Unterschiedliche Treue-Definitionen", "Eifersucht vorprogrammiert"]
            },
            "duo_solopoly": {
                pathos: {
                    spannung: ["Das Duo fühlt sich als Option, nicht als Priorität.", "Tiefe Verunsicherung durch Gleichwertigkeit anderer Beziehungen."]
                },
                logos: {
                    unterschied: ["Fundamentale Inkompatibilität: Exklusivität vs. Gleichwertigkeit.", "Zusammenleben ist für Solopoly ausgeschlossen."]
                },
                pro: ["Solopoly bietet klare Kommunikation"],
                contra: ["Duo fühlt sich als 'einer von vielen'", "Keine Sonderstellung möglich", "Kein Zusammenleben möglich"]
            },
            "duo_polyamor": {
                pathos: {
                    gemeinsam: ["Beide schätzen tiefe emotionale Verbindungen."],
                    spannung: ["Das Duo kann die geteilte Aufmerksamkeit nicht ertragen."]
                },
                logos: {
                    gemeinsam: ["Beide schätzen Kommunikation und Verbindlichkeit."],
                    unterschied: ["Exklusivität vs. ethische Nicht-Exklusivität."]
                },
                pro: ["Beide schätzen emotionale Tiefe", "Kommunikation ist beiden wichtig"],
                contra: ["Duo erlebt geteilte Aufmerksamkeit als Verrat", "Eifersucht unvermeidlich"]
            },
            "duo_flex_single": {
                pathos: {
                    gemeinsam: ["Duo-Flex erkennt im Single den Freiheitsdrang."],
                    spannung: ["Single könnte die Primärbeziehung bedrohen."]
                },
                logos: {
                    gemeinsam: ["Beide haben ein gewisses Maß an Flexibilität."],
                    unterschied: ["Single will keine zweite Wahl sein."]
                },
                pro: ["Gemeinsames Verständnis für Flexibilität", "Single kann bereichernde Begegnungen bieten"],
                contra: ["Single könnte mehr wollen", "Hierarchie-Problem", "Single fühlt sich als 'Spielzeug'"]
            },
            "duo_flex_duo": {
                pathos: {
                    gemeinsam: ["Grundverständnis für die Wichtigkeit einer Primärbeziehung."],
                    spannung: ["Duo kann die Flex-Öffnung nicht akzeptieren."]
                },
                logos: {
                    gemeinsam: ["Ähnliche Strukturen mit einer Hauptbeziehung."],
                    unterschied: ["Was für Duo-Flex 'Flexibilität' ist, ist für Duo 'Betrug'."]
                },
                pro: ["Gemeinsame Wertschätzung von Primärbeziehungen", "Duo-Flex könnte exklusiver werden"],
                contra: ["Duo erlebt Flex-Anteil als Vertrauensbruch", "Konstantes Konfliktpotenzial"]
            },
            "duo_flex_duo_flex": {
                pathos: {
                    gemeinsam: ["Perfekte Resonanz: Beide verstehen den Balanceakt.", "Die Suche nach dem Besten aus beiden Welten verbindet."],
                    spannung: ["Konkurrenz um Flex-Partner kann entstehen."]
                },
                logos: {
                    gemeinsam: ["Identische Struktur: Primärbeziehung + situative Öffnung.", "Gemeinsames Regelwerk ist verhandelbar."]
                },
                pro: ["Identische Beziehungsphilosophie", "Gegenseitiges Verständnis für Öffnungen", "Symmetrische Freiheiten"],
                contra: ["Eifersucht kann trotzdem auftreten", "Flex-Regeln müssen ständig verhandelt werden"]
            },
            "duo_flex_solopoly": {
                pathos: {
                    gemeinsam: ["Beide schätzen Flexibilität und Offenheit."],
                    spannung: ["Solopoly lehnt Hierarchien ab, Duo-Flex basiert darauf."]
                },
                logos: {
                    unterschied: ["Hierarchie vs. Gleichwertigkeit ist der Kernkonflikt."]
                },
                pro: ["Gemeinsame Offenheit für nicht-exklusive Beziehungen", "Kommunikation über Grenzen ist beiden vertraut"],
                contra: ["Solopoly gibt keinen Primary-Status", "Duo-Flex will mehr Sicherheit als Solopoly bietet"]
            },
            "duo_flex_polyamor": {
                pathos: {
                    gemeinsam: ["Beide kennen die Komplexität von Mehrfachbeziehungen."],
                    spannung: ["Unterschiedliche Tiefe der Nicht-Primär-Beziehungen."]
                },
                logos: {
                    gemeinsam: ["Beide arbeiten mit Regeln und Absprachen."],
                    unterschied: ["Polyamor's Secondary-Beziehungen sind tiefer als Duo-Flex's Flex-Kontakte."]
                },
                pro: ["Gemeinsame Wertschätzung von Kommunikation und Struktur", "Regeln und Grenzen sind beiden vertraut"],
                contra: ["Unterschiedliche Tiefe der Nebenbeziehungen", "Zeitmanagement ist herausfordernd"]
            },
            "solopoly_single": {
                pathos: {
                    gemeinsam: ["Tiefe Verwandtschaft im Autonomie-Bedürfnis.", "Beide verstehen: 'Ich gehöre mir selbst.'"],
                    spannung: ["Solopoly erwartet Beziehungsarbeit, die der Single meidet."]
                },
                logos: {
                    gemeinsam: ["Beide priorisieren Selbstständigkeit über Verschmelzung."],
                    unterschied: ["Solopoly führt aktiv Beziehungen, Single nicht unbedingt."]
                },
                pro: ["Maximale Übereinstimmung bei Autonomie", "Keine Verschmelzungserwartung"],
                contra: ["Single könnte Aktivität nicht erwidern", "Asymmetrische Beziehungsbereitschaft"]
            },
            "solopoly_duo": {
                pathos: {
                    spannung: ["Duo's Exklusivitätsbedürfnis kollidiert mit Solopoly's Lebensmodell.", "Das Duo wird immer mehr wollen."]
                },
                logos: {
                    unterschied: ["Fundamentale Inkompatibilität der Beziehungsmodelle.", "Zusammenleben ist für Solopoly ausgeschlossen."]
                },
                pro: ["Duo könnte von Solopoly's Klarheit lernen"],
                contra: ["Strukturelle Inkompatibilität", "Duo erwartet Exklusivität", "Herzschmerz wahrscheinlich"]
            },
            "solopoly_duo_flex": {
                pathos: {
                    gemeinsam: ["Beide kennen nicht-exklusive Beziehungen."],
                    spannung: ["Duo-Flex erwartet Hierarchie, Solopoly gibt keine."]
                },
                logos: {
                    unterschied: ["Hierarchie vs. Gleichwertigkeit."]
                },
                pro: ["Gemeinsame Erfahrung mit nicht-exklusiven Beziehungen", "Potenzial für bereichernde Verbindung"],
                contra: ["Duo-Flex erwartet Sonderstellung, die Solopoly nicht gibt"]
            },
            "solopoly_solopoly": {
                pathos: {
                    gemeinsam: ["Perfekte Spiegelung: Beide verstehen zutiefst, was der andere braucht.", "Freiheit als höchster Wert – geteilt und respektiert.", "Liebe als Geschenk, nicht als Forderung."],
                    spannung: ["Beide sind so autonom, dass manchmal niemand Initiative ergreift."]
                },
                logos: {
                    gemeinsam: ["Identische Beziehungsphilosophie.", "Keine Hierarchie-Diskussionen nötig."]
                },
                pro: ["Maximale philosophische Übereinstimmung", "Gegenseitiger Respekt für Autonomie", "Keine Hierarchie-Konflikte"],
                contra: ["Manchmal fehlt Initiative für Vertiefung", "Zu viel Distanz möglich"]
            },
            "solopoly_polyamor": {
                pathos: {
                    gemeinsam: ["Beide teilen polyamore Werte: Ehrlichkeit, Kommunikation, Consent."],
                    spannung: ["Hierarchie-Differenzen können belasten."]
                },
                logos: {
                    gemeinsam: ["Beide reflektieren bewusst über ihre Beziehungsform."],
                    unterschied: ["Solopoly lehnt Hierarchien ab, Polyamor hat oft Primary/Secondary."]
                },
                pro: ["Gemeinsame polyamore Grundwerte", "Hohe Kommunikationskompetenz beiderseits"],
                contra: ["Hierarchie-Diskussionen unvermeidlich", "Solopoly will keine Primary-Position"]
            },
            "polyamor_single": {
                pathos: {
                    gemeinsam: ["Polyamor kann dem Single Wärme bieten ohne Exklusivitätsdruck."],
                    spannung: ["Single meidet die Komplexität, die Polyamor mitbringt."]
                },
                logos: {
                    unterschied: ["Polyamor ist hochstrukturiert, Single sucht Einfachheit."]
                },
                pro: ["Keine Exklusivitätserwartung", "Community kann unterstützend sein"],
                contra: ["Single wird von Kommunikationsintensität überfordert", "Polyamor's Struktur ist zu viel"]
            },
            "polyamor_duo": {
                pathos: {
                    gemeinsam: ["Beide schätzen tiefe emotionale Verbindungen."],
                    spannung: ["Duo's Eifersucht ist für Polyamor frustrierend."]
                },
                logos: {
                    unterschied: ["Exklusivität vs. ethische Mehrfachbeziehungen."]
                },
                pro: ["Beide schätzen emotionale Tiefe", "Duo könnte als Primary Sicherheit finden"],
                contra: ["Duo kann Nicht-Exklusivität nicht akzeptieren", "Eifersucht unvermeidlich"]
            },
            "polyamor_duo_flex": {
                pathos: {
                    gemeinsam: ["Beide kennen die Komplexität von Mehrfachbeziehungen."],
                    spannung: ["Tiefe der Nebenbeziehungen unterscheidet sich."]
                },
                logos: {
                    gemeinsam: ["Beide arbeiten mit Regeln und Strukturen."]
                },
                pro: ["Gemeinsames Verständnis für strukturierte Offenheit", "Potenzial für komplementäre Verbindung"],
                contra: ["Tiefe-Unterschiede der Nebenbeziehungen", "Unterschiedliche Zeit-Investments"]
            },
            "polyamor_solopoly": {
                pathos: {
                    gemeinsam: ["Tiefe Verwandtschaft in polyamoren Werten."],
                    spannung: ["Solopoly lehnt ab, was Polyamor praktiziert: Primary/Secondary."]
                },
                logos: {
                    gemeinsam: ["Beide reflektieren bewusst über Beziehungsformen."],
                    unterschied: ["Hierarchie vs. Gleichwertigkeit."]
                },
                pro: ["Gemeinsame polyamore Grundwerte", "Ethische Grundlage ist identisch"],
                contra: ["Hierarchie-Diskussionen unvermeidlich", "Strukturkonflikte möglich"]
            },
            "polyamor_polyamor": {
                pathos: {
                    gemeinsam: ["Perfekte Resonanz: Beide sprechen dieselbe Sprache der Liebe.", "Tiefe Liebe zu Mehreren ist natürlich und verstanden.", "Compersion ist beidseitig möglich."],
                    spannung: ["Manchmal Überforderung durch die vielen emotionalen Fäden."]
                },
                logos: {
                    gemeinsam: ["Identische Beziehungsphilosophie.", "Beide verstehen Hierarchien, Agreements, Kommunikationsstrukturen."]
                },
                pro: ["Maximale philosophische Übereinstimmung", "Identisches Beziehungsmodell", "Compersion beiderseits möglich", "Keine Erklärungen nötig"],
                contra: ["Hoher Koordinationsaufwand", "Kalenderkomplexität verdoppelt sich", "Viele emotionale Fäden"]
            }
        };

        const dominanceStatements = {
            "dominant_submissiv": { score: 100, pathos: ["Die perfekte Polarität: Führung trifft auf Hingabe.", "OSHO's Weisheit manifestiert sich hier – Extreme ziehen sich an.", "Eine magnetische Kraft entsteht aus der Gegensätzlichkeit."], logos: ["Komplementarität führt zu höherer Sympathie (Tiedens & Fragale, 2003).", "Klare Rollenverteilung minimiert Entscheidungskonflikte."], pro: ["Optimale Rollenverteilung", "Natürliche Dynamik", "Hohe gegenseitige Anziehung", "Wissenschaftlich belegte höhere Zufriedenheit"], contra: ["Balance muss bewusst gehalten werden"] },
            "submissiv_dominant": { score: 100, pathos: ["Hingabe trifft auf Führung – eine tiefe Resonanz.", "Das Vertrauen, sich führen zu lassen, schafft Intimität."], logos: ["Komplementäre Dynamik ist strukturell am stabilsten."], pro: ["Natürliche Harmonie", "Klare Rollenverteilung", "Tiefes Vertrauen möglich"], contra: ["Abhängigkeitsdynamiken müssen reflektiert werden"] },
            "ausgeglichen_ausgeglichen": { score: 95, pathos: ["Zwei Seelen in Balance – ein stiller Tanz der Gleichheit.", "Harmonie durch gemeinsame Mitte."], logos: ["Flexible Dynamik ohne starre Hierarchie.", "Entscheidungen werden gemeinsam getroffen."], pro: ["Gleichberechtigte Partnerschaft", "Flexible Rollenverteilung", "Keine Machtkämpfe erwartet", "Stabile Grunddynamik"], contra: ["Manchmal fehlt klare Führung", "Weniger 'Feuer' durch fehlende Polarität"] },
            "switch_switch": { score: 90, pathos: ["Spielerische Dynamik – heute führst du, morgen ich.", "Die Freude am Rollenwechsel verbindet."], logos: ["Hohe Anpassungsfähigkeit auf beiden Seiten."], pro: ["Vielfalt in der Dynamik", "Gegenseitiges Verständnis für Rollenwechsel", "Hohe Flexibilität"], contra: ["Manchmal unklar, wer gerade führt", "Koordination nötig"] },
            "switch_ausgeglichen": { score: 88, pathos: ["Flexibilität trifft auf Balance."], logos: ["Switch kann sich an die Balance anpassen."], pro: ["Hohe Anpassungsfähigkeit", "Ausgeglichener bietet Stabilität"], contra: ["Switch könnte manchmal mehr Polarität vermissen"] },
            "ausgeglichen_switch": { score: 88, pathos: ["Balance begegnet Vielseitigkeit."], logos: ["Beide können sich situativ anpassen."], pro: ["Hohe gegenseitige Anpassungsfähigkeit", "Flexible Rollenverteilung"], contra: ["Manchmal unklar, wer führt"] },
            "dominant_ausgeglichen": { score: 85, pathos: ["Führung trifft auf Gelassenheit."], logos: ["Dominanter gibt Richtung, Ausgeglichener stabilisiert."], pro: ["Klare Führung mit stabilem Fundament", "Harmonische Grunddynamik"], contra: ["Dominanter könnte mehr Polarität vermissen"] },
            "ausgeglichen_dominant": { score: 85, pathos: ["Balance begegnet Stärke."], logos: ["Strukturell kompatibel."], pro: ["Harmonische Dynamik möglich", "Ausgeglichener behält Autonomie"], contra: ["Dominanter könnte mehr Gegenpol vermissen"] },
            "submissiv_ausgeglichen": { score: 85, pathos: ["Hingabebereitschaft trifft auf sanfte Führung."], logos: ["Ausgeglichener kann situativ Führung übernehmen."], pro: ["Sanfte Führungsdynamik", "Submissiver fühlt sich sicher"], contra: ["Submissiver könnte stärkere Führung vermissen"] },
            "ausgeglichen_submissiv": { score: 85, pathos: ["Balance kann sanft führen."], logos: ["Ausgeglichener kann Führung übernehmen wenn nötig."], pro: ["Weiche, liebevolle Dynamik"], contra: ["Submissiver könnte klarere Führung wünschen"] },
            "switch_dominant": { score: 80, pathos: ["Flexibilität begegnet fester Führung."], logos: ["Switch kann submissive Rolle übernehmen."], pro: ["Switch kann sich anpassen", "Dominanter bekommt oft Führungsrolle"], contra: ["Switch könnte eigene dominante Seite vermissen", "Potenzial für Frustration"] },
            "dominant_switch": { score: 80, pathos: ["Führung trifft auf Vielseitigkeit."], logos: ["Switch's dominante Phasen können Konflikte schaffen."], pro: ["Grunddynamik kann funktionieren"], contra: ["Machtkonflikte wenn Switch dominant sein will"] },
            "switch_submissiv": { score: 80, pathos: ["Vielseitigkeit begegnet Hingabe."], logos: ["Switch kann dominant sein wenn nötig."], pro: ["Switch kann führen", "Flexibilität kann bereichernd sein"], contra: ["Inkonsistenz kann verunsichern", "Submissiver wünscht sich beständigere Dominanz"] },
            "submissiv_switch": { score: 80, pathos: ["Hingabe trifft auf Wechselhaftigkeit."], logos: ["Inkonsistenz kann strukturell herausfordernd sein."], pro: ["Grunddynamik kann funktionieren"], contra: ["Inkonsistenz kann frustrieren", "Führungsvakuum in Switch's submissiven Phasen"] },
            "dominant_dominant": { score: 55, pathos: ["Zwei Alphas treffen aufeinander – Funken fliegen.", "Machtkampf ist unvermeidlich, aber auch aufregend.", "Die Energie ist hoch, aber die Reibung auch."], logos: ["Sadikaj et al. (2017): Gleiche hohe Dominanz korreliert mit niedrigerer Zufriedenheit.", "Strukturelles Problem: Zwei Führer, keine Folger."], pro: ["Starke Persönlichkeiten können sich inspirieren", "Hohe Energie"], contra: ["Machtkämpfe unvermeidlich", "Wissenschaftlich belegte niedrigere Zufriedenheit", "Entscheidungskonflikte vorprogrammiert", "Bewusste Regeln erforderlich"] },
            "submissiv_submissiv": { score: 55, pathos: ["Zwei, die auf Führung warten – wer beginnt?", "Führungsvakuum kann lähmend wirken.", "Die Sehnsucht nach Führung bleibt unerfüllt."], logos: ["Strukturelles Führungsvakuum.", "Entscheidungsprozesse können stagnieren."], pro: ["Keine Machtkämpfe", "Harmonische, sanfte Grundstimmung", "Gegenseitige Empathie"], contra: ["Führungsvakuum", "Stagnation in Entscheidungsprozessen", "Beide warten auf Initiative des anderen", "Externe Struktur oft nötig"] },
            "default": { score: 75, pathos: ["Die Dominanz-Dynamik ist noch nicht vollständig erkennbar."], logos: ["Standardwert wird verwendet bis alle Dimensionen ausgewählt sind."], pro: ["Neutrale Ausgangssituation"], contra: ["Unvollständige Information"] }
        };

        // Orientierungs-Statements für Pathos/Logos
        // Berücksichtigt Orientierung UND Geschlecht für realistische Kompatibilität
        const orientierungStatements = {
            // Kompatible Kombinationen
            "kompatibel_hetero_hetero": {
                score: 95,
                pathos: ["Die heterosexuelle Anziehung ist beidseitig und natürlich.", "Körperliche und emotionale Chemie kann frei fließen."],
                logos: ["Klassische Konstellation mit klarer gegenseitiger Anziehungsbasis."],
                pro: ["Natürliche gegenseitige Anziehung", "Gesellschaftlich etabliert"],
                contra: ["Keine besonderen Herausforderungen durch Orientierung"]
            },
            "kompatibel_homo_homo": {
                score: 95,
                pathos: ["Die homosexuelle Anziehung verbindet auf einer tiefen Ebene.", "Gemeinsames Verständnis der eigenen Identität schafft Nähe."],
                logos: ["Gleiche Orientierung ermöglicht authentische Verbindung."],
                pro: ["Tiefes gegenseitiges Verständnis", "Gemeinsame Erfahrungswelt"],
                contra: ["Gesellschaftliche Herausforderungen möglich"]
            },
            "kompatibel_bi_hetero": {
                score: 85,
                pathos: ["Anziehung ist vorhanden, auch wenn die Spektren unterschiedlich breit sind.", "Der bisexuelle Partner kann sich voll einlassen."],
                logos: ["Funktionale Kompatibilität gegeben, aber unterschiedliche Erfahrungswelten."],
                pro: ["Grundlegende Anziehung vorhanden", "Bisexueller bringt Offenheit mit"],
                contra: ["Heterosexueller versteht bi-Erfahrung nicht vollständig", "Teile der bi-Identität bleiben unausgelebt"]
            },
            "kompatibel_bi_homo": {
                score: 85,
                pathos: ["Anziehung ist da, aber die Wege dorthin waren unterschiedlich.", "Gemeinsame queere Erfahrungen können verbinden."],
                logos: ["Kompatibilität gegeben, unterschiedliche Identitätserfahrungen."],
                pro: ["Gemeinsame queere Perspektive", "Gegenseitiges Verständnis für Nicht-Heteronormativität"],
                contra: ["Bi-Identität wird manchmal in Frage gestellt", "Unterschiedliche Community-Erfahrungen"]
            },
            "kompatibel_bi_bi": {
                score: 95,
                pathos: ["Maximale Flexibilität trifft auf maximales Verständnis.", "Beide kennen die Komplexität fluider Anziehung."],
                logos: ["Tiefes gegenseitiges Verständnis der bi-Erfahrung.", "Keine Teile der Identität müssen versteckt werden."],
                pro: ["Vollständiges Verständnis der bi-Erfahrung", "Maximale Offenheit", "Keine Identitätsaspekte werden unterdrückt"],
                contra: ["Gesellschaftliche Bi-Erasure betrifft beide"]
            },
            // Inkompatible Kombinationen
            "inkompatibel_hetero_hetero": {
                score: 15,
                pathos: ["Keine sexuelle Anziehung möglich – beide orientieren sich zum anderen Geschlecht.", "Freundschaft ja, romantische Verbindung nein."],
                logos: ["Strukturelle Inkompatibilität: Beide suchen das jeweils andere Geschlecht."],
                pro: ["Tiefe Freundschaft möglich"],
                contra: ["Keine romantische/sexuelle Basis", "Fundamentale Orientierungsdiskrepanz"]
            },
            "inkompatibel_homo_homo": {
                score: 15,
                pathos: ["Die Orientierung weist in entgegengesetzte Richtungen.", "Emotionale Nähe möglich, sexuelle Anziehung nicht."],
                logos: ["Strukturelle Inkompatibilität durch gegenläufige Orientierung."],
                pro: ["Verständnis füreinander als queere Menschen"],
                contra: ["Keine romantische/sexuelle Basis", "Orientierung zeigt zu unterschiedlichen Geschlechtern"]
            },
            "inkompatibel_hetero_homo": {
                score: 10,
                pathos: ["Die Anziehungskräfte gehen aneinander vorbei.", "Was der eine sucht, kann der andere nicht bieten."],
                logos: ["Maximale strukturelle Inkompatibilität.", "Keine gemeinsame Anziehungsbasis vorhanden."],
                pro: ["Freundschaft auf anderen Ebenen möglich"],
                contra: ["Keine romantische/sexuelle Kompatibilität", "Fundamentale Orientierungsdiskrepanz"]
            },
            "teilweise_bi_inkompatibel": {
                score: 40,
                pathos: ["Der bisexuelle Partner könnte angezogen sein, aber es ist nicht gegenseitig.", "Einseitige Anziehung schafft Ungleichgewicht."],
                logos: ["Nur einseitige Anziehung möglich – strukturelles Ungleichgewicht."],
                pro: ["Bisexueller zeigt Offenheit"],
                contra: ["Keine gegenseitige Anziehung", "Einseitiges Interesse führt zu Frustration"]
            },
            // Default
            "default": {
                score: 50,
                pathos: ["Die Orientierungs-Kompatibilität ist noch nicht vollständig erkennbar."],
                logos: ["Standardwert wird verwendet bis Orientierung und Geschlecht ausgewählt sind."],
                pro: ["Neutrale Ausgangssituation"],
                contra: ["Unvollständige Information"]
            }
        };

        // Status-Statements für Pathos/Logos (Pirsig & Osho Perspektive)
        // Berücksichtigt den Sicherheitsgrad beider Personen (gelebt vs. interessiert)
        const statusStatements = {
            // Beide wissen wer sie sind
            "gelebt_gelebt": {
                pathos: [
                    "Zwei gefestigte Seelen begegnen sich – die emotionale Klarheit beider schafft Tiefe.",
                    "Die Sicherheit in der eigenen Identität ermöglicht authentische Begegnung."
                ],
                logos: [
                    "Hohe Qualität durch klare Selbstkenntnis beider Partner (Pirsig).",
                    "Beide wissen, was sie wollen – eine solide Basis für rationale Entscheidungen."
                ],
                modifier: 1.0  // Volle Konfidenz
            },
            // Einer führt, einer exploriert
            "gelebt_interessiert": {
                pathos: [
                    "Klarheit trifft auf Offenheit – Raum für gemeinsames Wachstum entsteht.",
                    "Der eine bietet emotionalen Anker, der andere bringt Neugier mit."
                ],
                logos: [
                    "Qualität im Werden: Der gefestigte Partner kann Orientierung bieten.",
                    "Asymmetrie in der Selbstkenntnis – erfordert Geduld und Kommunikation."
                ],
                modifier: 0.85  // Reduzierte Konfidenz
            },
            // Beide auf Entdeckungsreise
            "interessiert_interessiert": {
                pathos: [
                    "Zwei Suchende auf gemeinsamer Reise – Verbundenheit durch geteilte Unsicherheit.",
                    "Die Offenheit beider kann befreiend sein, aber auch destabilisierend."
                ],
                logos: [
                    "Qualität noch im Fluss – viel Potential, aber unklare Grundlagen.",
                    "Beide explorieren noch – Beziehungsbasis kann sich stark verändern."
                ],
                modifier: 0.7  // Deutlich reduzierte Konfidenz
            },
            // Default
            "default": {
                pathos: ["Der Sicherheitsgrad der Selbstkenntnis ist noch nicht vollständig erkennbar."],
                logos: ["Standardwert wird verwendet bis der Status ausgewählt ist."],
                modifier: 0.8
            }
        };

        // Hilfsfunktion: Hole Statements für Archetyp-Kombination
        function getArchetypeStatements(type1, type2) {
            const key = `${type1}_${type2}`;
            return archetypeStatements[key] || null;
        }

        // Hilfsfunktion: Hole Statements für Dominanz-Kombination
        function getDominanceStatements(dom1, dom2) {
            // Extrahiere primäre Dominanz aus Multi-Select-Objekt
            const getPrimaryDominance = (dom) => {
                if (typeof dom === 'string') return dom;
                if (typeof dom === 'object' && dom !== null) {
                    // Priorität: gelebt > interessiert
                    for (const key of ['dominant', 'submissiv', 'switch', 'ausgeglichen']) {
                        if (dom[key] === 'gelebt') return key;
                    }
                    for (const key of ['dominant', 'submissiv', 'switch', 'ausgeglichen']) {
                        if (dom[key] === 'interessiert') return key;
                    }
                }
                return null;
            };

            const d1 = getPrimaryDominance(dom1);
            const d2 = getPrimaryDominance(dom2);

            if (!d1 || !d2) return dominanceStatements.default;
            const key = `${d1}_${d2}`;
            return dominanceStatements[key] || dominanceStatements.default;
        }

        // Hilfsfunktion: Hole Statements für Orientierungs-Kombination
        // Berücksichtigt Orientierung UND Geschlecht für korrekte Kompatibilitätsbewertung
        function getOrientierungStatements(orient1, orient2, geschlecht1, geschlecht2) {
            // Default wenn Daten fehlen
            if (!orient1 || !orient2 || !geschlecht1 || !geschlecht2) {
                return orientierungStatements.default;
            }

            // Extrahiere primäre Orientierung aus Multi-Select-Objekt
            const getPrimaryOrientation = (orient) => {
                if (typeof orient === 'string') return orient;
                if (typeof orient === 'object') {
                    // Priorität: gelebt > interessiert
                    for (const key of ['heterosexuell', 'homosexuell', 'bisexuell']) {
                        if (orient[key] === 'gelebt') return key;
                    }
                    for (const key of ['heterosexuell', 'homosexuell', 'bisexuell']) {
                        if (orient[key] === 'interessiert') return key;
                    }
                }
                return null;
            };

            const o1 = getPrimaryOrientation(orient1);
            const o2 = getPrimaryOrientation(orient2);

            if (!o1 || !o2) return orientierungStatements.default;

            const gleichesGeschlecht = geschlecht1 === geschlecht2;

            // Bisexuell ist immer grundsätzlich kompatibel
            if (o1 === 'bisexuell' && o2 === 'bisexuell') {
                return orientierungStatements.kompatibel_bi_bi;
            }
            if (o1 === 'bisexuell' || o2 === 'bisexuell') {
                const andereOrient = o1 === 'bisexuell' ? o2 : o1;
                // Prüfe ob der andere zur bi-Person passt
                if (andereOrient === 'heterosexuell') {
                    // Hetero + Bi: kompatibel wenn unterschiedliche Geschlechter
                    if (!gleichesGeschlecht) {
                        return orientierungStatements.kompatibel_bi_hetero;
                    } else {
                        return orientierungStatements.teilweise_bi_inkompatibel;
                    }
                }
                if (andereOrient === 'homosexuell') {
                    // Homo + Bi: kompatibel wenn gleiche Geschlechter
                    if (gleichesGeschlecht) {
                        return orientierungStatements.kompatibel_bi_homo;
                    } else {
                        return orientierungStatements.teilweise_bi_inkompatibel;
                    }
                }
            }

            // Beide heterosexuell
            if (o1 === 'heterosexuell' && o2 === 'heterosexuell') {
                if (!gleichesGeschlecht) {
                    return orientierungStatements.kompatibel_hetero_hetero;
                } else {
                    return orientierungStatements.inkompatibel_hetero_hetero;
                }
            }

            // Beide homosexuell
            if (o1 === 'homosexuell' && o2 === 'homosexuell') {
                if (gleichesGeschlecht) {
                    return orientierungStatements.kompatibel_homo_homo;
                } else {
                    return orientierungStatements.inkompatibel_homo_homo;
                }
            }

            // Hetero + Homo
            if ((o1 === 'heterosexuell' && o2 === 'homosexuell') ||
                (o1 === 'homosexuell' && o2 === 'heterosexuell')) {
                return orientierungStatements.inkompatibel_hetero_homo;
            }

            return orientierungStatements.default;
        }

        // Hilfsfunktion: Hole Statements für Status-Kombination (fakt/interessiert)
        // Bewertet den kombinierten Sicherheitsgrad beider Personen über alle Dimensionen
        function getStatusStatements(personDims1, personDims2) {
            if (!personDims1 || !personDims2) {
                return statusStatements.default;
            }

            // Ermittle den dominanten Status für jede Person
            // Eine Person gilt als "fakt" wenn mindestens eine Dimension als fakt markiert ist
            // und keine als interessiert
            const getPersonStatus = (dims) => {
                let hasFakt = false;
                let hasInteressiert = false;

                // Prüfe Dominanz
                if (dims.dominanz && typeof dims.dominanz === 'object') {
                    for (const key of Object.keys(dims.dominanz)) {
                        if (dims.dominanz[key] === 'gelebt') hasFakt = true;
                        if (dims.dominanz[key] === 'interessiert') hasInteressiert = true;
                    }
                }

                // Prüfe Orientierung
                if (dims.orientierung && typeof dims.orientierung === 'object') {
                    for (const key of Object.keys(dims.orientierung)) {
                        if (dims.orientierung[key] === 'gelebt') hasFakt = true;
                        if (dims.orientierung[key] === 'interessiert') hasInteressiert = true;
                    }
                }

                // Wenn sowohl gelebt als auch interessiert: interessiert dominiert (Unsicherheit)
                if (hasInteressiert) return 'interessiert';
                if (hasFakt) return 'gelebt';
                return null;
            };

            const status1 = getPersonStatus(personDims1);
            const status2 = getPersonStatus(personDims2);

            if (!status1 || !status2) return statusStatements.default;

            // Symmetrische Kombinationen
            if (status1 === 'gelebt' && status2 === 'gelebt') {
                return statusStatements.gelebt_gelebt;
            }
            if (status1 === 'interessiert' && status2 === 'interessiert') {
                return statusStatements.interessiert_interessiert;
            }
            // Asymmetrische Kombination (egal welche Reihenfolge)
            return statusStatements.gelebt_interessiert;
        }

        // Archetype definitions
        const archetypeDefinitions = {
            single: {
                name: "Single",
                shortDef: "Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung als dauerhafte Lebensform.",
                longDef: "Single-orientierte Menschen haben sich aktiv für ein Leben ohne dauerhafte romantische Partnerschaft entschieden. Dies ist keine Übergangsphase ('zwischen Beziehungen'), sondern eine bewusste Lebensform, die Selbstgenügsamkeit und persönliche Autonomie als zentrale Werte sieht. Soziale Kontakte, Freundschaften und gelegentliche romantische/sexuelle Begegnungen sind möglich, aber keine feste Partnerschaft wird angestrebt.",
                keyPrinciples: [
                    "Selbstgenügsamkeit als Wert, nicht als Mangel",
                    "Persönliche Autonomie über Verbindlichkeit",
                    "Beziehungen als Option, nicht als Notwendigkeit",
                    "Erfüllung durch Selbst, Freunde, Projekte"
                ],
                notTheSameAs: [
                    "'Zwischen Beziehungen' sein",
                    "'Noch nicht den Richtigen gefunden'",
                    "Beziehungsunfähig oder bindungsängstlich",
                    "Einsam oder unglücklich"
                ],
                variants: [
                    "Aromantisch-Single: Keine romantischen Gefühle, kein Bedürfnis danach",
                    "Bewusst-autonom: Positive Entscheidung für Freiheit",
                    "Beziehungs-kritisch: Bevorzugt Unabhängigkeit"
                ]
            },
            duo: {
                name: "Duo",
                shortDef: "Traditionelle monogame Zweierbeziehung mit Exklusivität und gemeinsamer Lebensgestaltung als Kernprinzip.",
                longDef: "Duo-orientierte Menschen leben in oder suchen eine klassische Zweierbeziehung mit romantischer und sexueller Exklusivität. Die Partnerschaft steht im Zentrum der Lebensgestaltung und wird als primäre emotionale und soziale Einheit verstanden. Gemeinsame Ziele, Alltag und Zukunftsplanung werden als Paar gestaltet.",
                keyPrinciples: [
                    "Exklusivität als Ausdruck von Verbindlichkeit",
                    "'Wir' als zentrale Einheit über 'Ich'",
                    "Tiefe durch Fokussierung auf eine Person",
                    "Gemeinsame Lebensgestaltung und Zukunftsplanung",
                    "Treue als emotionale und sexuelle Exklusivität"
                ],
                notTheSameAs: [
                    "Besitzdenken oder Kontrolle",
                    "Verlust der eigenen Identität",
                    "'Alte' oder 'überholte' Beziehungsform",
                    "Langweilig oder unerfüllt"
                ],
                variants: [
                    "Traditionell-Duo: Klassisches Ehe-Modell",
                    "Modern-Duo: Ohne Trauschein, flexiblere Rollen",
                    "Intensiv-Duo: Sehr enge emotionale Verschmelzung"
                ]
            },
            duo_flex: {
                name: "Duo-Flex",
                shortDef: "Primäre Zweierbeziehung mit vereinbarten Öffnungen für zusätzliche Kontakte unter klaren Regeln.",
                longDef: "Duo-Flex-orientierte Menschen leben in einer Hauptbeziehung mit einem Primärpartner, öffnen diese aber bewusst und einvernehmlich für weitere Kontakte. Die Primärbeziehung bleibt zentral und privilegiert. Alle Öffnungen erfolgen transparent und nach gemeinsam vereinbarten Regeln.",
                keyPrinciples: [
                    "Primärbeziehung als Anker und Priorität",
                    "Sexuelle/romantische Vielfalt ohne Hierarchie-Aufgabe",
                    "Ehrlichkeit und Transparenz über alle Kontakte",
                    "Regeln schützen die Hauptbeziehung",
                    "Freiheit innerhalb vereinbarter Grenzen"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alles ist abgesprochen!)",
                    "'Beziehung retten' durch Öffnung",
                    "Fehlende Verbindlichkeit",
                    "Übergangsphase zu Polyamorie"
                ],
                variants: [
                    "Swinging/Lifestyle: Gemeinsame sexuelle Erlebnisse",
                    "Open Relationship: Individuelle sexuelle Freiheit",
                    "Hierarchisches Poly: Primärpartner + Nebenbeziehungen"
                ]
            },
            solopoly: {
                name: "Solopoly",
                shortDef: "Mehrere gleichwertige Beziehungen bei bewusster Bewahrung der eigenen Autonomie - keine Primärpartner.",
                longDef: "Solopoly-orientierte Menschen führen mehrere romantische und/oder sexuelle Beziehungen parallel, ohne eine davon als 'Hauptbeziehung' zu priorisieren. Die persönliche Autonomie steht im Zentrum: Kein Zusammenziehen, keine gemeinsame Haushaltsführung. 'Ich bin mein eigener Primärpartner'.",
                keyPrinciples: [
                    "Autonomie als höchster Wert - auch in Beziehungen",
                    "Mehrere gleichwertige Beziehungen ohne Hierarchie",
                    "Keine Verschmelzung oder gemeinsame Haushalte",
                    "'Ich bin mein eigener Primärpartner'",
                    "Liebe ohne Aufgabe der Unabhängigkeit"
                ],
                notTheSameAs: [
                    "Bindungsangst oder Commitment-Probleme",
                    "'Light-Version' von Polyamorie",
                    "Egoistisch oder beziehungsunfähig",
                    "Zwischenstufe zu 'richtiger' Partnerschaft"
                ],
                variants: [
                    "Stark-autonom: Sehr klare Grenzen",
                    "Beziehungs-balanciert: Tiefe Beziehungen, getrennte Wohnungen",
                    "Netzwerk-orientiert: Viele gleichwertige Connections"
                ]
            },
            ra: {
                name: "RA (Relationship Anarchist)",
                shortDef: "Vollständige Ablehnung von Beziehungshierarchien und gesellschaftlichen Normen.",
                longDef: "Relationship Anarchists hinterfragen alle gesellschaftlichen Beziehungsnormen radikal. Keine Beziehung ist 'höher' als eine andere - Freundschaften können genauso wichtig sein wie romantische Beziehungen. Jede Verbindung wird individuell definiert, ohne externe Vorlagen.",
                keyPrinciples: [
                    "Keine Hierarchien zwischen Beziehungstypen",
                    "Jede Beziehung wird individuell definiert",
                    "Ablehnung gesellschaftlicher Beziehungsnormen",
                    "Autonomie als höchster Wert",
                    "Keine Besitzansprüche an andere Menschen"
                ],
                notTheSameAs: [
                    "Beziehungsunfähig oder bindungsscheu",
                    "Chaotisch oder regellos",
                    "Verantwortungslos",
                    "Gegen Commitment generell"
                ],
                variants: [
                    "Anarchisch-vernetzt: Viele gleichwertige Verbindungen",
                    "Philosophisch-RA: Tiefe Reflexion über Normen",
                    "Pragmatisch-RA: Flexible Anwendung der Prinzipien"
                ]
            },
            lat: {
                name: "LAT (Living Apart Together)",
                shortDef: "Feste Partnerschaft mit bewusst getrennten Wohnungen und Alltagsleben.",
                longDef: "LAT-orientierte Menschen wünschen sich tiefe, verbindliche Beziehungen, aber mit klarer räumlicher und alltäglicher Autonomie. Die eigenen vier Wände sind kein Zeichen von Distanz, sondern von gesunder Selbstfürsorge.",
                keyPrinciples: [
                    "Liebe braucht kein gemeinsames Dach",
                    "Eigener Rückzugsraum ist essentiell",
                    "Qualitätszeit über Quantität",
                    "Autonomie im Alltag",
                    "Bewusste Entscheidung für Nähe"
                ],
                notTheSameAs: [
                    "Bindungsangst oder Commitment-Phobie",
                    "Fernbeziehung aus Zwang",
                    "Halbe Beziehung oder weniger ernst",
                    "Übergangsphase zum Zusammenziehen"
                ],
                variants: [
                    "Nachbarschafts-LAT: Getrennte Wohnungen in der Nähe",
                    "Wochenend-LAT: Intensives Zeit-teilen am Wochenende",
                    "Flexibel-LAT: Situative Anpassung der Nähe"
                ]
            },
            aromantisch: {
                name: "Aromantisch",
                shortDef: "Wenig oder keine romantische Anziehung, aber tiefe Verbindungen auf anderen Ebenen.",
                longDef: "Aromantische Menschen erleben wenig bis keine romantische Anziehung zu anderen. Das bedeutet nicht, dass sie keine tiefen Verbindungen haben können - Freundschaften, queerplatonische Beziehungen und andere Formen von Nähe sind möglich und wertvoll.",
                keyPrinciples: [
                    "Romantische Liebe ist nicht die einzige Tiefe",
                    "Freundschaften können primäre Beziehungen sein",
                    "Ehrlichkeit über eigene Grenzen",
                    "Keine Verpflichtung zu romantischen Gefühlen",
                    "Alternative Beziehungsformen werden wertgeschätzt"
                ],
                notTheSameAs: [
                    "Kalt oder gefühllos",
                    "Antisozial oder einsam",
                    "Noch nicht die richtige Person gefunden",
                    "Psychische Störung oder Defizit"
                ],
                variants: [
                    "Greyromantisch: Seltene romantische Anziehung",
                    "Demiromantisch: Romantik nur nach tiefer Bindung",
                    "Queerplatonisch: Tiefe nicht-romantische Primärbeziehungen"
                ]
            },
            polyamor: {
                name: "Polyamor",
                shortDef: "Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen mit Transparenz und emotionalem Commitment.",
                longDef: "Polyamor-orientierte Menschen führen mehrere romantische Beziehungen parallel, die alle auf Ehrlichkeit, Einvernehmlichkeit und Transparenz basieren. Tiefe Verschmelzung, Zusammenleben und gemeinsame Zukunftsplanung mit mehreren Partnern sind möglich und erwünscht. Alle Beteiligten wissen voneinander.",
                keyPrinciples: [
                    "Liebe ist nicht begrenzt oder exklusiv",
                    "Ehrlichkeit und Transparenz gegenüber allen",
                    "Konsens und Einvernehmlichkeit als Basis",
                    "Emotionale Tiefe zu mehreren Menschen",
                    "Kommunikation als zentrale Kompetenz"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alle wissen Bescheid!)",
                    "Bindungsunfähigkeit",
                    "Nur Sex ohne Gefühle",
                    "Chaotisch oder unkontrolliert"
                ],
                variants: [
                    "Hierarchisches Poly: Primär-, Sekundärpartner",
                    "Nicht-hierarchisches Poly: Alle gleichwertig",
                    "Kitchen-Table-Poly: Alle Partner verstehen sich",
                    "Parallel-Poly: Partner kennen sich, wenig Kontakt"
                ]
            }
        };

        // Tag tooltip content for type combinations
        // Keys: "type1-type2" (alphabetically sorted), categories: A-F, tags: normalized tag names
        const tagTooltipContent = {
            // Single × Polyamor (niedrige Kompatibilität - Priorität)
            "polyamor-single": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Singles haben keine aktive Exklusivitäts-Erwartung, da sie bewusst ohne Primärbeziehung leben.",
                        type2Perspective: "Polyamor-Menschen lehnen Exklusivität als Grundprinzip ab - Liebe wird als nicht-begrenzt verstanden.",
                        dynamic: "Beide lehnen Exklusivität ab, aber aus völlig verschiedenen Gründen: Single will keine Beziehung, Polyamor will mehrere gleichzeitig."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Singles sind theoretisch offen, haben aber keine aktive Beziehungspraxis.",
                        type2Perspective: "Polyamor lebt alternative Modelle aktiv mit mehreren gleichzeitigen Liebesbeziehungen.",
                        dynamic: "Potenzielle Brücke: Ein Single könnte Polyamorie entdecken, wenn die Autonomie gewahrt bleibt."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Für Singles ist Beziehung kein zentraler Lebensinhalt - Selbstgenügsamkeit steht im Vordergrund.",
                        type2Perspective: "Für Polyamor sind Beziehungen sehr zentral, aber als Netzwerk statt als einzelne Partnerschaft.",
                        dynamic: "Grundlegend verschiedene Lebensentwürfe: Beziehungsfreiheit vs. Beziehungsvielfalt als Ideal."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue ist für Singles kein relevantes Konzept, da keine Beziehungsverpflichtungen bestehen.",
                        type2Perspective: "Treue bedeutet für Polyamor Ehrlichkeit und Transparenz, nicht Exklusivität.",
                        dynamic: "Verschiedene Bedeutungen: Für Single irrelevant, für Polyamor transformiert - aber nicht abwesend."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Singles praktizieren Selbstverantwortung ohne Rechenschaftspflicht gegenüber Partnern.",
                        type2Perspective: "Polyamor betont ethische Verantwortung gegenüber allen Beziehungspartnern.",
                        dynamic: "Single lebt für sich, Polyamor für ein Netzwerk - unterschiedliche ethische Bezugsrahmen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung liegt primär bei sich selbst und eigenen Lebensentscheidungen.",
                        type2Perspective: "Verantwortung erstreckt sich auf mehrere Partner und deren emotionale Bedürfnisse.",
                        dynamic: "Einzelverantwortung vs. Netzwerkverantwortung - fundamental verschiedene Komplexitätsgrade."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Singles meiden emotionale Verschmelzung zugunsten von Selbstgenügsamkeit.",
                        type2Perspective: "Polyamor sucht emotionale Tiefe mit mehreren Menschen gleichzeitig.",
                        dynamic: "Singles wahren Distanz, Polyamor sucht Nähe - aber verteilt auf mehrere Personen."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe ist für Singles optional und situativ, nicht strukturell verankert.",
                        type2Perspective: "Polyamor hat oft hohe physische Nähe-Bedürfnisse zu mehreren Partnern.",
                        dynamic: "Singles regulieren Nähe selbst, Polyamor jongliert Nähe-Bedürfnisse im Netzwerk."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Singles brauchen viel Raum und sind geübt darin, diesen zu verteidigen.",
                        type2Perspective: "Polyamor gibt Raum durch verteilte Aufmerksamkeit auf mehrere Partner.",
                        dynamic: "Beide können Raum geben - Single durch Abwesenheit, Polyamor durch Verteilung."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Maximale Freiheit ohne Kompromisse - Singles gestalten ihr Leben vollständig selbst.",
                        type2Perspective: "Freiheit innerhalb eines ethischen Beziehungsnetzwerks mit Absprachen.",
                        dynamic: "Absolute vs. verhandelte Freiheit - Singles haben mehr, müssen aber auf Beziehungstiefe verzichten."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Volle Entscheidungsautonomie ohne Rücksprache oder Kompromisse.",
                        type2Perspective: "Entscheidungsautonomie mit Transparenzpflicht gegenüber allen Partnern.",
                        dynamic: "Singles entscheiden allein, Polyamor kommuniziert - verschiedene Autonomie-Definitionen."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Singles respektieren Autonomie anderer, da sie selbst maximale Autonomie leben.",
                        type2Perspective: "Polyamor fördert aktiv die Autonomie aller Partner im Netzwerk.",
                        dynamic: "Passives Respektieren vs. aktives Fördern von Autonomie."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Singles kommunizieren situativ und bei Bedarf, ohne dauerhafte Verpflichtung.",
                        type2Perspective: "Polyamor erfordert tiefe, kontinuierliche Kommunikation mit allen Partnern.",
                        dynamic: "Verschiedene Kommunikationskulturen: Bedarfsorientiert vs. strukturell verankert."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Singles können Konflikte durch Rückzug vermeiden - keine Beziehungspflicht.",
                        type2Perspective: "Polyamor muss Konflikte aktiv lösen, um das Netzwerk zu erhalten.",
                        dynamic: "Exit-Option vs. Konfliktlösung als Notwendigkeit - sehr verschiedene Strategien."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz ist optional, da keine festen Beziehungspflichten bestehen.",
                        type2Perspective: "Maximale emotionale Transparenz als ethische Grundlage aller Beziehungen.",
                        dynamic: "Freiwillige vs. verpflichtende Transparenz - unterschiedliche Grundhaltungen."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Singles sind gesellschaftlich akzeptiert, wenn auch manchmal bedauert.",
                        type2Perspective: "Polyamor erfährt oft Stigmatisierung und Unverständnis.",
                        dynamic: "Single ist 'normal', Polyamor muss sich erklären - verschiedene gesellschaftliche Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Singles integrieren sich individuell und flexibel in soziale Kreise.",
                        type2Perspective: "Polyamor bringt komplexe Beziehungsstrukturen in soziale Kontexte ein.",
                        dynamic: "Einfache vs. komplexe soziale Integration - Singles haben es leichter."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Singles erleben mildes Stigma ('Wann heiratest du?'), aber keine starke Ablehnung.",
                        type2Perspective: "Polyamor muss aktiv mit Vorurteilen und Abwertung umgehen.",
                        dynamic: "Leichtes vs. starkes Stigma - Polyamor braucht mehr Resilienz."
                    }
                }
            },
            // Duo × Polyamor (maximaler Konflikt - Priorität)
            "duo-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo sieht Exklusivität als fundamentalen Ausdruck von Liebe und Verbindlichkeit.",
                        type2Perspective: "Polyamor versteht Liebe als nicht-begrenzte Ressource, die sich auf mehrere Menschen erstrecken kann.",
                        dynamic: "Fundamentaler Konflikt: Was für Duo Treue bedeutet, ist für Polyamor eine künstliche Beschränkung."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo bevorzugt das bewährte Zweiermodell und sieht wenig Grund zur Öffnung.",
                        type2Perspective: "Polyamor lebt aktiv ein alternatives Modell und hinterfragt Monogamie-Normen.",
                        dynamic: "Tradition vs. Alternative: Duo fragt 'Warum ändern?', Polyamor fragt 'Warum beschränken?'"
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Für Duo ist DIE Beziehung zentraler Lebensinhalt - 'Wir' als Einheit.",
                        type2Perspective: "Für Polyamor sind Beziehungen plural - mehrere gleichwertige 'Wirs'.",
                        dynamic: "Singuläres 'Wir' vs. plurales 'Wir' - grundverschiedene Beziehungsarchitekturen."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet exklusive emotionale und sexuelle Bindung an eine Person.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit, Transparenz und Einhalten von Absprachen - nicht Exklusivität.",
                        dynamic: "Maximaler Definitionskonflikt: Duo sieht Untreue, wo Polyamor Transparenz sieht."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen, Verbindlichkeit und Fokussierung auf einen Partner.",
                        type2Perspective: "Ethik basiert auf Ehrlichkeit, Konsens und Verantwortung gegenüber allen Beteiligten.",
                        dynamic: "Verschiedene ethische Fundamente: Exklusivitätsethik vs. Transparenzethik."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung konzentriert sich auf einen Partner und die gemeinsame Zukunft.",
                        type2Perspective: "Verantwortung verteilt sich auf mehrere Partner und komplexe Beziehungsdynamiken.",
                        dynamic: "Fokussierte vs. verteilte Verantwortung - unterschiedliche Kapazitätsanforderungen."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Duo strebt tiefe emotionale Verschmelzung mit einem Partner an.",
                        type2Perspective: "Polyamor erlebt emotionale Tiefe mit mehreren Menschen, aber weniger Verschmelzung pro Person.",
                        dynamic: "Intensive Tiefe zu einem vs. verteilte Tiefe zu mehreren - verschiedene emotionale Ökonomien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe fokussiert sich exklusiv auf den Partner.",
                        type2Perspective: "Physische Nähe verteilt sich auf mehrere Partner nach Bedarf und Absprache.",
                        dynamic: "Exklusive vs. geteilte Intimität - kann für Duo als Verlust erlebt werden."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Duo gibt Raum innerhalb der Partnerschaft, aber nicht für andere Beziehungen.",
                        type2Perspective: "Polyamor muss Raum für alle Partner schaffen und ausbalancieren.",
                        dynamic: "Raum für Individuum vs. Raum für andere Beziehungen - verschiedene Raumkonzepte."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert und gelebt.",
                        type2Perspective: "Individuelle Freiheit schließt Freiheit für mehrere Liebesbeziehungen ein.",
                        dynamic: "Paar-Freiheit vs. individuelle Beziehungsfreiheit - verschiedene Freiheitsbegriffe."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen werden als Paar getroffen.",
                        type2Perspective: "Individuelle Autonomie auch bei Beziehungsentscheidungen, mit Transparenz.",
                        dynamic: "Gemeinsame vs. individuelle Entscheidungsmacht - kann zu Konflikten führen."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie des Partners wird anerkannt, aber nicht für andere Beziehungen.",
                        type2Perspective: "Autonomie schließt explizit die Freiheit für weitere Liebesbeziehungen ein.",
                        dynamic: "Begrenzte vs. unbegrenzte Autonomie-Akzeptanz - Kernkonflikt dieser Kombination."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit einem Partner über alle Lebensaspekte.",
                        type2Perspective: "Tiefe Kommunikation mit mehreren Partnern, plus Meta-Kommunikation über Beziehungen.",
                        dynamic: "Verschiedene Kommunikationsanforderungen: Duo ist intensiv, Polyamor ist extensiv."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gelöst, ohne externe Beziehungen.",
                        type2Perspective: "Konflikte können mehrere Partner betreffen und erfordern komplexe Lösungen.",
                        dynamic: "Bilaterale vs. multilaterale Konfliktlösung - verschiedene Komplexitätsgrade."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz primär gegenüber dem einen Partner.",
                        type2Perspective: "Emotionale Transparenz gegenüber allen Partnern als ethische Basis.",
                        dynamic: "Duo kann Transparenz gegenüber 'Dritten' als Verrat empfinden - Polyamor als Grundlage."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo entspricht der gesellschaftlichen Norm und genießt volle Akzeptanz.",
                        type2Perspective: "Polyamor muss gegen Vorurteile und mangelndes Verständnis kämpfen.",
                        dynamic: "Norm vs. Abweichung - Duo hat soziale Vorteile, Polyamor soziale Hürden."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Duo wird als 'normales' Paar problemlos in alle Kontexte integriert.",
                        type2Perspective: "Polyamor muss erklären, verbergen oder mit Unverständnis umgehen.",
                        dynamic: "Reibungslose vs. erklärungsbedürftige Integration - verschiedene soziale Belastungen."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Duo erfährt kein Stigma, sondern gesellschaftliche Unterstützung.",
                        type2Perspective: "Polyamor muss aktiv mit Stigmatisierung und Diskriminierung umgehen.",
                        dynamic: "Privilegierte vs. marginalisierte Position - kann zu Unverständnis führen."
                    }
                }
            },
            // Duo-Flex × Solopoly (interessante Balance - Priorität)
            "duo_flex-solopoly": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo-Flex hält an einer Primärbeziehung fest, öffnet aber für Zusatzkontakte.",
                        type2Perspective: "Solopoly lehnt jede Form von Primärhierarchie ab - alle Beziehungen sind gleichwertig.",
                        dynamic: "Hierarchie vs. Gleichwertigkeit: Duo-Flex braucht einen Anker, Solopoly will keinen."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo-Flex ist offen, aber innerhalb eines strukturierten Rahmens mit Primärpartner.",
                        type2Perspective: "Solopoly lebt maximale Offenheit ohne Verpflichtung zu einer Hauptbeziehung.",
                        dynamic: "Gerahmte vs. ungerahmte Offenheit - beide alternativ, aber verschieden strukturiert."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Primärbeziehung ist Lebensinhalt, andere Kontakte sind Bereicherung.",
                        type2Perspective: "Alle Beziehungen sind Lebensbereiche, keiner ist zentraler Lebensinhalt.",
                        dynamic: "Zentrale vs. dezentrale Beziehungsarchitektur - verschiedene Lebensmodelle."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet Ehrlichkeit und Prioririsierung des Hauptpartners.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit gegenüber allen, ohne Hierarchie der Wichtigkeit.",
                        dynamic: "Hierarchische vs. egalitäre Treue-Definition - beide ehrlich, anders strukturiert."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik schützt die Primärbeziehung, Öffnungen erfolgen im Rahmen.",
                        type2Perspective: "Ethik behandelt alle Partner gleich, ohne Vorrang einer Beziehung.",
                        dynamic: "Schutzethik vs. Gleichheitsethik - verschiedene ethische Prioritäten."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Höchste Verantwortung gegenüber dem Primärpartner, dann anderen.",
                        type2Perspective: "Gleiche Verantwortung gegenüber allen Partnern, kein 'mehr' oder 'weniger'.",
                        dynamic: "Gestufte vs. gleiche Verantwortung - kann zu Missverständnissen führen."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Verschmelzung primär mit dem Hauptpartner.",
                        type2Perspective: "Solopoly meidet Verschmelzung bewusst, um Autonomie zu bewahren.",
                        dynamic: "Selektive Verschmelzung vs. generelle Distanz - verschiedene Nähe-Strategien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe hauptsächlich mit Primärpartner, situativ mit anderen.",
                        type2Perspective: "Physische Nähe gleichmäßig verteilt, kein 'Zuhause' bei einem Partner.",
                        dynamic: "Zentrierte vs. verteilte Intimität - verschiedene Nähe-Modelle."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum wird innerhalb der Primärbeziehung verhandelt.",
                        type2Perspective: "Raum ist strukturell gegeben durch separate Lebensräume.",
                        dynamic: "Verhandelter vs. struktureller Raum - Solopoly hat mehr eingebaute Distanz."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit innerhalb der Primärbeziehungs-Struktur.",
                        type2Perspective: "Maximale individuelle Freiheit als Grundprinzip des Lebens.",
                        dynamic: "Gerahmte vs. maximale Freiheit - verschiedene Autonomie-Level."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen mit Primärpartner, aber mehr Freiraum als Duo.",
                        type2Perspective: "Volle Entscheidungsautonomie, Transparenz statt Absprache.",
                        dynamic: "Abgestimmte vs. informierte Autonomie - verschiedene Entscheidungsprozesse."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie wird akzeptiert, solange die Primärbeziehung Priorität bleibt.",
                        type2Perspective: "Autonomie wird bedingungslos akzeptiert - keine Hierarchie-Erwartung.",
                        dynamic: "Bedingte vs. bedingungslose Autonomie-Akzeptanz."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit Primärpartner über alle Aspekte.",
                        type2Perspective: "Situative Kommunikationstiefe je nach Beziehung und Bedarf.",
                        dynamic: "Zentrierte vs. verteilte Kommunikationstiefe."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte primär im Kontext der Hauptbeziehung lösen.",
                        type2Perspective: "Konflikte individuell mit jedem Partner, ohne zentrale Instanz.",
                        dynamic: "Zentralisierte vs. dezentralisierte Konfliktlösung."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegenüber Primärpartner, selektiv gegenüber anderen.",
                        type2Perspective: "Gleichmäßige Transparenz gegenüber allen Partnern.",
                        dynamic: "Gestufte vs. gleiche Transparenz - verschiedene Informationsflüsse."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo-Flex kann als 'offene Ehe' noch relativ akzeptiert werden.",
                        type2Perspective: "Solopoly ist schwer zu erklären und wird oft missverstanden.",
                        dynamic: "Relativ akzeptiert vs. erklärungsbedürftig - verschiedene soziale Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Primärpaar wird integriert, Zusatzkontakte bleiben oft privat.",
                        type2Perspective: "Alle Beziehungen gleichwertig in soziale Kreise integrieren ist komplex.",
                        dynamic: "Einfachere vs. komplexere soziale Integration."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Mildes Stigma, wenn Öffnung bekannt wird.",
                        type2Perspective: "Stärkeres Stigma durch unkonventionelle Lebensform ohne 'Hauptpartner'.",
                        dynamic: "Verschiedene Stigma-Level - Solopoly ist gesellschaftlich unbekannter."
                    }
                }
            },
            // Polyamor × Polyamor (hohe Kompatibilität - Test)
            "polyamor-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Keine Exklusivitäts-Erwartung, Liebe wird als nicht-begrenzt verstanden.",
                        type2Perspective: "Gleiche Grundhaltung: Liebe zu mehreren Menschen ist möglich und ethisch.",
                        dynamic: "Volle Übereinstimmung: Beide verstehen und leben nicht-exklusive Liebe."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Lebt aktiv ein alternatives Beziehungsmodell.",
                        type2Perspective: "Teilt diese Lebensrealität und die damit verbundenen Werte.",
                        dynamic: "Maximale Synergie: Beide haben den gleichen Referenzrahmen für Beziehungen."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Beziehungen sind zentraler Lebensinhalt, aber als Netzwerk.",
                        type2Perspective: "Versteht und teilt diese Beziehungsarchitektur vollständig.",
                        dynamic: "Geteiltes Verständnis: Beziehungsnetzwerk als gemeinsamer Lebensraum."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = Ehrlichkeit, Transparenz, Einhalten von Agreements.",
                        type2Perspective: "Gleiche Definition von Treue, ohne Exklusivitätskomponente.",
                        dynamic: "Übereinstimmung bei einem der kritischsten Beziehungskonzepte."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Konsens, Kommunikation und Respekt.",
                        type2Perspective: "Teilt diese ethischen Grundlagen und praktiziert sie aktiv.",
                        dynamic: "Gemeinsame ethische Basis erleichtert Verhandlungen und Absprachen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung für ein Netzwerk von Beziehungen und Gefühlen.",
                        type2Perspective: "Versteht diese Komplexität und trägt sie mit.",
                        dynamic: "Geteilte Erfahrung mit der Komplexität polyamorer Verantwortung."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Tiefe mit mehreren Menschen, bewusst dosiert.",
                        type2Perspective: "Gleiche Erfahrung und Kompetenz im Umgang mit verteilter Intimität.",
                        dynamic: "Beide verstehen, wie Tiefe in einem Poly-Kontext funktioniert."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe verteilt sich auf mehrere Partner.",
                        type2Perspective: "Akzeptiert und praktiziert geteilte Intimität.",
                        dynamic: "Keine Eifersucht auf physische Nähe mit anderen - geteilte Norm."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum für andere Beziehungen ist selbstverständlich.",
                        type2Perspective: "Erwartet und gibt gleichermaßen Raum für das Beziehungsnetzwerk.",
                        dynamic: "Strukturelle Übereinstimmung: Beide brauchen und geben Beziehungs-Raum."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit für mehrere Liebesbeziehungen als Grundrecht.",
                        type2Perspective: "Teilt dieses Freiheitsverständnis vollständig.",
                        dynamic: "Keine Einschränkung der romantischen Freiheit - beidseitiges Verständnis."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Autonomie bei Beziehungsentscheidungen, mit Transparenzpflicht.",
                        type2Perspective: "Gleiche Balance zwischen Autonomie und Verantwortung.",
                        dynamic: "Geteilte Entscheidungskultur: Autonom, aber transparent."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Volle Akzeptanz der Beziehungsfreiheit des Partners.",
                        type2Perspective: "Erwartet und praktiziert die gleiche Akzeptanz.",
                        dynamic: "Wechselseitige Autonomie-Akzeptanz als Fundament der Beziehung."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation als Kernkompetenz polyanorer Beziehungen.",
                        type2Perspective: "Bringt gleiche Kommunikationsfähigkeiten und -erwartungen mit.",
                        dynamic: "Hohe Kommunikationskompetenz auf beiden Seiten - ideale Voraussetzung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Erfahrung mit komplexen, multilateralen Konflikten.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten Lösungsstrategien.",
                        dynamic: "Beide sind 'Poly-geprüft' in Konfliktsituationen - große Resilienz."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Maximale Transparenz als ethische Grundlage.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Praxis.",
                        dynamic: "Keine versteckten Emotionen, keine versteckten Beziehungen - klare Basis."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Muss mit gesellschaftlicher Stigmatisierung umgehen.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten Coping-Strategien.",
                        dynamic: "Gemeinsame Außenseiter-Position kann verbinden und stärken."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Komplexe Beziehungsstrukturen in soziale Kontexte einbringen.",
                        type2Perspective: "Versteht und teilt diese Herausforderung.",
                        dynamic: "Gegenseitige Unterstützung bei sozialer Navigation."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Aktiver Umgang mit Vorurteilen und Diskriminierung.",
                        type2Perspective: "Teilt diese Erfahrung und die Resilienz-Strategien.",
                        dynamic: "Gemeinsame Stärke gegen gesellschaftlichen Druck."
                    }
                }
            },
            // Duo × Duo (hohe Kompatibilität - Test)
            "duo-duo": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Exklusivität als fundamentaler Ausdruck von Liebe.",
                        type2Perspective: "Teilt dieses Verständnis von Exklusivität vollständig.",
                        dynamic: "Perfekte Übereinstimmung: Beide verstehen und wünschen Exklusivität."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Bevorzugt das klassische Zweiermodell.",
                        type2Perspective: "Gleiche Präferenz für monogame Partnerschaft.",
                        dynamic: "Geteilte Wertschätzung für traditionelles Beziehungsmodell."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Partnerschaft ist zentraler Lebensinhalt.",
                        type2Perspective: "Teilt diese Priorisierung der Beziehung.",
                        dynamic: "Gemeinsames 'Wir' als Lebensmittelpunkt - perfekte Synergie."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = exklusive emotionale und sexuelle Bindung.",
                        type2Perspective: "Gleiche Definition, gleiche Erwartung.",
                        dynamic: "Keine Definitions-Konflikte bei diesem zentralen Thema."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen und Verbindlichkeit.",
                        type2Perspective: "Teilt diese ethischen Grundwerte.",
                        dynamic: "Gemeinsame ethische Basis für eine stabile Partnerschaft."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Fokussierte Verantwortung füreinander.",
                        type2Perspective: "Gleiche Verantwortungsbereitschaft.",
                        dynamic: "Gegenseitige, konzentrierte Verantwortung - klare Struktur."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Wünscht tiefe emotionale Verschmelzung.",
                        type2Perspective: "Teilt dieses Bedürfnis nach Nähe und Verbundenheit.",
                        dynamic: "Beidseitiges Streben nach emotionaler Tiefe."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe exklusiv mit dem Partner.",
                        type2Perspective: "Gleiche Exklusivitäts-Erwartung bei Intimität.",
                        dynamic: "Keine Konkurrenz um Nähe - ungeteilte Aufmerksamkeit."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum innerhalb der Partnerschaft.",
                        type2Perspective: "Gleiche Balance zwischen Nähe und individuellem Raum.",
                        dynamic: "Ähnliche Raum-Bedürfnisse erleichtern das Zusammenleben."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert.",
                        type2Perspective: "Teilt dieses Verständnis von Paar-Freiheit.",
                        dynamic: "Gemeinsame Freiheits-Definition als 'Wir'."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen gemeinsam treffen.",
                        type2Perspective: "Gleiche Erwartung an gemeinsame Entscheidungsfindung.",
                        dynamic: "Geteilte Entscheidungsmacht ohne Autonomie-Konflikte."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie innerhalb des Paar-Rahmens.",
                        type2Perspective: "Gleiche Balance zwischen Individualität und Partnerschaft.",
                        dynamic: "Ähnliche Autonomie-Grenzen erleichtern das Zusammenleben."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation zu zweit.",
                        type2Perspective: "Gleicher Wunsch nach intensivem Austausch.",
                        dynamic: "Fokussierte, tiefe Kommunikation ohne Verteilung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gelöst.",
                        type2Perspective: "Gleiche Erwartung an bilaterale Konfliktlösung.",
                        dynamic: "Klare Konflikt-Struktur ohne externe Komplexität."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegenüber dem Partner.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Bereitschaft.",
                        dynamic: "Gegenseitige Offenheit ohne konkurrierende Loyalitäten."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Volle gesellschaftliche Akzeptanz.",
                        type2Perspective: "Teilt diese privilegierte Position.",
                        dynamic: "Keine externen Hürden durch gesellschaftliche Normen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Als Paar problemlos integriert.",
                        type2Perspective: "Gleiche einfache soziale Integration.",
                        dynamic: "Gesellschaftliche Normalität als gemeinsame Basis."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Kein Stigma, sondern gesellschaftliche Unterstützung.",
                        type2Perspective: "Teilt diese Stigma-freie Erfahrung.",
                        dynamic: "Kein externer Druck - Fokus auf die Beziehung selbst."
                    }
                }
            }
        };

        // Helper function to normalize tag names for lookup
        function normalizeTagName(tag) {
            return tag.toLowerCase()
                .replace(/ä/g, 'ae').replace(/ö/g, 'oe').replace(/ü/g, 'ue').replace(/ß/g, 'ss')
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
        }

        // Get tooltip content for a specific tag
        function getTagTooltip(type1Id, type2Id, category, tagName) {
            const normalizedTag = normalizeTagName(tagName);

            // Sort type IDs alphabetically for consistent key lookup
            const sortedTypes = [type1Id, type2Id].sort();
            const comboKey = sortedTypes.join('-');

            // Try to find specific tooltip
            const comboData = tagTooltipContent[comboKey];
            if (comboData && comboData[category] && comboData[category][normalizedTag]) {
                const tooltip = comboData[category][normalizedTag];
                const type1 = data.archetypes[type1Id];
                const type2 = data.archetypes[type2Id];

                // Swap perspectives if types were reordered
                if (sortedTypes[0] === type2Id) {
                    return {
                        type1Name: type1?.name || type1Id,
                        type2Name: type2?.name || type2Id,
                        type1Perspective: tooltip.type2Perspective,
                        type2Perspective: tooltip.type1Perspective,
                        dynamic: tooltip.dynamic
                    };
                }

                return {
                    type1Name: type1?.name || type1Id,
                    type2Name: type2?.name || type2Id,
                    type1Perspective: tooltip.type1Perspective,
                    type2Perspective: tooltip.type2Perspective,
                    dynamic: tooltip.dynamic
                };
            }

            // Fallback: Generate generic tooltip
            return generateFallbackTooltip(type1Id, type2Id, category, tagName);
        }

        // Generate fallback tooltip when no specific content exists
        function generateFallbackTooltip(type1Id, type2Id, category, tagName) {
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const type1Def = archetypeDefinitions[type1Id];
            const type2Def = archetypeDefinitions[type2Id];

            const interactionKey = `${type1Id}_${type2Id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const catScore = scores[category]?.value || 50;

            // Generate context-aware fallback
            let dynamicText = '';
            if (catScore >= 85) {
                dynamicText = `Hohe Übereinstimmung (${catScore}%) in diesem Bereich - beide Typen haben ähnliche Ansätze.`;
            } else if (catScore >= 70) {
                dynamicText = `Moderate Übereinstimmung (${catScore}%) - einige gemeinsame Grundlagen, aber auch Unterschiede.`;
            } else if (catScore >= 50) {
                dynamicText = `Mittlere Beziehungsqualität (${catScore}%) - deutliche Unterschiede, die Kompromisse erfordern.`;
            } else {
                dynamicText = `Herausfordernde Konstellation (${catScore}%) - grundlegend verschiedene Ansätze in diesem Bereich.`;
            }

            return {
                type1Name: type1?.name || type1Id,
                type2Name: type2?.name || type2Id,
                type1Perspective: type1Def?.keyPrinciples?.[0] || `${type1?.name || type1Id} hat eigene Präferenzen in diesem Bereich.`,
                type2Perspective: type2Def?.keyPrinciples?.[0] || `${type2?.name || type2Id} hat eigene Präferenzen in diesem Bereich.`,
                dynamic: dynamicText
            };
        }

        // Category descriptions loaded from data
        let categoryDescriptions = {};

        async function loadData() {
            try {
                const response = await fetch('archetype-matrix.json');
                data = await response.json();
                // Load category descriptions from data
                if (data.categories) {
                    categoryDescriptions = data.categories;
                }
            } catch (error) {
                console.error('Error loading data:', error);
                data = getFallbackData();
            }
            initApp();
        }

        function getFallbackData() {
            return {
                archetypes: {
                    single: { id: "single", name: "Single", color: "#E63946", shortDescription: "Fokus auf Selbstentwicklung", pro: [], contra: [], pathos: "", logos: "" },
                    duo: { id: "duo", name: "Duo", color: "#E84393", shortDescription: "Klassische monogame Zweierbeziehung", pro: [], contra: [], pathos: "", logos: "" },
                    duo_flex: { id: "duo_flex", name: "Duo-Flex", color: "#FF6B6B", shortDescription: "Primär Zweierbeziehung mit situativer Öffnung", pro: [], contra: [], pathos: "", logos: "" },
                    solopoly: { id: "solopoly", name: "Solopoly", color: "#2A9D8F", shortDescription: "Polyamor mit Autonomie", pro: [], contra: [], pathos: "", logos: "" },
                    polyamor: { id: "polyamor", name: "Polyamor", color: "#F4A261", shortDescription: "Strukturierte Mehrfachbeziehungen", pro: [], contra: [], pathos: "", logos: "" },
                    ra: { id: "ra", name: "RA", color: "#9B5DE5", shortDescription: "Relationship Anarchist - Ablehnung von Labels", pro: [], contra: [], pathos: "", logos: "" },
                    lat: { id: "lat", name: "LAT", color: "#06D6A0", shortDescription: "Living Apart Together", pro: [], contra: [], pathos: "", logos: "" },
                    aromantisch: { id: "aromantisch", name: "Aromantisch", color: "#118AB2", shortDescription: "Platonische Verbindungen", pro: [], contra: [], pathos: "", logos: "" }
                },
                categories: {},
                interactions: {},
                aggregatedMatrix: { rows: [], cols: [], values: [] }
            };
        }

        function initApp() {
            const archetypeSelect = document.getElementById('archetypeSelect');
            if (archetypeSelect) {
                archetypeSelect.addEventListener('change', (e) => {
                    currentArchetype = e.target.value;
                    updateAll();
                });
            }

            // Carousel scroll detection
            const carousel = document.getElementById('carousel');
            if (carousel) {
                carousel.addEventListener('scroll', updateNavDots);
            }

            updateAll();
        }

        function updateAll() {
            updateTheme();
            updateMyType();
            updatePartnerSelector();
            updateTopAndChallenge();
            updatePartnerView();
            updateLegendCategories();
            updateAnalysisOverview();
        }

        function updateTheme() {
            document.body.className = `theme-${currentArchetype}`;
        }

        function updateMyType() {
            const arch = data.archetypes[currentArchetype];
            if (!arch) return;

            const myTypeIcon = document.getElementById('myTypeIcon');
            if (myTypeIcon) {
                myTypeIcon.textContent = icons[currentArchetype];
                myTypeIcon.style.background = arch.color;
            }

            const myTypeName = document.getElementById('myTypeName');
            if (myTypeName) {
                myTypeName.textContent = arch.name;
                myTypeName.style.color = arch.color;
            }

            const myTypeDesc = document.getElementById('myTypeDesc');
            if (myTypeDesc) myTypeDesc.textContent = arch.shortDescription || '';

            const myTypeTooltip = document.getElementById('myTypeTooltip');
            if (myTypeTooltip) myTypeTooltip.textContent = getShortDef(currentArchetype);

            const proList = document.getElementById('myTypePro');
            if (proList) proList.innerHTML = (arch.pro || []).slice(0, 4).map(p => `<li>${p}</li>`).join('');

            const contraList = document.getElementById('myTypeContra');
            if (contraList) contraList.innerHTML = (arch.contra || []).slice(0, 4).map(c => `<li>${c}</li>`).join('');

            const myTypePathos = document.getElementById('myTypePathos');
            if (myTypePathos) myTypePathos.textContent = arch.pathos || '';

            const myTypeLogos = document.getElementById('myTypeLogos');
            if (myTypeLogos) myTypeLogos.textContent = arch.logos || '';
        }

        // Fixed archetype order to ensure all types are shown
        const archetypeOrder = ['single', 'duo', 'duo_flex', 'solopoly', 'polyamor', 'ra', 'lat', 'aromantisch'];

        function updatePartnerSelector() {
            const container = document.getElementById('partnerSelector');
            // Show ALL archetypes as partner options (including own type for self-matching)
            const allPartners = archetypeOrder
                .map(id => data.archetypes[id])
                .filter(arch => arch); // Remove any undefined

            if (!allPartners.find(o => o.id === selectedPartner)) {
                selectedPartner = allPartners[0]?.id || 'duo';
            }

            container.innerHTML = allPartners.map(arch => `
                <button class="partner-btn ${arch.id === selectedPartner ? 'active' : ''}"
                        onclick="selectPartner('${arch.id}')"
                        data-id="${arch.id}">
                    <span class="dot" style="background: ${arch.color}"></span>
                    ${arch.name}
                </button>
            `).join('');
        }

        function selectPartner(partnerId) {
            selectedPartner = partnerId;
            document.querySelectorAll('.partner-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.id === partnerId);
            });
            updatePartnerView();
            updateAnalysisOverview();
        }

        function updateTopAndChallenge() {
            // Include all types (including self) for top match and challenge
            const others = archetypeOrder;
            let topMatch = { id: null, score: 0 };
            let challenge = { id: null, score: 100 };

            others.forEach(otherId => {
                const key = `${currentArchetype}_${otherId}`;
                const interaction = data.interactions[key];
                const score = interaction?.overall || 0;

                if (score > topMatch.score) {
                    topMatch = { id: otherId, score };
                }
                if (score < challenge.score) {
                    challenge = { id: otherId, score };
                }
            });

            // Store for modal access
            currentTopMatch = topMatch;
            currentChallenge = challenge;

            const myArch = data.archetypes[currentArchetype];

            if (topMatch.id) {
                const arch = data.archetypes[topMatch.id];
                document.getElementById('topMatchDot').style.background = arch.color;
                document.getElementById('topMatchName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('topMatchScore').textContent = topMatch.score + '%';
            }

            if (challenge.id) {
                const arch = data.archetypes[challenge.id];
                document.getElementById('challengeDot').style.background = arch.color;
                document.getElementById('challengeName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('challengeScore').textContent = challenge.score + '%';
            }
        }

        function updatePartnerView() {
            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};

            // Run Pathos/Logos checks (keine Blockierung mehr - zeigt nur Warnungen)
            runCompatibilityChecks();

            document.getElementById('myTypeNameDisplay').textContent = myArch?.name || '...';
            document.getElementById('partnerNameDisplay').textContent = partnerArch?.name || '...';
            document.getElementById('myTypeTooltipPage3').textContent = getShortDef(currentArchetype);
            document.getElementById('partnerTooltipPage3').textContent = getShortDef(selectedPartner);

            const score = interaction.overall || 0;
            const scoreEl = document.getElementById('overallScore');
            scoreEl.textContent = score + '%';
            scoreEl.style.color = getScoreColor(score);

            drawRadarChart(interaction.scores || {}, partnerArch?.color || '#457B9D');
            updateCategoryBars(interaction.scores || {});

            const proList = document.getElementById('partnerPro');
            proList.innerHTML = (interaction.pro || []).map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';

            const contraList = document.getElementById('partnerContra');
            contraList.innerHTML = (interaction.contra || []).map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';
        }

        function drawRadarChart(scores, color) {
            const svg = document.getElementById('radarChart');
            const cx = 140, cy = 120, maxR = 90;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const n = categories.length;

            let html = '';

            for (let r = 18; r <= maxR; r += 18) {
                html += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
            }

            categories.forEach((cat, i) => {
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * maxR;
                const y = cy + Math.sin(angle) * maxR;
                const labelX = cx + Math.cos(angle) * (maxR + 18);
                const labelY = cy + Math.sin(angle) * (maxR + 18);

                html += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
                html += `<text x="${labelX}" y="${labelY}" fill="var(--text-muted)" font-size="10" text-anchor="middle" dominant-baseline="middle">${cat}</text>`;
            });

            const points = categories.map((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                return `${cx + Math.cos(angle) * r},${cy + Math.sin(angle) * r}`;
            }).join(' ');

            html += `<polygon points="${points}" fill="${color}33" stroke="${color}" stroke-width="2"/>`;

            categories.forEach((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;
                html += `<circle cx="${x}" cy="${y}" r="4" fill="${color}"/>`;
            });

            if (svg) svg.innerHTML = html;

            // Also draw on expandRadarChart (smaller version)
            const expandSvg = document.getElementById('expandRadarChart');
            if (expandSvg) expandSvg.innerHTML = html;
        }

        function updateCategoryBars(scores) {
            const container = document.getElementById('categoryBars');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            container.innerHTML = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                return `
                    <div class="category-row" onclick="openSingleCategoryModal('${cat}')">
                        <span class="category-label">${cat}</span>
                        <div class="category-bar-wrap">
                            <div class="category-bar-container">
                                <div class="category-bar ${barClass}" style="width: ${value}%">
                                    <span class="category-bar-value">${value}%</span>
                                </div>
                            </div>
                            <div class="category-name">${name}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getScoreColor(score) {
            if (score >= 70) return '#457B9D';  // Blau - Gut
            if (score >= 50) return '#f39c12';  // Orange - Mittel
            return '#e74c3c';                   // Rot - Herausfordernd
        }

        function getBarClass(value) {
            if (value >= 70) return 'bar-good';
            if (value >= 50) return 'bar-medium';
            return 'bar-low';
        }

        function toggleCollapsible(id) {
            document.getElementById(id).classList.toggle('open');
        }

        // Toggle dimension collapse for Dominanz/Orientierung sections
        function toggleDimensionCollapse(element) {
            element.classList.toggle('collapsed');
        }

        // Track global fold/unfold state
        let allDimensionsCollapsed = false;

        // Toggle all dimensions AND desktop factors collapse/expand at once
        function toggleAllDimensionsCollapse() {
            const allDimensions = document.querySelectorAll('.collapsible-dimension');
            const allFactors = document.querySelectorAll('.desktop-factor-item');
            
            // Get both desktop and mobile buttons
            const desktopBtn = document.getElementById('foldUnfoldAllBtn');
            const mobileBtn = document.getElementById('mobileFoldUnfoldBtn');

            allDimensionsCollapsed = !allDimensionsCollapsed;

            // Toggle collapsible dimensions
            allDimensions.forEach(dim => {
                if (allDimensionsCollapsed) {
                    dim.classList.add('collapsed');
                } else {
                    dim.classList.remove('collapsed');
                }
            });

            // Toggle desktop factor items
            allFactors.forEach(factor => {
                if (allDimensionsCollapsed) {
                    factor.classList.add('collapsed');
                } else {
                    factor.classList.remove('collapsed');
                }
            });

            // Update both buttons' appearance
            const buttons = [desktopBtn, mobileBtn].filter(btn => btn !== null);
            buttons.forEach(btn => {
                const icon = btn.querySelector('.fold-unfold-icon');
                const text = btn.querySelector('.fold-unfold-text');

                if (allDimensionsCollapsed) {
                    icon.textContent = '▶';
                    text.textContent = 'Unfold';
                    btn.classList.add('collapsed-state');
                } else {
                    icon.textContent = '▼';
                    text.textContent = 'Fold';
                    btn.classList.remove('collapsed-state');
                }
            });

            // Update desktop factor content when expanding
            if (!allDimensionsCollapsed) {
                updateDesktopFactorContent();
            }
        }

        // Toggle single desktop factor expand/collapse
        function toggleDesktopFactor(element) {
            const wasCollapsed = element.classList.contains('collapsed');
            element.classList.toggle('collapsed');
            // Update the fold/unfold button state based on current state
            updateDesktopFactorFoldButton();
            // Update content when expanding
            if (wasCollapsed) {
                updateDesktopFactorContent();
            }
        }

        // Update fold button based on current state of all collapsible elements
        function updateDesktopFactorFoldButton() {
            const allDimensions = document.querySelectorAll('.collapsible-dimension');
            const allFactors = document.querySelectorAll('.desktop-factor-item');
            const desktopBtn = document.getElementById('foldUnfoldAllBtn');
            const mobileBtn = document.getElementById('mobileFoldUnfoldBtn');

            // Check if all are collapsed (both dimensions and factors)
            const allDimensionsCollapsedCheck = Array.from(allDimensions).every(d => d.classList.contains('collapsed'));
            const allFactorsCollapsed = Array.from(allFactors).every(f => f.classList.contains('collapsed'));
            const allCollapsed = allDimensionsCollapsedCheck && allFactorsCollapsed;

            allDimensionsCollapsed = allCollapsed;

            // Update both buttons
            const buttons = [desktopBtn, mobileBtn].filter(btn => btn !== null);
            buttons.forEach(btn => {
                const icon = btn.querySelector('.fold-unfold-icon');
                const text = btn.querySelector('.fold-unfold-text');

                if (allCollapsed) {
                    icon.textContent = '▶';
                    text.textContent = 'Unfold';
                    btn.classList.add('collapsed-state');
                } else {
                    icon.textContent = '▼';
                    text.textContent = 'Fold';
                    btn.classList.remove('collapsed-state');
                }
            });
        }

        // Update all desktop factor expandable content
        function updateDesktopFactorContent() {
            // Check if factorExplanations is defined (it's defined later in the file)
            if (typeof factorExplanations === 'undefined') return;

            const ich = mobileIchArchetype;
            const partner = mobilePartnerArchetype;
            const dimensions = personDimensions;

            const factorTypes = ['archetyp', 'dominanz', 'orientierung', 'geschlecht'];

            factorTypes.forEach(factorType => {
                const factor = factorExplanations[factorType];
                if (!factor) return;

                // Get score
                const prefix = 'desktopFactor';
                let score = 0;
                if (factorType === 'archetyp') {
                    score = parseInt(document.getElementById(prefix + 'Archetyp').textContent) || 0;
                } else if (factorType === 'dominanz') {
                    score = parseInt(document.getElementById(prefix + 'Dominanz').textContent) || 0;
                } else if (factorType === 'orientierung') {
                    score = parseInt(document.getElementById(prefix + 'Orientierung').textContent) || 0;
                } else if (factorType === 'geschlecht') {
                    score = parseInt(document.getElementById(prefix + 'Geschlecht').textContent) || 0;
                }

                // Update explanation
                const explanationId = prefix + factorType.charAt(0).toUpperCase() + factorType.slice(1) + 'Explanation';
                const explanationEl = document.getElementById(explanationId);
                if (explanationEl) {
                    explanationEl.textContent = factor.getExplanation(ich, partner, score, dimensions);
                }

                // Update meaning list
                const meaningId = prefix + factorType.charAt(0).toUpperCase() + factorType.slice(1) + 'Meaning';
                const meaningList = document.getElementById(meaningId);
                if (meaningList) {
                    meaningList.innerHTML = '';
                    factor.getMeaning(score, ich, partner).forEach(item => {
                        const li = document.createElement('li');
                        if (typeof item === 'object' && item.title) {
                            li.innerHTML = `<strong>${item.title}</strong>${item.desc ? ` – ${item.desc}` : ''}`;
                        } else {
                            li.textContent = item;
                        }
                        meaningList.appendChild(li);
                    });
                }
            });
        }

        // Get summary text for selected options
        function getDimensionSummary(person, type) {
            let data, types;
            if (type === 'dominanz') {
                data = personDimensions[person].dominanz;
                types = ['dominant', 'submissiv', 'switch', 'ausgeglichen'];
            } else {
                data = personDimensions[person].orientierung;
                types = ['heterosexuell', 'homosexuell', 'bisexuell'];
            }

            const selected = [];
            for (const t of types) {
                if (data[t]) {
                    const status = data[t] === 'gelebt' ? '(Gelebt)' : '(Interessiert)';
                    selected.push(t + ' ' + status);
                }
            }
            return selected.length > 0 ? '✓ ' + selected.join(', ') : '';
        }

        // Update collapsed summary for a dimension
        function updateDimensionSummary(person, type, prefix = '') {
            const summaryId = prefix + person + '-' + type + '-summary';
            const summary = document.getElementById(summaryId);
            if (summary) {
                summary.textContent = getDimensionSummary(person, type);
            }
        }

        // Check if all required options are selected and update summary (auto-collapse disabled)
        function checkAutoCollapse(person, type, prefix = '') {
            // Update summary only - auto-collapse is disabled
            updateDimensionSummary(person, type, prefix);
        }

        function scrollToCard(index) {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            carousel.scrollTo({ left: cardWidth * index, behavior: 'smooth' });
        }

        const TOTAL_PAGES = 4;

        function updateNavDots() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);

            document.querySelectorAll('.nav-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentCard);
            });

            // Update arrow states
            const arrows = document.querySelectorAll('.nav-arrow');
            if (arrows.length >= 2) {
                arrows[0].disabled = currentCard === 0;
                arrows[1].disabled = currentCard === TOTAL_PAGES - 1;
            }

            // Load feedback when on page 4
            if (currentCard === 3) {
                loadFeedback();
            }
        }

        function navigatePrev() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard > 0) {
                scrollToCard(currentCard - 1);
            }
        }

        function navigateNext() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard < TOTAL_PAGES - 1) {
                scrollToCard(currentCard + 1);
            }
        }

        // Legend Categories
        function updateLegendCategories() {
            const container = document.getElementById('legendCategories');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            // Get current interaction scores
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const myName = myArch?.name || currentArchetype;
            const partnerName = partnerArch?.name || selectedPartner;

            // Show which combination is displayed
            const headerText = currentArchetype === selectedPartner
                ? `${myName} (Ich) mit ${myName}`
                : `${myName} (Ich) mit ${partnerName}`;

            container.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: var(--bg-dark); border-radius: 10px; text-align: center;">
                    <span style="color: var(--text-muted); font-size: var(--font-sm);">Aktuelle Auswahl:</span>
                    <div style="color: var(--primary); font-weight: 600; font-size: var(--font-base);">${headerText}</div>
                </div>
            ` + categories.map(cat => {
                const catData = categoryDescriptions[cat] || {};
                const name = catData.name || categoryNames[cat] || cat;
                const desc = catData.description || 'Beschreibung nicht verfügbar';
                const value = scores[cat]?.value || 0;
                const scoreColor = getScoreColor(value);

                return `
                    <div class="legend-category-item" onclick="openSingleCategoryModal('${cat}')">
                        <div class="legend-category-letter">${cat}</div>
                        <div class="legend-category-content">
                            <div class="legend-category-name">${name}</div>
                            <div class="legend-category-desc">${desc}</div>
                        </div>
                        <div style="font-weight: 700; font-size: var(--font-md); color: ${scoreColor}; min-width: 50px; text-align: right;">${value}%</div>
                    </div>
                `;
            }).join('');
        }

        // Modal Functions
        function openCategoryModal() {
            // Reset modal context when opening directly (uses page 2 selection)
            modalContextPartner = null;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            document.getElementById('modalTitle').textContent = 'Alle Kategorien';
            document.getElementById('modalBody').innerHTML = categories.map(cat => getCategoryModalContent(cat)).join('');
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        let currentModalCategory = 'A'; // Track current category for navigation

        function openSingleCategoryModal(category) {
            currentModalCategory = category;
            // Don't reset modalContextPartner here - it may be set from match modal
            const catData = categoryDescriptions[category] || {};
            const name = catData.name || categoryNames[category] || category;
            document.getElementById('modalTitle').textContent = `Kategorie ${category}`;
            document.getElementById('modalBody').innerHTML = getCategoryModalContent(category);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function navigateCategoryPrev() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : categories.length - 1;
            openSingleCategoryModal(categories[prevIndex]);
        }

        function navigateCategoryNext() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const nextIndex = currentIndex < categories.length - 1 ? currentIndex + 1 : 0;
            openSingleCategoryModal(categories[nextIndex]);
        }

        function getCategoryModalContent(cat) {
            const catData = categoryDescriptions[cat] || {};
            const name = catData.name || categoryNames[cat] || cat;
            const desc = catData.description || 'Beschreibung nicht verfügbar';
            const subDims = catData.subDimensions || [];

            // Use modalContextPartner if set (from match modal), otherwise use selectedPartner (from page 2)
            const partnerId = modalContextPartner || selectedPartner;
            const interactionKey = `${currentArchetype}_${partnerId}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const value = scores[cat]?.value || 0;
            const scoreColor = getScoreColor(value);
            const barClass = getBarClass(value);

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[partnerId];
            const comboText = `${myArch?.name || '?'} + ${partnerArch?.name || '?'}`;
            const contextText = `${comboText} | ${name}`;

            // Get category position for navigation
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const catIndex = categories.indexOf(cat);
            const prevCat = categories[catIndex > 0 ? catIndex - 1 : categories.length - 1];
            const nextCat = categories[catIndex < categories.length - 1 ? catIndex + 1 : 0];
            const prevName = categoryNames[prevCat] || prevCat;
            const nextName = categoryNames[nextCat] || nextCat;

            return `
                <div class="category-nav-row">
                    <button class="category-nav-btn" onclick="navigateCategoryPrev()">
                        ‹ ${prevCat}
                    </button>
                    <span class="category-nav-indicator">${catIndex + 1} / 6</span>
                    <button class="category-nav-btn" onclick="navigateCategoryNext()">
                        ${nextCat} ›
                    </button>
                </div>

                <div class="modal-category">
                    <div class="modal-category-header">
                        <div class="modal-category-letter">${cat}</div>
                        <div class="modal-category-name">${name}</div>
                    </div>
                    <div class="match-modal-score" style="margin: 12px 0;">
                        <span class="match-modal-score-label">${comboText}</span>
                        <span class="match-modal-score-value" style="color: ${scoreColor}">${value}%</span>
                    </div>
                    <div class="modal-category-desc">${desc}</div>
                    ${subDims.length > 0 ? `
                        <div class="modal-subdimensions">
                            ${subDims.map(sd => renderTagWithTooltip(sd, cat, currentArchetype, partnerId)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Render a tag with tooltip
        function renderTagWithTooltip(tagName, category, type1Id, type2Id) {
            const tooltip = getTagTooltip(type1Id, type2Id, category, tagName);
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const color1 = type1?.color || 'var(--primary)';
            const color2 = type2?.color || 'var(--primary)';

            // Build type switcher options
            const allTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type1Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'ich', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            const partnerTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type2Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'partner', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            return `
                <span class="tag-tooltip-container">
                    <span class="modal-subdim-tag" onclick="openTagTooltip(this.parentElement, '${category}')">${tagName}</span>
                    <div class="tag-tooltip">
                        <button class="tag-tooltip-close" onclick="closeTagTooltip()">&times;</button>
                        <div class="tag-tooltip-header">${tagName}</div>

                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Ich:</span>
                            ${allTypes}
                        </div>
                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Partner:</span>
                            ${partnerTypes}
                        </div>

                        <div class="tag-tooltip-body">
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color1}">${tooltip.type1Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type1Perspective}</span>
                            </div>
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color2}">${tooltip.type2Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type2Perspective}</span>
                            </div>
                            <div class="tag-tooltip-dynamic">${tooltip.dynamic}</div>
                        </div>
                    </div>
                </span>
            `;
        }

        // Switch type from tooltip and refresh modal
        function switchTooltipType(typeId, role, category) {
            if (role === 'ich') {
                currentArchetype = typeId;
                // Update main UI
                document.getElementById('archetypeSelect').value = typeId;
                updateTheme();
                updateMyType();
                updatePartnerSelector();
                updateTopAndChallenge();
                updatePartnerView();
            } else {
                selectedPartner = typeId;
                modalContextPartner = typeId;
                // Update partner selection buttons
                document.querySelectorAll('.partner-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.id === typeId);
                });
                updatePartnerView();
            }

            // Refresh the category modal with new types
            openSingleCategoryModal(category);
        }

        // Active tooltip tracking
        let activeTooltipElement = null;
        let activeTagElement = null;

        // Toggle tag tooltip on click
        function openTagTooltip(container, category) {
            const tooltip = container.querySelector('.tag-tooltip');
            const tag = container.querySelector('.modal-subdim-tag');
            if (!tooltip || !tag) return;

            // If this tooltip is already open, close it
            if (activeTooltipElement === tooltip) {
                closeTagTooltip();
                return;
            }

            // Close any other open tooltip first
            closeTagTooltip();

            // Activate this tooltip and tag
            activeTooltipElement = tooltip;
            activeTagElement = tag;
            tooltip.classList.add('active');
            tag.classList.add('active');

            // Position at top of viewport so it doesn't get cut off
            const tooltipWidth = Math.min(360, window.innerWidth * 0.92);
            const left = (window.innerWidth - tooltipWidth) / 2;
            const top = 60; // Fixed position near top

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.style.width = tooltipWidth + 'px';
        }

        // Close tag tooltip
        function closeTagTooltip() {
            if (activeTooltipElement) {
                activeTooltipElement.classList.remove('active');
                activeTooltipElement = null;
            }
            if (activeTagElement) {
                activeTagElement.classList.remove('active');
                activeTagElement = null;
            }
            // Also close any other open tooltips and tags
            document.querySelectorAll('.tag-tooltip.active').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.modal-subdim-tag.active').forEach(t => t.classList.remove('active'));
        }

        function closeCategoryModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('categoryModal').classList.remove('active');
            document.body.style.overflow = '';
            // Reset modal context when closing
            modalContextPartner = null;
        }

        // Definition Modal Functions
        function openDefinitionModal(archetypeId) {
            const def = archetypeDefinitions[archetypeId];
            if (!def) return;

            const arch = data.archetypes[archetypeId];
            const color = arch?.color || 'var(--primary)';
            const icon = icons[archetypeId] || '?';

            document.getElementById('definitionModalTitle').innerHTML = `
                <span style="color: ${color}">${icon}</span> ${def.name}
            `;

            document.getElementById('definitionModalBody').innerHTML = `
                <div class="definition-long">${def.longDef}</div>

                <div class="definition-section">
                    <div class="definition-section-title">Kernprinzipien</div>
                    <ul class="definition-list principles">
                        ${def.keyPrinciples.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Das ist NICHT dasselbe wie</div>
                    <ul class="definition-list not-same">
                        ${def.notTheSameAs.map(n => `<li>${n}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Varianten</div>
                    <ul class="definition-list variants">
                        ${def.variants.map(v => `<li>${v}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDefinitionModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('definitionModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ========================================
        // Definition Modal Swipe Navigation
        // ========================================
        let currentDefinitionIndex = 0;
        let currentDefinitionPerson = 'ich'; // Track whether showing 'ich' or 'partner'
        let definitionTouchStartX = 0;

        function handleDefinitionTouchStart(e) {
            definitionTouchStartX = e.touches[0].clientX;
        }

        function handleDefinitionTouchEnd(e) {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = definitionTouchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                navigateDefinition(diff > 0 ? 1 : -1);
            }
        }

        function navigateDefinition(direction) {
            currentDefinitionIndex += direction;
            if (currentDefinitionIndex < 0) currentDefinitionIndex = archetypeOrder.length - 1;
            if (currentDefinitionIndex >= archetypeOrder.length) currentDefinitionIndex = 0;

            const newArchetype = archetypeOrder[currentDefinitionIndex];
            showArchetypeInfoByType(newArchetype);

            // Sync the new archetype to the dropdown selection
            if (currentDefinitionPerson === 'ich') {
                document.getElementById('ichSelect').value = newArchetype;
                document.getElementById('mobileIchSelect').value = newArchetype;
                currentArchetype = newArchetype;
                mobileIchArchetype = newArchetype;
            } else if (currentDefinitionPerson === 'partner') {
                document.getElementById('partnerSelect').value = newArchetype;
                document.getElementById('mobilePartnerSelect').value = newArchetype;
                selectedPartner = newArchetype;
                mobilePartnerArchetype = newArchetype;
            }
            updateComparisonView();
        }

        // Alias for button onclick
        function navigateDefinitionModal(direction) {
            navigateDefinition(direction);
        }

        function showArchetypeInfoByType(archetypeId) {
            if (!data || !data.archetypes || !data.archetypes[archetypeId]) {
                console.error('Data not available for archetype:', archetypeId);
                return;
            }

            const arch = data.archetypes[archetypeId];
            const def = archetypeDefinitions[archetypeId];

            // Top navigation dots and swipe hint
            let topNav = `
                <div class="definition-nav-dots" style="display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                    ${archetypeOrder.map((id, index) => `
                        <span class="definition-dot${index === currentDefinitionIndex ? ' active' : ''}"
                              onclick="navigateDefinitionToIndex(${index})"
                              style="width: 10px; height: 10px; border-radius: 50%; background: ${index === currentDefinitionIndex ? 'var(--primary)' : 'var(--border)'}; cursor: pointer; transition: all 0.2s;"></span>
                    `).join('')}
                </div>
                <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-bottom: 15px;">← Wischen zum Navigieren →</div>
            `;

            let modalContent = topNav + `
                <div class="modal-category">
                    <div class="modal-category-header">
                        <div class="modal-category-letter" style="background: ${arch.color}; width: 40px; height: 40px; font-size: 20px;">${icons[archetypeId]}</div>
                        <div class="modal-category-name">${arch.name}</div>
                    </div>
                    <div class="modal-category-desc">${arch.shortDescription || ''}</div>
            `;

            if (def) {
                modalContent += `
                    <div class="definition-long" style="margin-top: 15px;">${def.longDef || ''}</div>
                `;

                if (def.keyPrinciples && def.keyPrinciples.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">Kernprinzipien</div>
                            <ul class="definition-list principles">
                                ${def.keyPrinciples.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }

                if (def.notTheSameAs && def.notTheSameAs.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">Das ist NICHT</div>
                            <ul class="definition-list not-same">
                                ${def.notTheSameAs.map(n => `<li>${n}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }

                if (def.variants && def.variants.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">Varianten</div>
                            <ul class="definition-list variants">
                                ${def.variants.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            // Add Pathos & Logos section
            const pathos = arch.pathos || '';
            const logos = arch.logos || '';

            if (pathos || logos) {
                modalContent += `
                    <div class="definition-section" style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px;">
                        <div class="definition-section-title" style="margin-bottom: 15px;">Pathos & Logos</div>
                `;

                if (pathos) {
                    modalContent += `
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(231,76,60,0.1); border-radius: 10px; border-left: 3px solid #e74c3c;">
                            <div style="color: #e74c3c; font-weight: 600; font-size: 13px; margin-bottom: 6px;">Pathos (Emotionale Ebene)</div>
                            <p style="color: var(--text-secondary); font-style: italic; line-height: 1.5; font-size: 12px; margin: 0;">${pathos}</p>
                        </div>
                    `;
                }

                if (logos) {
                    modalContent += `
                        <div style="padding: 12px; background: rgba(52,152,219,0.1); border-radius: 10px; border-left: 3px solid #3498db;">
                            <div style="color: #3498db; font-weight: 600; font-size: 13px; margin-bottom: 6px;">Logos (Rationale Ebene)</div>
                            <p style="color: var(--text-secondary); font-style: italic; line-height: 1.5; font-size: 12px; margin: 0;">${logos}</p>
                        </div>
                    `;
                }

                modalContent += `</div>`;
            }

            modalContent += '</div>';

            // Add navigation dots and confirm button
            modalContent += `
                <div class="definition-nav-dots" style="display: flex; justify-content: center; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                    ${archetypeOrder.map((id, index) => `
                        <span class="definition-dot${index === currentDefinitionIndex ? ' active' : ''}"
                              onclick="navigateDefinitionToIndex(${index})"
                              style="width: 10px; height: 10px; border-radius: 50%; background: ${index === currentDefinitionIndex ? 'var(--primary)' : 'var(--border)'}; cursor: pointer; transition: all 0.2s;"></span>
                    `).join('')}
                </div>
                <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-top: 8px;">← Wischen zum Navigieren →</div>
                <button onclick="confirmDefinitionSelection()" style="
                    display: block;
                    width: 100%;
                    margin-top: 15px;
                    padding: 12px 20px;
                    background: var(--primary);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                    Auswahl übernehmen
                </button>
            `;

            document.getElementById('definitionModalTitle').textContent = `${arch.name} - Definition`;
            document.getElementById('definitionModalBody').innerHTML = modalContent;
        }

        function navigateDefinitionToIndex(index) {
            currentDefinitionIndex = index;
            const newArchetype = archetypeOrder[index];
            showArchetypeInfoByType(newArchetype);

            // Sync the new archetype to the dropdown selection
            if (currentDefinitionPerson === 'ich') {
                document.getElementById('ichSelect').value = newArchetype;
                document.getElementById('mobileIchSelect').value = newArchetype;
                currentArchetype = newArchetype;
                mobileIchArchetype = newArchetype;
            } else if (currentDefinitionPerson === 'partner') {
                document.getElementById('partnerSelect').value = newArchetype;
                document.getElementById('mobilePartnerSelect').value = newArchetype;
                selectedPartner = newArchetype;
                mobilePartnerArchetype = newArchetype;
            }
            updateComparisonView();
        }

        function confirmDefinitionSelection() {
            console.log('confirmDefinitionSelection called');
            console.log('currentDefinitionIndex:', currentDefinitionIndex);
            console.log('archetypeOrder:', archetypeOrder);

            const selectedArchetype = archetypeOrder[currentDefinitionIndex];
            console.log('selectedArchetype:', selectedArchetype);
            console.log('currentDefinitionPerson:', currentDefinitionPerson);

            if (currentDefinitionPerson === 'ich') {
                // Update main dropdown
                currentArchetype = selectedArchetype;
                const selectElement = document.getElementById('archetypeSelect');
                if (selectElement) {
                    selectElement.value = selectedArchetype;
                    // Dispatch change event to ensure listeners are notified
                    selectElement.dispatchEvent(new Event('change', { bubbles: true }));
                }
                console.log('Updated currentArchetype to:', currentArchetype);
                updateAll();
            } else {
                // Update partner selection
                console.log('Calling selectPartner with:', selectedArchetype);
                selectPartner(selectedArchetype);
            }

            // Close modal
            document.getElementById('definitionModal').classList.remove('active');
            document.body.style.overflow = '';
            console.log('Modal closed, selection complete');
        }

        // Get short definition for tooltip
        function getShortDef(archetypeId) {
            return archetypeDefinitions[archetypeId]?.shortDef || '';
        }

        // Store current match data for modal access
        let currentTopMatch = { id: null, score: 0 };
        let currentChallenge = { id: null, score: 0 };
        let modalContextPartner = null; // Track which partner to use in category modal

        // Match Modal Functions
        function openMatchModal(type) {
            const matchData = type === 'top' ? currentTopMatch : currentChallenge;
            if (!matchData.id) return;

            // Set the modal context to use this match's partner
            modalContextPartner = matchData.id;

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[matchData.id];
            const interactionKey = `${currentArchetype}_${matchData.id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const title = type === 'top' ? 'Top Match' : 'Challenge';
            const scoreColor = getScoreColor(matchData.score);

            document.getElementById('modalTitle').textContent = `${myArch.name} + ${partnerArch.name}`;
            document.getElementById('modalBody').innerHTML = getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch) {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const overall = interaction.overall || 0;
            const isIdenticalType = myArch.id === partnerArch.id;

            const categoryBars = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                // Special note for identical types on category A (Beziehungsphilosophie)
                const isPhilosophyCategory = cat === 'A' && isIdenticalType;
                const specialNote = isPhilosophyCategory
                    ? '<div style="font-size: 10px; color: var(--success); margin-top: 2px;">Identische Grundüberzeugung</div>'
                    : '';

                return `
                    <div class="match-modal-bar-row clickable" onclick="openSingleCategoryModal('${cat}')">
                        <span class="match-modal-bar-label">${cat}</span>
                        <div class="match-modal-bar-container">
                            <div class="match-modal-bar ${barClass}" style="width: ${value}%">
                                <span class="match-modal-bar-value">${value}%</span>
                            </div>
                            ${specialNote}
                        </div>
                        <span class="match-modal-bar-name">${name}</span>
                    </div>
                `;
            }).join('');

            const proItems = (interaction.pro || []).map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';
            const contraItems = (interaction.contra || []).map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';

            // Special banner for identical types
            const identicalTypeBanner = isIdenticalType ? `
                <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(46, 204, 113, 0.05));
                            border: 1px solid var(--success); border-radius: 10px; padding: 12px; margin-bottom: 15px; text-align: center;">
                    <div style="font-weight: 600; color: var(--success); margin-bottom: 4px;">✓ Identischer Beziehungstyp</div>
                    <div style="font-size: var(--font-sm); color: var(--text-secondary);">
                        Ihr teilt dieselbe Grundüberzeugung über Beziehungen
                    </div>
                </div>
            ` : '';

            const comboText = `${myArch.name} + ${partnerArch.name}`;
            const myDef = archetypeDefinitions[myArch.id]?.shortDef || '';
            const partnerDef = archetypeDefinitions[partnerArch.id]?.shortDef || '';

            return `
                <div class="modal-feedback-btn" onclick="openFeedbackModalWithContext('${comboText}')">
                    💬 Feedback zu ${comboText}
                </div>

                <div class="match-modal-header">
                    <div class="match-modal-icon" style="background: ${partnerArch.color}">${icons[partnerArch.id]}</div>
                    <div class="match-modal-info">
                        <h3 style="color: ${partnerArch.color}">
                            ${partnerArch.name}
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" title="Definition anzeigen">ℹ</span>
                        </h3>
                        <p>${partnerArch.shortDescription || ''}</p>
                    </div>
                </div>

                ${identicalTypeBanner}

                <div class="type-definitions-compact" style="background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 15px; font-size: var(--font-sm);">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${myArch.color}; font-weight: 600;">${icons[myArch.id]} ${myArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${myArch.id}')" style="margin-left: 4px;">ℹ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${myDef}</div>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${partnerArch.color}; font-weight: 600;">${icons[partnerArch.id]} ${partnerArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" style="margin-left: 4px;">ℹ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${partnerDef}</div>
                        </div>
                    </div>
                </div>

                <div class="match-modal-score">
                    <span class="match-modal-score-label">Beziehungsqualität ${isIdenticalType ? '(gleicher Typ)' : 'mit ' + myArch.name}</span>
                    <span class="match-modal-score-value" style="color: ${scoreColor}">${overall}%</span>
                </div>

                <div class="match-modal-categories">
                    <div class="match-modal-categories-title">Kategorie-Bewertungen</div>
                    ${categoryBars}
                </div>

                <div class="match-modal-section pro">
                    <div class="match-modal-section-title">✓ Was funktioniert</div>
                    <ul class="match-modal-list">${proItems}</ul>
                </div>

                <div class="match-modal-section contra">
                    <div class="match-modal-section-title">✗ Herausforderungen</div>
                    <ul class="match-modal-list">${contraItems}</ul>
                </div>
            `;
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCategoryModal();
            }
        });

        // ==========================================
        // FEEDBACK SYSTEM (entfernt - commentModal wird verwendet)
        // ==========================================
        // Leere Stubs um JavaScript-Fehler zu vermeiden
        function openFeedbackModal() { console.log('feedbackModal entfernt - bitte commentModal verwenden'); }
        function openFeedbackModalWithContext(ctx) { console.log('feedbackModal entfernt - bitte commentModal verwenden'); }
        function closeFeedbackModal(event) { }
        function initStarRatings() { }

        // Legacy function stub
        async function submitFeedback() {
            const name = document.getElementById('feedbackName').value.trim();
            const titel = document.getElementById('feedbackTitle').value.trim();
            const kommentar = document.getElementById('feedbackComment').value.trim();
            const kontextId = replyToId
                ? document.getElementById('feedbackContextId').textContent
                : getModalContextId();

            // Validation
            if (!name) {
                alert('Bitte gib deinen Namen/Kürzel ein.');
                return;
            }
            if (!titel) {
                alert('Bitte gib einen Titel ein.');
                return;
            }

            const feedbackEntry = {
                id: generateFeedbackId(),
                kontextId,
                name,
                titel,
                kommentar,
                verstand: feedbackRatings.verstand,
                gefuehl: feedbackRatings.gefuehl,
                antwortAuf: replyToId || ''
            };

            const submitBtn = document.getElementById('feedbackSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sende...';

            try {
                if (GOOGLE_SCRIPT_URL) {
                    // Send to Google Sheets
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(feedbackEntry)
                    });
                }

                // Also save locally as backup
                saveLocalFeedback(feedbackEntry);

                alert('Danke für dein Feedback!');
                replyToId = null; // Reset reply state
                closeFeedbackModal();

                // Reload feedback to show the new entry
                setTimeout(() => loadFeedback(), 500);

            } catch (error) {
                console.error('Feedback error:', error);
                // Save locally on error
                saveLocalFeedback(feedbackEntry);
                alert('Feedback lokal gespeichert. (Server nicht erreichbar)');
                replyToId = null;
                closeFeedbackModal();
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Senden';
        }

        // Local storage backup - alles in tiage_comments
        function saveLocalFeedback(entry) {
            const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
            entry.timestamp = new Date().toISOString();
            entry.Typ = 'comment';  // Einheitlicher Typ
            stored.unshift(entry);
            localStorage.setItem('tiage_comments', JSON.stringify(stored));
        }

        function getLocalFeedback() {
            return JSON.parse(localStorage.getItem('tiage_comments') || '[]');
        }

        // Load and display feedback
        async function loadFeedback() {
            const container = document.getElementById('feedbackList');

            try {
                if (GOOGLE_SCRIPT_URL) {
                    // Try to load from Google Sheets
                    const response = await fetch(GOOGLE_SCRIPT_URL);
                    const serverData = await response.json();
                    feedbackData = serverData.reverse(); // Newest first
                } else {
                    // Use local data only
                    feedbackData = getLocalFeedback();
                }
            } catch (error) {
                console.error('Load feedback error:', error);
                // Fallback to local
                feedbackData = getLocalFeedback();
            }

            // Populate type filter dropdowns
            populateTypeFilters();
            renderFeedbackList();
        }

        // Populate type dropdowns for filters
        function populateTypeFilters() {
            const archetypes = Object.values(data?.archetypes || {});
            const myTypeSelect = document.getElementById('filterMyType');
            const partnerTypeSelect = document.getElementById('filterPartnerType');

            const options = archetypes.map(a =>
                `<option value="${a.id}">${a.name}</option>`
            ).join('');

            myTypeSelect.innerHTML = `<option value="all">Alle Typen</option>${options}`;
            partnerTypeSelect.innerHTML = `<option value="all">Alle Partner</option>${options}`;
        }

        function renderFeedbackList() {
            const container = document.getElementById('feedbackList');

            // Apply all filters
            let filtered = feedbackData.filter(f => {
                const kontextId = (f.KontextID || f.kontextId || '').toLowerCase();
                const name = (f.Name || f.name || '').toLowerCase();
                const titel = (f.Titel || f.titel || '').toLowerCase();
                const kommentar = (f.Kommentar || f.kommentar || '').toLowerCase();
                const antwortAuf = f.AntwortAuf || f.antwortAuf || '';

                // Skip replies in main list (they'll be shown as threads)
                if (antwortAuf) return false;

                // Search filter
                if (feedbackFilters.search) {
                    const search = feedbackFilters.search.toLowerCase();
                    if (!name.includes(search) && !titel.includes(search) && !kommentar.includes(search)) {
                        return false;
                    }
                }

                // Type filters (parse from context ID like "Single (Ich) mit Duo")
                if (feedbackFilters.myType !== 'all' || feedbackFilters.partnerType !== 'all') {
                    const myTypeName = data?.archetypes?.[feedbackFilters.myType]?.name?.toLowerCase();
                    const partnerTypeName = data?.archetypes?.[feedbackFilters.partnerType]?.name?.toLowerCase();

                    if (feedbackFilters.myType !== 'all' && myTypeName) {
                        if (!kontextId.includes(myTypeName)) return false;
                    }
                    if (feedbackFilters.partnerType !== 'all' && partnerTypeName) {
                        if (!kontextId.includes('mit ' + partnerTypeName)) return false;
                    }
                }

                // Category filter
                if (feedbackFilters.category !== 'all') {
                    const cat = feedbackFilters.category;
                    if (cat === 'TM') {
                        if (!kontextId.includes('top match')) return false;
                    } else if (cat === 'CH') {
                        if (!kontextId.includes('challenge')) return false;
                    } else {
                        // Category A-F: check for category name
                        const catName = categoryNames[cat]?.toLowerCase();
                        if (catName && !kontextId.includes(catName)) return false;
                    }
                }

                return true;
            });

            // Sort
            if (feedbackFilters.sort === 'oldest') {
                filtered = filtered.reverse();
            } else if (feedbackFilters.sort === 'rating') {
                filtered.sort((a, b) => {
                    const aRating = (a.Verstand || a.verstand || 0) + (a.Gefuehl || a.gefuehl || 0);
                    const bRating = (b.Verstand || b.verstand || 0) + (b.Gefuehl || b.gefuehl || 0);
                    return bRating - aRating;
                });
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="feedback-empty">
                        ${feedbackData.length === 0
                            ? 'Noch kein Feedback vorhanden.<br>Sei der Erste!'
                            : 'Kein Feedback für diesen Filter.'}
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(f => renderFeedbackItem(f)).join('');
        }

        // Render single feedback item with replies
        function renderFeedbackItem(f, isReply = false) {
            const id = f.Id || f.id || f.timestamp || '';
            const kontextId = f.KontextID || f.kontextId || '-';
            const name = f.Name || f.name || 'Anonym';
            const titel = f.Titel || f.titel || '';
            const kommentar = f.Kommentar || f.kommentar || '';
            const verstand = f.Verstand || f.verstand || 0;
            const gefuehl = f.Gefuehl || f.gefuehl || 0;
            const timestamp = f.Timestamp || f.timestamp || '';

            // Find replies to this item
            const replies = feedbackData.filter(r =>
                (r.AntwortAuf || r.antwortAuf) === id
            );

            const timeStr = timestamp ? new Date(timestamp).toLocaleDateString('de-DE') : '';

            return `
                <div class="feedback-item ${isReply ? 'reply' : ''}" data-id="${id}">
                    <div class="feedback-item-header">
                        <span class="feedback-item-context">${kontextId}</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="feedback-item-name">${name}</span>
                            ${timeStr ? `<span class="feedback-timestamp">${timeStr}</span>` : ''}
                        </div>
                    </div>
                    <div class="feedback-item-title">${titel}</div>
                    ${kommentar ? `<div class="feedback-item-comment">${kommentar}</div>` : ''}
                    <div class="feedback-item-footer">
                        <div class="feedback-item-ratings">
                            <div class="feedback-rating">
                                <span>Verstand:</span>
                                <span class="stars">${'★'.repeat(verstand)}${'☆'.repeat(5-verstand)}</span>
                            </div>
                            <div class="feedback-rating">
                                <span>Gefühl:</span>
                                <span class="stars">${'★'.repeat(gefuehl)}${'☆'.repeat(5-gefuehl)}</span>
                            </div>
                        </div>
                        <button class="feedback-reply-btn" onclick="openReplyModal('${id}', '${name}')">
                            ↩ Antworten
                        </button>
                    </div>
                    ${replies.length > 0 ? `
                        <div class="feedback-replies">
                            ${replies.map(r => renderFeedbackItem(r, true)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Open reply modal
        function openReplyModal(parentId, parentName) {
            replyToId = parentId;
            document.getElementById('feedbackContextId').innerHTML =
                `<span class="reply-indicator">↩ Antwort auf ${parentName}</span>`;
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackTitle').value = '';
            document.getElementById('feedbackComment').value = '';
            feedbackRatings = { verstand: 0, gefuehl: 0 };
            updateStarDisplay('ratingVerstand', 0);
            updateStarDisplay('ratingGefuehl', 0);
        }

        // Initialize advanced filters
        function initAdvancedFilters() {
            // Search input
            document.getElementById('feedbackSearch').addEventListener('input', (e) => {
                feedbackFilters.search = e.target.value;
                renderFeedbackList();
            });

            // Type selects
            document.getElementById('filterMyType').addEventListener('change', (e) => {
                feedbackFilters.myType = e.target.value;
                renderFeedbackList();
            });

            document.getElementById('filterPartnerType').addEventListener('change', (e) => {
                feedbackFilters.partnerType = e.target.value;
                renderFeedbackList();
            });

            // Category buttons
            document.querySelectorAll('.cat-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.cat-filter-btn').forEach(b =>
                        b.classList.remove('active')
                    );
                    btn.classList.add('active');
                    feedbackFilters.category = btn.dataset.cat;
                    renderFeedbackList();
                });
            });

            // Sort select
            document.getElementById('filterSort').addEventListener('change', (e) => {
                feedbackFilters.sort = e.target.value;
                renderFeedbackList();
            });
        }

        // Initialize feedback system
        function initFeedbackSystem() {
            initStarRatings();
            initAdvancedFilters();
        }

        // Age Verification - Modal shows on EVERY visit (no localStorage)
        function checkAgeVerification() {
            // Modal always shows - no localStorage check
            const modal = document.getElementById('ageVerificationModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
                document.body.style.overflow = 'hidden';
            }
        }

        // Make confirmAge globally available - no localStorage storage
        window.confirmAge = function(isAdult) {
            console.log('confirmAge called with:', isAdult);
            if (isAdult) {
                var modal = document.getElementById('ageVerificationModal');
                if (modal) {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                }
                document.body.style.overflow = 'auto';
            } else {
                window.location.href = 'https://www.google.com';
            }
        };

        // Also keep the regular function reference
        function confirmAge(isAdult) {
            window.confirmAge(isAdult);
        }

        // Initialize age verification - robust version with multiple fallbacks
        function initAgeVerification() {
            const modal = document.getElementById('ageVerificationModal');
            const yesButton = document.getElementById('ageVerifyYes');
            const noButton = document.getElementById('ageVerifyNo');

            // Helper function to handle age confirmation - no localStorage
            function handleAgeConfirm(isAdult, event) {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                console.log('handleAgeConfirm called:', isAdult);

                if (isAdult) {
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        modal.style.pointerEvents = 'none';
                    }
                    document.body.style.overflow = 'auto';
                } else {
                    window.location.href = 'https://www.google.com';
                }
            }

            // Add event listeners to YES button
            if (yesButton) {
                yesButton.style.pointerEvents = 'auto';
                yesButton.style.cursor = 'pointer';
                yesButton.style.position = 'relative';
                yesButton.style.zIndex = '10002';

                // Remove old onclick to prevent double-firing
                yesButton.removeAttribute('onclick');

                // Add multiple event types for maximum compatibility
                yesButton.addEventListener('click', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });

                yesButton.addEventListener('touchend', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });

                // Also handle mousedown as fallback
                yesButton.addEventListener('mousedown', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });
            }

            // Add event listeners to NO button
            if (noButton) {
                noButton.style.pointerEvents = 'auto';
                noButton.style.cursor = 'pointer';
                noButton.style.position = 'relative';
                noButton.style.zIndex = '10002';

                // Remove old onclick
                noButton.removeAttribute('onclick');

                noButton.addEventListener('click', function(e) {
                    handleAgeConfirm(false, e);
                }, { passive: false, capture: true });

                noButton.addEventListener('touchend', function(e) {
                    handleAgeConfirm(false, e);
                }, { passive: false, capture: true });
            }

            // Always show modal on page load - no localStorage check
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
                document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
            }
        }

        // ========================================
        // Extended Dimensions Functions
        // ========================================

        function showDimensionTooltip(type) {
            // Try to get translated tooltip first, fall back to hardcoded
            let tooltip = TiageI18n.t(`tooltips.${type}`);
            if (!tooltip || typeof tooltip !== 'object' || !tooltip.title) {
                tooltip = dimensionTooltips[type];
            }
            if (!tooltip) return;

            document.getElementById('dimensionTooltipTitle').textContent = tooltip.title;
            document.getElementById('dimensionTooltipText').innerHTML = tooltip.text.replace(/\n/g, '<br>');
            document.getElementById('dimensionTooltipOverlay').classList.add('active');
        }

        function closeDimensionTooltip() {
            document.getElementById('dimensionTooltipOverlay').classList.remove('active');
        }

        // ========================================
        // Geschlecht Info Modal Functions
        // ========================================
        function showGeschlechtInfoModal() {
            document.getElementById('geschlechtInfoModal').classList.add('active');
        }

        function closeGeschlechtInfoModal() {
            document.getElementById('geschlechtInfoModal').classList.remove('active');
        }

        // ========================================
        // Dominanz Info Modal Functions
        // ========================================
        function showDominanzInfoModal() {
            document.getElementById('dominanzInfoModal').classList.add('active');
        }

        function closeDominanzInfoModal() {
            document.getElementById('dominanzInfoModal').classList.remove('active');
        }

        // ========================================
        // Orientierung Info Modal Functions
        // ========================================
        function showOrientierungInfoModal() {
            document.getElementById('orientierungInfoModal').classList.add('active');
        }

        function closeOrientierungInfoModal() {
            document.getElementById('orientierungInfoModal').classList.remove('active');
        }

        // ═══════════════════════════════════════════════════════════════════════
        // GESCHLECHT PRIMARY/SECONDARY SYSTEM
        // ═══════════════════════════════════════════════════════════════════════

        /**
         * Handle click on a Geschlecht button
         * Logic:
         * - First click = Primary (I indicator)
         * - Second click on different = Secondary (G indicator)
         * - Click on Primary = Clear both (primary and secondary)
         * - Click on Secondary = Clear only secondary
         */
        function handleGeschlechtClick(person, geschlechtValue, btn) {
            // Ensure geschlecht has correct structure (migration from old format)
            if (!personDimensions[person].geschlecht ||
                !('primary' in personDimensions[person].geschlecht)) {
                personDimensions[person].geschlecht = { primary: null, secondary: null };
            }

            const currentPrimary = personDimensions[person].geschlecht.primary;
            const currentSecondary = personDimensions[person].geschlecht.secondary;

            if (geschlechtValue === currentPrimary) {
                // Click on Primary: Clear both
                personDimensions[person].geschlecht.primary = null;
                personDimensions[person].geschlecht.secondary = null;
            } else if (geschlechtValue === currentSecondary) {
                // Click on Secondary: Clear only secondary
                personDimensions[person].geschlecht.secondary = null;
            } else if (!currentPrimary) {
                // No primary yet: Set as primary (handles both null and undefined)
                personDimensions[person].geschlecht.primary = geschlechtValue;
            } else {
                // Primary exists, different value clicked: Set as secondary
                personDimensions[person].geschlecht.secondary = geschlechtValue;
            }

            // Sync with mobilePersonDimensions for mobile view consistency
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].geschlecht.primary = personDimensions[person].geschlecht.primary;
                mobilePersonDimensions[person].geschlecht.secondary = personDimensions[person].geschlecht.secondary;
            }

            // Sync with TiageState if available
            if (typeof TiageState !== 'undefined') {
                TiageState.set(`personDimensions.${person}.geschlecht`, personDimensions[person].geschlecht);
            }

            // Sync all UIs
            syncGeschlechtUI(person);

            // Remove needs-selection if primary is set
            const hasPrimary = personDimensions[person].geschlecht.primary !== null;
            document.querySelectorAll(`[data-dimension="${person}-geschlecht-new"], [data-dimension="mobile-${person}-geschlecht"], [data-dimension="${person}-geschlecht"]`).forEach(dim => {
                if (hasPrimary) {
                    dim.classList.remove('needs-selection');
                } else {
                    dim.classList.add('needs-selection');
                }
            });

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        /**
         * Sync Geschlecht UI across all views (Desktop, Mobile, Modal)
         */
        function syncGeschlechtUI(person) {
            const primary = personDimensions[person].geschlecht.primary;
            const secondary = personDimensions[person].geschlecht.secondary;

            // All geschlecht button selectors for this person
            const selectors = [
                `.geschlecht-grid[data-person="${person}"] .geschlecht-btn`,
                `#${person}-geschlecht-grid .geschlecht-btn`,
                `#mobile-${person}-geschlecht-grid .geschlecht-btn`,
                `#modal-${person}-geschlecht-grid .geschlecht-btn`
            ];

            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(btn => {
                    const value = btn.dataset.value;

                    // Remove all states
                    btn.classList.remove('primary-selected', 'secondary-selected');

                    // Remove existing indicators
                    const existingIndicator = btn.querySelector('.geschlecht-indicator');
                    if (existingIndicator) {
                        existingIndicator.remove();
                    }

                    // Add appropriate state and indicator
                    if (value === primary) {
                        btn.classList.add('primary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-primary';
                        indicator.textContent = 'I';
                        indicator.title = 'Identität (Primär)';
                        btn.appendChild(indicator);
                    } else if (value === secondary) {
                        btn.classList.add('secondary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-secondary';
                        indicator.textContent = 'G';
                        indicator.title = 'Geschlecht (Sekundär)';
                        btn.appendChild(indicator);
                    }
                });
            });

            // Also sync legacy radio buttons if they exist
            document.querySelectorAll(`input[name="${person}-geschlecht"]`).forEach(radio => {
                radio.checked = (radio.value === primary);
            });
            document.querySelectorAll(`input[name="${person}-geschlecht-new"]`).forEach(radio => {
                radio.checked = (radio.value === primary);
            });
            document.querySelectorAll(`input[name="mobile-${person}-geschlecht"]`).forEach(radio => {
                radio.checked = (radio.value === primary);
            });

            // Update collapsed summary for geschlecht
            updateGeschlechtSummary(person);
        }

        /**
         * Get summary text for geschlecht selection
         */
        function getGeschlechtSummary(person) {
            const primary = personDimensions[person].geschlecht.primary;
            const secondary = personDimensions[person].geschlecht.secondary;

            if (!primary) {
                return 'Geschlecht fehlt';
            }

            const parts = [];
            const primaryLabel = TiageI18n.t(`geschlecht.types.${primary}`, primary);
            parts.push(primaryLabel + ' (I)');

            if (secondary) {
                const secondaryLabel = TiageI18n.t(`geschlecht.types.${secondary}`, secondary);
                parts.push(secondaryLabel + ' (G)');
            }

            return '✓ ' + parts.join(', ');
        }

        /**
         * Get summary text for geschlecht selection in grid (without 'fehlt' text)
         * Returns selected values in green, or empty string if nothing selected
         */
        function getGeschlechtGridSummary(person) {
            const primary = personDimensions[person].geschlecht.primary;
            const secondary = personDimensions[person].geschlecht.secondary;

            if (!primary) {
                return ''; // No 'fehlt' text for grid - only show selections
            }

            const parts = [];
            const primaryLabel = TiageI18n.t(`geschlecht.types.${primary}`, primary);
            parts.push(primaryLabel + ' (I)');

            if (secondary) {
                const secondaryLabel = TiageI18n.t(`geschlecht.types.${secondary}`, secondary);
                parts.push(secondaryLabel + ' (G)');
            }

            return '✓ ' + parts.join(', ');
        }

        /**
         * Update header summary for geschlecht (only in header area, not in collapsed-summary)
         */
        function updateGeschlechtSummary(person) {
            const summaryText = getGeschlechtSummary(person);
            const gridSummaryText = getGeschlechtGridSummary(person);
            const isMissing = !personDimensions[person].geschlecht.primary;

            // Update header element (shows 'fehlt' if nothing selected)
            const headerId = `${person}-header-geschlecht`;
            const header = document.getElementById(headerId);
            if (header) {
                header.textContent = summaryText;
                header.classList.toggle('missing', isMissing);
            }

            // Update grid collapsed-summary (only shows selections in green, no 'fehlt')
            ['', 'mobile-'].forEach(prefix => {
                const summaryId = `${prefix}${person}-geschlecht-summary`;
                const summary = document.getElementById(summaryId);
                if (summary) {
                    summary.textContent = gridSummaryText;
                    summary.classList.toggle('has-selection', !isMissing);
                }
            });
        }

        /**
         * Check if geschlecht has any selection (primary)
         */
        function hasGeschlechtSelected(person) {
            return personDimensions[person].geschlecht.primary !== null;
        }

        /**
         * Handle hover on geschlecht button - highlight I or G in legend
         * Based on click logic: if no primary -> next click sets I, if primary exists -> next click sets G
         */
        function handleGeschlechtHover(person, geschlechtValue, isEntering) {
            const legendSelectors = [
                `#${person}-geschlecht-legend`,
                `#mobile-${person}-geschlecht-legend`
            ];

            legendSelectors.forEach(selector => {
                const legend = document.querySelector(selector);
                if (!legend) return;

                if (!isEntering) {
                    // Mouse left - remove all highlights
                    legend.classList.remove('highlight-i', 'highlight-g');
                    return;
                }

                // Mouse entered - determine which to highlight based on click logic
                const currentPrimary = personDimensions[person].geschlecht.primary;
                const currentSecondary = personDimensions[person].geschlecht.secondary;

                legend.classList.remove('highlight-i', 'highlight-g');

                if (geschlechtValue === currentPrimary || geschlechtValue === currentSecondary) {
                    // Hovering over already selected - highlight what would be affected
                    if (geschlechtValue === currentPrimary) {
                        legend.classList.add('highlight-i');
                    } else {
                        legend.classList.add('highlight-g');
                    }
                } else if (currentPrimary === null) {
                    // No primary yet: next click sets primary (I)
                    legend.classList.add('highlight-i');
                } else {
                    // Primary exists, different value: next click sets secondary (G)
                    legend.classList.add('highlight-g');
                }
            });
        }

        // ═══════════════════════════════════════════════════════════════════════
        // DYNAMISCHE BUTTON-GENERIERUNG (Harmonisierung Desktop/Mobile/Modal)
        // ═══════════════════════════════════════════════════════════════════════

        /**
         * Initialisiert alle Dimension-Buttons dynamisch
         * Ersetzt statische HTML-Buttons durch dynamisch generierte
         */
        function initDimensionButtons() {
            // Geschlechtsidentität Optionen
            const geschlechtOptions = [
                { value: 'cis_mann', label: 'Cis Mann' },
                { value: 'cis_frau', label: 'Cis Frau' },
                { value: 'trans_mann', label: 'Trans Mann' },
                { value: 'trans_frau', label: 'Trans Frau' },
                { value: 'nonbinaer', label: 'Nonbinär' },
                { value: 'genderfluid', label: 'Genderfluid' },
                { value: 'agender', label: 'Agender' },
                { value: 'intersex', label: 'Intersex' },
                { value: 'divers', label: 'Divers' }
            ];

            // Dominanz Optionen
            const dominanzOptions = [
                { value: 'dominant', label: 'dominant' },
                { value: 'submissiv', label: 'submissiv' },
                { value: 'switch', label: 'switch' },
                { value: 'ausgeglichen', label: 'ausgeglichen' }
            ];

            // Orientierung Optionen
            const orientierungOptions = [
                { value: 'heterosexuell', label: 'heterosexuell' },
                { value: 'homosexuell', label: 'homosexuell' },
                { value: 'bisexuell', label: 'bisexuell' }
            ];

            // Geschlecht-Grids befüllen
            document.querySelectorAll('.geschlecht-grid').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;
                grid.innerHTML = geschlechtOptions.map(opt =>
                    `<button type="button" class="geschlecht-btn" data-value="${opt.value}" onclick="handleGeschlechtClick('${person}', '${opt.value}', this)">${opt.label}</button>`
                ).join('');
            });

            // Dominanz-Grids befüllen (nur Desktop mit data-person)
            document.querySelectorAll('.dominanz-grid[data-person]').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;
                grid.innerHTML = dominanzOptions.map(opt =>
                    `<button type="button" class="dominanz-btn" data-value="${opt.value}" onclick="handleDominanzClick('${person}', '${opt.value}', this)">${opt.label}</button>`
                ).join('');
            });

            // Orientierung-Grids befüllen (nur Desktop mit data-person)
            document.querySelectorAll('.orientierung-grid[data-person]').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;
                grid.innerHTML = orientierungOptions.map(opt =>
                    `<button type="button" class="orientierung-btn" data-value="${opt.value}" onclick="handleOrientierungClick('${person}', '${opt.value}', this)">${opt.label}</button>`
                ).join('');
            });

            // UI mit gespeichertem State synchronisieren
            ['ich', 'partner'].forEach(person => {
                syncGeschlechtUI(person);
                syncDominanzUI(person);
                syncOrientierungUI(person);
            });
        }

        /**
         * Initialize geschlecht hover events for all grids
         */
        function initGeschlechtHoverEvents() {
            document.querySelectorAll('.geschlecht-grid').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;

                grid.querySelectorAll('.geschlecht-btn').forEach(btn => {
                    const value = btn.dataset.value;

                    btn.addEventListener('mouseenter', () => {
                        handleGeschlechtHover(person, value, true);
                    });

                    btn.addEventListener('mouseleave', () => {
                        handleGeschlechtHover(person, value, false);
                    });
                });
            });
        }

        // ═══════════════════════════════════════════════════════════════════════
        // DOMINANZ PRIMARY/SECONDARY SYSTEM (same logic as Geschlechtsidentität)
        // ═══════════════════════════════════════════════════════════════════════

        /**
         * Handle click on a Dominanz button
         * Logic (same as Geschlechtsidentität):
         * - First click = Primary (I indicator)
         * - Second click on different = Secondary (G indicator)
         * - Click on Primary = Clear both (primary and secondary)
         * - Click on Secondary = Clear only secondary
         */
        function handleDominanzClick(person, dominanzValue, btn) {
            // Ensure dominanz has correct structure (migration from old format)
            if (!personDimensions[person].dominanz ||
                !('primary' in personDimensions[person].dominanz)) {
                personDimensions[person].dominanz = { primary: null, secondary: null };
            }

            const currentPrimary = personDimensions[person].dominanz.primary;
            const currentSecondary = personDimensions[person].dominanz.secondary;

            if (dominanzValue === currentPrimary) {
                // Click on Primary: Clear both
                personDimensions[person].dominanz.primary = null;
                personDimensions[person].dominanz.secondary = null;
            } else if (dominanzValue === currentSecondary) {
                // Click on Secondary: Clear only secondary
                personDimensions[person].dominanz.secondary = null;
            } else if (!currentPrimary) {
                // No primary yet: Set as primary (handles both null and undefined)
                personDimensions[person].dominanz.primary = dominanzValue;
            } else {
                // Primary exists, different value clicked: Set as secondary
                personDimensions[person].dominanz.secondary = dominanzValue;
            }

            // Sync with mobilePersonDimensions for mobile view consistency
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].dominanz.primary = personDimensions[person].dominanz.primary;
                mobilePersonDimensions[person].dominanz.secondary = personDimensions[person].dominanz.secondary;
            }

            // Sync with TiageState if available
            if (typeof TiageState !== 'undefined') {
                TiageState.set(`personDimensions.${person}.dominanz`, personDimensions[person].dominanz);
            }

            // Sync all UIs
            syncDominanzUI(person);

            // Remove needs-selection if primary is set
            const hasPrimary = personDimensions[person].dominanz.primary !== null;
            document.querySelectorAll(`[data-dimension="${person}-dominanz-multi"], [data-dimension="mobile-${person}-dominanz"], [data-dimension="${person}-dominanz"]`).forEach(dim => {
                if (hasPrimary) {
                    dim.classList.remove('needs-selection');
                } else {
                    dim.classList.add('needs-selection');
                }
            });

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        /**
         * Sync Dominanz UI across all views (Desktop, Mobile, Modal)
         */
        function syncDominanzUI(person) {
            const primary = personDimensions[person].dominanz.primary;
            const secondary = personDimensions[person].dominanz.secondary;

            // All dominanz button selectors for this person
            const selectors = [
                `.dominanz-grid[data-person="${person}"] .dominanz-btn`,
                `#${person}-dominanz-grid .dominanz-btn`,
                `#mobile-${person}-dominanz-grid .dominanz-btn`,
                `#modal-${person}-dominanz-grid .dominanz-btn`
            ];

            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(btn => {
                    const value = btn.dataset.value;

                    // Remove all states
                    btn.classList.remove('primary-selected', 'secondary-selected');

                    // Remove existing indicators
                    const existingIndicator = btn.querySelector('.geschlecht-indicator');
                    if (existingIndicator) {
                        existingIndicator.remove();
                    }

                    // Add appropriate state and indicator
                    if (value === primary) {
                        btn.classList.add('primary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-primary';
                        indicator.textContent = 'I';
                        indicator.title = 'Identität (Primär)';
                        btn.appendChild(indicator);
                    } else if (value === secondary) {
                        btn.classList.add('secondary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-secondary';
                        indicator.textContent = 'G';
                        indicator.title = 'Sekundär';
                        btn.appendChild(indicator);
                    }
                });
            });

            // Update collapsed summary for dominanz
            updateDominanzSummary(person);
        }

        /**
         * Get summary text for dominanz selection
         */
        function getDominanzSummary(person) {
            const primary = personDimensions[person].dominanz.primary;
            const secondary = personDimensions[person].dominanz.secondary;

            if (!primary) {
                return 'Dominanz fehlt';
            }

            const parts = [];
            parts.push(primary + ' (I)');

            if (secondary) {
                parts.push(secondary + ' (G)');
            }

            return '✓ ' + parts.join(', ');
        }

        /**
         * Get summary text for dominanz selection in grid (without 'fehlt' text)
         * Returns selected values in green, or empty string if nothing selected
         */
        function getDominanzGridSummary(person) {
            const primary = personDimensions[person].dominanz.primary;
            const secondary = personDimensions[person].dominanz.secondary;

            if (!primary) {
                return ''; // No 'fehlt' text for grid - only show selections
            }

            const parts = [];
            parts.push(primary + ' (I)');

            if (secondary) {
                parts.push(secondary + ' (G)');
            }

            return '✓ ' + parts.join(', ');
        }

        /**
         * Update header summary for dominanz (only in header area, not in collapsed-summary)
         */
        function updateDominanzSummary(person) {
            const summaryText = getDominanzSummary(person);
            const gridSummaryText = getDominanzGridSummary(person);
            const isMissing = !personDimensions[person].dominanz.primary;

            // Update header element (shows 'fehlt' if nothing selected)
            const headerId = `${person}-header-dominanz`;
            const header = document.getElementById(headerId);
            if (header) {
                header.textContent = summaryText;
                header.classList.toggle('missing', isMissing);
            }

            // Update grid collapsed-summary (only shows selections in green, no 'fehlt')
            ['', 'mobile-'].forEach(prefix => {
                const summaryId = `${prefix}${person}-dominanz-summary`;
                const summary = document.getElementById(summaryId);
                if (summary) {
                    summary.textContent = gridSummaryText;
                    summary.classList.toggle('has-selection', !isMissing);
                }
            });

            // Update needs-selection classes
            ['', 'mobile-', 'modal-'].forEach(prefix => {
                const dim = document.querySelector(`[data-dimension="${prefix}${person}-dominanz-multi"]`);
                if (dim) {
                    if (!isMissing) dim.classList.remove('needs-selection');
                    else dim.classList.add('needs-selection');
                }
            });
        }

        // Helper: Check if any dominanz is selected (for backwards compatibility)
        function hasAnyDominanzSelected(person) {
            return personDimensions[person].dominanz.primary !== null;
        }

        // Get the primary dominanz type (for backwards compatibility)
        function getPrimaryFaktDominanz(person) {
            return personDimensions[person].dominanz.primary;
        }

        // Get the primary orientierung type (for backwards compatibility)
        function getPrimaryFaktOrientierung(person) {
            return personDimensions[person].orientierung.primary;
        }

        // ═══════════════════════════════════════════════════════════════════════
        // ORIENTIERUNG PRIMARY/SECONDARY SYSTEM (same logic as Geschlechtsidentität)
        // ═══════════════════════════════════════════════════════════════════════

        /**
         * Handle click on an Orientierung button
         * Logic (same as Geschlechtsidentität):
         * - First click = Primary (I indicator)
         * - Second click on different = Secondary (G indicator)
         * - Click on Primary = Clear both (primary and secondary)
         * - Click on Secondary = Clear only secondary
         */
        function handleOrientierungClick(person, orientierungValue, btn) {
            // Ensure orientierung has correct structure (migration from old format)
            if (!personDimensions[person].orientierung ||
                !('primary' in personDimensions[person].orientierung)) {
                personDimensions[person].orientierung = { primary: null, secondary: null };
            }

            const currentPrimary = personDimensions[person].orientierung.primary;
            const currentSecondary = personDimensions[person].orientierung.secondary;

            if (orientierungValue === currentPrimary) {
                // Click on Primary: Clear both
                personDimensions[person].orientierung.primary = null;
                personDimensions[person].orientierung.secondary = null;
            } else if (orientierungValue === currentSecondary) {
                // Click on Secondary: Clear only secondary
                personDimensions[person].orientierung.secondary = null;
            } else if (!currentPrimary) {
                // No primary yet: Set as primary (handles both null and undefined)
                personDimensions[person].orientierung.primary = orientierungValue;
            } else {
                // Primary exists, different value clicked: Set as secondary
                personDimensions[person].orientierung.secondary = orientierungValue;
            }

            // Sync with mobilePersonDimensions for mobile view consistency
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].orientierung.primary = personDimensions[person].orientierung.primary;
                mobilePersonDimensions[person].orientierung.secondary = personDimensions[person].orientierung.secondary;
            }

            // Sync with TiageState if available
            if (typeof TiageState !== 'undefined') {
                TiageState.set(`personDimensions.${person}.orientierung`, personDimensions[person].orientierung);
            }

            // Sync all UIs
            syncOrientierungUI(person);

            // Remove needs-selection if primary is set
            const hasPrimary = personDimensions[person].orientierung.primary !== null;
            document.querySelectorAll(`[data-dimension="${person}-orientierung-multi"], [data-dimension="mobile-${person}-orientierung"], [data-dimension="${person}-orientierung"]`).forEach(dim => {
                if (hasPrimary) {
                    dim.classList.remove('needs-selection');
                } else {
                    dim.classList.add('needs-selection');
                }
            });

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        /**
         * Sync Orientierung UI across all views (Desktop, Mobile, Modal)
         */
        function syncOrientierungUI(person) {
            const primary = personDimensions[person].orientierung.primary;
            const secondary = personDimensions[person].orientierung.secondary;

            // All orientierung button selectors for this person
            const selectors = [
                `.orientierung-grid[data-person="${person}"] .orientierung-btn`,
                `#${person}-orientierung-grid .orientierung-btn`,
                `#mobile-${person}-orientierung-grid .orientierung-btn`,
                `#modal-${person}-orientierung-grid .orientierung-btn`
            ];

            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(btn => {
                    const value = btn.dataset.value;

                    // Remove all states
                    btn.classList.remove('primary-selected', 'secondary-selected');

                    // Remove existing indicators
                    const existingIndicator = btn.querySelector('.geschlecht-indicator');
                    if (existingIndicator) {
                        existingIndicator.remove();
                    }

                    // Add appropriate state and indicator
                    if (value === primary) {
                        btn.classList.add('primary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-primary';
                        indicator.textContent = 'I';
                        indicator.title = 'Identität (Primär)';
                        btn.appendChild(indicator);
                    } else if (value === secondary) {
                        btn.classList.add('secondary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-secondary';
                        indicator.textContent = 'G';
                        indicator.title = 'Sekundär';
                        btn.appendChild(indicator);
                    }
                });
            });

            // Update collapsed summary for orientierung
            updateOrientierungSummary(person);
        }

        /**
         * Get summary text for orientierung selection (for header - shows 'fehlt' if nothing selected)
         */
        function getOrientierungSummary(person) {
            const primary = personDimensions[person].orientierung.primary;
            const secondary = personDimensions[person].orientierung.secondary;

            if (!primary) {
                return 'Orientierung fehlt';
            }

            const parts = [];
            parts.push(primary + ' (I)');

            if (secondary) {
                parts.push(secondary + ' (G)');
            }

            return '✓ ' + parts.join(', ');
        }

        /**
         * Get summary text for orientierung selection in grid (without 'fehlt' text)
         * Returns selected values in green, or empty string if nothing selected
         */
        function getOrientierungGridSummary(person) {
            const primary = personDimensions[person].orientierung.primary;
            const secondary = personDimensions[person].orientierung.secondary;

            if (!primary) {
                return ''; // No 'fehlt' text for grid - only show selections
            }

            const parts = [];
            parts.push(primary + ' (I)');

            if (secondary) {
                parts.push(secondary + ' (G)');
            }

            return '✓ ' + parts.join(', ');
        }

        /**
         * Update header summary for orientierung (only in header area, not in collapsed-summary)
         */
        function updateOrientierungSummary(person) {
            const summaryText = getOrientierungSummary(person);
            const gridSummaryText = getOrientierungGridSummary(person);
            const isMissing = !personDimensions[person].orientierung.primary;

            // Update header element (shows 'fehlt' if nothing selected)
            const headerId = `${person}-header-orientierung`;
            const header = document.getElementById(headerId);
            if (header) {
                header.textContent = summaryText;
                header.classList.toggle('missing', isMissing);
            }

            // Update grid collapsed-summary (only shows selections in green, no 'fehlt')
            ['', 'mobile-'].forEach(prefix => {
                const summaryId = `${prefix}${person}-orientierung-summary`;
                const summary = document.getElementById(summaryId);
                if (summary) {
                    summary.textContent = gridSummaryText;
                    summary.classList.toggle('has-selection', !isMissing);
                }
            });

            // Update needs-selection classes
            ['', 'mobile-', 'modal-'].forEach(prefix => {
                const dim = document.querySelector(`[data-dimension="${prefix}${person}-orientierung-multi"]`);
                if (dim) {
                    if (!isMissing) dim.classList.remove('needs-selection');
                    else dim.classList.add('needs-selection');
                }
            });
        }

        // Helper: Check if any orientierung is selected (for backwards compatibility)
        function hasAnyOrientierungSelected(person) {
            return personDimensions[person].orientierung.primary !== null;
        }

        // ========================================
        // Desktop Selection Info Message
        // ========================================
        function updateSelectionInfoMessage() {
            const infoElement = document.getElementById('desktopSelectionInfo');
            if (!infoElement) return;

            const missing = [];

            // Check ICH
            const ichMissing = [];
            if (!personDimensions.ich.geschlecht.primary) ichMissing.push('Geschlecht');
            if (!hasAnyDominanzSelected('ich')) ichMissing.push('Dominanz');
            if (!hasAnyOrientierungSelected('ich')) ichMissing.push('Orientierung');
            if (ichMissing.length > 0) {
                missing.push('DU: ' + ichMissing.join(', '));
            }

            // Check Partner
            const partnerMissing = [];
            if (!personDimensions.partner.geschlecht.primary) partnerMissing.push('Geschlecht');
            if (!hasAnyDominanzSelected('partner')) partnerMissing.push('Dominanz');
            if (!hasAnyOrientierungSelected('partner')) partnerMissing.push('Orientierung');
            if (partnerMissing.length > 0) {
                missing.push('PARTNER: ' + partnerMissing.join(', '));
            }

            // Update display
            if (missing.length > 0) {
                infoElement.textContent = 'Fehlende Auswahl - ' + missing.join(' | ');
                infoElement.classList.add('visible');
            } else {
                infoElement.textContent = '';
                infoElement.classList.remove('visible');
            }
        }

        function handleDimensionChange(person, dimension, value, element) {
            // Update state
            personDimensions[person][dimension] = value;

            // Remove needs-selection class from the parent group
            if (element) {
                const dimensionGroup = element.closest('.dimension-group, .dimension-status-group');
                if (dimensionGroup) {
                    dimensionGroup.classList.remove('needs-selection');
                }
            }

            // Visual feedback - highlight animation
            if (element) {
                const label = element.nextElementSibling;
                if (label) {
                    label.classList.add('highlight-change');
                    setTimeout(() => label.classList.remove('highlight-change'), 300);
                }
            }

            // Update overview box
            updateAnalysisOverview();

            // Re-run compatibility checks when dimensions change
            if (data) {
                updatePartnerView();
            }
        }

        function getGeschlechtKurz(geschlecht) {
            if (!geschlecht) return '?';

            // Neues Format: { primary, secondary }
            let primary = geschlecht;
            let secondary = null;
            if (typeof geschlecht === 'object') {
                primary = geschlecht.primary;
                secondary = geschlecht.secondary;
            }

            if (!primary) return '?';

            // Nutze TiageConfig wenn verfügbar
            const getShort = (g) => {
                if (typeof TiageConfig !== 'undefined' && TiageConfig.GESCHLECHT_SHORT) {
                    return TiageConfig.GESCHLECHT_SHORT[g] || g;
                }
                // Fallback-Map
                const map = {
                    'cis_mann': 'CM',
                    'cis_frau': 'CF',
                    'trans_mann': 'TM',
                    'trans_frau': 'TF',
                    'nonbinaer': 'NB',
                    'genderfluid': 'GF',
                    'agender': 'AG',
                    'intersex': 'IS',
                    'divers': 'DI',
                    // Legacy-Support
                    'männlich': 'M',
                    'weiblich': 'W',
                    'non-binär': 'NB'
                };
                return map[g] || g;
            };

            // Primär + optional Sekundär anzeigen
            let result = getShort(primary);
            if (secondary) {
                result += '/' + getShort(secondary);
            }
            return result;
        }

        function getGeschlechtVoll(geschlecht) {
            if (!geschlecht) return null;

            let primary = geschlecht;
            let secondary = null;
            if (typeof geschlecht === 'object') {
                primary = geschlecht.primary;
                secondary = geschlecht.secondary;
            }

            if (!primary) return null;

            // Nutze i18n wenn verfügbar, sonst Fallback-Map
            const getName = (g) => {
                if (typeof TiageI18n !== 'undefined') {
                    return TiageI18n.t(`geschlecht.types.${g}`, g);
                }
                // Fallback-Map
                const map = {
                    'cis_mann': 'Cis Mann',
                    'cis_frau': 'Cis Frau',
                    'trans_mann': 'Trans Mann',
                    'trans_frau': 'Trans Frau',
                    'nonbinaer': 'Nonbinär',
                    'genderfluid': 'Genderfluid',
                    'agender': 'Agender',
                    'intersex': 'Intersex',
                    'divers': 'Divers',
                    'männlich': 'Mann',
                    'weiblich': 'Frau',
                    'non-binär': 'Nonbinär'
                };
                return map[g] || g;
            };

            let result = getName(primary);
            if (secondary) {
                result += ' (' + getName(secondary) + ')';
            }
            return result;
        }

        function getGeschlechtCategory(geschlecht) {
            // Gibt die Kategorie für Orientierungslogik zurück
            if (typeof TiageConfig !== 'undefined' && TiageConfig.GESCHLECHT_CATEGORY) {
                return TiageConfig.GESCHLECHT_CATEGORY[geschlecht] || 'andere';
            }
            const map = {
                'cis_mann': 'maennlich',
                'cis_frau': 'weiblich',
                'trans_mann': 'maennlich',
                'trans_frau': 'weiblich',
                'nonbinaer': 'nonbinaer',
                'genderfluid': 'fluid',
                'agender': 'agender',
                // Legacy-Support
                'männlich': 'maennlich',
                'weiblich': 'weiblich',
                'non-binär': 'nonbinaer'
            };
            return map[geschlecht] || 'andere';
        }

        function getDominanzKurz(dominanz) {
            // Handle multi-select object
            if (dominanz && typeof dominanz === 'object') {
                const parts = [];
                const map = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'ausg' };

                for (const [type, status] of Object.entries(dominanz)) {
                    if (status) {
                        let kurz = map[type] || type;
                        if (status === 'interessiert') kurz += '?';
                        parts.push(kurz);
                    }
                }

                return parts.length > 0 ? parts.join('+') : '?';
            }

            // Old single-value format (backwards compatibility)
            if (!dominanz) return '?';
            const map = {
                'dominant': 'dom',
                'submissiv': 'sub',
                'switch': 'sw',
                'ausgeglichen': 'ausg'
            };
            return map[dominanz] || dominanz;
        }

        function getOrientierungKurz(orientierung, status) {
            // Handle multi-select orientierung object
            if (orientierung && typeof orientierung === 'object') {
                const map = {
                    'heterosexuell': 'het',
                    'homosexuell': 'hom',
                    'bisexuell': 'bi'
                };
                const parts = [];
                // New Primary/Secondary structure
                if (orientierung.primary) {
                    parts.push(map[orientierung.primary] || orientierung.primary);
                }
                if (orientierung.secondary) {
                    parts.push(map[orientierung.secondary] || orientierung.secondary);
                }
                return parts.length > 0 ? parts.join('/') : '?';
            }

            // Backwards compatibility for old single-value format
            if (!orientierung) return '?';
            const map = {
                'heterosexuell': 'hetero',
                'homosexuell': 'homo',
                'bisexuell': 'bi'
            };
            let kurz = map[orientierung] || orientierung;
            if (status === 'interessiert') {
                kurz += '(?)';
            }
            return kurz;
        }

        function updateAnalysisOverview() {
            const ichType = data?.archetypes[currentArchetype]?.name || currentArchetype;
            const partnerType = data?.archetypes[selectedPartner]?.name || selectedPartner;

            const ichDims = personDimensions.ich;
            const partnerDims = personDimensions.partner;

            // Voller Geschlechtsname mit sekundärem in Klammern
            const ichGeschlecht = getGeschlechtVoll(ichDims.geschlecht);
            const partnerGeschlecht = getGeschlechtVoll(partnerDims.geschlecht);

            const ichInfo = `(${getDominanzKurz(ichDims.dominanz)}, ${getOrientierungKurz(ichDims.orientierung, ichDims.orientierungStatus)})`;
            const partnerInfo = `(${getDominanzKurz(partnerDims.dominanz)}, ${getOrientierungKurz(partnerDims.orientierung, partnerDims.orientierungStatus)})`;

            const content = document.getElementById('analysisOverviewContent');
            if (content) {
                // Nutze i18n für "Du:" / "You:"
                const youALabel = typeof TiageI18n !== 'undefined' ? TiageI18n.t('analysisOverview.youA', 'Du:') : 'Du:';
                const ichGeschlechtHtml = ichGeschlecht ? `<span class="geschlecht-info">${youALabel} ${ichGeschlecht}</span>` : '';
                const partnerGeschlechtHtml = partnerGeschlecht ? `<span class="geschlecht-info">${partnerGeschlecht}</span>` : '';

                content.innerHTML = `
                    <span class="type-name">${ichType}</span> ${ichGeschlechtHtml} <span class="dim-info">${ichInfo}</span>
                    <span> × </span>
                    <span class="type-name">${partnerType}</span> ${partnerGeschlechtHtml} <span class="dim-info">${partnerInfo}</span>
                `;
            }
        }

        // Make function globally available for i18n updates
        window.updateAnalysisOverview = updateAnalysisOverview;

        function initDimensionListeners() {
            // ICH dimensions
            document.querySelectorAll('input[name="ich-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('ich', 'geschlecht', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="ich-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleDominanzChange('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('ich', 'dominanzStatus', e.target.value, e.target));
            });

            // PARTNER dimensions
            document.querySelectorAll('input[name="partner-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('partner', 'geschlecht', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="partner-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleDominanzChange('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('partner', 'dominanzStatus', e.target.value, e.target));
            });
        }

        // ========================================
        // Pathos/Logos Check System
        // ========================================

        function checkPhysicalCompatibility(person1, person2) {
            const g1 = person1.geschlecht;
            const g2 = person2.geschlecht;

            // Get orientierung as multi-select object
            const ori1 = person1.orientierung;
            const ori2 = person2.orientierung;

            // Collect all missing items
            const missingItems = [];

            if (!g1) missingItems.push('Ich: Geschlecht');
            if (!g2) missingItems.push('Partner: Geschlecht');

            // Handle multi-select orientierung
            const oriList1 = [];
            const oriList2 = [];

            if (ori1 && typeof ori1 === 'object') {
                if (ori1.heterosexuell) oriList1.push({ type: 'heterosexuell', status: ori1.heterosexuell });
                if (ori1.homosexuell) oriList1.push({ type: 'homosexuell', status: ori1.homosexuell });
                if (ori1.bisexuell) oriList1.push({ type: 'bisexuell', status: ori1.bisexuell });
            } else if (ori1 && typeof ori1 === 'string') {
                // Backwards compatibility for old single-value format
                oriList1.push({ type: ori1, status: person1.orientierungStatus || 'gelebt' });
            }

            if (ori2 && typeof ori2 === 'object') {
                if (ori2.heterosexuell) oriList2.push({ type: 'heterosexuell', status: ori2.heterosexuell });
                if (ori2.homosexuell) oriList2.push({ type: 'homosexuell', status: ori2.homosexuell });
                if (ori2.bisexuell) oriList2.push({ type: 'bisexuell', status: ori2.bisexuell });
            } else if (ori2 && typeof ori2 === 'string') {
                // Backwards compatibility for old single-value format
                oriList2.push({ type: ori2, status: person2.orientierungStatus || 'gelebt' });
            }

            // Check if orientierung is missing
            if (oriList1.length === 0) missingItems.push('Ich: Orientierung');
            if (oriList2.length === 0) missingItems.push('Partner: Orientierung');

            // Return incomplete if any items are missing
            if (missingItems.length > 0) {
                return {
                    result: 'unvollständig',
                    reason: 'Dimensionen unvollständig',
                    explanation: 'Es fehlt noch: ' + missingItems.join(', '),
                    missingItems: missingItems
                };
            }

            // Check all combinations
            let hasPossible = false;
            let hasUnsicher = false;
            let hasInteressiert = false;

            for (const o1 of oriList1) {
                for (const o2 of oriList2) {
                    const result = checkSingleOrientationPair(o1.type, o1.status, o2.type, o2.status, g1, g2);

                    if (result === 'möglich') {
                        hasPossible = true;
                    } else if (result === 'unsicher') {
                        hasUnsicher = true;
                    }

                    if (o1.status === 'interessiert' || o2.status === 'interessiert') {
                        hasInteressiert = true;
                    }
                }
            }

            // Return best result
            if (hasPossible && !hasInteressiert) {
                return { result: 'möglich', confidence: 'hoch' };
            }

            if (hasPossible && hasInteressiert) {
                return {
                    result: 'unsicher',
                    confidence: 'mittel',
                    explanation: 'Anziehung möglich, aber mindestens eine Person ist in der Explorationsphase.',
                    note: 'Status "Interessiert" bedeutet Exploration'
                };
            }

            if (hasUnsicher) {
                return {
                    result: 'unsicher',
                    confidence: 'niedrig',
                    explanation: 'Anziehung ist theoretisch möglich, aber unsicher.',
                    note: 'Exploration-Phase'
                };
            }

            return {
                result: 'unmöglich',
                reason: 'Inkompatible Orientierungen',
                explanation: 'Die sexuellen Orientierungen schließen gegenseitige Anziehung aus.'
            };
        }

        // Helper: Check single pair of orientations
        function checkSingleOrientationPair(type1, status1, type2, status2, g1, g2) {
            // Bisexuell is always compatible
            if (type1 === 'bisexuell' || type2 === 'bisexuell') {
                return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'möglich';
            }

            // Both heterosexuell
            if (type1 === 'heterosexuell' && type2 === 'heterosexuell') {
                if (g1 !== g2) {
                    return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'möglich';
                } else {
                    return 'unmöglich'; // Same gender, both hetero
                }
            }

            // Both homosexuell
            if (type1 === 'homosexuell' && type2 === 'homosexuell') {
                if (g1 === g2) {
                    return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'möglich';
                } else {
                    return 'unmöglich'; // Different gender, both homo
                }
            }

            // Mixed: hetero + homo - check if exploring
            if (status1 === 'interessiert' || status2 === 'interessiert') {
                return 'unsicher'; // Exploration could change things
            }
            return 'unmöglich';
        }

        function calculatePhilosophyCompatibility(type1, type2) {
            // Get the philosophy score (Category A) from the matrix
            const key = `${type1}_${type2}`;
            const interaction = data?.interactions[key];

            if (interaction && interaction.scores && interaction.scores.A) {
                return {
                    score: interaction.scores.A.value,
                    note: interaction.scores.A.note
                };
            }

            // Fallback if not found
            return { score: 50, note: 'Keine spezifischen Daten verfügbar' };
        }

        function formatPersonSummary(person) {
            const geschlecht = person.geschlecht || '?';

            // Handle Primary/Secondary orientierung structure
            let orientierungStr = '?';
            if (person.orientierung && typeof person.orientierung === 'object') {
                const parts = [];
                if (person.orientierung.primary) {
                    parts.push(person.orientierung.primary + ' (I)');
                }
                if (person.orientierung.secondary) {
                    parts.push(person.orientierung.secondary + ' (G)');
                }
                orientierungStr = parts.length > 0 ? parts.join(', ') : '?';
            } else if (person.orientierung) {
                // Backwards compatibility for old single-value format
                orientierungStr = person.orientierung;
            }

            return `${geschlecht}, ${orientierungStr}`;
        }

        function runCompatibilityChecks() {
            const person1 = {
                archetyp: currentArchetype,
                ...personDimensions.ich
            };
            const person2 = {
                archetyp: selectedPartner,
                ...personDimensions.partner
            };

            // Reset all warnings
            document.getElementById('pathosBlocker').classList.remove('active');
            document.getElementById('logosWarning').classList.remove('active');
            document.getElementById('pathosUncertain').classList.remove('active');
            document.getElementById('doubleWarning').classList.remove('active');
            document.getElementById('compatibilityContent').style.display = 'block';

            // 1. PATHOS CHECK
            const pathosCheck = checkPhysicalCompatibility(person1, person2);

            if (pathosCheck.result === 'unvollständig') {
                // Show Pathos Uncertain with incomplete message
                document.getElementById('pathosUncertain').classList.add('active');
                document.getElementById('pathosUncertainText').textContent =
                    pathosCheck.explanation;
                // Continue showing compatibility content since it's just incomplete
            }

            if (pathosCheck.result === 'unmöglich') {
                // SANFTER HINWEIS statt K.O.-Blocker
                // Zeige Warnung, aber blockiere nicht mehr
                document.getElementById('pathosBlocker').classList.add('active');
                // Content wird NICHT mehr versteckt - zeige den (niedrigen) Score
                // document.getElementById('compatibilityContent').style.display = 'none';

                document.getElementById('pathosBlockerReason').textContent =
                    `Hinweis: ${pathosCheck.reason} – Resonanz ist sehr niedrig, aber nicht unmöglich.`;
                document.getElementById('pathosBlockerPerson1').textContent =
                    formatPersonSummary(person1);
                document.getElementById('pathosBlockerPerson2').textContent =
                    formatPersonSummary(person2);

                // Kein return mehr - weitermachen mit niedriger Resonanz!
                // return { blocked: true, reason: 'pathos' };
            }

            // 2. LOGOS CHECK
            const logosCheck = calculatePhilosophyCompatibility(person1.archetyp, person2.archetyp);
            const hasLogosWarning = logosCheck.score < 50;
            const hasPathosUncertain = pathosCheck.result === 'unsicher';

            // Handle different warning combinations
            if (hasPathosUncertain && hasLogosWarning) {
                // Double Warning
                document.getElementById('doubleWarning').classList.add('active');
                document.getElementById('doubleWarningPathos').textContent =
                    `${person2.orientierung} (${person2.orientierungStatus}) → Exploration-Phase`;
                document.getElementById('doubleWarningLogos').textContent =
                    `Beziehungsphilosophie: ${logosCheck.score}% → ${data?.archetypes[person1.archetyp]?.name || person1.archetyp} vs. ${data?.archetypes[person2.archetyp]?.name || person2.archetyp}`;
            } else {
                // Single warnings
                if (hasLogosWarning) {
                    document.getElementById('logosWarning').classList.add('active');
                    const warningTitle = logosCheck.score < 30
                        ? 'Verstandsebene-Warnung: Fundamentale philosophische Unterschiede'
                        : 'Verstandsebene-Hinweis: Unterschiedliche philosophische Ansätze';
                    document.getElementById('logosWarningTitle').textContent = warningTitle;
                    document.getElementById('logosWarningSubtitle').textContent =
                        `Beziehungsphilosophie: ${logosCheck.score}%`;
                    document.getElementById('logosWarningScore').textContent = `${logosCheck.score}%`;
                    document.getElementById('logosWarningText').textContent = logosCheck.score < 30
                        ? 'Eure Grundüberzeugungen über Beziehungen sind sehr unterschiedlich. Dies erfordert intensive Kommunikation und Kompromissbereitschaft.'
                        : 'Ihr habt verschiedene Vorstellungen von Beziehungen. Offene Kommunikation ist wichtig.';
                }

                if (hasPathosUncertain) {
                    document.getElementById('pathosUncertain').classList.add('active');
                    document.getElementById('pathosUncertainText').textContent =
                        `Mindestens eine Person ist in der Explorationsphase (Status: "Interessiert"). Die tatsächliche körperliche Anziehung ist noch unklar.`;
                }
            }

            // 3. DISPLAY DIMENSION MODIFIERS
            const modifierSummaries = getModifierSummary(person1, person2);
            const modifierSummaryEl = document.getElementById('modifierSummary');
            const modifierContentEl = document.getElementById('modifierSummaryContent');

            if (modifierSummaries.length > 0) {
                modifierSummaryEl.classList.add('active');
                modifierContentEl.innerHTML = modifierSummaries.map(mod => {
                    const sign = mod.modifier > 0 ? '+' : '';
                    const modClass = mod.modifier > 0 ? 'positive' : (mod.modifier < 0 ? 'negative' : 'neutral');
                    const icon = mod.modifier > 0 ? '↑' : (mod.modifier < 0 ? '↓' : '→');
                    return `
                        <div class="modifier-summary-item">
                            <span class="modifier-icon">${icon}</span>
                            <span>${mod.description}</span>
                            <span class="modifier-badge ${modClass}">${sign}${mod.modifier}%</span>
                        </div>
                    `;
                }).join('');
            } else {
                modifierSummaryEl.classList.remove('active');
            }

            return {
                blocked: false,
                pathosCheck,
                logosCheck,
                warnings: { hasLogosWarning, hasPathosUncertain },
                modifiers: modifierSummaries
            };
        }

        function toggleLogosWarning() {
            const warning = document.getElementById('logosWarning');
            warning.classList.toggle('expanded');
        }

        function showPathosLogosInfo() {
            // Show info modal about Pathos vs Logos
            const title = 'Pathos vs. Logos';
            const content = `
                <div style="line-height: 1.6;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">GEFÜHLSEBENE (Emotion/Körper)</h4>
                    <ul style="margin-bottom: 15px; padding-left: 20px;">
                        <li>Körperliche und emotionale Anziehung</li>
                        <li>Sexuelle Orientierung</li>
                        <li>Nicht durch Lernen oder Kommunikation veränderbar</li>
                        <li><strong>Ohne Gefühlsebene:</strong> Keine romantische Beziehung möglich</li>
                    </ul>

                    <h4 style="color: var(--warning); margin-bottom: 10px;">VERSTANDSEBENE (Philosophie/Überzeugungen)</h4>
                    <ul style="margin-bottom: 15px; padding-left: 20px;">
                        <li>Beziehungsphilosophie und rationale Überzeugungen</li>
                        <li>Überzeugungen und Werte</li>
                        <li>Kann durch Kommunikation und Lernen verändert werden</li>
                        <li><strong>Ohne Verstandsebene:</strong> Schwierige, aber mögliche Beziehung</li>
                    </ul>

                    <p style="font-style: italic; color: var(--text-muted);">
                        "Die Gefühlsebene ist das Fundament - ohne körperliche Anziehung kann keine romantische Beziehung entstehen. Die Verstandsebene ist das Dach - es schützt und strukturiert, kann aber umgebaut werden."
                    </p>
                </div>
            `;

            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('categoryModal').classList.add('active');
        }

        // ========================================
        // Dimensions Modifiers System
        // ========================================

        // Tag dimension relevance mapping
        const tagDimensionRelevance = {
            // KATEGORIE A: Beziehungsphilosophie - KEINE Dimensions-Einflüsse!
            "exklusivitaets-erwartung": [],
            "offenheit-fuer-alternative-modelle": [],
            "beziehung-als-lebensinhalt": [],
            "primaerbeziehung-konzept": [],
            "commitment-tiefe": [],

            // KATEGORIE B: Werte-Alignment
            "fuehrung-und-initiative": ["dominanz"],
            "macht-balance": ["dominanz"],
            "emotionale-reziprozitaet": [],
            "eifersucht-umgang": [],
            "konfliktloesung": ["dominanz"],
            "emotionale-tiefe": [],

            // KATEGORIE C: Nähe-Distanz
            "entscheidungsfindung": ["dominanz"],
            "alltags-organisation": ["dominanz"],
            "autonomie-vs-gemeinsame-zeit": [],
            "finanzielle-organisation": ["dominanz"],
            "wohnform-flexibilitaet": [],
            "zeitmanagement": ["dominanz"],

            // KATEGORIE D: Autonomie
            "koerperliche-anziehung": ["geschlecht", "orientierung", "orientierungStatus"],
            "sexuelle-dominanz-dynamik": ["dominanz"],
            "experimentierfreude": ["orientierungStatus"],
            "intimitaets-frequenz": [],
            "koerperliche-naehe": [],
            "sexuelle-offenheit": ["orientierungStatus"],

            // KATEGORIE E: Kommunikation
            "kommunikations-stil": ["dominanz"],
            "konflikt-kommunikation": ["dominanz"],
            "beduerfnis-artikulation": [],
            "feedback-kultur": [],

            // KATEGORIE F: Soziale Kompatibilität
            "philosophische-entwicklung": [],
            "anpassungsfaehigkeit": ["dominanz"],
            "krisenresilienz": ["dominanz"],
            "gemeinsame-vision": [],
            "soziales-umfeld": [],
            "gesellschaftliche-akzeptanz": []
        };

        // Calculate dominanz modifier
        function getDominanzModifier(dom1, dom2) {
            // Return 0 if either is null/undefined
            if (!dom1 || !dom2) return 0;

            // KOMPLEMENTÄR
            if ((dom1 === "dominant" && dom2 === "submissiv") ||
                (dom1 === "submissiv" && dom2 === "dominant")) {
                return 8;
            }
            // BEIDE GLEICH
            if (dom1 === dom2) {
                if (dom1 === "ausgeglichen") return 5;
                if (dom1 === "switch") return 3;
                if (dom1 === "dominant") return -5;
                if (dom1 === "submissiv") return -5;
            }
            // EINER FLEXIBEL
            if (dom1 === "switch" || dom2 === "switch" ||
                dom1 === "ausgeglichen" || dom2 === "ausgeglichen") {
                return 2;
            }
            return 0;
        }

        // Get dominanz modifier description
        // Basiert auf Forschung: Sadikaj et al. (2017), Tiedens & Fragale (2003)
        function getDominanzDescription(dom1, dom2, modifier) {
            if (modifier === 8) return `Komplementär (${dom1} × ${dom2}): Optimale Rollenverteilung - Forschung zeigt höhere Sympathie und Komfort`;
            if (modifier === 5) return `Beide ausgeglichen: Flexible Dynamik ohne starre Hierarchie`;
            if (modifier === 3) return `Beide switch: Wechselnde Dynamik mit situativer Anpassung`;
            if (modifier === -5 && dom1 === "dominant") return `Beide dominant: Machtkampf-Risiko - bewusste Kommunikationsregeln empfohlen`;
            if (modifier === -5 && dom1 === "submissiv") return `Beide submissiv: Führungsvakuum - klare Aufgabenteilung empfohlen`;
            if (modifier === 2) return `Flexibilität: Ein Partner passt sich situativ an`;
            return "Neutral";
        }

        // Map tag to category
        function getTagCategory(tagId) {
            const mapping = {
                "exklusivitaets-erwartung": "A", "offenheit-fuer-alternative-modelle": "A",
                "beziehung-als-lebensinhalt": "A", "primaerbeziehung-konzept": "A", "commitment-tiefe": "A",
                "fuehrung-und-initiative": "B", "macht-balance": "B", "emotionale-reziprozitaet": "B",
                "eifersucht-umgang": "B", "konfliktloesung": "B", "emotionale-tiefe": "B",
                "entscheidungsfindung": "C", "alltags-organisation": "C", "autonomie-vs-gemeinsame-zeit": "C",
                "finanzielle-organisation": "C", "wohnform-flexibilitaet": "C", "zeitmanagement": "C",
                "koerperliche-anziehung": "D", "sexuelle-dominanz-dynamik": "D", "experimentierfreude": "D",
                "intimitaets-frequenz": "D", "koerperliche-naehe": "D", "sexuelle-offenheit": "D",
                "kommunikations-stil": "E", "konflikt-kommunikation": "E",
                "beduerfnis-artikulation": "E", "feedback-kultur": "E",
                "philosophische-entwicklung": "F", "anpassungsfaehigkeit": "F", "krisenresilienz": "F",
                "gemeinsame-vision": "F", "soziales-umfeld": "F", "gesellschaftliche-akzeptanz": "F"
            };
            return mapping[tagId] || null;
        }

        // Calculate tag score with modifiers
        function calculateTagWithModifiers(tagId, person1, person2, pathosCheck) {
            const interactionKey = `${person1.archetyp}_${person2.archetyp}`;
            const interaction = data?.interactions[interactionKey];
            const tagCategory = getTagCategory(tagId);
            let baseScore = interaction?.scores?.[tagCategory]?.value || 50;

            const relevantDims = tagDimensionRelevance[tagId] || [];
            if (relevantDims.length === 0) {
                return { score: baseScore, baseScore, modifier: 0, dims: [], desc: "Archetyp-basiert" };
            }

            let modifier = 0;
            let descriptions = [];

            // Dominanz modifier
            if (relevantDims.includes("dominanz")) {
                const domMod = getDominanzModifier(person1.dominanz, person2.dominanz);
                modifier += domMod;
                if (domMod !== 0) descriptions.push(getDominanzDescription(person1.dominanz, person2.dominanz, domMod));
            }

            // Physical compatibility (Pathos uncertainty)
            if (relevantDims.some(d => ["geschlecht", "orientierung", "orientierungStatus"].includes(d))) {
                if (pathosCheck?.result === "unsicher") {
                    modifier -= 10;
                    descriptions.push("Unsichere körperliche Anziehung");
                }
            }

            // Orientation status (exploration bonus)
            if (relevantDims.includes("orientierungStatus")) {
                if (person1.orientierungStatus === "interessiert" || person2.orientierungStatus === "interessiert") {
                    if (tagId === "experimentierfreude" || tagId === "sexuelle-offenheit") {
                        modifier += 5;
                        descriptions.push("Explorationsbonus");
                    }
                }
            }

            const finalScore = Math.max(0, Math.min(100, baseScore + modifier));
            return {
                score: finalScore,
                baseScore,
                modifier,
                dims: relevantDims,
                desc: descriptions.length > 0 ? descriptions.join("; ") : "Keine Anpassung"
            };
        }

        // Calculate category with modifiers
        function calculateCategoryWithModifiers(catLetter, person1, person2, pathosCheck) {
            const categoryTags = Object.keys(tagDimensionRelevance).filter(t => getTagCategory(t) === catLetter);

            if (categoryTags.length === 0) {
                const interactionKey = `${person1.archetyp}_${person2.archetyp}`;
                const interaction = data?.interactions[interactionKey];
                return { score: interaction?.scores?.[catLetter]?.value || 50, modifier: 0, tags: [] };
            }

            let totalScore = 0, totalMod = 0;
            const tagDetails = [];

            for (const tagId of categoryTags) {
                const result = calculateTagWithModifiers(tagId, person1, person2, pathosCheck);
                totalScore += result.score;
                totalMod += result.modifier;
                tagDetails.push({ id: tagId, ...result });
            }

            return {
                score: Math.round(totalScore / categoryTags.length),
                modifier: Math.round(totalMod / categoryTags.length),
                tags: tagDetails
            };
        }

        // ========================================
        // NEW: 4-Factor Relationship Quality Model
        // ========================================

        // Factor 1: Archetype Match (40%) - from existing matrix
        function getArchetypeScore(type1, type2) {
            const key = `${type1}_${type2}`;
            const interaction = data?.interactions[key];
            return interaction?.overall || 50;
        }

        // ═══════════════════════════════════════════════════════════════════════
        // Factor 2: Dominance Harmony (20% Gewichtung - Pathos/Gefühl)
        // ═══════════════════════════════════════════════════════════════════════
        // Philosophische Grundlage: OSHO + Metaphysik der Qualität (Pirsig)
        //
        // OSHO: "Nur Extreme können sich wirklich verlieben. Nur Extreme ziehen
        //        sich an. Je weiter sie voneinander entfernt sind, desto tiefer
        //        wird die Anziehung."
        //
        // OSHO: "Es gibt nur eine Energie - Tao. Sie funktioniert auf zwei Arten.
        //        Du kannst Konflikt ODER Harmonie zwischen beiden erschaffen."
        //
        // MOQ (Pirsig): Dynamische Qualität entsteht durch Spannung zwischen
        //               Polen. Statische Qualität bewahrt funktionierende Muster.
        //
        // Werte-Logik:
        // - 100%: Komplementäre Polarität (Dom↔Sub) = maximale dynamische Qualität
        // -  95%: Tao-Balance (Ausgeglichen↔Ausgeglichen) = harmonische Einheit
        // -  90%: Flexible Dynamik (Switch↔Switch) = spielerische Anpassung
        // -  85%: Pol + Balance = stabile Ergänzung
        // -  80%: Switch + Pol = Anpassung möglich, aber Spannung
        // -  60%: Gleiche Pole (Dom↔Dom, Sub↔Sub) = Konflikt, fehlende Spannung
        // ═══════════════════════════════════════════════════════════════════════
        // ═══════════════════════════════════════════════════════════════════════
        // DOMINANZ HARMONY MATRIX
        // ═══════════════════════════════════════════════════════════════════════
        const dominanzHarmonyMatrix = {
            // KOMPLEMENTÄRE POLARITÄT (100%)
            "dominant-submissiv": 100, "submissiv-dominant": 100,
            // TAO-BALANCE (90-95%)
            "ausgeglichen-ausgeglichen": 95, "switch-switch": 90,
            "switch-ausgeglichen": 88, "ausgeglichen-switch": 88,
            // POL + BALANCE (85%)
            "dominant-ausgeglichen": 85, "ausgeglichen-dominant": 85,
            "submissiv-ausgeglichen": 85, "ausgeglichen-submissiv": 85,
            // SWITCH + POL (80%)
            "switch-dominant": 80, "dominant-switch": 80,
            "switch-submissiv": 80, "submissiv-switch": 80,
            // GLEICHE POLE (55%)
            "dominant-dominant": 55, "submissiv-submissiv": 55
        };

        // Calculate harmony between two single dominanz types
        function calculateSingleDominanzHarmony(type1, status1, type2, status2) {
            const key = `${type1}-${type2}`;
            let baseScore = dominanzHarmonyMatrix[key] || dominanzHarmonyMatrix[`${type2}-${type1}`] || 75;

            // STATUS-MODIFIER: Reduzierte Konfidenz bei "interessiert"
            if (status1 === 'interessiert' || status2 === 'interessiert') {
                baseScore = Math.round(baseScore * 0.7);
            }

            return baseScore;
        }

        // Calculate best dominanz harmony for multi-select (finds best combination)
        function calculateDominanceHarmony(domObj1, domObj2) {
            // Handle old single-value format (backwards compatibility)
            if (typeof domObj1 === 'string' || typeof domObj2 === 'string') {
                return calculateSingleDominanzHarmony(domObj1, 'gelebt', domObj2, 'gelebt');
            }

            // Get selected dominanz preferences for each person (Primary/Secondary structure)
            const list1 = [];
            const list2 = [];

            if (domObj1) {
                if (domObj1.primary) list1.push({ type: domObj1.primary, status: 'primary' });
                if (domObj1.secondary) list1.push({ type: domObj1.secondary, status: 'secondary' });
            }

            if (domObj2) {
                if (domObj2.primary) list2.push({ type: domObj2.primary, status: 'primary' });
                if (domObj2.secondary) list2.push({ type: domObj2.secondary, status: 'secondary' });
            }

            // Default if no selections
            if (list1.length === 0 || list2.length === 0) return 75;

            // Find best combination
            let bestScore = 0;
            for (const d1 of list1) {
                for (const d2 of list2) {
                    const score = calculateSingleDominanzHarmony(d1.type, d1.status, d2.type, d2.status);
                    if (score > bestScore) {
                        bestScore = score;
                    }
                }
            }

            return bestScore;
        }

        // Factor 3: Orientation Compatibility (25%) - uses existing checkPhysicalCompatibility
        function calculateOrientationScore(person1, person2) {
            const pathosCheck = checkPhysicalCompatibility(person1, person2);

            if (pathosCheck.result === "unmöglich") {
                return 0;  // K.O.-Kriterium!
            }

            if (pathosCheck.result === "unsicher") {
                return 70;  // Exploration-Phase
            }

            return 100;  // Kompatibel
        }

        // Factor 4: Gender Attraction (15%)
        function calculateGenderAttraction(p1, p2) {
            const g1 = p1.geschlecht;
            const g2 = p2.geschlecht;

            // Handle Primary/Secondary orientierung structure
            const oriList1 = [];
            const oriList2 = [];

            if (p1.orientierung && typeof p1.orientierung === 'object') {
                if (p1.orientierung.primary) oriList1.push(p1.orientierung.primary);
                if (p1.orientierung.secondary) oriList1.push(p1.orientierung.secondary);
            } else if (p1.orientierung) {
                oriList1.push(p1.orientierung);
            }

            if (p2.orientierung && typeof p2.orientierung === 'object') {
                if (p2.orientierung.primary) oriList2.push(p2.orientierung.primary);
                if (p2.orientierung.secondary) oriList2.push(p2.orientierung.secondary);
            } else if (p2.orientierung) {
                oriList2.push(p2.orientierung);
            }

            // Return default if values missing
            if (!g1 || !g2 || oriList1.length === 0 || oriList2.length === 0) return 75;

            // Check best combination
            let bestScore = 0;

            for (const o1 of oriList1) {
                for (const o2 of oriList2) {
                    const score = calculateSingleGenderAttraction(g1, o1, g2, o2);
                    if (score > bestScore) {
                        bestScore = score;
                    }
                }
            }

            return bestScore;
        }

        // Helper for single orientierung pair - nutzt Geschlechts-Kategorien
        function calculateSingleGenderAttraction(g1, o1, g2, o2) {
            // Konvertiere Geschlechter zu Kategorien für die Logik
            const cat1 = getGeschlechtCategory(g1);
            const cat2 = getGeschlechtCategory(g2);

            // Bi = immer 100% (angezogen von männlich und weiblich)
            if (o1 === "bisexuell" || o2 === "bisexuell") return 100;

            // Hetero: Angezogen vom "anderen" Geschlecht
            if (o1 === "heterosexuell" && o2 === "heterosexuell") {
                if ((cat1 === "maennlich" && cat2 === "weiblich") ||
                    (cat1 === "weiblich" && cat2 === "maennlich")) return 100;
                // Nonbinär, Fluid, Agender - partielle Kompatibilität
                if (cat1 === "nonbinaer" || cat2 === "nonbinaer" ||
                    cat1 === "fluid" || cat2 === "fluid") return 80;
                if (cat1 === "agender" || cat2 === "agender") return 60;
                return 0;
            }

            // Homo: Angezogen vom "gleichen" Geschlecht
            if (o1 === "homosexuell" && o2 === "homosexuell") {
                if (cat1 === cat2 && cat1 !== "nonbinaer" && cat1 !== "fluid" && cat1 !== "agender") return 100;
                // Nonbinär mit Homo - angezogen von ähnlichen
                if ((cat1 === "nonbinaer" && cat2 === "nonbinaer") ||
                    (cat1 === "fluid" && cat2 === "fluid")) return 90;
                if (cat1 === "nonbinaer" || cat2 === "nonbinaer" ||
                    cat1 === "fluid" || cat2 === "fluid") return 75;
                if (cat1 === "agender" || cat2 === "agender") return 60;
                return 0;
            }

            return 75;  // Gemischte Orientierungen
        }

        // ═══════════════════════════════════════════════════════════════════════
        // RESONANZ-BERECHNUNG (Meta-Dimension)
        // ═══════════════════════════════════════════════════════════════════════
        // R = 0.9 + [(M/100 × 0.5) + (B × 0.5)] × 0.2
        // wobei:
        //   M = Profil-Match (0-100%): Übereinstimmung der 30 Attribute
        //   B = Balance (0-1): Harmonie zwischen Logos und Pathos
        // Ergebnis: R zwischen 0.9 und 1.1
        // ═══════════════════════════════════════════════════════════════════════

        // Die 30 Profil-Attribute in 3 Kategorien
        const PROFILE_ATTRIBUTES = {
            D: ['kinderWunsch', 'eheWunsch', 'wohnform', 'religion', 'karrierePrioritaet',
                'finanzPhilosophie', 'lebensstil', 'umzugsbereitschaft', 'zukunftsplanung', 'traditionenWichtigkeit'],
            E: ['kommunikationsstil', 'konfliktverhalten', 'emotionaleOffenheit', 'gespraechsBedürfnis', 'feedbackStil',
                'entschuldigungen', 'streitVerhalten', 'versoehnung', 'kritikAnnehmen', 'humorKonflikte'],
            F: ['introExtro', 'familieWichtigkeit', 'freundeskreis', 'oeffentlichkeit', 'alleinzeit',
                'events', 'reisen', 'hobbys', 'wochenende', 'netzwerkGroesse']
        };

        /**
         * Berechnet den Profil-Match-Score (M)
         * Vergleicht die 30 Attribute zweier psychologischer Profile
         * @returns {number} Match-Prozent 0-100
         */
        function calculateProfilMatch(person1, person2) {
            // Profile-Key generieren basierend auf Archetyp-Geschlecht-Dominanz-Orientierung
            const profile1Key = getProfileKey(person1);
            const profile2Key = getProfileKey(person2);

            // Profile aus psychologicalProfiles laden (falls verfügbar)
            if (typeof psychologicalProfiles === 'undefined') {
                // Fallback: Schätze Match basierend auf Archetyp-Ähnlichkeit
                return estimateProfilMatch(person1, person2);
            }

            const profile1 = psychologicalProfiles[profile1Key];
            const profile2 = psychologicalProfiles[profile2Key];

            if (!profile1 || !profile2) {
                return estimateProfilMatch(person1, person2);
            }

            // Zähle übereinstimmende Attribute
            let matches = 0;
            const allAttributes = [...PROFILE_ATTRIBUTES.D, ...PROFILE_ATTRIBUTES.E, ...PROFILE_ATTRIBUTES.F];

            for (const attr of allAttributes) {
                if (profile1[attr] && profile2[attr]) {
                    if (profile1[attr] === profile2[attr]) {
                        matches++;
                    } else if (areAttributesCompatible(attr, profile1[attr], profile2[attr])) {
                        matches += 0.5; // Partielle Übereinstimmung
                    }
                }
            }

            return Math.round((matches / 30) * 100);
        }

        /**
         * Generiert den Profile-Key für eine Person
         */
        function getProfileKey(person) {
            const geschlecht = getGeschlechtCategory(person.geschlecht);
            const geschlechtLabel = geschlecht === 'maennlich' ? 'männlich' :
                                   geschlecht === 'weiblich' ? 'weiblich' : 'nonbinär';

            // Primäre Dominanz ermitteln
            let dominanz = 'ausgeglichen';
            if (person.dominanz && typeof person.dominanz === 'object') {
                for (const [type, status] of Object.entries(person.dominanz)) {
                    if (status === 'gelebt') {
                        dominanz = type;
                        break;
                    }
                }
            } else if (person.dominanz) {
                dominanz = person.dominanz;
            }

            // Primäre Orientierung ermitteln
            let orientierung = 'heterosexuell';
            if (person.orientierung && typeof person.orientierung === 'object') {
                for (const [type, status] of Object.entries(person.orientierung)) {
                    if (status === 'gelebt') {
                        orientierung = type;
                        break;
                    }
                }
            } else if (person.orientierung) {
                orientierung = person.orientierung;
            }

            return `${person.archetyp}-${geschlechtLabel}-${dominanz}-${orientierung}`;
        }

        /**
         * Schätzt den Profil-Match wenn keine exakten Profile verfügbar
         * Basiert auf Archetyp-Ähnlichkeit und Dimension-Übereinstimmungen
         */
        function estimateProfilMatch(person1, person2) {
            let score = 50; // Basis

            // Gleicher Archetyp = +30
            if (person1.archetyp === person2.archetyp) {
                score += 30;
            } else {
                // Ähnliche Archetypen (aus Matrix ableitbar)
                const archetypeScore = getArchetypeScore(person1.archetyp, person2.archetyp);
                score += Math.round((archetypeScore - 50) * 0.3);
            }

            // Gleiche Dominanz-Orientierung = +10
            const dom1 = getPrimaryDominanz(person1.dominanz);
            const dom2 = getPrimaryDominanz(person2.dominanz);
            if (dom1 === dom2) score += 10;

            // Ähnliche Orientierung = +10
            const ori1 = getPrimaryOrientierung(person1.orientierung);
            const ori2 = getPrimaryOrientierung(person2.orientierung);
            if (ori1 === ori2) score += 10;

            return Math.min(100, Math.max(0, score));
        }

        /**
         * Prüft ob zwei Attribut-Werte kompatibel sind (partielle Übereinstimmung)
         */
        function areAttributesCompatible(attr, val1, val2) {
            // Kompatibilitäts-Gruppen für bestimmte Attribute
            const compatGroups = {
                'wohnform': [['alleine', 'zusammen'], ['getrennt', 'zusammen']],
                'lebensstil': [['durchschnittlich', 'bescheiden'], ['durchschnittlich', 'luxuriös']],
                'kommunikationsstil': [['direkt', 'ausgewogen'], ['indirekt', 'ausgewogen']],
                'introExtro': [['ambivert', 'introvertiert'], ['ambivert', 'extrovertiert']]
            };

            if (compatGroups[attr]) {
                for (const group of compatGroups[attr]) {
                    if (group.includes(val1) && group.includes(val2)) {
                        return true;
                    }
                }
            }

            return false;
        }

        /**
         * Helper: Primäre Dominanz aus Objekt ermitteln
         */
        function getPrimaryDominanz(dominanz) {
            if (!dominanz || typeof dominanz !== 'object') return dominanz || 'ausgeglichen';
            for (const [type, status] of Object.entries(dominanz)) {
                if (status === 'gelebt') return type;
            }
            return 'ausgeglichen';
        }

        /**
         * Helper: Primäre Orientierung aus Objekt ermitteln
         */
        function getPrimaryOrientierung(orientierung) {
            if (!orientierung || typeof orientierung !== 'object') return orientierung || 'heterosexuell';
            for (const [type, status] of Object.entries(orientierung)) {
                if (status === 'gelebt') return type;
            }
            return 'heterosexuell';
        }

        /**
         * Berechnet die Logos-Pathos-Balance (B)
         * B = (100 - |Logos - Pathos|) / 100
         * @returns {number} Balance 0.0-1.0
         */
        function calculateLogosPathosBalance(archetypeScore, orientationScore, dominanceScore, genderScore) {
            // Logos = Archetyp-Score
            const logos = archetypeScore;

            // Pathos = Durchschnitt der drei Pathos-Faktoren
            const pathos = (orientationScore + dominanceScore + genderScore) / 3;

            // Differenz
            const differenz = Math.abs(logos - pathos);

            // Balance: Je geringer die Differenz, desto höher die Balance
            const balance = (100 - differenz) / 100;

            return Math.max(0, Math.min(1, balance));
        }

        /**
         * Berechnet den Resonanz-Koeffizienten (R)
         * R = 0.9 + [(M/100 × 0.5) + (B × 0.5)] × 0.2
         * @returns {object} { R: 0.9-1.1, M: 0-100, B: 0-1, interpretation: string }
         */
        function calculateResonanz(person1, person2, archetypeScore, orientationScore, dominanceScore, genderScore) {
            // Komponente 1: Profil-Match (M)
            const M = calculateProfilMatch(person1, person2);

            // Komponente 2: Logos-Pathos-Balance (B)
            const B = calculateLogosPathosBalance(archetypeScore, orientationScore, dominanceScore, genderScore);

            // Gesamtformel: R = 0.9 + [(M/100 × 0.5) + (B × 0.5)] × 0.2
            const R = 0.9 + ((M / 100 * 0.5) + (B * 0.5)) * 0.2;

            // Interpretation
            let interpretation;
            if (R >= 1.08) {
                interpretation = 'Starke Harmonie';
            } else if (R >= 1.03) {
                interpretation = 'Leichte Harmonie';
            } else if (R >= 0.97) {
                interpretation = 'Neutral';
            } else if (R >= 0.93) {
                interpretation = 'Leichte Dissonanz';
            } else {
                interpretation = 'Starke Dissonanz';
            }

            return {
                R: Math.round(R * 100) / 100,
                M: M,
                B: Math.round(B * 100) / 100,
                interpretation: interpretation
            };
        }

        // ═══════════════════════════════════════════════════════════════════════
        // HAUPTBERECHNUNG: 5-Faktoren Beziehungsqualität (inkl. Resonanz)
        // ═══════════════════════════════════════════════════════════════════════
        // Philosophische Grundlage: Tiage-Modell + MOQ (Pirsig) + OSHO
        //
        // GEWICHTUNG LOGOS vs. PATHOS (40:60)
        // ────────────────────────────────────
        // Pirsig (MOQ): "Qualität ist die Quelle von Subjekt und Objekt."
        //               Statische Qualität (Logos) = Fundament, bewahrt Muster
        //               Dynamische Qualität (Pathos) = Antrieb, erzeugt Anziehung
        //
        // OSHO: "Balance zwischen allen Polaritäten ist Gesundheit."
        //       "Gefühl ist der Antrieb, Verstand gibt Struktur."
        //
        // Tiage: Verbindet rationale Reflexion (Logos) mit emotionaler
        //        Resonanz (Pathos) zu einem ganzheitlichen Modell.
        //
        // FAKTOR-BEGRÜNDUNG:
        // ────────────────────────────────────
        // 1. Archetyp (40% - Logos/Verstand):
        //    → Fundamentale Beziehungsphilosophie
        //    → Statische Qualität: "Wie wollen wir Beziehung leben?"
        //    → Höchste Gewichtung weil strukturgebend
        //
        // 2. Orientierung (25% - Pathos/Gefühl):
        //    → Körperliche Anziehungsmöglichkeit
        //    → Dynamische Qualität: Polarität der Begierde
        //    → OSHO: "Extreme ziehen sich an"
        //
        // 3. Dominanz (20% - Pathos/Gefühl):
        //    → Energetische Dynamik der Interaktion
        //    → Dynamische Qualität: Führen/Folgen-Balance
        //    → OSHO: "Tao - eine Energie, zwei Ausdrucksformen"
        //
        // 4. Geschlecht (15% - Pathos/Gefühl):
        //    → Gender-Chemie als Feinabstimmung
        //    → Ergänzt Orientierung mit Nuancen (z.B. non-binär)
        //    → Niedrigste Gewichtung: weniger fundamental als Philosophie
        //
        // SUMME: Logos 40% + Pathos 60% = 100%
        // → Gefühl als Antrieb, Verstand als Fundament
        // ═══════════════════════════════════════════════════════════════════════
        function calculateRelationshipQuality(person1, person2) {
            // ═══════════════════════════════════════════════════════════════════
            // NEUE ZENTRALE BERECHNUNG mit Resonanz
            // ═══════════════════════════════════════════════════════════════════
            // Formel: Q = [(A × wₐ) + (O × wₒ) + (D × wᵈ) + (G × wᵍ)] × R
            //
            // R = Resonanz-Koeffizient (0.9 - 1.1)
            // Kein harter K.O. mehr - sanfte Abstufung durch Resonanz

            const orientationScore = calculateOrientationScore(person1, person2);

            if (orientationScore === 0) {
                return {
                    score: 0,
                    blocked: true,
                    reason: "Keine körperliche Anziehung möglich",
                    breakdown: {
                        archetyp: 0,
                        dominanz: 0,
                        orientierung: 0,
                        geschlecht: 0
                    },
                    resonanz: { R: 0.9, M: 0, B: 0, interpretation: 'Blockiert' }
                };
            }

            // ═══════════════════════════════════════
            // EBENE 2: 4-Faktoren Qualitätsberechnung
            // ═══════════════════════════════════════

            const archetypeScore = getArchetypeScore(person1.archetyp, person2.archetyp);
            const dominanceScore = calculateDominanceHarmony(person1.dominanz, person2.dominanz);
            const genderScore = calculateGenderAttraction(person1, person2);

            // Gewichtete Basis-Summe nach Logos/Pathos-Prinzip
            const baseScore =
                (archetypeScore * 0.40) +      // 40% Logos - Beziehungsphilosophie
                (orientationScore * 0.25) +    // 25% Pathos - Körperliche Polarität
                (dominanceScore * 0.20) +      // 20% Pathos - Energetische Dynamik
                (genderScore * 0.15);          // 15% Pathos - Gender-Chemie

            // ═══════════════════════════════════════
            // EBENE 3: Resonanz als Meta-Dimension
            // ═══════════════════════════════════════
            // R moduliert das Gesamtergebnis (0.9 - 1.1)
            // Formel: Q = baseScore × R

            const resonanzResult = calculateResonanz(
                person1, person2,
                archetypeScore, orientationScore, dominanceScore, genderScore
            );

            // Finale Qualität mit Resonanz-Modulation
            const totalScore = baseScore * resonanzResult.R;

            // Logos/Pathos Breakdown für UI
            const logos = archetypeScore;
            const pathos = (orientationScore + dominanceScore + genderScore) / 3;

            return {
                score: Math.round(totalScore),
                baseScore: Math.round(baseScore),
                blocked: false,
                breakdown: {
                    archetyp: archetypeScore,
                    dominanz: dominanceScore,
                    orientierung: orientationScore,
                    geschlecht: genderScore
                },
                resonanz: resonanzResult,
                logos: logos,
                pathos: pathos
            };
        }

        // Calculate overall with 4-factor model + category details for UI
        function calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck) {
            // Use new 4-factor model for overall score
            const qualityResult = calculateRelationshipQuality(person1, person2);

            // Calculate category scores for UI display (radar chart, category bars)
            const categories = {};

            // Category A: Philosophy score from matrix
            categories.A = { score: logosCheck.score, modifier: 0, note: "Rein archetyp-basiert" };

            // Other categories with modifiers (for UI display)
            for (const cat of ['B', 'C', 'D', 'E', 'F']) {
                const result = calculateCategoryWithModifiers(cat, person1, person2, pathosCheck);
                categories[cat] = result;
            }

            return {
                overall: qualityResult.score,  // NEW: 4-factor score
                categories,                     // Keep for UI
                breakdown: qualityResult.breakdown  // NEW: factor breakdown
            };
        }

        // Get modifier summary for UI
        function getModifierSummary(person1, person2) {
            const summaries = [];
            const domMod = getDominanzModifier(person1.dominanz, person2.dominanz);
            if (domMod !== 0) {
                summaries.push({
                    type: "Dominanz",
                    modifier: domMod,
                    description: getDominanzDescription(person1.dominanz, person2.dominanz, domMod)
                });
            }
            return summaries;
        }

        // ========================================
        // NEW: Side-by-Side Comparison Functions
        // ========================================

        // Navigate through archetypes with forward/backward buttons
        function navigateArchetype(person, direction) {
            const selectId = person === 'ich' ? 'ichSelect' : 'partnerSelect';
            const mobileSelectId = person === 'ich' ? 'mobileIchSelect' : 'mobilePartnerSelect';
            const select = document.getElementById(selectId);
            const mobileSelect = document.getElementById(mobileSelectId);

            // Use whichever select is visible/available
            const activeSelect = select || mobileSelect;
            if (!activeSelect) return;

            const currentIndex = activeSelect.selectedIndex;
            const optionsCount = activeSelect.options.length;
            let newIndex = currentIndex + direction;

            // Wrap around
            if (newIndex < 0) newIndex = optionsCount - 1;
            if (newIndex >= optionsCount) newIndex = 0;

            // Update both desktop and mobile selects
            if (select) select.selectedIndex = newIndex;
            if (mobileSelect) mobileSelect.selectedIndex = newIndex;

            // Update global state variables
            const newValue = activeSelect.options[newIndex].value;
            if (person === 'ich') {
                currentArchetype = newValue;
                mobileIchArchetype = newValue;
            } else {
                selectedPartner = newValue;
                mobilePartnerArchetype = newValue;
            }

            // Trigger change event on the active select
            activeSelect.dispatchEvent(new Event('change'));

            // Update archetype grid
            updateArchetypeGrid(person, newValue);
        }

        // Function to select archetype from grid click
        function selectArchetypeFromGrid(person, archetype) {
            const selectId = person === 'ich' ? 'ichSelect' : 'partnerSelect';
            const mobileSelectId = person === 'ich' ? 'mobileIchSelect' : 'mobilePartnerSelect';
            const select = document.getElementById(selectId);
            const mobileSelect = document.getElementById(mobileSelectId);

            // Update select elements
            if (select) {
                for (let i = 0; i < select.options.length; i++) {
                    if (select.options[i].value === archetype) {
                        select.selectedIndex = i;
                        break;
                    }
                }
            }
            if (mobileSelect) {
                for (let i = 0; i < mobileSelect.options.length; i++) {
                    if (mobileSelect.options[i].value === archetype) {
                        mobileSelect.selectedIndex = i;
                        break;
                    }
                }
            }

            // Update global state variables
            if (person === 'ich') {
                currentArchetype = archetype;
                mobileIchArchetype = archetype;
            } else {
                selectedPartner = archetype;
                mobilePartnerArchetype = archetype;
            }

            // Update archetype grid highlighting
            updateArchetypeGrid(person, archetype);

            // Trigger change event
            const activeSelect = select || mobileSelect;
            if (activeSelect) {
                activeSelect.dispatchEvent(new Event('change'));
            }
        }

        // Function to update archetype grid highlighting
        function updateArchetypeGrid(person, archetype) {
            const gridId = person === 'ich' ? 'ich-archetype-grid' : 'partner-archetype-grid';
            const grid = document.getElementById(gridId);
            if (!grid) return;

            // Remove active class from all items
            grid.querySelectorAll('.archetype-symbol-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to selected item
            const selectedItem = grid.querySelector(`.archetype-symbol-item[data-archetype="${archetype}"]`);
            if (selectedItem) {
                selectedItem.classList.add('active');
            }
        }

        // Navigation auf Seite 2 (Ergebnis) - ruft navigateArchetype auf und aktualisiert Seite 2
        function navigateArchetypeOnPage2(person, direction) {
            navigateArchetype(person, direction);
            // Seite 2 explizit aktualisieren
            updateMobileResultPage();
        }

        // Navigation auf Seite 3 (Kategorien) - ruft navigateArchetype auf und aktualisiert Seite 3
        function navigateArchetypeOnPage3(person, direction) {
            navigateArchetype(person, direction);
            // Seite 3 explizit aktualisieren
            updateMobilePage3();
        }

        // Aktualisiert die Anzeige auf Mobile Seite 3
        function updateMobilePage3() {
            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];

            const ichEl = document.getElementById('mobileResultIch3');
            const partnerEl = document.getElementById('mobileResultPartner3');

            if (ichEl) ichEl.textContent = ichArch?.name || currentArchetype;
            if (partnerEl) partnerEl.textContent = partnerArch?.name || selectedPartner;

            // Kategorien-Balken aktualisieren
            const key = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions?.[key] || {};
            if (interaction.scores) {
                renderCategoryBars('mobileCategoryBars', interaction.scores);
            }
        }

        // Variable für aktuelle Kategorie im Modal
        let currentDisplayedCategory = 'A';

        // Navigation für CategoryModal - wechselt beide Archetypen (ICH)
        function navigateCategoryArchetype(direction) {
            navigateArchetype('ich', direction);
            // CategoryModal neu laden mit aktueller Kategorie
            showCategoryDetails(currentDisplayedCategory);
            // Alle Ansichten aktualisieren
            updateComparisonView();
        }

        function initComparisonLayout() {
            // ICH select
            const ichSelect = document.getElementById('ichSelect');
            if (ichSelect) {
                ichSelect.addEventListener('change', (e) => {
                    currentArchetype = e.target.value;
                    // Sync with old select if exists
                    const oldSelect = document.getElementById('archetypeSelect');
                    if (oldSelect) oldSelect.value = e.target.value;
                    updateArchetypeGrid('ich', e.target.value);
                    updateComparisonView();
                });
            }

            // Partner select
            const partnerSelect = document.getElementById('partnerSelect');
            if (partnerSelect) {
                partnerSelect.addEventListener('change', (e) => {
                    selectedPartner = e.target.value;
                    updateArchetypeGrid('partner', e.target.value);
                    updateComparisonView();
                });
            }

            // ICH compact dimensions
            document.querySelectorAll('input[name="ich-geschlecht-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.ich.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.ich.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });

            // Partner compact dimensions
            document.querySelectorAll('input[name="partner-geschlecht-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.partner.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.partner.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });
        }

        function updateComparisonView() {
            if (!data) return;

            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];

            // Update type names
            document.getElementById('resultIchType').textContent = ichArch?.name || currentArchetype;
            document.getElementById('resultPartnerType').textContent = partnerArch?.name || selectedPartner;

            // Calculate compatibility
            const person1 = { archetyp: currentArchetype, ...personDimensions.ich };
            const person2 = { archetyp: selectedPartner, ...personDimensions.partner };

            const pathosCheck = checkPhysicalCompatibility(person1, person2);
            const logosCheck = calculatePhilosophyCompatibility(currentArchetype, selectedPartner);

            // Update warnings
            const warningsContainer = document.getElementById('warningsContainer');
            warningsContainer.innerHTML = '';

            if (pathosCheck.result === 'unvollständig') {
                let warningHTML = '<div class="warning-box incomplete-warning">⚠️ Es fehlt noch:';
                if (pathosCheck.missingItems && pathosCheck.missingItems.length > 0) {
                    warningHTML += '<ul style="margin: 5px 0 0 20px; padding: 0;">';
                    pathosCheck.missingItems.forEach(item => {
                        warningHTML += `<li>${item}</li>`;
                    });
                    warningHTML += '</ul>';
                }
                warningHTML += '</div>';
                warningsContainer.innerHTML = warningHTML;
            } else if (pathosCheck.result === 'unmöglich') {
                warningsContainer.innerHTML = `<div class="warning-box pathos-warning">🚫 Keine emotionale/körperliche Anziehung: ${pathosCheck.reason}</div>`;
            } else if (pathosCheck.result === 'unsicher') {
                warningsContainer.innerHTML = `<div class="warning-box logos-warning">⚠️ Unsichere körperliche Anziehung (Exploration-Phase)</div>`;
            }

            // Warnung bei unsicherem Dominanz-Status (prüfe ob mindestens eine Auswahl "interessiert" ist)
            const hasInteressiert1 = person1.dominanz && Object.values(person1.dominanz).some(s => s === 'interessiert');
            const hasInteressiert2 = person2.dominanz && Object.values(person2.dominanz).some(s => s === 'interessiert');
            if (hasInteressiert1 || hasInteressiert2) {
                warningsContainer.innerHTML += `<div class="warning-box logos-warning">⚠️ Unsichere Dominanz-Dynamik (Exploration-Phase – reduzierte Konfidenz)</div>`;
            }

            if (logosCheck.score < 50) {
                warningsContainer.innerHTML += `<div class="warning-box logos-warning">⚠️ Verstandsebene-Warnung: Philosophie nur ${logosCheck.score}%</div>`;
            }

            // If dimensions incomplete, show empty state and return
            if (pathosCheck.result === 'unvollständig') {
                // Clear all expandable sections
                const percentage = document.getElementById('resultPercentage');
                const progressFill = document.getElementById('resultProgressFill');
                percentage.textContent = '–';
                percentage.className = 'result-percentage';
                progressFill.style.width = '0%';

                // Update desktop circle for incomplete state
                const desktopCircle = document.getElementById('desktopCirclePercentage');
                if (desktopCircle) desktopCircle.textContent = '–';
                const desktopScoreCircle = document.getElementById('desktopScoreCircle');
                if (desktopScoreCircle) desktopScoreCircle.style.background = 'linear-gradient(135deg, var(--text-muted), #666)';

                const categoryBars = document.getElementById('expandCategoryBars');
                if (categoryBars) categoryBars.innerHTML = '<p style="color: var(--text-muted); font-style: italic; text-align: center; padding: 20px;">Bitte alle Dimensionen auswählen</p>';

                const expandRadar = document.getElementById('expandRadarChart');
                if (expandRadar) expandRadar.innerHTML = '';

                const desktopScoreNoteIncomplete = document.getElementById('desktopScoreNote');
                if (desktopScoreNoteIncomplete) desktopScoreNoteIncomplete.textContent = 'Bitte alle Dimensionen auswählen.';

                return;
            }

            // Calculate overall score
            let overallScore = 0;
            let qualityBreakdown = { archetyp: 0, dominanz: 0, orientierung: 0, geschlecht: 0 };

            if (pathosCheck.result !== 'unmöglich') {
                const result = calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck);
                overallScore = result.overall;
                qualityBreakdown = result.breakdown || qualityBreakdown;

                // Update expandable category bars
                updateExpandableCategoryBars(result.categories);
            }

            // Update 4-Factor Breakdown (Desktop)
            const factorArchetyp = document.getElementById('desktopFactorArchetyp');
            const factorDominanz = document.getElementById('desktopFactorDominanz');
            const factorOrientierung = document.getElementById('desktopFactorOrientierung');
            const factorGeschlecht = document.getElementById('desktopFactorGeschlecht');

            if (factorArchetyp) factorArchetyp.textContent = qualityBreakdown.archetyp + '%';
            if (factorDominanz) factorDominanz.textContent = qualityBreakdown.dominanz + '%';
            if (factorOrientierung) factorOrientierung.textContent = qualityBreakdown.orientierung + '%';
            if (factorGeschlecht) factorGeschlecht.textContent = qualityBreakdown.geschlecht + '%';

            // Update expandable desktop factor content
            updateDesktopFactorContent();

            // Update result bar
            const percentage = document.getElementById('resultPercentage');
            const progressFill = document.getElementById('resultProgressFill');

            percentage.textContent = overallScore + '%';
            progressFill.style.width = overallScore + '%';

            // Update desktop score circle
            const desktopCircle = document.getElementById('desktopCirclePercentage');
            if (desktopCircle) {
                desktopCircle.textContent = overallScore + '%';
            }

            // Set color based on score (3-Stufen-Skala: 70/50)
            let colorClass = 'low';
            let color = 'var(--danger)';
            if (overallScore >= 70) { colorClass = 'good'; color = 'var(--primary)'; }
            else if (overallScore >= 50) { colorClass = 'moderate'; color = 'var(--warning)'; }

            percentage.className = 'result-percentage ' + colorClass;
            progressFill.style.background = color;

            // Update desktop circle color (3-Stufen-Skala: 70/50)
            const desktopScoreCircle = document.getElementById('desktopScoreCircle');
            if (desktopScoreCircle) {
                if (overallScore >= 70) {
                    desktopScoreCircle.style.background = 'linear-gradient(135deg, var(--primary), var(--primary-light))';
                } else if (overallScore >= 50) {
                    desktopScoreCircle.style.background = 'linear-gradient(135deg, var(--warning), #ffc966)';
                } else {
                    desktopScoreCircle.style.background = 'linear-gradient(135deg, var(--danger), #ff8a8a)';
                }
            }

            // Update Desktop Score Note (direkt beim Kreis) - 3-Stufen-Skala
            const desktopScoreNote = document.getElementById('desktopScoreNote');
            if (desktopScoreNote) {
                let noteText = '';
                let quoteText = '';
                if (pathosCheck.result === 'unmöglich') {
                    noteText = 'Keine Basis für Resonanz vorhanden.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + overallScore + '% – keine kompatible Basis vorhanden, deren Muster sich ausschließen.';
                } else if (overallScore >= 70) {
                    noteText = 'Gute Resonanz – Muster ergänzen sich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + overallScore + '% – eine gute Resonanz zwischen zwei Menschen, deren Muster sich ergänzen.';
                } else if (overallScore >= 50) {
                    noteText = 'Basis vorhanden, Arbeit erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + overallScore + '% – eine Basis ist vorhanden, erfordert aber bewusste Arbeit und Kommunikation.';
                } else {
                    noteText = 'Bewusste Reflexion erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + overallScore + '% – bewusste Reflexion und offene Kommunikation sind erforderlich.';
                }
                desktopScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
            }

            // Update Radar Chart
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions?.[interactionKey] || {};
            drawRadarChart(interaction.scores || {}, partnerArch?.color || '#457B9D');

            // Update Desktop Selection Info Message
            updateSelectionInfoMessage();
        }

        // Universelle Funktion für Kategorien-Balken (Mobile & Desktop)
        const categoryNamesMap = {
            A: 'Beziehungsphilosophie',
            B: 'Werte-Alignment',
            C: 'Nähe-Distanz',
            D: 'Autonomie',
            E: 'Kommunikation',
            F: 'Soziale Kompatibilität'
        };

        function renderCategoryBars(containerId, categories) {
            const container = document.getElementById(containerId);
            if (!container) return;

            let html = '';
            for (const [cat, catData] of Object.entries(categories)) {
                const score = catData.score || 0;
                let colorClass = 'low';
                if (score >= 70) colorClass = 'good';
                else if (score >= 50) colorClass = 'moderate';

                html += `
                    <div class="category-bar-row clickable-bar" style="margin-bottom: 12px; cursor: pointer; padding: 8px; border-radius: 8px; transition: background 0.2s;" onclick="showCategoryDetails('${cat}')" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px; align-items: center;">
                            <span style="font-size: 12px; color: var(--text-secondary);">${cat}: ${categoryNamesMap[cat]}</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; font-weight: 600;" class="${colorClass}">${score}%</span>
                                <span style="font-size: 10px; color: var(--text-muted);">ℹ</span>
                            </div>
                        </div>
                        <div style="height: 6px; background: var(--bg-dark); border-radius: 3px; overflow: hidden;">
                            <div style="height: 100%; width: ${score}%; background: var(--${colorClass === 'good' ? 'primary' : colorClass === 'moderate' ? 'warning' : 'danger'}); border-radius: 3px;"></div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // Desktop: Wrapper für Kompatibilität
        function updateExpandableCategoryBars(categories) {
            renderCategoryBars('expandCategoryBars', categories);
            // Auch Mobile aktualisieren wenn vorhanden
            renderCategoryBars('mobileCategoryBars', categories);
        }

        // Mobile Seite 3: Kategorien-Übersicht
        function updateMobileCategoriesPage() {
            // Typen-Anzeige aktualisieren
            const myArch = data?.archetypes?.[currentArchetype];
            const partnerArch = data?.archetypes?.[selectedPartner];

            const ich3 = document.getElementById('mobileResultIch3');
            const partner3 = document.getElementById('mobileResultPartner3');
            if (ich3) ich3.textContent = myArch?.name || currentArchetype;
            if (partner3) partner3.textContent = partnerArch?.name || selectedPartner;

            // Kategorien berechnen und rendern
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data?.interactions?.[interactionKey];

            if (interaction?.categories) {
                renderCategoryBars('mobileCategoryBars', interaction.categories);
            } else {
                // Fallback: Berechne Kategorien
                const categories = calculateCategoryScores(currentArchetype, selectedPartner);
                renderCategoryBars('mobileCategoryBars', categories);
            }
        }

        function showArchetypeInfo(person) {
            console.log('showArchetypeInfo called with:', person);
            const archetype = person === 'ich' ? currentArchetype : selectedPartner;
            console.log('archetype:', archetype, 'data:', data);
            if (!data || !data.archetypes || !data.archetypes[archetype]) {
                console.error('Data not available for archetype:', archetype);
                return;
            }

            // Set current index for swipe navigation
            currentDefinitionIndex = archetypeOrder.indexOf(archetype);
            if (currentDefinitionIndex === -1) currentDefinitionIndex = 0;
            currentDefinitionPerson = person;

            // Use the shared function to render content
            showArchetypeInfoByType(archetype);

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Add touch swipe support
            const modal = document.querySelector('#definitionModal .modal');
            modal.ontouchstart = handleDefinitionTouchStart;
            modal.ontouchend = handleDefinitionTouchEnd;
        }

        function showCategoryDetails(cat) {
            if (!data || !data.categories || !data.categories[cat]) return;

            // Aktuelle Kategorie speichern für Navigation
            currentDisplayedCategory = cat;

            const catInfo = data.categories[cat];
            const catNames = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'Nähe-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilität'
            };

            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const key = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions?.[key] || {};
            const catScore = interaction.scores?.[cat]?.value || 0;

            let scoreClass = 'low';
            let scoreText = 'Herausfordernd';
            if (catScore >= 70) { scoreClass = 'good'; scoreText = 'Gut'; }
            else if (catScore >= 50) { scoreClass = 'moderate'; scoreText = 'Mittel'; }

            let modalContent = `
                <div class="modal-category">
                    <div style="background: rgba(69,123,157,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary); font-size: 12px;">Aktuelle Kombination</span>
                            <span style="font-size: 18px; font-weight: 700; color: var(--${scoreClass === 'good' ? 'primary' : scoreClass === 'moderate' ? 'warning' : 'danger'});">${catScore}%</span>
                        </div>
                        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);">
                            <span style="color: #2ecc71;">${ichArch?.name || currentArchetype}</span>
                            <span style="color: var(--text-muted);"> × </span>
                            <span style="color: #e74c3c;">${partnerArch?.name || selectedPartner}</span>
                        </div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">${scoreText} in dieser Kategorie</div>
                    </div>

                    <div class="modal-category-header">
                        <div class="modal-category-letter">${cat}</div>
                        <div class="modal-category-name">${catNames[cat]}</div>
                    </div>
                    <div class="modal-category-desc">${catInfo.description || 'Keine Beschreibung verfügbar.'}</div>
            `;

            if (catInfo.subDimensions && catInfo.subDimensions.length > 0) {
                modalContent += `
                    <div class="definition-section">
                        <div class="definition-section-title">Subdimensionen <span style="font-size: 10px; color: var(--text-muted);">(klicken für Details)</span></div>
                        <ul class="definition-list variants clickable-subs">
                            ${catInfo.subDimensions.map(sub => `<li onclick="showSubDimensionInfo('${cat}', '${sub.replace(/'/g, "\\'")}')" style="cursor: pointer; padding: 8px; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">${sub} <span style="color: var(--text-muted); font-size: 10px;">→</span></li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            modalContent += '</div>';

            document.getElementById('modalTitle').textContent = `Qualitätsmuster ${cat}: ${catNames[cat]}`;
            document.getElementById('modalBody').innerHTML = modalContent;
            document.getElementById('categoryModal').classList.add('active');
        }

        const subDimensionData = {
            "Exklusivitäts-Erwartung": {
                was: "Die Erwartung, der einzige romantische/sexuelle Partner zu sein.",
                warum: "Diese Dimension ist fundamental, weil unterschiedliche Erwartungen zu Enttäuschung, Eifersucht und Vertrauensbrüchen führen können.",
                wozu: "Klare Erwartungen verhindern Missverständnisse und schaffen eine gemeinsame Basis für die Beziehungsgestaltung.",
                archetypen: {
                    single: "Flexibel - keine feste Erwartung, offen für verschiedene Modelle",
                    duo: "Hohe Erwartung an vollständige Exklusivität",
                    duo_flex: "Grundsätzlich exklusiv, aber mit Ausnahmen nach Absprache",
                    solopoly: "Keine Exklusivitätserwartung - jede Beziehung ist eigenständig",
                    polyamor: "Bewusste Nicht-Exklusivität mit klaren Strukturen",
                    ra: "Keine normativen Exklusivitätserwartungen - alles verhandelbar",
                    lat: "Flexibel - Exklusivität ist unabhängig von Wohnsituation",
                    aromantisch: "Romantische Exklusivität nicht relevant - andere Verbindungen zählen"
                }
            },
            "Offenheit für alternative Modelle": {
                was: "Die Bereitschaft, nicht-traditionelle Beziehungsformen zu akzeptieren oder auszuprobieren.",
                warum: "Unterschiedliche Offenheit kann zu Konflikten führen, wenn ein Partner expandieren möchte und der andere nicht.",
                wozu: "Gemeinsame Offenheit ermöglicht Wachstum und Anpassung der Beziehung an veränderte Bedürfnisse.",
                archetypen: {
                    single: "Oft sehr offen - keine festgelegte Struktur",
                    duo: "Tendenziell geschlossen - Monogamie als Ideal",
                    duo_flex: "Moderat offen - bereit für situative Anpassungen",
                    solopoly: "Sehr offen - lebt bereits alternatives Modell",
                    polyamor: "Strukturiert offen - klare Rahmen für Vielfalt",
                    ra: "Maximal offen - alle Normen werden hinterfragt",
                    lat: "Moderat offen - alternative Wohnform wird bereits gelebt",
                    aromantisch: "Offen für alternative Beziehungsformen - Romantik ist nicht zentral"
                }
            },
            "Beziehung als Lebensinhalt vs. Lebensbereich": {
                was: "Wie zentral ist die Beziehung im Leben? Ist sie alles oder ein Teil von vielem?",
                warum: "Wenn einer die Beziehung als Lebensmittelpunkt sieht und der andere als Nebensache, entstehen ungleiche Investitionen.",
                wozu: "Ähnliche Priorisierung schafft Balance und verhindert das Gefühl von Vernachlässigung oder Überforderung.",
                archetypen: {
                    single: "Lebensbereich - das eigene Leben steht im Zentrum",
                    duo: "Oft Lebensinhalt - die Beziehung ist sehr wichtig",
                    duo_flex: "Wichtiger Lebensbereich mit hoher Priorität",
                    solopoly: "Klar Lebensbereich - das Selbst bleibt Zentrum",
                    polyamor: "Wichtiger Lebensbereich - aber mit mehreren Beziehungen",
                    ra: "Lebensbereich - Autonomie und Selbstbestimmung zentral",
                    lat: "Wichtiger Lebensbereich - aber eigener Raum ist essentiell",
                    aromantisch: "Lebensbereich - Freundschaften und andere Verbindungen zentral"
                }
            },
            "Definition von Treue": {
                was: "Was bedeutet 'treu sein' konkret? Körperliche Exklusivität, emotionale Treue, oder Ehrlichkeit?",
                warum: "Unterschiedliche Definitionen führen oft zu den schmerzhaftesten Missverständnissen in Beziehungen.",
                wozu: "Eine gemeinsame Definition von Treue schafft Klarheit und Vertrauen - unabhängig davon, wie sie aussieht.",
                archetypen: {
                    single: "Flexibel - Treue ist kontextabhängig",
                    duo: "Klassisch - körperliche UND emotionale Exklusivität",
                    duo_flex: "Angepasst - emotionale Treue wichtiger als körperliche",
                    solopoly: "Neu definiert - Treue = Ehrlichkeit und Transparenz",
                    polyamor: "Strukturiert - Treue zu vereinbarten Regeln und Grenzen",
                    ra: "Individuell definiert - Treue ist nicht normativ vorgegeben",
                    lat: "Emotionale Treue wichtig - unabhängig von Wohnsituation",
                    aromantisch: "Treue zu Absprachen - romantische Treue nicht relevant"
                }
            },
            "Ethische Grundhaltung": {
                was: "Die gemeinsamen Werte wie Ehrlichkeit, Respekt, Consent und Fairness.",
                warum: "Unterschiedliche ethische Grundhaltungen untergraben das Fundament jeder Beziehung und führen zu Vertrauensverlust.",
                wozu: "Geteilte ethische Werte schaffen ein sicheres Fundament für alle anderen Aspekte der Beziehung.",
                archetypen: {
                    single: "Individuell geprägt - eigene ethische Standards",
                    duo: "Traditionell - gesellschaftliche Normen als Leitfaden",
                    duo_flex: "Reflektiert - bewusste Auseinandersetzung mit Normen",
                    solopoly: "Progressiv - aktive ethische Reflexion",
                    polyamor: "Strukturiert ethisch - klare Regeln für fairen Umgang",
                    ra: "Anarchisch-ethisch - Normen werden radikal hinterfragt",
                    lat: "Autonom-ethisch - Respekt vor individuellem Raum",
                    aromantisch: "Authentisch - Ehrlichkeit über eigene Grenzen"
                }
            },
            "Verantwortungsbewusstsein": {
                was: "Die Bereitschaft, Verantwortung für eigene Handlungen und deren Auswirkungen zu übernehmen.",
                warum: "Ohne Verantwortungsbewusstsein werden Fehler wiederholt und Partner verletzt.",
                wozu: "Verantwortung ermöglicht Wachstum, Reparatur nach Konflikten und nachhaltige Beziehungsqualität.",
                archetypen: {
                    single: "Primär für sich selbst verantwortlich",
                    duo: "Hohe gegenseitige Verantwortung erwartet",
                    duo_flex: "Balancierte Verantwortung mit Flexibilität",
                    solopoly: "Selbstverantwortung betont, aber fair zu Partnern",
                    polyamor: "Komplexe Verantwortung für mehrere Beziehungen",
                    ra: "Hohe Selbstverantwortung - keine normativen Erwartungen",
                    lat: "Verantwortung für Beziehungsqualität trotz Distanz",
                    aromantisch: "Verantwortung für klare Kommunikation der Grenzen"
                }
            },
            "Emotionale Verschmelzungs-Tendenz": {
                was: "Das Bedürfnis, emotional mit dem Partner zu verschmelzen - von 'wir sind eins' bis 'wir sind zwei'.",
                warum: "Starke Unterschiede führen dazu, dass einer sich eingeengt und der andere sich abgelehnt fühlt.",
                wozu: "Ähnliche Verschmelzungs-Präferenzen ermöglichen eine Nähe, die sich für beide richtig anfühlt.",
                archetypen: {
                    single: "Niedrig - Autonomie steht vor Verschmelzung",
                    duo: "Oft hoch - 'Wir' als zentrale Identität",
                    duo_flex: "Moderat - Nähe mit Grenzen",
                    solopoly: "Niedrig - bewusste Distanz zu Verschmelzung",
                    polyamor: "Differenziert - unterschiedlich mit verschiedenen Partnern",
                    ra: "Niedrig - Autonomie ist zentraler Wert",
                    lat: "Moderat - emotionale Nähe ohne räumliche Verschmelzung",
                    aromantisch: "Niedrig - romantische Verschmelzung nicht gewünscht"
                }
            },
            "Physische Nähe-Bedürfnisse": {
                was: "Wie viel körperliche Präsenz und Nähe braucht man? Zusammenleben, täglicher Kontakt, wöchentlich?",
                warum: "Mismatches führen zu Einsamkeit (bei zu wenig) oder Erstickung (bei zu viel).",
                wozu: "Abgestimmte Nähe-Bedürfnisse ermöglichen, dass beide sich gesehen und respektiert fühlen.",
                archetypen: {
                    single: "Flexibel - kein konstantes Nähe-Bedürfnis",
                    duo: "Hoch - oft Wunsch nach Zusammenleben",
                    duo_flex: "Moderat bis hoch mit Freiraum-Phasen",
                    solopoly: "Bewusst niedrig - eigener Wohnraum wichtig",
                    polyamor: "Komplex - unterschiedliche Nähe mit verschiedenen Partnern",
                    ra: "Individuell verhandelbar - keine normativen Erwartungen",
                    lat: "Bewusst niedrig - getrennte Wohnungen als Prinzip",
                    aromantisch: "Variabel - nicht an romantische Nähe gebunden"
                }
            },
            "Fähigkeit, Raum zu geben": {
                was: "Die Fähigkeit, dem Partner Freiraum zu lassen ohne sich vernachlässigt oder unsicher zu fühlen.",
                warum: "Ohne diese Fähigkeit entstehen Kontrolle, Eifersucht und Erstickung der Beziehung.",
                wozu: "Raum geben können ermöglicht individuelle Entwicklung innerhalb der Beziehung.",
                archetypen: {
                    single: "Hoch - Raum ist selbstverständlich",
                    duo: "Muss oft gelernt werden - Nähe ist Standard",
                    duo_flex: "Bewusst entwickelt - wichtig für das Modell",
                    solopoly: "Sehr hoch - Teil der Grundphilosophie",
                    polyamor: "Essentiell - strukturell eingebaut",
                    ra: "Maximal - Autonomie als höchster Wert",
                    lat: "Sehr hoch - räumlicher Freiraum ist zentral",
                    aromantisch: "Hoch - respektiert nicht-romantische Grenzen"
                }
            },
            "Individuelle Freiheit": {
                was: "Der Wert, den man persönlicher Freiheit in der Beziehung beimisst - eigene Entscheidungen, Hobbies, Freunde.",
                warum: "Unterschiedliche Freiheitsbedürfnisse führen zu Machtkämpfen oder Entfremdung.",
                wozu: "Respektierte Freiheit ermöglicht authentisches Selbst und verhindert Resentment.",
                archetypen: {
                    single: "Maximale Freiheit - das Kernbedürfnis",
                    duo: "Eingeschränkt - Kompromisse erwartet",
                    duo_flex: "Balanciert - Freiheit mit Rücksichtnahme",
                    solopoly: "Maximal - Autonomie ist nicht verhandelbar",
                    polyamor: "Hoch - aber mit Verantwortung verbunden",
                    ra: "Maximal - Freiheit von allen Normen",
                    lat: "Hoch - räumliche Autonomie garantiert Freiheit",
                    aromantisch: "Hoch - Freiheit von romantischen Erwartungen"
                }
            },
            "Entscheidungsautonomie": {
                was: "Wer entscheidet was? Wie viel Mitsprache hat der Partner bei persönlichen Entscheidungen?",
                warum: "Konflikte entstehen, wenn einer Kontrolle erwartet und der andere Autonomie braucht.",
                wozu: "Klare Entscheidungsstrukturen verhindern Machtkämpfe und schaffen Klarheit.",
                archetypen: {
                    single: "Vollständig - alle Entscheidungen selbst",
                    duo: "Oft geteilt - wichtige Dinge gemeinsam",
                    duo_flex: "Hybrid - manche gemeinsam, manche allein",
                    solopoly: "Hoch - Autonomie auch in der Beziehung",
                    polyamor: "Komplex - unterschiedlich je nach Beziehung",
                    ra: "Maximal - keine externen Vorgaben akzeptiert",
                    lat: "Hoch - eigene Entscheidungen im eigenen Raum",
                    aromantisch: "Hoch - Entscheidungen nicht an romantischen Normen orientiert"
                }
            },
            "Akzeptanz der Autonomie des anderen": {
                was: "Die Fähigkeit zu akzeptieren, dass der Partner eigene Entscheidungen trifft - auch wenn man nicht zustimmt.",
                warum: "Fehlende Akzeptanz führt zu Kontrolle, Manipulation und Vertrauensverlust.",
                wozu: "Akzeptanz ermöglicht echte Partnerschaft statt Abhängigkeit.",
                archetypen: {
                    single: "Hoch - Autonomie wird geschätzt",
                    duo: "Muss oft gelernt werden",
                    duo_flex: "Bewusst entwickelt",
                    solopoly: "Sehr hoch - zentral für das Modell",
                    polyamor: "Essentiell - ohne geht es nicht",
                    ra: "Maximal - Grundprinzip der Beziehungsphilosophie",
                    lat: "Hoch - respektiert räumliche Autonomie des anderen",
                    aromantisch: "Hoch - akzeptiert nicht-romantische Bedürfnisse"
                }
            },
            "Kommunikationstiefe": {
                was: "Wie tief gehen Gespräche? Von Alltag bis zu Ängsten, Träumen und Verletzlichkeit.",
                warum: "Unterschiedliche Tiefen-Präferenzen führen zu Frustration - einer will mehr, einer weniger.",
                wozu: "Passende Kommunikationstiefe schafft echte Verbindung und Verständnis.",
                archetypen: {
                    single: "Variabel - je nach Beziehung",
                    duo: "Oft hoch - alles teilen als Ideal",
                    duo_flex: "Selektiv tief - wichtiges wird geteilt",
                    solopoly: "Bewusst tief - Kommunikation ist essentiell",
                    polyamor: "Hoch - Komplexität erfordert Kommunikation",
                    ra: "Individuell - keine normativen Erwartungen an Tiefe",
                    lat: "Qualitätsfokussiert - tiefe Gespräche in begrenzter Zeit",
                    aromantisch: "Authentisch - tiefe Verbindung ohne romantische Komponente"
                }
            },
            "Konfliktfähigkeit": {
                was: "Wie geht man mit Konflikten um? Vermeidung, Eskalation, konstruktive Lösung?",
                warum: "Unterschiedliche Stile führen dazu, dass Konflikte ungelöst bleiben oder eskalieren.",
                wozu: "Kompatible Konfliktfähigkeit ermöglicht Wachstum durch Krisen statt Zerstörung.",
                archetypen: {
                    single: "Kann Konflikte vermeiden durch Distanz",
                    duo: "Muss Konflikte lösen - kein Entkommen",
                    duo_flex: "Flexibel - manchmal Distanz, manchmal Lösung",
                    solopoly: "Klar - bei Unlösbarkeit kann man gehen",
                    polyamor: "Entwickelt - Kommunikation als Lösung",
                    ra: "Individuell - keine externen Konfliktlösungsmodelle",
                    lat: "Distanz möglich - räumliche Trennung als Puffer",
                    aromantisch: "Sachlich - nicht-romantische Konfliktlösung"
                }
            },
            "Emotionale Transparenz": {
                was: "Wie offen teilt man Gefühle? Alles aussprechen oder manches für sich behalten?",
                warum: "Unterschiede führen zu Missverständnissen - einer fühlt sich verschlossen, der andere überfordert.",
                wozu: "Abgestimmte Transparenz schafft Vertrauen ohne Überforderung.",
                archetypen: {
                    single: "Selektiv - teilt was nötig ist",
                    duo: "Oft hohe Erwartung an Transparenz",
                    duo_flex: "Balanciert - wichtiges wird geteilt",
                    solopoly: "Hoch - Ehrlichkeit ist zentral",
                    polyamor: "Sehr hoch - Basis des Modells",
                    ra: "Individuell - keine normativen Transparenz-Erwartungen",
                    lat: "Qualitativ - tiefe Gespräche in begrenzter Zeit",
                    aromantisch: "Ehrlich - klar über eigene Grenzen"
                }
            },
            "Gesellschaftliche Akzeptanz": {
                was: "Wie wichtig ist es, dass Familie, Freunde und Gesellschaft die Beziehung akzeptieren?",
                warum: "Unterschiedliche Wichtigkeit führt zu Konflikten über 'Outing' und öffentliches Auftreten.",
                wozu: "Ähnliche Wichtigkeit ermöglicht einen gemeinsamen Umgang mit dem sozialen Umfeld.",
                archetypen: {
                    single: "Unkompliziert - gesellschaftlich akzeptiert",
                    duo: "Sehr wichtig - passt zur Norm",
                    duo_flex: "Moderat - gewisse Erklärungen nötig",
                    solopoly: "Weniger wichtig - lebt gegen die Norm",
                    polyamor: "Komplex - manche Offenheit, manche Diskretion",
                    ra: "Unwichtig - gesellschaftliche Normen werden abgelehnt",
                    lat: "Erklärungsbedürftig - 'Warum wohnt ihr nicht zusammen?'",
                    aromantisch: "Herausfordernd - romantische Norm ist tief verankert"
                }
            },
            "Integration in soziale Kreise": {
                was: "Wie wird die Beziehung in Freundeskreis, Familie und Arbeit integriert und präsentiert?",
                warum: "Unterschiede führen zu Frustration - einer will präsentieren, der andere verstecken.",
                wozu: "Gemeinsame Strategien für soziale Integration schaffen ein einheitliches Auftreten.",
                archetypen: {
                    single: "Einfach - keine komplexe Integration nötig",
                    duo: "Vollständig - Partner wird überall eingeführt",
                    duo_flex: "Weitgehend - mit gewissen Grenzen",
                    solopoly: "Selektiv - nicht überall erklärbar",
                    polyamor: "Komplex - unterschiedlich je nach Umfeld",
                    ra: "Individuell - Integration nach eigenen Regeln",
                    lat: "Erklärungsbedürftig - getrennte Wohnungen irritieren",
                    aromantisch: "Herausfordernd - 'Nur Freunde?' wird oft missverstanden"
                }
            },
            "Umgang mit Stigma": {
                was: "Wie geht man mit negativen Reaktionen auf die Beziehungsform um? Erklären, ignorieren, kämpfen?",
                warum: "Unterschiedliche Strategien führen zu Konflikten darüber, wie man als Paar auftritt.",
                wozu: "Gemeinsame Strategie stärkt die Beziehung gegen äußeren Druck.",
                archetypen: {
                    single: "Kaum Stigma - gesellschaftlich normal",
                    duo: "Kein Stigma - das Ideal der Gesellschaft",
                    duo_flex: "Leichtes Stigma - 'offene Beziehung'",
                    solopoly: "Erhebliches Stigma - schwer erklärbar",
                    polyamor: "Stigma vorhanden - aber zunehmend bekannt",
                    ra: "Hohes Stigma - radikale Position wird missverstanden",
                    lat: "Moderates Stigma - 'echte' Beziehung in Frage gestellt",
                    aromantisch: "Hohes Stigma - wird als Defizit wahrgenommen"
                }
            }
        };

        function showSubDimensionInfo(cat, subName) {
            const subData = subDimensionData[subName] || { was: "Keine Beschreibung verfügbar.", warum: "", wozu: "", archetypen: {} };
            const catNames = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'Nähe-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilität'
            };

            const ichArch = data?.archetypes?.[currentArchetype];
            const partnerArch = data?.archetypes?.[selectedPartner];
            const ichId = currentArchetype;
            const partnerId = selectedPartner;

            const ichPerspektive = subData.archetypen?.[ichId] || "Keine Daten";
            const partnerPerspektive = subData.archetypen?.[partnerId] || "Keine Daten";

            let modalContent = `
                <div style="background: rgba(69,123,157,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted);">Teil von Qualitätsmuster ${cat}: ${catNames[cat]}</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WAS?</div>
                    <p style="color: var(--text-primary); line-height: 1.5;">${subData.was}</p>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WARUM WICHTIG?</div>
                    <p style="color: var(--text-secondary); line-height: 1.5;">${subData.warum}</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WOZU?</div>
                    <p style="color: var(--text-secondary); line-height: 1.5;">${subData.wozu}</p>
                </div>

                <div style="background: rgba(46,204,113,0.1); padding: 12px; border-radius: 10px; margin-bottom: 10px;">
                    <div style="font-size: 12px; color: #2ecc71; font-weight: 600; margin-bottom: 8px;">ICH (${ichArch?.name || ichId}):</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${ichPerspektive}</p>
                </div>

                <div style="background: rgba(231,76,60,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="font-size: 12px; color: #e74c3c; font-weight: 600; margin-bottom: 8px;">PARTNER (${partnerArch?.name || partnerId}):</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${partnerPerspektive}</p>
                </div>

                <div style="background: rgba(108, 117, 125, 0.1); padding: 12px; border-radius: 10px;">
                    <div style="font-size: 12px; color: #6c757d; font-weight: 600; margin-bottom: 8px;">BEDEUTUNG FÜR EURE KOMBINATION:</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${generateCombinationAnalysis(ichId, partnerId, subName, subData)}</p>
                </div>
            `;

            document.getElementById('modalTitle').textContent = subName;
            document.getElementById('modalBody').innerHTML = modalContent;
        }

        function generateCombinationAnalysis(ichId, partnerId, subName, subData) {
            if (ichId === partnerId) {
                return `Da ihr beide denselben Archetyp habt, solltet ihr hier ähnliche Vorstellungen haben. Das reduziert Konfliktpotential in dieser Dimension erheblich.`;
            }

            const polyTypes = ['solopoly', 'polyamor', 'ra'];
            const monoTypes = ['single', 'duo', 'duo_flex', 'lat', 'aromantisch'];
            const ichIsPoly = polyTypes.includes(ichId);
            const partnerIsPoly = polyTypes.includes(partnerId);

            if (ichIsPoly !== partnerIsPoly) {
                return `Hier treffen fundamental unterschiedliche Weltanschauungen aufeinander. Ein Poly-Typ und ein Mono-Typ haben oft gegensätzliche Perspektiven auf "${subName}". Intensive Kommunikation und gegenseitiges Verständnis sind essentiell.`;
            }

            if (ichIsPoly && partnerIsPoly) {
                return `Als zwei Poly-Typen teilt ihr grundsätzlich ähnliche Werte in dieser Dimension. Die Unterschiede liegen eher in der konkreten Ausgestaltung als in den Grundprinzipien.`;
            }

            return `Eure Archetypen haben unterschiedliche Schwerpunkte in dieser Dimension. Offene Gespräche darüber, was euch beiden wichtig ist, helfen, gemeinsame Lösungen zu finden.`;
        }

        // NEU: Generiere dynamische Pro/Contra aus Micro-Statements
        function generateDynamicProContra(type1, type2, dims1, dims2) {
            const pro = [];
            const contra = [];

            // 1. Archetyp-basierte Pro/Contra
            const archStatements = getArchetypeStatements(type1, type2);
            if (archStatements) {
                pro.push(...(archStatements.pro || []));
                contra.push(...(archStatements.contra || []));
            }

            // 2. Dominanz-basierte Pro/Contra hinzufügen
            const domStatements = getDominanceStatements(dims1?.dominanz, dims2?.dominanz);
            if (domStatements && domStatements.pro) {
                // Füge nur die relevantesten hinzu, um Doppelungen zu vermeiden
                domStatements.pro.slice(0, 2).forEach(p => {
                    if (!pro.includes(p)) pro.push(p);
                });
            }
            if (domStatements && domStatements.contra) {
                domStatements.contra.slice(0, 2).forEach(c => {
                    if (!contra.includes(c)) contra.push(c);
                });
            }

            return { pro, contra };
        }

        // ═══════════════════════════════════════════════════════════════════════
        // KOMBINIERTES SYNTHESE-SYSTEM (A+B+C)
        // A) Score → Tonalität (positiv/neutral/kritisch)
        // B) Hash aus 4 Faktoren → deterministische Variation
        // C) 6 Kategorien + Templates → Zusammenführung
        // ═══════════════════════════════════════════════════════════════════════

        /**
         * Berechnet einen deterministischen Hash aus den 4 Faktoren
         * Gibt einen Index zurück, der für Statement-Auswahl verwendet wird
         */
        function getFactorHash(archetypScore, dominanzScore, orientierungScore, geschlechtScore) {
            // Einfacher aber deterministischer Hash basierend auf allen 4 Faktoren
            const combined = (archetypScore * 1000000) + (dominanzScore * 10000) + (orientierungScore * 100) + geschlechtScore;
            // Verwende Modulo um einen Index zu bekommen
            return combined;
        }

        /**
         * Wählt ein Statement deterministisch aus einem Array basierend auf Hash
         */
        function selectStatementByHash(statements, hash) {
            if (!statements || statements.length === 0) return null;
            const index = hash % statements.length;
            return statements[index];
        }

        /**
         * Bestimmt die Tonalität basierend auf dem Gesamtscore
         * @returns 'positiv' | 'neutral' | 'kritisch'
         */
        function getTonality(score) {
            if (score >= 70) return 'positiv';
            if (score >= 50) return 'neutral';
            return 'kritisch';
        }

        /**
         * Tonalitäts-Templates für die Synthese-Einleitungen
         */
        const tonalityTemplates = {
            positiv: {
                pathos: [
                    "Eine vielversprechende Resonanz entsteht zwischen euch.",
                    "Die emotionale Chemie deutet auf tiefes Potenzial hin.",
                    "Eure Energien harmonieren auf einer fundamentalen Ebene."
                ],
                logos: [
                    "Die strukturelle Kompatibilität bildet eine solide Basis.",
                    "Eure Beziehungsphilosophien ergänzen sich konstruktiv.",
                    "Das rationale Fundament ermöglicht fruchtbare Kommunikation."
                ]
            },
            neutral: {
                pathos: [
                    "Eine interessante Dynamik entfaltet sich zwischen euch.",
                    "Die emotionale Landschaft bietet sowohl Chancen als auch Herausforderungen.",
                    "Eure Energien begegnen sich – was daraus wird, liegt in euren Händen."
                ],
                logos: [
                    "Die strukturellen Unterschiede erfordern bewusste Navigation.",
                    "Eure Beziehungsvorstellungen haben Überschneidungen, aber auch Differenzen.",
                    "Dialog und Klärung werden wichtig sein für das gegenseitige Verständnis."
                ]
            },
            kritisch: {
                pathos: [
                    "Die emotionalen Welten prallen aufeinander.",
                    "Spannungen auf der Gefühlsebene sind zu erwarten.",
                    "Die unterschiedlichen emotionalen Bedürfnisse erfordern besondere Achtsamkeit."
                ],
                logos: [
                    "Fundamentale Unterschiede in den Beziehungsvorstellungen werden sichtbar.",
                    "Die strukturellen Differenzen stellen eine erhebliche Herausforderung dar.",
                    "Grundlegende Gespräche über Erwartungen sind unerlässlich."
                ]
            }
        };

        /**
         * Kategorie-spezifische Synthese-Bausteine für die 6 Bereiche
         */
        const categorySynthesisTemplates = {
            A: { // Beziehungsphilosophie
                name: "Beziehungsphilosophie",
                positiv: "Eure Grundhaltungen zu Beziehungen harmonieren.",
                neutral: "Eure Beziehungsphilosophien haben gemeinsame Punkte, aber auch Unterschiede.",
                kritisch: "Fundamentale Differenzen in der Beziehungsphilosophie erfordern Klärung."
            },
            B: { // Werte-Alignment
                name: "Werte-Alignment",
                positiv: "Geteilte Werte bilden ein stabiles Fundament.",
                neutral: "Manche Werte teilt ihr, andere unterscheiden sich.",
                kritisch: "Unterschiedliche Wertevorstellungen können zu Konflikten führen."
            },
            C: { // Nähe-Distanz
                name: "Nähe-Distanz",
                positiv: "Eure Bedürfnisse nach Nähe und Raum passen gut zusammen.",
                neutral: "Die Balance zwischen Nähe und Distanz wird Kommunikation erfordern.",
                kritisch: "Unterschiedliche Nähe-Distanz-Bedürfnisse können Spannung erzeugen."
            },
            D: { // Autonomie
                name: "Autonomie",
                positiv: "Ihr respektiert gegenseitig eure Unabhängigkeit.",
                neutral: "Das Autonomie-Verständnis bedarf weiterer Abstimmung.",
                kritisch: "Konfliktpotenzial bei unterschiedlichen Autonomie-Erwartungen."
            },
            E: { // Kommunikation
                name: "Kommunikation",
                positiv: "Die Basis für fruchtbaren Dialog ist gegeben.",
                neutral: "Kommunikationsstile unterscheiden sich – Anpassung möglich.",
                kritisch: "Unterschiedliche Kommunikationsweisen können Missverständnisse erzeugen."
            },
            F: { // Soziale Kompatibilität
                name: "Soziale Kompatibilität",
                positiv: "Soziale Vorstellungen und Umfelder harmonieren.",
                neutral: "Soziale Kompatibilität ist teilweise gegeben.",
                kritisch: "Unterschiedliche soziale Erwartungen können belasten."
            }
        };

        function generateCombinedPathos(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            // Use global archetype keys as IDs since archetypeDefinitions doesn't have id property
            const ichId = ichArch?.id || currentArchetype || '';
            const partnerId = partnerArch?.id || selectedPartner || '';

            // Berechne die 4 Faktor-Scores
            const person1 = {
                archetyp: ichId,
                dominanz: personDimensions.ich?.dominanz,
                orientierung: personDimensions.ich?.orientierung,
                geschlecht: personDimensions.ich?.geschlecht,
                orientierungStatus: personDimensions.ich?.orientierungStatus
            };
            const person2 = {
                archetyp: partnerId,
                dominanz: personDimensions.partner?.dominanz,
                orientierung: personDimensions.partner?.orientierung,
                geschlecht: personDimensions.partner?.geschlecht,
                orientierungStatus: personDimensions.partner?.orientierungStatus
            };

            // Hole Score-Breakdown
            const qualityResult = calculateRelationshipQuality(person1, person2);
            const breakdown = qualityResult.breakdown || { archetyp: 50, dominanz: 75, orientierung: 100, geschlecht: 100 };
            const overallScore = qualityResult.score || 50;

            // A) Bestimme Tonalität basierend auf Score
            const tonality = getTonality(overallScore);

            // B) Berechne Hash für deterministische Variation
            const hash = getFactorHash(breakdown.archetyp, breakdown.dominanz, breakdown.orientierung, breakdown.geschlecht);

            // Hole alle Statement-Quellen
            const archStatements = getArchetypeStatements(ichId, partnerId);
            const domStatements = getDominanceStatements(person1.dominanz, person2.dominanz);
            const orientStatements = getOrientierungStatements(person1.orientierung, person2.orientierung, person1.geschlecht, person2.geschlecht);
            const statusStmts = getStatusStatements(personDimensions.ich, personDimensions.partner);

            // C) Baue Synthese mit Templates
            const textParts = [];

            // 1. Tonalitäts-Einleitung
            const tonalityIntro = selectStatementByHash(tonalityTemplates[tonality].pathos, hash);
            if (tonalityIntro) textParts.push(tonalityIntro);

            // 2. Archetyp-Statement (Primzahl-Offset für unabhängigen Index)
            if (archStatements?.pathos) {
                const gemeinsam = archStatements.pathos.gemeinsam || [];
                const spannung = archStatements.pathos.spannung || [];
                const allPathos = [...gemeinsam, ...spannung];
                const selected = selectStatementByHash(allPathos, hash + 7);
                if (selected) textParts.push(selected);
            }

            // 3. Dominanz-Statement (Primzahl-Offset für unabhängigen Index)
            if (domStatements?.pathos?.length && domStatements !== dominanceStatements?.default) {
                const selected = selectStatementByHash(domStatements.pathos, hash + 11);
                if (selected) textParts.push(selected);
            }

            // 4. Orientierungs-Statement (Primzahl-Offset für unabhängigen Index)
            if (orientStatements?.pathos?.length) {
                const selected = selectStatementByHash(orientStatements.pathos, hash + 17);
                if (selected) textParts.push(selected);
            }

            // 5. Status-Statement (Primzahl-Offset für unabhängigen Index)
            if (statusStmts?.pathos?.length && statusStmts !== statusStatements?.default) {
                const selected = selectStatementByHash(statusStmts.pathos, hash + 23);
                if (selected) textParts.push(selected);
            }

            // Fallback
            if (textParts.length === 0) {
                return `${ichName} und ${partnerName} können emotional zueinander finden, auch wenn ihre Grundhaltungen sich unterscheiden. Die Herausforderung liegt darin, die emotionalen Bedürfnisse des anderen zu verstehen und zu respektieren.`;
            }

            return textParts.join(' ');
        }

        function generateCombinedLogos(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            // Use global archetype keys as IDs since archetypeDefinitions doesn't have id property
            const ichId = ichArch?.id || currentArchetype || '';
            const partnerId = partnerArch?.id || selectedPartner || '';

            // Berechne die 4 Faktor-Scores
            const person1 = {
                archetyp: ichId,
                dominanz: personDimensions.ich?.dominanz,
                orientierung: personDimensions.ich?.orientierung,
                geschlecht: personDimensions.ich?.geschlecht,
                orientierungStatus: personDimensions.ich?.orientierungStatus
            };
            const person2 = {
                archetyp: partnerId,
                dominanz: personDimensions.partner?.dominanz,
                orientierung: personDimensions.partner?.orientierung,
                geschlecht: personDimensions.partner?.geschlecht,
                orientierungStatus: personDimensions.partner?.orientierungStatus
            };

            // Hole Score-Breakdown
            const qualityResult = calculateRelationshipQuality(person1, person2);
            const breakdown = qualityResult.breakdown || { archetyp: 50, dominanz: 75, orientierung: 100, geschlecht: 100 };
            const overallScore = qualityResult.score || 50;

            // Get category scores
            const key = `${ichId}_${partnerId}`;
            const interaction = data?.interactions?.[key];
            const categoryScores = interaction?.scores || {};

            // A) Bestimme Tonalität basierend auf Score
            const tonality = getTonality(overallScore);

            // B) Berechne Hash für deterministische Variation
            const hash = getFactorHash(breakdown.archetyp, breakdown.dominanz, breakdown.orientierung, breakdown.geschlecht);

            // Hole alle Statement-Quellen
            const archStatements = getArchetypeStatements(ichId, partnerId);
            const domStatements = getDominanceStatements(person1.dominanz, person2.dominanz);
            const orientStatements = getOrientierungStatements(person1.orientierung, person2.orientierung, person1.geschlecht, person2.geschlecht);
            const statusStmts = getStatusStatements(personDimensions.ich, personDimensions.partner);

            // C) Baue Synthese mit Templates
            const textParts = [];

            // 1. Tonalitäts-Einleitung
            const tonalityIntro = selectStatementByHash(tonalityTemplates[tonality].logos, hash);
            if (tonalityIntro) textParts.push(tonalityIntro);

            // 2. Archetyp-Statement (Primzahl-Offset für unabhängigen Index)
            if (archStatements?.logos) {
                const gemeinsam = archStatements.logos.gemeinsam || [];
                const unterschied = archStatements.logos.unterschied || [];
                // Bei niedrigem Score auch Unterschiede einbeziehen
                const allLogos = tonality === 'kritisch' ? [...gemeinsam, ...unterschied] : gemeinsam;
                const selected = selectStatementByHash(allLogos.length > 0 ? allLogos : unterschied, hash + 7);
                if (selected) textParts.push(selected);
            }

            // 3. Kategorie-basierte Synthese (C: 6 Kategorien einbeziehen)
            const relevantCategories = ['A', 'B', 'C']; // Fokus auf die wichtigsten
            const categoryInsights = [];
            for (const cat of relevantCategories) {
                const catScore = categoryScores[cat]?.value || 50;
                const catTonality = getTonality(catScore);
                const catTemplate = categorySynthesisTemplates[cat];
                if (catTemplate && catTonality !== 'neutral') { // Nur nicht-neutrale Kategorien erwähnen
                    categoryInsights.push(catTemplate[catTonality]);
                }
            }
            // Wähle eine Kategorie-Einsicht basierend auf Primzahl-Offset
            if (categoryInsights.length > 0) {
                const selectedInsight = selectStatementByHash(categoryInsights, hash + 13);
                if (selectedInsight) textParts.push(selectedInsight);
            }

            // 4. Dominanz-Statement (Primzahl-Offset für unabhängigen Index)
            if (domStatements?.logos?.length && domStatements !== dominanceStatements?.default) {
                const selected = selectStatementByHash(domStatements.logos, hash + 11);
                if (selected) textParts.push(selected);
            }

            // 5. Status-Statement (Primzahl-Offset für unabhängigen Index)
            if (statusStmts?.logos?.length && statusStmts !== statusStatements?.default) {
                const selected = selectStatementByHash(statusStmts.logos, hash + 23);
                if (selected) textParts.push(selected);
            }

            // Fallback mit Score-basierter Aussage
            if (textParts.length === 0) {
                if (overallScore >= 70) {
                    return `${ichName} und ${partnerName} teilen viele rationale Grundüberzeugungen über Beziehungen (Score: ${overallScore}%). Das bildet eine solide Basis für konstruktive Gespräche.`;
                } else if (overallScore < 50) {
                    return `${ichName} und ${partnerName} haben unterschiedliche rationale Vorstellungen von Beziehungen (Score: ${overallScore}%). Grundlegende Gespräche über Erwartungen sind wichtig.`;
                }
                return `${ichName} und ${partnerName} haben einige Überschneidungen in ihren rationalen Beziehungsvorstellungen (Score: ${overallScore}%), aber auch Unterschiede, die Kommunikation erfordern.`;
            }

            return textParts.join(' ');
        }

        // Legacy-Funktion für Kompatibilität (wird nicht mehr verwendet)
        function generateCombinedLogos_legacy(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            // Use global archetype keys as IDs since archetypeDefinitions doesn't have id property
            const ichId = ichArch?.id || currentArchetype || '';
            const partnerId = partnerArch?.id || selectedPartner || '';

            // Get philosophy score from compatibility matrix
            const key = `${ichId}_${partnerId}`;
            const interaction = data?.interactions?.[key];
            const philScore = interaction?.scores?.A?.value || interaction?.overall || 50;

            // Hole Statements aus der Datenbank
            const archStatements = getArchetypeStatements(ichId, partnerId);
            const domStatements = getDominanceStatements(
                personDimensions.ich?.dominanz,
                personDimensions.partner?.dominanz
            );
            const orientStatements = getOrientierungStatements(
                personDimensions.ich?.orientierung,
                personDimensions.partner?.orientierung,
                personDimensions.ich?.geschlecht,
                personDimensions.partner?.geschlecht
            );
            const statusStmts = getStatusStatements(
                personDimensions.ich,
                personDimensions.partner
            );

            const textParts = [];

            // Archetyp-basierte Logos-Statements
            if (archStatements?.logos) {
                if (archStatements.logos.gemeinsam?.length) {
                    textParts.push(archStatements.logos.gemeinsam[0]);
                }
                if (archStatements.logos.unterschied?.length && philScore < 70) {
                    textParts.push(archStatements.logos.unterschied[0]);
                }
            }

            // Dominanz-basierte Logos-Statements (nur wenn nicht default)
            if (domStatements?.logos?.length && domStatements !== dominanceStatements.default) {
                textParts.push(domStatements.logos[0]);
            }

            // Orientierungs-basierte Logos-Statements hinzufügen (nur wenn nicht default)
            if (orientStatements?.logos?.length && orientStatements !== orientierungStatements.default) {
                textParts.push(orientStatements.logos[0]);
            }

            // Status-basierte Logos-Statements hinzufügen (Pirsig-Perspektive)
            if (statusStmts?.logos?.length && statusStmts !== statusStatements.default) {
                textParts.push(statusStmts.logos[0]);
            }

            // Fallback mit Philosophie-Score
            if (textParts.length === 0) {
                if (philScore >= 80) {
                    return `${ichName} und ${partnerName} teilen viele rationale Grundüberzeugungen über Beziehungen (Philosophie-Score: ${philScore}%). Das bildet eine solide Basis für konstruktive Gespräche.`;
                } else if (philScore < 50) {
                    return `${ichName} und ${partnerName} haben unterschiedliche rationale Vorstellungen von Beziehungen (Philosophie-Score: ${philScore}%). Grundlegende Gespräche über Erwartungen sind wichtig.`;
                }
                return `${ichName} und ${partnerName} haben einige Überschneidungen in ihren rationalen Beziehungsvorstellungen (Philosophie-Score: ${philScore}%), aber auch Unterschiede, die Kommunikation erfordern.`;
            }

            return textParts.join(' ');
        }

        // ========================================
        // MOBILE MULTI-PAGE FUNCTIONS
        // ========================================

        let currentMobilePage = 1;
        let mobilePersonDimensions = {
            ich: {
                geschlecht: { primary: null, secondary: null },
                dominanz: { dominant: null, submissiv: null, switch: null, ausgeglichen: null },
                orientierung: { heterosexuell: null, homosexuell: null, bisexuell: null }
            },
            partner: {
                geschlecht: { primary: null, secondary: null },
                dominanz: { dominant: null, submissiv: null, switch: null, ausgeglichen: null },
                orientierung: { heterosexuell: null, homosexuell: null, bisexuell: null }
            }
        };
        let mobileIchArchetype = 'single';
        let mobilePartnerArchetype = 'duo';
        let mobileTouchStartX = 0;
        let mobileTouchEndX = 0;

        function getMissingDimensions() {
            // Check if we're in mobile mode
            const isMobile = window.innerWidth <= 768;
            const dimensions = isMobile ? mobilePersonDimensions : personDimensions;
            const missing = [];

            // Check ICH dimensions
            // Geschlecht ist jetzt { primary, secondary } - nur primary ist erforderlich
            if (!dimensions.ich.geschlecht || !dimensions.ich.geschlecht.primary) {
                missing.push('Ich: Geschlecht');
            }
            if (dimensions.ich.dominanz === null) {
                missing.push('Ich: Dominanz');
            }
            if (dimensions.ich.orientierung === null) {
                missing.push('Ich: Orientierung');
            }
            if (dimensions.ich.orientierungStatus === null) {
                missing.push('Ich: Orientierung-Status');
            }

            // Check PARTNER dimensions
            if (!dimensions.partner.geschlecht || !dimensions.partner.geschlecht.primary) {
                missing.push('Partner: Geschlecht');
            }
            if (dimensions.partner.dominanz === null) {
                missing.push('Partner: Dominanz');
            }
            if (dimensions.partner.orientierung === null) {
                missing.push('Partner: Orientierung');
            }
            if (dimensions.partner.orientierungStatus === null) {
                missing.push('Partner: Orientierung-Status');
            }

            return missing;
        }

        function validateDimensionsComplete() {
            return getMissingDimensions().length === 0;
        }

        function showValidationWarning() {
            // Find or create warning element
            let warning = document.getElementById('dimensionWarning');
            if (warning) {
                warning.remove();
            }

            const missingItems = getMissingDimensions();

            warning = document.createElement('div');
            warning.id = 'dimensionWarning';
            warning.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(231, 76, 60, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideDown 0.3s ease;
                max-width: 90%;
                text-align: left;
            `;

            // Build message with missing items
            let messageHTML = '<div style="margin-bottom: 8px;">⚠️ Es fehlt noch:</div>';
            messageHTML += '<ul style="margin: 0; padding-left: 20px; font-weight: normal; font-size: 13px;">';
            missingItems.forEach(item => {
                messageHTML += `<li>${item}</li>`;
            });
            messageHTML += '</ul>';

            warning.innerHTML = messageHTML;
            document.body.appendChild(warning);

            // Auto-remove after 4 seconds (slightly longer for reading)
            setTimeout(() => {
                warning.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => warning.remove(), 300);
            }, 4000);
        }

        function mobileGoToPage(pageNumber, skipPushState = false) {
            // Validate before moving from page 1 to page 2
            if (currentMobilePage === 1 && pageNumber === 2 && !validateDimensionsComplete()) {
                showValidationWarning();
                return;
            }

            // Hide all pages
            document.querySelectorAll('.mobile-page').forEach(p => {
                p.classList.remove('active');
            });

            // Show target page
            const targetPage = document.getElementById(`mobilePage${pageNumber}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update dots
            document.querySelectorAll('.page-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === pageNumber - 1);
            });

            currentMobilePage = pageNumber;

            // Update page content when navigating
            if (pageNumber === 2) {
                updateMobileResultPage();
            } else if (pageNumber === 3) {
                updateMobileCategoriesPage();
            }

            // Push to browser history for back button navigation (only for forward navigation)
            if (!skipPushState) {
                history.pushState({ mobilePage: pageNumber }, '', `#seite${pageNumber}`);
            }

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function initMobileSwipe() {
            const mobileContainer = document.getElementById('mobileMultipage');
            if (!mobileContainer) return;

            mobileContainer.addEventListener('touchstart', (e) => {
                mobileTouchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            mobileContainer.addEventListener('touchend', (e) => {
                mobileTouchEndX = e.changedTouches[0].screenX;
                handleMobileSwipe();
            }, { passive: true });
        }

        function handleMobileSwipe() {
            const swipeThreshold = 100;
            const diff = mobileTouchStartX - mobileTouchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0 && currentMobilePage < 2) {
                    // Swipe left -> next page (max 2 pages)
                    mobileGoToPage(currentMobilePage + 1);
                } else if (diff < 0 && currentMobilePage > 1) {
                    // Swipe right -> previous page
                    mobileGoToPage(currentMobilePage - 1);
                }
            }
        }

        function initMobileDimensionListeners() {
            // ICH Select
            const mobileIchSelect = document.getElementById('mobileIchSelect');
            if (mobileIchSelect) {
                mobileIchSelect.addEventListener('change', (e) => {
                    mobileIchArchetype = e.target.value;
                    // Sync with desktop
                    const desktopSelect = document.getElementById('ichSelect');
                    if (desktopSelect) desktopSelect.value = e.target.value;
                    currentArchetype = e.target.value;
                    updateComparisonView();
                });
            }

            // Partner Select
            const mobilePartnerSelect = document.getElementById('mobilePartnerSelect');
            if (mobilePartnerSelect) {
                mobilePartnerSelect.addEventListener('change', (e) => {
                    mobilePartnerArchetype = e.target.value;
                    // Sync with desktop
                    const desktopSelect = document.getElementById('partnerSelect');
                    if (desktopSelect) desktopSelect.value = e.target.value;
                    selectedPartner = e.target.value;
                    updateComparisonView();
                });
            }

            // ICH Dimensions
            document.querySelectorAll('input[name="mobile-ich-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.ich.geschlecht = e.target.value;
                    personDimensions.ich.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('ich-geschlecht-new', e.target.value);
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="mobile-ich-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('ich', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-ich-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.ich.dominanzStatus = e.target.value;
                    personDimensions.ich.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('ich-dominanz-status-new', e.target.value);
                    updateComparisonView();
                });
            });

            // Partner Dimensions
            document.querySelectorAll('input[name="mobile-partner-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.partner.geschlecht = e.target.value;
                    personDimensions.partner.geschlecht = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('partner-geschlecht-new', e.target.value);
                    updateComparisonView();
                });
            });
            document.querySelectorAll('input[name="mobile-partner-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzChange('partner', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-partner-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.partner.dominanzStatus = e.target.value;
                    personDimensions.partner.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('partner-dominanz-status-new', e.target.value);
                    updateComparisonView();
                });
            });
        }

        function syncDimensionToDesktop(name, value) {
            const desktopRadio = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (desktopRadio) {
                desktopRadio.checked = true;
                const container = desktopRadio.closest('.compact-dimension');
                if (container) container.classList.remove('needs-selection');
            }
        }

        function updateMobileResultPage() {
            if (!data) return;

            const ichArch = data.archetypes[mobileIchArchetype || currentArchetype];
            const partnerArch = data.archetypes[mobilePartnerArchetype || selectedPartner];

            // Update type names
            document.getElementById('mobileResultIch').textContent = ichArch?.name || mobileIchArchetype;
            document.getElementById('mobileResultPartner').textContent = partnerArch?.name || mobilePartnerArchetype;

            // Calculate scores - use mobilePersonDimensions for consistency with tooltips
            const dims = mobilePersonDimensions;
            const person1 = { archetyp: mobileIchArchetype || currentArchetype, ...dims.ich };
            const person2 = { archetyp: mobilePartnerArchetype || selectedPartner, ...dims.partner };

            // Check if both genders are selected before calculating
            const g1 = dims.ich.geschlecht;
            const g2 = dims.partner.geschlecht;

            // Check if any orientierung is selected for both (Primary/Secondary structure)
            const hasOri1 = dims.ich.orientierung && dims.ich.orientierung.primary;
            const hasOri2 = dims.partner.orientierung && dims.partner.orientierung.primary;

            // Check if any dominanz is selected for both (Primary/Secondary structure)
            const hasDom1 = dims.ich.dominanz && dims.ich.dominanz.primary;
            const hasDom2 = dims.partner.dominanz && dims.partner.dominanz.primary;

            const isIncomplete = !g1 || !g2 || !hasOri1 || !hasOri2 || !hasDom1 || !hasDom2;

            const qualityResult = isIncomplete ?
                { score: 0, blocked: false, incomplete: true, breakdown: { archetyp: 0, dominanz: 0, orientierung: 0, geschlecht: 0 } } :
                calculateRelationshipQuality(person1, person2);

            // Update score circle
            const scoreCircle = document.getElementById('mobileScoreCircle');

            // Set score circle color and content
            // Kein harter K.O. mehr - sanfte Abstufung durch Resonanz
            if (qualityResult.incomplete) {
                scoreCircle.textContent = '–';
                scoreCircle.style.background = 'linear-gradient(135deg, var(--bg-card), var(--bg-secondary))';
            } else if (qualityResult.score < 30) {
                // Sehr niedrige Resonanz (früher: blocked)
                scoreCircle.textContent = qualityResult.score + '%';
                scoreCircle.style.background = 'linear-gradient(135deg, var(--danger), #c0392b)';
            } else if (qualityResult.score >= 80) {
                scoreCircle.textContent = qualityResult.score + '%';
                scoreCircle.style.background = 'linear-gradient(135deg, var(--success), #1e8449)';
            } else if (qualityResult.score >= 65) {
                scoreCircle.textContent = qualityResult.score + '%';
                scoreCircle.style.background = 'linear-gradient(135deg, var(--primary), var(--primary-light))';
            } else if (qualityResult.score >= 50) {
                scoreCircle.textContent = qualityResult.score + '%';
                scoreCircle.style.background = 'linear-gradient(135deg, var(--warning), #d68910)';
            } else {
                scoreCircle.textContent = qualityResult.score + '%';
                scoreCircle.style.background = 'linear-gradient(135deg, var(--danger), #c0392b)';
            }

            // Update factor breakdown - show 0% or actual values
            document.getElementById('mobileFactorArchetyp').textContent = qualityResult.incomplete ? '–' : qualityResult.breakdown.archetyp + '%';
            document.getElementById('mobileFactorDominanz').textContent = qualityResult.incomplete ? '–' : qualityResult.breakdown.dominanz + '%';
            document.getElementById('mobileFactorOrientierung').textContent = qualityResult.incomplete ? '–' : qualityResult.breakdown.orientierung + '%';
            document.getElementById('mobileFactorGeschlecht').textContent = qualityResult.incomplete ? '–' : qualityResult.breakdown.geschlecht + '%';

            // Update Mobile Score Note (direkt beim Kreis)
            const mobileScoreNote = document.getElementById('mobileScoreNote');
            if (mobileScoreNote) {
                let noteText = '';
                let quoteText = '';
                const score = qualityResult.score;
                if (qualityResult.incomplete) {
                    noteText = 'Bitte alle Dimensionen auswählen.';
                    mobileScoreNote.textContent = noteText;
                } else if (score < 30) {
                    // Sehr niedrige Resonanz - sanfter Hinweis statt K.O.
                    noteText = 'Sehr niedrige Resonanz – große Unterschiede.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + score + '% – die Muster unterscheiden sich stark, was intensive Kommunikation erfordert.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else if (score >= 80) {
                    noteText = 'Hohe Resonanz – Muster ergänzen sich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + score + '% – eine hohe Resonanz zwischen zwei Menschen, deren Muster sich ergänzen und verstärken.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else if (score >= 65) {
                    noteText = 'Solide Balance mit Potenzial.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + score + '% – eine solide Balance mit Entwicklungspotenzial für beide Partner.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else if (score >= 50) {
                    noteText = 'Basis vorhanden, Arbeit erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + score + '% – eine Basis ist vorhanden, erfordert aber bewusste Arbeit und Kommunikation.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else {
                    noteText = 'Bewusste Reflexion erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualität von ' + score + '% – bewusste Reflexion und offene Kommunikation sind erforderlich.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                }
            }
        }

        function updateMobileProContraPage() {
            if (!data) return;

            const ichArch = data.archetypes[mobileIchArchetype || currentArchetype];
            const partnerArch = data.archetypes[mobilePartnerArchetype || selectedPartner];

            // Update title
            const title = document.getElementById('mobileProContraTitle');
            if (title) {
                title.textContent = `${ichArch?.name || 'ICH'} × ${partnerArch?.name || 'PARTNER'}`;
            }

            // Get interaction data
            const interactionKey = `${mobileIchArchetype || currentArchetype}_${mobilePartnerArchetype || selectedPartner}`;
            const interaction = data.interactions?.[interactionKey];

            const proList = document.getElementById('mobileProList');
            const contraList = document.getElementById('mobileContraList');

            if (interaction) {
                // Pro list
                if (proList && interaction.pros?.length) {
                    proList.innerHTML = interaction.pros.map(p => `<li>${p}</li>`).join('');
                } else if (proList) {
                    proList.innerHTML = '<li>Keine spezifischen Vorteile bekannt</li>';
                }

                // Contra list
                if (contraList && interaction.contras?.length) {
                    contraList.innerHTML = interaction.contras.map(c => `<li>${c}</li>`).join('');
                } else if (contraList) {
                    contraList.innerHTML = '<li>Keine spezifischen Herausforderungen bekannt</li>';
                }
            } else {
                if (proList) proList.innerHTML = '<li>Keine Daten verfügbar</li>';
                if (contraList) contraList.innerHTML = '<li>Keine Daten verfügbar</li>';
            }
        }

        function updateMobileCategoriesPage() {
            if (!data) return;

            const container = document.getElementById('mobileCategoriesAccordion');
            if (!container) return;

            const person1 = { archetyp: mobileIchArchetype || currentArchetype, ...personDimensions.ich };
            const person2 = { archetyp: mobilePartnerArchetype || selectedPartner, ...personDimensions.partner };

            const pathosCheck = checkPhysicalCompatibility(person1, person2);
            const logosCheck = calculatePhilosophyCompatibility(person1.archetyp, person2.archetyp);
            const result = calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck);

            const categoryNamesMap = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'Nähe-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilität'
            };

            const categoryDescMap = {
                A: 'Übereinstimmung in den grundlegenden Beziehungsvorstellungen und -erwartungen.',
                B: 'Wie gut eure moralischen und ethischen Werte übereinstimmen.',
                C: 'Balance zwischen Bedürfnis nach Nähe und Freiraum.',
                D: 'Respekt für individuelle Unabhängigkeit und Selbstbestimmung.',
                E: 'Fähigkeit zur offenen und ehrlichen Kommunikation.',
                F: 'Kompatibilität im sozialen Umfeld und gesellschaftlicher Akzeptanz.'
            };

            // FEATURE 2: Category explanations
            function getCategoryExplanation(cat, score, ich, partner) {
                const ichName = data?.archetypes?.[ich]?.name || ich;
                const partnerName = data?.archetypes?.[partner]?.name || partner;

                const explanations = {
                    A: () => {
                        if (ich === partner) {
                            return `${ichName} und ${partnerName} teilen dieselbe Beziehungsphilosophie (100% Übereinstimmung). Beide haben identische Grundüberzeugungen über Beziehungsstrukturen, was eine solide Basis bietet.`;
                        }
                        if (score >= 80) {
                            return `${ichName} und ${partnerName} haben sehr ähnliche Beziehungsphilosophien (${score}%). Die Grundüberzeugungen passen gut zusammen und schaffen eine harmonische Basis.`;
                        } else if (score >= 60) {
                            return `${ichName} (sucht ${ichName === 'Single' ? 'Freiheit' : ichName === 'Duo' ? 'Exklusivität' : 'Flexibilität'}) und ${partnerName} (sucht ${partnerName === 'Single' ? 'Freiheit' : partnerName === 'Duo' ? 'Exklusivität' : 'Flexibilität'}) haben unterschiedliche, aber vereinbare Beziehungsphilosophien (${score}%). Mit Kommunikation und Verständnis ist eine Brücke möglich.`;
                        } else {
                            return `${ichName} und ${partnerName} haben fundamentale philosophische Unterschiede (${score}%). Die Beziehungsvorstellungen weichen stark voneinander ab. Intensive Kommunikation und große Kompromisse sind nötig.`;
                        }
                    },
                    B: () => `Diese Kategorie misst, wie gut eure moralischen Werte übereinstimmen. Ein Score von ${score}% zeigt ${score >= 70 ? 'starke' : score >= 50 ? 'moderate' : 'schwache'} Übereinstimmung in ethischen Grundfragen.`,
                    C: () => `Nähe-Distanz bewertet das Gleichgewicht zwischen Zusammensein und Freiraum. Bei ${score}% gibt es ${score >= 70 ? 'eine harmonische Balance' : score >= 50 ? 'moderate Abstimmung nötig' : 'deutliche Unterschiede in den Bedürfnissen'}.`,
                    D: () => `Autonomie misst den Respekt für individuelle Freiheit. ${score}% bedeutet ${score >= 70 ? 'hohe gegenseitige Wertschätzung' : score >= 50 ? 'moderate Übereinstimmung' : 'Spannungen durch unterschiedliche Autonomie-Bedürfnisse'}.`,
                    E: () => `Kommunikation bewertet Offenheit und Ehrlichkeit. Ein Score von ${score}% zeigt ${score >= 70 ? 'exzellente Kommunikationsbasis' : score >= 50 ? 'solide, aber ausbaufähige Kommunikation' : 'Herausforderungen in der Verständigung'}.`,
                    F: () => `Soziale Kompatibilität bewertet gesellschaftliche Akzeptanz und Umfeld-Passung. ${score}% bedeutet ${score >= 70 ? 'sehr gute soziale Harmonie' : score >= 50 ? 'akzeptable soziale Integration' : 'potenzielle soziale Herausforderungen'}.`
                };

                return explanations[cat] ? explanations[cat]() : '';
            }

            let html = '';
            for (const [cat, catData] of Object.entries(result.categories)) {
                const score = catData.score || 0;
                const barClass = score >= 80 ? 'bar-excellent' : score >= 65 ? 'bar-good' : score >= 50 ? 'bar-medium' : 'bar-low';
                const explanation = getCategoryExplanation(cat, score, person1.archetyp, person2.archetyp);

                html += `
                    <div class="category-accordion-item">
                        <div class="category-accordion-header" onclick="toggleMobileCategory(this)">
                            <span class="category-accordion-letter">${cat}</span>
                            <span class="category-accordion-name">${categoryNamesMap[cat] || cat}</span>
                            <span class="category-accordion-score">${score}%</span>
                            <span class="category-accordion-icon">▼</span>
                        </div>
                        <div class="category-accordion-content">
                            <div class="category-accordion-inner">
                                <p class="category-accordion-desc">${categoryDescMap[cat] || ''}</p>
                                <div style="margin-top: 10px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                                    <div class="${barClass}" style="height: 100%; width: ${score}%; border-radius: 4px;"></div>
                                </div>
                                <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; border-left: 3px solid var(--primary);">
                                    <h4 style="font-size: var(--font-sm); color: var(--text-primary); margin-bottom: 8px;">Warum ${score}%?</h4>
                                    <p style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5; margin: 0;">${explanation}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function toggleMobileCategory(header) {
            const item = header.closest('.category-accordion-item');
            if (item) {
                item.classList.toggle('open');
            }
        }

        function checkAndShowMobileLayout() {
            const isMobile = window.innerWidth <= 768;
            const desktopView = document.getElementById('comparisonView');
            const mobileView = document.getElementById('mobileMultipage');

            if (isMobile) {
                if (desktopView) desktopView.style.display = 'none';
                if (mobileView) mobileView.style.display = 'block';
            } else {
                if (desktopView) desktopView.style.display = 'block';
                if (mobileView) mobileView.style.display = 'none';
            }
        }

        function initMobileLayout() {
            initMobileSwipe();
            initMobileDimensionListeners();
            checkAndShowMobileLayout();

            // Listen for window resize
            window.addEventListener('resize', checkAndShowMobileLayout);

            // Initialize browser history for back button support
            initBrowserHistoryNavigation();
        }

        function initBrowserHistoryNavigation() {
            // Set initial state without adding to history
            history.replaceState({ mobilePage: 1 }, '', '#seite1');

            // Handle browser back/forward button
            window.addEventListener('popstate', function(event) {
                // First, close any open modals when going back
                const factorModal = document.getElementById('factorModal');
                const helpModal = document.getElementById('helpModal');
                const commentModal = document.getElementById('commentModal');
                const proContraModal = document.getElementById('proContraModal');

                // Check if we're returning FROM a modal state (current modal should close)
                if (factorModal && factorModal.classList.contains('active')) {
                    closeFactorModal(null, true);
                }
                if (helpModal && helpModal.classList.contains('active')) {
                    closeHelpModal(null, true);
                }
                if (commentModal && commentModal.classList.contains('active')) {
                    closeCommentModal(null, true);
                }
                if (proContraModal && proContraModal.classList.contains('active')) {
                    closeProContraModal(null, true);
                }

                // Navigate to the correct page
                if (event.state && event.state.mobilePage) {
                    // Only change page if we're not on a modal state
                    if (!event.state.modal) {
                        mobileGoToPage(event.state.mobilePage, true);
                    }
                } else {
                    // If no state, go to page 1
                    mobileGoToPage(1, true);
                }
            });

            // Handle initial load with hash (e.g., direct link to #seite2)
            const hash = window.location.hash;
            if (hash && hash.startsWith('#seite')) {
                const pageNum = parseInt(hash.replace('#seite', ''));
                if (pageNum >= 1 && pageNum <= 3) {
                    // Delay to ensure DOM is ready
                    setTimeout(() => {
                        // For page 2 and 3, we need valid selections - go to page 1 first
                        if (pageNum > 1) {
                            mobileGoToPage(1, true);
                        }
                    }, 100);
                }
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            checkAgeVerification();
            initAgeVerification();
            initFeedbackSystem();
            initDimensionListeners();
            initComparisonLayout();
            initMobileLayout();
            initDimensionButtons();
            initGeschlechtHoverEvents();
            // Initialize all summary displays in header
            updateGeschlechtSummary('ich');
            updateGeschlechtSummary('partner');
            updateDominanzSummary('ich');
            updateDominanzSummary('partner');
            updateOrientierungSummary('ich');
            updateOrientierungSummary('partner');
        });

        // ========================================
        // FEATURE 1: Factor Detail Modal
        // ========================================

        const factorExplanations = {
            archetyp: {
                title: 'Archetyp-Übereinstimmung',
                subtitle: '(Beziehungsphilosophie - Verstand&Logos)',
                getExplanation: (ich, partner, score) => {
                    const ichName = data?.archetypes?.[ich]?.name || ich;
                    const partnerName = data?.archetypes?.[partner]?.name || partner;

                    if (ich === partner) {
                        return `${ichName} und ${partnerName} teilen dieselbe Beziehungsphilosophie. Beide haben identische Grundüberzeugungen über Beziehungsstrukturen.`;
                    }

                    if (score >= 80) {
                        return `${ichName} und ${partnerName} haben sehr ähnliche Beziehungsphilosophien. Die Grundüberzeugungen passen gut zusammen und erfordern nur minimale Kompromisse.`;
                    } else if (score >= 60) {
                        return `${ichName} und ${partnerName} haben unterschiedliche, aber kompatible Beziehungsphilosophien. Beide Archetypen können sich mit Kommunikation und Verständnis ergänzen.`;
                    } else {
                        return `${ichName} und ${partnerName} haben fundamentale philosophische Unterschiede. Die Beziehungsvorstellungen weichen stark voneinander ab und erfordern intensive Kommunikation.`;
                    }
                },
                getMeaning: (score, ich, partner) => {
                    const ichName = data?.archetypes?.[ich]?.name || ich;
                    const partnerName = data?.archetypes?.[partner]?.name || partner;
                    const rhetoricNote = { title: '💡 Warum Logos (Verstand)?', desc: 'Archetypen basieren auf rationalen Beziehungsphilosophien und bewussten Überzeugungen – sie sprechen den Verstand an, nicht das Gefühl.' };

                    if (ich === partner) {
                        return [
                            rhetoricNote,
                            { title: `📌 In dieser Kombination teilen beide denselben Archetyp "${ichName}" – maximale philosophische Übereinstimmung.`, desc: '' },
                            { title: 'Gleiche Grundüberzeugungen', desc: 'Beide haben identische Vorstellungen davon, wie eine Beziehung funktionieren sollte.' },
                            { title: 'Intuitive Verständigung', desc: 'Die gemeinsame Basis ermöglicht tiefes gegenseitiges Verstehen ohne lange Erklärungen.' },
                            { title: 'Natürliche Harmonie', desc: 'Keine grundsätzlichen Konflikte durch unterschiedliche Beziehungsphilosophien.' }
                        ];
                    }

                    if (score >= 80) {
                        return [
                            rhetoricNote,
                            { title: `📌 In dieser Kombination von "${ichName}" und "${partnerName}" ergänzen sich die Beziehungsphilosophien sehr gut.`, desc: '' },
                            { title: 'Hohe philosophische Übereinstimmung', desc: 'Beide teilen ähnliche Grundwerte und Beziehungsideale.' },
                            { title: 'Wenige grundsätzliche Konflikte', desc: 'Weltanschauung und Lebensziele sind weitgehend kompatibel.' },
                            { title: 'Ähnliche Erwartungen an die Beziehung', desc: 'Was beide von Partnerschaft erwarten, deckt sich gut.' }
                        ];
                    } else if (score >= 60) {
                        return [
                            rhetoricNote,
                            { title: `📌 In dieser Kombination von "${ichName}" und "${partnerName}" gibt es sowohl Gemeinsamkeiten als auch deutliche Unterschiede.`, desc: '' },
                            { title: 'Mittlere philosophische Übereinstimmung', desc: 'Grundwerte überlappen, aber es gibt Unterschiede.' },
                            { title: 'Kompromisse und Kommunikation nötig', desc: 'Unterschiedliche Prioritäten erfordern regelmäßigen Austausch.' },
                            { title: 'Unterschiedliche, aber vereinbare Bedürfnisse', desc: 'Mit Flexibilität können beide Seiten zufrieden sein.' }
                        ];
                    } else {
                        return [
                            rhetoricNote,
                            { title: `📌 In dieser Kombination von "${ichName}" und "${partnerName}" prallen grundlegend verschiedene Beziehungsphilosophien aufeinander.`, desc: '' },
                            { title: 'Niedrige philosophische Übereinstimmung', desc: 'Grundsätzlich verschiedene Sichtweisen auf Beziehung.' },
                            { title: 'Intensive Kommunikation erforderlich', desc: 'Ohne bewusste Arbeit entstehen leicht Missverständnisse.' },
                            { title: 'Fundamentale Kompromisse notwendig', desc: 'Beide müssen auf wichtige eigene Bedürfnisse verzichten können.' }
                        ];
                    }
                }
            },
            dominanz: {
                title: 'Dominanz-Harmonie',
                subtitle: '(Emotionale Dynamik - Gefühl&Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichDomObj = dims.ich.dominanz;
                    const partnerDomObj = dims.partner.dominanz;

                    // Translate values to German labels for display
                    const domLabels = {
                        'dominant': 'dominant',
                        'submissiv': 'submissiv',
                        'switch': 'Switch',
                        'ausgeglichen': 'ausgeglichen'
                    };

                    // Harmony matrix for finding best combination
                    const harmonyMatrix = {
                        "dominant-submissiv": 100, "submissiv-dominant": 100,
                        "ausgeglichen-ausgeglichen": 95, "switch-switch": 90,
                        "switch-ausgeglichen": 88, "ausgeglichen-switch": 88,
                        "dominant-ausgeglichen": 85, "ausgeglichen-dominant": 85,
                        "submissiv-ausgeglichen": 85, "ausgeglichen-submissiv": 85,
                        "switch-dominant": 80, "dominant-switch": 80,
                        "switch-submissiv": 80, "submissiv-switch": 80,
                        "dominant-dominant": 55, "submissiv-submissiv": 55
                    };

                    // Helper to get all selections with status
                    const getAllSelections = (domObj) => {
                        if (!domObj || typeof domObj !== 'object') return [];
                        const selections = [];
                        for (const [type, status] of Object.entries(domObj)) {
                            if (status) selections.push({ type, status });
                        }
                        return selections;
                    };

                    const ichSelections = getAllSelections(ichDomObj);
                    const partnerSelections = getAllSelections(partnerDomObj);

                    if (ichSelections.length === 0 || partnerSelections.length === 0) {
                        return 'Bitte wähle für beide Personen mindestens eine Dominanz-Tendenz.';
                    }

                    // Find best combination across ALL selections (primary + secondary)
                    let bestCombo = null;
                    let bestScore = 0;
                    for (const ichSel of ichSelections) {
                        for (const partnerSel of partnerSelections) {
                            const key = `${ichSel.type}-${partnerSel.type}`;
                            let baseScore = harmonyMatrix[key] || harmonyMatrix[`${partnerSel.type}-${ichSel.type}`] || 75;
                            // Reduce score if either is "interessiert"
                            const hasInteressiert = ichSel.status === 'interessiert' || partnerSel.status === 'interessiert';
                            const adjustedScore = hasInteressiert ? Math.round(baseScore * 0.7) : baseScore;
                            if (adjustedScore > bestScore) {
                                bestScore = adjustedScore;
                                bestCombo = { ich: ichSel, partner: partnerSel, hasInteressiert, baseScore };
                            }
                        }
                    }

                    if (!bestCombo) {
                        return 'Keine kompatible Dominanz-Kombination gefunden.';
                    }

                    const ichType = bestCombo.ich.type;
                    const partnerType = bestCombo.partner.type;
                    const ichStatusLabel = bestCombo.ich.status === 'gelebt' ? 'Gelebt' : 'Interessiert';
                    const partnerStatusLabel = bestCombo.partner.status === 'gelebt' ? 'Gelebt' : 'Interessiert';

                    // Build explanation based on best combination
                    let explanation = `Beste Kombination: ${domLabels[ichType]} (${ichStatusLabel}) ↔ ${domLabels[partnerType]} (${partnerStatusLabel}). `;

                    if (ichType === partnerType) {
                        if (ichType === 'ausgeglichen' || ichType === 'switch') {
                            explanation += `Beide bevorzugen ${domLabels[ichType]} - flexible Dynamik möglich.`;
                        } else if (ichType === 'dominant') {
                            explanation += `Beide dominant - Machtkampf-Risiko, aber mit Kommunikation machbar.`;
                        } else if (ichType === 'submissiv') {
                            explanation += `Beide submissiv - Führungsvakuum-Risiko, klare Absprachen wichtig.`;
                        }
                    } else if ((ichType === 'dominant' && partnerType === 'submissiv') ||
                               (ichType === 'submissiv' && partnerType === 'dominant')) {
                        explanation += `Perfekte Komplementarität in der emotionalen Dynamik!`;
                    } else {
                        explanation += `Interessante Dynamik mit Flexibilitätspotential.`;
                    }

                    // Add warning if best combo uses "interessiert"
                    if (bestCombo.hasInteressiert) {
                        explanation += ` ⚠️ Exploration-Phase: Reduzierte Konfidenz (${bestCombo.baseScore}% → ${bestScore}%).`;
                    }

                    return explanation;
                },
                getMeaning: (score) => {
                    const rhetoricNote = { title: '💡 Warum Pathos (Gefühl)?', desc: 'Dominanz-Dynamik wirkt auf der emotionalen Ebene – wer führt, wer folgt, entsteht aus Gefühl und Instinkt, nicht aus rationaler Überlegung.' };
                    if (score >= 80) {
                        return [
                            rhetoricNote,
                            { title: 'Harmonische emotionale Dynamik', desc: 'Die Rollen (Führen/Folgen) ergänzen sich natürlich ohne Reibung.' },
                            { title: 'Natürliche Rollenverteilung', desc: 'Entscheidungen und Verantwortung fließen organisch zwischen beiden.' },
                            { title: 'Geringe Reibungspunkte', desc: 'Wenig Konflikte um Kontrolle oder Passivität zu erwarten.' }
                        ];
                    } else if (score >= 60) {
                        return [
                            rhetoricNote,
                            { title: 'Funktionale emotionale Dynamik', desc: 'Die Rollen funktionieren, sind aber nicht perfekt komplementär.' },
                            { title: 'Flexible Anpassung möglich', desc: 'Mit gegenseitigem Verständnis kann Balance gefunden werden.' },
                            { title: 'Gelegentliche Abstimmung nötig', desc: 'Manchmal braucht es Gespräche über Erwartungen und Bedürfnisse.' }
                        ];
                    } else {
                        // Forschungsbasiert: Sadikaj et al. (2017) - Machtkämpfe bei gleicher Polarität
                        return [
                            rhetoricNote,
                            { title: 'Machtkampf- oder Führungsvakuum-Risiko', desc: 'Beide dominant = Konkurrenzkämpfe. Beide submissiv = keiner übernimmt Führung.' },
                            { title: 'Bewusste Kommunikationsregeln wichtig', desc: 'Klare Absprachen nötig, wer wann welche Rolle übernimmt.' },
                            { title: 'Klare Aufgabenteilung empfohlen', desc: 'Definierte Verantwortungsbereiche reduzieren Konflikte.' }
                        ];
                    }
                }
            },
            orientierung: {
                title: 'Orientierungs-Kompatibilität',
                subtitle: '(Körperliche Anziehung - Gefühl&Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichOri = dims.ich.orientierung;
                    const partnerOri = dims.partner.orientierung;

                    // Translate values to German labels for display
                    const oriLabels = {
                        'heterosexuell': 'heterosexuell',
                        'homosexuell': 'homosexuell',
                        'bisexuell': 'bisexuell'
                    };
                    const ichLabel = oriLabels[ichOri] || ichOri || 'nicht gewählt';
                    const partnerLabel = oriLabels[partnerOri] || partnerOri || 'nicht gewählt';

                    if (score === 100) {
                        return `${ichLabel} und ${partnerLabel} - perfekte Kompatibilität! Körperliche Anziehung ist definitiv möglich.`;
                    } else if (score >= 50) {
                        return `${ichLabel} und ${partnerLabel} - Anziehung ist möglich, besonders wenn mindestens eine Person bisexuell orientiert ist.`;
                    } else {
                        return `${ichLabel} und ${partnerLabel} - Keine körperliche Anziehung möglich aufgrund der sexuellen Orientierungen.`;
                    }
                },
                getMeaning: (score) => {
                    const rhetoricNote = { title: '💡 Warum Pathos (Gefühl)?', desc: 'Sexuelle Orientierung bestimmt, wen wir körperlich anziehend finden – ein tiefes, unbewusstes Gefühl, keine rationale Wahl.' };
                    if (score === 100) {
                        return [
                            rhetoricNote,
                            { title: 'Vollständige körperliche Kompatibilität', desc: 'Die sexuellen Orientierungen beider passen ideal zusammen.' },
                            { title: 'Keine Barrieren für Anziehung', desc: 'Beide können sich potenziell zueinander hingezogen fühlen.' },
                            { title: 'Basis für romantische Beziehung vorhanden', desc: 'Körperliche Anziehung kann Grundlage für mehr sein.' }
                        ];
                    } else if (score >= 50) {
                        return [
                            rhetoricNote,
                            { title: 'Mögliche körperliche Kompatibilität', desc: 'Unter bestimmten Umständen ist Anziehung möglich.' },
                            { title: 'Anziehung kann entstehen', desc: 'Nicht automatisch, aber nicht ausgeschlossen.' },
                            { title: 'Hängt von individuellen Präferenzen ab', desc: 'Persönliche Neigungen spielen größere Rolle.' }
                        ];
                    } else {
                        return [
                            rhetoricNote,
                            { title: 'Keine körperliche Kompatibilität', desc: 'Die Orientierungen schließen gegenseitige Anziehung aus.' },
                            { title: 'Romantische Beziehung nicht möglich', desc: 'Keine Basis für eine intime Partnerschaft.' },
                            { title: 'Freundschaft möglich', desc: 'Eine platonische Verbindung bleibt eine Option.' }
                        ];
                    }
                }
            },
            geschlecht: {
                title: 'Geschlechts-Attraktion',
                subtitle: '(Gender-Chemie - Gefühl&Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichG = dims.ich.geschlecht;
                    const partnerG = dims.partner.geschlecht;

                    // Translate values to German labels for display
                    const genderLabels = {
                        'männlich': 'männlich',
                        'weiblich': 'weiblich',
                        'non-binär': 'non-binär'
                    };
                    const ichLabel = genderLabels[ichG] || ichG || 'nicht gewählt';
                    const partnerLabel = genderLabels[partnerG] || partnerG || 'nicht gewählt';

                    if (score === 100) {
                        return `Die Geschlechterkonstellation ${ichLabel} × ${partnerLabel} passt perfekt zu den angegebenen Orientierungen.`;
                    } else if (score >= 50) {
                        return `Die Geschlechterkonstellation ${ichLabel} × ${partnerLabel} ist mit den angegebenen Orientierungen grundsätzlich kompatibel.`;
                    } else {
                        return `Die Geschlechterkonstellation ${ichLabel} × ${partnerLabel} passt nicht zu den angegebenen Orientierungen.`;
                    }
                },
                getMeaning: (score) => {
                    const rhetoricNote = { title: '💡 Warum Pathos (Gefühl)?', desc: 'Gender-Chemie ist die instinktive Reaktion auf das Geschlecht des anderen – ein unbewusstes Gefühl, das körperliche Anziehung auslöst oder blockiert.' };
                    if (score === 100) {
                        return [
                            rhetoricNote,
                            { title: 'Ideale Geschlechterkonstellation', desc: 'Die Geschlechter-Kombination passt perfekt zu beiden Orientierungen.' },
                            { title: 'Maximale Anziehungskraft möglich', desc: 'Gender-Chemie kann voll entfaltet werden.' },
                            { title: 'Keine gender-bezogenen Barrieren', desc: 'Die Geschlechter bilden keine Hürde für Anziehung.' }
                        ];
                    } else if (score >= 50) {
                        return [
                            rhetoricNote,
                            { title: 'Akzeptable Geschlechterkonstellation', desc: 'Nicht optimal, aber funktional für Anziehung.' },
                            { title: 'Anziehung möglich', desc: 'Kann entstehen, ist aber nicht garantiert.' },
                            { title: 'Individuelle Präferenzen entscheidend', desc: 'Persönliche Vorlieben bestimmen den Ausgang.' }
                        ];
                    } else {
                        return [
                            rhetoricNote,
                            { title: 'Inkompatible Geschlechterkonstellation', desc: 'Die Geschlechter-Kombination passt nicht zu den Orientierungen.' },
                            { title: 'Anziehung unwahrscheinlich', desc: 'Körperliche Chemie wird kaum entstehen.' },
                            { title: 'Orientierung passt nicht', desc: 'Die Präferenzen zeigen in andere Richtungen.' }
                        ];
                    }
                }
            }
        };

        function openFactorModal(factorType, source = 'mobile') {
            const factor = factorExplanations[factorType];
            if (!factor) return;

            // Store current factor type and source for navigation
            currentFactorType = factorType;
            currentFactorSource = source;

            const ich = mobileIchArchetype;
            const partner = mobilePartnerArchetype;

            // Use correct dimensions based on source
            const dimensions = source === 'desktop' ? personDimensions : mobilePersonDimensions;

            // Get score from display - support both mobile and desktop
            const prefix = source === 'desktop' ? 'desktopFactor' : 'mobileFactor';
            let score = 0;
            if (factorType === 'archetyp') {
                score = parseInt(document.getElementById(prefix + 'Archetyp').textContent) || 0;
            } else if (factorType === 'dominanz') {
                score = parseInt(document.getElementById(prefix + 'Dominanz').textContent) || 0;
            } else if (factorType === 'orientierung') {
                score = parseInt(document.getElementById(prefix + 'Orientierung').textContent) || 0;
            } else if (factorType === 'geschlecht') {
                score = parseInt(document.getElementById(prefix + 'Geschlecht').textContent) || 0;
            }

            // Update modal content
            document.getElementById('factorModalTitle').textContent = factor.title;
            document.getElementById('factorModalSubtitle').textContent = factor.subtitle;

            // Update archetype navigation display
            updateFactorModalArchetypeDisplay();

            // Show combination code for archetyp and dominanz factors
            const comboCodeEl = document.getElementById('factorModalComboCode');
            if (factorType === 'archetyp' && ich && partner) {
                const comboCode = `${ich}_${partner}`;
                comboCodeEl.textContent = `Code: ${comboCode}`;
                comboCodeEl.style.display = 'inline-block';
            } else if (factorType === 'dominanz') {
                // Get dominanz and orientierung selections for combo code
                const ichDom = dimensions.ich.dominanz;
                const partnerDom = dimensions.partner.dominanz;
                const ichOri = dimensions.ich.orientierung;
                const partnerOri = dimensions.partner.orientierung;
                const domAbbrev = { 'dominant': 'Dom', 'submissiv': 'Sub', 'switch': 'Swi', 'ausgeglichen': 'Aus' };
                const oriAbbrev = { 'heterosexuell': 'Het', 'homosexuell': 'Hom', 'bisexuell': 'Bi' };

                const getSelectedDom = (domObj) => {
                    if (!domObj) return null;
                    for (const [type, status] of Object.entries(domObj)) {
                        if (status) return domAbbrev[type] || type;
                    }
                    return null;
                };

                const getSelectedOri = (oriObj) => {
                    if (!oriObj) return null;
                    for (const [type, status] of Object.entries(oriObj)) {
                        if (status) return oriAbbrev[type] || type;
                    }
                    return null;
                };

                const ichDomCode = getSelectedDom(ichDom);
                const partnerDomCode = getSelectedDom(partnerDom);
                const ichOriCode = getSelectedOri(ichOri);
                const partnerOriCode = getSelectedOri(partnerOri);

                // Build code: Orientierung-Dominanz for each person
                const ichCode = [ichOriCode, ichDomCode].filter(Boolean).join('-');
                const partnerCode = [partnerOriCode, partnerDomCode].filter(Boolean).join('-');

                if (ichCode && partnerCode) {
                    comboCodeEl.textContent = `Code: ${ichCode}_${partnerCode}`;
                    comboCodeEl.style.display = 'inline-block';
                } else if (ichDomCode && partnerDomCode) {
                    // Fallback to just dominanz if orientierung not selected
                    comboCodeEl.textContent = `Code: ${ichDomCode}_${partnerDomCode}`;
                    comboCodeEl.style.display = 'inline-block';
                } else {
                    comboCodeEl.style.display = 'none';
                }
            } else {
                comboCodeEl.style.display = 'none';
            }

            document.getElementById('factorModalScore').textContent = score + '%';
            document.getElementById('factorModalExplanation').textContent = factor.getExplanation(ich, partner, score, dimensions);

            const meaningList = document.getElementById('factorModalMeaning');
            meaningList.innerHTML = '';
            factor.getMeaning(score, ich, partner).forEach(item => {
                const li = document.createElement('li');
                // Support both old (string) and new (object with title+desc) formats
                if (typeof item === 'object' && item.title) {
                    li.innerHTML = `<strong>${item.title}</strong>${item.desc ? ` – ${item.desc}` : ''}`;
                } else {
                    li.textContent = item;
                }
                meaningList.appendChild(li);
            });

            // Show modal
            document.getElementById('factorModal').classList.add('active');
            // Push state for back button to close modal
            history.pushState({ mobilePage: currentMobilePage, modal: 'factor' }, '', `#seite${currentMobilePage}-factor`);
        }

        function closeFactorModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('factorModal').classList.remove('active');
            // Go back in history if not triggered by back button
            if (!skipHistoryBack && history.state && history.state.modal === 'factor') {
                history.back();
            }
        }

        // Pro/Contra Modal Functions
        function openProContraModal() {
            console.log('openProContraModal called');
            const modal = document.getElementById('proContraModal');
            console.log('proContraModal element:', modal);
            if (!modal) {
                console.error('proContraModal not found!');
                return;
            }

            // Update archetype display
            updateProContraModalArchetypeDisplay();

            // Update score and pro/contra lists
            updateProContraModalContent();

            modal.classList.add('active');
            console.log('proContraModal activated, classList:', modal.classList.toString());
            history.pushState({ mobilePage: currentMobilePage, modal: 'procontra' }, '', `#seite${currentMobilePage}-procontra`);
        }

        function closeProContraModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('proContraModal').classList.remove('active');
            if (!skipHistoryBack && history.state && history.state.modal === 'procontra') {
                history.back();
            }
        }

        function updateProContraModalArchetypeDisplay() {
            const ichDisplay = document.getElementById('proContraModalIch');
            const partnerDisplay = document.getElementById('proContraModalPartner');
            if (ichDisplay) ichDisplay.textContent = archetypeDefinitions[currentArchetype]?.name || currentArchetype;
            if (partnerDisplay) partnerDisplay.textContent = archetypeDefinitions[selectedPartner]?.name || selectedPartner;
        }

        function updateProContraModalContent() {
            const scoreDisplay = document.getElementById('proContraModalScore');
            const proList = document.getElementById('proContraModalProList');
            const contraList = document.getElementById('proContraModalContraList');

            if (!scoreDisplay || !proList || !contraList) return;

            // Get current score
            const percentage = document.getElementById('resultPercentage');
            const currentScore = percentage ? percentage.textContent : '0%';
            scoreDisplay.textContent = currentScore;

            // Set color based on score
            const scoreValue = parseInt(currentScore) || 0;
            if (scoreValue >= 80) {
                scoreDisplay.style.color = 'var(--success)';
            } else if (scoreValue >= 65) {
                scoreDisplay.style.color = 'var(--primary)';
            } else if (scoreValue >= 50) {
                scoreDisplay.style.color = 'var(--warning)';
            } else {
                scoreDisplay.style.color = 'var(--danger)';
            }

            // Generate Pro/Contra directly
            const dynamicProContra = generateDynamicProContra(
                currentArchetype,
                selectedPartner,
                personDimensions.ich,
                personDimensions.partner
            );

            if (dynamicProContra.pro && dynamicProContra.pro.length > 0) {
                proList.innerHTML = dynamicProContra.pro.slice(0, 5).map(s => `<li>${s}</li>`).join('');
            } else {
                proList.innerHTML = '<li style="color: var(--text-muted);">Keine Daten verfügbar</li>';
            }

            if (dynamicProContra.contra && dynamicProContra.contra.length > 0) {
                contraList.innerHTML = dynamicProContra.contra.slice(0, 5).map(c => `<li>${c}</li>`).join('');
            } else {
                contraList.innerHTML = '<li style="color: var(--text-muted);">Keine Daten verfügbar</li>';
            }
        }

        function navigateProContraArchetype(person, direction) {
            // Use the same logic as navigateArchetype
            navigateArchetype(person, direction);

            // Update the modal displays
            updateProContraModalArchetypeDisplay();
            updateProContraModalContent();
        }

        // Pathos/Logos Modal Functions
        let currentPathosLogosType = localStorage.getItem('pathosLogosType') || 'pathos'; // Sticky: 'pathos' or 'logos'
        let currentPathosLogosContent = { pathos: '', logos: '' };

        function openPathosLogosModal(type = null) {
            const modal = document.getElementById('pathosLogosModal');
            if (!modal) return;

            // Use sticky type if no type specified
            if (type === null) {
                type = currentPathosLogosType;
            }
            currentPathosLogosType = type;

            // Get current archetypes
            const ichArch = archetypeDefinitions[currentArchetype];
            const partnerArch = archetypeDefinitions[selectedPartner];

            // Update archetype display
            const ichDisplay = document.getElementById('pathosLogosModalIch');
            const partnerDisplay = document.getElementById('pathosLogosModalPartner');
            if (ichDisplay) ichDisplay.textContent = ichArch?.name || currentArchetype;
            if (partnerDisplay) partnerDisplay.textContent = partnerArch?.name || selectedPartner;

            // Generate content
            currentPathosLogosContent.pathos = generateCombinedPathos(ichArch, partnerArch);
            currentPathosLogosContent.logos = generateCombinedLogos(ichArch, partnerArch);

            // Show the selected type
            showPathosLogosContent(type);

            modal.classList.add('active');
            history.pushState({ mobilePage: currentMobilePage, modal: 'pathoslogos' }, '', `#seite${currentMobilePage}-pathoslogos`);
        }

        function closePathosLogosModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('pathosLogosModal').classList.remove('active');
            if (!skipHistoryBack && history.state && history.state.modal === 'pathoslogos') {
                history.back();
            }
        }

        function showPathosLogosContent(type) {
            currentPathosLogosType = type;
            // Save to localStorage for sticky behavior
            localStorage.setItem('pathosLogosType', type);

            const titleEl = document.getElementById('pathosLogosModalTitle');
            const iconEl = document.getElementById('pathosLogosIcon');
            const categoryEl = document.getElementById('pathosLogosCategory');
            const subtitleEl = document.getElementById('pathosLogosSubtitle');
            const contentEl = document.getElementById('pathosLogosModalContent');
            const archetypeContextEl = document.getElementById('pathosLogosArchetypeContext');
            const pathosBtn = document.getElementById('pathosLogosTogglePathos');
            const logosBtn = document.getElementById('pathosLogosToggleLogos');

            // Reset all button styles (for sticky side buttons)
            [pathosBtn, logosBtn].forEach(btn => {
                if (btn) {
                    btn.style.background = 'rgba(30,30,35,0.95)';
                    btn.style.color = 'var(--text-muted)';
                    btn.style.border = '1px solid var(--border)';
                }
            });

            if (type === 'pathos') {
                titleEl.textContent = "Tiage's Synthese";
                iconEl.textContent = '🔥';
                categoryEl.textContent = 'Dynamische Qualität (Pirsig)';
                subtitleEl.textContent = 'Pathos – Emotionale Resonanz';
                archetypeContextEl.style.display = 'flex';
                contentEl.innerHTML = getPathosContent();
                pathosBtn.style.background = 'rgba(231,111,81,0.3)';
                pathosBtn.style.color = 'var(--text-primary)';
                pathosBtn.style.border = '1px solid #E76F51';
            } else if (type === 'logos') {
                titleEl.textContent = "Tiage's Synthese";
                iconEl.textContent = '🧠';
                categoryEl.textContent = 'Statische Qualität (Pirsig)';
                subtitleEl.textContent = 'Logos – Rationale Struktur';
                archetypeContextEl.style.display = 'flex';
                contentEl.innerHTML = getLogosContent();
                logosBtn.style.background = 'rgba(100,149,237,0.3)';
                logosBtn.style.color = 'var(--text-primary)';
                logosBtn.style.border = '1px solid #6495ED';
            }
        }

        function getPathosContent() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 15px; background: linear-gradient(135deg, rgba(231,111,81,0.1), rgba(231,111,81,0.05)); border-radius: 10px; border-left: 3px solid #E76F51; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 18px;">🔥</span>
                            <span style="font-size: 12px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">GEMEINSAMER PATHOS</span>
                        </div>
                        <p style="font-style: italic; font-size: 15px; margin: 0;">${currentPathosLogosContent.pathos}</p>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #E76F51; margin-bottom: 10px; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                        <span>🌊</span> Pirsig: Dynamische Qualität
                    </h4>
                    <p style="margin-bottom: 10px; font-size: 13px;">Pathos entspricht Pirsigs "dynamischer Qualität" – die lebendige Kraft, die Veränderung antreibt und nicht in Worte gefasst werden kann, bevor sie erlebt wird.</p>
                    <p style="font-size: 12px; color: var(--text-muted); font-style: italic;">"Qualität ist das Ereignis, bei dem das Subjekt sich des Objekts bewusst wird."</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #E76F51; margin-bottom: 10px; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                        <span>🔮</span> OSHO: Bewusste Präsenz
                    </h4>
                    <p style="margin-bottom: 10px; font-size: 13px;">OSHO lehrt, dass wahre emotionale Verbindung nur im Moment der totalen Präsenz entsteht. Pathos ist keine Sentimentalität, sondern bewusstes Fühlen.</p>
                    <p style="font-size: 12px; color: var(--text-muted); font-style: italic;">"Liebe ist nicht etwas, das du tust. Liebe ist etwas, das du bist."</p>
                </div>

                <div style="padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                    <h4 style="color: var(--primary); margin-bottom: 8px; font-size: 13px;">⚡ Resonanztheorie</h4>
                    <p style="font-size: 12px; margin: 0;">Pathos erzeugt <strong>emotionale Resonanz</strong> (R) zwischen zwei Menschen. Je höher der gemeinsame Pathos-Score, desto stärker die intuitive Anziehung – unabhängig von rationaler Kompatibilität. Diese Schwingung ist spürbar, bevor sie verstanden wird.</p>
                </div>
            `;
        }

        function getLogosContent() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 15px; background: linear-gradient(135deg, rgba(69,123,157,0.1), rgba(69,123,157,0.05)); border-radius: 10px; border-left: 3px solid #457B9D; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 18px;">🧠</span>
                            <span style="font-size: 12px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">GEMEINSAMER LOGOS</span>
                        </div>
                        <p style="font-style: italic; font-size: 15px; margin: 0;">${currentPathosLogosContent.logos}</p>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #457B9D; margin-bottom: 10px; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                        <span>🏛️</span> Pirsig: Statische Qualität
                    </h4>
                    <p style="margin-bottom: 10px; font-size: 13px;">Logos entspricht Pirsigs "statischer Qualität" – bewährte Muster und Strukturen, die Stabilität und Verständnis ermöglichen. Sie sind die Bausteine des gemeinsamen Fundaments.</p>
                    <p style="font-size: 12px; color: var(--text-muted); font-style: italic;">"Statische Qualität-Muster sind das, was die Welt zusammenhält."</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <h4 style="color: #457B9D; margin-bottom: 10px; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                        <span>🧘</span> OSHO: Bewusste Klarheit
                    </h4>
                    <p style="margin-bottom: 10px; font-size: 13px;">OSHO betont, dass Klarheit des Geistes die Basis für echte Kommunikation ist. Logos ist nicht kalte Rationalität, sondern bewusste Struktur im Dialog.</p>
                    <p style="font-size: 12px; color: var(--text-muted); font-style: italic;">"Verstehen entsteht nicht durch Denken, sondern durch Klarheit."</p>
                </div>

                <div style="padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                    <h4 style="color: var(--primary); margin-bottom: 8px; font-size: 13px;">🔗 Resonanztheorie</h4>
                    <p style="font-size: 12px; margin: 0;">Logos bildet die <strong>strukturelle Resonanz</strong> – das gemeinsame Verständnis von Werten, Grenzen und Lebensmodellen. Ein hoher Logos-Score zeigt, dass beide auf derselben "Frequenz" kommunizieren können, ohne ständige Missverständnisse.</p>
                </div>
            `;
        }

        // Navigate archetypes within Pathos/Logos Modal
        function navigatePathosLogosArchetype(person, direction) {
            const archetypes = archetypeOrder;
            let currentIndex;

            if (person === 'ich') {
                currentIndex = archetypes.indexOf(currentArchetype);
                currentIndex = (currentIndex + direction + archetypes.length) % archetypes.length;
                currentArchetype = archetypes[currentIndex];
                mobileIchArchetype = archetypes[currentIndex];

                // Sync dropdowns
                const ichSelect = document.getElementById('ichSelect');
                const mobileIchSelect = document.getElementById('mobileIchSelect');
                if (ichSelect) ichSelect.value = currentArchetype;
                if (mobileIchSelect) mobileIchSelect.value = currentArchetype;
            } else {
                currentIndex = archetypes.indexOf(selectedPartner);
                currentIndex = (currentIndex + direction + archetypes.length) % archetypes.length;
                selectedPartner = archetypes[currentIndex];
                mobilePartnerArchetype = archetypes[currentIndex];

                // Sync dropdowns
                const partnerSelect = document.getElementById('partnerSelect');
                const mobilePartnerSelect = document.getElementById('mobilePartnerSelect');
                if (partnerSelect) partnerSelect.value = selectedPartner;
                if (mobilePartnerSelect) mobilePartnerSelect.value = selectedPartner;
            }

            // Update the modal display
            const ichArch = archetypeDefinitions[currentArchetype];
            const partnerArch = archetypeDefinitions[selectedPartner];

            const ichDisplay = document.getElementById('pathosLogosModalIch');
            const partnerDisplay = document.getElementById('pathosLogosModalPartner');
            if (ichDisplay) ichDisplay.textContent = ichArch?.name || currentArchetype;
            if (partnerDisplay) partnerDisplay.textContent = partnerArch?.name || selectedPartner;

            // Regenerate content with new archetypes
            currentPathosLogosContent.pathos = generateCombinedPathos(ichArch, partnerArch);
            currentPathosLogosContent.logos = generateCombinedLogos(ichArch, partnerArch);

            // Refresh the displayed content
            showPathosLogosContent(currentPathosLogosType);

            // Save to localStorage and update main view
            saveSelectionToStorage();
            if (typeof updateComparisonView === 'function') updateComparisonView();
            if (typeof updateMobileCardsContent === 'function') updateMobileCardsContent();
        }

        function getTiageTheoryContent() {
            return `
                <div style="space-y: 20px;">
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Die Synthese</h4>
                        <p style="margin-bottom: 10px;">Das Tiage-Beziehungsmodell verbindet zwei philosophische Traditionen zu einem praktischen Analyse-Tool:</p>
                        <ul style="padding-left: 20px; margin-bottom: 15px;">
                            <li style="margin-bottom: 6px;"><strong>Robert M. Pirsig (MOQ):</strong> Metaphysik der Qualität – statische vs. dynamische Qualität als Grundstruktur</li>
                            <li style="margin-bottom: 6px;"><strong>OSHO:</strong> Bewusstsein durch Meditation – Polarität, Balance, Schwingung</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 8px; border-left: 3px solid var(--primary);">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px; font-size: 14px;">Logos vs. Pathos (40:60)</h4>
                        <p style="margin-bottom: 8px;"><strong style="color: var(--text-muted);">Logos (40%):</strong> Die rationale, strukturgebende Dimension. Pirsig nennt dies "statische Qualität" – bewährte Muster, die Stabilität schaffen.</p>
                        <p><strong style="color: var(--text-muted);">Pathos (60%):</strong> Die emotionale, anziehende Dimension. Pirsig nennt dies "dynamische Qualität" – die Kraft, die Veränderung und Wachstum antreibt.</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Tiage's Widerspruch zu Pirsig</h4>
                        <p style="margin-bottom: 10px;">Pirsig argumentierte, dass Definitionen die unmittelbare Qualität des Erlebens zerstören.</p>
                        <p style="margin-bottom: 10px;"><strong>Diese App basiert auf der gegenteiligen Erfahrung:</strong></p>
                        <p style="font-style: italic; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 6px;">"Definition und Erleben sind nicht getrennt. Sie entstehen gleichzeitig – im Dialog, in Resonanz, in extremer Kürze."</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">OSHO & Dialog als Meditation</h4>
                        <p style="margin-bottom: 10px;">OSHOs Philosophie verbindet sich mit Tiages Widerspruch:</p>
                        <ul style="padding-left: 20px;">
                            <li style="margin-bottom: 6px;"><strong>OSHO:</strong> "Worte können lebendig sein, wenn Bewusstheit dahinter steht."</li>
                            <li style="margin-bottom: 6px;"><strong>Tiage:</strong> Im bewussten Dialog <em>ist</em> die Definition das Erleben.</li>
                        </ul>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Die Qualität entsteht nicht trotz der Sprache, sondern durch sie – wenn zwei Menschen auf derselben Wellenlänge schwingen.</p>
                    </div>

                    <div style="text-align: center; padding-top: 10px; border-top: 1px solid var(--border);">
                        <p style="font-size: 12px; color: var(--text-muted);">Tiage's Beitrag: Die Verbindung beider Philosophien zu einem konkreten Beziehungs-Rechner mit eigener Gewichtung (40:60 Logos:Pathos) und 6 Archetypen.</p>
                    </div>
                </div>
            `;
        }

        // Factor Modal Archetype Navigation
        let currentFactorType = null;
        let currentFactorSource = 'mobile';

        function navigateFactorArchetype(person, direction) {
            // Get current archetype for the person
            let currentArch;
            if (person === 'ich') {
                currentArch = mobileIchArchetype;
            } else {
                currentArch = mobilePartnerArchetype;
            }

            // Find current index and calculate new index
            let currentIdx = archetypeOrder.indexOf(currentArch);
            if (currentIdx === -1) currentIdx = 0;

            let newIndex = currentIdx + direction;
            if (newIndex < 0) newIndex = archetypeOrder.length - 1;
            if (newIndex >= archetypeOrder.length) newIndex = 0;

            const newArchetype = archetypeOrder[newIndex];

            // Update the actual selections and sync both mobile and desktop
            if (person === 'ich') {
                mobileIchArchetype = newArchetype;
                currentArchetype = newArchetype; // Sync desktop variable
                // Update mobile and desktop select elements
                const mobileSelect = document.getElementById('mobileIchSelect');
                const desktopSelect = document.getElementById('ichSelect');
                if (mobileSelect) mobileSelect.value = newArchetype;
                if (desktopSelect) desktopSelect.value = newArchetype;
            } else {
                mobilePartnerArchetype = newArchetype;
                selectedPartner = newArchetype; // Sync desktop variable
                // Update mobile and desktop select elements
                const mobileSelect = document.getElementById('mobilePartnerSelect');
                const desktopSelect = document.getElementById('partnerSelect');
                if (mobileSelect) mobileSelect.value = newArchetype;
                if (desktopSelect) desktopSelect.value = newArchetype;
            }

            // Update the display in the modal
            updateFactorModalArchetypeDisplay();

            // Preserve selection state: sync Dominanz and Orientierung UI with stored state
            syncDominanzUI('ich');
            syncDominanzUI('partner');
            syncOrientierungUI('ich');
            syncOrientierungUI('partner');

            // Trigger full recalculation for both mobile and desktop views
            if (typeof updateComparisonView === 'function') {
                updateComparisonView();
            }
            if (typeof updateMobileResultPage === 'function') {
                updateMobileResultPage();
            }
            if (typeof updateMobileProContraPage === 'function') {
                updateMobileProContraPage();
            }

            // Recalculate and update the modal content after views are updated
            if (currentFactorType) {
                // Get updated score from display elements
                const prefix = currentFactorSource === 'desktop' ? 'desktopFactor' : 'mobileFactor';
                let score = 0;
                if (currentFactorType === 'archetyp') {
                    score = parseInt(document.getElementById(prefix + 'Archetyp')?.textContent) || 0;
                } else if (currentFactorType === 'dominanz') {
                    score = parseInt(document.getElementById(prefix + 'Dominanz')?.textContent) || 0;
                } else if (currentFactorType === 'orientierung') {
                    score = parseInt(document.getElementById(prefix + 'Orientierung')?.textContent) || 0;
                } else if (currentFactorType === 'geschlecht') {
                    score = parseInt(document.getElementById(prefix + 'Geschlecht')?.textContent) || 0;
                }

                const factor = factorExplanations[currentFactorType];
                if (factor) {
                    const ich = mobileIchArchetype;
                    const partner = mobilePartnerArchetype;
                    const dimensions = currentFactorSource === 'desktop' ? personDimensions : mobilePersonDimensions;

                    document.getElementById('factorModalScore').textContent = score + '%';
                    document.getElementById('factorModalExplanation').textContent = factor.getExplanation(ich, partner, score, dimensions);

                    const meaningList = document.getElementById('factorModalMeaning');
                    meaningList.innerHTML = '';
                    factor.getMeaning(score, ich, partner).forEach(item => {
                        const li = document.createElement('li');
                        // Support both old (string) and new (object with title+desc) formats
                        if (typeof item === 'object' && item.title) {
                            li.innerHTML = `<strong>${item.title}</strong>${item.desc ? ` – ${item.desc}` : ''}`;
                        } else {
                            li.textContent = item;
                        }
                        meaningList.appendChild(li);
                    });
                }
            }
        }

        function updateFactorModalArchetypeDisplay() {
            const ichCodeEl = document.getElementById('factorModalIchCode');
            const partnerCodeEl = document.getElementById('factorModalPartnerCode');

            if (ichCodeEl) {
                const ichDef = archetypeDefinitions[mobileIchArchetype];
                ichCodeEl.textContent = ichDef ? ichDef.name : mobileIchArchetype;
            }
            if (partnerCodeEl) {
                const partnerDef = archetypeDefinitions[mobilePartnerArchetype];
                partnerCodeEl.textContent = partnerDef ? partnerDef.name : mobilePartnerArchetype;
            }

            // Update combo code if visible
            const comboCodeEl = document.getElementById('factorModalComboCode');
            if (comboCodeEl && comboCodeEl.style.display !== 'none') {
                comboCodeEl.textContent = `Code: ${mobileIchArchetype}_${mobilePartnerArchetype}`;
            }
        }

        // ========================================
        // HELP MODAL FUNCTIONS
        // ========================================

        // Flag to track if help content has been loaded
        let helpContentLoaded = false;

        async function openHelpModal() {
            console.log('openHelpModal called');
            const modal = document.getElementById('helpModal');
            console.log('helpModal element:', modal);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                console.log('helpModal activated');
                // Push state for back button to close modal
                history.pushState({ mobilePage: currentMobilePage, modal: 'help' }, '', `#seite${currentMobilePage}-help`);

                // Load Markdown content dynamically on first open
                if (!helpContentLoaded && typeof MarkdownLoader !== 'undefined') {
                    const contentContainer = modal.querySelector('.help-modal-content');
                    if (contentContainer) {
                        try {
                            // Load help guide from Markdown
                            await MarkdownLoader.loadInto('docs/help-guide.md', contentContainer, true);
                            helpContentLoaded = true;
                            console.log('Help content loaded from Markdown');
                        } catch (error) {
                            console.error('Failed to load help content:', error);
                            // Keep static content as fallback
                        }
                    }
                }
            } else {
                console.error('helpModal element not found!');
            }
        }

        function closeHelpModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('helpModal').classList.remove('active');
            document.body.style.overflow = '';
            // Go back in history if not triggered by back button
            if (!skipHistoryBack && history.state && history.state.modal === 'help') {
                history.back();
            }
        }

        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const factorModal = document.getElementById('factorModal');
                if (factorModal && factorModal.classList.contains('active')) {
                    closeFactorModal();
                    return;
                }
                const helpModal = document.getElementById('helpModal');
                if (helpModal && helpModal.classList.contains('active')) {
                    closeHelpModal();
                    return;
                }
                const commentModal = document.getElementById('commentModal');
                if (commentModal && commentModal.classList.contains('active')) {
                    closeCommentModal();
                    return;
                }
            }
        });

        // ========================================
        // COMMENT MODAL FUNCTIONS
        // ========================================

        function openCommentModal() {
            document.getElementById('commentModal').classList.add('active');
            // Push state for back button to close modal
            history.pushState({ mobilePage: currentMobilePage, modal: 'comment' }, '', `#seite${currentMobilePage}-comment`);
        }

        function closeCommentModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('commentModal').classList.remove('active');
            // Reset form
            document.getElementById('commentName').value = '';
            document.getElementById('commentType').value = 'frage';
            document.getElementById('commentText').value = '';
            // Go back in history if not triggered by back button
            if (!skipHistoryBack && history.state && history.state.modal === 'comment') {
                history.back();
            }
        }

        async function submitComment() {
            const name = document.getElementById('commentName').value.trim();
            const typ = document.getElementById('commentType').value;
            const text = document.getElementById('commentText').value.trim();

            // Validation
            if (!name) {
                alert('Bitte gib deinen Namen/Kürzel ein.');
                return;
            }
            if (!text) {
                alert('Bitte schreibe einen Kommentar.');
                return;
            }

            const commentEntry = {
                type: 'comment',  // Wichtig für das Google Script
                id: 'com_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                kommentarTyp: typ,
                kommentar: text,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent.substring(0, 100),
                page: 'hilfe-modal'
            };

            const submitBtn = document.getElementById('commentSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sende...';

            try {
                if (GOOGLE_SCRIPT_URL) {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(commentEntry)
                    });
                }

                // Also save locally as backup
                const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
                stored.unshift(commentEntry);
                localStorage.setItem('tiage_comments', JSON.stringify(stored));

                alert('Danke für deinen Kommentar!');
                closeCommentModal();

            } catch (error) {
                console.error('Comment error:', error);
                // Save locally on error
                const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
                stored.unshift(commentEntry);
                localStorage.setItem('tiage_comments', JSON.stringify(stored));
                alert('Kommentar lokal gespeichert. (Server nicht erreichbar)');
                closeCommentModal();
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Absenden';
        }

        // ========================================
        // COMMENTS LIST MODAL FUNCTIONS
        // ========================================

        let allCommentsData = [];
        let currentSearchQuery = '';

        function openCommentsListModal() {
            console.log('openCommentsListModal called');
            document.getElementById('commentsListModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset search field
            const searchInput = document.getElementById('commentsSearchInput');
            if (searchInput) searchInput.value = '';
            currentSearchQuery = '';
            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) clearBtn.classList.remove('visible');
            const resultsDiv = document.getElementById('commentsSearchResults');
            if (resultsDiv) resultsDiv.style.display = 'none';

            loadAllComments();
        }

        function closeCommentsListModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('commentsListModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function loadAllComments() {
            const container = document.getElementById('commentsListBody');
            container.innerHTML = '<div class="no-comments"><div class="no-comments-icon">⏳</div><p>Lade Kommentare...</p></div>';

            try {
                // Load from localStorage - nur eine Quelle: tiage_comments
                const localComments = JSON.parse(localStorage.getItem('tiage_comments') || '[]');

                // Deduplizierung basierend auf Name + Titel + Text
                const seen = new Set();
                const getUniqueKey = (item) => {
                    const name = (item.Name || item.name || '').toLowerCase().trim();
                    const titel = (item.Titel || item.titel || '').toLowerCase().trim();
                    const text = (item.Kommentar || item.kommentar || item.text || item.comment || '').toLowerCase().trim();
                    return `${name}|${titel}|${text}`;
                };

                allCommentsData = [];

                // Add local comments
                localComments.forEach(item => {
                    const key = getUniqueKey(item);
                    if (!seen.has(key)) {
                        seen.add(key);
                        allCommentsData.push(item);
                    }
                });

                // Try to load from server if available
                if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                    try {
                        const response = await fetch(GOOGLE_SCRIPT_URL);
                        const serverData = await response.json();
                        // Merge server data (avoiding duplicates)
                        serverData.forEach(item => {
                            const key = getUniqueKey(item);
                            if (!seen.has(key)) {
                                seen.add(key);
                                allCommentsData.push(item);
                            }
                        });
                    } catch (e) {
                        console.log('Server not available, using local data only');
                    }
                }

                // Sort by date (newest first)
                allCommentsData.sort((a, b) => {
                    const dateA = new Date(a.timestamp || a.Timestamp || a.datum || 0);
                    const dateB = new Date(b.timestamp || b.Timestamp || b.datum || 0);
                    return dateB - dateA;
                });

                renderCommentsList();
            } catch (error) {
                console.error('Error loading comments:', error);
                container.innerHTML = '<div class="no-comments"><div class="no-comments-icon">❌</div><p>Fehler beim Laden der Kommentare</p></div>';
            }
        }

        function renderCommentsList() {
            const container = document.getElementById('commentsListBody');

            if (allCommentsData.length === 0) {
                container.innerHTML = `
                    <div class="no-comments">
                        <div class="no-comments-icon">💬</div>
                        <p>Noch keine Kommentare vorhanden.</p>
                        <p style="font-size: 12px; margin-top: 10px;">Sei der Erste, der einen Kommentar hinterlässt!</p>
                    </div>
                `;
                return;
            }

            // Separate main comments from replies
            const mainComments = allCommentsData.filter(c => !(c.AntwortAuf || c.antwortAuf || c.replyTo));
            const replies = allCommentsData.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));

            let html = '';

            mainComments.forEach((comment, index) => {
                const id = comment.id || comment.ID || `comment-${index}`;
                const name = comment.Name || comment.name || 'Anonym';
                const titel = comment.Titel || comment.titel || comment.type || '';
                const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
                const kontext = comment.KontextID || comment.kontextId || comment.context || '';
                const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
                const timestamp = comment.timestamp || comment.Timestamp || comment.datum;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                // Find replies to this comment
                const commentReplies = replies.filter(r =>
                    (r.AntwortAuf || r.antwortAuf || r.replyTo) === id
                );

                html += `
                    <div class="comment-card" data-id="${id}">
                        <div class="comment-card-header">
                            <div>
                                <span class="comment-author">${escapeHtml(name)}</span>
                                <span class="comment-date">${date}</span>
                            </div>
                            <span class="comment-type-badge type-${typ || 'comment'}">${getTypeBadge(typ)}</span>
                        </div>
                        <div class="comment-card-body">
                            ${titel ? `<div class="comment-title">${escapeHtml(titel)}</div>` : ''}
                            <div class="comment-text">${escapeHtml(text)}</div>
                            ${kontext ? `<div class="comment-context">📍 Kontext: ${escapeHtml(kontext)}</div>` : ''}
                        </div>
                        ${commentReplies.length > 0 ? renderReplies(commentReplies) : ''}
                        <div class="comment-card-footer">
                            <span style="font-size: 11px; color: var(--text-muted);">${commentReplies.length} Antwort${commentReplies.length !== 1 ? 'en' : ''}</span>
                            <button class="reply-btn" onclick="toggleReplyForm('${id}')">↩ Antworten</button>
                        </div>
                        <div class="reply-form" id="reply-form-${id}">
                            <input type="text" id="reply-name-${id}" placeholder="Dein Name" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                            <textarea id="reply-text-${id}" placeholder="Deine Antwort..."></textarea>
                            <div class="reply-form-buttons">
                                <button class="reply-cancel-btn" onclick="toggleReplyForm('${id}')">Abbrechen</button>
                                <button class="reply-submit-btn" onclick="submitReply('${id}')">Antworten</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderReplies(replies) {
            let html = '<div class="replies-section">';
            replies.forEach(reply => {
                const name = reply.Name || reply.name || 'Anonym';
                const text = reply.Kommentar || reply.kommentar || reply.text || '';
                const timestamp = reply.timestamp || reply.Timestamp;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                html += `
                    <div class="reply-card">
                        <div class="reply-header">
                            <span class="reply-author">${escapeHtml(name)}</span>
                            <span class="reply-date">${date}</span>
                        </div>
                        <div class="reply-text">${escapeHtml(text)}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        // Convert wildcard pattern to regex
        function wildcardToRegex(pattern) {
            // Escape special regex characters except *
            const escaped = pattern.replace(/[.+?^${}()|[\]\\]/g, '\\$&');
            // Convert * to .* for wildcard matching
            const regex = escaped.replace(/\*/g, '.*');
            return new RegExp(regex, 'i'); // Case insensitive
        }

        // Check if a comment matches the search query
        function commentMatchesSearch(comment, query) {
            if (!query || query.trim() === '') return true;

            const searchPattern = wildcardToRegex(query.trim());

            // Get all searchable fields
            const name = comment.Name || comment.name || '';
            const titel = comment.Titel || comment.titel || comment.type || '';
            const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
            const kontext = comment.KontextID || comment.kontextId || comment.context || '';
            const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
            const typLabel = getTypeBadge(typ);

            // Check if any field matches
            return searchPattern.test(name) ||
                   searchPattern.test(titel) ||
                   searchPattern.test(text) ||
                   searchPattern.test(kontext) ||
                   searchPattern.test(typ) ||
                   searchPattern.test(typLabel);
        }

        // Filter and render comments based on search query
        function filterComments(query) {
            currentSearchQuery = query;

            // Update clear button visibility
            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) {
                clearBtn.classList.toggle('visible', query.length > 0);
            }

            renderFilteredComments();
        }

        // Clear search and show all comments
        function clearCommentsSearch() {
            const input = document.getElementById('commentsSearchInput');
            if (input) {
                input.value = '';
            }
            currentSearchQuery = '';

            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) {
                clearBtn.classList.remove('visible');
            }

            const resultsDiv = document.getElementById('commentsSearchResults');
            if (resultsDiv) {
                resultsDiv.style.display = 'none';
            }

            renderCommentsList();
        }

        // Render comments with current filter applied
        function renderFilteredComments() {
            const container = document.getElementById('commentsListBody');
            const resultsDiv = document.getElementById('commentsSearchResults');

            if (!currentSearchQuery || currentSearchQuery.trim() === '') {
                if (resultsDiv) resultsDiv.style.display = 'none';
                renderCommentsList();
                return;
            }

            // Filter comments
            const filteredComments = allCommentsData.filter(c => commentMatchesSearch(c, currentSearchQuery));

            // Show results count
            if (resultsDiv) {
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = `${filteredComments.length} von ${allCommentsData.length} Kommentare${filteredComments.length !== 1 ? 'n' : ''} gefunden`;
            }

            if (filteredComments.length === 0) {
                container.innerHTML = `
                    <div class="no-comments">
                        <div class="no-comments-icon">🔍</div>
                        <p>Keine Kommentare gefunden.</p>
                        <p style="font-size: 12px; margin-top: 10px;">Versuche einen anderen Suchbegriff oder verwende * als Platzhalter.</p>
                    </div>
                `;
                return;
            }

            // Separate main comments from replies
            const mainComments = filteredComments.filter(c => !(c.AntwortAuf || c.antwortAuf || c.replyTo));
            const allReplies = allCommentsData.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));
            const filteredReplies = filteredComments.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));

            let html = '';

            // Render matching main comments
            mainComments.forEach((comment, index) => {
                const id = comment.id || comment.ID || `comment-${index}`;
                const name = comment.Name || comment.name || 'Anonym';
                const titel = comment.Titel || comment.titel || comment.type || '';
                const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
                const kontext = comment.KontextID || comment.kontextId || comment.context || '';
                const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
                const timestamp = comment.timestamp || comment.Timestamp || comment.datum;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                // Find all replies to this comment (not filtered)
                const commentReplies = allReplies.filter(r =>
                    (r.AntwortAuf || r.antwortAuf || r.replyTo) === id
                );

                html += `
                    <div class="comment-card" data-id="${id}">
                        <div class="comment-card-header">
                            <div>
                                <span class="comment-author">${highlightMatch(escapeHtml(name), currentSearchQuery)}</span>
                                <span class="comment-date">${date}</span>
                            </div>
                            <span class="comment-type-badge type-${typ || 'comment'}">${getTypeBadge(typ)}</span>
                        </div>
                        <div class="comment-card-body">
                            ${titel ? `<div class="comment-title">${highlightMatch(escapeHtml(titel), currentSearchQuery)}</div>` : ''}
                            <div class="comment-text">${highlightMatch(escapeHtml(text), currentSearchQuery)}</div>
                            ${kontext ? `<div class="comment-context">📍 Kontext: ${highlightMatch(escapeHtml(kontext), currentSearchQuery)}</div>` : ''}
                        </div>
                        ${commentReplies.length > 0 ? renderRepliesWithHighlight(commentReplies, currentSearchQuery) : ''}
                        <div class="comment-card-footer">
                            <span style="font-size: 11px; color: var(--text-muted);">${commentReplies.length} Antwort${commentReplies.length !== 1 ? 'en' : ''}</span>
                            <button class="reply-btn" onclick="toggleReplyForm('${id}')">↩ Antworten</button>
                        </div>
                        <div class="reply-form" id="reply-form-${id}">
                            <input type="text" id="reply-name-${id}" placeholder="Dein Name" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                            <textarea id="reply-text-${id}" placeholder="Deine Antwort..."></textarea>
                            <div class="reply-form-buttons">
                                <button class="reply-cancel-btn" onclick="toggleReplyForm('${id}')">Abbrechen</button>
                                <button class="reply-submit-btn" onclick="submitReply('${id}')">Antworten</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Also show replies that match but their parent doesn't
            const orphanReplies = filteredReplies.filter(reply => {
                const parentId = reply.AntwortAuf || reply.antwortAuf || reply.replyTo;
                return !mainComments.some(c => (c.id || c.ID) === parentId);
            });

            if (orphanReplies.length > 0) {
                html += `<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border);">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">Passende Antworten:</div>
                `;
                orphanReplies.forEach(reply => {
                    const name = reply.Name || reply.name || 'Anonym';
                    const text = reply.Kommentar || reply.kommentar || reply.text || '';
                    const timestamp = reply.timestamp || reply.Timestamp;
                    const date = timestamp ? formatCommentDate(timestamp) : '';

                    html += `
                        <div class="reply-card" style="margin-left: 0; background: var(--bg-secondary); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <div class="reply-header">
                                <span class="reply-author">${highlightMatch(escapeHtml(name), currentSearchQuery)}</span>
                                <span class="reply-date">${date}</span>
                            </div>
                            <div class="reply-text">${highlightMatch(escapeHtml(text), currentSearchQuery)}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            container.innerHTML = html;
        }

        // Highlight matching text in search results
        function highlightMatch(text, query) {
            if (!query || query.trim() === '') return text;

            try {
                const pattern = wildcardToRegex(query.trim());
                return text.replace(pattern, match => `<span class="search-highlight">${match}</span>`);
            } catch (e) {
                return text;
            }
        }

        // Render replies with search highlighting
        function renderRepliesWithHighlight(replies, query) {
            let html = '<div class="replies-section">';
            replies.forEach(reply => {
                const name = reply.Name || reply.name || 'Anonym';
                const text = reply.Kommentar || reply.kommentar || reply.text || '';
                const timestamp = reply.timestamp || reply.Timestamp;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                html += `
                    <div class="reply-card">
                        <div class="reply-header">
                            <span class="reply-author">${highlightMatch(escapeHtml(name), query)}</span>
                            <span class="reply-date">${date}</span>
                        </div>
                        <div class="reply-text">${highlightMatch(escapeHtml(text), query)}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function toggleReplyForm(commentId) {
            const form = document.getElementById(`reply-form-${commentId}`);
            if (form) {
                form.classList.toggle('active');
            }
        }

        async function submitReply(parentId) {
            const nameInput = document.getElementById(`reply-name-${parentId}`);
            const textInput = document.getElementById(`reply-text-${parentId}`);

            const name = nameInput?.value.trim() || 'Anonym';
            const text = textInput?.value.trim();

            if (!text) {
                alert('Bitte gib eine Antwort ein.');
                return;
            }

            const reply = {
                id: 'reply_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                Name: name,
                Kommentar: text,
                AntwortAuf: parentId,
                timestamp: new Date().toISOString(),
                Typ: 'antwort'
            };

            // Save locally
            const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
            stored.push(reply);
            localStorage.setItem('tiage_comments', JSON.stringify(stored));

            // Try to save to server
            if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(reply)
                    });
                } catch (e) {
                    console.log('Server save failed, reply saved locally');
                }
            }

            // Clear form and reload
            if (nameInput) nameInput.value = '';
            if (textInput) textInput.value = '';
            toggleReplyForm(parentId);

            // Reload comments
            loadAllComments();
        }

        function formatCommentDate(timestamp) {
            try {
                const date = new Date(timestamp);
                return date.toLocaleDateString('de-DE', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return '';
            }
        }

        function getTypeBadge(typ) {
            const types = {
                'frage': 'Frage',
                'feedback': 'Comment',  // Feedback = Comment (vereinheitlicht)
                'fehler': 'Fehler',
                'verbesserung': 'Vorschlag',
                'doku': 'Doku',
                'antwort': 'Antwort',
                'comment': 'Comment'
            };
            return types[typ] || 'Comment';  // Default ist jetzt "Comment"
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ========================================
        // FEATURE 4: Archetype Info Modal
        // ========================================

        // archetypeOrder is already declared earlier in the code
        let currentArchetypeIndex = 0;
        let currentInfoModalPerson = null; // Track which person ('ich' or 'partner') the modal is for

        const archetypeInfoData = {
            single: {
                title: 'Single',
                definition: 'Menschen, die bewusst keine feste Beziehung führen möchten. Sie priorisieren persönliche Freiheit, Unabhängigkeit und Selbstbestimmung.',
                features: [
                    'Vollständige emotionale und sexuelle Autonomie',
                    'Keine Verpflichtungen gegenüber einem Partner',
                    'Fokus auf Selbstentwicklung und persönliche Ziele',
                    'Wechselnde Kontakte oder zeitweise bewusste Abstinenz'
                ],
                match: 'Wenn du maximale Freiheit schätzt, keine Rechenschaft ablegen möchtest und Beziehungsstrukturen als einengend empfindest. Ideal für Menschen, die ihre Unabhängigkeit über alles stellen.'
            },
            duo: {
                title: 'Duo',
                definition: 'Traditionelle monogame Zweierbeziehung mit klaren Exklusivitätserwartungen. Beide Partner investieren emotional und körperlich ausschließlich ineinander.',
                features: [
                    'Emotionale und sexuelle Exklusivität',
                    'Langfristige Verbindlichkeit als Ziel',
                    'Gemeinsame Lebensplanung und Zukunftsvisionen',
                    'Tiefer emotionaler Fokus auf eine Person'
                ],
                match: 'Wenn du eine tiefe, exklusive Bindung suchst und dich am wohlsten fühlst, wenn du deine ganze emotionale Energie einer Person widmen kannst. Ideal für Menschen, die Sicherheit und Beständigkeit schätzen.'
            },
            duo_flex: {
                title: 'Duo-Flex',
                definition: 'Primärbeziehung mit Öffnungsbereitschaft. Ein Hauptpartner steht im Zentrum, aber mit Transparenz und gemeinsamen Regeln sind weitere Kontakte möglich.',
                features: [
                    'Klar definierte Primärbeziehung als Anker',
                    'Öffnung für weitere Kontakte (emotional oder körperlich)',
                    'Transparenz und offene Kommunikation essentiell',
                    'Regeln werden gemeinsam definiert'
                ],
                match: 'Wenn du eine sichere Hauptbeziehung möchtest, aber auch Freiheit für weitere Erfahrungen brauchst. Ideal für Menschen, die Struktur und Flexibilität kombinieren möchten.'
            },
            solopoly: {
                title: 'Solopoly',
                definition: 'Polyamore Orientierung ohne Hierarchien. Keine Primärbeziehung - alle Verbindungen sind gleichwertig und unabhängig voneinander.',
                features: [
                    'Keine Priorisierung einzelner Beziehungen',
                    'Maximale Autonomie in allen Verbindungen',
                    'Jede Beziehung entwickelt sich individuell',
                    'Keine gemeinsame Lebensplanung notwendig'
                ],
                match: 'Wenn du mehrere tiefe Verbindungen leben möchtest, ohne eine über die andere zu stellen. Ideal für Menschen, die Hierarchien ablehnen und absolute Beziehungsfreiheit suchen.'
            },
            ra: {
                title: 'RA (Relationship Anarchist)',
                definition: 'Vollständige Ablehnung von Beziehungshierarchien und gesellschaftlichen Normen. Jede Verbindung wird individuell definiert, ohne externe Vorlagen oder Erwartungen.',
                features: [
                    'Keine Hierarchien zwischen Beziehungstypen',
                    'Jede Beziehung wird individuell ausgehandelt',
                    'Freundschaften können genauso wichtig sein wie romantische Beziehungen',
                    'Keine Besitzansprüche an andere Menschen'
                ],
                match: 'Wenn du alle gesellschaftlichen Beziehungsnormen hinterfragst und jede Verbindung nach eigenen Regeln gestalten möchtest. Ideal für Menschen mit starkem Autonomiebedürfnis.'
            },
            lat: {
                title: 'LAT (Living Apart Together)',
                definition: 'Feste Partnerschaft mit bewusst getrennten Wohnungen und Alltagsleben. Die eigenen vier Wände sind kein Zeichen von Distanz, sondern von gesunder Selbstfürsorge.',
                features: [
                    'Tiefe, verbindliche Beziehung ohne Zusammenleben',
                    'Eigener Rückzugsraum ist essentiell',
                    'Qualitätszeit über Quantität',
                    'Bewusste Entscheidung für Nähe'
                ],
                match: 'Wenn du eine feste Beziehung möchtest, aber deinen eigenen Raum brauchst. Ideal für Menschen, die Nähe und Autonomie im Alltag kombinieren wollen.'
            },
            aromantisch: {
                title: 'Aromantisch',
                definition: 'Wenig oder keine romantische Anziehung, aber tiefe Verbindungen auf anderen Ebenen. Freundschaften, queerplatonische Beziehungen und andere Formen von Nähe sind möglich und wertvoll.',
                features: [
                    'Romantische Liebe ist nicht die einzige Tiefe',
                    'Freundschaften können primäre Beziehungen sein',
                    'Ehrlichkeit über eigene Grenzen',
                    'Alternative Beziehungsformen werden wertgeschätzt'
                ],
                match: 'Wenn du wenig oder keine romantische Anziehung erlebst, aber tiefe Verbindungen auf anderen Ebenen suchst. Ideal für Menschen, die nicht-romantische Beziehungen priorisieren.'
            },
            polyamor: {
                title: 'Polyamor',
                definition: 'Liebesbeziehungen zu mehreren Menschen gleichzeitig, mit Wissen und Einverständnis aller Beteiligten. Emotionale und körperliche Mehrfachbeziehungen werden aktiv gelebt.',
                features: [
                    'Mehrere emotionale und körperliche Beziehungen parallel',
                    'Ehrlichkeit und Transparenz mit allen Beteiligten',
                    'Eifersucht wird aktiv bearbeitet',
                    'Kann Hierarchien haben oder gleichwertig sein'
                ],
                match: 'Wenn du die Fähigkeit hast, mehrere Menschen gleichzeitig zu lieben und diese Gefühle auch real ausleben möchtest. Ideal für Menschen mit hoher Kommunikationsbereitschaft und emotionaler Kapazität.'
            }
        };

        function openArchetypeInfo(archetypeId, person = null) {
            // Redirect to definitionModal (zusammengeführt)
            console.log('openArchetypeInfo called with:', archetypeId, 'person:', person);

            // Track which person this modal is for
            currentDefinitionPerson = person;

            // Update current index
            currentDefinitionIndex = archetypeOrder.indexOf(archetypeId);
            if (currentDefinitionIndex === -1) currentDefinitionIndex = 0;

            // Use the detailed definition modal
            showArchetypeInfoByType(archetypeId);

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Add touch swipe support
            const modal = document.querySelector('#definitionModal .modal');
            modal.ontouchstart = handleDefinitionTouchStart;
            modal.ontouchend = handleDefinitionTouchEnd;
        }

        function updateArchetypeContent(archetypeId) {
            const def = archetypeInfoData[archetypeId];
            if (!def) return;

            document.getElementById('archetypeInfoTitle').textContent = def.title + ' - Definition';
            document.getElementById('archetypeInfoDefinition').textContent = def.definition;

            const featuresList = document.getElementById('archetypeInfoFeatures');
            featuresList.innerHTML = '';
            def.features.forEach(feature => {
                const li = document.createElement('li');
                li.textContent = feature;
                featuresList.appendChild(li);
            });

            document.getElementById('archetypeInfoMatch').textContent = def.match;
        }

        function updateArchetypeDots() {
            const dotsContainer = document.getElementById('archetypeDots');
            dotsContainer.innerHTML = '';
            archetypeOrder.forEach((id, index) => {
                const dot = document.createElement('span');
                dot.className = 'archetype-dot' + (index === currentArchetypeIndex ? ' active' : '');
                dot.onclick = () => {
                    currentArchetypeIndex = index;
                    const newArchetype = archetypeOrder[index];
                    updateArchetypeContent(newArchetype);
                    updateArchetypeDots();

                    // Sync the new archetype to the dropdown selection
                    if (currentInfoModalPerson) {
                        if (currentInfoModalPerson === 'ich') {
                            document.getElementById('ichSelect').value = newArchetype;
                            document.getElementById('mobileIchSelect').value = newArchetype;
                            currentArchetype = newArchetype;
                            mobileIchArchetype = newArchetype;
                        } else if (currentInfoModalPerson === 'partner') {
                            document.getElementById('partnerSelect').value = newArchetype;
                            document.getElementById('mobilePartnerSelect').value = newArchetype;
                            selectedPartner = newArchetype;
                            mobilePartnerArchetype = newArchetype;
                        }
                        updateComparisonView();
                    }
                };
                dotsContainer.appendChild(dot);
            });
        }

        function navigateArchetypeModal(direction) {
            currentArchetypeIndex += direction;
            if (currentArchetypeIndex < 0) currentArchetypeIndex = archetypeOrder.length - 1;
            if (currentArchetypeIndex >= archetypeOrder.length) currentArchetypeIndex = 0;

            const newArchetype = archetypeOrder[currentArchetypeIndex];
            updateArchetypeContent(newArchetype);
            updateArchetypeDots();

            // Sync the new archetype to the dropdown selection
            if (currentInfoModalPerson) {
                if (currentInfoModalPerson === 'ich') {
                    document.getElementById('ichSelect').value = newArchetype;
                    document.getElementById('mobileIchSelect').value = newArchetype;
                    currentArchetype = newArchetype;
                    mobileIchArchetype = newArchetype;
                } else if (currentInfoModalPerson === 'partner') {
                    document.getElementById('partnerSelect').value = newArchetype;
                    document.getElementById('mobilePartnerSelect').value = newArchetype;
                    selectedPartner = newArchetype;
                    mobilePartnerArchetype = newArchetype;
                }
                updateComparisonView();
            }
        }

        let archetypeTouchStartX = 0;
        function handleArchetypeTouchStart(e) {
            archetypeTouchStartX = e.touches[0].clientX;
        }

        function handleArchetypeTouchEnd(e) {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = archetypeTouchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                navigateArchetypeModal(diff > 0 ? 1 : -1);
            }
        }

        function closeArchetypeInfoModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('archetypeInfoModal').classList.remove('active');
        }

        // ========================================
        // FEATURE 5: LocalStorage Persistence
        // ========================================

        function saveSelectionToStorage() {
            const selection = {
                ich: {
                    archetyp: mobileIchArchetype,
                    geschlecht: personDimensions.ich.geschlecht,
                    dominanz: personDimensions.ich.dominanz, // Multi-select object
                    orientierung: personDimensions.ich.orientierung // Multi-select object
                },
                partner: {
                    archetyp: mobilePartnerArchetype,
                    geschlecht: personDimensions.partner.geschlecht,
                    dominanz: personDimensions.partner.dominanz, // Multi-select object
                    orientierung: personDimensions.partner.orientierung // Multi-select object
                }
            };

            try {
                localStorage.setItem('tiage-selection', JSON.stringify(selection));
            } catch (e) {
                console.warn('LocalStorage not available:', e);
            }
        }

        function loadSelectionFromStorage() {
            try {
                const saved = localStorage.getItem('tiage-selection');
                if (!saved) return false;

                const selection = JSON.parse(saved);

                // Restore ICH
                if (selection.ich) {
                    mobileIchArchetype = selection.ich.archetyp;
                    currentArchetype = selection.ich.archetyp;
                    document.getElementById('mobileIchSelect').value = selection.ich.archetyp;
                    const ichSelect = document.getElementById('ichSelect');
                    if (ichSelect) ichSelect.value = selection.ich.archetyp;

                    if (selection.ich.geschlecht) {
                        // Handle new primary/secondary format
                        if (typeof selection.ich.geschlecht === 'object' && 'primary' in selection.ich.geschlecht) {
                            // New format: { primary: 'cis-mann', secondary: null }
                            personDimensions.ich.geschlecht = selection.ich.geschlecht;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.geschlecht = selection.ich.geschlecht;
                            }
                        } else {
                            // Old format: string like "cis-mann" - convert to new format
                            personDimensions.ich.geschlecht = { primary: selection.ich.geschlecht, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.geschlecht = { primary: selection.ich.geschlecht, secondary: null };
                            }
                        }
                        // Sync UI
                        if (typeof syncGeschlechtUI === 'function') {
                            syncGeschlechtUI('ich');
                        }
                        if (personDimensions.ich.geschlecht.primary) {
                            const dimension = document.querySelector('[data-dimension="ich-geschlecht-new"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.ich.dominanz) {
                        // Handle new primary/secondary format
                        if (typeof selection.ich.dominanz === 'object' && 'primary' in selection.ich.dominanz) {
                            // New format: { primary: 'dominant', secondary: null }
                            personDimensions.ich.dominanz = selection.ich.dominanz;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.dominanz = selection.ich.dominanz;
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('ich');
                            }
                            if (selection.ich.dominanz.primary) {
                                const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.ich.dominanz === 'object') {
                            // Old format: { dominant: 'gelebt', submissiv: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.ich.dominanz)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.ich.dominanz = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.dominanz = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('ich');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.ich.dominanz = { primary: selection.ich.dominanz, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.dominanz = { primary: selection.ich.dominanz, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('ich');
                            }
                            const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.ich.orientierung) {
                        // Handle new primary/secondary format
                        if (typeof selection.ich.orientierung === 'object' && 'primary' in selection.ich.orientierung) {
                            // New format: { primary: 'heterosexuell', secondary: null }
                            personDimensions.ich.orientierung = selection.ich.orientierung;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.orientierung = selection.ich.orientierung;
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('ich');
                            }
                            if (selection.ich.orientierung.primary) {
                                const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.ich.orientierung === 'object') {
                            // Old format: { heterosexuell: 'gelebt', homosexuell: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.ich.orientierung)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.ich.orientierung = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.orientierung = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('ich');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.ich.orientierung = { primary: selection.ich.orientierung, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.orientierung = { primary: selection.ich.orientierung, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('ich');
                            }
                            const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }
                }

                // Restore PARTNER
                if (selection.partner) {
                    mobilePartnerArchetype = selection.partner.archetyp;
                    selectedPartner = selection.partner.archetyp;
                    document.getElementById('mobilePartnerSelect').value = selection.partner.archetyp;
                    const partnerSelect = document.getElementById('partnerSelect');
                    if (partnerSelect) partnerSelect.value = selection.partner.archetyp;

                    if (selection.partner.geschlecht) {
                        // Handle new primary/secondary format
                        if (typeof selection.partner.geschlecht === 'object' && 'primary' in selection.partner.geschlecht) {
                            // New format: { primary: 'cis-mann', secondary: null }
                            personDimensions.partner.geschlecht = selection.partner.geschlecht;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.geschlecht = selection.partner.geschlecht;
                            }
                        } else {
                            // Old format: string like "cis-mann" - convert to new format
                            personDimensions.partner.geschlecht = { primary: selection.partner.geschlecht, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.geschlecht = { primary: selection.partner.geschlecht, secondary: null };
                            }
                        }
                        // Sync UI
                        if (typeof syncGeschlechtUI === 'function') {
                            syncGeschlechtUI('partner');
                        }
                        if (personDimensions.partner.geschlecht.primary) {
                            const dimension = document.querySelector('[data-dimension="partner-geschlecht-new"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.partner.dominanz) {
                        // Handle new primary/secondary format
                        if (typeof selection.partner.dominanz === 'object' && 'primary' in selection.partner.dominanz) {
                            // New format: { primary: 'dominant', secondary: null }
                            personDimensions.partner.dominanz = selection.partner.dominanz;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.dominanz = selection.partner.dominanz;
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('partner');
                            }
                            if (selection.partner.dominanz.primary) {
                                const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.partner.dominanz === 'object') {
                            // Old format: { dominant: 'gelebt', submissiv: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.partner.dominanz)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.partner.dominanz = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.dominanz = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('partner');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.partner.dominanz = { primary: selection.partner.dominanz, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.dominanz = { primary: selection.partner.dominanz, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('partner');
                            }
                            const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.partner.orientierung) {
                        // Handle new primary/secondary format
                        if (typeof selection.partner.orientierung === 'object' && 'primary' in selection.partner.orientierung) {
                            // New format: { primary: 'heterosexuell', secondary: null }
                            personDimensions.partner.orientierung = selection.partner.orientierung;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.orientierung = selection.partner.orientierung;
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('partner');
                            }
                            if (selection.partner.orientierung.primary) {
                                const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.partner.orientierung === 'object') {
                            // Old format: { heterosexuell: 'gelebt', homosexuell: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.partner.orientierung)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.partner.orientierung = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.orientierung = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('partner');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.partner.orientierung = { primary: selection.partner.orientierung, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.orientierung = { primary: selection.partner.orientierung, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('partner');
                            }
                            const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }
                }

                // Sync mobilePersonDimensions to personDimensions for desktop view
                personDimensions.ich = { ...mobilePersonDimensions.ich };
                personDimensions.partner = { ...mobilePersonDimensions.partner };

                // Sync all UIs (Desktop, Mobile, Modal) for dominanz
                if (typeof syncDominanzUI === 'function') {
                    syncDominanzUI('ich');
                    syncDominanzUI('partner');
                }

                // Sync all UIs (Desktop, Mobile, Modal) for orientierung
                if (typeof syncOrientierungUI === 'function') {
                    syncOrientierungUI('ich');
                    syncOrientierungUI('partner');
                }

                // Update comparison view with loaded data
                if (typeof updateComparisonView === 'function') {
                    updateComparisonView();
                }

                return true;
            } catch (e) {
                console.warn('Failed to load from LocalStorage:', e);
                return false;
            }
        }

        function resetAll() {
            if (!confirm('Möchtest du wirklich alle Eingaben zurücksetzen?')) {
                return;
            }

            // Clear LocalStorage
            try {
                localStorage.removeItem('tiage-selection');
            } catch (e) {
                console.warn('LocalStorage not available:', e);
            }

            // Reset mobile selections
            mobileIchArchetype = 'single';
            mobilePartnerArchetype = 'duo';
            const emptyDominanz = { dominant: null, submissiv: null, switch: null, ausgeglichen: null };
            const emptyOrientierung = { heterosexuell: null, homosexuell: null, bisexuell: null };
            mobilePersonDimensions = {
                ich: { geschlecht: { primary: null, secondary: null }, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } },
                partner: { geschlecht: { primary: null, secondary: null }, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } }
            };

            // Reset personDimensions for desktop
            personDimensions.ich = { geschlecht: { primary: null, secondary: null }, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } };
            personDimensions.partner = { geschlecht: { primary: null, secondary: null }, dominanz: { ...emptyDominanz }, orientierung: { ...emptyOrientierung } };

            // Reset dropdowns
            document.getElementById('mobileIchSelect').value = 'single';
            document.getElementById('mobilePartnerSelect').value = 'duo';

            // Reset all radio buttons
            document.querySelectorAll('.mobile-page input[type="radio"]').forEach(radio => {
                radio.checked = false;
                const dimension = radio.closest('.compact-dimension');
                if (dimension) {
                    dimension.classList.add('needs-selection');
                }
            });

            // Reset Desktop, Mobile and Modal multi-select checkboxes and status dropdowns
            const shortIds = ['dom', 'sub', 'sw', 'aus'];
            ['ich', 'partner'].forEach(person => {
                shortIds.forEach(shortId => {
                    // Desktop
                    const checkbox = document.getElementById(person + '-d-' + shortId);
                    if (checkbox) checkbox.checked = false;
                    const statusSelect = document.getElementById(person + '-d-' + shortId + '-status');
                    if (statusSelect) {
                        statusSelect.style.display = 'none';
                        statusSelect.value = 'gelebt';
                    }
                    // Mobile
                    const mobileCheckbox = document.getElementById('m-' + person + '-d-' + shortId);
                    if (mobileCheckbox) mobileCheckbox.checked = false;
                    const mobileStatusSelect = document.getElementById('m-' + person + '-d-' + shortId + '-status');
                    if (mobileStatusSelect) {
                        mobileStatusSelect.style.display = 'none';
                        mobileStatusSelect.value = 'gelebt';
                    }
                    // Modal
                    const modalCheckbox = document.getElementById('modal-' + person + '-d-' + shortId);
                    if (modalCheckbox) modalCheckbox.checked = false;
                    const modalStatusSelect = document.getElementById('modal-' + person + '-d-' + shortId + '-status');
                    if (modalStatusSelect) {
                        modalStatusSelect.style.display = 'none';
                        modalStatusSelect.value = 'gelebt';
                    }
                });
                // Mark dominanz as needing selection (Desktop, Mobile & Modal)
                const dimension = document.querySelector('[data-dimension="' + person + '-dominanz-multi"]');
                if (dimension) dimension.classList.add('needs-selection');
                const mobileDimension = document.querySelector('[data-dimension="mobile-' + person + '-dominanz-multi"]');
                if (mobileDimension) mobileDimension.classList.add('needs-selection');
                const modalDimension = document.querySelector('[data-dimension="modal-' + person + '-dominanz-multi"]');
                if (modalDimension) modalDimension.classList.add('needs-selection');

                // Mark orientierung as needing selection (Desktop, Mobile & Modal)
                const orientDimension = document.querySelector('[data-dimension="' + person + '-orientierung-multi"]');
                if (orientDimension) orientDimension.classList.add('needs-selection');
                const mobileOrientDimension = document.querySelector('[data-dimension="mobile-' + person + '-orientierung-multi"]');
                if (mobileOrientDimension) mobileOrientDimension.classList.add('needs-selection');
                const modalOrientDimension = document.querySelector('[data-dimension="modal-' + person + '-orientierung-multi"]');
                if (modalOrientDimension) modalOrientDimension.classList.add('needs-selection');
            });

            // Go to page 1
            mobileGoToPage(1);

            // Show confirmation
            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(46, 204, 113, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            warning.textContent = '✓ Alle Eingaben wurden zurückgesetzt';
            document.body.appendChild(warning);

            setTimeout(() => warning.remove(), 3000);
        }

        // Auto-save on changes
        function initAutoSave() {
            // Save on archetype change
            document.getElementById('mobileIchSelect')?.addEventListener('change', saveSelectionToStorage);
            document.getElementById('mobilePartnerSelect')?.addEventListener('change', saveSelectionToStorage);

            // Save on dimension change
            document.querySelectorAll('.mobile-page input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', saveSelectionToStorage);
            });
        }

        // Load saved data on startup
        setTimeout(() => {
            loadSelectionFromStorage();
            initAutoSave();
        }, 500);

        // Update comparison view when data is loaded
        const originalLoadData = loadData;
        async function loadDataAndUpdateComparison() {
            await originalLoadData();
            setTimeout(updateComparisonView, 100);
        }
        loadDataAndUpdateComparison();

        // Make key functions globally accessible for onclick handlers
        window.openHelpModal = openHelpModal;
        window.closeHelpModal = closeHelpModal;
        window.showArchetypeInfo = showArchetypeInfo;
        window.openArchetypeInfo = openArchetypeInfo;
        window.closeArchetypeInfoModal = closeArchetypeInfoModal;
        window.openFactorModal = openFactorModal;
        window.closeFactorModal = closeFactorModal;
        window.navigateFactorArchetype = navigateFactorArchetype;
        window.closeCategoryModal = closeCategoryModal;
        window.closeDefinitionModal = closeDefinitionModal;
        window.navigateDefinition = navigateDefinition;
        window.navigateDefinitionToIndex = navigateDefinitionToIndex;
        window.showArchetypeInfoByType = showArchetypeInfoByType;
        window.openCommentModal = openCommentModal;
        window.closeCommentModal = closeCommentModal;
        window.closeFeedbackModal = closeFeedbackModal;
        window.navigateArchetype = navigateArchetype;
        window.openCommentsListModal = openCommentsListModal;
        window.closeCommentsListModal = closeCommentsListModal;
        window.toggleReplyForm = toggleReplyForm;
        window.submitReply = submitReply;
        // Pro/Contra Modal functions
        window.openProContraModal = openProContraModal;
        window.closeProContraModal = closeProContraModal;
        window.navigateProContraArchetype = navigateProContraArchetype;

        console.log('All modal functions are now globally available');
    </script>
</body>
</html>
