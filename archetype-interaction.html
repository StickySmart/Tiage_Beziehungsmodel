<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Archetypen-Kompatibilität | Swipe</title>
    <style>
        :root {
            --primary: #457B9D;
            --primary-light: #A8D5E2;
            --bg-dark: #0f0f1a;
            --bg-card: #1a1a2e;
            --bg-hover: #252542;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0b0;
            --text-muted: #6a6a7a;
            --border: rgba(255,255,255,0.1);
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;

            /* Responsive Typography with clamp() */
            --font-xs: clamp(0.7rem, 1vw + 0.4rem, 0.85rem);
            --font-sm: clamp(0.8rem, 1.2vw + 0.45rem, 0.95rem);
            --font-base: clamp(0.9rem, 1.5vw + 0.5rem, 1.1rem);
            --font-md: clamp(1rem, 1.8vw + 0.5rem, 1.25rem);
            --font-lg: clamp(1.2rem, 2.5vw + 0.5rem, 1.6rem);
            --font-xl: clamp(1.5rem, 3vw + 0.5rem, 2.2rem);
            --font-label: clamp(0.75rem, 1vw + 0.4rem, 0.9rem);

            /* Responsive Bar Height */
            --bar-height: clamp(16px, 1.5vw + 12px, 22px);
            --bar-radius: calc(var(--bar-height) / 2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
            overflow-x: hidden;
        }

        /* Theme Colors */
        body.theme-single { --primary: #E63946; --primary-light: #FFB4A2; }
        body.theme-duo { --primary: #E84393; --primary-light: #FDA7DF; }
        body.theme-duo_flex { --primary: #FF6B6B; --primary-light: #FFA5A5; }
        body.theme-solopoly { --primary: #2A9D8F; --primary-light: #A8DADC; }
        body.theme-poly_hedo { --primary: #9B5DE5; --primary-light: #D4A5FF; }
        body.theme-polyamor { --primary: #F4A261; --primary-light: #FFE5B4; }

        /* Header */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            text-align: center;
            padding: 12px 15px;
            background: rgba(15,15,26,0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: var(--font-base);
            font-weight: 400;
            letter-spacing: 2px;
            color: var(--text-secondary);
        }

        /* Carousel Container */
        .carousel-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding-top: 60px;
            height: 100vh;
        }

        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        /* Cards */
        .card {
            flex: 0 0 100vw;
            width: 100vw;
            scroll-snap-align: start;
            padding: 15px;
            overflow-y: auto;
            height: calc(100vh - 60px);
        }

        .card-inner {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            min-height: 100%;
            overflow: hidden;
        }

        .card-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: var(--font-sm);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
        }

        .card-body {
            padding: 20px;
        }

        /* Navigation Dots */
        .nav-dots {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
            background: rgba(26,26,46,0.9);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid var(--border);
        }

        .nav-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-dot.active {
            background: var(--primary);
            transform: scale(1.3);
        }

        .nav-dot-label {
            display: none;
        }

        .nav-arrow {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            padding: 0;
            line-height: 1;
        }

        .nav-arrow:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .nav-arrow:active {
            transform: scale(0.95);
        }

        .nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .nav-arrow:disabled:hover {
            background: transparent;
            border-color: var(--border);
            color: var(--text-secondary);
        }

        /* Main Select in Card 1 */
        .main-select {
            margin-bottom: 20px;
        }

        .main-select-label {
            font-size: var(--font-base);
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        #archetypeSelect {
            width: 100%;
            appearance: none;
            background: var(--bg-dark);
            border: 2px solid var(--primary);
            color: var(--text-primary);
            padding: 14px 45px 14px 18px;
            font-size: var(--font-md);
            border-radius: 12px;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a0a0b0' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
        }

        /* My Type Display */
        .my-type-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .my-type-icon {
            width: 55px;
            height: 55px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            background: var(--primary);
        }

        .my-type-name {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--primary);
        }

        .my-type-desc {
            color: var(--text-secondary);
            font-size: var(--font-base);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Collapsible Sections */
        .collapsible {
            border-top: 1px solid var(--border);
        }

        .collapsible-header {
            padding: 14px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: var(--font-base);
        }

        .collapsible-icon {
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .collapsible.open .collapsible-icon {
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible.open .collapsible-content {
            max-height: 600px;
        }

        .pro-contra-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            padding-bottom: 15px;
        }

        .mini-list {
            font-size: var(--font-base);
        }

        .mini-list-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .mini-list-title.pro { color: var(--success); }
        .mini-list-title.contra { color: var(--danger); }

        .mini-list ul {
            list-style: none;
            color: var(--text-muted);
        }

        .mini-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .mini-list li::before {
            content: '•';
            position: absolute;
            left: 0;
        }

        .pathos-logos-content {
            font-size: var(--font-base);
            color: var(--text-muted);
            padding-bottom: 15px;
        }

        .pathos-logos-content p {
            margin-bottom: 10px;
            font-style: italic;
            line-height: 1.5;
        }

        /* Match Cards */
        .match-section {
            margin-top: 20px;
        }

        .match-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .match-card:active {
            transform: translateY(0);
        }

        .match-card.top {
            background: rgba(0,206,201,0.1);
            border: 1px solid rgba(0,206,201,0.3);
        }

        .match-card.challenge {
            background: rgba(231,76,60,0.1);
            border: 1px solid rgba(231,76,60,0.3);
        }

        .match-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .match-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .match-label-text {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .match-name {
            font-size: var(--font-base);
            font-weight: 500;
        }

        .match-score {
            font-size: var(--font-md);
            font-weight: 700;
        }

        .match-score.excellent { color: #00cec9; }
        .match-score.low { color: #e74c3c; }

        /* Card 2: Partner Selector */
        .partner-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .partner-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 20px;
            cursor: pointer;
            font-size: var(--font-base);
            transition: all 0.3s ease;
        }

        .partner-btn:hover {
            border-color: var(--text-muted);
            background: var(--bg-hover);
        }

        .partner-btn.active {
            border-color: var(--primary);
            background: rgba(69,123,157,0.2);
            color: var(--text-primary);
        }

        .partner-btn .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        /* Radar Chart */
        .radar-section {
            margin-bottom: 25px;
        }

        .radar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .radar-title {
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .radar-score {
            font-size: var(--font-xl);
            font-weight: 700;
        }

        .radar-score-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-transform: uppercase;
        }

        #radarChart {
            width: 100%;
            max-width: 280px;
            margin: 0 auto;
            display: block;
        }

        /* Category Bars */
        .category-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .category-label {
            width: clamp(20px, 3vw + 10px, 28px);
            font-weight: 700;
            font-size: var(--font-sm);
            color: var(--primary);
        }

        .category-bar-wrap {
            flex: 1;
        }

        .category-bar-container {
            height: var(--bar-height);
            background: rgba(255,255,255,0.05);
            border-radius: var(--bar-radius);
            overflow: hidden;
        }

        .category-bar {
            height: 100%;
            border-radius: var(--bar-radius);
            transition: width 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .category-bar-value {
            font-size: var(--font-xs);
            font-weight: 600;
            color: white;
        }

        .category-name {
            font-size: var(--font-sm);
            color: var(--text-muted);
            margin-top: 2px;
        }

        .bar-excellent { background: linear-gradient(90deg, #00cec9, #0984e3); }
        .bar-good { background: linear-gradient(90deg, #27ae60, #1e8449); }
        .bar-medium { background: linear-gradient(90deg, #f39c12, #d68910); }
        .bar-low { background: linear-gradient(90deg, #e74c3c, #c0392b); }

        /* Pro/Contra Analysis */
        .analysis-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .analysis-section {
            padding: 14px;
            border-radius: 10px;
        }

        .analysis-section.pro {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .analysis-section.contra {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .analysis-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .analysis-section.pro .analysis-title { color: var(--success); }
        .analysis-section.contra .analysis-title { color: var(--danger); }

        .analysis-list {
            list-style: none;
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .analysis-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .analysis-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 9px;
            width: 5px;
            height: 5px;
            border-radius: 50%;
        }

        .analysis-section.pro .analysis-list li::before { background: var(--success); }
        .analysis-section.contra .analysis-list li::before { background: var(--danger); }

        /* Card 3: Alle Typen - Mini Cards Grid */
        .mini-cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .mini-card {
            background: var(--bg-dark);
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .mini-card:hover {
            border-color: var(--text-muted);
        }

        .mini-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .mini-card-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .mini-card-name {
            font-size: var(--font-base);
            font-weight: 600;
        }

        .mini-card-desc {
            font-size: var(--font-sm);
            color: var(--text-muted);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .mini-card-self-score {
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .mini-card-self-score span {
            font-weight: 700;
            color: var(--primary);
        }

        /* Swipe Hint */
        .swipe-hint {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--text-muted);
            opacity: 0.7;
            animation: fadeOut 3s forwards;
            animation-delay: 2s;
        }

        @keyframes fadeOut {
            to { opacity: 0; }
        }

        /* Info Icon */
        .section-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .info-icon:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Clickable Category Row */
        .category-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 4px;
            margin: -4px;
            margin-bottom: 6px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .category-row:hover {
            background: rgba(255,255,255,0.05);
        }

        .category-row:active {
            background: rgba(255,255,255,0.1);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--border);
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
        }

        .modal-title {
            font-size: var(--font-md);
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-feedback-btn {
            margin-top: 20px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .modal-feedback-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary);
            border-color: var(--primary);
        }

        .category-nav-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 8px;
            background: var(--bg-dark);
            border-radius: 10px;
        }

        .category-nav-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: var(--font-sm);
        }

        .category-nav-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .category-nav-indicator {
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        /* Definition Modal */
        .definition-modal {
            max-width: 500px;
        }

        .definition-section {
            margin-bottom: 20px;
        }

        .definition-section-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }

        .definition-long {
            font-size: var(--font-base);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .definition-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .definition-list li {
            padding: 8px 0 8px 20px;
            position: relative;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .definition-list.principles li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--success);
        }

        .definition-list.not-same li::before {
            content: '✗';
            position: absolute;
            left: 0;
            color: var(--danger);
        }

        .definition-list.variants li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .type-info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s;
        }

        .type-info-icon:hover {
            background: var(--primary);
            color: white;
        }

        .type-tooltip {
            position: relative;
            display: inline-block;
        }

        .type-tooltip .tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: var(--bg-dark);
            color: var(--text-secondary);
            text-align: left;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: var(--font-sm);
            line-height: 1.4;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .type-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .modal-category {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-category:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .modal-category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .modal-category-letter {
            width: clamp(24px, 3vw + 14px, 32px);
            height: clamp(24px, 3vw + 14px, 32px);
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-sm);
        }

        .modal-category-name {
            font-weight: 600;
            font-size: var(--font-base);
            color: var(--text-primary);
        }

        .modal-category-desc {
            font-size: var(--font-base);
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .modal-subdimensions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .modal-subdim-tag {
            font-size: var(--font-sm);
            padding: 6px 10px;
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: help;
            position: relative;
            transition: background 0.2s ease;
        }

        .modal-subdim-tag:hover {
            background: rgba(255,255,255,0.15);
        }

        /* Tag Tooltip Container */
        .tag-tooltip-container {
            position: relative;
            display: inline-block;
        }

        /* Tag Tooltip - Click to open, stays open */
        .tag-tooltip {
            display: none;
            position: fixed;
            z-index: 1001;
            width: min(360px, 92vw);
            max-width: 92vw;
            max-height: 85vh;
            overflow-y: auto;
            background: var(--bg-card);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        .tag-tooltip.active {
            display: block;
        }

        .tag-tooltip-close {
            position: absolute;
            top: 6px;
            right: 8px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 22px;
            cursor: pointer;
            padding: 4px 8px;
            line-height: 1;
            z-index: 10;
        }

        .tag-tooltip-close:hover {
            color: var(--text-primary);
        }

        /* Tooltip Header */
        .tag-tooltip-header {
            padding: 10px 12px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid var(--border);
            border-radius: 12px 12px 0 0;
            font-weight: 600;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }

        /* Tooltip Body */
        .tag-tooltip-body {
            padding: 12px;
        }

        /* Type Perspective */
        .tag-tooltip-perspective {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .tag-tooltip-perspective:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .tag-tooltip-type-name {
            font-weight: 600;
            font-size: var(--font-xs);
            margin-bottom: 4px;
            display: block;
        }

        .tag-tooltip-type-text {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Dynamic Summary */
        .tag-tooltip-dynamic {
            background: rgba(69, 123, 157, 0.15);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: var(--font-xs);
            line-height: 1.4;
        }

        .tag-tooltip-dynamic::before {
            content: '→ ';
            color: var(--primary);
            font-weight: 600;
        }

        /* Type Switcher in Tooltip */
        .tag-tooltip-type-switcher {
            display: flex;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            flex-wrap: wrap;
            -webkit-overflow-scrolling: touch;
        }

        .type-switch-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 16px;
            cursor: pointer;
            font-size: var(--font-xs);
            transition: all 0.2s ease;
            pointer-events: auto;
        }

        .type-switch-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--text-secondary);
        }

        .type-switch-btn.active {
            border-color: currentColor;
            background: rgba(255,255,255,0.08);
        }

        .type-switch-btn .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .type-switch-label {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-right: auto;
            display: flex;
            align-items: center;
        }

        /* Responsive: Position tooltip above or below based on space */
        @media (max-width: 480px) {
            .tag-tooltip {
                width: 280px;
                left: 0;
                transform: translateX(-20%);
            }
        }

        /* Match Modal Content */
        .match-modal-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .match-modal-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .match-modal-info h3 {
            font-size: var(--font-lg);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .match-modal-info p {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .match-modal-score {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .match-modal-score-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .match-modal-score-value {
            font-size: var(--font-xl);
            font-weight: 700;
        }

        .match-modal-categories {
            margin-bottom: 20px;
        }

        .match-modal-categories-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 12px;
        }

        .match-modal-bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .match-modal-bar-row.clickable {
            cursor: pointer;
            padding: 6px;
            margin: -6px;
            margin-bottom: 2px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .match-modal-bar-row.clickable:hover {
            background: rgba(255,255,255,0.08);
        }

        .match-modal-bar-row.clickable:active {
            background: rgba(255,255,255,0.12);
        }

        .match-modal-bar-label {
            width: 24px;
            font-weight: 700;
            font-size: var(--font-sm);
            color: var(--primary);
        }

        .match-modal-bar-container {
            flex: 1;
            height: var(--bar-height);
            background: rgba(255,255,255,0.05);
            border-radius: var(--bar-radius);
            overflow: hidden;
        }

        .match-modal-bar {
            height: 100%;
            border-radius: var(--bar-radius);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
        }

        .match-modal-bar-value {
            font-size: var(--font-xs);
            font-weight: 600;
            color: white;
        }

        .match-modal-bar-name {
            width: 120px;
            font-size: var(--font-xs);
            color: var(--text-muted);
            text-align: right;
        }

        .match-modal-section {
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .match-modal-section.pro {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .match-modal-section.contra {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .match-modal-section-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: var(--font-base);
        }

        .match-modal-section.pro .match-modal-section-title { color: var(--success); }
        .match-modal-section.contra .match-modal-section-title { color: var(--danger); }

        .match-modal-list {
            list-style: none;
            font-size: var(--font-sm);
            color: var(--text-secondary);
        }

        .match-modal-list li {
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .match-modal-list li::before {
            content: '•';
            position: absolute;
            left: 0;
        }

        /* Legend Page */
        .legend-section {
            margin-bottom: 25px;
        }

        .legend-title {
            font-size: var(--font-sm);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .color-scale {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .color-scale-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .color-scale-bar {
            width: clamp(50px, 8vw + 20px, 80px);
            height: var(--bar-height);
            border-radius: var(--bar-radius);
        }

        .color-scale-label {
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        .color-scale-range {
            font-size: var(--font-sm);
            color: var(--text-muted);
            margin-left: auto;
        }

        .legend-category-item {
            display: flex;
            gap: 12px;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .legend-category-item:hover {
            background: var(--bg-hover);
        }

        .legend-category-letter {
            width: clamp(28px, 4vw + 16px, 36px);
            height: clamp(28px, 4vw + 16px, 36px);
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-base);
            flex-shrink: 0;
        }

        .legend-category-content {
            flex: 1;
        }

        .legend-category-name {
            font-weight: 600;
            font-size: var(--font-md);
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .legend-category-desc {
            font-size: var(--font-base);
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* Responsive - Mobile (larger fonts for readability) */
        @media (max-width: 599px) {
            :root {
                --font-xs: 0.85rem;
                --font-sm: 0.95rem;
                --font-base: 1.05rem;
                --font-md: 1.15rem;
                --font-lg: 1.4rem;
                --font-xl: 1.8rem;
                --bar-height: 20px;
            }

            .modal {
                max-width: 95vw;
                max-height: 90vh;
            }

            .match-modal-bar-name {
                width: auto;
                min-width: 80px;
            }
        }

        /* Responsive - Tablet+ */
        @media (min-width: 600px) {
            .mini-cards-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .analysis-grid {
                grid-template-columns: 1fr 1fr;
            }

            .pro-contra-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .mini-list {
                font-size: var(--font-sm);
            }

            .mini-list-title {
                font-size: var(--font-sm);
            }
        }

        @media (min-width: 900px) {
            .card {
                padding: 20px 10%;
            }

            .mini-cards-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }

        /* Feedback Button */
        .feedback-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            z-index: 99;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .feedback-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }

        /* Feedback Modal */
        .feedback-modal {
            max-width: 420px;
        }

        .feedback-context-id {
            display: inline-block;
            padding: 4px 10px;
            background: var(--bg-dark);
            border-radius: 6px;
            font-size: var(--font-xs);
            color: var(--primary);
            font-family: monospace;
            margin-bottom: 16px;
        }

        .feedback-form-group {
            margin-bottom: 16px;
        }

        .feedback-label {
            display: block;
            font-size: var(--font-sm);
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .feedback-label .required {
            color: var(--danger);
        }

        .feedback-input,
        .feedback-textarea {
            width: 100%;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 14px;
            color: var(--text-primary);
            font-size: var(--font-base);
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .feedback-input:focus,
        .feedback-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .feedback-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Star Rating */
        .star-rating-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .star-rating-label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            min-width: 80px;
        }

        .star-rating {
            display: flex;
            gap: 4px;
        }

        .star-rating .star {
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .star-rating .star:hover,
        .star-rating .star.active {
            color: #f1c40f;
            transform: scale(1.1);
        }

        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .feedback-btn-cancel,
        .feedback-btn-submit {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            font-size: var(--font-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-btn-cancel {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .feedback-btn-cancel:hover {
            background: var(--bg-hover);
        }

        .feedback-btn-submit {
            background: var(--primary);
            border: none;
            color: white;
        }

        .feedback-btn-submit:hover {
            filter: brightness(1.1);
        }

        .feedback-btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Feedback Page (Card 4) */
        .feedback-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .feedback-filter-btn {
            padding: 8px 14px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 20px;
            font-size: var(--font-sm);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feedback-filter-btn:hover {
            background: var(--bg-hover);
        }

        .feedback-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .feedback-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .feedback-item {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 14px;
            border: 1px solid var(--border);
        }

        .feedback-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .feedback-item-context {
            font-size: var(--font-xs);
            color: var(--primary);
            font-family: monospace;
            background: rgba(255,255,255,0.05);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .feedback-item-name {
            font-size: var(--font-sm);
            color: var(--text-muted);
        }

        .feedback-item-title {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .feedback-item-comment {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .feedback-item-ratings {
            display: flex;
            gap: 20px;
            font-size: var(--font-sm);
        }

        .feedback-rating {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
        }

        .feedback-rating .stars {
            color: #f1c40f;
        }

        .feedback-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .feedback-loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        /* Advanced Feedback Filters */
        .feedback-search {
            margin-bottom: 15px;
        }

        .feedback-search-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: var(--font-sm);
        }

        .feedback-search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .feedback-advanced-filters {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .feedback-filter-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .feedback-filter-row:last-child {
            margin-bottom: 0;
        }

        .feedback-filter-row label {
            font-size: var(--font-sm);
            color: var(--text-muted);
            min-width: 90px;
        }

        .feedback-select {
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: var(--font-sm);
            cursor: pointer;
        }

        .filter-separator {
            color: var(--text-muted);
            font-size: var(--font-sm);
        }

        .feedback-category-btns {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cat-filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 16px;
            font-size: var(--font-xs);
            cursor: pointer;
            transition: all 0.2s;
        }

        .cat-filter-btn:hover {
            background: var(--bg-hover);
        }

        .cat-filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Reply/Thread Styles */
        .feedback-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }

        .feedback-reply-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-muted);
            font-size: var(--font-xs);
            cursor: pointer;
            transition: all 0.2s;
        }

        .feedback-reply-btn:hover {
            background: var(--bg-hover);
            color: var(--primary);
            border-color: var(--primary);
        }

        .feedback-replies {
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid var(--border);
            margin-top: 12px;
        }

        .feedback-item.reply {
            background: rgba(255,255,255,0.02);
            padding: 12px;
        }

        .feedback-item.reply .feedback-item-context {
            font-size: 10px;
        }

        .reply-indicator {
            font-size: var(--font-xs);
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .feedback-timestamp {
            font-size: 10px;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <header>
        <h1>ARCHETYPEN-KOMPATIBILITÄT</h1>
    </header>

    <div class="carousel-container" id="carousel">
        <!-- CARD 1: MEIN TYP -->
        <div class="card" data-card="0">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Mein Typ</span>
                </div>
                <div class="card-body">
                    <div class="main-select">
                        <label class="main-select-label">Ich bin...</label>
                        <select id="archetypeSelect">
                            <option value="single">Single</option>
                            <option value="duo">Duo</option>
                            <option value="duo_flex">Duo-Flex</option>
                            <option value="solopoly">Solopoly</option>
                            <option value="poly_hedo">Poly Hedo</option>
                            <option value="polyamor">Polyamor</option>
                        </select>
                    </div>

                    <div class="my-type-header">
                        <div class="my-type-icon" id="myTypeIcon">★</div>
                        <div class="type-tooltip">
                            <div class="my-type-name" id="myTypeName">Single</div>
                            <span class="tooltip-text" id="myTypeTooltip"></span>
                        </div>
                        <span class="type-info-icon" id="myTypeInfoIcon" onclick="openDefinitionModal(currentArchetype)" title="Was bedeutet dieser Typ?">ℹ</span>
                    </div>
                    <p class="my-type-desc" id="myTypeDesc">...</p>

                    <!-- Collapsible: Pro/Contra -->
                    <div class="collapsible" id="proContraCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('proContraCollapse')">
                            <span>Pro & Contra</span>
                            <span class="collapsible-icon">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pro-contra-grid">
                                <div class="mini-list">
                                    <div class="mini-list-title pro">✓ Pro</div>
                                    <ul id="myTypePro"></ul>
                                </div>
                                <div class="mini-list">
                                    <div class="mini-list-title contra">✗ Contra</div>
                                    <ul id="myTypeContra"></ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Collapsible: Pathos/Logos -->
                    <div class="collapsible" id="pathosLogosCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('pathosLogosCollapse')">
                            <span>Pathos & Logos</span>
                            <span class="collapsible-icon">▼</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pathos-logos-content">
                                <p id="myTypePathos"></p>
                                <p id="myTypeLogos"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Match Section -->
                    <div class="match-section">
                        <div class="match-card top" id="topMatchCard" onclick="openMatchModal('top')">
                            <div class="match-info">
                                <div class="match-dot" id="topMatchDot"></div>
                                <div>
                                    <div class="match-label-text">Top Match</div>
                                    <div class="match-name" id="topMatchName">...</div>
                                </div>
                            </div>
                            <div class="match-score excellent" id="topMatchScore">0%</div>
                        </div>

                        <div class="match-card challenge" id="challengeCard" onclick="openMatchModal('challenge')">
                            <div class="match-info">
                                <div class="match-dot" id="challengeDot"></div>
                                <div>
                                    <div class="match-label-text">Challenge</div>
                                    <div class="match-name" id="challengeName">...</div>
                                </div>
                            </div>
                            <div class="match-score low" id="challengeScore">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 2: KOMPATIBILITÄT -->
        <div class="card" data-card="1">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Kompatibilität</span>
                </div>
                <div class="card-body">
                    <!-- Partner Selector -->
                    <div class="partner-selector" id="partnerSelector"></div>

                    <!-- Radar Chart -->
                    <div class="radar-section">
                        <div class="radar-header">
                            <div>
                                <div class="radar-title">
                                    <span class="type-tooltip"><span id="myTypeNameDisplay">...</span><span class="tooltip-text" id="myTypeTooltipPage3"></span></span>
                                    mit
                                    <span class="type-tooltip"><span id="partnerNameDisplay">...</span><span class="tooltip-text" id="partnerTooltipPage3"></span></span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="radar-score" id="overallScore" style="color: var(--primary);">0%</div>
                                <div class="radar-score-label">Gesamt</div>
                            </div>
                        </div>
                        <svg id="radarChart" viewBox="0 0 280 260"></svg>
                    </div>

                    <!-- Category Bars -->
                    <div class="category-section">
                        <div class="section-title-row">
                            <div class="section-title" style="margin-bottom: 0;">Kategorie-Details</div>
                            <div class="info-icon" onclick="openCategoryModal()">ℹ</div>
                        </div>
                        <div id="categoryBars"></div>
                    </div>

                    <!-- Pro/Contra Analysis -->
                    <div class="analysis-grid">
                        <div class="analysis-section pro">
                            <div class="analysis-title">✓ Was funktioniert</div>
                            <ul class="analysis-list" id="partnerPro"></ul>
                        </div>
                        <div class="analysis-section contra">
                            <div class="analysis-title">✗ Herausforderungen</div>
                            <ul class="analysis-list" id="partnerContra"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 3: LEGENDE -->
        <div class="card" data-card="2">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Legende</span>
                </div>
                <div class="card-body">
                    <!-- Farbskala -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungsskala</div>
                        <div class="color-scale">
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-excellent"></div>
                                <span class="color-scale-label">Exzellent</span>
                                <span class="color-scale-range">78-100%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-good"></div>
                                <span class="color-scale-label">Gut</span>
                                <span class="color-scale-range">70-77%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-medium"></div>
                                <span class="color-scale-label">Mittel</span>
                                <span class="color-scale-range">60-69%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-low"></div>
                                <span class="color-scale-label">Herausfordernd</span>
                                <span class="color-scale-range">&lt;60%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Kategorien -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungskategorien</div>
                        <div id="legendCategories"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 4: FEEDBACK -->
        <div class="card" data-card="3">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Feedback</span>
                </div>
                <div class="card-body">
                    <!-- Search -->
                    <div class="feedback-search">
                        <input type="text" id="feedbackSearch" placeholder="🔍 Suche nach Name, Titel oder Inhalt..." class="feedback-search-input">
                    </div>

                    <!-- Advanced Filters -->
                    <div class="feedback-advanced-filters">
                        <div class="feedback-filter-row">
                            <label>Kombination:</label>
                            <select id="filterMyType" class="feedback-select">
                                <option value="all">Alle Typen</option>
                            </select>
                            <span class="filter-separator">mit</span>
                            <select id="filterPartnerType" class="feedback-select">
                                <option value="all">Alle Partner</option>
                            </select>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Kategorie:</label>
                            <div class="feedback-category-btns" id="categoryFilterBtns">
                                <button class="cat-filter-btn active" data-cat="all">Alle</button>
                                <button class="cat-filter-btn" data-cat="A" title="Beziehungsphilosophie">A Philosophie</button>
                                <button class="cat-filter-btn" data-cat="B" title="Werte-Alignment">B Werte</button>
                                <button class="cat-filter-btn" data-cat="C" title="Nähe-Distanz">C Nähe</button>
                                <button class="cat-filter-btn" data-cat="D" title="Autonomie">D Autonomie</button>
                                <button class="cat-filter-btn" data-cat="E" title="Kommunikation">E Kommunik.</button>
                                <button class="cat-filter-btn" data-cat="F" title="Soziale Kompatibilität">F Sozial</button>
                                <button class="cat-filter-btn" data-cat="TM" title="Top Match">Top Match</button>
                                <button class="cat-filter-btn" data-cat="CH" title="Challenge">Challenge</button>
                            </div>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Sortieren:</label>
                            <select id="filterSort" class="feedback-select">
                                <option value="newest">Neueste zuerst</option>
                                <option value="oldest">Älteste zuerst</option>
                                <option value="rating">Beste Bewertung</option>
                            </select>
                        </div>
                    </div>

                    <!-- Feedback List -->
                    <div class="feedback-list" id="feedbackList">
                        <div class="feedback-loading">Lade Feedback...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="categoryModal" onclick="closeCategoryModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="modalTitle">Kategorie-Details</span>
                <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal-overlay" id="feedbackModal" onclick="closeFeedbackModal(event)">
        <div class="modal feedback-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title">Feedback geben</span>
                <button class="modal-close" onclick="closeFeedbackModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="feedback-context-id" id="feedbackContextId">S1-SINGLE</div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Name/Kürzel <span class="required">*</span></label>
                    <input type="text" class="feedback-input" id="feedbackName" placeholder="z.B. Max, Anna, M.S." maxlength="20">
                </div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Titel <span class="required">*</span></label>
                    <input type="text" class="feedback-input" id="feedbackTitle" placeholder="Kurze Zusammenfassung" maxlength="50">
                </div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Kommentar</label>
                    <textarea class="feedback-textarea" id="feedbackComment" placeholder="Dein Feedback zu dieser Ansicht..."></textarea>
                </div>

                <div class="feedback-form-group">
                    <label class="feedback-label">Bewertung</label>
                    <div class="star-rating-group">
                        <span class="star-rating-label">Verstand</span>
                        <span style="font-size: 1rem;">😕</span>
                        <div class="star-rating" id="ratingVerstand">
                            <span class="star" data-value="1">★</span>
                            <span class="star" data-value="2">★</span>
                            <span class="star" data-value="3">★</span>
                            <span class="star" data-value="4">★</span>
                            <span class="star" data-value="5">★</span>
                        </div>
                        <span style="font-size: 1rem;">🤩</span>
                    </div>
                    <div class="star-rating-group" style="margin-top: 10px;">
                        <span class="star-rating-label">Gefühl</span>
                        <span style="font-size: 1rem;">😕</span>
                        <div class="star-rating" id="ratingGefuehl">
                            <span class="star" data-value="1">★</span>
                            <span class="star" data-value="2">★</span>
                            <span class="star" data-value="3">★</span>
                            <span class="star" data-value="4">★</span>
                            <span class="star" data-value="5">★</span>
                        </div>
                        <span style="font-size: 1rem;">🤩</span>
                    </div>
                </div>

                <div class="feedback-buttons">
                    <button class="feedback-btn-cancel" onclick="closeFeedbackModal()">Abbrechen</button>
                    <button class="feedback-btn-submit" id="feedbackSubmitBtn" onclick="submitFeedback()">Senden</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Definition Modal -->
    <div class="modal-overlay" id="definitionModal" onclick="closeDefinitionModal(event)">
        <div class="modal definition-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="definitionModalTitle">Typ-Definition</span>
                <button class="modal-close" onclick="closeDefinitionModal()">&times;</button>
            </div>
            <div class="modal-body" id="definitionModalBody"></div>
        </div>
    </div>

    <!-- Navigation Dots with Arrows -->
    <div class="nav-dots">
        <button class="nav-arrow" onclick="navigatePrev()">‹</button>
        <div class="nav-dot active" data-card="0" onclick="scrollToCard(0)"></div>
        <div class="nav-dot" data-card="1" onclick="scrollToCard(1)"></div>
        <div class="nav-dot" data-card="2" onclick="scrollToCard(2)"></div>
        <div class="nav-dot" data-card="3" onclick="scrollToCard(3)"></div>
        <button class="nav-arrow" onclick="navigateNext()">›</button>
    </div>

    <div class="swipe-hint">← Swipe →</div>

    <script>
        let data = null;
        let currentArchetype = 'single';
        let selectedPartner = 'duo';

        const icons = {
            single: '★',
            duo: '♡',
            duo_flex: '⚡',
            solopoly: '◆',
            poly_hedo: '☀',
            polyamor: '♥'
        };

        const categoryNames = {
            A: 'Beziehungsphilosophie',
            B: 'Werte-Alignment',
            C: 'Nähe-Distanz',
            D: 'Autonomie',
            E: 'Kommunikation',
            F: 'Soziale Kompatibilität'
        };

        // Archetype definitions
        const archetypeDefinitions = {
            single: {
                name: "Single",
                shortDef: "Bewusste Entscheidung für ein autonomes Leben ohne Primärbeziehung als dauerhafte Lebensform.",
                longDef: "Single-orientierte Menschen haben sich aktiv für ein Leben ohne dauerhafte romantische Partnerschaft entschieden. Dies ist keine Übergangsphase ('zwischen Beziehungen'), sondern eine bewusste Lebensform, die Selbstgenügsamkeit und persönliche Autonomie als zentrale Werte sieht. Soziale Kontakte, Freundschaften und gelegentliche romantische/sexuelle Begegnungen sind möglich, aber keine feste Partnerschaft wird angestrebt.",
                keyPrinciples: [
                    "Selbstgenügsamkeit als Wert, nicht als Mangel",
                    "Persönliche Autonomie über Verbindlichkeit",
                    "Beziehungen als Option, nicht als Notwendigkeit",
                    "Erfüllung durch Selbst, Freunde, Projekte"
                ],
                notTheSameAs: [
                    "'Zwischen Beziehungen' sein",
                    "'Noch nicht den Richtigen gefunden'",
                    "Beziehungsunfähig oder bindungsängstlich",
                    "Einsam oder unglücklich"
                ],
                variants: [
                    "Aromantisch-Single: Keine romantischen Gefühle, kein Bedürfnis danach",
                    "Bewusst-autonom: Positive Entscheidung für Freiheit",
                    "Beziehungs-kritisch: Bevorzugt Unabhängigkeit"
                ]
            },
            duo: {
                name: "Duo",
                shortDef: "Traditionelle monogame Zweierbeziehung mit Exklusivität und gemeinsamer Lebensgestaltung als Kernprinzip.",
                longDef: "Duo-orientierte Menschen leben in oder suchen eine klassische Zweierbeziehung mit romantischer und sexueller Exklusivität. Die Partnerschaft steht im Zentrum der Lebensgestaltung und wird als primäre emotionale und soziale Einheit verstanden. Gemeinsame Ziele, Alltag und Zukunftsplanung werden als Paar gestaltet.",
                keyPrinciples: [
                    "Exklusivität als Ausdruck von Verbindlichkeit",
                    "'Wir' als zentrale Einheit über 'Ich'",
                    "Tiefe durch Fokussierung auf eine Person",
                    "Gemeinsame Lebensgestaltung und Zukunftsplanung",
                    "Treue als emotionale und sexuelle Exklusivität"
                ],
                notTheSameAs: [
                    "Besitzdenken oder Kontrolle",
                    "Verlust der eigenen Identität",
                    "'Alte' oder 'überholte' Beziehungsform",
                    "Langweilig oder unerfüllt"
                ],
                variants: [
                    "Traditionell-Duo: Klassisches Ehe-Modell",
                    "Modern-Duo: Ohne Trauschein, flexiblere Rollen",
                    "Intensiv-Duo: Sehr enge emotionale Verschmelzung"
                ]
            },
            duo_flex: {
                name: "Duo-Flex",
                shortDef: "Primäre Zweierbeziehung mit vereinbarten Öffnungen für zusätzliche Kontakte unter klaren Regeln.",
                longDef: "Duo-Flex-orientierte Menschen leben in einer Hauptbeziehung mit einem Primärpartner, öffnen diese aber bewusst und einvernehmlich für weitere Kontakte. Die Primärbeziehung bleibt zentral und privilegiert. Alle Öffnungen erfolgen transparent und nach gemeinsam vereinbarten Regeln.",
                keyPrinciples: [
                    "Primärbeziehung als Anker und Priorität",
                    "Sexuelle/romantische Vielfalt ohne Hierarchie-Aufgabe",
                    "Ehrlichkeit und Transparenz über alle Kontakte",
                    "Regeln schützen die Hauptbeziehung",
                    "Freiheit innerhalb vereinbarter Grenzen"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alles ist abgesprochen!)",
                    "'Beziehung retten' durch Öffnung",
                    "Fehlende Verbindlichkeit",
                    "Übergangsphase zu Polyamorie"
                ],
                variants: [
                    "Swinging/Lifestyle: Gemeinsame sexuelle Erlebnisse",
                    "Open Relationship: Individuelle sexuelle Freiheit",
                    "Hierarchisches Poly: Primärpartner + Nebenbeziehungen"
                ]
            },
            solopoly: {
                name: "Solopoly",
                shortDef: "Mehrere gleichwertige Beziehungen bei bewusster Bewahrung der eigenen Autonomie - keine Primärpartner.",
                longDef: "Solopoly-orientierte Menschen führen mehrere romantische und/oder sexuelle Beziehungen parallel, ohne eine davon als 'Hauptbeziehung' zu priorisieren. Die persönliche Autonomie steht im Zentrum: Kein Zusammenziehen, keine gemeinsame Haushaltsführung. 'Ich bin mein eigener Primärpartner'.",
                keyPrinciples: [
                    "Autonomie als höchster Wert - auch in Beziehungen",
                    "Mehrere gleichwertige Beziehungen ohne Hierarchie",
                    "Keine Verschmelzung oder gemeinsame Haushalte",
                    "'Ich bin mein eigener Primärpartner'",
                    "Liebe ohne Aufgabe der Unabhängigkeit"
                ],
                notTheSameAs: [
                    "Bindungsangst oder Commitment-Probleme",
                    "'Light-Version' von Polyamorie",
                    "Egoistisch oder beziehungsunfähig",
                    "Zwischenstufe zu 'richtiger' Partnerschaft"
                ],
                variants: [
                    "Stark-autonom: Sehr klare Grenzen",
                    "Beziehungs-balanciert: Tiefe Beziehungen, getrennte Wohnungen",
                    "Netzwerk-orientiert: Viele gleichwertige Connections"
                ]
            },
            poly_hedo: {
                name: "Poly Hedo",
                shortDef: "Freiheitsorientierte Poly-Orientierung mit Fokus auf Genuss, Spontaneität und lebensbereichernde Erfahrungen.",
                longDef: "Poly-Hedo-orientierte Menschen leben multiple Beziehungen mit Betonung auf Lebensfreude, Spontaneität und genussvolle Erfahrungen. Weniger Regelwerk als bei anderen Poly-Formen, mehr Flow und Intuition. Die Freude am Moment und an vielfältigen Verbindungen steht im Vordergrund.",
                keyPrinciples: [
                    "Lebensfreude und Genuss als zentrale Werte",
                    "Spontaneität über starre Regeln",
                    "Vielfalt der Erfahrungen bereichert das Leben",
                    "Freiheit in Verbindungen",
                    "Intensität des Moments"
                ],
                notTheSameAs: [
                    "Verantwortungslos oder rücksichtslos",
                    "'Nur Sex ohne Gefühle'",
                    "Oberflächlich oder bindungsunfähig",
                    "Chaotisch oder planlos"
                ],
                variants: [
                    "Erlebnis-orientiert: Fokus auf gemeinsame Abenteuer",
                    "Genuss-zentriert: Sinnlichkeit und Lebensfreude",
                    "Freigeist: Maximale Spontaneität und Offenheit"
                ]
            },
            polyamor: {
                name: "Polyamor",
                shortDef: "Mehrere gleichzeitige, ethisch geführte Liebesbeziehungen mit Transparenz und emotionalem Commitment.",
                longDef: "Polyamor-orientierte Menschen führen mehrere romantische Beziehungen parallel, die alle auf Ehrlichkeit, Einvernehmlichkeit und Transparenz basieren. Tiefe Verschmelzung, Zusammenleben und gemeinsame Zukunftsplanung mit mehreren Partnern sind möglich und erwünscht. Alle Beteiligten wissen voneinander.",
                keyPrinciples: [
                    "Liebe ist nicht begrenzt oder exklusiv",
                    "Ehrlichkeit und Transparenz gegenüber allen",
                    "Konsens und Einvernehmlichkeit als Basis",
                    "Emotionale Tiefe zu mehreren Menschen",
                    "Kommunikation als zentrale Kompetenz"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alle wissen Bescheid!)",
                    "Bindungsunfähigkeit",
                    "Nur Sex ohne Gefühle",
                    "Chaotisch oder unkontrolliert"
                ],
                variants: [
                    "Hierarchisches Poly: Primär-, Sekundärpartner",
                    "Nicht-hierarchisches Poly: Alle gleichwertig",
                    "Kitchen-Table-Poly: Alle Partner verstehen sich",
                    "Parallel-Poly: Partner kennen sich, wenig Kontakt"
                ]
            }
        };

        // Tag tooltip content for type combinations
        // Keys: "type1-type2" (alphabetically sorted), categories: A-F, tags: normalized tag names
        const tagTooltipContent = {
            // Single × Polyamor (niedrige Kompatibilität - Priorität)
            "polyamor-single": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Singles haben keine aktive Exklusivitäts-Erwartung, da sie bewusst ohne Primärbeziehung leben.",
                        type2Perspective: "Polyamor-Menschen lehnen Exklusivität als Grundprinzip ab - Liebe wird als nicht-begrenzt verstanden.",
                        dynamic: "Beide lehnen Exklusivität ab, aber aus völlig verschiedenen Gründen: Single will keine Beziehung, Polyamor will mehrere gleichzeitig."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Singles sind theoretisch offen, haben aber keine aktive Beziehungspraxis.",
                        type2Perspective: "Polyamor lebt alternative Modelle aktiv mit mehreren gleichzeitigen Liebesbeziehungen.",
                        dynamic: "Potenzielle Brücke: Ein Single könnte Polyamorie entdecken, wenn die Autonomie gewahrt bleibt."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Für Singles ist Beziehung kein zentraler Lebensinhalt - Selbstgenügsamkeit steht im Vordergrund.",
                        type2Perspective: "Für Polyamor sind Beziehungen sehr zentral, aber als Netzwerk statt als einzelne Partnerschaft.",
                        dynamic: "Grundlegend verschiedene Lebensentwürfe: Beziehungsfreiheit vs. Beziehungsvielfalt als Ideal."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue ist für Singles kein relevantes Konzept, da keine Beziehungsverpflichtungen bestehen.",
                        type2Perspective: "Treue bedeutet für Polyamor Ehrlichkeit und Transparenz, nicht Exklusivität.",
                        dynamic: "Verschiedene Bedeutungen: Für Single irrelevant, für Polyamor transformiert - aber nicht abwesend."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Singles praktizieren Selbstverantwortung ohne Rechenschaftspflicht gegenüber Partnern.",
                        type2Perspective: "Polyamor betont ethische Verantwortung gegenüber allen Beziehungspartnern.",
                        dynamic: "Single lebt für sich, Polyamor für ein Netzwerk - unterschiedliche ethische Bezugsrahmen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung liegt primär bei sich selbst und eigenen Lebensentscheidungen.",
                        type2Perspective: "Verantwortung erstreckt sich auf mehrere Partner und deren emotionale Bedürfnisse.",
                        dynamic: "Einzelverantwortung vs. Netzwerkverantwortung - fundamental verschiedene Komplexitätsgrade."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Singles meiden emotionale Verschmelzung zugunsten von Selbstgenügsamkeit.",
                        type2Perspective: "Polyamor sucht emotionale Tiefe mit mehreren Menschen gleichzeitig.",
                        dynamic: "Singles wahren Distanz, Polyamor sucht Nähe - aber verteilt auf mehrere Personen."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe ist für Singles optional und situativ, nicht strukturell verankert.",
                        type2Perspective: "Polyamor hat oft hohe physische Nähe-Bedürfnisse zu mehreren Partnern.",
                        dynamic: "Singles regulieren Nähe selbst, Polyamor jongliert Nähe-Bedürfnisse im Netzwerk."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Singles brauchen viel Raum und sind geübt darin, diesen zu verteidigen.",
                        type2Perspective: "Polyamor gibt Raum durch verteilte Aufmerksamkeit auf mehrere Partner.",
                        dynamic: "Beide können Raum geben - Single durch Abwesenheit, Polyamor durch Verteilung."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Maximale Freiheit ohne Kompromisse - Singles gestalten ihr Leben vollständig selbst.",
                        type2Perspective: "Freiheit innerhalb eines ethischen Beziehungsnetzwerks mit Absprachen.",
                        dynamic: "Absolute vs. verhandelte Freiheit - Singles haben mehr, müssen aber auf Beziehungstiefe verzichten."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Volle Entscheidungsautonomie ohne Rücksprache oder Kompromisse.",
                        type2Perspective: "Entscheidungsautonomie mit Transparenzpflicht gegenüber allen Partnern.",
                        dynamic: "Singles entscheiden allein, Polyamor kommuniziert - verschiedene Autonomie-Definitionen."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Singles respektieren Autonomie anderer, da sie selbst maximale Autonomie leben.",
                        type2Perspective: "Polyamor fördert aktiv die Autonomie aller Partner im Netzwerk.",
                        dynamic: "Passives Respektieren vs. aktives Fördern von Autonomie."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Singles kommunizieren situativ und bei Bedarf, ohne dauerhafte Verpflichtung.",
                        type2Perspective: "Polyamor erfordert tiefe, kontinuierliche Kommunikation mit allen Partnern.",
                        dynamic: "Verschiedene Kommunikationskulturen: Bedarfsorientiert vs. strukturell verankert."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Singles können Konflikte durch Rückzug vermeiden - keine Beziehungspflicht.",
                        type2Perspective: "Polyamor muss Konflikte aktiv lösen, um das Netzwerk zu erhalten.",
                        dynamic: "Exit-Option vs. Konfliktlösung als Notwendigkeit - sehr verschiedene Strategien."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz ist optional, da keine festen Beziehungspflichten bestehen.",
                        type2Perspective: "Maximale emotionale Transparenz als ethische Grundlage aller Beziehungen.",
                        dynamic: "Freiwillige vs. verpflichtende Transparenz - unterschiedliche Grundhaltungen."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Singles sind gesellschaftlich akzeptiert, wenn auch manchmal bedauert.",
                        type2Perspective: "Polyamor erfährt oft Stigmatisierung und Unverständnis.",
                        dynamic: "Single ist 'normal', Polyamor muss sich erklären - verschiedene gesellschaftliche Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Singles integrieren sich individuell und flexibel in soziale Kreise.",
                        type2Perspective: "Polyamor bringt komplexe Beziehungsstrukturen in soziale Kontexte ein.",
                        dynamic: "Einfache vs. komplexe soziale Integration - Singles haben es leichter."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Singles erleben mildes Stigma ('Wann heiratest du?'), aber keine starke Ablehnung.",
                        type2Perspective: "Polyamor muss aktiv mit Vorurteilen und Abwertung umgehen.",
                        dynamic: "Leichtes vs. starkes Stigma - Polyamor braucht mehr Resilienz."
                    }
                }
            },
            // Duo × Polyamor (maximaler Konflikt - Priorität)
            "duo-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo sieht Exklusivität als fundamentalen Ausdruck von Liebe und Verbindlichkeit.",
                        type2Perspective: "Polyamor versteht Liebe als nicht-begrenzte Ressource, die sich auf mehrere Menschen erstrecken kann.",
                        dynamic: "Fundamentaler Konflikt: Was für Duo Treue bedeutet, ist für Polyamor eine künstliche Beschränkung."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo bevorzugt das bewährte Zweiermodell und sieht wenig Grund zur Öffnung.",
                        type2Perspective: "Polyamor lebt aktiv ein alternatives Modell und hinterfragt Monogamie-Normen.",
                        dynamic: "Tradition vs. Alternative: Duo fragt 'Warum ändern?', Polyamor fragt 'Warum beschränken?'"
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Für Duo ist DIE Beziehung zentraler Lebensinhalt - 'Wir' als Einheit.",
                        type2Perspective: "Für Polyamor sind Beziehungen plural - mehrere gleichwertige 'Wirs'.",
                        dynamic: "Singuläres 'Wir' vs. plurales 'Wir' - grundverschiedene Beziehungsarchitekturen."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet exklusive emotionale und sexuelle Bindung an eine Person.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit, Transparenz und Einhalten von Absprachen - nicht Exklusivität.",
                        dynamic: "Maximaler Definitionskonflikt: Duo sieht Untreue, wo Polyamor Transparenz sieht."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen, Verbindlichkeit und Fokussierung auf einen Partner.",
                        type2Perspective: "Ethik basiert auf Ehrlichkeit, Konsens und Verantwortung gegenüber allen Beteiligten.",
                        dynamic: "Verschiedene ethische Fundamente: Exklusivitätsethik vs. Transparenzethik."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung konzentriert sich auf einen Partner und die gemeinsame Zukunft.",
                        type2Perspective: "Verantwortung verteilt sich auf mehrere Partner und komplexe Beziehungsdynamiken.",
                        dynamic: "Fokussierte vs. verteilte Verantwortung - unterschiedliche Kapazitätsanforderungen."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Duo strebt tiefe emotionale Verschmelzung mit einem Partner an.",
                        type2Perspective: "Polyamor erlebt emotionale Tiefe mit mehreren Menschen, aber weniger Verschmelzung pro Person.",
                        dynamic: "Intensive Tiefe zu einem vs. verteilte Tiefe zu mehreren - verschiedene emotionale Ökonomien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe fokussiert sich exklusiv auf den Partner.",
                        type2Perspective: "Physische Nähe verteilt sich auf mehrere Partner nach Bedarf und Absprache.",
                        dynamic: "Exklusive vs. geteilte Intimität - kann für Duo als Verlust erlebt werden."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Duo gibt Raum innerhalb der Partnerschaft, aber nicht für andere Beziehungen.",
                        type2Perspective: "Polyamor muss Raum für alle Partner schaffen und ausbalancieren.",
                        dynamic: "Raum für Individuum vs. Raum für andere Beziehungen - verschiedene Raumkonzepte."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert und gelebt.",
                        type2Perspective: "Individuelle Freiheit schließt Freiheit für mehrere Liebesbeziehungen ein.",
                        dynamic: "Paar-Freiheit vs. individuelle Beziehungsfreiheit - verschiedene Freiheitsbegriffe."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen werden als Paar getroffen.",
                        type2Perspective: "Individuelle Autonomie auch bei Beziehungsentscheidungen, mit Transparenz.",
                        dynamic: "Gemeinsame vs. individuelle Entscheidungsmacht - kann zu Konflikten führen."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie des Partners wird anerkannt, aber nicht für andere Beziehungen.",
                        type2Perspective: "Autonomie schließt explizit die Freiheit für weitere Liebesbeziehungen ein.",
                        dynamic: "Begrenzte vs. unbegrenzte Autonomie-Akzeptanz - Kernkonflikt dieser Kombination."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit einem Partner über alle Lebensaspekte.",
                        type2Perspective: "Tiefe Kommunikation mit mehreren Partnern, plus Meta-Kommunikation über Beziehungen.",
                        dynamic: "Verschiedene Kommunikationsanforderungen: Duo ist intensiv, Polyamor ist extensiv."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gelöst, ohne externe Beziehungen.",
                        type2Perspective: "Konflikte können mehrere Partner betreffen und erfordern komplexe Lösungen.",
                        dynamic: "Bilaterale vs. multilaterale Konfliktlösung - verschiedene Komplexitätsgrade."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz primär gegenüber dem einen Partner.",
                        type2Perspective: "Emotionale Transparenz gegenüber allen Partnern als ethische Basis.",
                        dynamic: "Duo kann Transparenz gegenüber 'Dritten' als Verrat empfinden - Polyamor als Grundlage."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo entspricht der gesellschaftlichen Norm und genießt volle Akzeptanz.",
                        type2Perspective: "Polyamor muss gegen Vorurteile und mangelndes Verständnis kämpfen.",
                        dynamic: "Norm vs. Abweichung - Duo hat soziale Vorteile, Polyamor soziale Hürden."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Duo wird als 'normales' Paar problemlos in alle Kontexte integriert.",
                        type2Perspective: "Polyamor muss erklären, verbergen oder mit Unverständnis umgehen.",
                        dynamic: "Reibungslose vs. erklärungsbedürftige Integration - verschiedene soziale Belastungen."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Duo erfährt kein Stigma, sondern gesellschaftliche Unterstützung.",
                        type2Perspective: "Polyamor muss aktiv mit Stigmatisierung und Diskriminierung umgehen.",
                        dynamic: "Privilegierte vs. marginalisierte Position - kann zu Unverständnis führen."
                    }
                }
            },
            // Duo-Flex × Solopoly (interessante Balance - Priorität)
            "duo_flex-solopoly": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo-Flex hält an einer Primärbeziehung fest, öffnet aber für Zusatzkontakte.",
                        type2Perspective: "Solopoly lehnt jede Form von Primärhierarchie ab - alle Beziehungen sind gleichwertig.",
                        dynamic: "Hierarchie vs. Gleichwertigkeit: Duo-Flex braucht einen Anker, Solopoly will keinen."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo-Flex ist offen, aber innerhalb eines strukturierten Rahmens mit Primärpartner.",
                        type2Perspective: "Solopoly lebt maximale Offenheit ohne Verpflichtung zu einer Hauptbeziehung.",
                        dynamic: "Gerahmte vs. ungerahmte Offenheit - beide alternativ, aber verschieden strukturiert."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Primärbeziehung ist Lebensinhalt, andere Kontakte sind Bereicherung.",
                        type2Perspective: "Alle Beziehungen sind Lebensbereiche, keiner ist zentraler Lebensinhalt.",
                        dynamic: "Zentrale vs. dezentrale Beziehungsarchitektur - verschiedene Lebensmodelle."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet Ehrlichkeit und Prioririsierung des Hauptpartners.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit gegenüber allen, ohne Hierarchie der Wichtigkeit.",
                        dynamic: "Hierarchische vs. egalitäre Treue-Definition - beide ehrlich, anders strukturiert."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik schützt die Primärbeziehung, Öffnungen erfolgen im Rahmen.",
                        type2Perspective: "Ethik behandelt alle Partner gleich, ohne Vorrang einer Beziehung.",
                        dynamic: "Schutzethik vs. Gleichheitsethik - verschiedene ethische Prioritäten."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Höchste Verantwortung gegenüber dem Primärpartner, dann anderen.",
                        type2Perspective: "Gleiche Verantwortung gegenüber allen Partnern, kein 'mehr' oder 'weniger'.",
                        dynamic: "Gestufte vs. gleiche Verantwortung - kann zu Missverständnissen führen."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Verschmelzung primär mit dem Hauptpartner.",
                        type2Perspective: "Solopoly meidet Verschmelzung bewusst, um Autonomie zu bewahren.",
                        dynamic: "Selektive Verschmelzung vs. generelle Distanz - verschiedene Nähe-Strategien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe hauptsächlich mit Primärpartner, situativ mit anderen.",
                        type2Perspective: "Physische Nähe gleichmäßig verteilt, kein 'Zuhause' bei einem Partner.",
                        dynamic: "Zentrierte vs. verteilte Intimität - verschiedene Nähe-Modelle."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum wird innerhalb der Primärbeziehung verhandelt.",
                        type2Perspective: "Raum ist strukturell gegeben durch separate Lebensräume.",
                        dynamic: "Verhandelter vs. struktureller Raum - Solopoly hat mehr eingebaute Distanz."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit innerhalb der Primärbeziehungs-Struktur.",
                        type2Perspective: "Maximale individuelle Freiheit als Grundprinzip des Lebens.",
                        dynamic: "Gerahmte vs. maximale Freiheit - verschiedene Autonomie-Level."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen mit Primärpartner, aber mehr Freiraum als Duo.",
                        type2Perspective: "Volle Entscheidungsautonomie, Transparenz statt Absprache.",
                        dynamic: "Abgestimmte vs. informierte Autonomie - verschiedene Entscheidungsprozesse."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie wird akzeptiert, solange die Primärbeziehung Priorität bleibt.",
                        type2Perspective: "Autonomie wird bedingungslos akzeptiert - keine Hierarchie-Erwartung.",
                        dynamic: "Bedingte vs. bedingungslose Autonomie-Akzeptanz."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit Primärpartner über alle Aspekte.",
                        type2Perspective: "Situative Kommunikationstiefe je nach Beziehung und Bedarf.",
                        dynamic: "Zentrierte vs. verteilte Kommunikationstiefe."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte primär im Kontext der Hauptbeziehung lösen.",
                        type2Perspective: "Konflikte individuell mit jedem Partner, ohne zentrale Instanz.",
                        dynamic: "Zentralisierte vs. dezentralisierte Konfliktlösung."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegenüber Primärpartner, selektiv gegenüber anderen.",
                        type2Perspective: "Gleichmäßige Transparenz gegenüber allen Partnern.",
                        dynamic: "Gestufte vs. gleiche Transparenz - verschiedene Informationsflüsse."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo-Flex kann als 'offene Ehe' noch relativ akzeptiert werden.",
                        type2Perspective: "Solopoly ist schwer zu erklären und wird oft missverstanden.",
                        dynamic: "Relativ akzeptiert vs. erklärungsbedürftig - verschiedene soziale Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Primärpaar wird integriert, Zusatzkontakte bleiben oft privat.",
                        type2Perspective: "Alle Beziehungen gleichwertig in soziale Kreise integrieren ist komplex.",
                        dynamic: "Einfachere vs. komplexere soziale Integration."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Mildes Stigma, wenn Öffnung bekannt wird.",
                        type2Perspective: "Stärkeres Stigma durch unkonventionelle Lebensform ohne 'Hauptpartner'.",
                        dynamic: "Verschiedene Stigma-Level - Solopoly ist gesellschaftlich unbekannter."
                    }
                }
            },
            // Polyamor × Polyamor (hohe Kompatibilität - Test)
            "polyamor-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Keine Exklusivitäts-Erwartung, Liebe wird als nicht-begrenzt verstanden.",
                        type2Perspective: "Gleiche Grundhaltung: Liebe zu mehreren Menschen ist möglich und ethisch.",
                        dynamic: "Volle Übereinstimmung: Beide verstehen und leben nicht-exklusive Liebe."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Lebt aktiv ein alternatives Beziehungsmodell.",
                        type2Perspective: "Teilt diese Lebensrealität und die damit verbundenen Werte.",
                        dynamic: "Maximale Synergie: Beide haben den gleichen Referenzrahmen für Beziehungen."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Beziehungen sind zentraler Lebensinhalt, aber als Netzwerk.",
                        type2Perspective: "Versteht und teilt diese Beziehungsarchitektur vollständig.",
                        dynamic: "Geteiltes Verständnis: Beziehungsnetzwerk als gemeinsamer Lebensraum."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = Ehrlichkeit, Transparenz, Einhalten von Agreements.",
                        type2Perspective: "Gleiche Definition von Treue, ohne Exklusivitätskomponente.",
                        dynamic: "Übereinstimmung bei einem der kritischsten Beziehungskonzepte."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Konsens, Kommunikation und Respekt.",
                        type2Perspective: "Teilt diese ethischen Grundlagen und praktiziert sie aktiv.",
                        dynamic: "Gemeinsame ethische Basis erleichtert Verhandlungen und Absprachen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung für ein Netzwerk von Beziehungen und Gefühlen.",
                        type2Perspective: "Versteht diese Komplexität und trägt sie mit.",
                        dynamic: "Geteilte Erfahrung mit der Komplexität polyamorer Verantwortung."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Tiefe mit mehreren Menschen, bewusst dosiert.",
                        type2Perspective: "Gleiche Erfahrung und Kompetenz im Umgang mit verteilter Intimität.",
                        dynamic: "Beide verstehen, wie Tiefe in einem Poly-Kontext funktioniert."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe verteilt sich auf mehrere Partner.",
                        type2Perspective: "Akzeptiert und praktiziert geteilte Intimität.",
                        dynamic: "Keine Eifersucht auf physische Nähe mit anderen - geteilte Norm."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum für andere Beziehungen ist selbstverständlich.",
                        type2Perspective: "Erwartet und gibt gleichermaßen Raum für das Beziehungsnetzwerk.",
                        dynamic: "Strukturelle Übereinstimmung: Beide brauchen und geben Beziehungs-Raum."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit für mehrere Liebesbeziehungen als Grundrecht.",
                        type2Perspective: "Teilt dieses Freiheitsverständnis vollständig.",
                        dynamic: "Keine Einschränkung der romantischen Freiheit - beidseitiges Verständnis."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Autonomie bei Beziehungsentscheidungen, mit Transparenzpflicht.",
                        type2Perspective: "Gleiche Balance zwischen Autonomie und Verantwortung.",
                        dynamic: "Geteilte Entscheidungskultur: Autonom, aber transparent."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Volle Akzeptanz der Beziehungsfreiheit des Partners.",
                        type2Perspective: "Erwartet und praktiziert die gleiche Akzeptanz.",
                        dynamic: "Wechselseitige Autonomie-Akzeptanz als Fundament der Beziehung."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation als Kernkompetenz polyanorer Beziehungen.",
                        type2Perspective: "Bringt gleiche Kommunikationsfähigkeiten und -erwartungen mit.",
                        dynamic: "Hohe Kommunikationskompetenz auf beiden Seiten - ideale Voraussetzung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Erfahrung mit komplexen, multilateralen Konflikten.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten Lösungsstrategien.",
                        dynamic: "Beide sind 'Poly-geprüft' in Konfliktsituationen - große Resilienz."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Maximale Transparenz als ethische Grundlage.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Praxis.",
                        dynamic: "Keine versteckten Emotionen, keine versteckten Beziehungen - klare Basis."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Muss mit gesellschaftlicher Stigmatisierung umgehen.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten Coping-Strategien.",
                        dynamic: "Gemeinsame Außenseiter-Position kann verbinden und stärken."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Komplexe Beziehungsstrukturen in soziale Kontexte einbringen.",
                        type2Perspective: "Versteht und teilt diese Herausforderung.",
                        dynamic: "Gegenseitige Unterstützung bei sozialer Navigation."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Aktiver Umgang mit Vorurteilen und Diskriminierung.",
                        type2Perspective: "Teilt diese Erfahrung und die Resilienz-Strategien.",
                        dynamic: "Gemeinsame Stärke gegen gesellschaftlichen Druck."
                    }
                }
            },
            // Duo × Duo (hohe Kompatibilität - Test)
            "duo-duo": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Exklusivität als fundamentaler Ausdruck von Liebe.",
                        type2Perspective: "Teilt dieses Verständnis von Exklusivität vollständig.",
                        dynamic: "Perfekte Übereinstimmung: Beide verstehen und wünschen Exklusivität."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Bevorzugt das klassische Zweiermodell.",
                        type2Perspective: "Gleiche Präferenz für monogame Partnerschaft.",
                        dynamic: "Geteilte Wertschätzung für traditionelles Beziehungsmodell."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Partnerschaft ist zentraler Lebensinhalt.",
                        type2Perspective: "Teilt diese Priorisierung der Beziehung.",
                        dynamic: "Gemeinsames 'Wir' als Lebensmittelpunkt - perfekte Synergie."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = exklusive emotionale und sexuelle Bindung.",
                        type2Perspective: "Gleiche Definition, gleiche Erwartung.",
                        dynamic: "Keine Definitions-Konflikte bei diesem zentralen Thema."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen und Verbindlichkeit.",
                        type2Perspective: "Teilt diese ethischen Grundwerte.",
                        dynamic: "Gemeinsame ethische Basis für eine stabile Partnerschaft."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Fokussierte Verantwortung füreinander.",
                        type2Perspective: "Gleiche Verantwortungsbereitschaft.",
                        dynamic: "Gegenseitige, konzentrierte Verantwortung - klare Struktur."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Wünscht tiefe emotionale Verschmelzung.",
                        type2Perspective: "Teilt dieses Bedürfnis nach Nähe und Verbundenheit.",
                        dynamic: "Beidseitiges Streben nach emotionaler Tiefe."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische Nähe exklusiv mit dem Partner.",
                        type2Perspective: "Gleiche Exklusivitäts-Erwartung bei Intimität.",
                        dynamic: "Keine Konkurrenz um Nähe - ungeteilte Aufmerksamkeit."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum innerhalb der Partnerschaft.",
                        type2Perspective: "Gleiche Balance zwischen Nähe und individuellem Raum.",
                        dynamic: "Ähnliche Raum-Bedürfnisse erleichtern das Zusammenleben."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert.",
                        type2Perspective: "Teilt dieses Verständnis von Paar-Freiheit.",
                        dynamic: "Gemeinsame Freiheits-Definition als 'Wir'."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen gemeinsam treffen.",
                        type2Perspective: "Gleiche Erwartung an gemeinsame Entscheidungsfindung.",
                        dynamic: "Geteilte Entscheidungsmacht ohne Autonomie-Konflikte."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie innerhalb des Paar-Rahmens.",
                        type2Perspective: "Gleiche Balance zwischen Individualität und Partnerschaft.",
                        dynamic: "Ähnliche Autonomie-Grenzen erleichtern das Zusammenleben."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation zu zweit.",
                        type2Perspective: "Gleicher Wunsch nach intensivem Austausch.",
                        dynamic: "Fokussierte, tiefe Kommunikation ohne Verteilung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gelöst.",
                        type2Perspective: "Gleiche Erwartung an bilaterale Konfliktlösung.",
                        dynamic: "Klare Konflikt-Struktur ohne externe Komplexität."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegenüber dem Partner.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Bereitschaft.",
                        dynamic: "Gegenseitige Offenheit ohne konkurrierende Loyalitäten."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Volle gesellschaftliche Akzeptanz.",
                        type2Perspective: "Teilt diese privilegierte Position.",
                        dynamic: "Keine externen Hürden durch gesellschaftliche Normen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Als Paar problemlos integriert.",
                        type2Perspective: "Gleiche einfache soziale Integration.",
                        dynamic: "Gesellschaftliche Normalität als gemeinsame Basis."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Kein Stigma, sondern gesellschaftliche Unterstützung.",
                        type2Perspective: "Teilt diese Stigma-freie Erfahrung.",
                        dynamic: "Kein externer Druck - Fokus auf die Beziehung selbst."
                    }
                }
            }
        };

        // Helper function to normalize tag names for lookup
        function normalizeTagName(tag) {
            return tag.toLowerCase()
                .replace(/ä/g, 'ae').replace(/ö/g, 'oe').replace(/ü/g, 'ue').replace(/ß/g, 'ss')
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
        }

        // Get tooltip content for a specific tag
        function getTagTooltip(type1Id, type2Id, category, tagName) {
            const normalizedTag = normalizeTagName(tagName);

            // Sort type IDs alphabetically for consistent key lookup
            const sortedTypes = [type1Id, type2Id].sort();
            const comboKey = sortedTypes.join('-');

            // Try to find specific tooltip
            const comboData = tagTooltipContent[comboKey];
            if (comboData && comboData[category] && comboData[category][normalizedTag]) {
                const tooltip = comboData[category][normalizedTag];
                const type1 = data.archetypes[type1Id];
                const type2 = data.archetypes[type2Id];

                // Swap perspectives if types were reordered
                if (sortedTypes[0] === type2Id) {
                    return {
                        type1Name: type1?.name || type1Id,
                        type2Name: type2?.name || type2Id,
                        type1Perspective: tooltip.type2Perspective,
                        type2Perspective: tooltip.type1Perspective,
                        dynamic: tooltip.dynamic
                    };
                }

                return {
                    type1Name: type1?.name || type1Id,
                    type2Name: type2?.name || type2Id,
                    type1Perspective: tooltip.type1Perspective,
                    type2Perspective: tooltip.type2Perspective,
                    dynamic: tooltip.dynamic
                };
            }

            // Fallback: Generate generic tooltip
            return generateFallbackTooltip(type1Id, type2Id, category, tagName);
        }

        // Generate fallback tooltip when no specific content exists
        function generateFallbackTooltip(type1Id, type2Id, category, tagName) {
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const type1Def = archetypeDefinitions[type1Id];
            const type2Def = archetypeDefinitions[type2Id];

            const interactionKey = `${type1Id}_${type2Id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const catScore = scores[category]?.value || 50;

            // Generate context-aware fallback
            let dynamicText = '';
            if (catScore >= 85) {
                dynamicText = `Hohe Übereinstimmung (${catScore}%) in diesem Bereich - beide Typen haben ähnliche Ansätze.`;
            } else if (catScore >= 70) {
                dynamicText = `Moderate Übereinstimmung (${catScore}%) - einige gemeinsame Grundlagen, aber auch Unterschiede.`;
            } else if (catScore >= 50) {
                dynamicText = `Mittlere Kompatibilität (${catScore}%) - deutliche Unterschiede, die Kompromisse erfordern.`;
            } else {
                dynamicText = `Herausfordernde Konstellation (${catScore}%) - grundlegend verschiedene Ansätze in diesem Bereich.`;
            }

            return {
                type1Name: type1?.name || type1Id,
                type2Name: type2?.name || type2Id,
                type1Perspective: type1Def?.keyPrinciples?.[0] || `${type1?.name || type1Id} hat eigene Präferenzen in diesem Bereich.`,
                type2Perspective: type2Def?.keyPrinciples?.[0] || `${type2?.name || type2Id} hat eigene Präferenzen in diesem Bereich.`,
                dynamic: dynamicText
            };
        }

        // Category descriptions loaded from data
        let categoryDescriptions = {};

        async function loadData() {
            try {
                const response = await fetch('archetype-matrix.json');
                data = await response.json();
                // Load category descriptions from data
                if (data.categories) {
                    categoryDescriptions = data.categories;
                }
            } catch (error) {
                console.error('Error loading data:', error);
                data = getFallbackData();
            }
            initApp();
        }

        function getFallbackData() {
            return {
                archetypes: {
                    single: { id: "single", name: "Single", color: "#E63946", shortDescription: "Fokus auf Selbstentwicklung", pro: [], contra: [], pathos: "", logos: "" },
                    duo: { id: "duo", name: "Duo", color: "#E84393", shortDescription: "Klassische monogame Zweierbeziehung", pro: [], contra: [], pathos: "", logos: "" },
                    duo_flex: { id: "duo_flex", name: "Duo-Flex", color: "#FF6B6B", shortDescription: "Primär Zweierbeziehung mit situativer Öffnung", pro: [], contra: [], pathos: "", logos: "" },
                    solopoly: { id: "solopoly", name: "Solopoly", color: "#2A9D8F", shortDescription: "Polyamor mit Autonomie", pro: [], contra: [], pathos: "", logos: "" },
                    poly_hedo: { id: "poly_hedo", name: "Poly Hedo", color: "#9B5DE5", shortDescription: "Lustorientierte Mehrfachbeziehungen", pro: [], contra: [], pathos: "", logos: "" },
                    polyamor: { id: "polyamor", name: "Polyamor", color: "#F4A261", shortDescription: "Strukturierte Mehrfachbeziehungen", pro: [], contra: [], pathos: "", logos: "" }
                },
                categories: {},
                interactions: {},
                aggregatedMatrix: { rows: [], cols: [], values: [] }
            };
        }

        function initApp() {
            document.getElementById('archetypeSelect').addEventListener('change', (e) => {
                currentArchetype = e.target.value;
                updateAll();
            });

            // Carousel scroll detection
            const carousel = document.getElementById('carousel');
            carousel.addEventListener('scroll', updateNavDots);

            updateAll();
        }

        function updateAll() {
            updateTheme();
            updateMyType();
            updatePartnerSelector();
            updateTopAndChallenge();
            updatePartnerView();
            updateLegendCategories();
        }

        function updateTheme() {
            document.body.className = `theme-${currentArchetype}`;
        }

        function updateMyType() {
            const arch = data.archetypes[currentArchetype];
            if (!arch) return;

            document.getElementById('myTypeIcon').textContent = icons[currentArchetype];
            document.getElementById('myTypeIcon').style.background = arch.color;
            document.getElementById('myTypeName').textContent = arch.name;
            document.getElementById('myTypeName').style.color = arch.color;
            document.getElementById('myTypeDesc').textContent = arch.shortDescription || '';
            document.getElementById('myTypeTooltip').textContent = getShortDef(currentArchetype);

            const proList = document.getElementById('myTypePro');
            proList.innerHTML = (arch.pro || []).slice(0, 4).map(p => `<li>${p}</li>`).join('');

            const contraList = document.getElementById('myTypeContra');
            contraList.innerHTML = (arch.contra || []).slice(0, 4).map(c => `<li>${c}</li>`).join('');

            document.getElementById('myTypePathos').textContent = arch.pathos || '';
            document.getElementById('myTypeLogos').textContent = arch.logos || '';
        }

        // Fixed archetype order to ensure all types are shown
        const archetypeOrder = ['single', 'duo', 'duo_flex', 'solopoly', 'poly_hedo', 'polyamor'];

        function updatePartnerSelector() {
            const container = document.getElementById('partnerSelector');
            // Show ALL archetypes as partner options (including own type for self-matching)
            const allPartners = archetypeOrder
                .map(id => data.archetypes[id])
                .filter(arch => arch); // Remove any undefined

            if (!allPartners.find(o => o.id === selectedPartner)) {
                selectedPartner = allPartners[0]?.id || 'duo';
            }

            container.innerHTML = allPartners.map(arch => `
                <button class="partner-btn ${arch.id === selectedPartner ? 'active' : ''}"
                        onclick="selectPartner('${arch.id}')"
                        data-id="${arch.id}">
                    <span class="dot" style="background: ${arch.color}"></span>
                    ${arch.name}
                </button>
            `).join('');
        }

        function selectPartner(partnerId) {
            selectedPartner = partnerId;
            document.querySelectorAll('.partner-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.id === partnerId);
            });
            updatePartnerView();
        }

        function updateTopAndChallenge() {
            // Include all types (including self) for top match and challenge
            const others = archetypeOrder;
            let topMatch = { id: null, score: 0 };
            let challenge = { id: null, score: 100 };

            others.forEach(otherId => {
                const key = `${currentArchetype}_${otherId}`;
                const interaction = data.interactions[key];
                const score = interaction?.overall || 0;

                if (score > topMatch.score) {
                    topMatch = { id: otherId, score };
                }
                if (score < challenge.score) {
                    challenge = { id: otherId, score };
                }
            });

            // Store for modal access
            currentTopMatch = topMatch;
            currentChallenge = challenge;

            const myArch = data.archetypes[currentArchetype];

            if (topMatch.id) {
                const arch = data.archetypes[topMatch.id];
                document.getElementById('topMatchDot').style.background = arch.color;
                document.getElementById('topMatchName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('topMatchScore').textContent = topMatch.score + '%';
            }

            if (challenge.id) {
                const arch = data.archetypes[challenge.id];
                document.getElementById('challengeDot').style.background = arch.color;
                document.getElementById('challengeName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('challengeScore').textContent = challenge.score + '%';
            }
        }

        function updatePartnerView() {
            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};

            document.getElementById('myTypeNameDisplay').textContent = myArch?.name || '...';
            document.getElementById('partnerNameDisplay').textContent = partnerArch?.name || '...';
            document.getElementById('myTypeTooltipPage3').textContent = getShortDef(currentArchetype);
            document.getElementById('partnerTooltipPage3').textContent = getShortDef(selectedPartner);

            const score = interaction.overall || 0;
            const scoreEl = document.getElementById('overallScore');
            scoreEl.textContent = score + '%';
            scoreEl.style.color = getScoreColor(score);

            drawRadarChart(interaction.scores || {}, partnerArch?.color || '#457B9D');
            updateCategoryBars(interaction.scores || {});

            const proList = document.getElementById('partnerPro');
            proList.innerHTML = (interaction.pro || []).map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';

            const contraList = document.getElementById('partnerContra');
            contraList.innerHTML = (interaction.contra || []).map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';
        }

        function drawRadarChart(scores, color) {
            const svg = document.getElementById('radarChart');
            const cx = 140, cy = 120, maxR = 90;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const n = categories.length;

            let html = '';

            for (let r = 18; r <= maxR; r += 18) {
                html += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
            }

            categories.forEach((cat, i) => {
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * maxR;
                const y = cy + Math.sin(angle) * maxR;
                const labelX = cx + Math.cos(angle) * (maxR + 18);
                const labelY = cy + Math.sin(angle) * (maxR + 18);

                html += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
                html += `<text x="${labelX}" y="${labelY}" fill="var(--text-muted)" font-size="10" text-anchor="middle" dominant-baseline="middle">${cat}</text>`;
            });

            const points = categories.map((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                return `${cx + Math.cos(angle) * r},${cy + Math.sin(angle) * r}`;
            }).join(' ');

            html += `<polygon points="${points}" fill="${color}33" stroke="${color}" stroke-width="2"/>`;

            categories.forEach((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;
                html += `<circle cx="${x}" cy="${y}" r="4" fill="${color}"/>`;
            });

            svg.innerHTML = html;
        }

        function updateCategoryBars(scores) {
            const container = document.getElementById('categoryBars');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            container.innerHTML = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                return `
                    <div class="category-row" onclick="openSingleCategoryModal('${cat}')">
                        <span class="category-label">${cat}</span>
                        <div class="category-bar-wrap">
                            <div class="category-bar-container">
                                <div class="category-bar ${barClass}" style="width: ${value}%">
                                    <span class="category-bar-value">${value}%</span>
                                </div>
                            </div>
                            <div class="category-name">${name}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getScoreColor(score) {
            if (score >= 78) return '#00cec9';
            if (score >= 70) return '#27ae60';
            if (score >= 60) return '#f39c12';
            return '#e74c3c';
        }

        function getBarClass(value) {
            if (value >= 78) return 'bar-excellent';
            if (value >= 70) return 'bar-good';
            if (value >= 60) return 'bar-medium';
            return 'bar-low';
        }

        function toggleCollapsible(id) {
            document.getElementById(id).classList.toggle('open');
        }

        function scrollToCard(index) {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            carousel.scrollTo({ left: cardWidth * index, behavior: 'smooth' });
        }

        const TOTAL_PAGES = 4;

        function updateNavDots() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);

            document.querySelectorAll('.nav-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentCard);
            });

            // Update arrow states
            const arrows = document.querySelectorAll('.nav-arrow');
            if (arrows.length >= 2) {
                arrows[0].disabled = currentCard === 0;
                arrows[1].disabled = currentCard === TOTAL_PAGES - 1;
            }

            // Load feedback when on page 4
            if (currentCard === 3) {
                loadFeedback();
            }
        }

        function navigatePrev() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard > 0) {
                scrollToCard(currentCard - 1);
            }
        }

        function navigateNext() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard < TOTAL_PAGES - 1) {
                scrollToCard(currentCard + 1);
            }
        }

        // Legend Categories
        function updateLegendCategories() {
            const container = document.getElementById('legendCategories');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            // Get current interaction scores
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const myName = myArch?.name || currentArchetype;
            const partnerName = partnerArch?.name || selectedPartner;

            // Show which combination is displayed
            const headerText = currentArchetype === selectedPartner
                ? `${myName} (Ich) mit ${myName}`
                : `${myName} (Ich) mit ${partnerName}`;

            container.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: var(--bg-dark); border-radius: 10px; text-align: center;">
                    <span style="color: var(--text-muted); font-size: var(--font-sm);">Aktuelle Auswahl:</span>
                    <div style="color: var(--primary); font-weight: 600; font-size: var(--font-base);">${headerText}</div>
                </div>
            ` + categories.map(cat => {
                const catData = categoryDescriptions[cat] || {};
                const name = catData.name || categoryNames[cat] || cat;
                const desc = catData.description || 'Beschreibung nicht verfügbar';
                const value = scores[cat]?.value || 0;
                const scoreColor = getScoreColor(value);

                return `
                    <div class="legend-category-item" onclick="openSingleCategoryModal('${cat}')">
                        <div class="legend-category-letter">${cat}</div>
                        <div class="legend-category-content">
                            <div class="legend-category-name">${name}</div>
                            <div class="legend-category-desc">${desc}</div>
                        </div>
                        <div style="font-weight: 700; font-size: var(--font-md); color: ${scoreColor}; min-width: 50px; text-align: right;">${value}%</div>
                    </div>
                `;
            }).join('');
        }

        // Modal Functions
        function openCategoryModal() {
            // Reset modal context when opening directly (uses page 2 selection)
            modalContextPartner = null;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            document.getElementById('modalTitle').textContent = 'Alle Kategorien';
            document.getElementById('modalBody').innerHTML = categories.map(cat => getCategoryModalContent(cat)).join('');
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        let currentModalCategory = 'A'; // Track current category for navigation

        function openSingleCategoryModal(category) {
            currentModalCategory = category;
            // Don't reset modalContextPartner here - it may be set from match modal
            const catData = categoryDescriptions[category] || {};
            const name = catData.name || categoryNames[category] || category;
            document.getElementById('modalTitle').textContent = `Kategorie ${category}`;
            document.getElementById('modalBody').innerHTML = getCategoryModalContent(category);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function navigateCategoryPrev() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : categories.length - 1;
            openSingleCategoryModal(categories[prevIndex]);
        }

        function navigateCategoryNext() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const nextIndex = currentIndex < categories.length - 1 ? currentIndex + 1 : 0;
            openSingleCategoryModal(categories[nextIndex]);
        }

        function getCategoryModalContent(cat) {
            const catData = categoryDescriptions[cat] || {};
            const name = catData.name || categoryNames[cat] || cat;
            const desc = catData.description || 'Beschreibung nicht verfügbar';
            const subDims = catData.subDimensions || [];

            // Use modalContextPartner if set (from match modal), otherwise use selectedPartner (from page 2)
            const partnerId = modalContextPartner || selectedPartner;
            const interactionKey = `${currentArchetype}_${partnerId}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const value = scores[cat]?.value || 0;
            const scoreColor = getScoreColor(value);
            const barClass = getBarClass(value);

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[partnerId];
            const comboText = `${myArch?.name || '?'} + ${partnerArch?.name || '?'}`;
            const contextText = `${comboText} | ${name}`;

            // Get category position for navigation
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const catIndex = categories.indexOf(cat);
            const prevCat = categories[catIndex > 0 ? catIndex - 1 : categories.length - 1];
            const nextCat = categories[catIndex < categories.length - 1 ? catIndex + 1 : 0];
            const prevName = categoryNames[prevCat] || prevCat;
            const nextName = categoryNames[nextCat] || nextCat;

            return `
                <div class="category-nav-row">
                    <button class="category-nav-btn" onclick="navigateCategoryPrev()">
                        ‹ ${prevCat}
                    </button>
                    <span class="category-nav-indicator">${catIndex + 1} / 6</span>
                    <button class="category-nav-btn" onclick="navigateCategoryNext()">
                        ${nextCat} ›
                    </button>
                </div>

                <div class="modal-feedback-btn" onclick="openFeedbackModalWithContext('${contextText}')">
                    💬 Feedback zu ${comboText} | ${name}
                </div>

                <div class="modal-category">
                    <div class="modal-category-header">
                        <div class="modal-category-letter">${cat}</div>
                        <div class="modal-category-name">${name}</div>
                    </div>
                    <div class="match-modal-score" style="margin: 12px 0;">
                        <span class="match-modal-score-label">${comboText}</span>
                        <span class="match-modal-score-value" style="color: ${scoreColor}">${value}%</span>
                    </div>
                    <div class="modal-category-desc">${desc}</div>
                    ${subDims.length > 0 ? `
                        <div class="modal-subdimensions">
                            ${subDims.map(sd => renderTagWithTooltip(sd, cat, currentArchetype, partnerId)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Render a tag with tooltip
        function renderTagWithTooltip(tagName, category, type1Id, type2Id) {
            const tooltip = getTagTooltip(type1Id, type2Id, category, tagName);
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const color1 = type1?.color || 'var(--primary)';
            const color2 = type2?.color || 'var(--primary)';

            // Build type switcher options
            const allTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type1Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'ich', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            const partnerTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type2Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'partner', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            return `
                <span class="tag-tooltip-container">
                    <span class="modal-subdim-tag" onclick="openTagTooltip(this.parentElement, '${category}')">${tagName}</span>
                    <div class="tag-tooltip">
                        <button class="tag-tooltip-close" onclick="closeTagTooltip()">&times;</button>
                        <div class="tag-tooltip-header">${tagName}</div>

                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Ich:</span>
                            ${allTypes}
                        </div>
                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Partner:</span>
                            ${partnerTypes}
                        </div>

                        <div class="tag-tooltip-body">
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color1}">${tooltip.type1Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type1Perspective}</span>
                            </div>
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color2}">${tooltip.type2Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type2Perspective}</span>
                            </div>
                            <div class="tag-tooltip-dynamic">${tooltip.dynamic}</div>
                        </div>
                    </div>
                </span>
            `;
        }

        // Switch type from tooltip and refresh modal
        function switchTooltipType(typeId, role, category) {
            if (role === 'ich') {
                currentArchetype = typeId;
                // Update main UI
                document.getElementById('archetypeSelect').value = typeId;
                updateTheme();
                updateMyType();
                updatePartnerSelector();
                updateTopAndChallenge();
                updatePartnerView();
            } else {
                selectedPartner = typeId;
                modalContextPartner = typeId;
                // Update partner selection buttons
                document.querySelectorAll('.partner-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.id === typeId);
                });
                updatePartnerView();
            }

            // Refresh the category modal with new types
            openSingleCategoryModal(category);
        }

        // Active tooltip tracking
        let activeTooltipElement = null;

        // Open tag tooltip on click
        function openTagTooltip(container, category) {
            // Close any open tooltip first
            closeTagTooltip();

            const tooltip = container.querySelector('.tag-tooltip');
            const tag = container.querySelector('.modal-subdim-tag');
            if (!tooltip || !tag) return;

            activeTooltipElement = tooltip;
            tooltip.classList.add('active');

            // Position in center of screen
            const tooltipWidth = Math.min(360, window.innerWidth * 0.92);
            const left = (window.innerWidth - tooltipWidth) / 2;
            const top = Math.max(20, (window.innerHeight - 400) / 2);

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.style.width = tooltipWidth + 'px';
        }

        // Close tag tooltip
        function closeTagTooltip() {
            if (activeTooltipElement) {
                activeTooltipElement.classList.remove('active');
                activeTooltipElement = null;
            }
            // Also close any other open tooltips
            document.querySelectorAll('.tag-tooltip.active').forEach(t => t.classList.remove('active'));
        }

        function closeCategoryModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('categoryModal').classList.remove('active');
            document.body.style.overflow = '';
            // Reset modal context when closing
            modalContextPartner = null;
        }

        // Definition Modal Functions
        function openDefinitionModal(archetypeId) {
            const def = archetypeDefinitions[archetypeId];
            if (!def) return;

            const arch = data.archetypes[archetypeId];
            const color = arch?.color || 'var(--primary)';
            const icon = icons[archetypeId] || '?';

            document.getElementById('definitionModalTitle').innerHTML = `
                <span style="color: ${color}">${icon}</span> ${def.name}
            `;

            document.getElementById('definitionModalBody').innerHTML = `
                <div class="definition-long">${def.longDef}</div>

                <div class="definition-section">
                    <div class="definition-section-title">Kernprinzipien</div>
                    <ul class="definition-list principles">
                        ${def.keyPrinciples.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Das ist NICHT dasselbe wie</div>
                    <ul class="definition-list not-same">
                        ${def.notTheSameAs.map(n => `<li>${n}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Varianten</div>
                    <ul class="definition-list variants">
                        ${def.variants.map(v => `<li>${v}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDefinitionModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('definitionModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Get short definition for tooltip
        function getShortDef(archetypeId) {
            return archetypeDefinitions[archetypeId]?.shortDef || '';
        }

        // Store current match data for modal access
        let currentTopMatch = { id: null, score: 0 };
        let currentChallenge = { id: null, score: 0 };
        let modalContextPartner = null; // Track which partner to use in category modal

        // Match Modal Functions
        function openMatchModal(type) {
            const matchData = type === 'top' ? currentTopMatch : currentChallenge;
            if (!matchData.id) return;

            // Set the modal context to use this match's partner
            modalContextPartner = matchData.id;

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[matchData.id];
            const interactionKey = `${currentArchetype}_${matchData.id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const title = type === 'top' ? 'Top Match' : 'Challenge';
            const scoreColor = getScoreColor(matchData.score);

            document.getElementById('modalTitle').textContent = `${myArch.name} + ${partnerArch.name}`;
            document.getElementById('modalBody').innerHTML = getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch) {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const overall = interaction.overall || 0;
            const isIdenticalType = myArch.id === partnerArch.id;

            const categoryBars = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                // Special note for identical types on category A (Beziehungsphilosophie)
                const isPhilosophyCategory = cat === 'A' && isIdenticalType;
                const specialNote = isPhilosophyCategory
                    ? '<div style="font-size: 10px; color: var(--success); margin-top: 2px;">Identische Grundüberzeugung</div>'
                    : '';

                return `
                    <div class="match-modal-bar-row clickable" onclick="openSingleCategoryModal('${cat}')">
                        <span class="match-modal-bar-label">${cat}</span>
                        <div class="match-modal-bar-container">
                            <div class="match-modal-bar ${barClass}" style="width: ${value}%">
                                <span class="match-modal-bar-value">${value}%</span>
                            </div>
                            ${specialNote}
                        </div>
                        <span class="match-modal-bar-name">${name}</span>
                    </div>
                `;
            }).join('');

            const proItems = (interaction.pro || []).map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';
            const contraItems = (interaction.contra || []).map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';

            // Special banner for identical types
            const identicalTypeBanner = isIdenticalType ? `
                <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(46, 204, 113, 0.05));
                            border: 1px solid var(--success); border-radius: 10px; padding: 12px; margin-bottom: 15px; text-align: center;">
                    <div style="font-weight: 600; color: var(--success); margin-bottom: 4px;">✓ Identischer Beziehungstyp</div>
                    <div style="font-size: var(--font-sm); color: var(--text-secondary);">
                        Ihr teilt dieselbe Grundüberzeugung über Beziehungen
                    </div>
                </div>
            ` : '';

            const comboText = `${myArch.name} + ${partnerArch.name}`;
            const myDef = archetypeDefinitions[myArch.id]?.shortDef || '';
            const partnerDef = archetypeDefinitions[partnerArch.id]?.shortDef || '';

            return `
                <div class="modal-feedback-btn" onclick="openFeedbackModalWithContext('${comboText}')">
                    💬 Feedback zu ${comboText}
                </div>

                <div class="match-modal-header">
                    <div class="match-modal-icon" style="background: ${partnerArch.color}">${icons[partnerArch.id]}</div>
                    <div class="match-modal-info">
                        <h3 style="color: ${partnerArch.color}">
                            ${partnerArch.name}
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" title="Definition anzeigen">ℹ</span>
                        </h3>
                        <p>${partnerArch.shortDescription || ''}</p>
                    </div>
                </div>

                ${identicalTypeBanner}

                <div class="type-definitions-compact" style="background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 15px; font-size: var(--font-sm);">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${myArch.color}; font-weight: 600;">${icons[myArch.id]} ${myArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${myArch.id}')" style="margin-left: 4px;">ℹ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${myDef}</div>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${partnerArch.color}; font-weight: 600;">${icons[partnerArch.id]} ${partnerArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" style="margin-left: 4px;">ℹ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${partnerDef}</div>
                        </div>
                    </div>
                </div>

                <div class="match-modal-score">
                    <span class="match-modal-score-label">Kompatibilität ${isIdenticalType ? '(gleicher Typ)' : 'mit ' + myArch.name}</span>
                    <span class="match-modal-score-value" style="color: ${scoreColor}">${overall}%</span>
                </div>

                <div class="match-modal-categories">
                    <div class="match-modal-categories-title">Kategorie-Bewertungen</div>
                    ${categoryBars}
                </div>

                <div class="match-modal-section pro">
                    <div class="match-modal-section-title">✓ Was funktioniert</div>
                    <ul class="match-modal-list">${proItems}</ul>
                </div>

                <div class="match-modal-section contra">
                    <div class="match-modal-section-title">✗ Herausforderungen</div>
                    <ul class="match-modal-list">${contraItems}</ul>
                </div>
            `;
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCategoryModal();
                closeFeedbackModal();
            }
        });

        // ==========================================
        // FEEDBACK SYSTEM
        // ==========================================

        // Google Apps Script URL für Feedback
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwSpnFIsm6KNMiyZSfLzDtuPBUVxYBEEbx5pKgw37LZIFCutx4ugWau8CUWs_cB_YIl/exec';

        let feedbackData = [];
        let feedbackRatings = { verstand: 0, gefuehl: 0 };
        let replyToId = null; // For reply functionality

        // Advanced filter state
        let feedbackFilters = {
            search: '',
            myType: 'all',
            partnerType: 'all',
            category: 'all',
            sort: 'newest'
        };

        // Get current context ID based on what's visible
        function getCurrentContextId() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);

            const myType = currentArchetype.toUpperCase();
            const partner = selectedPartner.toUpperCase();

            switch(currentCard) {
                case 0:
                    return `S1-${myType}`;
                case 1:
                    return `S2-${myType}-${partner}`;
                case 2:
                    return `S3`;
                case 3:
                    return `S4`;
                default:
                    return `S${currentCard + 1}`;
            }
        }

        // Get context ID for modals
        function getModalContextId() {
            const categoryModal = document.getElementById('categoryModal');
            if (categoryModal.classList.contains('active')) {
                const modalTitle = document.getElementById('modalTitle').textContent;
                const myArch = data.archetypes[currentArchetype];
                const partnerId = modalContextPartner || selectedPartner;
                const partnerArch = data.archetypes[partnerId];
                const combo = `${myArch?.name || '?'} (Ich) mit ${partnerArch?.name || '?'}`;

                if (modalTitle.includes('Kategorie')) {
                    const cat = modalTitle.replace('Kategorie ', '').trim();
                    const catName = categoryNames[cat] || cat;
                    return `${combo} | ${catName}`;
                } else if (modalTitle.includes('+')) {
                    // Match modal (Top Match or Challenge)
                    const matchType = (currentTopMatch.id && modalContextPartner === currentTopMatch.id) ? 'Top Match' : 'Challenge';
                    return `${combo} | ${matchType}`;
                }
            }
            return getCurrentContextId();
        }

        // Open feedback modal
        function openFeedbackModal() {
            replyToId = null; // Reset reply state for new feedback
            const contextId = getModalContextId();
            document.getElementById('feedbackContextId').textContent = contextId;
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackTitle').value = '';
            document.getElementById('feedbackComment').value = '';
            feedbackRatings = { verstand: 0, gefuehl: 0 };
            updateStarDisplay('ratingVerstand', 0);
            updateStarDisplay('ratingGefuehl', 0);
        }

        // Open feedback modal with specific context
        function openFeedbackModalWithContext(contextText) {
            replyToId = null;
            document.getElementById('feedbackContextId').textContent = contextText;
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackTitle').value = '';
            document.getElementById('feedbackComment').value = '';
            feedbackRatings = { verstand: 0, gefuehl: 0 };
            updateStarDisplay('ratingVerstand', 0);
            updateStarDisplay('ratingGefuehl', 0);
        }

        function closeFeedbackModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('feedbackModal').classList.remove('active');
            document.body.style.overflow = '';
            replyToId = null; // Reset on close
        }

        // Star rating functionality
        function updateStarDisplay(containerId, value) {
            const container = document.getElementById(containerId);
            container.querySelectorAll('.star').forEach((star, i) => {
                star.classList.toggle('active', i < value);
            });
        }

        function initStarRatings() {
            ['ratingVerstand', 'ratingGefuehl'].forEach(containerId => {
                const container = document.getElementById(containerId);
                const ratingKey = containerId === 'ratingVerstand' ? 'verstand' : 'gefuehl';

                container.querySelectorAll('.star').forEach(star => {
                    star.addEventListener('click', () => {
                        const value = parseInt(star.dataset.value);
                        feedbackRatings[ratingKey] = value;
                        updateStarDisplay(containerId, value);
                    });

                    star.addEventListener('mouseenter', () => {
                        const value = parseInt(star.dataset.value);
                        container.querySelectorAll('.star').forEach((s, i) => {
                            s.style.color = i < value ? '#f1c40f' : '';
                        });
                    });

                    star.addEventListener('mouseleave', () => {
                        container.querySelectorAll('.star').forEach((s, i) => {
                            s.style.color = i < feedbackRatings[ratingKey] ? '#f1c40f' : '';
                        });
                    });
                });
            });
        }

        // Submit feedback
        // Generate unique ID
        function generateFeedbackId() {
            return 'fb_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        async function submitFeedback() {
            const name = document.getElementById('feedbackName').value.trim();
            const titel = document.getElementById('feedbackTitle').value.trim();
            const kommentar = document.getElementById('feedbackComment').value.trim();
            const kontextId = replyToId
                ? document.getElementById('feedbackContextId').textContent
                : getModalContextId();

            // Validation
            if (!name) {
                alert('Bitte gib deinen Namen/Kürzel ein.');
                return;
            }
            if (!titel) {
                alert('Bitte gib einen Titel ein.');
                return;
            }

            const feedbackEntry = {
                id: generateFeedbackId(),
                kontextId,
                name,
                titel,
                kommentar,
                verstand: feedbackRatings.verstand,
                gefuehl: feedbackRatings.gefuehl,
                antwortAuf: replyToId || ''
            };

            const submitBtn = document.getElementById('feedbackSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sende...';

            try {
                if (GOOGLE_SCRIPT_URL) {
                    // Send to Google Sheets
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(feedbackEntry)
                    });
                }

                // Also save locally as backup
                saveLocalFeedback(feedbackEntry);

                alert('Danke für dein Feedback!');
                replyToId = null; // Reset reply state
                closeFeedbackModal();

                // Reload feedback to show the new entry
                setTimeout(() => loadFeedback(), 500);

            } catch (error) {
                console.error('Feedback error:', error);
                // Save locally on error
                saveLocalFeedback(feedbackEntry);
                alert('Feedback lokal gespeichert. (Server nicht erreichbar)');
                replyToId = null;
                closeFeedbackModal();
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Senden';
        }

        // Local storage backup
        function saveLocalFeedback(entry) {
            const stored = JSON.parse(localStorage.getItem('tiage_feedback') || '[]');
            entry.timestamp = new Date().toISOString();
            stored.unshift(entry);
            localStorage.setItem('tiage_feedback', JSON.stringify(stored));
        }

        function getLocalFeedback() {
            return JSON.parse(localStorage.getItem('tiage_feedback') || '[]');
        }

        // Load and display feedback
        async function loadFeedback() {
            const container = document.getElementById('feedbackList');

            try {
                if (GOOGLE_SCRIPT_URL) {
                    // Try to load from Google Sheets
                    const response = await fetch(GOOGLE_SCRIPT_URL);
                    const serverData = await response.json();
                    feedbackData = serverData.reverse(); // Newest first
                } else {
                    // Use local data only
                    feedbackData = getLocalFeedback();
                }
            } catch (error) {
                console.error('Load feedback error:', error);
                // Fallback to local
                feedbackData = getLocalFeedback();
            }

            // Populate type filter dropdowns
            populateTypeFilters();
            renderFeedbackList();
        }

        // Populate type dropdowns for filters
        function populateTypeFilters() {
            const archetypes = Object.values(data?.archetypes || {});
            const myTypeSelect = document.getElementById('filterMyType');
            const partnerTypeSelect = document.getElementById('filterPartnerType');

            const options = archetypes.map(a =>
                `<option value="${a.id}">${a.name}</option>`
            ).join('');

            myTypeSelect.innerHTML = `<option value="all">Alle Typen</option>${options}`;
            partnerTypeSelect.innerHTML = `<option value="all">Alle Partner</option>${options}`;
        }

        function renderFeedbackList() {
            const container = document.getElementById('feedbackList');

            // Apply all filters
            let filtered = feedbackData.filter(f => {
                const kontextId = (f.KontextID || f.kontextId || '').toLowerCase();
                const name = (f.Name || f.name || '').toLowerCase();
                const titel = (f.Titel || f.titel || '').toLowerCase();
                const kommentar = (f.Kommentar || f.kommentar || '').toLowerCase();
                const antwortAuf = f.AntwortAuf || f.antwortAuf || '';

                // Skip replies in main list (they'll be shown as threads)
                if (antwortAuf) return false;

                // Search filter
                if (feedbackFilters.search) {
                    const search = feedbackFilters.search.toLowerCase();
                    if (!name.includes(search) && !titel.includes(search) && !kommentar.includes(search)) {
                        return false;
                    }
                }

                // Type filters (parse from context ID like "Single (Ich) mit Duo")
                if (feedbackFilters.myType !== 'all' || feedbackFilters.partnerType !== 'all') {
                    const myTypeName = data?.archetypes?.[feedbackFilters.myType]?.name?.toLowerCase();
                    const partnerTypeName = data?.archetypes?.[feedbackFilters.partnerType]?.name?.toLowerCase();

                    if (feedbackFilters.myType !== 'all' && myTypeName) {
                        if (!kontextId.includes(myTypeName)) return false;
                    }
                    if (feedbackFilters.partnerType !== 'all' && partnerTypeName) {
                        if (!kontextId.includes('mit ' + partnerTypeName)) return false;
                    }
                }

                // Category filter
                if (feedbackFilters.category !== 'all') {
                    const cat = feedbackFilters.category;
                    if (cat === 'TM') {
                        if (!kontextId.includes('top match')) return false;
                    } else if (cat === 'CH') {
                        if (!kontextId.includes('challenge')) return false;
                    } else {
                        // Category A-F: check for category name
                        const catName = categoryNames[cat]?.toLowerCase();
                        if (catName && !kontextId.includes(catName)) return false;
                    }
                }

                return true;
            });

            // Sort
            if (feedbackFilters.sort === 'oldest') {
                filtered = filtered.reverse();
            } else if (feedbackFilters.sort === 'rating') {
                filtered.sort((a, b) => {
                    const aRating = (a.Verstand || a.verstand || 0) + (a.Gefuehl || a.gefuehl || 0);
                    const bRating = (b.Verstand || b.verstand || 0) + (b.Gefuehl || b.gefuehl || 0);
                    return bRating - aRating;
                });
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="feedback-empty">
                        ${feedbackData.length === 0
                            ? 'Noch kein Feedback vorhanden.<br>Sei der Erste!'
                            : 'Kein Feedback für diesen Filter.'}
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(f => renderFeedbackItem(f)).join('');
        }

        // Render single feedback item with replies
        function renderFeedbackItem(f, isReply = false) {
            const id = f.Id || f.id || f.timestamp || '';
            const kontextId = f.KontextID || f.kontextId || '-';
            const name = f.Name || f.name || 'Anonym';
            const titel = f.Titel || f.titel || '';
            const kommentar = f.Kommentar || f.kommentar || '';
            const verstand = f.Verstand || f.verstand || 0;
            const gefuehl = f.Gefuehl || f.gefuehl || 0;
            const timestamp = f.Timestamp || f.timestamp || '';

            // Find replies to this item
            const replies = feedbackData.filter(r =>
                (r.AntwortAuf || r.antwortAuf) === id
            );

            const timeStr = timestamp ? new Date(timestamp).toLocaleDateString('de-DE') : '';

            return `
                <div class="feedback-item ${isReply ? 'reply' : ''}" data-id="${id}">
                    <div class="feedback-item-header">
                        <span class="feedback-item-context">${kontextId}</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="feedback-item-name">${name}</span>
                            ${timeStr ? `<span class="feedback-timestamp">${timeStr}</span>` : ''}
                        </div>
                    </div>
                    <div class="feedback-item-title">${titel}</div>
                    ${kommentar ? `<div class="feedback-item-comment">${kommentar}</div>` : ''}
                    <div class="feedback-item-footer">
                        <div class="feedback-item-ratings">
                            <div class="feedback-rating">
                                <span>Verstand:</span>
                                <span class="stars">${'★'.repeat(verstand)}${'☆'.repeat(5-verstand)}</span>
                            </div>
                            <div class="feedback-rating">
                                <span>Gefühl:</span>
                                <span class="stars">${'★'.repeat(gefuehl)}${'☆'.repeat(5-gefuehl)}</span>
                            </div>
                        </div>
                        <button class="feedback-reply-btn" onclick="openReplyModal('${id}', '${name}')">
                            ↩ Antworten
                        </button>
                    </div>
                    ${replies.length > 0 ? `
                        <div class="feedback-replies">
                            ${replies.map(r => renderFeedbackItem(r, true)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Open reply modal
        function openReplyModal(parentId, parentName) {
            replyToId = parentId;
            document.getElementById('feedbackContextId').innerHTML =
                `<span class="reply-indicator">↩ Antwort auf ${parentName}</span>`;
            document.getElementById('feedbackModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset form
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackTitle').value = '';
            document.getElementById('feedbackComment').value = '';
            feedbackRatings = { verstand: 0, gefuehl: 0 };
            updateStarDisplay('ratingVerstand', 0);
            updateStarDisplay('ratingGefuehl', 0);
        }

        // Initialize advanced filters
        function initAdvancedFilters() {
            // Search input
            document.getElementById('feedbackSearch').addEventListener('input', (e) => {
                feedbackFilters.search = e.target.value;
                renderFeedbackList();
            });

            // Type selects
            document.getElementById('filterMyType').addEventListener('change', (e) => {
                feedbackFilters.myType = e.target.value;
                renderFeedbackList();
            });

            document.getElementById('filterPartnerType').addEventListener('change', (e) => {
                feedbackFilters.partnerType = e.target.value;
                renderFeedbackList();
            });

            // Category buttons
            document.querySelectorAll('.cat-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.cat-filter-btn').forEach(b =>
                        b.classList.remove('active')
                    );
                    btn.classList.add('active');
                    feedbackFilters.category = btn.dataset.cat;
                    renderFeedbackList();
                });
            });

            // Sort select
            document.getElementById('filterSort').addEventListener('change', (e) => {
                feedbackFilters.sort = e.target.value;
                renderFeedbackList();
            });
        }

        // Initialize feedback system
        function initFeedbackSystem() {
            initStarRatings();
            initAdvancedFilters();
        }

        // Initialize
        loadData();
        initFeedbackSystem();
    </script>
</body>
</html>
