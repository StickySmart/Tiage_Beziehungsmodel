<!--
 * ¬© 2025 Ti-age.de Alle Rechte vorbehalten.
 * Dieses Werk ist urheberrechtlich gesch√ºtzt.
 * Jegliche Nutzung ohne ausdr√ºckliche Genehmigung ist untersagt.
 -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Das anarchische Ti-Age Prinzip der Paarung | Swipe</title>
    <link rel="canonical" href="https://ti-age.de/archetype-interaction.html">
    <!-- Zentrale CSS-Variablen - EINZIGE QUELLE -->
    <link rel="stylesheet" href="templates/variables.css">
    <link rel="stylesheet" href="templates/template_desktop.css">
    <link rel="stylesheet" href="templates/template_mobile.css" media="(max-width: 768px)">

    <!-- TIAGE i18n - Internationalisierung -->
    <script src="js/locales/de.js"></script>
    <script src="js/locales/en.js"></script>
    <script src="js/i18n.js"></script>

    <!-- TIAGE Archetype Statements - DE/EN -->
    <script src="statements/archetypeStatements.js"></script>
    <script src="statements/archetypeStatements_EN.js"></script>

    <!-- TIAGE SYNTHESE - Zentralisierte Berechnungslogik -->
    <script src="js/synthesis/constants.js"></script>
    <script src="js/synthesis/factors/archetypeFactor.js"></script>
    <script src="js/synthesis/factors/dominanceFactor.js"></script>
    <script src="js/synthesis/factors/orientationFactor.js"></script>
    <script src="js/synthesis/factors/genderFactor.js"></script>
    <script src="js/synthesis/synthesisCalculator.js"></script>
    <script src="js/synthesis/pathosTextGenerator.js"></script>
    <script src="js/synthesis/logosTextGenerator.js"></script>
    <script src="js/synthesis/integratedSynthesisTextGenerator.js"></script>
    <script src="profiles/gfk-beduerfnisse.js"></script>
    <script src="profiles/beduerfnis-modifikatoren.js"></script>
</head>
<body>
    <!-- Age Verification - Inline Script BEFORE modal for onclick to work -->
    <script>
        // Define confirmAge immediately so onclick handlers work
        // Modal appears on EVERY visit (no localStorage storage)
        window.confirmAge = function(isAdult) {
            console.log('confirmAge called:', isAdult);
            try {
                var modal = document.getElementById('ageVerificationModal');
                if (isAdult) {
                    // Just hide the modal for this session - no localStorage
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        modal.style.pointerEvents = 'none';
                    }
                    document.body.style.overflow = 'auto';
                } else {
                    window.location.href = 'https://www.google.com';
                }
            } catch(e) {
                console.error('confirmAge error:', e);
                var m = document.getElementById('ageVerificationModal');
                if (m) m.style.display = 'none';
            }
        };
    </script>

    <!-- GFK Explanation Modal -->
    <div class="gfk-modal-overlay" id="gfkExplanationModal" onclick="closeGfkExplanationModal(event)">
        <div class="gfk-modal" onclick="event.stopPropagation()">
            <div class="gfk-modal-header">
                <div class="gfk-modal-title">
                    <span>GFK-Kompetenz</span>
                    <span id="gfkModalLevelBadge" class="gfk-level-indicator"></span>
                </div>
                <button class="gfk-modal-close" onclick="closeGfkExplanationModal()">&times;</button>
            </div>
            <div class="gfk-modal-content">
                <div class="gfk-explanation-text" id="gfkModalExplanation">
                </div>
                <div class="gfk-info-box">
                    <div class="gfk-info-box-title">Automatische Berechnung</div>
                    <div class="gfk-info-box-text">
                        Die GFK-Kompetenz wird automatisch basierend auf den gew√§hlten Beziehungsarchetypen berechnet.
                        Sie zeigt die √úbereinstimmung der Kernbed√ºrfnisse nach Marshall Rosenbergs Gewaltfreier Kommunikation.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bed√ºrfnis-Vergleich Modal -->
    <div class="modal-overlay" id="needsCompareModal" onclick="closeNeedsCompareModal(event)" style="z-index: 2200;">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 500px;">
            <div class="modal-header">
                <span class="modal-title" id="needsCompareModalTitle">Bed√ºrfnis-Vergleich</span>
                <button class="modal-close" onclick="closeNeedsCompareModal()">&times;</button>
            </div>
            <div class="modal-body" id="needsCompareModalBody" style="padding: 20px;">
                <!-- Content wird dynamisch gef√ºllt -->
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="help-modal-overlay" id="helpModal" onclick="closeHelpModal(event)">
        <div class="help-modal" onclick="event.stopPropagation()">
            <div class="help-modal-header">
                <h2>Hilfe & Dokumentation</h2>
                <button class="help-modal-close" onclick="closeHelpModal()">&times;</button>
            </div>
            <div class="help-modal-content">

                <!-- KURZANLEITUNG -->
                <div class="quick-guide">
                    <h3>Kurzanleitung</h3>
                    <ul>
                        <li><strong>Mein Typ</strong> = Dein Archetyp + Eigenschaften (Orientierung, Dominanz, Geschlecht)</li>
                        <li><strong>Beziehungsqualit√§t</strong> = Partner-Archetyp + Eigenschaften und Kompatibilit√§tsberechnung</li>
                        <li><strong>Gelebt</strong> = Was du aktiv lebst / <strong>Interessiert</strong> = Wof√ºr du offen bist</li>
                        <li><strong>INFO</strong>-Button = Details zum gew√§hlten Archetyp</li>
                        <li><strong>Ergebnis</strong> = Automatische Berechnung der Kompatibilit√§t (4 Faktoren)</li>
                        <li><strong>Prozentwerte</strong> anklicken = Detaillierte Erkl√§rung pro Faktor</li>
                    </ul>
                </div>

                <!-- WAS IST NEU -->
                <div class="help-section" style="background: linear-gradient(135deg, rgba(var(--primary-rgb, 100,100,100), 0.1), transparent); border-left: 3px solid var(--primary);">
                    <h3>Neu in Version 1.4</h3>
                    <ul>
                        <li><strong>Gelebt/Interessiert:</strong> W√§hle f√ºr jede Eigenschaft, ob du sie aktiv lebst oder nur Interesse hast</li>
                        <li><strong>Auto-Collapse:</strong> Orientierung und Dominanz Sektionen schlie√üen automatisch nach Auswahl</li>
                        <li><strong>Verbesserte Fehlermeldungen:</strong> Fehlende Felder werden √ºbersichtlich aufgelistet</li>
                        <li><strong>Mobile Navigation:</strong> Neue Navigationstasten in Modals f√ºr bessere Bedienung</li>
                        <li><strong>Kreisf√∂rmige Score-Anzeige:</strong> Kompatibilit√§tswerte werden visuell ansprechender dargestellt</li>
                    </ul>
                </div>

                <!-- KOMMENTAR-SEKTION -->
                <div class="comment-section">
                    <p>Fragen, Feedback oder Verbesserungsvorschl√§ge?</p>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="comment-btn" onclick="openCommentModal()">
                            Kommentar senden
                        </button>
                        <button class="view-comments-btn" onclick="openCommentsListModal()">
                            üìã Alle Kommentare
                        </button>
                    </div>
                </div>

                <!-- DOKUMENTATION -->
                <div class="documentation-section">
                    <h3>Dokumentation</h3>

                    <div class="help-section">
                        <h3>Das Tiage-Beziehungsmodell</h3>
                        <p>Eine <strong>eigenst√§ndige Synthese</strong> von Tiage, entwickelt durch Online-Recherche und pers√∂nliche Reflexion. Das Modell verbindet zwei philosophische Traditionen zu einem praktischen Analyse-Tool:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>MOQ (Robert M. Pirsig):</strong> Metaphysik der Qualit√§t - statische vs. dynamische Qualit√§t als Grundstruktur</li>
                            <li><strong>OSHO:</strong> Bewusstsein durch Meditation - Polarit√§t, Balance, Schwingung</li>
                        </ul>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Tiage's Beitrag: Die Verbindung beider Philosophien zu einem konkreten Beziehungs-Rechner mit eigener Gewichtung und Archetypen-Matrix.</p>
                    </div>

                    <div class="help-section">
                        <h3>Logos vs. Pathos (40:60)</h3>
                        <p><strong>Logos (40% - Verstand):</strong> Die rationale, strukturgebende Dimension. Pirsig nennt dies "statische Qualit√§t" - bew√§hrte Muster, die Stabilit√§t schaffen.</p>
                        <p style="margin-top: 8px;"><strong>Pathos (60% - Gef√ºhl):</strong> Die emotionale, anziehende Dimension. Pirsig nennt dies "dynamische Qualit√§t" - die Kraft, die Ver√§nderung und Wachstum antreibt.</p>
                        <p style="margin-top: 8px; font-style: italic; color: var(--text-muted);">OSHO: "Bewusstsein durch Meditation - Loslassen (Let Go) erm√∂glicht echte Verbindung."</p>
                    </div>

                    <div class="help-section">
                        <h3>Die 4 Qualit√§tsfaktoren</h3>
                        <ul>
                            <li><strong>Archetyp-√úbereinstimmung</strong> (40% Logos) - Fundamentale Beziehungsphilosophie: "Wie wollen wir Beziehung leben?"</li>
                            <li><strong>Orientierungs-Kompatibilit√§t</strong> (25% Pathos) - K√∂rperliche Polarit√§t und Anziehung. OSHO: "Nur Extreme k√∂nnen sich wirklich anziehen."</li>
                            <li><strong>Dominanz-Harmonie</strong> (20% Pathos) - Energetische Dynamik. OSHO: "Tao - eine Energie, zwei Ausdrucksformen."</li>
                            <li><strong>Geschlechts-Attraktion</strong> (15% Pathos) - Gender-Chemie als Feinabstimmung der Orientierung.</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>GFK-Kommunikationsfaktor (K)</h3>
                        <p><strong>GFK (Gewaltfreie Kommunikation)</strong> nach Marshall Rosenberg beeinflusst die Resonanz-Berechnung mit 30% Gewichtung.</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Hoch</strong> - Aktive GFK-Praxis: Bed√ºrfnisse klar benennen, empathisches Zuh√∂ren</li>
                            <li><strong>Mittel</strong> - GFK-Grundkenntnisse: Bewusstsein f√ºr Kommunikationsmuster</li>
                            <li><strong>Niedrig</strong> - Keine GFK-Erfahrung: Potenzial f√ºr Entwicklung</li>
                        </ul>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Je h√∂her die kombinierte GFK-Kompetenz beider Partner, desto st√§rker kann Resonanz entstehen - unabh√§ngig von den 4 Qualit√§tsfaktoren.</p>
                    </div>

                    <div class="help-section">
                        <h3>Berechnung</h3>
                        <div class="help-formula">
                            Qualit√§tsindex = [(Archetyp √ó 40%) + (Orientierung √ó 25%) + (Dominanz √ó 20%) + (Geschlecht √ó 15%)] √ó Resonanz
                        </div>
                        <p>Jeder Faktor wird einzeln auf 0-100% bewertet. Die <strong>Resonanz (R)</strong> ist ein Meta-Faktor (0.9-1.1), der moduliert, wie gut Kopf (Logos) und Herz (Pathos) zusammenschwingen.</p>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <strong>Resonanz-Formel:</strong> R = 0.9 + [(M/100 √ó 0.35) + (B √ó 0.35) + (K √ó 0.30)] √ó 0.2<br>
                            <small style="opacity: 0.7;">M = Profil-Match (30 Attribute) | B = Logos-Pathos-Balance | K = GFK-Kommunikationsfaktor</small>
                        </div>
                    </div>

                    <div class="help-section">
                        <h3>Rechenbeispiel</h3>
                        <div class="help-example">
                            <div class="help-example-title">Duo (Cis Frau, Submissiv, Hetero) √ó Duo-Flex (Cis Mann, Dominant, Hetero)</div>
                            <ul>
                                <li>Archetyp: 75% √ó 0.40 = 30 (Duo ‚Üî Duo-Flex = nah verwandt)</li>
                                <li>Orientierung: 100% √ó 0.25 = 25 (Hetero + Hetero bei M/F)</li>
                                <li>Dominanz: 100% √ó 0.20 = 20 (Submissiv + Dominant = Erg√§nzung)</li>
                                <li>Geschlecht: 100% √ó 0.15 = 15 (Cis Frau √ó Cis Mann passt)</li>
                                <li><strong>Basis-Score: 90</strong></li>
                                <li>Resonanz: R = 1.05 (Leichte Harmonie)</li>
                                <li><strong>Final: 90 √ó 1.05 = 94.5 ‚âà 95</strong></li>
                            </ul>
                            <div class="help-formula">
                                (30 + 25 + 20 + 15) √ó 1.05 = 94.5 ‚âà 95%
                            </div>
                        </div>
                    </div>

                    <div class="help-section">
                        <h3>Die 8 Archetypen</h3>
                        <ul>
                            <li><strong>Single</strong> - Autonomes Leben ohne Prim√§rbeziehung</li>
                            <li><strong>Duo</strong> - Monogame Zweierbeziehung mit Exklusivit√§t</li>
                            <li><strong>Duo-Flex</strong> - Prim√§rbeziehung mit vereinbarten √ñffnungen</li>
                            <li><strong>Solopoly</strong> - Mehrere gleichwertige Beziehungen, Fokus Autonomie</li>
                            <li><strong>Polyamor</strong> - Tiefe emotionale Bindungen zu mehreren Partnern</li>
                            <li><strong>RA</strong> - Ablehnung aller Beziehungs-Hierarchien</li>
                            <li><strong>LAT</strong> - Living Apart Together - Feste Partnerschaft ohne Zusammenleben</li>
                            <li><strong>Aromantisch</strong> - Fokus auf platonische Verbindungen ohne romantische Komponente</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>Ergebnis-Interpretation</h3>
                        <ul>
                            <li><strong>70-100%</strong> - Gut: Solide Basis vorhanden</li>
                            <li><strong>50-69%</strong> - Mittel: Erfordert bewusste Arbeit</li>
                            <li><strong>0-49%</strong> - Herausfordernd: Fundamentale Unterschiede</li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">Der Qualit√§tsindex ist ein Orientierungswert. Echte Beziehungen h√§ngen von vielen weiteren Faktoren ab.</p>
                    </div>

                    <div class="help-section">
                        <h3>Philosophische Quellen</h3>
                        <h4 style="margin-top: 15px;">Robert M. Pirsig (1928-2017) - Metaphysik der Qualit√§t</h4>
                        <p>Pirsig entwickelte ein philosophisches System, das <strong>Qualit√§t</strong> als fundamentale Realit√§t betrachtet:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Statische Qualit√§t:</strong> Strukturierte, wiederholbare Muster die Stabilit√§t schaffen ‚Üí im Tiage-Modell: <strong>Logos</strong></li>
                            <li><strong>Dynamische Qualit√§t:</strong> Die kreative Kraft f√ºr Wachstum und Ver√§nderung ‚Üí im Tiage-Modell: <strong>Pathos</strong></li>
                        </ul>
                        <h4 style="margin-top: 15px;">OSHO - Bewusstsein durch Meditation</h4>
                        <p>OSHO lehrte Bewusstsein √ºber Polarit√§t, Balance und Schwingung - Meditation als Weg zur Klarheit:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>Bewusstsein:</strong> Klarheit durch Meditation und Loslassen (Let Go)</li>
                            <li><strong>Polarit√§t & Schwingung:</strong> Energetische Balance in Beziehungen</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Tiage's Synthese:</strong> Die Verbindung von Pirsigs Qualit√§ts-Philosophie mit OSHOs Bewusstseins-Konzept zu einem praktischen Beziehungs-Rechner mit konkreter Gewichtung (40:60 Logos:Pathos) und 6 Archetypen.</p>
                    </div>

                    <div class="help-section">
                        <h3>Literatur von Robert M. Pirsig</h3>
                        <ul>
                            <li>
                                <strong>Zen und die Kunst ein Motorrad zu warten</strong> (1974)<br>
                                <span style="color: var(--text-muted); font-size: 0.9em;">Originaltitel: "Zen and the Art of Motorcycle Maintenance: An Inquiry into Values"</span><br>
                                <span style="margin-top: 5px; display: inline-block;">Ein philosophischer Roman, der Pirsigs erste Erkundung der Qualit√§t als metaphysisches Konzept darstellt. Das Buch verbindet eine Motorradreise mit tiefgreifenden philosophischen Betrachtungen √ºber Rationalit√§t, Romantik und die Natur der Qualit√§t.</span>
                            </li>
                            <li style="margin-top: 15px;">
                                <strong>Lila ‚Äì oder ein Versuch √ºber Moral</strong> (1991)<br>
                                <span style="color: var(--text-muted); font-size: 0.9em;">Originaltitel: "Lila: An Inquiry into Morals"</span><br>
                                <span style="margin-top: 5px; display: inline-block;">Die Fortsetzung und systematische Ausarbeitung der Metaphysik der Qualit√§t. Pirsig entwickelt hier eine vollst√§ndige philosophische Theorie, die statische und dynamische Qualit√§tsmuster auf biologischer, sozialer und intellektueller Ebene unterscheidet.</span>
                            </li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>Ein Widerspruch zu Pirsig</h3>
                        <p>Robert Pirsig argumentierte, dass Definitionen die unmittelbare Qualit√§t des Erlebens zerst√∂ren ‚Äì dass das Benennen dem F√ºhlen nachgelagert ist und es reduziert.</p>
                        <p style="margin-top: 10px;">Diese App basiert auf der gegenteiligen Erfahrung:</p>
                        <p style="margin-top: 10px;"><strong>Definition und Erleben sind nicht getrennt. Sie entstehen gleichzeitig ‚Äì im Dialog, in Resonanz, in extremer K√ºrze.</strong></p>
                        <p style="margin-top: 10px;">Wenn Begriffe aufgef√§chert werden, wenn Bedeutungsfelder sich √∂ffnen, entsteht nicht weniger Qualit√§t, sondern mehr. Die Sprache ist kein K√§fig f√ºr das Erleben. Sie ist sein Resonanzraum.</p>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Diese Erkenntnis entstand nicht theoretisch, sondern praktisch ‚Äì im Arbeiten mit KI-gest√ºtztem Dialog. Das Argument gegen Pirsig ist die Erfahrung selbst.</p>
                    </div>

                    <div class="help-section">
                        <h3>OSHO: Bewusstsein und Beziehung</h3>
                        <p><strong>Bhagwan Shree Rajneesh (OSHO)</strong> (1931-1990) war ein indischer spiritueller Lehrer, dessen Philosophie √ºber Bewusstsein und Liebe das Tiage-Modell pr√§gt.</p>

                        <h4 style="margin-top: 15px;">Kernkonzepte f√ºr Beziehungen:</h4>
                        <ul style="margin-top: 10px;">
                            <li><strong>Liebe ohne Besitz:</strong> "Liebe ist keine Bindung, sondern Freiheit. Wenn du jemanden liebst, gibst du ihm Fl√ºgel, keinen K√§fig." ‚Üí Basis f√ºr die Archetypen-Vielfalt (Single bis Polyamor)</li>
                            <li style="margin-top: 8px;"><strong>Aloneness vs. Loneliness:</strong> Allein-Sein ist nicht Einsamkeit. Nur wer mit sich selbst sein kann, kann wirklich mit anderen sein. ‚Üí Erkl√§rt warum "Single" ein vollwertiger Archetyp ist</li>
                            <li style="margin-top: 8px;"><strong>Akzeptanz statt Ver√§nderung:</strong> "Liebe den Menschen, wie er ist. Versuch nicht, ihn zu verbessern." ‚Üí Das Modell bewertet Kompatibilit√§t, nicht "Korrektur"</li>
                            <li style="margin-top: 8px;"><strong>Bewusstheit statt Unbewusstheit:</strong> Die meisten Beziehungsprobleme entstehen durch unbewusstes Handeln. Meditation schafft Klarheit. ‚Üí Begr√ºndung f√ºr Pathos-Gewichtung (60%)</li>
                            <li style="margin-top: 8px;"><strong>Polarit√§t als Anziehung:</strong> "Gegens√§tze ziehen sich an, aber nicht um sich zu bek√§mpfen ‚Äì um sich zu erg√§nzen." ‚Üí Dominanz-Harmonie Faktor</li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">"Liebe ist eine Blume, die nur in der Freiheit w√§chst. Im Gef√§ngnis von Erwartungen stirbt sie."</p>
                    </div>

                    <div class="help-section">
                        <h3>OSHO & Tiages Widerspruch: Dialog als Meditation</h3>
                        <p>OSHOs Philosophie verbindet sich √ºberraschend mit Tiages Widerspruch zu Pirsig:</p>
                        <ul style="margin-top: 10px;">
                            <li><strong>OSHO:</strong> "Worte k√∂nnen lebendig sein, wenn Bewusstheit dahinter steht. Dann sind sie keine Gef√§ngnisse, sondern Tore."</li>
                            <li style="margin-top: 8px;"><strong>Tiage:</strong> Im bewussten Dialog <em>ist</em> die Definition das Erleben. Begriffe werden aufgef√§chert, nicht fixiert.</li>
                        </ul>
                        <p style="margin-top: 10px;">Beide sagen: <strong>Sprache muss nicht t√∂ten. Sie kann lebendig sein ‚Äì wenn Bewusstheit da ist.</strong></p>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Die Qualit√§t entsteht nicht trotz der Sprache, sondern <em>durch</em> sie ‚Äì wenn zwei Menschen auf derselben Wellenl√§nge schwingen. Das ist OSHOs "Resonanz" und Tiages "Dialog-Erfahrung" zugleich.</p>
                    </div>

                    <div class="help-section">
                        <h3>TIAGE Resonanz-Theorie: Neurowissenschaftliche Grundlagen</h3>
                        <p>Die philosophischen Konzepte werden durch neurowissenschaftliche Forschung untermauert:</p>

                        <h4 style="margin-top: 15px;">Kernthese</h4>
                        <p style="font-style: italic; background: var(--bg-secondary); padding: 10px; border-radius: 5px;">
                            "Wahrnehmung basiert auf Schwingungen und Mustern. Resonanz = Synchronit√§t zwischen inneren neuronalen Rhythmen und √§u√üeren Signalen."
                        </p>

                        <h4 style="margin-top: 15px;">Die Wissenschaftler hinter der Theorie</h4>
                        <ul style="margin-top: 10px;">
                            <li><strong>Buzs√°ki & Singer</strong> (Neuronale Rhythmen): Gamma-Oszillationen als Basis f√ºr "auf einer Wellenl√§nge sein"</li>
                            <li style="margin-top: 8px;"><strong>Friston</strong> (Predictive Coding): Kompatibilit√§t = niedrige Vorhersage-Fehler im Umgang miteinander</li>
                            <li style="margin-top: 8px;"><strong>Kapur</strong> (Aberrant Salience): Flow vs. Psychose als Spektrum der Synchronit√§t</li>
                            <li style="margin-top: 8px;"><strong>Levitin</strong> (Psychoakustik): Musik als externes Regulierungssystem f√ºr Emotionen</li>
                            <li style="margin-top: 8px;"><strong>Aron</strong> (Hochsensitivit√§t): Reizlast-Management als Beziehungsfaktor</li>
                        </ul>

                        <h4 style="margin-top: 15px;">Die Zustands-Skala</h4>
                        <table style="width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: var(--bg-secondary);">
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Zustand</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Beschreibung</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">In Beziehungen</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Flow</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Optimale Synchronit√§t</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Tiefe Verbindung, "im Einklang"</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Hyper-Synchronit√§t</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">√úberm√§√üige Muster-Erkennung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Verliebtheit / Abh√§ngigkeit</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Hypo-Synchronit√§t</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Reduzierte Bindung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Entfremdung, "aneinander vorbei"</td>
                            </tr>
                        </table>

                        <h4 style="margin-top: 15px;">Weitere Kernthesen</h4>
                        <ul style="margin-top: 10px;">
                            <li><strong>Zufall</strong> = unerkannte Ordnung (Synchronizit√§ten als Muster)</li>
                            <li style="margin-top: 8px;"><strong>Hochsensitivit√§t + Reizlast</strong> ‚Üí Zustandsschwankungen</li>
                        </ul>

                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">
                            Die vollst√§ndige wissenschaftliche Dokumentation findet sich in: profiles/research-sources.md (Abschnitt 9)
                        </p>
                    </div>

                    <div class="help-section">
                        <h3>‚ö° Resonanz-Override: Jenseits der Konditionierung</h3>
                        <p>OSHO lehrte: <strong>Sexuelle Orientierung ist Konditionierung, nicht Natur.</strong> Der nat√ºrliche Mensch ist jenseits von Labels.</p>

                        <h4 style="margin-top: 15px;">Was ist der Resonanz-Override?</h4>
                        <p>Normalerweise gilt: Wenn die Orientierung inkompatibel ist (z.B. zwei heterosexuelle M√§nner), ergibt das 0% Orientierungs-Score und damit ein K.O.-Kriterium.</p>
                        <p style="margin-top: 10px;">Der <strong>Resonanz-Override</strong> erm√∂glicht eine Ausnahme: Wenn zwei Menschen auf einer tiefen Ebene resonieren (R ‚â• 1.05), kann diese Verbindung die konditionierten Grenzen √ºberschreiten.</p>

                        <h4 style="margin-top: 15px;">Wie funktioniert es?</h4>
                        <table style="width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: var(--bg-secondary);">
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Resonanz (R)</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Override-Effekt</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">O_effektiv</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">< 1.05</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Kein Override</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">0% (K.O.)</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">1.05</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Schwache √ñffnung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">5%</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">1.08</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Moderate √ñffnung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">8%</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);">1.10</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Maximale √ñffnung</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">10%</td>
                            </tr>
                        </table>

                        <p style="margin-top: 15px;"><strong>Formel:</strong> <code>O_effektiv = (R - 1.0) √ó 100</code></p>

                        <h4 style="margin-top: 15px;">Philosophische Begr√ºndung (OSHO)</h4>
                        <p style="font-style: italic; background: var(--bg-secondary); padding: 10px; border-radius: 5px;">
                            "Liebe kennt keine Grenzen. Wenn zwei Seelen wirklich resonieren, sind alle gesellschaftlichen Kategorien nur noch Schatten an der Wand."
                        </p>
                        <p style="margin-top: 10px;">Resonanz repr√§sentiert die tiefere, unkonditionierte Ebene der Verbindung ‚Äì jenseits dessen, was Gesellschaft und Erziehung uns beigebracht haben.</p>

                        <p style="margin-top: 15px; padding: 10px; background: rgba(255,165,0,0.1); border-left: 3px solid orange; font-size: 0.9em;">
                            <strong>Hinweis:</strong> Dies ist keine Empfehlung, sondern eine philosophische M√∂glichkeit, die das Modell abbildet. Der Override zeigt: Tiefe Resonanz kann konditionierte Muster transzendieren.
                        </p>
                    </div>

                    <div class="help-section">
                        <h3>üî¨ R-Berechnung: Die zwei Komponenten</h3>
                        <p>Der Resonanzfaktor R wird aus zwei gleichgewichteten Komponenten berechnet:</p>

                        <h4 style="margin-top: 15px;">Komponente 1: Profil-Match (M)</h4>
                        <p>√Ñhnlichkeit der 30 Pers√∂nlichkeitsattribute zwischen zwei Profilen.</p>
                        <p style="background: var(--bg-secondary); padding: 10px; border-radius: 5px; font-family: monospace;">
                            M = √úbereinstimmende Attribute / 30 √ó 100
                        </p>
                        <p style="margin-top: 5px; font-size: 0.9em; color: var(--text-muted);">Bei 24 von 30 √ºbereinstimmenden Attributen: M = 80</p>

                        <h4 style="margin-top: 15px;">Komponente 2: Logos-Pathos-Balance (B)</h4>
                        <p>Das Verh√§ltnis zwischen rationaler Struktur und emotionaler Dynamik ‚Äì basierend auf Pirsigs MOQ.</p>
                        <table style="width: 100%; margin-top: 10px; border-collapse: collapse; font-size: 0.9em;">
                            <tr style="background: var(--bg-secondary);">
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Konzept</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">Definition</th>
                                <th style="padding: 8px; text-align: left; border: 1px solid var(--border);">TIAGE-Zuordnung</th>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Logos</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Statische Qualit√§t</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">A (Attraction)</td>
                            </tr>
                            <tr>
                                <td style="padding: 8px; border: 1px solid var(--border);"><strong>Pathos</strong></td>
                                <td style="padding: 8px; border: 1px solid var(--border);">Dynamische Qualit√§t</td>
                                <td style="padding: 8px; border: 1px solid var(--border);">(O + D + G) / 3</td>
                            </tr>
                        </table>
                        <p style="background: var(--bg-secondary); padding: 10px; border-radius: 5px; font-family: monospace; margin-top: 10px;">
                            B = (100 - |Logos - Pathos|) / 100
                        </p>
                        <p style="margin-top: 5px; font-size: 0.9em; color: var(--text-muted);">Bei A=72% und avg(O,D,G)=65%: B = (100 - 7) / 100 = 0.93</p>

                        <h4 style="margin-top: 15px;">Die R-Formel</h4>
                        <p style="background: linear-gradient(90deg, rgba(147,112,219,0.1), rgba(255,215,0,0.1)); padding: 15px; border-radius: 5px; font-family: monospace; font-size: 1.1em; text-align: center; border: 1px solid var(--border);">
                            R = 0.9 + [(M/100 √ó 0.5) + (B √ó 0.5)] √ó 0.2
                        </p>
                        <p style="margin-top: 10px;"><strong>Wertebereich:</strong> R variiert zwischen 0.9 (minimale Resonanz) und 1.1 (maximale Resonanz).</p>

                        <h4 style="margin-top: 15px;">Beispielrechnung</h4>
                        <div style="background: var(--bg-secondary); padding: 15px; border-radius: 5px; font-size: 0.9em;">
                            <p><strong>Gegeben:</strong> M = 80 (80% Profil-Match), B = 0.93 (7% Logos-Pathos-Differenz)</p>
                            <p style="margin-top: 8px; font-family: monospace;">
                                R = 0.9 + [(80/100 √ó 0.5) + (0.93 √ó 0.5)] √ó 0.2<br>
                                R = 0.9 + [0.4 + 0.465] √ó 0.2<br>
                                R = 0.9 + 0.173<br>
                                R = <strong>1.073</strong> ‚Üí Override aktiv!
                            </p>
                        </div>

                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">
                            Die Balance zwischen Profil-Match und Logos-Pathos-Verh√§ltnis erfasst sowohl die √§u√üere Kompatibilit√§t (√§hnliche Eigenschaften) als auch die innere Dynamik (Verh√§ltnis von Struktur und Emotion).
                        </p>
                    </div>

                    <div class="help-section">
                        <h3>Quellen & Weiterf√ºhrende Ressourcen</h3>
                        <ul>
                            <li><strong>Pirsig, Robert M.</strong> (1974): <em>Zen and the Art of Motorcycle Maintenance: An Inquiry into Values.</em> William Morrow and Company, New York.</li>
                            <li><strong>Pirsig, Robert M.</strong> (1991): <em>Lila: An Inquiry into Morals.</em> Bantam Books, New York.</li>
                            <li><strong>McWatt, Anthony</strong> (2004): <em>An Introduction to Robert Pirsig's Metaphysics of Quality.</em> Dissertation, University of Liverpool.</li>
                            <li style="margin-top: 10px;"><strong>Schupp, Hans</strong>: <em>Elemente der Logik.</em> <span style="color: var(--text-muted); font-size: 0.85em;">(Indirekte Quelle ‚Äì als Grundlage f√ºr logische Strukturierung und formale Denkprinzipien)</span></li>
                            <li style="margin-top: 10px;"><strong>OSHO:</strong>
                                <ul style="margin-top: 5px;">
                                    <li><a href="https://oshofriends.com/love" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">OSHO on Love and Relationships</a></li>
                                    <li><a href="https://www.oshonews.com/2021/03/07/man-and-woman/" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Man and Woman - Polarity</a></li>
                                </ul>
                            </li>
                            <li style="margin-top: 10px;"><strong>MOQ Online-Ressourcen:</strong>
                                <ul style="margin-top: 5px;">
                                    <li><a href="https://www.moq.org" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">moq.org</a> ‚Äì Metaphysics of Quality Community</li>
                                    <li><a href="https://en.wikipedia.org/wiki/Robert_M._Pirsig" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Wikipedia: Robert M. Pirsig</a></li>
                                </ul>
                            </li>
                            <li style="margin-top: 10px;"><strong>Neurowissenschaftliche Resonanz-Theorie:</strong>
                                <ul style="margin-top: 5px;">
                                    <li>Buzs√°ki, G. (2006): <em>Rhythms of the Brain.</em> Oxford University Press.</li>
                                    <li>Friston, K. (2010): The free-energy principle. <em>Nature Reviews Neuroscience.</em></li>
                                    <li>Kapur, S. (2003): Psychosis as Aberrant Salience. <em>Am J Psychiatry.</em></li>
                                    <li>Levitin, D.J. (2006): <em>This Is Your Brain on Music.</em> Dutton.</li>
                                    <li>Aron, E.N. (1996): <em>The Highly Sensitive Person.</em> Broadway Books.</li>
                                </ul>
                            </li>
                        </ul>
                        <p style="margin-top: 15px; font-style: italic; color: var(--text-muted);">Das Tiage-Beziehungsmodell ist eine eigenst√§ndige Interpretation und Anwendung philosophischer Konzepte auf zwischenmenschliche Beziehungen und erhebt keinen Anspruch auf wissenschaftliche Validierung.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div class="comment-modal-overlay" id="commentModal" onclick="closeCommentModal(event)">
        <div class="comment-modal" onclick="event.stopPropagation()">
            <div class="comment-modal-header">
                <h3>Kommentar senden</h3>
                <button class="comment-modal-close" onclick="closeCommentModal()">&times;</button>
            </div>
            <div class="comment-modal-body">
                <div class="comment-form-group">
                    <label for="commentName">Name / K√ºrzel *</label>
                    <input type="text" id="commentName" placeholder="z.B. Max oder Anonym">
                </div>
                <div class="comment-form-group">
                    <label for="commentType">Art des Kommentars</label>
                    <select id="commentType">
                        <option value="frage">Frage zur Bedienung</option>
                        <option value="feedback">Allgemeines Feedback</option>
                        <option value="fehler">Fehler melden</option>
                        <option value="verbesserung">Verbesserungsvorschlag</option>
                        <option value="doku">Frage zur Dokumentation</option>
                    </select>
                </div>
                <div class="comment-form-group">
                    <label for="commentText">Dein Kommentar *</label>
                    <textarea id="commentText" placeholder="Schreibe hier deine Frage oder dein Feedback..."></textarea>
                </div>
                <button class="comment-submit-btn" id="commentSubmitBtn" onclick="submitComment()">Absenden</button>
            </div>
        </div>
    </div>

    <!-- Comments List Modal -->
    <div class="comments-list-overlay" id="commentsListModal" onclick="closeCommentsListModal(event)">
        <div class="comments-list-modal" onclick="event.stopPropagation()">
            <div class="comments-list-header">
                <h2>üìã Alle Kommentare</h2>
                <button class="help-modal-close" onclick="closeCommentsListModal()">&times;</button>
            </div>
            <div class="comments-search-container">
                <div class="comments-search-wrapper">
                    <span class="comments-search-icon">üîç</span>
                    <input type="text"
                           id="commentsSearchInput"
                           class="comments-search-input"
                           placeholder="Suche... (* als Platzhalter)"
                           oninput="filterComments(this.value)">
                    <button class="comments-search-clear" id="commentsSearchClear" onclick="clearCommentsSearch()">&times;</button>
                </div>
                <div class="comments-search-hint">Beispiel: *fehler* findet alle Kommentare mit "fehler" im Text</div>
            </div>
            <div class="comments-search-results" id="commentsSearchResults" style="display: none;"></div>
            <div class="comments-list-body" id="commentsListBody">
                <div class="no-comments">
                    <div class="no-comments-icon">üí¨</div>
                    <p>Lade Kommentare...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Age Verification Modal -->
    <div class="age-verification-overlay" id="ageVerificationModal">
        <div class="age-verification-modal" onclick="event.stopPropagation()">
            <!-- Language Toggle in Age Check -->
            <div class="age-verification-lang" style="position: absolute; top: 15px; right: 15px;">
                <button class="lang-btn" onclick="TiageI18n.toggle(); updateAllTranslations(); updateAgeVerificationTexts();" title="Switch Language / Sprache wechseln">
                    <span class="lang-icon">üåê</span>
                    <span class="lang-code" id="ageVerifyLangCode">DE</span>
                </button>
            </div>
            <div class="age-verification-icon">üîû</div>
            <h2 data-i18n="ageVerification.title">Altersverifikation</h2>
            <p data-i18n="ageVerification.description">Diese Seite enth√§lt Inhalte √ºber Beziehungsmodelle und ist nur f√ºr Personen ab 18 Jahren bestimmt.</p>
            <!-- Terms BEFORE buttons for GDPR/TTDSG compliance - users must see terms before clicking -->
            <p class="age-verification-note" style="margin-top: 0; margin-bottom: 15px;" id="ageVerificationTerms">
                Mit dem Klick auf "Ja" best√§tigst du, dass du:<br>
                ‚Ä¢ vollj√§hrig bist (mindestens 18 Jahre alt)<br>
                ‚Ä¢ die <a href="nutzungsbedingungen.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Nutzungsbedingungen</a> und <a href="datenschutz.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Datenschutzerkl√§rung</a> akzeptierst<br>
                ‚Ä¢ zur Kenntnis nimmst, dass alle Inhalte urheberrechtlich gesch√ºtzt sind<br>
                ‚Ä¢ die Inhalte nur f√ºr pers√∂nliche, nicht-kommerzielle Zwecke nutzt
            </p>
            <div class="age-verification-question">
                <strong data-i18n="ageVerification.question">Bist du mindestens 18 Jahre alt?</strong>
            </div>
            <!-- Buttons -->
            <div class="age-verification-buttons">
                <button class="age-btn age-btn-yes" id="ageVerifyYes" type="button" onclick="window.confirmAge(true); return false;" data-i18n="ageVerification.confirm">
                    Ja, ich bin 18+
                </button>
                <button class="age-btn age-btn-no" id="ageVerifyNo" type="button" onclick="window.confirmAge(false); return false;" data-i18n="ageVerification.deny">
                    Nein, ich bin unter 18
                </button>
            </div>
        </div>
    </div>

    <!-- Factor Detail Modal (Feature 1) -->
    <div class="modal-overlay" id="factorModal" onclick="closeFactorModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title" id="factorModalTitle">Faktor-Details</span>
                <button class="modal-close" onclick="closeFactorModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle" id="factorModalSubtitle"></p>
                <!-- Archetype Selection with Navigation -->
                <div id="factorModalArchetypeNav" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--text-muted); min-width: 50px;">DU:</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('ich', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="factorModalIchCode" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Single</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('ich', 1)" title="N√§chster Archetyp">&#8250;</button>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--text-muted); min-width: 50px;">Partner:</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('partner', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="factorModalPartnerCode" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Duo</span>
                        <button class="archetype-nav-btn" onclick="navigateFactorArchetype('partner', 1)" title="N√§chster Archetyp">&#8250;</button>
                    </div>
                </div>
                <div id="factorModalComboCode" style="font-size: 11px; color: var(--text-muted); background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 6px; display: inline-block; margin-bottom: 10px; font-family: monospace;"></div>
                <div class="score-display" id="factorModalScore">0</div>
                <div class="explanation">
                    <h4>Warum dieser Score?</h4>
                    <p id="factorModalExplanation"></p>
                    <h4>Was bedeutet das?</h4>
                    <ul id="factorModalMeaning"></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Pro/Contra Modal (Desktop Circle Click) - higher z-index to appear above Synthese Modal -->
    <div class="modal-overlay" id="proContraModal" onclick="closeProContraModal(event)" style="z-index: 2100;">
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
            <div class="modal-header">
                <span class="modal-title">Pro & Contra</span>
                <button class="modal-close" onclick="closeProContraModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Archetype Navigation -->
                <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--success); min-width: 50px; font-weight: 600;">ICH:</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('ich', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="proContraModalIch" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Single</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('ich', 1)" title="N√§chster Archetyp">&#8250;</button>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <span style="font-size: 11px; color: var(--danger); min-width: 50px; font-weight: 600;">Partner:</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('partner', -1)" title="Vorheriger Archetyp">&#8249;</button>
                        <span id="proContraModalPartner" style="font-size: 12px; color: var(--text-primary); background: rgba(255,255,255,0.08); padding: 4px 12px; border-radius: 6px; min-width: 80px; text-align: center; font-weight: 600;">Duo</span>
                        <button class="archetype-nav-btn" onclick="navigateProContraArchetype('partner', 1)" title="N√§chster Archetyp">&#8250;</button>
                    </div>
                </div>
                <!-- Score Display -->
                <div class="score-display" id="proContraModalScore" style="font-size: 2.5rem; margin-bottom: 15px;">0</div>
                <!-- Pro/Contra Lists -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <h4 style="color: var(--success); margin-bottom: 10px;">‚úì Was funktioniert</h4>
                        <ul id="proContraModalProList" style="list-style: none; padding: 0; margin: 0;"></ul>
                    </div>
                    <div>
                        <h4 style="color: var(--danger); margin-bottom: 10px;">‚úó Herausforderungen</h4>
                        <ul id="proContraModalContraList" style="list-style: none; padding: 0; margin: 0;"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tiage's Synthese Modal -->
    <div class="modal-overlay" id="pathosLogosModal" onclick="closePathosLogosModal(event)">
        <!-- Sticky side toggle buttons for Pathos and Logos - positioned in overlay, right side of modal -->
        <div id="pathosLogosStickyToggle" onclick="event.stopPropagation()" style="position: fixed; left: min(calc(50% + 360px), calc(100% - 60px)); top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 8px; z-index: 1002;">
            <button id="pathosLogosTogglePathos" onclick="showPathosLogosContent('pathos')" style="padding: 12px 14px; border-radius: 8px; border: 1px solid var(--border); background: rgba(30,30,35,0.95); color: var(--text-primary); cursor: pointer; font-size: 16px; transition: all 0.2s; backdrop-filter: blur(10px); box-shadow: 0 2px 12px rgba(0,0,0,0.4);" title="Pathos - Emotionale Resonanz">üî•</button>
            <button id="pathosLogosToggleLogos" onclick="showPathosLogosContent('logos')" style="padding: 12px 14px; border-radius: 8px; border: 1px solid var(--border); background: rgba(30,30,35,0.95); color: var(--text-muted); cursor: pointer; font-size: 16px; transition: all 0.2s; backdrop-filter: blur(10px); box-shadow: 0 2px 12px rgba(0,0,0,0.4);" title="Logos - Rationale Struktur">üß†</button>
        </div>
        <div class="modal" onclick="event.stopPropagation()" style="max-width: 700px; max-height: 85vh; overflow-y: auto; position: relative;">
            <div class="modal-header">
                <span class="modal-title" id="pathosLogosModalTitle">Tiage's Synthese</span>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <button class="header-pathos-btn" id="modalPathosBtn" onclick="showPathosLogosContent('pathos')" title="Pathos - Emotionale Resonanz">üî•</button>
                    <button class="header-logos-btn" id="modalLogosBtn" onclick="showPathosLogosContent('logos')" title="Logos - Rationale Struktur">üß†</button>
                    <button class="modal-close" onclick="closePathosLogosModal()">&times;</button>
                </div>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <!-- Score Summary Line -->
                <div id="syntheseScoreSummaryLine" style="display: flex; align-items: center; justify-content: flex-start; gap: 20px; margin-bottom: 15px; padding: 12px 16px; background: rgba(255,255,255,0.03); border-radius: 10px; border: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 13px; color: var(--text-muted);">Score:</span>
                        <span id="syntheseScoreSummaryValue" style="font-size: 18px; font-weight: 700; color: var(--primary);">--</span>
                    </div>
                    <div style="width: 1px; height: 20px; background: var(--border);"></div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 13px; color: var(--text-muted);">Bed√ºrfnis-√úbereinstimmung:</span>
                        <span id="syntheseNeedsSummaryValue" style="font-size: 18px; font-weight: 700; color: var(--success);">--</span>
                    </div>
                </div>
                <!-- Type indicator -->
                <div id="pathosLogosTypeIndicator" style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                    <span style="font-size: 24px;" id="pathosLogosIcon">üî•</span>
                    <div>
                        <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;" id="pathosLogosCategory">Dynamische Qualit√§t</div>
                        <div style="font-size: 14px; color: var(--text-primary); font-weight: 600;" id="pathosLogosSubtitle">Emotionale Verbindung</div>
                    </div>
                </div>
                <!-- Archetype context with navigation -->
                <div id="pathosLogosArchetypeContext" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 20px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                    <!-- ICH Navigation -->
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <button onclick="navigatePathosLogosArchetype('ich', -1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="Vorheriger Archetyp">‚Äπ</button>
                        <div style="text-align: center; min-width: 70px;">
                            <div style="font-size: 10px; color: var(--success); font-weight: 600; margin-bottom: 4px;">ICH</div>
                            <div style="font-size: 13px; color: var(--text-primary);" id="pathosLogosModalIch">Duo</div>
                        </div>
                        <button onclick="navigatePathosLogosArchetype('ich', 1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="N√§chster Archetyp">‚Ä∫</button>
                    </div>
                    <div style="font-size: 18px; color: var(--text-muted);">√ó</div>
                    <!-- PARTNER Navigation -->
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <button onclick="navigatePathosLogosArchetype('partner', -1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="Vorheriger Archetyp">‚Äπ</button>
                        <div style="text-align: center; min-width: 70px;">
                            <div style="font-size: 10px; color: var(--danger); font-weight: 600; margin-bottom: 4px;">PARTNER</div>
                            <div style="font-size: 13px; color: var(--text-primary);" id="pathosLogosModalPartner">Poly Hedo</div>
                        </div>
                        <button onclick="navigatePathosLogosArchetype('partner', 1)" style="background: transparent; border: 1px solid var(--border); color: var(--text-muted); width: 24px; height: 24px; border-radius: 4px; cursor: pointer; font-size: 14px; line-height: 1;" title="N√§chster Archetyp">‚Ä∫</button>
                    </div>
                </div>
                <!-- Main content -->
                <div id="pathosLogosModalContent" style="font-size: 15px; line-height: 1.7; color: var(--text-secondary);">
                    <!-- Content will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Archetype Info Modal (Feature 4) -->
    <!-- archetypeInfoModal wurde mit definitionModal zusammengef√ºhrt -->

    <header>
        <div class="header-content">
            <h1 data-i18n="ui.title">DAS ANARCHISCHE TI-AGE PRINZIP DER PAARUNG</h1>
            <div class="header-buttons">
                <button class="fold-unfold-btn header-fold-btn" id="foldUnfoldAllBtn" onclick="toggleAllDimensionsCollapse()" title="Fold/Unfold all fields">
                    <span class="fold-unfold-icon">‚ñº</span>
                    <span class="fold-unfold-text">Fold</span>
                </button>
                <button class="lang-btn" onclick="TiageI18n.toggle(); updateAllTranslations();" title="Switch Language / Sprache wechseln">
                    <span class="lang-icon">üåê</span>
                    <span class="lang-code" id="currentLangCode">DE</span>
                </button>
                <button class="help-btn" onclick="openHelpModal()" title="Hilfe & Dokumentation">?</button>
            </div>
        </div>
    </header>

    <!-- Desktop Selection Info Message -->
    <div class="selection-info-message" id="desktopSelectionInfo"></div>

    <!-- NEW: Side-by-Side Comparison Layout (Desktop) -->
    <div class="comparison-container desktop-mode" id="comparisonView">
        <!-- Two Column Grid -->
        <div class="comparison-grid">
            <!-- ICH Column -->
            <div class="comparison-column ich-column">
                <div class="column-header">
                    <div class="column-icon">üë§</div>
                    <div class="column-title">DU</div>
                </div>
                <div class="select-with-info">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="ichSelect">
                        <option value="single" title="Bewusste Entscheidung f√ºr ein autonomes Leben ohne Prim√§rbeziehung">Single</option>
                        <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivit√§t">Duo</option>
                        <option value="duo_flex" title="Prim√§re Zweierbeziehung mit vereinbarten √ñffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch gef√ºhrte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="RA - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', 1)" title="N√§chster Archetyp">&#9654;</button>
                    <button class="archetype-info-btn" onclick="showArchetypeInfo('ich')" title="Info zum Archetyp">INFO</button>
                </div>
                <!-- Archetypen-Symbol-Grid f√ºr ICH -->
                <div class="archetype-symbols-grid" id="ich-archetype-grid">
                    <div class="archetype-symbol-item active" data-archetype="single" onclick="selectArchetypeFromGrid('ich', 'single')">
                        <span class="archetype-symbol-icon">‚òÖ</span>
                        <span class="archetype-symbol-name">Single</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo" onclick="selectArchetypeFromGrid('ich', 'duo')">
                        <span class="archetype-symbol-icon">‚ô°</span>
                        <span class="archetype-symbol-name">Duo</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo_flex" onclick="selectArchetypeFromGrid('ich', 'duo_flex')">
                        <span class="archetype-symbol-icon">‚ö°</span>
                        <span class="archetype-symbol-name">Duo-Flex</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="solopoly" onclick="selectArchetypeFromGrid('ich', 'solopoly')">
                        <span class="archetype-symbol-icon">‚óÜ</span>
                        <span class="archetype-symbol-name">Solopoly</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="polyamor" onclick="selectArchetypeFromGrid('ich', 'polyamor')">
                        <span class="archetype-symbol-icon">‚ô•</span>
                        <span class="archetype-symbol-name">Polyamor</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="ra" onclick="selectArchetypeFromGrid('ich', 'ra')">
                        <span class="archetype-symbol-icon">‚àû</span>
                        <span class="archetype-symbol-name">RA</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="lat" onclick="selectArchetypeFromGrid('ich', 'lat')">
                        <span class="archetype-symbol-icon">‚åÇ</span>
                        <span class="archetype-symbol-name">LAT</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="aromantisch" onclick="selectArchetypeFromGrid('ich', 'aromantisch')">
                        <span class="archetype-symbol-icon">‚óá</span>
                        <span class="archetype-symbol-name">Aromantisch</span>
                    </div>
                </div>
                <div class="header-geschlecht-info" id="ich-header-geschlecht"></div>
                <div class="header-geschlecht-info" id="ich-header-dominanz"></div>
                <div class="header-geschlecht-info" id="ich-header-orientierung"></div>
                <div class="column-dimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="ich-geschlecht-new">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link">Geschlechtsidentit√§t</span> <span id="ich-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="ich-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="ich-geschlecht-grid" data-person="ich"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="ich-dominanz-multi">
                        <div class="compact-dimension-label"><span class="dominanz-info-link">Dominanz</span> <span id="ich-dominanz-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="ich-dominanz-summary"></div>
                        <div class="dominanz-grid" id="ich-dominanz-grid" data-person="ich"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="ich-orientierung-multi">
                        <div class="compact-dimension-label"><span class="orientierung-info-link">Orientierung</span> <span id="ich-orientierung-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="ich-orientierung-summary"></div>
                        <div class="orientierung-grid" id="ich-orientierung-grid" data-person="ich"></div>
                    </div>
                    <div class="compact-dimension collapsible-dimension" data-dimension="ich-gfk">
                        <div class="compact-dimension-label"><span class="gfk-info-link">GFK-Kompetenz</span></div>
                        <div class="collapsed-summary" id="ich-gfk-summary"></div>
                        <div class="gfk-grid" id="ich-gfk-grid" data-person="ich"></div>
                    </div>
                </div>
            </div>

            <!-- Center Column - Score Circle & Lightbulb Button -->
            <div class="center-column">
                <!-- Score Label -->
                <div class="score-label">SCORE</div>
                <!-- Score Circle -->
                <div class="score-circle-display" id="mainScoreCircle" onclick="openProContraModal()" title="Klicken f√ºr Pro & Contra Details">
                    <svg viewBox="0 0 100 100">
                        <circle class="score-bg" cx="50" cy="50" r="42"></circle>
                        <circle class="score-progress" id="mainScoreProgress" cx="50" cy="50" r="42" stroke-dasharray="264" stroke-dashoffset="264"></circle>
                    </svg>
                    <div class="score-circle-value" id="mainScoreValue">0</div>
                </div>
                <!-- Lightbulb Button -->
                <div class="lightbulb-button" onclick="openPathosLogosModal('pathos')" title="Tiage's Synthese - Pathos & Logos">
                    <span class="lightbulb-icon">üí°</span>
                    <span class="lightbulb-text">Tiage's Synthese</span>
                </div>
            </div>

            <!-- PARTNER Column -->
            <div class="comparison-column partner-column">
                <div class="column-header">
                    <div class="column-icon">üë•</div>
                    <div class="column-title">PARTNER</div>
                </div>
                <div class="select-with-info">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="partnerSelect">
                        <option value="single" title="Bewusste Entscheidung f√ºr ein autonomes Leben ohne Prim√§rbeziehung">Single</option>
                        <option value="duo" selected title="Traditionelle monogame Zweierbeziehung mit Exklusivit√§t">Duo</option>
                        <option value="duo_flex" title="Prim√§re Zweierbeziehung mit vereinbarten √ñffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch gef√ºhrte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="RA - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', 1)" title="N√§chster Archetyp">&#9654;</button>
                    <button class="archetype-info-btn" onclick="showArchetypeInfo('partner')" title="Info zum Archetyp">INFO</button>
                </div>
                <!-- Archetypen-Symbol-Grid f√ºr PARTNER -->
                <div class="archetype-symbols-grid" id="partner-archetype-grid">
                    <div class="archetype-symbol-item" data-archetype="single" onclick="selectArchetypeFromGrid('partner', 'single')">
                        <span class="archetype-symbol-icon">‚òÖ</span>
                        <span class="archetype-symbol-name">Single</span>
                    </div>
                    <div class="archetype-symbol-item active" data-archetype="duo" onclick="selectArchetypeFromGrid('partner', 'duo')">
                        <span class="archetype-symbol-icon">‚ô°</span>
                        <span class="archetype-symbol-name">Duo</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo_flex" onclick="selectArchetypeFromGrid('partner', 'duo_flex')">
                        <span class="archetype-symbol-icon">‚ö°</span>
                        <span class="archetype-symbol-name">Duo-Flex</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="solopoly" onclick="selectArchetypeFromGrid('partner', 'solopoly')">
                        <span class="archetype-symbol-icon">‚óÜ</span>
                        <span class="archetype-symbol-name">Solopoly</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="polyamor" onclick="selectArchetypeFromGrid('partner', 'polyamor')">
                        <span class="archetype-symbol-icon">‚ô•</span>
                        <span class="archetype-symbol-name">Polyamor</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="ra" onclick="selectArchetypeFromGrid('partner', 'ra')">
                        <span class="archetype-symbol-icon">‚àû</span>
                        <span class="archetype-symbol-name">RA</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="lat" onclick="selectArchetypeFromGrid('partner', 'lat')">
                        <span class="archetype-symbol-icon">‚åÇ</span>
                        <span class="archetype-symbol-name">LAT</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="aromantisch" onclick="selectArchetypeFromGrid('partner', 'aromantisch')">
                        <span class="archetype-symbol-icon">‚óá</span>
                        <span class="archetype-symbol-name">Aromantisch</span>
                    </div>
                </div>
                <div class="header-geschlecht-info" id="partner-header-geschlecht"></div>
                <div class="header-geschlecht-info" id="partner-header-dominanz"></div>
                <div class="header-geschlecht-info" id="partner-header-orientierung"></div>
                <div class="column-dimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="partner-geschlecht-new">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link">Geschlechtsidentit√§t</span> <span id="partner-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="partner-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="partner-geschlecht-grid" data-person="partner"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="partner-dominanz-multi">
                        <div class="compact-dimension-label"><span class="dominanz-info-link">Dominanz</span> <span id="partner-dominanz-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="partner-dominanz-summary"></div>
                        <div class="dominanz-grid" id="partner-dominanz-grid" data-person="partner"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="partner-orientierung-multi">
                        <div class="compact-dimension-label"><span class="orientierung-info-link">Orientierung</span> <span id="partner-orientierung-legend" class="geschlecht-legend" style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="partner-orientierung-summary"></div>
                        <div class="orientierung-grid" id="partner-orientierung-grid" data-person="partner"></div>
                    </div>
                    <div class="compact-dimension collapsible-dimension" data-dimension="partner-gfk">
                        <div class="compact-dimension-label"><span class="gfk-info-link">GFK-Kompetenz</span></div>
                        <div class="collapsed-summary" id="partner-gfk-summary"></div>
                        <div class="gfk-grid" id="partner-gfk-grid" data-person="partner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- GFK Bed√ºrfnis-Matching Anzeige -->
        <div id="gfk-beduerfnis-display" class="gfk-beduerfnis-display" style="display: none;">
            <!-- Wird dynamisch durch updateGfkBeduerfnisDisplay() gef√ºllt -->
        </div>

        <!-- Hidden elements for backwards compatibility -->
        <div id="warningsContainer" style="display: none;"></div>
        <div id="desktopScoreNote" class="score-note" style="display: none;"></div>
        <span id="resultIchType" style="display: none;">Single</span>
        <span id="resultPartnerType" style="display: none;">Duo</span>
        <div class="result-progress" style="display: none;">
            <div class="result-progress-fill" id="resultProgressFill" style="width: 0%; background: var(--primary);"></div>
        </div>
        <div class="result-percentage" id="resultPercentage" style="display: none;">0%</div>
        <div class="desktop-score-circle" id="desktopScoreCircle" style="display: none;">
            <span id="desktopCirclePercentage">0%</span>
        </div>
    </div>

    <!-- MOBILE: Multi-Page Swipe Interface -->
    <div class="mobile-multipage" id="mobileMultipage" style="display: none;">

        <!-- PAGE 1: Auswahl -->
        <div class="mobile-page active" id="mobilePage1" data-page="1" data-page-label="Seite 1: ICH">
            <h2 style="text-align: center; color: var(--text-primary); margin-bottom: 20px; font-size: var(--font-lg);">Beziehungsqualit√§t analysieren</h2>

            <!-- ICH Auswahl -->
            <div style="background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); border-top: 3px solid var(--success); padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: var(--success); font-weight: 700; font-size: var(--font-lg);">
                    <span>üë§</span> DU
                </div>
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="mobileIchSelect">
                        <option value="single" title="Bewusste Entscheidung f√ºr ein autonomes Leben ohne Prim√§rbeziehung">Single</option>
                        <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivit√§t">Duo</option>
                        <option value="duo_flex" title="Prim√§re Zweierbeziehung mit vereinbarten √ñffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch gef√ºhrte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="RA - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('ich', 1)" title="N√§chster Archetyp">&#9654;</button>
                    <button onclick="openArchetypeInfo(document.getElementById('mobileIchSelect').value, 'ich')" style="padding: 12px 16px; background: rgba(255,255,255,0.1); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 14px; font-weight: 600; letter-spacing: 0.5px;" title="Info zum Archetyp">INFO</button>
                </div>
                <!-- Archetypen-Symbol-Grid f√ºr ICH (Mobile) -->
                <div class="archetype-symbols-grid" id="mobile-ich-archetype-grid">
                    <div class="archetype-symbol-item active" data-archetype="single" onclick="selectArchetypeFromGrid('ich', 'single')">
                        <span class="archetype-symbol-icon">‚òÖ</span>
                        <span class="archetype-symbol-name">Single</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo" onclick="selectArchetypeFromGrid('ich', 'duo')">
                        <span class="archetype-symbol-icon">‚ô°</span>
                        <span class="archetype-symbol-name">Duo</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo_flex" onclick="selectArchetypeFromGrid('ich', 'duo_flex')">
                        <span class="archetype-symbol-icon">‚ö°</span>
                        <span class="archetype-symbol-name">Duo-Flex</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="solopoly" onclick="selectArchetypeFromGrid('ich', 'solopoly')">
                        <span class="archetype-symbol-icon">‚óÜ</span>
                        <span class="archetype-symbol-name">Solopoly</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="polyamor" onclick="selectArchetypeFromGrid('ich', 'polyamor')">
                        <span class="archetype-symbol-icon">‚ô•</span>
                        <span class="archetype-symbol-name">Polyamor</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="ra" onclick="selectArchetypeFromGrid('ich', 'ra')">
                        <span class="archetype-symbol-icon">‚àû</span>
                        <span class="archetype-symbol-name">RA</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="lat" onclick="selectArchetypeFromGrid('ich', 'lat')">
                        <span class="archetype-symbol-icon">‚åÇ</span>
                        <span class="archetype-symbol-name">LAT</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="aromantisch" onclick="selectArchetypeFromGrid('ich', 'aromantisch')">
                        <span class="archetype-symbol-icon">‚óá</span>
                        <span class="archetype-symbol-name">Aromantisch</span>
                    </div>
                </div>
                <div class="mobile-header-info-container">
                    <div class="header-geschlecht-info" id="mobile-ich-header-geschlecht"></div>
                    <div class="header-geschlecht-info" id="mobile-ich-header-dominanz"></div>
                    <div class="header-geschlecht-info" id="mobile-ich-header-orientierung"></div>
                </div>
                <div class="column-dimensions" id="mobileIchDimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-ich-geschlecht">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link">Geschlechtsidentit√§t</span> <span id="mobile-ich-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="mobile-ich-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="mobile-ich-geschlecht-grid" data-person="ich"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-ich-dominanz-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="dominanz-info-link" onclick="event.stopPropagation()">Dominanz</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('dominanzStatus')">(P=Prim√§r, S=Sekund√§r)</span></span>
                            <span class="collapse-toggle">‚ñº</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-ich-dominanz-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-ich-d-dom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</span>
                                <div id="m-ich-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'dominant', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-d-sub-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</span>
                                <div id="m-ich-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-d-sw-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('switch')" style="cursor: pointer;">switch</span>
                                <div id="m-ich-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'switch', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-d-aus-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</span>
                                <div id="m-ich-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-ich-orientierung-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="orientierung-info-link" onclick="event.stopPropagation()">Orientierung</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('status')">(P=Prim√§r, S=Sekund√§r)</span></span>
                            <span class="collapse-toggle">‚ñº</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-ich-orientierung-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-ich-o-het-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</span>
                                <div id="m-ich-o-het-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-o-hom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</span>
                                <div id="m-ich-o-hom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-ich-o-bi-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</span>
                                <div id="m-ich-o-bi-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- GFK-Kompetenz Grid f√ºr ICH (Mobile) -->
                    <div class="compact-dimension collapsible-dimension" data-dimension="mobile-ich-gfk">
                        <div class="compact-dimension-label"><span class="gfk-info-link">GFK-Kompetenz</span></div>
                        <div class="collapsed-summary" id="mobile-ich-gfk-summary"></div>
                        <div class="gfk-grid" id="mobile-ich-gfk-grid" data-person="ich"></div>
                    </div>
                </div>
            </div>

            <button class="btn-primary-mobile" onclick="mobileGoToPage(2)">Weiter zum Partner ‚Üí</button>

            <!-- Reset Button -->
            <button onclick="resetAll()" style="width: 100%; padding: 14px; margin-top: 12px; background: transparent; border: 1px solid rgba(255,255,255,0.3); border-radius: 12px; color: rgba(255,255,255,0.7); font-size: var(--font-base); cursor: pointer; transition: all 0.2s;">
                üîÑ Auswahl zur√ºcksetzen
            </button>
        </div>

        <!-- PAGE 2: Partner-Auswahl (NEU) -->
        <div class="mobile-page" id="mobilePage2" data-page="2" data-page-label="Seite 2: PARTNER">
            <div class="page-header">
                <button class="btn-back" onclick="mobileGoToPage(1)">‚Üê</button>
                <span class="page-title">Dein Partner</span>
            </div>

            <!-- PARTNER Auswahl -->
            <div style="background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border); border-top: 3px solid var(--danger); padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: var(--danger); font-weight: 700; font-size: var(--font-lg);">
                    <span>üë•</span> DEIN PARTNER
                </div>
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', -1)" title="Vorheriger Archetyp">&#9664;</button>
                    <select class="column-select" id="mobilePartnerSelect">
                        <option value="single" title="Bewusste Entscheidung f√ºr ein autonomes Leben ohne Prim√§rbeziehung">Single</option>
                        <option value="duo" selected title="Traditionelle monogame Zweierbeziehung mit Exklusivit√§t">Duo</option>
                        <option value="duo_flex" title="Prim√§re Zweierbeziehung mit vereinbarten √ñffnungen">Duo-Flex</option>
                        <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                        <option value="polyamor" title="Mehrere gleichzeitige, ethisch gef√ºhrte Liebesbeziehungen">Polyamor</option>
                        <option value="ra" title="RA - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                        <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                        <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                    </select>
                    <button class="archetype-nav-btn" onclick="navigateArchetype('partner', 1)" title="N√§chster Archetyp">&#9654;</button>
                    <button onclick="openArchetypeInfo(document.getElementById('mobilePartnerSelect').value, 'partner')" style="padding: 12px 16px; background: rgba(255,255,255,0.1); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 14px; font-weight: 600; letter-spacing: 0.5px;" title="Info zum Archetyp">INFO</button>
                </div>
                <!-- Archetypen-Symbol-Grid f√ºr PARTNER (Mobile) -->
                <div class="archetype-symbols-grid" id="mobile-partner-archetype-grid">
                    <div class="archetype-symbol-item" data-archetype="single" onclick="selectArchetypeFromGrid('partner', 'single')">
                        <span class="archetype-symbol-icon">‚òÖ</span>
                        <span class="archetype-symbol-name">Single</span>
                    </div>
                    <div class="archetype-symbol-item active" data-archetype="duo" onclick="selectArchetypeFromGrid('partner', 'duo')">
                        <span class="archetype-symbol-icon">‚ô°</span>
                        <span class="archetype-symbol-name">Duo</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="duo_flex" onclick="selectArchetypeFromGrid('partner', 'duo_flex')">
                        <span class="archetype-symbol-icon">‚ö°</span>
                        <span class="archetype-symbol-name">Duo-Flex</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="solopoly" onclick="selectArchetypeFromGrid('partner', 'solopoly')">
                        <span class="archetype-symbol-icon">‚óÜ</span>
                        <span class="archetype-symbol-name">Solopoly</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="polyamor" onclick="selectArchetypeFromGrid('partner', 'polyamor')">
                        <span class="archetype-symbol-icon">‚ô•</span>
                        <span class="archetype-symbol-name">Polyamor</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="ra" onclick="selectArchetypeFromGrid('partner', 'ra')">
                        <span class="archetype-symbol-icon">‚àû</span>
                        <span class="archetype-symbol-name">RA</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="lat" onclick="selectArchetypeFromGrid('partner', 'lat')">
                        <span class="archetype-symbol-icon">‚åÇ</span>
                        <span class="archetype-symbol-name">LAT</span>
                    </div>
                    <div class="archetype-symbol-item" data-archetype="aromantisch" onclick="selectArchetypeFromGrid('partner', 'aromantisch')">
                        <span class="archetype-symbol-icon">‚óá</span>
                        <span class="archetype-symbol-name">Aromantisch</span>
                    </div>
                </div>
                <div class="mobile-header-info-container">
                    <div class="header-geschlecht-info" id="mobile-partner-header-geschlecht"></div>
                    <div class="header-geschlecht-info" id="mobile-partner-header-dominanz"></div>
                    <div class="header-geschlecht-info" id="mobile-partner-header-orientierung"></div>
                </div>
                <div class="column-dimensions" id="mobilePartnerDimensions">
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-partner-geschlecht">
                        <div class="compact-dimension-label"><span class="geschlecht-info-link">Geschlechtsidentit√§t</span> <span id="mobile-partner-geschlecht-legend" class="geschlecht-legend" style="font-size: 10px; opacity: 0.7;">(<span class="legend-p">P</span>=Prim√§r, <span class="legend-s">S</span>=Sekund√§r)</span></div>
                        <div class="collapsed-summary" id="mobile-partner-geschlecht-summary"></div>
                        <div class="geschlecht-grid" id="mobile-partner-geschlecht-grid" data-person="partner"></div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-partner-dominanz-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="dominanz-info-link" onclick="event.stopPropagation()">Dominanz</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('dominanzStatus')">(P=Prim√§r, S=Sekund√§r)</span></span>
                            <span class="collapse-toggle">‚ñº</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-partner-dominanz-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-partner-d-dom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</span>
                                <div id="m-partner-d-dom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'dominant', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'dominant', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-d-sub-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</span>
                                <div id="m-partner-d-sub-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-d-sw-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('switch')" style="cursor: pointer;">switch</span>
                                <div id="m-partner-d-sw-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'switch', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'switch', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-d-aus-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</span>
                                <div id="m-partner-d-aus-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="compact-dimension needs-selection collapsible-dimension" data-dimension="mobile-partner-orientierung-multi">
                        <div class="compact-dimension-label" onclick="toggleDimensionCollapse(this.parentElement)">
                            <span><span class="orientierung-info-link" onclick="event.stopPropagation()">Orientierung</span> <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="event.stopPropagation(); showDimensionTooltip('status')">(P=Prim√§r, S=Sekund√§r)</span></span>
                            <span class="collapse-toggle">‚ñº</span>
                        </div>
                        <div class="collapsed-summary" id="mobile-partner-orientierung-summary"></div>
                        <div class="dominanz-multi-select">
                            <div class="dominanz-option-row" id="m-partner-o-het-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</span>
                                <div id="m-partner-o-het-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-o-hom-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</span>
                                <div id="m-partner-o-hom-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                            <div class="dominanz-option-row" id="m-partner-o-bi-row">
                                <span class="dominanz-label" onclick="showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</span>
                                <div id="m-partner-o-bi-status" class="status-toggle-group">
                                    <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                    <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- GFK-Kompetenz Grid f√ºr PARTNER (Mobile) -->
                    <div class="compact-dimension collapsible-dimension" data-dimension="mobile-partner-gfk">
                        <div class="compact-dimension-label"><span class="gfk-info-link">GFK-Kompetenz</span></div>
                        <div class="collapsed-summary" id="mobile-partner-gfk-summary"></div>
                        <div class="gfk-grid" id="mobile-partner-gfk-grid" data-person="partner"></div>
                    </div>
                </div>
            </div>

            <button class="btn-primary-mobile" onclick="mobileGoToPage(3)">Analysieren ‚Üí</button>
        </div>

        <!-- PAGE 3: Ergebnis/Synthese (vorher PAGE 2) -->
        <div class="mobile-page" id="mobilePage3" data-page="3" data-page-label="Seite 3: ERGEBNIS">
            <div class="page-header">
                <button class="btn-back" onclick="mobileGoToPage(2)">‚Üê</button>
                <span class="page-title">Synthese</span>
            </div>

            <div class="types-display" style="flex-direction: column; gap: 8px;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px;">DU:</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('ich', -1)" title="Vorheriger">&#9664;</button>
                    <span class="type-name" id="mobileResultIch" style="min-width: 80px; text-align: center;">Single</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('ich', 1)" title="N√§chster">&#9654;</button>
                </div>
                <span style="font-size: 14px; color: var(--text-muted);">√ó</span>
                <div style="display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px;">Partner:</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('partner', -1)" title="Vorheriger">&#9664;</button>
                    <span class="type-name" id="mobileResultPartner" style="min-width: 80px; text-align: center;">Duo</span>
                    <button class="archetype-nav-btn" onclick="navigateArchetypeOnPage2('partner', 1)" title="N√§chster">&#9654;</button>
                </div>
            </div>

            <div class="score-circle-container">
                <!-- Score Label -->
                <div class="score-label">SCORE</div>
                <!-- Mobile Score Circle -->
                <div class="score-circle-display mobile-score-circle-display" id="mobileScoreCircleDisplay" onclick="openProContraModal()" title="Klicken f√ºr Pro & Contra Details">
                    <svg viewBox="0 0 100 100">
                        <circle class="score-bg" cx="50" cy="50" r="42"></circle>
                        <circle class="score-progress" id="mobileScoreProgress" cx="50" cy="50" r="42" stroke-dasharray="264" stroke-dashoffset="264"></circle>
                    </svg>
                    <div class="score-circle-value" id="mobileScoreCircle">0</div>
                </div>
                <!-- Mobile Lightbulb Button -->
                <div class="lightbulb-button mobile-lightbulb-button" onclick="openPathosLogosModal('pathos')" title="Tiage's Synthese - Pathos & Logos">
                    <span class="lightbulb-icon">üí°</span>
                    <span class="lightbulb-text">Tiage's Synthese</span>
                </div>
                <div id="mobileScoreNote" class="score-note" style="margin-top: 8px; font-size: 13px; color: var(--text-secondary); font-style: italic; text-align: center; max-width: 280px; line-height: 1.4; margin-left: auto; margin-right: auto;"></div>
            </div>

            <!-- GFK Bed√ºrfnis-Matching Anzeige (Mobile) -->
            <div id="mobile-gfk-beduerfnis-display" class="gfk-beduerfnis-display" style="display: none;">
                <!-- Wird dynamisch durch updateGfkBeduerfnisDisplay() gef√ºllt -->
            </div>
        </div>

        <!-- Page Indicator (nur 3 Seiten) -->
        <div class="page-indicator">
            <span class="page-dot active" onclick="mobileGoToPage(1)"></span>
            <span class="page-dot" onclick="mobileGoToPage(2)"></span>
            <span class="page-dot" onclick="mobileGoToPage(3)"></span>
        </div>
    </div>

    <!-- OLD Carousel (hidden) -->
    <div class="carousel-container" id="carousel" style="display: none;">
        <!-- CARD 1: MEIN TYP -->
        <div class="card" data-card="0">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Mein Typ</span>
                </div>
                <div class="card-body">
                    <div class="main-select">
                        <label class="main-select-label">Ich bin...</label>
                        <select id="archetypeSelect">
                            <option value="single" title="Bewusste Entscheidung f√ºr ein autonomes Leben ohne Prim√§rbeziehung">Single</option>
                            <option value="duo" title="Traditionelle monogame Zweierbeziehung mit Exklusivit√§t">Duo</option>
                            <option value="duo_flex" title="Prim√§re Zweierbeziehung mit vereinbarten √ñffnungen">Duo-Flex</option>
                            <option value="solopoly" title="Mehrere gleichwertige Beziehungen bei Bewahrung der Autonomie">Solopoly</option>
                            <option value="polyamor" title="Mehrere gleichzeitige, ethisch gef√ºhrte Liebesbeziehungen">Polyamor</option>
                            <option value="ra" title="RA - Ablehnung aller Beziehungs-Hierarchien und Labels">RA</option>
                            <option value="lat" title="Living Apart Together - Feste Partnerschaft ohne Zusammenleben">LAT</option>
                            <option value="aromantisch" title="Fokus auf platonische Verbindungen ohne romantische Komponente">Aromantisch</option>
                        </select>
                    </div>

                    <!-- Extended Dimensions: ICH -->
                    <div class="dimensions-section">
                        <div class="dimensions-section-title ich-title">Meine Eigenschaften</div>
                        <div class="dimensions-grid">
                            <!-- Geschlechtsidentit√§t -->
                            <div class="dimension-group needs-selection" data-dimension="ich-geschlecht">
                                <div class="dimension-label">
                                    <span class="geschlecht-info-link">Geschlechtsidentit√§t</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(P=Prim√§r, S=Sekund√§r)</span>
                                </div>
                                <div class="geschlecht-grid" id="modal-ich-geschlecht-grid" data-person="ich"></div>
                            </div>

                            <!-- Dominanz Multi-Select -->
                            <div class="dimension-group needs-selection" data-dimension="modal-ich-dominanz-multi">
                                <div class="dimension-label">
                                    Dominanz
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(P=Prim√§r, S=Sekund√§r)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-ich-d-dom-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</span>
                                        <div id="modal-ich-d-dom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'dominant', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'dominant', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-d-sub-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</span>
                                        <div id="modal-ich-d-sub-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'submissiv', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-d-sw-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('switch')" style="cursor: pointer;">switch</span>
                                        <div id="modal-ich-d-sw-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'switch', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'switch', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-d-aus-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</span>
                                        <div id="modal-ich-d-aus-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('ich', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sexuelle Orientierung -->
                            <div class="dimension-group full-width needs-selection" data-dimension="modal-ich-orientierung-multi">
                                <div class="dimension-label">
                                    Sexuelle Orientierung
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(P=Prim√§r, S=Sekund√§r)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-ich-o-het-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</span>
                                        <div id="modal-ich-o-het-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-o-hom-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</span>
                                        <div id="modal-ich-o-hom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-ich-o-bi-row">
                                        <span class="dominanz-label" onclick="showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</span>
                                        <div id="modal-ich-o-bi-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn" data-status="gelebt" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('ich', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="my-type-header">
                        <div class="my-type-icon" id="myTypeIcon">‚òÖ</div>
                        <div class="type-tooltip">
                            <div class="my-type-name" id="myTypeName">Single</div>
                            <span class="tooltip-text" id="myTypeTooltip"></span>
                        </div>
                        <span class="type-info-icon" id="myTypeInfoIcon" onclick="openDefinitionModal(currentArchetype)" title="Was bedeutet dieser Typ?">‚Ñπ</span>
                    </div>
                    <p class="my-type-desc" id="myTypeDesc">...</p>

                    <!-- Collapsible: Pro/Contra -->
                    <div class="collapsible" id="proContraCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('proContraCollapse')">
                            <span>Pro & Contra ‚Äì Qualit√§tsfaktoren</span>
                            <span class="collapsible-icon">‚ñº</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pro-contra-grid">
                                <div class="mini-list">
                                    <div class="mini-list-title pro">‚úì Pro</div>
                                    <ul id="myTypePro"></ul>
                                </div>
                                <div class="mini-list">
                                    <div class="mini-list-title contra">‚úó Contra</div>
                                    <ul id="myTypeContra"></ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Collapsible: Pathos/Logos -->
                    <div class="collapsible" id="pathosLogosCollapse">
                        <div class="collapsible-header" onclick="toggleCollapsible('pathosLogosCollapse')">
                            <span>Pathos & Logos ‚Äì Dynamische Qualit√§t</span>
                            <span class="collapsible-icon">‚ñº</span>
                        </div>
                        <div class="collapsible-content">
                            <div class="pathos-logos-content">
                                <p id="myTypePathos"></p>
                                <p id="myTypeLogos"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Match Section -->
                    <div class="match-section">
                        <div class="match-card top" id="topMatchCard" onclick="openMatchModal('top')">
                            <div class="match-info">
                                <div class="match-dot" id="topMatchDot"></div>
                                <div>
                                    <div class="match-label-text">Top Match</div>
                                    <div class="match-name" id="topMatchName">...</div>
                                </div>
                            </div>
                            <div class="match-score excellent" id="topMatchScore">0</div>
                        </div>

                        <div class="match-card challenge" id="challengeCard" onclick="openMatchModal('challenge')">
                            <div class="match-info">
                                <div class="match-dot" id="challengeDot"></div>
                                <div>
                                    <div class="match-label-text">Challenge</div>
                                    <div class="match-name" id="challengeName">...</div>
                                </div>
                            </div>
                            <div class="match-score low" id="challengeScore">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 2: BEZIEHUNGSQUALIT√ÑT -->
        <div class="card" data-card="1">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Beziehungsqualit√§t</span>
                </div>
                <div class="card-body">
                    <!-- Partner Selector -->
                    <div class="partner-selector" id="partnerSelector"></div>

                    <!-- Extended Dimensions: PARTNER -->
                    <div class="dimensions-section" style="margin-top: 0; padding-top: 15px; border-top: none;">
                        <div class="dimensions-section-title partner-title">Partner-Eigenschaften</div>
                        <div class="dimensions-grid">
                            <!-- Geschlecht -->
                            <div class="dimension-group needs-selection" data-dimension="partner-geschlecht">
                                <div class="dimension-label">
                                    <span class="geschlecht-info-link">Geschlechtsidentit√§t</span>
                                    <span style="font-size: 10px; opacity: 0.7;">(P=Prim√§r, S=Sekund√§r)</span>
                                </div>
                                <div class="geschlecht-grid" id="modal-partner-geschlecht-grid" data-person="partner"></div>
                            </div>

                            <!-- Dominanz Multi-Select -->
                            <div class="dimension-group needs-selection" data-dimension="modal-partner-dominanz-multi">
                                <div class="dimension-label">
                                    Dominanz
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('dominanzStatus')">(P=Prim√§r, S=Sekund√§r)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-partner-d-dom-row">
                                        <input type="checkbox" id="modal-partner-d-dom" value="dominant" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'dominant', this.checked)">
                                        <label for="modal-partner-d-dom" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('dominant')" style="cursor: pointer;">dominant</label>
                                        <button type="button" id="modal-partner-d-dom-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'dominant', this)">interessiert</button>
                                        <div id="modal-partner-d-dom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'dominant', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'dominant', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-d-sub-row">
                                        <input type="checkbox" id="modal-partner-d-sub" value="submissiv" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'submissiv', this.checked)">
                                        <label for="modal-partner-d-sub" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('submissiv')" style="cursor: pointer;">submissiv</label>
                                        <button type="button" id="modal-partner-d-sub-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'submissiv', this)">interessiert</button>
                                        <div id="modal-partner-d-sub-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'submissiv', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-d-sw-row">
                                        <input type="checkbox" id="modal-partner-d-sw" value="switch" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'switch', this.checked)">
                                        <label for="modal-partner-d-sw" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('switch')" style="cursor: pointer;">switch</label>
                                        <button type="button" id="modal-partner-d-sw-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'switch', this)">interessiert</button>
                                        <div id="modal-partner-d-sw-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'switch', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'switch', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-d-aus-row">
                                        <input type="checkbox" id="modal-partner-d-aus" value="ausgeglichen" class="dominanz-checkbox" onchange="handleModalDominanzMultiChange('partner', 'ausgeglichen', this.checked)">
                                        <label for="modal-partner-d-aus" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('ausgeglichen')" style="cursor: pointer;">ausgeglichen</label>
                                        <button type="button" id="modal-partner-d-aus-secondary" class="secondary-interessiert-btn" onclick="handleSecondaryInteressiert('partner', 'ausgeglichen', this)">interessiert</button>
                                        <div id="modal-partner-d-aus-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleDominanzStatusToggle('partner', 'ausgeglichen', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sexuelle Orientierung -->
                            <div class="dimension-group full-width needs-selection" data-dimension="modal-partner-orientierung-multi">
                                <div class="dimension-label">
                                    Sexuelle Orientierung
                                    <span style="font-size: 10px; text-decoration: underline; cursor: pointer;" onclick="showDimensionTooltip('status')">(P=Prim√§r, S=Sekund√§r)</span>
                                </div>
                                <div class="dominanz-multi-select">
                                    <div class="dominanz-option-row" id="modal-partner-o-het-row">
                                        <input type="checkbox" id="modal-partner-o-het" value="heterosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'heterosexuell', this.checked)">
                                        <label for="modal-partner-o-het" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('heterosexuell')" style="cursor: pointer;">heterosexuell</label>
                                        <button type="button" id="modal-partner-o-het-secondary" class="secondary-interessiert-btn" onclick="handleOrientierungSecondaryInteressiert('partner', 'heterosexuell', this)">interessiert</button>
                                        <div id="modal-partner-o-het-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'heterosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-o-hom-row">
                                        <input type="checkbox" id="modal-partner-o-hom" value="homosexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'homosexuell', this.checked)">
                                        <label for="modal-partner-o-hom" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('homosexuell')" style="cursor: pointer;">homosexuell</label>
                                        <button type="button" id="modal-partner-o-hom-secondary" class="secondary-interessiert-btn" onclick="handleOrientierungSecondaryInteressiert('partner', 'homosexuell', this)">interessiert</button>
                                        <div id="modal-partner-o-hom-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'homosexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                    <div class="dominanz-option-row" id="modal-partner-o-bi-row">
                                        <input type="checkbox" id="modal-partner-o-bi" value="bisexuell" class="dominanz-checkbox" onchange="handleModalOrientierungMultiChange('partner', 'bisexuell', this.checked)">
                                        <label for="modal-partner-o-bi" class="dominanz-label" onclick="event.preventDefault(); showDimensionTooltip('bisexuell')" style="cursor: pointer;">bisexuell</label>
                                        <button type="button" id="modal-partner-o-bi-secondary" class="secondary-interessiert-btn" onclick="handleOrientierungSecondaryInteressiert('partner', 'bisexuell', this)">interessiert</button>
                                        <div id="modal-partner-o-bi-status" class="status-toggle-group">
                                            <button type="button" class="status-toggle-btn active-gelebt" data-status="gelebt" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'gelebt', this)">Gelebt</button>
                                            <button type="button" class="status-toggle-btn" data-status="interessiert" onclick="handleOrientierungStatusToggle('partner', 'bisexuell', 'interessiert', this)">Interessiert</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Overview Box -->
                    <div class="analysis-overview" id="analysisOverview" onclick="scrollToCard(0)">
                        <div class="analysis-overview-title">
                            <span>üîç</span> Analysiere:
                        </div>
                        <div class="analysis-overview-content" id="analysisOverviewContent">
                            <span class="type-name">Single</span> <span class="dim-info">(?, ?, ?)</span>
                            <span> √ó </span>
                            <span class="type-name">Duo</span> <span class="dim-info">(?, ?, ?)</span>
                        </div>
                        <span class="analysis-overview-edit">Bearbeiten ‚Üí</span>
                    </div>

                    <!-- PATHOS BLOCKER (K.O. - replaces entire analysis) -->
                    <div class="pathos-blocker" id="pathosBlocker">
                        <div class="pathos-blocker-header">
                            <span class="pathos-blocker-icon">‚õî</span>
                            <span class="pathos-blocker-title">Keine romantische Beziehung m√∂glich</span>
                        </div>
                        <div class="pathos-blocker-reason" id="pathosBlockerReason">
                            Grund: Keine k√∂rperliche Anziehung m√∂glich aufgrund der sexuellen Orientierungen
                        </div>
                        <div class="pathos-blocker-persons">
                            <div class="pathos-blocker-person">
                                <span class="pathos-blocker-person-label">DU:</span>
                                <span id="pathosBlockerPerson1">m√§nnlich, heterosexuell (Gelebt)</span>
                            </div>
                            <div class="pathos-blocker-person">
                                <span class="pathos-blocker-person-label">PARTNER:</span>
                                <span id="pathosBlockerPerson2">m√§nnlich, heterosexuell (Gelebt)</span>
                            </div>
                        </div>
                        <div class="pathos-blocker-divider"></div>
                        <div class="pathos-blocker-explanation">
                            <h4>Pathos vs. Logos</h4>
                            <p>Ohne k√∂rperliche und emotionale Anziehung (Gef√ºhlsebene) kann keine romantische Beziehung entstehen.</p>
                            <p>Im Gegensatz zu philosophischen Differenzen (Verstandsebene), die durch Kommunikation und Lernen √ºberbr√ºckt werden k√∂nnen, ist sexuelle Orientierung (Gef√ºhlsebene) keine Wahl und nicht ver√§nderbar.</p>
                            <p>Das Tiage-Modell analysiert romantische Beziehungen und ist f√ºr diese Konstellation nicht anwendbar.</p>
                        </div>
                        <div class="pathos-blocker-actions">
                            <button class="pathos-blocker-btn pathos-blocker-btn-primary" onclick="scrollToCard(0)">
                                Angaben korrigieren
                            </button>
                            <button class="pathos-blocker-btn pathos-blocker-btn-secondary" onclick="showPathosLogosInfo()">
                                Mehr √ºber Pathos/Logos
                            </button>
                        </div>
                    </div>

                    <!-- LOGOS WARNING (Warning, analysis continues) -->
                    <div class="logos-warning" id="logosWarning" onclick="toggleLogosWarning()">
                        <div class="logos-warning-header">
                            <span class="logos-warning-icon">‚ö†Ô∏è</span>
                            <div class="logos-warning-content">
                                <div class="logos-warning-title" id="logosWarningTitle">Verstandsebene-Warnung: Fundamentale philosophische Unterschiede</div>
                                <div class="logos-warning-subtitle" id="logosWarningSubtitle">Beziehungsphilosophie: 25%</div>
                            </div>
                            <span class="logos-warning-toggle">‚ñº</span>
                        </div>
                        <div class="logos-warning-details">
                            <div class="logos-warning-details-inner">
                                <div class="logos-warning-score">
                                    <span class="logos-warning-score-label">Philosophie-Qualit√§t:</span>
                                    <span class="logos-warning-score-value" id="logosWarningScore">25</span>
                                </div>
                                <p class="logos-warning-text" id="logosWarningText">
                                    Eure Grund√ºberzeugungen √ºber Beziehungen sind sehr unterschiedlich. Dies erfordert intensive Kommunikation und Kompromissbereitschaft.
                                </p>
                                <div class="logos-warning-positive">
                                    <span class="logos-warning-positive-icon">‚úì</span>
                                    <span class="logos-warning-positive-text">ABER: K√∂rperliche Anziehung ist vorhanden!</span>
                                </div>
                                <p class="logos-warning-text">Eine Beziehung ist m√∂glich, erfordert aber:</p>
                                <ul class="logos-warning-list">
                                    <li>Intensive Kommunikation</li>
                                    <li>Fundamentale Kompromisse</li>
                                    <li>Gegenseitiges tiefes Verst√§ndnis</li>
                                </ul>
                                <div class="logos-warning-quote">
                                    "Gef√ºhl kann Br√ºcken bauen, wo der Verstand Widerspr√ºche sieht - aber es wird nicht leicht."
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PATHOS UNCERTAIN (Exploration phase warning) -->
                    <div class="pathos-uncertain" id="pathosUncertain">
                        <span class="pathos-uncertain-icon">üîÑ</span>
                        <span class="pathos-uncertain-text" id="pathosUncertainText">
                            Mindestens eine Person ist in der Explorationsphase (Status: "Interessiert"). Die tats√§chliche k√∂rperliche Anziehung ist noch unklar.
                        </span>
                    </div>

                    <!-- DOUBLE WARNING (Both Pathos uncertain + Logos low) -->
                    <div class="double-warning" id="doubleWarning">
                        <div class="double-warning-header">
                            <span>‚ö†Ô∏è</span>
                            <span class="double-warning-title">Doppelte Herausforderung</span>
                        </div>
                        <div class="double-warning-item">
                            <div class="double-warning-item-title">1. Gef√ºhlsebene: Unsichere k√∂rperliche Anziehung</div>
                            <div class="double-warning-item-text" id="doubleWarningPathos">
                                Partner: bisexuell (interessiert) ‚Üí Exploration-Phase
                            </div>
                        </div>
                        <div class="double-warning-item">
                            <div class="double-warning-item-title">2. Verstandsebene: Philosophische Konflikte</div>
                            <div class="double-warning-item-text" id="doubleWarningLogos">
                                Beziehungsphilosophie: 25% ‚Üí DUO vs. POLYAMOR
                            </div>
                        </div>
                        <p class="logos-warning-text" style="margin-top: 10px; font-size: var(--font-xs);">
                            Sowohl k√∂rperliche als auch philosophische Ebene haben Unsicherheiten.
                        </p>
                    </div>

                    <!-- Compatibility Content Wrapper (hidden when pathos blocked) -->
                    <div id="compatibilityContent">

                    <!-- Modifier Summary (shows dimension influences) -->
                    <div class="modifier-summary" id="modifierSummary">
                        <div class="modifier-summary-title">Dimensions-Einfl√ºsse</div>
                        <div id="modifierSummaryContent">
                            <!-- Dynamically filled -->
                        </div>
                    </div>

                    <!-- Radar Chart -->
                    <div class="radar-section">
                        <div class="radar-header">
                            <div>
                                <div class="radar-title">
                                    <span class="type-tooltip"><span id="myTypeNameDisplay">...</span><span class="tooltip-text" id="myTypeTooltipPage3"></span></span>
                                    mit
                                    <span class="type-tooltip"><span id="partnerNameDisplay">...</span><span class="tooltip-text" id="partnerTooltipPage3"></span></span>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="radar-score" id="overallScore" style="color: var(--primary);">0</div>
                                <div class="radar-score-label">Gesamt</div>
                            </div>
                        </div>
                        <svg id="radarChart" viewBox="0 0 280 260"></svg>
                    </div>

                    <!-- Category Bars -->
                    <div class="category-section">
                        <div class="section-title-row">
                            <div class="section-title" style="margin-bottom: 0;">Kategorie-Details</div>
                            <div class="info-icon" onclick="openCategoryModal()">‚Ñπ</div>
                        </div>
                        <div id="categoryBars"></div>
                    </div>

                    <!-- Pro/Contra Analysis -->
                    <div class="analysis-grid">
                        <div class="analysis-section pro">
                            <div class="analysis-title">‚úì Was funktioniert</div>
                            <ul class="analysis-list" id="partnerPro"></ul>
                        </div>
                        <div class="analysis-section contra">
                            <div class="analysis-title">‚úó Herausforderungen</div>
                            <ul class="analysis-list" id="partnerContra"></ul>
                        </div>
                    </div>
                    </div><!-- End compatibilityContent -->
                </div>
            </div>
        </div>

        <!-- CARD 3: LEGENDE -->
        <div class="card" data-card="2">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Legende</span>
                </div>
                <div class="card-body">
                    <!-- Farbskala -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungsskala</div>
                        <div class="color-scale">
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-good"></div>
                                <span class="color-scale-label">Gut</span>
                                <span class="color-scale-range">70-100%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-medium"></div>
                                <span class="color-scale-label">Mittel</span>
                                <span class="color-scale-range">50-69%</span>
                            </div>
                            <div class="color-scale-item">
                                <div class="color-scale-bar bar-low"></div>
                                <span class="color-scale-label">Herausfordernd</span>
                                <span class="color-scale-range">&lt;50%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Kategorien -->
                    <div class="legend-section">
                        <div class="legend-title">Bewertungskategorien</div>
                        <div id="legendCategories"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 4: FEEDBACK -->
        <div class="card" data-card="3">
            <div class="card-inner">
                <div class="card-header">
                    <span class="card-title">Feedback</span>
                </div>
                <div class="card-body">
                    <!-- Search -->
                    <div class="feedback-search">
                        <input type="text" id="feedbackSearch" placeholder="üîç Suche nach Name, Titel oder Inhalt..." class="feedback-search-input">
                    </div>

                    <!-- Advanced Filters -->
                    <div class="feedback-advanced-filters">
                        <div class="feedback-filter-row">
                            <label>Kombination:</label>
                            <select id="filterMyType" class="feedback-select">
                                <option value="all">Alle Typen</option>
                            </select>
                            <span class="filter-separator">mit</span>
                            <select id="filterPartnerType" class="feedback-select">
                                <option value="all">Alle Partner</option>
                            </select>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Kategorie:</label>
                            <div class="feedback-category-btns" id="categoryFilterBtns">
                                <button class="cat-filter-btn active" data-cat="all">Alle</button>
                                <button class="cat-filter-btn" data-cat="A" title="Beziehungsphilosophie">A Philosophie</button>
                                <button class="cat-filter-btn" data-cat="B" title="Werte-Alignment">B Werte</button>
                                <button class="cat-filter-btn" data-cat="C" title="N√§he-Distanz">C N√§he</button>
                                <button class="cat-filter-btn" data-cat="D" title="Autonomie">D Autonomie</button>
                                <button class="cat-filter-btn" data-cat="E" title="Kommunikation">E Kommunik.</button>
                                <button class="cat-filter-btn" data-cat="F" title="Soziale Kompatibilit√§t">F Sozial</button>
                                <!-- Hidden for now - can be re-enabled later -->
                                <button class="cat-filter-btn" data-cat="TM" title="Top Match" style="display:none">Top Match</button>
                                <button class="cat-filter-btn" data-cat="CH" title="Challenge" style="display:none">Challenge</button>
                            </div>
                        </div>
                        <div class="feedback-filter-row">
                            <label>Sortieren:</label>
                            <select id="filterSort" class="feedback-select">
                                <option value="newest">Neueste zuerst</option>
                                <option value="oldest">√Ñlteste zuerst</option>
                                <option value="rating">Beste Bewertung</option>
                            </select>
                        </div>
                    </div>

                    <!-- Feedback List -->
                    <div class="feedback-list" id="feedbackList">
                        <div class="feedback-loading">Lade Feedback...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal-overlay" id="categoryModal" onclick="closeCategoryModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <button class="archetype-nav-btn" onclick="navigateCategoryArchetype(-1)" title="Vorheriger Archetyp">&#8249;</button>
                <span class="modal-title" id="modalTitle">Kategorie-Details</span>
                <button class="archetype-nav-btn" onclick="navigateCategoryArchetype(1)" title="N√§chster Archetyp">&#8250;</button>
                <div class="match-modal-toggle" style="display: flex; gap: 4px; margin-left: 8px;">
                    <button class="match-toggle-btn active" id="matchTogglePathos" onclick="toggleMatchModalView('pathos')" title="Pathos - Emotionale Resonanz">üî•</button>
                    <button class="match-toggle-btn" id="matchToggleLogos" onclick="toggleMatchModalView('logos')" title="Logos - Rationale Struktur">üß†</button>
                </div>
                <button class="modal-close" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- feedbackModal entfernt - commentModal wird verwendet -->

    <!-- Definition Modal -->
    <div class="modal-overlay" id="definitionModal" onclick="closeDefinitionModal(event)">
        <div class="modal definition-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <button class="archetype-nav-btn" onclick="navigateDefinitionModal(-1)" title="Vorheriger Archetyp">&#8249;</button>
                <span class="modal-title" id="definitionModalTitle">Typ-Definition</span>
                <button class="archetype-nav-btn" onclick="navigateDefinitionModal(1)" title="N√§chster Archetyp">&#8250;</button>
                <button class="modal-close" onclick="closeDefinitionModal()">&times;</button>
            </div>
            <div class="modal-body" id="definitionModalBody"></div>
        </div>
    </div>

    <!-- Dimension Info Tooltip Modal -->
    <div class="dimension-tooltip-overlay" id="dimensionTooltipOverlay" onclick="closeDimensionTooltip()">
        <div class="dimension-tooltip-content" onclick="event.stopPropagation()">
            <div class="dimension-tooltip-title" id="dimensionTooltipTitle">Info</div>
            <div class="dimension-tooltip-text" id="dimensionTooltipText">...</div>
            <button class="dimension-tooltip-close" onclick="closeDimensionTooltip()">Verstanden</button>
        </div>
    </div>

    <!-- Geschlecht Info Modal (scrollable) -->
    <div class="dimension-tooltip-overlay" id="geschlechtInfoModal" onclick="closeGeschlechtInfoModal()">
        <div class="geschlecht-info-modal-content" onclick="event.stopPropagation()">
            <div class="geschlecht-info-modal-header">
                <div class="dimension-tooltip-title">Geschlechtsidentit√§ten</div>
                <button class="geschlecht-info-close-btn" onclick="closeGeschlechtInfoModal()">&times;</button>
            </div>
            <div class="geschlecht-info-scroll-container">
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Cis Mann</div>
                    <div class="geschlecht-info-desc">Person, die bei Geburt m√§nnlich zugewiesen wurde und sich als Mann identifiziert.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Cis Frau</div>
                    <div class="geschlecht-info-desc">Person, die bei Geburt weiblich zugewiesen wurde und sich als Frau identifiziert.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Trans Mann</div>
                    <div class="geschlecht-info-desc">Person, die sich als Mann identifiziert, aber bei Geburt nicht m√§nnlich zugewiesen wurde.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Trans Frau</div>
                    <div class="geschlecht-info-desc">Person, die sich als Frau identifiziert, aber bei Geburt nicht weiblich zugewiesen wurde.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Nonbin√§r</div>
                    <div class="geschlecht-info-desc">Person, die sich weder ausschlie√ülich als Mann noch als Frau identifiziert.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Genderfluid</div>
                    <div class="geschlecht-info-desc">Person, deren Geschlechtsidentit√§t sich √ºber Zeit ver√§ndert oder zwischen verschiedenen Identit√§ten wechselt.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Agender</div>
                    <div class="geschlecht-info-desc">Person, die sich mit keinem Geschlecht identifiziert oder geschlechtslos f√ºhlt.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Intersex</div>
                    <div class="geschlecht-info-desc">Person mit angeborenen k√∂rperlichen Geschlechtsmerkmalen, die nicht eindeutig m√§nnlich oder weiblich sind.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Divers</div>
                    <div class="geschlecht-info-desc">Offizieller dritter Geschlechtseintrag in Deutschland f√ºr Menschen, die sich nicht als m√§nnlich oder weiblich identifizieren.</div>
                </div>
            </div>
            <button class="dimension-tooltip-close" onclick="closeGeschlechtInfoModal()">Schlie√üen</button>
        </div>
    </div>

    <!-- Dominanz Info Modal (scrollable) -->
    <div class="dimension-tooltip-overlay" id="dominanzInfoModal" onclick="closeDominanzInfoModal()">
        <div class="geschlecht-info-modal-content" onclick="event.stopPropagation()">
            <div class="geschlecht-info-modal-header">
                <div class="dimension-tooltip-title">Dominanz-Pr√§ferenzen</div>
                <button class="geschlecht-info-close-btn" onclick="closeDominanzInfoModal()">&times;</button>
            </div>
            <div class="geschlecht-info-scroll-container">
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Dominant</div>
                    <div class="geschlecht-info-desc"><strong>Der F√ºhrende</strong> ‚Äì Du √ºbernimmst gerne F√ºhrung und Verantwortung in Beziehungen. Assertiv, selbstsicher, bestimmend, proaktiv. Direkte Kommunikation, konfrontiert Konflikte aktiv.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Submissiv</div>
                    <div class="geschlecht-info-desc"><strong>Der Folgende</strong> ‚Äì Du l√§sst dich gerne f√ºhren und vertraust auf deinen Partner. Anpassungsf√§hig, empathisch, harmonieorientiert. Indirekte, diplomatische Kommunikation.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Switch</div>
                    <div class="geschlecht-info-desc"><strong>Der Flexible</strong> ‚Äì Du genie√üt beide Rollen je nach Situation und Partner. Wandelbar, vielseitig, experimentierfreudig. Situativ angepasste Kommunikation.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Ausgeglichen</div>
                    <div class="geschlecht-info-desc"><strong>Der Zentrierte</strong> ‚Äì Du bevorzugst eine gleichberechtigte Dynamik ohne feste Rollen. Balanciert, harmonisch, stabil. Ruhige, konstruktive Kommunikation.</div>
                </div>
            </div>
            <button class="dimension-tooltip-close" onclick="closeDominanzInfoModal()">Verstanden</button>
        </div>
    </div>

    <!-- Orientierung Info Modal (scrollable) -->
    <div class="dimension-tooltip-overlay" id="orientierungInfoModal" onclick="closeOrientierungInfoModal()">
        <div class="geschlecht-info-modal-content" onclick="event.stopPropagation()">
            <div class="geschlecht-info-modal-header">
                <div class="dimension-tooltip-title">Sexuelle Orientierungen</div>
                <button class="geschlecht-info-close-btn" onclick="closeOrientierungInfoModal()">&times;</button>
            </div>
            <div class="geschlecht-info-scroll-container">
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Heterosexuell</div>
                    <div class="geschlecht-info-desc"><strong>Anziehung zum anderen Geschlecht</strong> ‚Äì Du f√ºhlst dich romantisch und/oder sexuell zu Menschen des anderen Geschlechts hingezogen.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Homosexuell</div>
                    <div class="geschlecht-info-desc"><strong>Anziehung zum gleichen Geschlecht</strong> ‚Äì Du f√ºhlst dich romantisch und/oder sexuell zu Menschen des gleichen Geschlechts hingezogen.</div>
                </div>
                <div class="geschlecht-info-item">
                    <div class="geschlecht-info-name">Bisexuell</div>
                    <div class="geschlecht-info-desc"><strong>Anziehung zu beiden Geschlechtern</strong> ‚Äì Du f√ºhlst dich romantisch und/oder sexuell zu Menschen beider Geschlechter hingezogen.</div>
                </div>
            </div>
            <button class="dimension-tooltip-close" onclick="closeOrientierungInfoModal()">Verstanden</button>
        </div>
    </div>

    <!-- Navigation Dots with Arrows (hidden - old carousel nav) -->
    <div class="nav-dots" style="display: none;">
        <button class="nav-arrow" onclick="navigatePrev()">‚Äπ</button>
        <div class="nav-dot active" data-card="0" onclick="scrollToCard(0)"></div>
        <div class="nav-dot" data-card="1" onclick="scrollToCard(1)"></div>
        <div class="nav-dot" data-card="2" onclick="scrollToCard(2)"></div>
        <div class="nav-dot" data-card="3" onclick="scrollToCard(3)"></div>
        <button class="nav-arrow" onclick="navigateNext()">‚Ä∫</button>
    </div>

    <div class="swipe-hint" style="display: none;">‚Üê Swipe ‚Üí</div>

    <!-- Footer with Documentation Links -->
    <footer class="app-footer" style="text-align: center; padding: 30px 20px; margin-top: 40px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 13px; color: rgba(255,255,255,0.5);">
        <!-- JOYclub Siegel -->
        <div style="margin-bottom: 25px; display: flex; justify-content: center;">
            <a href="https://www.joyclub.de/" target="_blank" rel="noopener">
                <img src="//cfnimg.joyclub.de/partner/joyclub_backlink_mitglied_120x120.png" width="100" height="100" alt="Lebe deine Lust!" style="border-radius: 50%;" />
            </a>
        </div>

        <!-- Footer Links Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; max-width: 900px; margin: 0 auto 25px auto; text-align: left;">
            <!-- Philosophische Grundlagen -->
            <div>
                <h4 id="footer-philosophy-title" style="color: #fff; font-size: 14px; margin-bottom: 12px; font-weight: 600;" data-i18n="synthesisSection.philosophischeGrundlagen">Philosophische Grundlagen</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin: 8px 0;"><a href="docs.html?doc=docs/theory/tiage-synthesis.md" style="color: #e57373; text-decoration: none;">Tiage-Synthese</a> <span style="color: rgba(255,255,255,0.4);">- Das Gesamtkonzept</span></li>
                    <li style="margin: 8px 0;"><a href="docs.html?doc=docs/theory/pirsig.md" style="color: #e57373; text-decoration: none;">Pirsig-Philosophie</a> <span style="color: rgba(255,255,255,0.4);">- Metaphysik der Qualitaet</span></li>
                    <li style="margin: 8px 0;"><a href="docs.html?doc=docs/theory/osho.md" style="color: #e57373; text-decoration: none;">OSHO-Philosophie</a> <span style="color: rgba(255,255,255,0.4);">- Bewusstsein und Beziehung</span></li>
                    <li style="margin: 8px 0;"><a href="docs.html?doc=docs/theory/pathos-logos.md" style="color: #e57373; text-decoration: none;">Pathos/Logos</a> <span style="color: rgba(255,255,255,0.4);">- Die 40:60 Gewichtung</span></li>
                    <li style="margin: 8px 0;"><a href="docs.html?doc=docs/theory/resonance.md" style="color: #e57373; text-decoration: none;">Resonanz-Theorie</a> <span style="color: rgba(255,255,255,0.4);">- Der Meta-Faktor</span></li>
                </ul>
            </div>

            <!-- Rechtliches -->
            <div>
                <h4 id="footer-legal-title" style="color: #fff; font-size: 14px; margin-bottom: 12px; font-weight: 600;" data-i18n="footer.rechtliches">Rechtliches</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin: 8px 0;"><a href="datenschutz.html" style="color: #e57373; text-decoration: none;" data-i18n="footer.datenschutz">Datenschutz</a></li>
                    <li style="margin: 8px 0;"><a href="nutzungsbedingungen.html" style="color: #e57373; text-decoration: none;" data-i18n="footer.nutzungsbedingungen">Nutzungsbedingungen</a></li>
                </ul>
            </div>

            <!-- Wissenschaftliche Quellen -->
            <div>
                <h4 style="color: #fff; font-size: 14px; margin-bottom: 12px; font-weight: 600;">Wissenschaftliche Quellen</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin: 8px 0;"><a href="docs.html?doc=profiles/research-sources.md" style="color: #e57373; text-decoration: none;">Research Sources</a> <span style="color: rgba(255,255,255,0.4);">- Vollstaendige Quellensammlung</span></li>
                </ul>
            </div>
        </div>

        <!-- Copyright & Version -->
        <div style="padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="margin-bottom: 8px;">&copy; 2025 Ti-Age - Alle Rechte vorbehalten</div>
            <div style="margin-bottom: 12px; font-size: 11px; opacity: 0.7;">Version 1.4.0</div>
            <a href="#" style="color: #eab308; text-decoration: none; margin: 0 10px;" onclick="document.getElementById('impressumModal').style.display='flex'; return false;">Impressum</a>
            <span style="color: #eab308;">|</span>
            <a href="docs.html?doc=docs/help-guide.md" style="color: #eab308; text-decoration: none; margin: 0 10px;">Hilfe</a>
        </div>
    </footer>

    <!-- Impressum Modal -->
    <div id="impressumModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10002; justify-content:center; align-items:center;" onclick="this.style.display='none'">
        <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 16px; padding: 30px; max-width: 400px; width: 90%; text-align: center; border: 1px solid rgba(255,255,255,0.1);" onclick="event.stopPropagation()">
            <h3 style="margin: 0 0 20px 0; color: #fff; font-size: 20px;">Impressum</h3>
            <p style="margin: 10px 0; color: rgba(255,255,255,0.8); font-size: 14px;"><strong>Betreiber:</strong> Ti-Age</p>
            <p style="margin: 10px 0; color: rgba(255,255,255,0.8); font-size: 14px;"><strong>Projekt:</strong> Tiage_Beziehungsmodel</p>
            <p style="margin: 10px 0; color: rgba(255,255,255,0.8); font-size: 14px;"><strong>Kontakt:</strong> <a href="mailto:nerd@ti-age.de" style="color: #eab308;">nerd@ti-age.de</a></p>
        </div>
    </div>

    <!-- State Management - Single Source of Truth -->
    <script src="js/state.js"></script>
    <script src="js/markdown-loader.js"></script>

    <!-- i18n Update Functions -->
    <script>
        /**
         * Update all translatable elements on the page
         * Called when language is changed
         */
        function updateAllTranslations() {
            const lang = TiageI18n.getLanguage();

            // Update language code display
            const langCodeEl = document.getElementById('currentLangCode');
            if (langCodeEl) {
                langCodeEl.textContent = lang.toUpperCase();
            }

            // Update HTML lang attribute
            document.documentElement.lang = lang;

            // Update page title
            const h1 = document.querySelector('h1[data-i18n]');
            if (h1) {
                const titleKey = h1.getAttribute('data-i18n');
                const translated = TiageI18n.t(titleKey);
                if (translated && translated !== titleKey) {
                    h1.textContent = translated.toUpperCase();
                }
            }

            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const translated = TiageI18n.t(key);
                if (translated && translated !== key) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translated;
                    } else {
                        el.textContent = translated;
                    }
                }
            });

            // Update all elements with data-i18n-title attribute (for tooltips)
            document.querySelectorAll('[data-i18n-title]').forEach(el => {
                const key = el.getAttribute('data-i18n-title');
                const translated = TiageI18n.t(key);
                if (translated && translated !== key) {
                    el.title = translated;
                }
            });

            // Update person labels (ICH/PARTNER -> ME/PARTNER)
            updatePersonLabels();

            // Update status buttons (Gelebt/Interessiert)
            updateStatusButtons();

            // Update dimension labels and tooltips
            updateDimensionLabels();

            // Update archetype names if displayed
            updateArchetypeNames();

            // Update category names
            updateCategoryNames();

            // Update column headers (DU/YOU, PARTNER)
            updateColumnHeaders();

            // Update dimension section labels
            updateDimensionSectionLabels();

            // Update geschlecht button labels
            updateGeschlechtButtons();

            // Update dominanz labels
            updateDominanzLabels();

            // Update orientierung labels
            updateOrientierungLabels();

            // Update GFK/NVC button labels
            updateGfkButtonLabels();
            updateGfkLabels();

            // Update fold/unfold button
            updateFoldUnfoldButton();

            // Update help modal
            updateHelpModal();

            // Update gender info modal
            updateGenderInfoModal();

            // Update impressum modal
            updateImpressumModal();

            // Update footer
            updateFooter();

            // Update age verification modal
            updateAgeVerificationModal();

            // Update analysis overview (Du ein / You a + Geschlecht)
            if (typeof window.updateAnalysisOverview === 'function') {
                window.updateAnalysisOverview();
            }

            // Trigger custom event for other scripts to react
            document.dispatchEvent(new CustomEvent('languageChanged', {
                detail: { language: lang, locale: TiageI18n.getLocale() }
            }));

            console.log('[i18n] All translations updated to:', lang);
        }

        /**
         * Update person labels (ICH/ME, PARTNER)
         */
        function updatePersonLabels() {
            // Desktop ICH/PARTNER labels
            document.querySelectorAll('.person-label-ich, [data-person="ich"] .person-label').forEach(el => {
                el.textContent = TiageI18n.t('ui.ich', 'ICH');
            });
            document.querySelectorAll('.person-label-partner, [data-person="partner"] .person-label').forEach(el => {
                el.textContent = TiageI18n.t('ui.partner', 'PARTNER');
            });

            // Update any elements with explicit data-i18n-person
            document.querySelectorAll('[data-i18n-person="ich"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.ich', 'ICH');
            });
            document.querySelectorAll('[data-i18n-person="partner"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.partner', 'PARTNER');
            });
        }

        /**
         * Update status button labels (Gelebt/Interessiert)
         */
        function updateStatusButtons() {
            document.querySelectorAll('[data-status="gelebt"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.gelebt', 'Gelebt');
            });
            document.querySelectorAll('[data-status="interessiert"]').forEach(el => {
                el.textContent = TiageI18n.t('ui.interessiert', 'Interessiert');
            });
        }

        /**
         * Update dimension labels (Geschlecht, Dominanz, Orientierung)
         */
        function updateDimensionLabels() {
            // Update geschlecht type labels
            const geschlechtTypes = ['cis_mann', 'cis_frau', 'trans_mann', 'trans_frau', 'nonbinaer', 'genderfluid', 'agender', 'intersex', 'divers'];
            geschlechtTypes.forEach(type => {
                document.querySelectorAll(`[data-geschlecht="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`geschlecht.types.${type}`, type);
                });
            });

            // Update dominanz type labels
            const dominanzTypes = ['dominant', 'submissiv', 'switch', 'ausgeglichen'];
            dominanzTypes.forEach(type => {
                document.querySelectorAll(`[data-dominanz="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`dominanz.types.${type}`, type);
                });
            });

            // Update orientierung type labels
            const orientierungTypes = ['heterosexuell', 'homosexuell', 'bisexuell'];
            orientierungTypes.forEach(type => {
                document.querySelectorAll(`[data-orientierung="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`orientierung.types.${type}`, type);
                });
            });
        }

        /**
         * Update archetype names
         */
        function updateArchetypeNames() {
            const archetypes = ['single', 'duo', 'duo_flex', 'solopoly', 'polyamor', 'ra', 'lat', 'aromantisch'];

            // Update elements with data-archetype-name attribute
            archetypes.forEach(type => {
                document.querySelectorAll(`[data-archetype-name="${type}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`archetypes.${type}.name`, type);
                });
            });

            // Update select options (ichSelect, partnerSelect, mobile selects)
            document.querySelectorAll('#ichSelect option, #partnerSelect option, #mobile-ich-select option, #mobile-partner-select option').forEach(option => {
                const value = option.value;
                if (archetypes.includes(value)) {
                    option.textContent = TiageI18n.t(`archetypes.${value}.name`, option.textContent);
                    option.title = TiageI18n.t(`archetypes.${value}.shortDef`, option.title);
                }
            });

            // Update archetype symbol names in grids
            document.querySelectorAll('.archetype-symbol-name').forEach(el => {
                const parent = el.closest('[data-archetype]');
                if (parent) {
                    const type = parent.dataset.archetype;
                    if (archetypes.includes(type)) {
                        el.textContent = TiageI18n.t(`archetypes.${type}.name`, el.textContent);
                    }
                }
            });
        }

        /**
         * Update category names (A-F)
         */
        function updateCategoryNames() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            categories.forEach(cat => {
                document.querySelectorAll(`[data-category-name="${cat}"]`).forEach(el => {
                    el.textContent = TiageI18n.t(`categories.${cat}`, cat);
                });
            });
        }

        /**
         * Update column headers (DU/YOU, PARTNER)
         */
        function updateColumnHeaders() {
            // Update ICH/YOU column title
            document.querySelectorAll('.ich-column .column-title').forEach(el => {
                el.textContent = TiageI18n.t('columns.you', 'DU');
            });
            // Update PARTNER column title
            document.querySelectorAll('.partner-column .column-title').forEach(el => {
                el.textContent = TiageI18n.t('columns.partner', 'PARTNER');
            });
            // Update navigation button titles
            document.querySelectorAll('.archetype-nav-btn').forEach(btn => {
                const direction = btn.innerHTML.includes('9664') ? 'previous' : 'next';
                btn.title = TiageI18n.t(`columns.${direction}Archetype`, direction === 'previous' ? 'Vorheriger Archetyp' : 'N√§chster Archetyp');
            });
            // Update INFO buttons
            document.querySelectorAll('.archetype-info-btn').forEach(btn => {
                btn.title = TiageI18n.t('columns.archetypeInfo', 'Info zum Archetyp');
            });
        }

        /**
         * Update dimension section labels (Geschlechtsidentit√§t, Dominanz, Orientierung, GFK)
         * Uses specific CSS classes for each dimension type
         */
        function updateDimensionSectionLabels() {
            // Update Geschlechtsidentit√§t labels
            document.querySelectorAll('.geschlecht-info-link').forEach(el => {
                el.textContent = TiageI18n.t('dimensions.geschlechtLabel', 'Geschlechtsidentit√§t');
            });

            // Update Dominanz labels
            document.querySelectorAll('.dominanz-info-link').forEach(el => {
                el.textContent = TiageI18n.t('dimensions.dominanzLabel', 'Dominanz');
            });

            // Update Orientierung labels
            document.querySelectorAll('.orientierung-info-link').forEach(el => {
                el.textContent = TiageI18n.t('dimensions.orientierungLabel', 'Orientierung');
            });

            // Update GFK labels
            document.querySelectorAll('.gfk-info-link').forEach(el => {
                el.textContent = TiageI18n.t('dimensions.gfkLabel', 'GFK-Kompetenz');
            });

            // Update Dominanz section labels (preserving CSS classes)
            document.querySelectorAll('[data-dimension$="-dominanz-multi"] > .compact-dimension-label > span:first-child').forEach(el => {
                const dominanzLink = el.querySelector('.dominanz-info-link');
                const legendSpan = el.querySelector('span:not(.dominanz-info-link)');
                if (dominanzLink && legendSpan) {
                    const p = TiageI18n.t('dimensions.legend.primary', 'P');
                    const s = TiageI18n.t('dimensions.legend.secondary', 'S');
                    const pFull = TiageI18n.t('dimensions.legend.primaryFull', 'Prim√§r');
                    const sFull = TiageI18n.t('dimensions.legend.secondaryFull', 'Sekund√§r');
                    dominanzLink.textContent = TiageI18n.t('dimensions.dominanzLabel', 'Dominanz');
                    legendSpan.innerHTML = `(${p}=${pFull}, ${s}=${sFull})`;
                }
            });

            // Update Orientierung section labels (preserving CSS classes)
            document.querySelectorAll('[data-dimension$="-orientierung-multi"] > .compact-dimension-label > span:first-child').forEach(el => {
                const orientierungLink = el.querySelector('.orientierung-info-link');
                const legendSpan = el.querySelector('span:not(.orientierung-info-link)');
                if (orientierungLink && legendSpan) {
                    const p = TiageI18n.t('dimensions.legend.primary', 'P');
                    const s = TiageI18n.t('dimensions.legend.secondary', 'S');
                    const pFull = TiageI18n.t('dimensions.legend.primaryFull', 'Prim√§r');
                    const sFull = TiageI18n.t('dimensions.legend.secondaryFull', 'Sekund√§r');
                    orientierungLink.textContent = TiageI18n.t('dimensions.orientierungLabel', 'Orientierung');
                    legendSpan.innerHTML = `(${p}=${pFull}, ${s}=${sFull})`;
                }
            });

            // Update legend (P=Prim√§r, S=Sekund√§r)
            document.querySelectorAll('.geschlecht-legend').forEach(el => {
                const p = TiageI18n.t('dimensions.legend.primary', 'P');
                const s = TiageI18n.t('dimensions.legend.secondary', 'S');
                const pFull = TiageI18n.t('dimensions.legend.primaryFull', 'Prim√§r');
                const sFull = TiageI18n.t('dimensions.legend.secondaryFull', 'Sekund√§r');
                el.innerHTML = `(<span class="legend-p">${p}</span>=${pFull}, <span class="legend-s">${s}</span>=${sFull})`;
            });
        }

        /**
         * Update geschlecht button labels
         */
        function updateGeschlechtButtons() {
            const geschlechtTypes = ['cis_mann', 'cis_frau', 'trans_mann', 'trans_frau', 'nonbinaer', 'genderfluid', 'agender', 'intersex', 'divers'];
            geschlechtTypes.forEach(type => {
                document.querySelectorAll(`.geschlecht-btn[data-value="${type}"]`).forEach(btn => {
                    // Preserve indicators if present
                    const indicator = btn.querySelector('.geschlecht-indicator');
                    const indicatorHtml = indicator ? indicator.outerHTML : '';
                    btn.innerHTML = TiageI18n.t(`geschlecht.types.${type}`, type) + indicatorHtml;
                });
            });
        }

        /**
         * Update dominanz labels in the multi-select rows and grid buttons
         */
        function updateDominanzLabels() {
            const dominanzTypes = ['dominant', 'submissiv', 'switch', 'ausgeglichen'];

            // Update multi-select row labels
            dominanzTypes.forEach(type => {
                document.querySelectorAll(`.dominanz-label`).forEach(el => {
                    if (el.getAttribute('onclick')?.includes(`'${type}'`)) {
                        el.textContent = TiageI18n.t(`dominanz.types.${type}`, type).toLowerCase();
                    }
                });
            });

            // Update grid buttons
            document.querySelectorAll('.dominanz-btn').forEach(btn => {
                const value = btn.getAttribute('data-value');
                if (value && dominanzTypes.includes(value)) {
                    btn.textContent = TiageI18n.t(`dominanz.types.${value}`, value);
                }
            });
        }

        /**
         * Update orientierung labels in the multi-select rows and grid buttons
         */
        function updateOrientierungLabels() {
            const orientierungTypes = ['heterosexuell', 'homosexuell', 'bisexuell'];

            // Update multi-select row labels
            orientierungTypes.forEach(type => {
                document.querySelectorAll(`.dominanz-label`).forEach(el => {
                    if (el.getAttribute('onclick')?.includes(`'${type}'`)) {
                        el.textContent = TiageI18n.t(`orientierung.types.${type}`, type).toLowerCase();
                    }
                });
            });

            // Update grid buttons
            document.querySelectorAll('.orientierung-btn').forEach(btn => {
                const value = btn.getAttribute('data-value');
                if (value && orientierungTypes.includes(value)) {
                    btn.textContent = TiageI18n.t(`orientierung.types.${value}`, value);
                }
            });
        }

        /**
         * Update GFK/NVC competence labels
         */
        function updateGfkLabels() {
            const gfkLevels = ['niedrig', 'mittel', 'hoch'];

            // Update GFK grid buttons
            document.querySelectorAll('.gfk-btn').forEach(btn => {
                const value = btn.getAttribute('data-value');
                if (value && gfkLevels.includes(value)) {
                    btn.textContent = TiageI18n.t(`gfk.levels.${value}`, value);
                }
            });
        }

        /**
         * Update GFK/NVC button labels
         */
        function updateGfkButtonLabels() {
            const gfkLevels = ['niedrig', 'mittel', 'hoch'];
            document.querySelectorAll('.gfk-btn').forEach(btn => {
                const value = btn.dataset.value;
                if (value && gfkLevels.includes(value)) {
                    btn.textContent = TiageI18n.t(`dimensions.gfkLevels.${value}`, value);
                }
            });

            // Update GFK labels in info links
            document.querySelectorAll('.gfk-info-link').forEach(el => {
                el.textContent = TiageI18n.t('dimensions.gfkLabel', 'GFK-Kompetenz');
            });

            // Update Bed√ºrfnis-√úbereinstimmung label
            document.querySelectorAll('.gfk-level-label').forEach(el => {
                el.textContent = TiageI18n.t('needs.matchLabel', 'Bed√ºrfnis-√úbereinstimmung');
            });
        }

        /**
         * Update fold/unfold button text
         */
        function updateFoldUnfoldButton() {
            const btn = document.getElementById('foldUnfoldAllBtn');
            if (btn) {
                const textEl = btn.querySelector('.fold-unfold-text');
                if (textEl) {
                    const isUnfolded = !btn.classList.contains('folded');
                    textEl.textContent = isUnfolded ?
                        TiageI18n.t('foldUnfold.fold', 'Einklappen') :
                        TiageI18n.t('foldUnfold.unfold', 'Ausklappen');
                }
            }
        }

        /**
         * Update help modal content
         */
        function updateHelpModal() {
            // Update title
            const helpTitle = document.querySelector('#helpModal .help-modal-header h2');
            if (helpTitle) {
                helpTitle.textContent = TiageI18n.t('helpModal.title', 'Hilfe & Dokumentation');
            }

            // Update quick guide title
            const quickGuideTitle = document.querySelector('#helpModal .quick-guide h3');
            if (quickGuideTitle) {
                quickGuideTitle.textContent = TiageI18n.t('helpModal.quickGuideTitle', 'Kurzanleitung');
            }

            // Update feedback prompt
            const feedbackPrompt = document.querySelector('#helpModal .comment-section p');
            if (feedbackPrompt) {
                feedbackPrompt.textContent = TiageI18n.t('helpModal.feedbackPrompt', 'Fragen, Feedback oder Verbesserungsvorschl√§ge?');
            }

            // Update comment button
            const commentBtn = document.querySelector('#helpModal .comment-btn');
            if (commentBtn) {
                commentBtn.innerHTML = TiageI18n.t('helpModal.sendComment', 'Kommentar senden');
            }

            // Update view comments button
            const viewCommentsBtn = document.querySelector('#helpModal .view-comments-btn');
            if (viewCommentsBtn) {
                viewCommentsBtn.innerHTML = 'üìã ' + TiageI18n.t('helpModal.viewAllComments', 'Alle Kommentare');
            }
        }

        /**
         * Update gender info modal content
         */
        function updateGenderInfoModal() {
            // Update title
            const title = document.querySelector('#geschlechtInfoModal .dimension-tooltip-title');
            if (title) {
                title.textContent = TiageI18n.t('genderInfoModal.title', 'Geschlechtsidentit√§ten');
            }

            // Update "Verstanden" button
            const understoodBtn = document.querySelector('#geschlechtInfoModal .dimension-tooltip-close');
            if (understoodBtn) {
                understoodBtn.textContent = TiageI18n.t('genderInfoModal.understood', 'Verstanden');
            }

            // Update gender identity items
            const genderTypes = ['cis_mann', 'cis_frau', 'trans_mann', 'trans_frau', 'nonbinaer', 'genderfluid', 'agender', 'intersex', 'divers'];
            const items = document.querySelectorAll('#geschlechtInfoModal .geschlecht-info-item');
            items.forEach((item, index) => {
                if (index < genderTypes.length) {
                    const type = genderTypes[index];
                    const nameEl = item.querySelector('.geschlecht-info-name');
                    const descEl = item.querySelector('.geschlecht-info-desc');
                    const tooltip = TiageI18n.t(`tooltips.${type}`);
                    if (nameEl && tooltip && tooltip.title) {
                        nameEl.textContent = tooltip.title;
                    }
                    if (descEl && tooltip && tooltip.text) {
                        descEl.textContent = tooltip.text;
                    }
                }
            });
        }

        /**
         * Update impressum modal content
         */
        function updateImpressumModal() {
            const modal = document.getElementById('impressumModal');
            if (!modal) return;

            const title = modal.querySelector('h3');
            if (title) {
                title.textContent = TiageI18n.t('impressum.title', 'Impressum');
            }
        }

        /**
         * Update footer translations
         */
        function updateFooter() {
            const footer = document.querySelector('footer');
            if (!footer) return;

            // Update Datenschutz link
            const datenschutzLink = footer.querySelector('a[href="datenschutz.html"]');
            if (datenschutzLink) {
                datenschutzLink.textContent = TiageI18n.t('footer.datenschutz', 'Datenschutz');
            }

            // Update Nutzungsbedingungen link
            const nutzungsLink = footer.querySelector('a[href="nutzungsbedingungen.html"]');
            if (nutzungsLink) {
                nutzungsLink.textContent = TiageI18n.t('footer.nutzungsbedingungen', 'Nutzungsbedingungen');
            }

            // Update Impressum link
            const impressumLink = footer.querySelector('a[onclick*="impressumModal"]');
            if (impressumLink) {
                impressumLink.textContent = TiageI18n.t('footer.impressum', 'Impressum');
            }

            // Update copyright text
            const copyrightEl = footer.querySelector('div[style*="border-top"] > div:first-child');
            if (copyrightEl) {
                const year = new Date().getFullYear();
                const copyright = TiageI18n.t('footer.copyright', 'Alle Rechte vorbehalten');
                copyrightEl.innerHTML = `&copy; ${year} Ti-Age - ${copyright}`;
            }

            // Update Hilfe/Help link
            const hilfeLink = footer.querySelector('a[href*="help-guide"]');
            if (hilfeLink) {
                hilfeLink.textContent = TiageI18n.t('helpModal.title', 'Hilfe').split(' ')[0]; // Just "Hilfe" or "Help"
            }
        }

        /**
         * Update age verification modal content
         */
        function updateAgeVerificationModal() {
            const modal = document.getElementById('ageVerificationModal');
            if (!modal) return;

            const lang = TiageI18n.getLanguage();

            // Update language code display in age verification
            const langCodeEl = document.getElementById('ageVerifyLangCode');
            if (langCodeEl) {
                langCodeEl.textContent = lang.toUpperCase();
            }

            const title = modal.querySelector('h2');
            if (title) {
                title.textContent = TiageI18n.t('ageVerification.title', 'Altersverifikation');
            }

            // Update description
            const description = modal.querySelector('p[data-i18n="ageVerification.description"]');
            if (description) {
                description.textContent = TiageI18n.t('ageVerification.description', 'Diese Seite enth√§lt Inhalte √ºber Beziehungsmodelle und ist nur f√ºr Personen ab 18 Jahren bestimmt.');
            }

            // Update terms text with HTML content
            const termsEl = document.getElementById('ageVerificationTerms');
            if (termsEl) {
                if (lang === 'en') {
                    termsEl.innerHTML = `By clicking "Yes" you confirm that you:<br>
                        ‚Ä¢ are of legal age (at least 18 years old)<br>
                        ‚Ä¢ accept the <a href="terms-of-use.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Terms of Use</a> and <a href="privacy-policy.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Privacy Policy</a><br>
                        ‚Ä¢ acknowledge that all content is protected by copyright<br>
                        ‚Ä¢ will use the content only for personal, non-commercial purposes`;
                } else {
                    termsEl.innerHTML = `Mit dem Klick auf "Ja" best√§tigst du, dass du:<br>
                        ‚Ä¢ vollj√§hrig bist (mindestens 18 Jahre alt)<br>
                        ‚Ä¢ die <a href="nutzungsbedingungen.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Nutzungsbedingungen</a> und <a href="datenschutz.html" target="_blank" style="color: #4A90E2; text-decoration: underline;">Datenschutzerkl√§rung</a> akzeptierst<br>
                        ‚Ä¢ zur Kenntnis nimmst, dass alle Inhalte urheberrechtlich gesch√ºtzt sind<br>
                        ‚Ä¢ die Inhalte nur f√ºr pers√∂nliche, nicht-kommerzielle Zwecke nutzt`;
                }
            }

            const question = modal.querySelector('.age-verification-question strong');
            if (question) {
                question.textContent = TiageI18n.t('ageVerification.question', 'Bist du mindestens 18 Jahre alt?');
            }

            const yesBtn = modal.querySelector('.age-btn-yes');
            if (yesBtn) {
                yesBtn.textContent = TiageI18n.t('ageVerification.confirm', 'Ja, ich bin 18+');
            }

            const noBtn = modal.querySelector('.age-btn-no');
            if (noBtn) {
                noBtn.textContent = TiageI18n.t('ageVerification.deny', 'Nein');
            }
        }

        // Alias for age verification button onclick
        function updateAgeVerificationTexts() {
            updateAgeVerificationModal();
        }

        /**
         * Get translated tooltip content
         * @param {string} key - The tooltip key (e.g., 'geschlecht', 'dominant')
         * @returns {Object} { title, text }
         */
        function getTranslatedTooltip(key) {
            const tooltip = TiageI18n.t(`tooltips.${key}`);
            if (tooltip && typeof tooltip === 'object') {
                return tooltip;
            }
            return { title: key, text: '' };
        }

        // Subscribe to language changes for automatic updates
        if (typeof TiageI18n !== 'undefined') {
            TiageI18n.subscribe(function(event) {
                updateAllTranslations();
            });
        }

        // Initialize translations on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Update language code display on load
            const langCodeEl = document.getElementById('currentLangCode');
            if (langCodeEl && typeof TiageI18n !== 'undefined') {
                langCodeEl.textContent = TiageI18n.getLanguage().toUpperCase();
            }
            // Run initial translation update (in case browser language was auto-detected to English)
            if (typeof TiageI18n !== 'undefined' && TiageI18n.getLanguage() !== 'de') {
                setTimeout(updateAllTranslations, 100);
            }
        });
    </script>

    <script>
        let data = null;
        let currentArchetype = 'single';
        let selectedPartner = 'duo';

        // Legacy personDimensions - now a reference to TiageState for backward compatibility
        // TODO: Remove after full migration to TiageState
        const personDimensions = {
            ich: {
                geschlecht: {
                    primary: null,    // Prim√§re Geschlechtsidentit√§t (I)
                    secondary: null   // Sekund√§re Geschlechtsidentit√§t (G)
                },
                dominanz: {
                    primary: null,    // Prim√§re Dominanz (I)
                    secondary: null   // Sekund√§re Dominanz (G)
                },
                orientierung: {
                    primary: null,    // Prim√§re Orientierung (I)
                    secondary: null   // Sekund√§re Orientierung (G)
                },
                gfk: null             // GFK-Kompetenz: niedrig, mittel, hoch
            },
            partner: {
                geschlecht: {
                    primary: null,
                    secondary: null
                },
                dominanz: {
                    primary: null,
                    secondary: null
                },
                orientierung: {
                    primary: null,
                    secondary: null
                },
                gfk: null             // GFK-Kompetenz: niedrig, mittel, hoch
            }
        };

        // Dimension tooltip content
        const dimensionTooltips = {
            geschlecht: {
                title: "Geschlecht",
                text: "Dein Geschlecht. Dies beeinflusst die k√∂rperliche Anziehung zusammen mit der sexuellen Orientierung."
            },
            dominanz: {
                title: "Dominanz-Pr√§ferenz",
                text: "Welche Rolle bevorzugst du in der emotionalen und praktischen Beziehungsdynamik?\n\n‚Ä¢ <span style=\"color: #e74c3c; font-weight: bold;\">Dominant</span>: Du √ºbernimmst gerne F√ºhrung und Verantwortung\n‚Ä¢ <span style=\"color: #e74c3c; font-weight: bold;\">Submissiv</span>: Du l√§sst dich gerne f√ºhren und vertraust auf deinen Partner\n‚Ä¢ <span style=\"color: #e74c3c; font-weight: bold;\">Switch</span>: Du genie√üt beide Rollen je nach Situation\n‚Ä¢ <span style=\"color: #e74c3c; font-weight: bold;\">Ausgeglichen</span>: Du bevorzugst eine gleichberechtigte Dynamik ohne feste Rollen\n\nDie Dominanz-Harmonie beeinflusst die energetische Dynamik einer Beziehung. Komplement√§re Pr√§ferenzen (z.B. dominant + submissiv) k√∂nnen starke Anziehung erzeugen."
            },
            orientierung: {
                title: "Sexuelle Orientierung",
                text: "Zu welchem Geschlecht f√ºhlst du dich romantisch und/oder sexuell hingezogen?\n\n‚Ä¢ Heterosexuell: Anziehung zum anderen Geschlecht\n‚Ä¢ Homosexuell: Anziehung zum gleichen Geschlecht\n‚Ä¢ Bisexuell: Anziehung zu beiden Geschlechtern\n\nDie sexuelle Orientierung beeinflusst, ob eine k√∂rperliche/romantische Anziehung zwischen zwei Personen m√∂glich ist. Bei inkompatiblen Orientierungen zeigt das Modell dies als Blocker an."
            },
            status: {
                title: "Orientierungs-Status",
                text: "Gelebt: Du lebst diese Orientierung und bist dir sicher.\n\nInteressiert: Du bist neugierig oder in einer Explorationsphase. Die tats√§chliche Anziehung ist noch unklar."
            },
            dominanzStatus: {
                title: "Dominanz-Status",
                text: "Gelebt: Du kennst deine Dominanz-Pr√§ferenz und lebst sie aktiv. Die Werte des psychologischen Profils treffen mit hoher Wahrscheinlichkeit zu.\n\nInteressiert: Du bist noch am Erkunden oder unsicher √ºber deine Pr√§ferenz. Die Konfidenz der Profilaussagen ist reduziert (h√∂here Varianz in deinem Verhalten).\n\nWissenschaftliche Basis: Big Five Forschung zeigt, dass Menschen in Explorationsphasen konsistent h√∂here Verhaltensvarianzen aufweisen (McCrae & Costa, 1997)."
            },
            // Einzelne Dominanz-Typen
            dominant: {
                title: "Dominant",
                text: "<strong>Der F√ºhrende</strong>\n\nDu √ºbernimmst gerne F√ºhrung und Verantwortung in Beziehungen.\n\n<strong>Merkmale:</strong> Assertiv, f√ºhrend, selbstsicher, bestimmend, proaktiv, entschlossen\n\n<strong>Kommunikation:</strong> Direkt und unverbl√ºmt. Konflikte werden aktiv angegangen, nicht vermieden.\n\n<strong>Energie:</strong> Hoch, spontan, leidenschaftlich. Erholt sich schnell von Konflikten.\n\n<em>Pirsig:</em> Dominanz als dynamische Kraft, die statische Muster durchbricht.\n<em>OSHO:</em> Yang-Energie ‚Äì nat√ºrlich wenn sie aus Bewusstsein kommt, nicht aus Ego."
            },
            submissiv: {
                title: "Submissiv",
                text: "<strong>Der Folgende</strong>\n\nDu l√§sst dich gerne f√ºhren und vertraust auf deinen Partner.\n\n<strong>Merkmale:</strong> Anpassungsf√§hig, folgend, empathisch, dienend, harmonieorientiert, geduldig\n\n<strong>Kommunikation:</strong> Indirekt und diplomatisch. Konflikte werden eher vermieden oder sanft angesprochen.\n\n<strong>Energie:</strong> Mittel, pr√§feriert Planung. Braucht Zeit zur Erholung nach Konflikten.\n\n<em>Pirsig:</em> Submissivit√§t als statisches Muster, das Stabilit√§t schafft.\n<em>OSHO:</em> Yin-Energie ‚Äì Empfangen ist genauso wertvoll wie Geben."
            },
            switch: {
                title: "Switch",
                text: "<strong>Der Flexible</strong>\n\nDu genie√üt beide Rollen je nach Situation und Partner.\n\n<strong>Merkmale:</strong> Flexibel, wandelbar, vielseitig, situativ, kommunikativ, experimentierfreudig\n\n<strong>Kommunikation:</strong> Situativ angepasst ‚Äì kann sowohl direkt als auch diplomatisch sein.\n\n<strong>Energie:</strong> Hoch und flexibel. Kann sich schnell an verschiedene Situationen anpassen.\n\n<em>Pirsig:</em> Balance zwischen statisch und dynamisch ‚Äì h√∂chste Adaptivit√§t.\n<em>OSHO:</em> Die Vereinigung von Yin und Yang. Der erleuchtete Mensch tr√§gt beide Polarit√§ten."
            },
            ausgeglichen: {
                title: "Ausgeglichen",
                text: "<strong>Der Zentrierte</strong>\n\nDu bevorzugst eine gleichberechtigte Dynamik ohne feste Rollen.\n\n<strong>Merkmale:</strong> Balanciert, harmonisch, stabil, ruhig, besonnen, gem√§√üigt\n\n<strong>Kommunikation:</strong> Ruhig und konstruktiv. Feedback ist ausgewogen zwischen direkt und diplomatisch.\n\n<strong>Energie:</strong> Mittel und stabil ‚Äì weder √ºberm√§√üig spontan noch √ºberm√§√üig planend.\n\n<em>Pirsig:</em> Wahre Balance zwischen statisch und dynamisch.\n<em>OSHO:</em> Jenseits von Yin und Yang ‚Äì die transzendierte Mitte."
            },
            // GFK (Gewaltfreie Kommunikation)
            gfk: {
                title: "GFK-Kompetenz",
                text: "<strong>Gewaltfreie Kommunikation nach Marshall Rosenberg</strong>\n\nWie gut beherrschst du die Prinzipien der Gewaltfreien Kommunikation?\n\n‚Ä¢ <strong>Niedrig:</strong> Tendenz zu Vorw√ºrfen, Urteilen, Schuldzuweisungen. Schwierigkeiten, Bed√ºrfnisse klar zu benennen.\n\n‚Ä¢ <strong>Mittel:</strong> Grundkenntnisse vorhanden. Kann in ruhigen Momenten GFK anwenden, f√§llt unter Stress in alte Muster zur√ºck.\n\n‚Ä¢ <strong>Hoch:</strong> Konsequente Anwendung der 4 Schritte: Beobachtung, Gef√ºhl, Bed√ºrfnis, Bitte. Empathisches Zuh√∂ren auch in Konflikten.\n\n<em>Pirsig:</em> GFK als dynamische Qualit√§t ‚Äì die F√§higkeit, im Moment pr√§sent zu kommunizieren.\n<em>OSHO:</em> Wahre Kommunikation entsteht ohne Ego ‚Äì GFK ist ein Werkzeug daf√ºr."
            },
            gfk_niedrig: {
                title: "GFK: Niedrig",
                text: "<strong>Geringe GFK-Kompetenz</strong>\n\nKommunikation basiert oft auf:\n‚Ä¢ Vorw√ºrfen und Schuldzuweisungen\n‚Ä¢ Urteilen und Bewertungen\n‚Ä¢ Forderungen statt Bitten\n‚Ä¢ Schwierigkeiten, eigene Bed√ºrfnisse zu erkennen\n\n<strong>In Beziehungen:</strong> Konflikte eskalieren h√§ufiger. Missverst√§ndnisse sind allt√§glich. Verletzungen entstehen unbeabsichtigt.\n\n<strong>Potenzial:</strong> GFK kann gelernt werden. Bewusstsein ist der erste Schritt."
            },
            gfk_mittel: {
                title: "GFK: Mittel",
                text: "<strong>Mittlere GFK-Kompetenz</strong>\n\nKommunikation zeigt:\n‚Ä¢ Grundverst√§ndnis der 4 Schritte (Beobachtung, Gef√ºhl, Bed√ºrfnis, Bitte)\n‚Ä¢ F√§higkeit zur Selbstreflexion\n‚Ä¢ In ruhigen Momenten empathisches Zuh√∂ren\n‚Ä¢ Unter Stress R√ºckfall in alte Muster\n\n<strong>In Beziehungen:</strong> Gute Basis f√ºr konstruktive Gespr√§che. Konflikte k√∂nnen gel√∂st werden, wenn beide bereit sind.\n\n<strong>Wachstum:</strong> √úbung unter Druck vertieft die Kompetenz."
            },
            gfk_hoch: {
                title: "GFK: Hoch",
                text: "<strong>Hohe GFK-Kompetenz</strong>\n\nKommunikation gepr√§gt von:\n‚Ä¢ Konsequente Anwendung der 4 Schritte\n‚Ä¢ Empathisches Zuh√∂ren auch in Konflikten\n‚Ä¢ F√§higkeit, hinter Vorw√ºrfe zu h√∂ren\n‚Ä¢ Klare Unterscheidung: Beobachtung vs. Bewertung\n‚Ä¢ Verbindung zu eigenen und fremden Bed√ºrfnissen\n\n<strong>In Beziehungen:</strong> Tiefe Verbindung durch echtes Verstehen. Konflikte werden zu Wachstumschancen.\n\n<em>OSHO:</em> Kommunikation ohne Ego ist Meditation in Aktion."
            },
            // Einzelne Orientierungen
            heterosexuell: {
                title: "Heterosexuell",
                text: "<strong>Anziehung zum anderen Geschlecht</strong>\n\nDu f√ºhlst dich romantisch und/oder sexuell zu Menschen des anderen Geschlechts hingezogen.\n\n<strong>Forschung:</strong> Die h√§ufigste sexuelle Orientierung. Studien zeigen tendentiell traditionellere Wertorientierung."
            },
            homosexuell: {
                title: "Homosexuell",
                text: "<strong>Anziehung zum gleichen Geschlecht</strong>\n\nDu f√ºhlst dich romantisch und/oder sexuell zu Menschen des gleichen Geschlechts hingezogen.\n\n<strong>Forschung:</strong> H√∂here Offenheit f√ºr neue Erfahrungen (Allen et al., 2020). Tendentiell weniger traditionelle Wertorientierung."
            },
            bisexuell: {
                title: "Bisexuell",
                text: "<strong>Anziehung zu beiden Geschlechtern</strong>\n\nDu f√ºhlst dich romantisch und/oder sexuell zu Menschen beider Geschlechter hingezogen.\n\n<strong>Forschung:</strong> H√∂chste Offenheit aller Orientierungen (Allen et al., 2020). Am experimentierfreudigsten und am wenigsten traditionell."
            }
        };

        const icons = {
            single: '‚òÖ',
            duo: '‚ô°',
            duo_flex: '‚ö°',
            solopoly: '‚óÜ',
            polyamor: '‚ô•',
            ra: '‚àû',
            lat: '‚åÇ',
            aromantisch: '‚óá'
        };

        const categoryNames = {
            A: 'Beziehungsphilosophie',
            B: 'Werte-Alignment',
            C: 'N√§he-Distanz',
            D: 'Autonomie',
            E: 'Kommunikation',
            F: 'Soziale Kompatibilit√§t'
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MICRO-STATEMENTS DATABASE f√ºr dynamische Text-Generierung
        // Philosophische Grundlage: Pirsig (MOQ) + OSHO
        //
        // HINWEIS: Die vollst√§ndigen Archetyp-Statements (64 Kombinationen) werden
        // aus den externen Dateien geladen:
        // - statements/archetypeStatements.js (Deutsch)
        // - statements/archetypeStatements_EN.js (Englisch)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // archetypeStatements wird aus externer Datei geladen (statements/archetypeStatements.js)
        // archetypeStatements_EN wird aus externer Datei geladen (statements/archetypeStatements_EN.js)

        // Fallback-Definition falls externe Datei nicht geladen wurde
        // Note: archetypeStatements wird in statements/archetypeStatements.js definiert
        // Dieser Check ist nur f√ºr den Fall dass die Datei nicht geladen wurde
        if (typeof window.archetypeStatements === 'undefined') {
            console.warn('archetypeStatements nicht geladen - verwende leeres Objekt');
            window.archetypeStatements = {};
        }

        // dominanceStatements ist inline definiert (da vollst√§ndig und korrekt)
        const dominanceStatements = {
            "dominant_submissiv": { score: 100, pathos: ["Die perfekte Polarit√§t: F√ºhrung trifft auf Hingabe.", "OSHO's Weisheit manifestiert sich hier ‚Äì Extreme ziehen sich an.", "Eine magnetische Kraft entsteht aus der Gegens√§tzlichkeit."], logos: ["Komplementarit√§t f√ºhrt zu h√∂herer Sympathie (Tiedens & Fragale, 2003).", "Klare Rollenverteilung minimiert Entscheidungskonflikte."], pro: ["Optimale Rollenverteilung", "Nat√ºrliche Dynamik", "Hohe gegenseitige Anziehung", "Wissenschaftlich belegte h√∂here Zufriedenheit"], contra: ["Balance muss bewusst gehalten werden"] },
            "submissiv_dominant": { score: 100, pathos: ["Hingabe trifft auf F√ºhrung ‚Äì eine tiefe Resonanz.", "Das Vertrauen, sich f√ºhren zu lassen, schafft Intimit√§t."], logos: ["Komplement√§re Dynamik ist strukturell am stabilsten."], pro: ["Nat√ºrliche Harmonie", "Klare Rollenverteilung", "Tiefes Vertrauen m√∂glich"], contra: ["Abh√§ngigkeitsdynamiken m√ºssen reflektiert werden"] },
            "ausgeglichen_ausgeglichen": { score: 95, pathos: ["Zwei Seelen in Balance ‚Äì ein stiller Tanz der Gleichheit.", "Harmonie durch gemeinsame Mitte."], logos: ["Flexible Dynamik ohne starre Hierarchie.", "Entscheidungen werden gemeinsam getroffen."], pro: ["Gleichberechtigte Partnerschaft", "Flexible Rollenverteilung", "Keine Machtk√§mpfe erwartet", "Stabile Grunddynamik"], contra: ["Manchmal fehlt klare F√ºhrung", "Weniger 'Feuer' durch fehlende Polarit√§t"] },
            "switch_switch": { score: 90, pathos: ["Spielerische Dynamik ‚Äì heute f√ºhrst du, morgen ich.", "Die Freude am Rollenwechsel verbindet."], logos: ["Hohe Anpassungsf√§higkeit auf beiden Seiten."], pro: ["Vielfalt in der Dynamik", "Gegenseitiges Verst√§ndnis f√ºr Rollenwechsel", "Hohe Flexibilit√§t"], contra: ["Manchmal unklar, wer gerade f√ºhrt", "Koordination n√∂tig"] },
            "switch_ausgeglichen": { score: 88, pathos: ["Flexibilit√§t trifft auf Balance."], logos: ["Switch kann sich an die Balance anpassen."], pro: ["Hohe Anpassungsf√§higkeit", "Ausgeglichener bietet Stabilit√§t"], contra: ["Switch k√∂nnte manchmal mehr Polarit√§t vermissen"] },
            "ausgeglichen_switch": { score: 88, pathos: ["Balance begegnet Vielseitigkeit."], logos: ["Beide k√∂nnen sich situativ anpassen."], pro: ["Hohe gegenseitige Anpassungsf√§higkeit", "Flexible Rollenverteilung"], contra: ["Manchmal unklar, wer f√ºhrt"] },
            "dominant_ausgeglichen": { score: 85, pathos: ["F√ºhrung trifft auf Gelassenheit."], logos: ["Dominanter gibt Richtung, Ausgeglichener stabilisiert."], pro: ["Klare F√ºhrung mit stabilem Fundament", "Harmonische Grunddynamik"], contra: ["Dominanter k√∂nnte mehr Polarit√§t vermissen"] },
            "ausgeglichen_dominant": { score: 85, pathos: ["Balance begegnet St√§rke."], logos: ["Strukturell kompatibel."], pro: ["Harmonische Dynamik m√∂glich", "Ausgeglichener beh√§lt Autonomie"], contra: ["Dominanter k√∂nnte mehr Gegenpol vermissen"] },
            "submissiv_ausgeglichen": { score: 85, pathos: ["Hingabebereitschaft trifft auf sanfte F√ºhrung."], logos: ["Ausgeglichener kann situativ F√ºhrung √ºbernehmen."], pro: ["Sanfte F√ºhrungsdynamik", "Submissiver f√ºhlt sich sicher"], contra: ["Submissiver k√∂nnte st√§rkere F√ºhrung vermissen"] },
            "ausgeglichen_submissiv": { score: 85, pathos: ["Balance kann sanft f√ºhren."], logos: ["Ausgeglichener kann F√ºhrung √ºbernehmen wenn n√∂tig."], pro: ["Weiche, liebevolle Dynamik"], contra: ["Submissiver k√∂nnte klarere F√ºhrung w√ºnschen"] },
            "switch_dominant": { score: 80, pathos: ["Flexibilit√§t begegnet fester F√ºhrung."], logos: ["Switch kann submissive Rolle √ºbernehmen."], pro: ["Switch kann sich anpassen", "Dominanter bekommt oft F√ºhrungsrolle"], contra: ["Switch k√∂nnte eigene dominante Seite vermissen", "Potenzial f√ºr Frustration"] },
            "dominant_switch": { score: 80, pathos: ["F√ºhrung trifft auf Vielseitigkeit."], logos: ["Switch's dominante Phasen k√∂nnen Konflikte schaffen."], pro: ["Grunddynamik kann funktionieren"], contra: ["Machtkonflikte wenn Switch dominant sein will"] },
            "switch_submissiv": { score: 80, pathos: ["Vielseitigkeit begegnet Hingabe."], logos: ["Switch kann dominant sein wenn n√∂tig."], pro: ["Switch kann f√ºhren", "Flexibilit√§t kann bereichernd sein"], contra: ["Inkonsistenz kann verunsichern", "Submissiver w√ºnscht sich best√§ndigere Dominanz"] },
            "submissiv_switch": { score: 80, pathos: ["Hingabe trifft auf Wechselhaftigkeit."], logos: ["Inkonsistenz kann strukturell herausfordernd sein."], pro: ["Grunddynamik kann funktionieren"], contra: ["Inkonsistenz kann frustrieren", "F√ºhrungsvakuum in Switch's submissiven Phasen"] },
            "dominant_dominant": { score: 55, pathos: ["Zwei Alphas treffen aufeinander ‚Äì Funken fliegen.", "Machtkampf ist unvermeidlich, aber auch aufregend.", "Die Energie ist hoch, aber die Reibung auch."], logos: ["Sadikaj et al. (2017): Gleiche hohe Dominanz korreliert mit niedrigerer Zufriedenheit.", "Strukturelles Problem: Zwei F√ºhrer, keine Folger."], pro: ["Starke Pers√∂nlichkeiten k√∂nnen sich inspirieren", "Hohe Energie"], contra: ["Machtk√§mpfe unvermeidlich", "Wissenschaftlich belegte niedrigere Zufriedenheit", "Entscheidungskonflikte vorprogrammiert", "Bewusste Regeln erforderlich"] },
            "submissiv_submissiv": { score: 55, pathos: ["Zwei, die auf F√ºhrung warten ‚Äì wer beginnt?", "F√ºhrungsvakuum kann l√§hmend wirken.", "Die Sehnsucht nach F√ºhrung bleibt unerf√ºllt."], logos: ["Strukturelles F√ºhrungsvakuum.", "Entscheidungsprozesse k√∂nnen stagnieren."], pro: ["Keine Machtk√§mpfe", "Harmonische, sanfte Grundstimmung", "Gegenseitige Empathie"], contra: ["F√ºhrungsvakuum", "Stagnation in Entscheidungsprozessen", "Beide warten auf Initiative des anderen", "Externe Struktur oft n√∂tig"] },
            "default": { score: 75, pathos: ["Die Dominanz-Dynamik ist noch nicht vollst√§ndig erkennbar."], logos: ["Standardwert wird verwendet bis alle Dimensionen ausgew√§hlt sind."], pro: ["Neutrale Ausgangssituation"], contra: ["Unvollst√§ndige Information"] }
        };

        // Orientierungs-Statements f√ºr Pathos/Logos
        // Ber√ºcksichtigt Orientierung UND Geschlecht f√ºr realistische Kompatibilit√§t
        const orientierungStatements = {
            // Kompatible Kombinationen
            "kompatibel_hetero_hetero": {
                score: 95,
                pathos: ["Die heterosexuelle Anziehung ist beidseitig und nat√ºrlich.", "K√∂rperliche und emotionale Chemie kann frei flie√üen."],
                logos: ["Klassische Konstellation mit klarer gegenseitiger Anziehungsbasis."],
                pro: ["Nat√ºrliche gegenseitige Anziehung", "Gesellschaftlich etabliert"],
                contra: ["Keine besonderen Herausforderungen durch Orientierung"]
            },
            "kompatibel_homo_homo": {
                score: 95,
                pathos: ["Die homosexuelle Anziehung verbindet auf einer tiefen Ebene.", "Gemeinsames Verst√§ndnis der eigenen Identit√§t schafft N√§he."],
                logos: ["Gleiche Orientierung erm√∂glicht authentische Verbindung."],
                pro: ["Tiefes gegenseitiges Verst√§ndnis", "Gemeinsame Erfahrungswelt"],
                contra: ["Gesellschaftliche Herausforderungen m√∂glich"]
            },
            "kompatibel_bi_hetero": {
                score: 85,
                pathos: ["Anziehung ist vorhanden, auch wenn die Spektren unterschiedlich breit sind.", "Der bisexuelle Partner kann sich voll einlassen."],
                logos: ["Funktionale Kompatibilit√§t gegeben, aber unterschiedliche Erfahrungswelten."],
                pro: ["Grundlegende Anziehung vorhanden", "Bisexueller bringt Offenheit mit"],
                contra: ["Heterosexueller versteht bi-Erfahrung nicht vollst√§ndig", "Teile der bi-Identit√§t bleiben unausgelebt"]
            },
            "kompatibel_bi_homo": {
                score: 85,
                pathos: ["Anziehung ist da, aber die Wege dorthin waren unterschiedlich.", "Gemeinsame queere Erfahrungen k√∂nnen verbinden."],
                logos: ["Kompatibilit√§t gegeben, unterschiedliche Identit√§tserfahrungen."],
                pro: ["Gemeinsame queere Perspektive", "Gegenseitiges Verst√§ndnis f√ºr Nicht-Heteronormativit√§t"],
                contra: ["Bi-Identit√§t wird manchmal in Frage gestellt", "Unterschiedliche Community-Erfahrungen"]
            },
            "kompatibel_bi_bi": {
                score: 95,
                pathos: ["Maximale Flexibilit√§t trifft auf maximales Verst√§ndnis.", "Beide kennen die Komplexit√§t fluider Anziehung."],
                logos: ["Tiefes gegenseitiges Verst√§ndnis der bi-Erfahrung.", "Keine Teile der Identit√§t m√ºssen versteckt werden."],
                pro: ["Vollst√§ndiges Verst√§ndnis der bi-Erfahrung", "Maximale Offenheit", "Keine Identit√§tsaspekte werden unterdr√ºckt"],
                contra: ["Gesellschaftliche Bi-Erasure betrifft beide"]
            },
            // Inkompatible Kombinationen
            "inkompatibel_hetero_hetero": {
                score: 15,
                pathos: ["Keine sexuelle Anziehung m√∂glich ‚Äì beide orientieren sich zum anderen Geschlecht.", "Freundschaft ja, romantische Verbindung nein."],
                logos: ["Strukturelle Inkompatibilit√§t: Beide suchen das jeweils andere Geschlecht."],
                pro: ["Tiefe Freundschaft m√∂glich"],
                contra: ["Keine romantische/sexuelle Basis", "Fundamentale Orientierungsdiskrepanz"]
            },
            "inkompatibel_homo_homo": {
                score: 15,
                pathos: ["Die Orientierung weist in entgegengesetzte Richtungen.", "Emotionale N√§he m√∂glich, sexuelle Anziehung nicht."],
                logos: ["Strukturelle Inkompatibilit√§t durch gegenl√§ufige Orientierung."],
                pro: ["Verst√§ndnis f√ºreinander als queere Menschen"],
                contra: ["Keine romantische/sexuelle Basis", "Orientierung zeigt zu unterschiedlichen Geschlechtern"]
            },
            "inkompatibel_hetero_homo": {
                score: 10,
                pathos: ["Die Anziehungskr√§fte gehen aneinander vorbei.", "Was der eine sucht, kann der andere nicht bieten."],
                logos: ["Maximale strukturelle Inkompatibilit√§t.", "Keine gemeinsame Anziehungsbasis vorhanden."],
                pro: ["Freundschaft auf anderen Ebenen m√∂glich"],
                contra: ["Keine romantische/sexuelle Kompatibilit√§t", "Fundamentale Orientierungsdiskrepanz"]
            },
            "teilweise_bi_inkompatibel": {
                score: 40,
                pathos: ["Der bisexuelle Partner k√∂nnte angezogen sein, aber es ist nicht gegenseitig.", "Einseitige Anziehung schafft Ungleichgewicht."],
                logos: ["Nur einseitige Anziehung m√∂glich ‚Äì strukturelles Ungleichgewicht."],
                pro: ["Bisexueller zeigt Offenheit"],
                contra: ["Keine gegenseitige Anziehung", "Einseitiges Interesse f√ºhrt zu Frustration"]
            },
            // Default
            "default": {
                score: 50,
                pathos: ["Die Orientierungs-Kompatibilit√§t ist noch nicht vollst√§ndig erkennbar."],
                logos: ["Standardwert wird verwendet bis Orientierung und Geschlecht ausgew√§hlt sind."],
                pro: ["Neutrale Ausgangssituation"],
                contra: ["Unvollst√§ndige Information"]
            }
        };

        // Status-Statements f√ºr Pathos/Logos (Pirsig & Osho Perspektive)
        // Ber√ºcksichtigt den Sicherheitsgrad beider Personen (gelebt vs. interessiert)
        const statusStatements = {
            // Beide wissen wer sie sind
            "gelebt_gelebt": {
                pathos: [
                    "Zwei gefestigte Seelen begegnen sich ‚Äì die emotionale Klarheit beider schafft Tiefe.",
                    "Die Sicherheit in der eigenen Identit√§t erm√∂glicht authentische Begegnung."
                ],
                logos: [
                    "Hohe Qualit√§t durch klare Selbstkenntnis beider Partner (Pirsig).",
                    "Beide wissen, was sie wollen ‚Äì eine solide Basis f√ºr rationale Entscheidungen."
                ],
                modifier: 1.0  // Volle Konfidenz
            },
            // Einer f√ºhrt, einer exploriert
            "gelebt_interessiert": {
                pathos: [
                    "Klarheit trifft auf Offenheit ‚Äì Raum f√ºr gemeinsames Wachstum entsteht.",
                    "Der eine bietet emotionalen Anker, der andere bringt Neugier mit."
                ],
                logos: [
                    "Qualit√§t im Werden: Der gefestigte Partner kann Orientierung bieten.",
                    "Asymmetrie in der Selbstkenntnis ‚Äì erfordert Geduld und Kommunikation."
                ],
                modifier: 0.85  // Reduzierte Konfidenz
            },
            // Beide auf Entdeckungsreise
            "interessiert_interessiert": {
                pathos: [
                    "Zwei Suchende auf gemeinsamer Reise ‚Äì Verbundenheit durch geteilte Unsicherheit.",
                    "Die Offenheit beider kann befreiend sein, aber auch destabilisierend."
                ],
                logos: [
                    "Qualit√§t noch im Fluss ‚Äì viel Potential, aber unklare Grundlagen.",
                    "Beide explorieren noch ‚Äì Beziehungsbasis kann sich stark ver√§ndern."
                ],
                modifier: 0.7  // Deutlich reduzierte Konfidenz
            },
            // Default
            "default": {
                pathos: ["Der Sicherheitsgrad der Selbstkenntnis ist noch nicht vollst√§ndig erkennbar."],
                logos: ["Standardwert wird verwendet bis der Status ausgew√§hlt ist."],
                modifier: 0.8
            }
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // GFK-STATEMENTS (Gewaltfreie Kommunikation nach Marshall Rosenberg)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const gfkStatements = {
            // Beide hohe GFK-Kompetenz
            "hoch_hoch": {
                pathos: [
                    "Zwei Menschen, die empathisch zuh√∂ren k√∂nnen ‚Äì Konflikte werden zu Wachstumschancen.",
                    "Die F√§higkeit, hinter Vorw√ºrfe zu h√∂ren, schafft tiefe emotionale Sicherheit.",
                    "Bed√ºrfnisse werden geh√∂rt, nicht gefordert ‚Äì eine Basis f√ºr echte Intimit√§t."
                ],
                logos: [
                    "Exzellente Voraussetzungen f√ºr konstruktive Kommunikation.",
                    "Beide beherrschen die 4 Schritte: Beobachtung, Gef√ºhl, Bed√ºrfnis, Bitte.",
                    "Konfliktl√∂sung auf Augenh√∂he ist selbstverst√§ndlich."
                ],
                resonanzModifier: 1.1,  // Erh√∂ht die Resonanz
                konfliktPotenzial: "niedrig"
            },
            // Einer hoch, einer mittel
            "hoch_mittel": {
                pathos: [
                    "Der GFK-erfahrene Partner kann als Br√ºcke dienen ‚Äì Geduld ist gefragt.",
                    "Unter Stress zeigt sich der Unterschied, aber Wachstum ist m√∂glich."
                ],
                logos: [
                    "Solide Basis mit Entwicklungspotenzial.",
                    "Der erfahrenere Partner kann unterst√ºtzen, ohne zu dominieren."
                ],
                resonanzModifier: 1.05,
                konfliktPotenzial: "mittel-niedrig"
            },
            // Einer hoch, einer niedrig
            "hoch_niedrig": {
                pathos: [
                    "Eine Herausforderung: Empathie trifft auf Reaktivit√§t.",
                    "Der GFK-erfahrene Partner muss viel tragen ‚Äì Gefahr der Ersch√∂pfung.",
                    "Potenzial f√ºr Transformation, wenn der Lernwille da ist."
                ],
                logos: [
                    "Asymmetrie erfordert bewusste Arbeit.",
                    "Ohne Bereitschaft zum Lernen kann Frustration entstehen.",
                    "Klare Grenzen und Selbstf√ºrsorge sind essenziell."
                ],
                resonanzModifier: 0.95,
                konfliktPotenzial: "mittel-hoch"
            },
            // Beide mittel
            "mittel_mittel": {
                pathos: [
                    "Zwei auf dem Weg ‚Äì gemeinsames Wachstum ist m√∂glich.",
                    "In ruhigen Zeiten funktioniert die Kommunikation gut.",
                    "Stress kann alte Muster aktivieren ‚Äì Bewusstsein hilft."
                ],
                logos: [
                    "Gute Grundlage mit Entwicklungspotenzial.",
                    "Beide kennen die Prinzipien, √ºben noch die Anwendung.",
                    "Gemeinsames √úben kann die Beziehung st√§rken."
                ],
                resonanzModifier: 1.0,
                konfliktPotenzial: "mittel"
            },
            // Einer mittel, einer niedrig
            "mittel_niedrig": {
                pathos: [
                    "Unterschiedliche Kommunikationsebenen k√∂nnen frustrieren.",
                    "Der mittlere Partner f√§llt selbst unter Druck zur√ºck ‚Äì keine stabile Br√ºcke."
                ],
                logos: [
                    "Kommunikationsprobleme sind wahrscheinlich.",
                    "Externe Unterst√ºtzung (Paartherapie, Kurse) kann helfen."
                ],
                resonanzModifier: 0.9,
                konfliktPotenzial: "hoch"
            },
            // Beide niedrig
            "niedrig_niedrig": {
                pathos: [
                    "Kommunikation gepr√§gt von Vorw√ºrfen und Missverst√§ndnissen.",
                    "Eskalation ist wahrscheinlich ‚Äì ohne Werkzeuge fehlt der Ausweg.",
                    "Verletzungen entstehen oft unbeabsichtigt, heilen langsam."
                ],
                logos: [
                    "Hohe Wahrscheinlichkeit f√ºr destruktive Konfliktmuster.",
                    "Beide brauchen Unterst√ºtzung ‚Äì GFK-Kurse dringend empfohlen.",
                    "Ohne Intervention kann die Beziehung leiden."
                ],
                resonanzModifier: 0.8,
                konfliktPotenzial: "sehr hoch"
            },
            // Default
            "default": {
                pathos: ["Die GFK-Kompetenz ist noch nicht bekannt."],
                logos: ["Kommunikationsstil wird nicht bewertet."],
                resonanzModifier: 1.0,
                konfliktPotenzial: "unbekannt"
            }
        };

        // Hilfsfunktion: Hole GFK-Statements basierend auf beiden Kompetenzen
        function getGfkStatements(gfk1, gfk2) {
            if (!gfk1 || !gfk2) return gfkStatements.default;

            // Normalisiere auf Key-Format (hoch, mittel, niedrig)
            const normalize = (g) => g?.toLowerCase() || null;
            const g1 = normalize(gfk1);
            const g2 = normalize(gfk2);

            if (!g1 || !g2) return gfkStatements.default;

            // Sortiere f√ºr konsistente Keys (hoch vor mittel vor niedrig)
            const order = { 'hoch': 0, 'mittel': 1, 'niedrig': 2 };
            const sorted = [g1, g2].sort((a, b) => (order[a] || 99) - (order[b] || 99));
            const key = `${sorted[0]}_${sorted[1]}`;

            return gfkStatements[key] || gfkStatements.default;
        }

        // Hilfsfunktion: Hole Statements f√ºr Archetyp-Kombination
        // Verwendet je nach Sprache die deutsche oder englische Version
        function getArchetypeStatements(type1, type2) {
            const key = `${type1}_${type2}`;
            const lang = typeof TiageI18n !== 'undefined' ? TiageI18n.getLanguage() : 'de';

            // W√§hle die richtige Statement-Quelle basierend auf der Sprache
            if (lang === 'en' && typeof archetypeStatements_EN !== 'undefined') {
                return archetypeStatements_EN[key] || archetypeStatements[key] || null;
            }
            return archetypeStatements[key] || null;
        }

        // Hilfsfunktion: Hole Statements f√ºr Dominanz-Kombination
        function getDominanceStatements(dom1, dom2) {
            // Extrahiere prim√§re Dominanz aus Multi-Select-Objekt
            const getPrimaryDominance = (dom) => {
                if (typeof dom === 'string') return dom;
                if (typeof dom === 'object' && dom !== null) {
                    // New format: { primary: 'dominant', secondary: 'submissiv' }
                    if ('primary' in dom) {
                        return dom.primary || null;
                    }
                    // Old format: { dominant: 'gelebt', submissiv: 'interessiert' }
                    // Priorit√§t: gelebt > interessiert
                    for (const key of ['dominant', 'submissiv', 'switch', 'ausgeglichen']) {
                        if (dom[key] === 'gelebt') return key;
                    }
                    for (const key of ['dominant', 'submissiv', 'switch', 'ausgeglichen']) {
                        if (dom[key] === 'interessiert') return key;
                    }
                }
                return null;
            };

            const d1 = getPrimaryDominance(dom1);
            const d2 = getPrimaryDominance(dom2);

            if (!d1 || !d2) return dominanceStatements.default;
            const key = `${d1}_${d2}`;
            return dominanceStatements[key] || dominanceStatements.default;
        }

        // Hilfsfunktion: Hole Statements f√ºr Orientierungs-Kombination
        // Ber√ºcksichtigt Orientierung UND Geschlecht f√ºr korrekte Kompatibilit√§tsbewertung
        function getOrientierungStatements(orient1, orient2, geschlecht1, geschlecht2) {
            // Default wenn Daten fehlen
            if (!orient1 || !orient2 || !geschlecht1 || !geschlecht2) {
                return orientierungStatements.default;
            }

            // Extract primary gender from object format { primary: 'cis_mann', secondary: null }
            let g1 = geschlecht1;
            let g2 = geschlecht2;
            if (g1 && typeof g1 === 'object' && 'primary' in g1) g1 = g1.primary;
            if (g2 && typeof g2 === 'object' && 'primary' in g2) g2 = g2.primary;

            // Extrahiere prim√§re Orientierung aus Multi-Select-Objekt
            const getPrimaryOrientation = (orient) => {
                if (typeof orient === 'string') return orient;
                if (typeof orient === 'object') {
                    // New format: { primary: 'homosexuell', secondary: 'heterosexuell' }
                    if ('primary' in orient) {
                        return orient.primary;
                    }
                    // Old format: { heterosexuell: 'gelebt', homosexuell: 'interessiert' }
                    // Priorit√§t: gelebt > interessiert
                    for (const key of ['heterosexuell', 'homosexuell', 'bisexuell']) {
                        if (orient[key] === 'gelebt') return key;
                    }
                    for (const key of ['heterosexuell', 'homosexuell', 'bisexuell']) {
                        if (orient[key] === 'interessiert') return key;
                    }
                }
                return null;
            };

            const o1 = getPrimaryOrientation(orient1);
            const o2 = getPrimaryOrientation(orient2);

            if (!o1 || !o2) return orientierungStatements.default;

            // Use category comparison instead of direct string comparison
            // cis_mann and trans_mann are both male, cis_frau and trans_frau are both female
            const isMaleG = (g) => {
                if (!g) return false;
                const gl = g.toLowerCase();
                return gl === 'm√§nnlich' || gl === 'cis_mann' || gl === 'trans_mann' || gl === 'mann' || gl === 'male' || gl === 'm';
            };
            const isFemaleG = (g) => {
                if (!g) return false;
                const gl = g.toLowerCase();
                return gl === 'weiblich' || gl === 'cis_frau' || gl === 'trans_frau' || gl === 'frau' || gl === 'female' || gl === 'w' || gl === 'f';
            };
            const gleichesGeschlecht = (isMaleG(g1) && isMaleG(g2)) || (isFemaleG(g1) && isFemaleG(g2)) || (g1 === g2);

            // Bisexuell ist immer grunds√§tzlich kompatibel
            if (o1 === 'bisexuell' && o2 === 'bisexuell') {
                return orientierungStatements.kompatibel_bi_bi;
            }
            if (o1 === 'bisexuell' || o2 === 'bisexuell') {
                const andereOrient = o1 === 'bisexuell' ? o2 : o1;
                // Pr√ºfe ob der andere zur bi-Person passt
                if (andereOrient === 'heterosexuell') {
                    // Hetero + Bi: kompatibel wenn unterschiedliche Geschlechter
                    if (!gleichesGeschlecht) {
                        return orientierungStatements.kompatibel_bi_hetero;
                    } else {
                        return orientierungStatements.teilweise_bi_inkompatibel;
                    }
                }
                if (andereOrient === 'homosexuell') {
                    // Homo + Bi: kompatibel wenn gleiche Geschlechter
                    if (gleichesGeschlecht) {
                        return orientierungStatements.kompatibel_bi_homo;
                    } else {
                        return orientierungStatements.teilweise_bi_inkompatibel;
                    }
                }
            }

            // Beide heterosexuell
            if (o1 === 'heterosexuell' && o2 === 'heterosexuell') {
                if (!gleichesGeschlecht) {
                    return orientierungStatements.kompatibel_hetero_hetero;
                } else {
                    return orientierungStatements.inkompatibel_hetero_hetero;
                }
            }

            // Beide homosexuell
            if (o1 === 'homosexuell' && o2 === 'homosexuell') {
                if (gleichesGeschlecht) {
                    return orientierungStatements.kompatibel_homo_homo;
                } else {
                    return orientierungStatements.inkompatibel_homo_homo;
                }
            }

            // Hetero + Homo
            if ((o1 === 'heterosexuell' && o2 === 'homosexuell') ||
                (o1 === 'homosexuell' && o2 === 'heterosexuell')) {
                return orientierungStatements.inkompatibel_hetero_homo;
            }

            return orientierungStatements.default;
        }

        // Hilfsfunktion: Hole Statements f√ºr Status-Kombination (fakt/interessiert)
        // Bewertet den kombinierten Sicherheitsgrad beider Personen √ºber alle Dimensionen
        function getStatusStatements(personDims1, personDims2) {
            if (!personDims1 || !personDims2) {
                return statusStatements.default;
            }

            // Ermittle den dominanten Status f√ºr jede Person
            // Eine Person gilt als "fakt" wenn mindestens eine Dimension als fakt markiert ist
            // und keine als interessiert
            const getPersonStatus = (dims) => {
                let hasFakt = false;
                let hasInteressiert = false;

                // Pr√ºfe Dominanz
                if (dims.dominanz && typeof dims.dominanz === 'object') {
                    // New format: { primary: 'dominant', secondary: 'submissiv' }
                    if ('primary' in dims.dominanz) {
                        if (dims.dominanz.primary) hasFakt = true;
                        if (dims.dominanz.secondary) hasInteressiert = true;
                    } else {
                        // Old format: { dominant: 'gelebt', submissiv: 'interessiert' }
                        for (const key of Object.keys(dims.dominanz)) {
                            if (dims.dominanz[key] === 'gelebt') hasFakt = true;
                            if (dims.dominanz[key] === 'interessiert') hasInteressiert = true;
                        }
                    }
                }

                // Pr√ºfe Orientierung
                if (dims.orientierung && typeof dims.orientierung === 'object') {
                    // New format: { primary: 'homosexuell', secondary: 'heterosexuell' }
                    if ('primary' in dims.orientierung) {
                        if (dims.orientierung.primary) hasFakt = true;
                        if (dims.orientierung.secondary) hasInteressiert = true;
                    } else {
                        // Old format: { heterosexuell: 'gelebt', homosexuell: 'interessiert' }
                        for (const key of Object.keys(dims.orientierung)) {
                            if (dims.orientierung[key] === 'gelebt') hasFakt = true;
                            if (dims.orientierung[key] === 'interessiert') hasInteressiert = true;
                        }
                    }
                }

                // Wenn sowohl gelebt als auch interessiert: interessiert dominiert (Unsicherheit)
                if (hasInteressiert) return 'interessiert';
                if (hasFakt) return 'gelebt';
                return null;
            };

            const status1 = getPersonStatus(personDims1);
            const status2 = getPersonStatus(personDims2);

            if (!status1 || !status2) return statusStatements.default;

            // Symmetrische Kombinationen
            if (status1 === 'gelebt' && status2 === 'gelebt') {
                return statusStatements.gelebt_gelebt;
            }
            if (status1 === 'interessiert' && status2 === 'interessiert') {
                return statusStatements.interessiert_interessiert;
            }
            // Asymmetrische Kombination (egal welche Reihenfolge)
            return statusStatements.gelebt_interessiert;
        }

        // Archetype definitions
        const archetypeDefinitions = {
            single: {
                name: "Single",
                shortDef: "Bewusste Entscheidung f√ºr ein autonomes Leben ohne Prim√§rbeziehung als dauerhafte Lebensform.",
                longDef: "Single-orientierte Menschen haben sich aktiv f√ºr ein Leben ohne dauerhafte romantische Partnerschaft entschieden. Dies ist keine √úbergangsphase ('zwischen Beziehungen'), sondern eine bewusste Lebensform, die Selbstgen√ºgsamkeit und pers√∂nliche Autonomie als zentrale Werte sieht. Soziale Kontakte, Freundschaften und gelegentliche romantische/sexuelle Begegnungen sind m√∂glich, aber keine feste Partnerschaft wird angestrebt.",
                keyPrinciples: [
                    "Selbstgen√ºgsamkeit als Wert, nicht als Mangel",
                    "Pers√∂nliche Autonomie √ºber Verbindlichkeit",
                    "Beziehungen als Option, nicht als Notwendigkeit",
                    "Erf√ºllung durch Selbst, Freunde, Projekte"
                ],
                notTheSameAs: [
                    "'Zwischen Beziehungen' sein",
                    "'Noch nicht den Richtigen gefunden'",
                    "Beziehungsunf√§hig oder bindungs√§ngstlich",
                    "Einsam oder ungl√ºcklich"
                ],
                variants: [
                    "Aromantisch-Single: Keine romantischen Gef√ºhle, kein Bed√ºrfnis danach",
                    "Bewusst-autonom: Positive Entscheidung f√ºr Freiheit",
                    "Beziehungs-kritisch: Bevorzugt Unabh√§ngigkeit"
                ]
            },
            duo: {
                name: "Duo",
                shortDef: "Traditionelle monogame Zweierbeziehung mit Exklusivit√§t und gemeinsamer Lebensgestaltung als Kernprinzip.",
                longDef: "Duo-orientierte Menschen leben in oder suchen eine klassische Zweierbeziehung mit romantischer und sexueller Exklusivit√§t. Die Partnerschaft steht im Zentrum der Lebensgestaltung und wird als prim√§re emotionale und soziale Einheit verstanden. Gemeinsame Ziele, Alltag und Zukunftsplanung werden als Paar gestaltet.",
                keyPrinciples: [
                    "Exklusivit√§t als Ausdruck von Verbindlichkeit",
                    "'Wir' als zentrale Einheit √ºber 'Ich'",
                    "Tiefe durch Fokussierung auf eine Person",
                    "Gemeinsame Lebensgestaltung und Zukunftsplanung",
                    "Treue als emotionale und sexuelle Exklusivit√§t"
                ],
                notTheSameAs: [
                    "Besitzdenken oder Kontrolle",
                    "Verlust der eigenen Identit√§t",
                    "'Alte' oder '√ºberholte' Beziehungsform",
                    "Langweilig oder unerf√ºllt"
                ],
                variants: [
                    "Traditionell-Duo: Klassisches Ehe-Modell",
                    "Modern-Duo: Ohne Trauschein, flexiblere Rollen",
                    "Intensiv-Duo: Sehr enge emotionale Verschmelzung"
                ]
            },
            duo_flex: {
                name: "Duo-Flex",
                shortDef: "Prim√§re Zweierbeziehung mit vereinbarten √ñffnungen f√ºr zus√§tzliche Kontakte unter klaren Regeln.",
                longDef: "Duo-Flex-orientierte Menschen leben in einer Hauptbeziehung mit einem Prim√§rpartner, √∂ffnen diese aber bewusst und einvernehmlich f√ºr weitere Kontakte. Die Prim√§rbeziehung bleibt zentral und privilegiert. Alle √ñffnungen erfolgen transparent und nach gemeinsam vereinbarten Regeln.",
                keyPrinciples: [
                    "Prim√§rbeziehung als Anker und Priorit√§t",
                    "Sexuelle/romantische Vielfalt ohne Hierarchie-Aufgabe",
                    "Ehrlichkeit und Transparenz √ºber alle Kontakte",
                    "Regeln sch√ºtzen die Hauptbeziehung",
                    "Freiheit innerhalb vereinbarter Grenzen"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alles ist abgesprochen!)",
                    "'Beziehung retten' durch √ñffnung",
                    "Fehlende Verbindlichkeit",
                    "√úbergangsphase zu Polyamorie"
                ],
                variants: [
                    "Swinging/Lifestyle: Gemeinsame sexuelle Erlebnisse",
                    "Open Relationship: Individuelle sexuelle Freiheit",
                    "Hierarchisches Poly: Prim√§rpartner + Nebenbeziehungen"
                ]
            },
            solopoly: {
                name: "Solopoly",
                shortDef: "Mehrere gleichwertige Beziehungen bei bewusster Bewahrung der eigenen Autonomie - keine Prim√§rpartner.",
                longDef: "Solopoly-orientierte Menschen f√ºhren mehrere romantische und/oder sexuelle Beziehungen parallel, ohne eine davon als 'Hauptbeziehung' zu priorisieren. Die pers√∂nliche Autonomie steht im Zentrum: Kein Zusammenziehen, keine gemeinsame Haushaltsf√ºhrung. 'Ich bin mein eigener Prim√§rpartner'.",
                keyPrinciples: [
                    "Autonomie als h√∂chster Wert - auch in Beziehungen",
                    "Mehrere gleichwertige Beziehungen ohne Hierarchie",
                    "Keine Verschmelzung oder gemeinsame Haushalte",
                    "'Ich bin mein eigener Prim√§rpartner'",
                    "Liebe ohne Aufgabe der Unabh√§ngigkeit"
                ],
                notTheSameAs: [
                    "Bindungsangst oder Commitment-Probleme",
                    "'Light-Version' von Polyamorie",
                    "Egoistisch oder beziehungsunf√§hig",
                    "Zwischenstufe zu 'richtiger' Partnerschaft"
                ],
                variants: [
                    "Stark-autonom: Sehr klare Grenzen",
                    "Beziehungs-balanciert: Tiefe Beziehungen, getrennte Wohnungen",
                    "Netzwerk-orientiert: Viele gleichwertige Connections"
                ]
            },
            ra: {
                name: "RA",
                shortDef: "Vollst√§ndige Ablehnung von Beziehungshierarchien und gesellschaftlichen Normen.",
                longDef: "RAs hinterfragen alle gesellschaftlichen Beziehungsnormen radikal. Keine Beziehung ist 'h√∂her' als eine andere - Freundschaften k√∂nnen genauso wichtig sein wie romantische Beziehungen. Jede Verbindung wird individuell definiert, ohne externe Vorlagen.",
                keyPrinciples: [
                    "Keine Hierarchien zwischen Beziehungstypen",
                    "Jede Beziehung wird individuell definiert",
                    "Ablehnung gesellschaftlicher Beziehungsnormen",
                    "Autonomie als h√∂chster Wert",
                    "Keine Besitzanspr√ºche an andere Menschen"
                ],
                notTheSameAs: [
                    "Beziehungsunf√§hig oder bindungsscheu",
                    "Chaotisch oder regellos",
                    "Verantwortungslos",
                    "Gegen Commitment generell"
                ],
                variants: [
                    "Anarchisch-vernetzt: Viele gleichwertige Verbindungen",
                    "Philosophisch-RA: Tiefe Reflexion √ºber Normen",
                    "Pragmatisch-RA: Flexible Anwendung der Prinzipien"
                ]
            },
            lat: {
                name: "LAT (Living Apart Together)",
                shortDef: "Feste Partnerschaft mit bewusst getrennten Wohnungen und Alltagsleben.",
                longDef: "LAT-orientierte Menschen w√ºnschen sich tiefe, verbindliche Beziehungen, aber mit klarer r√§umlicher und allt√§glicher Autonomie. Die eigenen vier W√§nde sind kein Zeichen von Distanz, sondern von gesunder Selbstf√ºrsorge.",
                keyPrinciples: [
                    "Liebe braucht kein gemeinsames Dach",
                    "Eigener R√ºckzugsraum ist essentiell",
                    "Qualit√§tszeit √ºber Quantit√§t",
                    "Autonomie im Alltag",
                    "Bewusste Entscheidung f√ºr N√§he"
                ],
                notTheSameAs: [
                    "Bindungsangst oder Commitment-Phobie",
                    "Fernbeziehung aus Zwang",
                    "Halbe Beziehung oder weniger ernst",
                    "√úbergangsphase zum Zusammenziehen"
                ],
                variants: [
                    "Nachbarschafts-LAT: Getrennte Wohnungen in der N√§he",
                    "Wochenend-LAT: Intensives Zeit-teilen am Wochenende",
                    "Flexibel-LAT: Situative Anpassung der N√§he"
                ]
            },
            aromantisch: {
                name: "Aromantisch",
                shortDef: "Wenig oder keine romantische Anziehung, aber tiefe Verbindungen auf anderen Ebenen.",
                longDef: "Aromantische Menschen erleben wenig bis keine romantische Anziehung zu anderen. Das bedeutet nicht, dass sie keine tiefen Verbindungen haben k√∂nnen - Freundschaften, queerplatonische Beziehungen und andere Formen von N√§he sind m√∂glich und wertvoll.",
                keyPrinciples: [
                    "Romantische Liebe ist nicht die einzige Tiefe",
                    "Freundschaften k√∂nnen prim√§re Beziehungen sein",
                    "Ehrlichkeit √ºber eigene Grenzen",
                    "Keine Verpflichtung zu romantischen Gef√ºhlen",
                    "Alternative Beziehungsformen werden wertgesch√§tzt"
                ],
                notTheSameAs: [
                    "Kalt oder gef√ºhllos",
                    "Antisozial oder einsam",
                    "Noch nicht die richtige Person gefunden",
                    "Psychische St√∂rung oder Defizit"
                ],
                variants: [
                    "Greyromantisch: Seltene romantische Anziehung",
                    "Demiromantisch: Romantik nur nach tiefer Bindung",
                    "Queerplatonisch: Tiefe nicht-romantische Prim√§rbeziehungen"
                ]
            },
            polyamor: {
                name: "Polyamor",
                shortDef: "Mehrere gleichzeitige, ethisch gef√ºhrte Liebesbeziehungen mit Transparenz und emotionalem Commitment.",
                longDef: "Polyamor-orientierte Menschen f√ºhren mehrere romantische Beziehungen parallel, die alle auf Ehrlichkeit, Einvernehmlichkeit und Transparenz basieren. Tiefe Verschmelzung, Zusammenleben und gemeinsame Zukunftsplanung mit mehreren Partnern sind m√∂glich und erw√ºnscht. Alle Beteiligten wissen voneinander.",
                keyPrinciples: [
                    "Liebe ist nicht begrenzt oder exklusiv",
                    "Ehrlichkeit und Transparenz gegen√ºber allen",
                    "Konsens und Einvernehmlichkeit als Basis",
                    "Emotionale Tiefe zu mehreren Menschen",
                    "Kommunikation als zentrale Kompetenz"
                ],
                notTheSameAs: [
                    "Untreue oder Betrug (alle wissen Bescheid!)",
                    "Bindungsunf√§higkeit",
                    "Nur Sex ohne Gef√ºhle",
                    "Chaotisch oder unkontrolliert"
                ],
                variants: [
                    "Hierarchisches Poly: Prim√§r-, Sekund√§rpartner",
                    "Nicht-hierarchisches Poly: Alle gleichwertig",
                    "Kitchen-Table-Poly: Alle Partner verstehen sich",
                    "Parallel-Poly: Partner kennen sich, wenig Kontakt"
                ]
            }
        };

        // Tag tooltip content for type combinations
        // Keys: "type1-type2" (alphabetically sorted), categories: A-F, tags: normalized tag names
        const tagTooltipContent = {
            // Single √ó Polyamor (niedrige Kompatibilit√§t - Priorit√§t)
            "polyamor-single": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Singles haben keine aktive Exklusivit√§ts-Erwartung, da sie bewusst ohne Prim√§rbeziehung leben.",
                        type2Perspective: "Polyamor-Menschen lehnen Exklusivit√§t als Grundprinzip ab - Liebe wird als nicht-begrenzt verstanden.",
                        dynamic: "Beide lehnen Exklusivit√§t ab, aber aus v√∂llig verschiedenen Gr√ºnden: Single will keine Beziehung, Polyamor will mehrere gleichzeitig."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Singles sind theoretisch offen, haben aber keine aktive Beziehungspraxis.",
                        type2Perspective: "Polyamor lebt alternative Modelle aktiv mit mehreren gleichzeitigen Liebesbeziehungen.",
                        dynamic: "Potenzielle Br√ºcke: Ein Single k√∂nnte Polyamorie entdecken, wenn die Autonomie gewahrt bleibt."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "F√ºr Singles ist Beziehung kein zentraler Lebensinhalt - Selbstgen√ºgsamkeit steht im Vordergrund.",
                        type2Perspective: "F√ºr Polyamor sind Beziehungen sehr zentral, aber als Netzwerk statt als einzelne Partnerschaft.",
                        dynamic: "Grundlegend verschiedene Lebensentw√ºrfe: Beziehungsfreiheit vs. Beziehungsvielfalt als Ideal."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue ist f√ºr Singles kein relevantes Konzept, da keine Beziehungsverpflichtungen bestehen.",
                        type2Perspective: "Treue bedeutet f√ºr Polyamor Ehrlichkeit und Transparenz, nicht Exklusivit√§t.",
                        dynamic: "Verschiedene Bedeutungen: F√ºr Single irrelevant, f√ºr Polyamor transformiert - aber nicht abwesend."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Singles praktizieren Selbstverantwortung ohne Rechenschaftspflicht gegen√ºber Partnern.",
                        type2Perspective: "Polyamor betont ethische Verantwortung gegen√ºber allen Beziehungspartnern.",
                        dynamic: "Single lebt f√ºr sich, Polyamor f√ºr ein Netzwerk - unterschiedliche ethische Bezugsrahmen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung liegt prim√§r bei sich selbst und eigenen Lebensentscheidungen.",
                        type2Perspective: "Verantwortung erstreckt sich auf mehrere Partner und deren emotionale Bed√ºrfnisse.",
                        dynamic: "Einzelverantwortung vs. Netzwerkverantwortung - fundamental verschiedene Komplexit√§tsgrade."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Singles meiden emotionale Verschmelzung zugunsten von Selbstgen√ºgsamkeit.",
                        type2Perspective: "Polyamor sucht emotionale Tiefe mit mehreren Menschen gleichzeitig.",
                        dynamic: "Singles wahren Distanz, Polyamor sucht N√§he - aber verteilt auf mehrere Personen."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische N√§he ist f√ºr Singles optional und situativ, nicht strukturell verankert.",
                        type2Perspective: "Polyamor hat oft hohe physische N√§he-Bed√ºrfnisse zu mehreren Partnern.",
                        dynamic: "Singles regulieren N√§he selbst, Polyamor jongliert N√§he-Bed√ºrfnisse im Netzwerk."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Singles brauchen viel Raum und sind ge√ºbt darin, diesen zu verteidigen.",
                        type2Perspective: "Polyamor gibt Raum durch verteilte Aufmerksamkeit auf mehrere Partner.",
                        dynamic: "Beide k√∂nnen Raum geben - Single durch Abwesenheit, Polyamor durch Verteilung."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Maximale Freiheit ohne Kompromisse - Singles gestalten ihr Leben vollst√§ndig selbst.",
                        type2Perspective: "Freiheit innerhalb eines ethischen Beziehungsnetzwerks mit Absprachen.",
                        dynamic: "Absolute vs. verhandelte Freiheit - Singles haben mehr, m√ºssen aber auf Beziehungstiefe verzichten."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Volle Entscheidungsautonomie ohne R√ºcksprache oder Kompromisse.",
                        type2Perspective: "Entscheidungsautonomie mit Transparenzpflicht gegen√ºber allen Partnern.",
                        dynamic: "Singles entscheiden allein, Polyamor kommuniziert - verschiedene Autonomie-Definitionen."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Singles respektieren Autonomie anderer, da sie selbst maximale Autonomie leben.",
                        type2Perspective: "Polyamor f√∂rdert aktiv die Autonomie aller Partner im Netzwerk.",
                        dynamic: "Passives Respektieren vs. aktives F√∂rdern von Autonomie."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Singles kommunizieren situativ und bei Bedarf, ohne dauerhafte Verpflichtung.",
                        type2Perspective: "Polyamor erfordert tiefe, kontinuierliche Kommunikation mit allen Partnern.",
                        dynamic: "Verschiedene Kommunikationskulturen: Bedarfsorientiert vs. strukturell verankert."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Singles k√∂nnen Konflikte durch R√ºckzug vermeiden - keine Beziehungspflicht.",
                        type2Perspective: "Polyamor muss Konflikte aktiv l√∂sen, um das Netzwerk zu erhalten.",
                        dynamic: "Exit-Option vs. Konfliktl√∂sung als Notwendigkeit - sehr verschiedene Strategien."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz ist optional, da keine festen Beziehungspflichten bestehen.",
                        type2Perspective: "Maximale emotionale Transparenz als ethische Grundlage aller Beziehungen.",
                        dynamic: "Freiwillige vs. verpflichtende Transparenz - unterschiedliche Grundhaltungen."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Singles sind gesellschaftlich akzeptiert, wenn auch manchmal bedauert.",
                        type2Perspective: "Polyamor erf√§hrt oft Stigmatisierung und Unverst√§ndnis.",
                        dynamic: "Single ist 'normal', Polyamor muss sich erkl√§ren - verschiedene gesellschaftliche Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Singles integrieren sich individuell und flexibel in soziale Kreise.",
                        type2Perspective: "Polyamor bringt komplexe Beziehungsstrukturen in soziale Kontexte ein.",
                        dynamic: "Einfache vs. komplexe soziale Integration - Singles haben es leichter."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Singles erleben mildes Stigma ('Wann heiratest du?'), aber keine starke Ablehnung.",
                        type2Perspective: "Polyamor muss aktiv mit Vorurteilen und Abwertung umgehen.",
                        dynamic: "Leichtes vs. starkes Stigma - Polyamor braucht mehr Resilienz."
                    }
                }
            },
            // Duo √ó Polyamor (maximaler Konflikt - Priorit√§t)
            "duo-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo sieht Exklusivit√§t als fundamentalen Ausdruck von Liebe und Verbindlichkeit.",
                        type2Perspective: "Polyamor versteht Liebe als nicht-begrenzte Ressource, die sich auf mehrere Menschen erstrecken kann.",
                        dynamic: "Fundamentaler Konflikt: Was f√ºr Duo Treue bedeutet, ist f√ºr Polyamor eine k√ºnstliche Beschr√§nkung."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo bevorzugt das bew√§hrte Zweiermodell und sieht wenig Grund zur √ñffnung.",
                        type2Perspective: "Polyamor lebt aktiv ein alternatives Modell und hinterfragt Monogamie-Normen.",
                        dynamic: "Tradition vs. Alternative: Duo fragt 'Warum √§ndern?', Polyamor fragt 'Warum beschr√§nken?'"
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "F√ºr Duo ist DIE Beziehung zentraler Lebensinhalt - 'Wir' als Einheit.",
                        type2Perspective: "F√ºr Polyamor sind Beziehungen plural - mehrere gleichwertige 'Wirs'.",
                        dynamic: "Singul√§res 'Wir' vs. plurales 'Wir' - grundverschiedene Beziehungsarchitekturen."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet exklusive emotionale und sexuelle Bindung an eine Person.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit, Transparenz und Einhalten von Absprachen - nicht Exklusivit√§t.",
                        dynamic: "Maximaler Definitionskonflikt: Duo sieht Untreue, wo Polyamor Transparenz sieht."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen, Verbindlichkeit und Fokussierung auf einen Partner.",
                        type2Perspective: "Ethik basiert auf Ehrlichkeit, Konsens und Verantwortung gegen√ºber allen Beteiligten.",
                        dynamic: "Verschiedene ethische Fundamente: Exklusivit√§tsethik vs. Transparenzethik."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung konzentriert sich auf einen Partner und die gemeinsame Zukunft.",
                        type2Perspective: "Verantwortung verteilt sich auf mehrere Partner und komplexe Beziehungsdynamiken.",
                        dynamic: "Fokussierte vs. verteilte Verantwortung - unterschiedliche Kapazit√§tsanforderungen."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Duo strebt tiefe emotionale Verschmelzung mit einem Partner an.",
                        type2Perspective: "Polyamor erlebt emotionale Tiefe mit mehreren Menschen, aber weniger Verschmelzung pro Person.",
                        dynamic: "Intensive Tiefe zu einem vs. verteilte Tiefe zu mehreren - verschiedene emotionale √ñkonomien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische N√§he fokussiert sich exklusiv auf den Partner.",
                        type2Perspective: "Physische N√§he verteilt sich auf mehrere Partner nach Bedarf und Absprache.",
                        dynamic: "Exklusive vs. geteilte Intimit√§t - kann f√ºr Duo als Verlust erlebt werden."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Duo gibt Raum innerhalb der Partnerschaft, aber nicht f√ºr andere Beziehungen.",
                        type2Perspective: "Polyamor muss Raum f√ºr alle Partner schaffen und ausbalancieren.",
                        dynamic: "Raum f√ºr Individuum vs. Raum f√ºr andere Beziehungen - verschiedene Raumkonzepte."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert und gelebt.",
                        type2Perspective: "Individuelle Freiheit schlie√üt Freiheit f√ºr mehrere Liebesbeziehungen ein.",
                        dynamic: "Paar-Freiheit vs. individuelle Beziehungsfreiheit - verschiedene Freiheitsbegriffe."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen werden als Paar getroffen.",
                        type2Perspective: "Individuelle Autonomie auch bei Beziehungsentscheidungen, mit Transparenz.",
                        dynamic: "Gemeinsame vs. individuelle Entscheidungsmacht - kann zu Konflikten f√ºhren."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie des Partners wird anerkannt, aber nicht f√ºr andere Beziehungen.",
                        type2Perspective: "Autonomie schlie√üt explizit die Freiheit f√ºr weitere Liebesbeziehungen ein.",
                        dynamic: "Begrenzte vs. unbegrenzte Autonomie-Akzeptanz - Kernkonflikt dieser Kombination."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit einem Partner √ºber alle Lebensaspekte.",
                        type2Perspective: "Tiefe Kommunikation mit mehreren Partnern, plus Meta-Kommunikation √ºber Beziehungen.",
                        dynamic: "Verschiedene Kommunikationsanforderungen: Duo ist intensiv, Polyamor ist extensiv."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gel√∂st, ohne externe Beziehungen.",
                        type2Perspective: "Konflikte k√∂nnen mehrere Partner betreffen und erfordern komplexe L√∂sungen.",
                        dynamic: "Bilaterale vs. multilaterale Konfliktl√∂sung - verschiedene Komplexit√§tsgrade."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Emotionale Transparenz prim√§r gegen√ºber dem einen Partner.",
                        type2Perspective: "Emotionale Transparenz gegen√ºber allen Partnern als ethische Basis.",
                        dynamic: "Duo kann Transparenz gegen√ºber 'Dritten' als Verrat empfinden - Polyamor als Grundlage."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo entspricht der gesellschaftlichen Norm und genie√üt volle Akzeptanz.",
                        type2Perspective: "Polyamor muss gegen Vorurteile und mangelndes Verst√§ndnis k√§mpfen.",
                        dynamic: "Norm vs. Abweichung - Duo hat soziale Vorteile, Polyamor soziale H√ºrden."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Duo wird als 'normales' Paar problemlos in alle Kontexte integriert.",
                        type2Perspective: "Polyamor muss erkl√§ren, verbergen oder mit Unverst√§ndnis umgehen.",
                        dynamic: "Reibungslose vs. erkl√§rungsbed√ºrftige Integration - verschiedene soziale Belastungen."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Duo erf√§hrt kein Stigma, sondern gesellschaftliche Unterst√ºtzung.",
                        type2Perspective: "Polyamor muss aktiv mit Stigmatisierung und Diskriminierung umgehen.",
                        dynamic: "Privilegierte vs. marginalisierte Position - kann zu Unverst√§ndnis f√ºhren."
                    }
                }
            },
            // Duo-Flex √ó Solopoly (interessante Balance - Priorit√§t)
            "duo_flex-solopoly": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Duo-Flex h√§lt an einer Prim√§rbeziehung fest, √∂ffnet aber f√ºr Zusatzkontakte.",
                        type2Perspective: "Solopoly lehnt jede Form von Prim√§rhierarchie ab - alle Beziehungen sind gleichwertig.",
                        dynamic: "Hierarchie vs. Gleichwertigkeit: Duo-Flex braucht einen Anker, Solopoly will keinen."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Duo-Flex ist offen, aber innerhalb eines strukturierten Rahmens mit Prim√§rpartner.",
                        type2Perspective: "Solopoly lebt maximale Offenheit ohne Verpflichtung zu einer Hauptbeziehung.",
                        dynamic: "Gerahmte vs. ungerahmte Offenheit - beide alternativ, aber verschieden strukturiert."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Prim√§rbeziehung ist Lebensinhalt, andere Kontakte sind Bereicherung.",
                        type2Perspective: "Alle Beziehungen sind Lebensbereiche, keiner ist zentraler Lebensinhalt.",
                        dynamic: "Zentrale vs. dezentrale Beziehungsarchitektur - verschiedene Lebensmodelle."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue bedeutet Ehrlichkeit und Prioririsierung des Hauptpartners.",
                        type2Perspective: "Treue bedeutet Ehrlichkeit gegen√ºber allen, ohne Hierarchie der Wichtigkeit.",
                        dynamic: "Hierarchische vs. egalit√§re Treue-Definition - beide ehrlich, anders strukturiert."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik sch√ºtzt die Prim√§rbeziehung, √ñffnungen erfolgen im Rahmen.",
                        type2Perspective: "Ethik behandelt alle Partner gleich, ohne Vorrang einer Beziehung.",
                        dynamic: "Schutzethik vs. Gleichheitsethik - verschiedene ethische Priorit√§ten."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "H√∂chste Verantwortung gegen√ºber dem Prim√§rpartner, dann anderen.",
                        type2Perspective: "Gleiche Verantwortung gegen√ºber allen Partnern, kein 'mehr' oder 'weniger'.",
                        dynamic: "Gestufte vs. gleiche Verantwortung - kann zu Missverst√§ndnissen f√ºhren."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Verschmelzung prim√§r mit dem Hauptpartner.",
                        type2Perspective: "Solopoly meidet Verschmelzung bewusst, um Autonomie zu bewahren.",
                        dynamic: "Selektive Verschmelzung vs. generelle Distanz - verschiedene N√§he-Strategien."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische N√§he haupts√§chlich mit Prim√§rpartner, situativ mit anderen.",
                        type2Perspective: "Physische N√§he gleichm√§√üig verteilt, kein 'Zuhause' bei einem Partner.",
                        dynamic: "Zentrierte vs. verteilte Intimit√§t - verschiedene N√§he-Modelle."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum wird innerhalb der Prim√§rbeziehung verhandelt.",
                        type2Perspective: "Raum ist strukturell gegeben durch separate Lebensr√§ume.",
                        dynamic: "Verhandelter vs. struktureller Raum - Solopoly hat mehr eingebaute Distanz."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit innerhalb der Prim√§rbeziehungs-Struktur.",
                        type2Perspective: "Maximale individuelle Freiheit als Grundprinzip des Lebens.",
                        dynamic: "Gerahmte vs. maximale Freiheit - verschiedene Autonomie-Level."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen mit Prim√§rpartner, aber mehr Freiraum als Duo.",
                        type2Perspective: "Volle Entscheidungsautonomie, Transparenz statt Absprache.",
                        dynamic: "Abgestimmte vs. informierte Autonomie - verschiedene Entscheidungsprozesse."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie wird akzeptiert, solange die Prim√§rbeziehung Priorit√§t bleibt.",
                        type2Perspective: "Autonomie wird bedingungslos akzeptiert - keine Hierarchie-Erwartung.",
                        dynamic: "Bedingte vs. bedingungslose Autonomie-Akzeptanz."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation mit Prim√§rpartner √ºber alle Aspekte.",
                        type2Perspective: "Situative Kommunikationstiefe je nach Beziehung und Bedarf.",
                        dynamic: "Zentrierte vs. verteilte Kommunikationstiefe."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte prim√§r im Kontext der Hauptbeziehung l√∂sen.",
                        type2Perspective: "Konflikte individuell mit jedem Partner, ohne zentrale Instanz.",
                        dynamic: "Zentralisierte vs. dezentralisierte Konfliktl√∂sung."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegen√ºber Prim√§rpartner, selektiv gegen√ºber anderen.",
                        type2Perspective: "Gleichm√§√üige Transparenz gegen√ºber allen Partnern.",
                        dynamic: "Gestufte vs. gleiche Transparenz - verschiedene Informationsfl√ºsse."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Duo-Flex kann als 'offene Ehe' noch relativ akzeptiert werden.",
                        type2Perspective: "Solopoly ist schwer zu erkl√§ren und wird oft missverstanden.",
                        dynamic: "Relativ akzeptiert vs. erkl√§rungsbed√ºrftig - verschiedene soziale Positionen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Prim√§rpaar wird integriert, Zusatzkontakte bleiben oft privat.",
                        type2Perspective: "Alle Beziehungen gleichwertig in soziale Kreise integrieren ist komplex.",
                        dynamic: "Einfachere vs. komplexere soziale Integration."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Mildes Stigma, wenn √ñffnung bekannt wird.",
                        type2Perspective: "St√§rkeres Stigma durch unkonventionelle Lebensform ohne 'Hauptpartner'.",
                        dynamic: "Verschiedene Stigma-Level - Solopoly ist gesellschaftlich unbekannter."
                    }
                }
            },
            // Polyamor √ó Polyamor (hohe Kompatibilit√§t - Test)
            "polyamor-polyamor": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Keine Exklusivit√§ts-Erwartung, Liebe wird als nicht-begrenzt verstanden.",
                        type2Perspective: "Gleiche Grundhaltung: Liebe zu mehreren Menschen ist m√∂glich und ethisch.",
                        dynamic: "Volle √úbereinstimmung: Beide verstehen und leben nicht-exklusive Liebe."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Lebt aktiv ein alternatives Beziehungsmodell.",
                        type2Perspective: "Teilt diese Lebensrealit√§t und die damit verbundenen Werte.",
                        dynamic: "Maximale Synergie: Beide haben den gleichen Referenzrahmen f√ºr Beziehungen."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Beziehungen sind zentraler Lebensinhalt, aber als Netzwerk.",
                        type2Perspective: "Versteht und teilt diese Beziehungsarchitektur vollst√§ndig.",
                        dynamic: "Geteiltes Verst√§ndnis: Beziehungsnetzwerk als gemeinsamer Lebensraum."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = Ehrlichkeit, Transparenz, Einhalten von Agreements.",
                        type2Perspective: "Gleiche Definition von Treue, ohne Exklusivit√§tskomponente.",
                        dynamic: "√úbereinstimmung bei einem der kritischsten Beziehungskonzepte."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Konsens, Kommunikation und Respekt.",
                        type2Perspective: "Teilt diese ethischen Grundlagen und praktiziert sie aktiv.",
                        dynamic: "Gemeinsame ethische Basis erleichtert Verhandlungen und Absprachen."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Verantwortung f√ºr ein Netzwerk von Beziehungen und Gef√ºhlen.",
                        type2Perspective: "Versteht diese Komplexit√§t und tr√§gt sie mit.",
                        dynamic: "Geteilte Erfahrung mit der Komplexit√§t polyamorer Verantwortung."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "Emotionale Tiefe mit mehreren Menschen, bewusst dosiert.",
                        type2Perspective: "Gleiche Erfahrung und Kompetenz im Umgang mit verteilter Intimit√§t.",
                        dynamic: "Beide verstehen, wie Tiefe in einem Poly-Kontext funktioniert."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische N√§he verteilt sich auf mehrere Partner.",
                        type2Perspective: "Akzeptiert und praktiziert geteilte Intimit√§t.",
                        dynamic: "Keine Eifersucht auf physische N√§he mit anderen - geteilte Norm."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum f√ºr andere Beziehungen ist selbstverst√§ndlich.",
                        type2Perspective: "Erwartet und gibt gleicherma√üen Raum f√ºr das Beziehungsnetzwerk.",
                        dynamic: "Strukturelle √úbereinstimmung: Beide brauchen und geben Beziehungs-Raum."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit f√ºr mehrere Liebesbeziehungen als Grundrecht.",
                        type2Perspective: "Teilt dieses Freiheitsverst√§ndnis vollst√§ndig.",
                        dynamic: "Keine Einschr√§nkung der romantischen Freiheit - beidseitiges Verst√§ndnis."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Autonomie bei Beziehungsentscheidungen, mit Transparenzpflicht.",
                        type2Perspective: "Gleiche Balance zwischen Autonomie und Verantwortung.",
                        dynamic: "Geteilte Entscheidungskultur: Autonom, aber transparent."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Volle Akzeptanz der Beziehungsfreiheit des Partners.",
                        type2Perspective: "Erwartet und praktiziert die gleiche Akzeptanz.",
                        dynamic: "Wechselseitige Autonomie-Akzeptanz als Fundament der Beziehung."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation als Kernkompetenz polyanorer Beziehungen.",
                        type2Perspective: "Bringt gleiche Kommunikationsf√§higkeiten und -erwartungen mit.",
                        dynamic: "Hohe Kommunikationskompetenz auf beiden Seiten - ideale Voraussetzung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Erfahrung mit komplexen, multilateralen Konflikten.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten L√∂sungsstrategien.",
                        dynamic: "Beide sind 'Poly-gepr√ºft' in Konfliktsituationen - gro√üe Resilienz."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Maximale Transparenz als ethische Grundlage.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Praxis.",
                        dynamic: "Keine versteckten Emotionen, keine versteckten Beziehungen - klare Basis."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Muss mit gesellschaftlicher Stigmatisierung umgehen.",
                        type2Perspective: "Teilt diese Erfahrung und die entwickelten Coping-Strategien.",
                        dynamic: "Gemeinsame Au√üenseiter-Position kann verbinden und st√§rken."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Komplexe Beziehungsstrukturen in soziale Kontexte einbringen.",
                        type2Perspective: "Versteht und teilt diese Herausforderung.",
                        dynamic: "Gegenseitige Unterst√ºtzung bei sozialer Navigation."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Aktiver Umgang mit Vorurteilen und Diskriminierung.",
                        type2Perspective: "Teilt diese Erfahrung und die Resilienz-Strategien.",
                        dynamic: "Gemeinsame St√§rke gegen gesellschaftlichen Druck."
                    }
                }
            },
            // Duo √ó Duo (hohe Kompatibilit√§t - Test)
            "duo-duo": {
                "A": {
                    "exklusivitaets-erwartung": {
                        type1Perspective: "Exklusivit√§t als fundamentaler Ausdruck von Liebe.",
                        type2Perspective: "Teilt dieses Verst√§ndnis von Exklusivit√§t vollst√§ndig.",
                        dynamic: "Perfekte √úbereinstimmung: Beide verstehen und w√ºnschen Exklusivit√§t."
                    },
                    "offenheit-fuer-alternative-modelle": {
                        type1Perspective: "Bevorzugt das klassische Zweiermodell.",
                        type2Perspective: "Gleiche Pr√§ferenz f√ºr monogame Partnerschaft.",
                        dynamic: "Geteilte Wertsch√§tzung f√ºr traditionelles Beziehungsmodell."
                    },
                    "beziehung-als-lebensinhalt-vs-lebensbereich": {
                        type1Perspective: "Die Partnerschaft ist zentraler Lebensinhalt.",
                        type2Perspective: "Teilt diese Priorisierung der Beziehung.",
                        dynamic: "Gemeinsames 'Wir' als Lebensmittelpunkt - perfekte Synergie."
                    }
                },
                "B": {
                    "definition-von-treue": {
                        type1Perspective: "Treue = exklusive emotionale und sexuelle Bindung.",
                        type2Perspective: "Gleiche Definition, gleiche Erwartung.",
                        dynamic: "Keine Definitions-Konflikte bei diesem zentralen Thema."
                    },
                    "ethische-grundhaltung": {
                        type1Perspective: "Ethik basiert auf Versprechen und Verbindlichkeit.",
                        type2Perspective: "Teilt diese ethischen Grundwerte.",
                        dynamic: "Gemeinsame ethische Basis f√ºr eine stabile Partnerschaft."
                    },
                    "verantwortungsbewusstsein": {
                        type1Perspective: "Fokussierte Verantwortung f√ºreinander.",
                        type2Perspective: "Gleiche Verantwortungsbereitschaft.",
                        dynamic: "Gegenseitige, konzentrierte Verantwortung - klare Struktur."
                    }
                },
                "C": {
                    "emotionale-verschmelzungs-tendenz": {
                        type1Perspective: "W√ºnscht tiefe emotionale Verschmelzung.",
                        type2Perspective: "Teilt dieses Bed√ºrfnis nach N√§he und Verbundenheit.",
                        dynamic: "Beidseitiges Streben nach emotionaler Tiefe."
                    },
                    "physische-naehe-beduerfnisse": {
                        type1Perspective: "Physische N√§he exklusiv mit dem Partner.",
                        type2Perspective: "Gleiche Exklusivit√§ts-Erwartung bei Intimit√§t.",
                        dynamic: "Keine Konkurrenz um N√§he - ungeteilte Aufmerksamkeit."
                    },
                    "faehigkeit-raum-zu-geben": {
                        type1Perspective: "Raum innerhalb der Partnerschaft.",
                        type2Perspective: "Gleiche Balance zwischen N√§he und individuellem Raum.",
                        dynamic: "√Ñhnliche Raum-Bed√ºrfnisse erleichtern das Zusammenleben."
                    }
                },
                "D": {
                    "individuelle-freiheit": {
                        type1Perspective: "Freiheit wird gemeinsam als Paar definiert.",
                        type2Perspective: "Teilt dieses Verst√§ndnis von Paar-Freiheit.",
                        dynamic: "Gemeinsame Freiheits-Definition als 'Wir'."
                    },
                    "entscheidungsautonomie": {
                        type1Perspective: "Wichtige Entscheidungen gemeinsam treffen.",
                        type2Perspective: "Gleiche Erwartung an gemeinsame Entscheidungsfindung.",
                        dynamic: "Geteilte Entscheidungsmacht ohne Autonomie-Konflikte."
                    },
                    "akzeptanz-der-autonomie-des-anderen": {
                        type1Perspective: "Autonomie innerhalb des Paar-Rahmens.",
                        type2Perspective: "Gleiche Balance zwischen Individualit√§t und Partnerschaft.",
                        dynamic: "√Ñhnliche Autonomie-Grenzen erleichtern das Zusammenleben."
                    }
                },
                "E": {
                    "kommunikationstiefe": {
                        type1Perspective: "Tiefe Kommunikation zu zweit.",
                        type2Perspective: "Gleicher Wunsch nach intensivem Austausch.",
                        dynamic: "Fokussierte, tiefe Kommunikation ohne Verteilung."
                    },
                    "konfliktfaehigkeit": {
                        type1Perspective: "Konflikte werden zu zweit gel√∂st.",
                        type2Perspective: "Gleiche Erwartung an bilaterale Konfliktl√∂sung.",
                        dynamic: "Klare Konflikt-Struktur ohne externe Komplexit√§t."
                    },
                    "emotionale-transparenz": {
                        type1Perspective: "Volle Transparenz gegen√ºber dem Partner.",
                        type2Perspective: "Gleiche Transparenz-Erwartung und -Bereitschaft.",
                        dynamic: "Gegenseitige Offenheit ohne konkurrierende Loyalit√§ten."
                    }
                },
                "F": {
                    "gesellschaftliche-akzeptanz": {
                        type1Perspective: "Volle gesellschaftliche Akzeptanz.",
                        type2Perspective: "Teilt diese privilegierte Position.",
                        dynamic: "Keine externen H√ºrden durch gesellschaftliche Normen."
                    },
                    "integration-in-soziale-kreise": {
                        type1Perspective: "Als Paar problemlos integriert.",
                        type2Perspective: "Gleiche einfache soziale Integration.",
                        dynamic: "Gesellschaftliche Normalit√§t als gemeinsame Basis."
                    },
                    "umgang-mit-stigma": {
                        type1Perspective: "Kein Stigma, sondern gesellschaftliche Unterst√ºtzung.",
                        type2Perspective: "Teilt diese Stigma-freie Erfahrung.",
                        dynamic: "Kein externer Druck - Fokus auf die Beziehung selbst."
                    }
                }
            }
        };

        // Helper function to normalize tag names for lookup
        function normalizeTagName(tag) {
            return tag.toLowerCase()
                .replace(/√§/g, 'ae').replace(/√∂/g, 'oe').replace(/√º/g, 'ue').replace(/√ü/g, 'ss')
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
        }

        // Get tooltip content for a specific tag
        function getTagTooltip(type1Id, type2Id, category, tagName) {
            const normalizedTag = normalizeTagName(tagName);

            // Sort type IDs alphabetically for consistent key lookup
            const sortedTypes = [type1Id, type2Id].sort();
            const comboKey = sortedTypes.join('-');

            // Try to find specific tooltip
            const comboData = tagTooltipContent[comboKey];
            if (comboData && comboData[category] && comboData[category][normalizedTag]) {
                const tooltip = comboData[category][normalizedTag];
                const type1 = data.archetypes[type1Id];
                const type2 = data.archetypes[type2Id];

                // Swap perspectives if types were reordered
                if (sortedTypes[0] === type2Id) {
                    return {
                        type1Name: type1?.name || type1Id,
                        type2Name: type2?.name || type2Id,
                        type1Perspective: tooltip.type2Perspective,
                        type2Perspective: tooltip.type1Perspective,
                        dynamic: tooltip.dynamic
                    };
                }

                return {
                    type1Name: type1?.name || type1Id,
                    type2Name: type2?.name || type2Id,
                    type1Perspective: tooltip.type1Perspective,
                    type2Perspective: tooltip.type2Perspective,
                    dynamic: tooltip.dynamic
                };
            }

            // Fallback: Generate generic tooltip
            return generateFallbackTooltip(type1Id, type2Id, category, tagName);
        }

        // Generate fallback tooltip when no specific content exists
        function generateFallbackTooltip(type1Id, type2Id, category, tagName) {
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const type1Def = archetypeDefinitions[type1Id];
            const type2Def = archetypeDefinitions[type2Id];

            const interactionKey = `${type1Id}_${type2Id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const catScore = scores[category]?.value || 50;

            // Generate context-aware fallback
            let dynamicText = '';
            if (catScore >= 85) {
                dynamicText = `Hohe √úbereinstimmung (${catScore}) in diesem Bereich - beide Typen haben √§hnliche Ans√§tze.`;
            } else if (catScore >= 70) {
                dynamicText = `Moderate √úbereinstimmung (${catScore}) - einige gemeinsame Grundlagen, aber auch Unterschiede.`;
            } else if (catScore >= 50) {
                dynamicText = `Mittlere Beziehungsqualit√§t (${catScore}) - deutliche Unterschiede, die Kompromisse erfordern.`;
            } else {
                dynamicText = `Herausfordernde Konstellation (${catScore}) - grundlegend verschiedene Ans√§tze in diesem Bereich.`;
            }

            return {
                type1Name: type1?.name || type1Id,
                type2Name: type2?.name || type2Id,
                type1Perspective: type1Def?.keyPrinciples?.[0] || `${type1?.name || type1Id} hat eigene Pr√§ferenzen in diesem Bereich.`,
                type2Perspective: type2Def?.keyPrinciples?.[0] || `${type2?.name || type2Id} hat eigene Pr√§ferenzen in diesem Bereich.`,
                dynamic: dynamicText
            };
        }

        // Category descriptions loaded from data
        let categoryDescriptions = {};

        async function loadData() {
            try {
                const response = await fetch('archetype-matrix.json');
                data = await response.json();
                // Load category descriptions from data
                if (data.categories) {
                    categoryDescriptions = data.categories;
                }
            } catch (error) {
                console.error('Error loading data:', error);
                data = getFallbackData();
            }
            initApp();
        }

        function getFallbackData() {
            return {
                archetypes: {
                    single: { id: "single", name: "Single", color: "#E63946", shortDescription: "Fokus auf Selbstentwicklung", pro: [], contra: [], pathos: "", logos: "" },
                    duo: { id: "duo", name: "Duo", color: "#E84393", shortDescription: "Klassische monogame Zweierbeziehung", pro: [], contra: [], pathos: "", logos: "" },
                    duo_flex: { id: "duo_flex", name: "Duo-Flex", color: "#FF6B6B", shortDescription: "Prim√§r Zweierbeziehung mit situativer √ñffnung", pro: [], contra: [], pathos: "", logos: "" },
                    solopoly: { id: "solopoly", name: "Solopoly", color: "#2A9D8F", shortDescription: "Polyamor mit Autonomie", pro: [], contra: [], pathos: "", logos: "" },
                    polyamor: { id: "polyamor", name: "Polyamor", color: "#F4A261", shortDescription: "Strukturierte Mehrfachbeziehungen", pro: [], contra: [], pathos: "", logos: "" },
                    ra: { id: "ra", name: "RA", color: "#9B5DE5", shortDescription: "RA - Ablehnung von Labels", pro: [], contra: [], pathos: "", logos: "" },
                    lat: { id: "lat", name: "LAT", color: "#06D6A0", shortDescription: "Living Apart Together", pro: [], contra: [], pathos: "", logos: "" },
                    aromantisch: { id: "aromantisch", name: "Aromantisch", color: "#118AB2", shortDescription: "Platonische Verbindungen", pro: [], contra: [], pathos: "", logos: "" }
                },
                categories: {},
                interactions: {},
                aggregatedMatrix: { rows: [], cols: [], values: [] }
            };
        }

        function initApp() {
            const archetypeSelect = document.getElementById('archetypeSelect');
            if (archetypeSelect) {
                archetypeSelect.addEventListener('change', (e) => {
                    currentArchetype = e.target.value;
                    updateAll();
                });
            }

            // Carousel scroll detection
            const carousel = document.getElementById('carousel');
            if (carousel) {
                carousel.addEventListener('scroll', updateNavDots);
            }

            // Initialize dimension info link event listeners
            initDimensionInfoLinks();

            updateAll();
        }

        /**
         * Initialize event listeners for dimension info links
         * Uses CSS classes instead of onclick attributes for cleaner code
         */
        function initDimensionInfoLinks() {
            // Geschlechtsidentit√§t links
            document.querySelectorAll('.geschlecht-info-link').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showGeschlechtInfoModal();
                });
            });

            // Dominanz links
            document.querySelectorAll('.dominanz-info-link').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showDominanzInfoModal();
                });
            });

            // Orientierung links
            document.querySelectorAll('.orientierung-info-link').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showOrientierungInfoModal();
                });
            });

            // GFK links
            document.querySelectorAll('.gfk-info-link').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showDimensionTooltip('gfk');
                });
            });
        }

        function updateAll() {
            updateTheme();
            updateMyType();
            updatePartnerSelector();
            updateTopAndChallenge();
            updatePartnerView();
            updateLegendCategories();
            updateAnalysisOverview();
            updateComparisonView(); // Trigger score calculation and UI update
            // GFK automatisch aus Archetypen-Matching ableiten
            if (typeof updateGfkFromArchetypes === 'function') {
                updateGfkFromArchetypes();
            }
        }

        function updateTheme() {
            document.body.className = `theme-${currentArchetype}`;
        }

        function updateMyType() {
            const arch = data.archetypes[currentArchetype];
            if (!arch) return;

            const myTypeIcon = document.getElementById('myTypeIcon');
            if (myTypeIcon) {
                myTypeIcon.textContent = icons[currentArchetype];
                myTypeIcon.style.background = arch.color;
            }

            const myTypeName = document.getElementById('myTypeName');
            if (myTypeName) {
                myTypeName.textContent = arch.name;
                myTypeName.style.color = arch.color;
            }

            const myTypeDesc = document.getElementById('myTypeDesc');
            if (myTypeDesc) myTypeDesc.textContent = arch.shortDescription || '';

            const myTypeTooltip = document.getElementById('myTypeTooltip');
            if (myTypeTooltip) myTypeTooltip.textContent = getShortDef(currentArchetype);

            const proList = document.getElementById('myTypePro');
            if (proList) proList.innerHTML = (arch.pro || []).slice(0, 4).map(p => `<li>${p}</li>`).join('');

            const contraList = document.getElementById('myTypeContra');
            if (contraList) contraList.innerHTML = (arch.contra || []).slice(0, 4).map(c => `<li>${c}</li>`).join('');

            const myTypePathos = document.getElementById('myTypePathos');
            if (myTypePathos) myTypePathos.textContent = arch.pathos || '';

            const myTypeLogos = document.getElementById('myTypeLogos');
            if (myTypeLogos) myTypeLogos.textContent = arch.logos || '';
        }

        // Fixed archetype order to ensure all types are shown
        const archetypeOrder = ['single', 'duo', 'duo_flex', 'solopoly', 'polyamor', 'ra', 'lat', 'aromantisch'];

        function updatePartnerSelector() {
            const container = document.getElementById('partnerSelector');
            // Show ALL archetypes as partner options (including own type for self-matching)
            const allPartners = archetypeOrder
                .map(id => data.archetypes[id])
                .filter(arch => arch); // Remove any undefined

            if (!allPartners.find(o => o.id === selectedPartner)) {
                selectedPartner = allPartners[0]?.id || 'duo';
            }

            container.innerHTML = allPartners.map(arch => `
                <button class="partner-btn ${arch.id === selectedPartner ? 'active' : ''}"
                        onclick="selectPartner('${arch.id}')"
                        data-id="${arch.id}">
                    <span class="dot" style="background: ${arch.color}"></span>
                    ${arch.name}
                </button>
            `).join('');
        }

        function selectPartner(partnerId) {
            selectedPartner = partnerId;
            document.querySelectorAll('.partner-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.id === partnerId);
            });
            updatePartnerView();
            updateAnalysisOverview();
            updateComparisonView(); // Trigger score calculation and UI update
        }

        function updateTopAndChallenge() {
            // Include all types (including self) for top match and challenge
            const others = archetypeOrder;
            let topMatch = { id: null, score: 0 };
            let challenge = { id: null, score: 100 };

            others.forEach(otherId => {
                const key = `${currentArchetype}_${otherId}`;
                const interaction = data.interactions[key];
                const score = interaction?.overall || 0;

                if (score > topMatch.score) {
                    topMatch = { id: otherId, score };
                }
                if (score < challenge.score) {
                    challenge = { id: otherId, score };
                }
            });

            // Store for modal access
            currentTopMatch = topMatch;
            currentChallenge = challenge;

            const myArch = data.archetypes[currentArchetype];

            if (topMatch.id) {
                const arch = data.archetypes[topMatch.id];
                document.getElementById('topMatchDot').style.background = arch.color;
                document.getElementById('topMatchName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('topMatchScore').textContent = topMatch.score;
            }

            if (challenge.id) {
                const arch = data.archetypes[challenge.id];
                document.getElementById('challengeDot').style.background = arch.color;
                document.getElementById('challengeName').textContent = `${myArch.name} (Ich) mit ${arch.name}`;
                document.getElementById('challengeScore').textContent = challenge.score;
            }
        }

        function updatePartnerView() {
            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};

            // Run Pathos/Logos checks (keine Blockierung mehr - zeigt nur Warnungen)
            runCompatibilityChecks();

            // NEU: GFK-Bed√ºrfnis-Matching mit allen Dimensionen neu berechnen
            updateGfkFromArchetypes();

            document.getElementById('myTypeNameDisplay').textContent = myArch?.name || '...';
            document.getElementById('partnerNameDisplay').textContent = partnerArch?.name || '...';
            document.getElementById('myTypeTooltipPage3').textContent = getShortDef(currentArchetype);
            document.getElementById('partnerTooltipPage3').textContent = getShortDef(selectedPartner);

            const score = interaction.overall || 0;
            const scoreEl = document.getElementById('overallScore');
            scoreEl.textContent = score;
            scoreEl.style.color = getScoreColor(score);

            drawRadarChart(interaction.scores || {}, partnerArch?.color || '#457B9D');
            updateCategoryBars(interaction.scores || {});

            const proList = document.getElementById('partnerPro');
            proList.innerHTML = (interaction.pro || []).map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';

            const contraList = document.getElementById('partnerContra');
            contraList.innerHTML = (interaction.contra || []).map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';
        }

        function drawRadarChart(scores, color) {
            const svg = document.getElementById('radarChart');
            const cx = 140, cy = 120, maxR = 90;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const n = categories.length;

            let html = '';

            for (let r = 18; r <= maxR; r += 18) {
                html += `<circle cx="${cx}" cy="${cy}" r="${r}" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
            }

            categories.forEach((cat, i) => {
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * maxR;
                const y = cy + Math.sin(angle) * maxR;
                const labelX = cx + Math.cos(angle) * (maxR + 18);
                const labelY = cy + Math.sin(angle) * (maxR + 18);

                html += `<line x1="${cx}" y1="${cy}" x2="${x}" y2="${y}" stroke="rgba(255,255,255,0.08)" stroke-width="1"/>`;
                html += `<text x="${labelX}" y="${labelY}" fill="var(--text-muted)" font-size="10" text-anchor="middle" dominant-baseline="middle">${cat}</text>`;
            });

            const points = categories.map((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                return `${cx + Math.cos(angle) * r},${cy + Math.sin(angle) * r}`;
            }).join(' ');

            html += `<polygon points="${points}" fill="${color}33" stroke="${color}" stroke-width="2"/>`;

            categories.forEach((cat, i) => {
                const value = scores[cat]?.value || 0;
                const r = (value / 100) * maxR;
                const angle = (Math.PI * 2 * i / n) - Math.PI / 2;
                const x = cx + Math.cos(angle) * r;
                const y = cy + Math.sin(angle) * r;
                html += `<circle cx="${x}" cy="${y}" r="4" fill="${color}"/>`;
            });

            if (svg) svg.innerHTML = html;

            // Also draw on expandRadarChart (smaller version)
            const expandSvg = document.getElementById('expandRadarChart');
            if (expandSvg) expandSvg.innerHTML = html;
        }

        function updateCategoryBars(scores) {
            const container = document.getElementById('categoryBars');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            container.innerHTML = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                return `
                    <div class="category-row" onclick="openSingleCategoryModal('${cat}')">
                        <span class="category-label">${cat}</span>
                        <div class="category-bar-wrap">
                            <div class="category-bar-container">
                                <div class="category-bar ${barClass}" style="width: ${value}%">
                                    <span class="category-bar-value">${value}%</span>
                                </div>
                            </div>
                            <div class="category-name">${name}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getScoreColor(score) {
            if (score >= 70) return '#457B9D';  // Blau - Gut
            if (score >= 50) return '#f39c12';  // Orange - Mittel
            return '#e74c3c';                   // Rot - Herausfordernd
        }

        // Farbverlauf f√ºr Score Cycle: rot (0%) ‚Üí gelb (50%) ‚Üí gr√ºn (100%)
        function getScoreGradientColor(score) {
            // Clamp score between 0 and 100
            score = Math.max(0, Math.min(100, score));

            let r, g, b;

            if (score <= 50) {
                // Rot (0%) ‚Üí Gelb (50%)
                // Rot: rgb(231, 76, 60) ‚Üí Gelb: rgb(241, 196, 15)
                const t = score / 50;
                r = Math.round(231 + (241 - 231) * t);
                g = Math.round(76 + (196 - 76) * t);
                b = Math.round(60 + (15 - 60) * t);
            } else {
                // Gelb (50%) ‚Üí Gr√ºn (100%)
                // Gelb: rgb(241, 196, 15) ‚Üí Gr√ºn: rgb(46, 204, 113)
                const t = (score - 50) / 50;
                r = Math.round(241 + (46 - 241) * t);
                g = Math.round(196 + (204 - 196) * t);
                b = Math.round(15 + (113 - 15) * t);
            }

            return `rgb(${r}, ${g}, ${b})`;
        }

        // Update Score Cycle im Synthese Modal und auf der Hauptseite
        function updateSyntheseScoreCycle() {
            const scoreValueEl = document.getElementById('syntheseScoreValue');
            const scoreProgressEl = document.getElementById('syntheseScoreProgress');
            const mainScoreValueEl = document.getElementById('mainScoreValue');
            const mainScoreProgressEl = document.getElementById('mainScoreProgress');

            // Get current score from resultPercentage
            const percentage = document.getElementById('resultPercentage');
            const currentScore = percentage ? parseInt(percentage.textContent) || 0 : 0;

            // Update circle progress (circumference = 2 * PI * r = 2 * 3.14159 * 42 ‚âà 264)
            const circumference = 264;
            const offset = circumference - (currentScore / 100) * circumference;

            // Update color based on score (rot ‚Üí gelb ‚Üí gr√ºn)
            const color = getScoreGradientColor(currentScore);

            // Update Modal Score Circle
            if (scoreValueEl && scoreProgressEl) {
                scoreValueEl.textContent = currentScore;
                scoreProgressEl.style.strokeDashoffset = offset;
                scoreProgressEl.style.stroke = color;
                scoreValueEl.style.color = color;
            }

            // Update Main Page Score Circle
            if (mainScoreValueEl && mainScoreProgressEl) {
                mainScoreValueEl.textContent = currentScore;
                mainScoreProgressEl.style.strokeDashoffset = offset;
                mainScoreProgressEl.style.stroke = color;
                mainScoreValueEl.style.color = color;
            }

            // Update Mobile Score Circle
            const mobileScoreEl = document.getElementById('mobileScoreCircle');
            const mobileScoreProgressEl = document.getElementById('mobileScoreProgress');

            if (mobileScoreEl) {
                mobileScoreEl.textContent = currentScore;
                mobileScoreEl.style.color = color;
            }

            if (mobileScoreProgressEl) {
                mobileScoreProgressEl.style.strokeDashoffset = offset;
                mobileScoreProgressEl.style.stroke = color;
            }

            // Update Score Summary Line in Synthese Modal
            const scoreSummaryValueEl = document.getElementById('syntheseScoreSummaryValue');
            const needsSummaryValueEl = document.getElementById('syntheseNeedsSummaryValue');

            if (scoreSummaryValueEl) {
                scoreSummaryValueEl.textContent = currentScore;
                scoreSummaryValueEl.style.color = color;
            }

            if (needsSummaryValueEl) {
                // Get Bed√ºrfnis-√úbereinstimmung from lastGfkMatchingResult
                const needsScore = lastGfkMatchingResult ? lastGfkMatchingResult.score : 0;
                needsSummaryValueEl.textContent = needsScore + '%';
                // Color based on needs score
                const needsColor = getScoreGradientColor(needsScore);
                needsSummaryValueEl.style.color = needsColor;
            }
        }

        function getBarClass(value) {
            if (value >= 70) return 'bar-good';
            if (value >= 50) return 'bar-medium';
            return 'bar-low';
        }

        function toggleCollapsible(id) {
            document.getElementById(id).classList.toggle('open');
        }

        // Toggle dimension collapse for Dominanz/Orientierung sections
        function toggleDimensionCollapse(element) {
            element.classList.toggle('collapsed');
        }

        // Track global fold/unfold state
        let allDimensionsCollapsed = false;

        // Toggle all dimensions AND desktop factors collapse/expand at once
        function toggleAllDimensionsCollapse() {
            const allDimensions = document.querySelectorAll('.collapsible-dimension');
            const allFactors = document.querySelectorAll('.desktop-factor-item');
            
            // Get both desktop and mobile buttons
            const desktopBtn = document.getElementById('foldUnfoldAllBtn');
            const mobileBtn = document.getElementById('mobileFoldUnfoldBtn');

            allDimensionsCollapsed = !allDimensionsCollapsed;

            // Toggle collapsible dimensions
            allDimensions.forEach(dim => {
                if (allDimensionsCollapsed) {
                    dim.classList.add('collapsed');
                } else {
                    dim.classList.remove('collapsed');
                }
            });

            // Toggle desktop factor items
            allFactors.forEach(factor => {
                if (allDimensionsCollapsed) {
                    factor.classList.add('collapsed');
                } else {
                    factor.classList.remove('collapsed');
                }
            });

            // Update both buttons' appearance
            const buttons = [desktopBtn, mobileBtn].filter(btn => btn !== null);
            buttons.forEach(btn => {
                const icon = btn.querySelector('.fold-unfold-icon');
                const text = btn.querySelector('.fold-unfold-text');

                if (allDimensionsCollapsed) {
                    icon.textContent = '‚ñ∂';
                    text.textContent = 'Unfold';
                    btn.classList.add('collapsed-state');
                } else {
                    icon.textContent = '‚ñº';
                    text.textContent = 'Fold';
                    btn.classList.remove('collapsed-state');
                }
            });

            // Update desktop factor content when expanding
            if (!allDimensionsCollapsed) {
                updateDesktopFactorContent();
            }
        }

        // Toggle single desktop factor expand/collapse
        function toggleDesktopFactor(element) {
            const wasCollapsed = element.classList.contains('collapsed');
            element.classList.toggle('collapsed');
            // Update the fold/unfold button state based on current state
            updateDesktopFactorFoldButton();
            // Update content when expanding
            if (wasCollapsed) {
                updateDesktopFactorContent();
            }
        }

        // Update fold button based on current state of all collapsible elements
        function updateDesktopFactorFoldButton() {
            const allDimensions = document.querySelectorAll('.collapsible-dimension');
            const allFactors = document.querySelectorAll('.desktop-factor-item');
            const desktopBtn = document.getElementById('foldUnfoldAllBtn');
            const mobileBtn = document.getElementById('mobileFoldUnfoldBtn');

            // Check if all are collapsed (both dimensions and factors)
            const allDimensionsCollapsedCheck = Array.from(allDimensions).every(d => d.classList.contains('collapsed'));
            const allFactorsCollapsed = Array.from(allFactors).every(f => f.classList.contains('collapsed'));
            const allCollapsed = allDimensionsCollapsedCheck && allFactorsCollapsed;

            allDimensionsCollapsed = allCollapsed;

            // Update both buttons
            const buttons = [desktopBtn, mobileBtn].filter(btn => btn !== null);
            buttons.forEach(btn => {
                const icon = btn.querySelector('.fold-unfold-icon');
                const text = btn.querySelector('.fold-unfold-text');

                if (allCollapsed) {
                    icon.textContent = '‚ñ∂';
                    text.textContent = 'Unfold';
                    btn.classList.add('collapsed-state');
                } else {
                    icon.textContent = '‚ñº';
                    text.textContent = 'Fold';
                    btn.classList.remove('collapsed-state');
                }
            });
        }

        // Update all desktop factor expandable content
        function updateDesktopFactorContent() {
            // Check if factorExplanations is defined (it's defined later in the file)
            if (typeof factorExplanations === 'undefined') return;

            const ich = mobileIchArchetype;
            const partner = mobilePartnerArchetype;
            const dimensions = personDimensions;

            const factorTypes = ['archetyp', 'dominanz', 'orientierung', 'geschlecht'];

            factorTypes.forEach(factorType => {
                const factor = factorExplanations[factorType];
                if (!factor) return;

                // Get score
                const prefix = 'desktopFactor';
                let score = 0;
                const scoreEl = document.getElementById(prefix + factorType.charAt(0).toUpperCase() + factorType.slice(1));
                if (scoreEl) {
                    score = parseInt(scoreEl.textContent) || 0;
                }

                // Update explanation
                const explanationId = prefix + factorType.charAt(0).toUpperCase() + factorType.slice(1) + 'Explanation';
                const explanationEl = document.getElementById(explanationId);
                if (explanationEl) {
                    explanationEl.textContent = factor.getExplanation(ich, partner, score, dimensions);
                }

                // Update meaning list
                const meaningId = prefix + factorType.charAt(0).toUpperCase() + factorType.slice(1) + 'Meaning';
                const meaningList = document.getElementById(meaningId);
                if (meaningList) {
                    meaningList.innerHTML = '';
                    factor.getMeaning(score, ich, partner).forEach(item => {
                        const li = document.createElement('li');
                        if (typeof item === 'object' && item.title) {
                            li.innerHTML = `<strong>${item.title}</strong>${item.desc ? ` ‚Äì ${item.desc}` : ''}`;
                        } else {
                            li.textContent = item;
                        }
                        meaningList.appendChild(li);
                    });
                }
            });
        }

        function scrollToCard(index) {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            carousel.scrollTo({ left: cardWidth * index, behavior: 'smooth' });
        }

        const TOTAL_PAGES = 4;

        function updateNavDots() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);

            document.querySelectorAll('.nav-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentCard);
            });

            // Update arrow states
            const arrows = document.querySelectorAll('.nav-arrow');
            if (arrows.length >= 2) {
                arrows[0].disabled = currentCard === 0;
                arrows[1].disabled = currentCard === TOTAL_PAGES - 1;
            }

            // Load feedback when on page 4
            if (currentCard === 3) {
                loadFeedback();
            }
        }

        function navigatePrev() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard > 0) {
                scrollToCard(currentCard - 1);
            }
        }

        function navigateNext() {
            const carousel = document.getElementById('carousel');
            const cardWidth = window.innerWidth;
            const currentCard = Math.round(carousel.scrollLeft / cardWidth);
            if (currentCard < TOTAL_PAGES - 1) {
                scrollToCard(currentCard + 1);
            }
        }

        // Legend Categories
        function updateLegendCategories() {
            const container = document.getElementById('legendCategories');
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];

            // Get current interaction scores
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const myName = myArch?.name || currentArchetype;
            const partnerName = partnerArch?.name || selectedPartner;

            // Show which combination is displayed
            const headerText = currentArchetype === selectedPartner
                ? `${myName} (Ich) mit ${myName}`
                : `${myName} (Ich) mit ${partnerName}`;

            container.innerHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: var(--bg-dark); border-radius: 10px; text-align: center;">
                    <span style="color: var(--text-muted); font-size: var(--font-sm);">Aktuelle Auswahl:</span>
                    <div style="color: var(--primary); font-weight: 600; font-size: var(--font-base);">${headerText}</div>
                </div>
            ` + categories.map(cat => {
                const catData = categoryDescriptions[cat] || {};
                const name = catData.name || categoryNames[cat] || cat;
                const desc = catData.description || 'Beschreibung nicht verf√ºgbar';
                const value = scores[cat]?.value || 0;
                const scoreColor = getScoreColor(value);

                return `
                    <div class="legend-category-item" onclick="openSingleCategoryModal('${cat}')">
                        <div class="legend-category-letter">${cat}</div>
                        <div class="legend-category-content">
                            <div class="legend-category-name">${name}</div>
                            <div class="legend-category-desc">${desc}</div>
                        </div>
                        <div style="font-weight: 700; font-size: var(--font-md); color: ${scoreColor}; min-width: 50px; text-align: right;">${value}</div>
                    </div>
                `;
            }).join('');
        }

        // Modal Functions
        function openCategoryModal() {
            // Reset modal context when opening directly (uses page 2 selection)
            modalContextPartner = null;
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            document.getElementById('modalTitle').textContent = 'Alle Kategorien';
            document.getElementById('modalBody').innerHTML = categories.map(cat => getCategoryModalContent(cat)).join('');
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        let currentModalCategory = 'A'; // Track current category for navigation

        function openSingleCategoryModal(category) {
            currentModalCategory = category;
            // Don't reset modalContextPartner here - it may be set from match modal
            const catData = categoryDescriptions[category] || {};
            const name = catData.name || categoryNames[category] || category;
            document.getElementById('modalTitle').textContent = `Kategorie ${category}`;
            document.getElementById('modalBody').innerHTML = getCategoryModalContent(category);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function navigateCategoryPrev() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const prevIndex = currentIndex > 0 ? currentIndex - 1 : categories.length - 1;
            openSingleCategoryModal(categories[prevIndex]);
        }

        function navigateCategoryNext() {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const currentIndex = categories.indexOf(currentModalCategory);
            const nextIndex = currentIndex < categories.length - 1 ? currentIndex + 1 : 0;
            openSingleCategoryModal(categories[nextIndex]);
        }

        function getCategoryModalContent(cat) {
            const catData = categoryDescriptions[cat] || {};
            const name = catData.name || categoryNames[cat] || cat;
            const desc = catData.description || 'Beschreibung nicht verf√ºgbar';
            const subDims = catData.subDimensions || [];

            // Use modalContextPartner if set (from match modal), otherwise use selectedPartner (from page 2)
            const partnerId = modalContextPartner || selectedPartner;
            const interactionKey = `${currentArchetype}_${partnerId}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};
            const value = scores[cat]?.value || 0;
            const scoreColor = getScoreColor(value);
            const barClass = getBarClass(value);

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[partnerId];
            const comboText = `${myArch?.name || '?'} + ${partnerArch?.name || '?'}`;
            const contextText = `${comboText} | ${name}`;

            // Get category position for navigation
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const catIndex = categories.indexOf(cat);
            const prevCat = categories[catIndex > 0 ? catIndex - 1 : categories.length - 1];
            const nextCat = categories[catIndex < categories.length - 1 ? catIndex + 1 : 0];
            const prevName = categoryNames[prevCat] || prevCat;
            const nextName = categoryNames[nextCat] || nextCat;

            return `
                <div class="category-nav-row">
                    <button class="category-nav-btn" onclick="navigateCategoryPrev()">
                        ‚Äπ ${prevCat}
                    </button>
                    <span class="category-nav-indicator">${catIndex + 1} / 6</span>
                    <button class="category-nav-btn" onclick="navigateCategoryNext()">
                        ${nextCat} ‚Ä∫
                    </button>
                </div>

                <div class="modal-category">
                    <div class="modal-category-header">
                        <div class="modal-category-letter">${cat}</div>
                        <div class="modal-category-name">${name}</div>
                    </div>
                    <div class="match-modal-score" style="margin: 12px 0;">
                        <span class="match-modal-score-label">${comboText}</span>
                        <span class="match-modal-score-value" style="color: ${scoreColor}">${value}</span>
                    </div>
                    <div class="modal-category-desc">${desc}</div>
                    ${subDims.length > 0 ? `
                        <div class="modal-subdimensions">
                            ${subDims.map(sd => renderTagWithTooltip(sd, cat, currentArchetype, partnerId)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Render a tag with tooltip
        function renderTagWithTooltip(tagName, category, type1Id, type2Id) {
            const tooltip = getTagTooltip(type1Id, type2Id, category, tagName);
            const type1 = data.archetypes[type1Id];
            const type2 = data.archetypes[type2Id];
            const color1 = type1?.color || 'var(--primary)';
            const color2 = type2?.color || 'var(--primary)';

            // Build type switcher options
            const allTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type1Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'ich', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            const partnerTypes = archetypeOrder.map(id => {
                const arch = data.archetypes[id];
                return `
                    <button class="type-switch-btn ${id === type2Id ? 'active' : ''}"
                            style="color: ${arch?.color || 'var(--text-secondary)'}"
                            onclick="event.stopPropagation(); switchTooltipType('${id}', 'partner', '${category}')">
                        <span class="dot" style="background: ${arch?.color}"></span>
                        ${arch?.name || id}
                    </button>
                `;
            }).join('');

            return `
                <span class="tag-tooltip-container">
                    <span class="modal-subdim-tag" onclick="openTagTooltip(this.parentElement, '${category}')">${tagName}</span>
                    <div class="tag-tooltip">
                        <button class="tag-tooltip-close" onclick="closeTagTooltip()">&times;</button>
                        <div class="tag-tooltip-header">${tagName}</div>

                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Ich:</span>
                            ${allTypes}
                        </div>
                        <div class="tag-tooltip-type-switcher">
                            <span class="type-switch-label">Partner:</span>
                            ${partnerTypes}
                        </div>

                        <div class="tag-tooltip-body">
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color1}">${tooltip.type1Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type1Perspective}</span>
                            </div>
                            <div class="tag-tooltip-perspective">
                                <span class="tag-tooltip-type-name" style="color: ${color2}">${tooltip.type2Name}:</span>
                                <span class="tag-tooltip-type-text">${tooltip.type2Perspective}</span>
                            </div>
                            <div class="tag-tooltip-dynamic">${tooltip.dynamic}</div>
                        </div>
                    </div>
                </span>
            `;
        }

        // Switch type from tooltip and refresh modal
        function switchTooltipType(typeId, role, category) {
            if (role === 'ich') {
                currentArchetype = typeId;
                // Update main UI
                document.getElementById('archetypeSelect').value = typeId;
                updateTheme();
                updateMyType();
                updatePartnerSelector();
                updateTopAndChallenge();
                updatePartnerView();
            } else {
                selectedPartner = typeId;
                modalContextPartner = typeId;
                // Update partner selection buttons
                document.querySelectorAll('.partner-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.id === typeId);
                });
                updatePartnerView();
            }

            // Update score display
            updateComparisonView();

            // Refresh the category modal with new types
            openSingleCategoryModal(category);
        }

        // Active tooltip tracking
        let activeTooltipElement = null;
        let activeTagElement = null;

        // Toggle tag tooltip on click
        function openTagTooltip(container, category) {
            const tooltip = container.querySelector('.tag-tooltip');
            const tag = container.querySelector('.modal-subdim-tag');
            if (!tooltip || !tag) return;

            // If this tooltip is already open, close it
            if (activeTooltipElement === tooltip) {
                closeTagTooltip();
                return;
            }

            // Close any other open tooltip first
            closeTagTooltip();

            // Activate this tooltip and tag
            activeTooltipElement = tooltip;
            activeTagElement = tag;
            tooltip.classList.add('active');
            tag.classList.add('active');

            // Position at top of viewport so it doesn't get cut off
            const tooltipWidth = Math.min(360, window.innerWidth * 0.92);
            const left = (window.innerWidth - tooltipWidth) / 2;
            const top = 60; // Fixed position near top

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.style.width = tooltipWidth + 'px';
        }

        // Close tag tooltip
        function closeTagTooltip() {
            if (activeTooltipElement) {
                activeTooltipElement.classList.remove('active');
                activeTooltipElement = null;
            }
            if (activeTagElement) {
                activeTagElement.classList.remove('active');
                activeTagElement = null;
            }
            // Also close any other open tooltips and tags
            document.querySelectorAll('.tag-tooltip.active').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.modal-subdim-tag.active').forEach(t => t.classList.remove('active'));
        }

        function closeCategoryModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('categoryModal').classList.remove('active');
            document.body.style.overflow = '';
            // Reset modal context when closing
            modalContextPartner = null;
        }

        // Definition Modal Functions
        function openDefinitionModal(archetypeId) {
            const def = archetypeDefinitions[archetypeId];
            if (!def) return;

            const arch = data.archetypes[archetypeId];
            const color = arch?.color || 'var(--primary)';
            const icon = icons[archetypeId] || '?';

            document.getElementById('definitionModalTitle').innerHTML = `
                <span style="color: ${color}">${icon}</span> ${def.name}
            `;

            document.getElementById('definitionModalBody').innerHTML = `
                <div class="definition-long">${def.longDef}</div>

                <div class="definition-section">
                    <div class="definition-section-title">Kernprinzipien</div>
                    <ul class="definition-list principles">
                        ${def.keyPrinciples.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Das ist NICHT dasselbe wie</div>
                    <ul class="definition-list not-same">
                        ${def.notTheSameAs.map(n => `<li>${n}</li>`).join('')}
                    </ul>
                </div>

                <div class="definition-section">
                    <div class="definition-section-title">Varianten</div>
                    <ul class="definition-list variants">
                        ${def.variants.map(v => `<li>${v}</li>`).join('')}
                    </ul>
                </div>
            `;

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDefinitionModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('definitionModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ========================================
        // Definition Modal Swipe Navigation
        // ========================================
        let currentDefinitionIndex = 0;
        let currentDefinitionPerson = 'ich'; // Track whether showing 'ich' or 'partner'
        let definitionTouchStartX = 0;

        function handleDefinitionTouchStart(e) {
            definitionTouchStartX = e.touches[0].clientX;
        }

        function handleDefinitionTouchEnd(e) {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = definitionTouchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                navigateDefinition(diff > 0 ? 1 : -1);
            }
        }

        function navigateDefinition(direction) {
            currentDefinitionIndex += direction;
            if (currentDefinitionIndex < 0) currentDefinitionIndex = archetypeOrder.length - 1;
            if (currentDefinitionIndex >= archetypeOrder.length) currentDefinitionIndex = 0;

            const newArchetype = archetypeOrder[currentDefinitionIndex];
            showArchetypeInfoByType(newArchetype);

            // Sync the new archetype to the dropdown selection
            if (currentDefinitionPerson === 'ich') {
                document.getElementById('ichSelect').value = newArchetype;
                document.getElementById('mobileIchSelect').value = newArchetype;
                currentArchetype = newArchetype;
                mobileIchArchetype = newArchetype;
            } else if (currentDefinitionPerson === 'partner') {
                document.getElementById('partnerSelect').value = newArchetype;
                document.getElementById('mobilePartnerSelect').value = newArchetype;
                selectedPartner = newArchetype;
                mobilePartnerArchetype = newArchetype;
            }
            updateComparisonView();
            // GFK automatisch aus Archetypen-Matching ableiten
            updateGfkFromArchetypes();
        }

        // Alias for button onclick
        function navigateDefinitionModal(direction) {
            navigateDefinition(direction);
        }

        function showArchetypeInfoByType(archetypeId) {
            if (!data || !data.archetypes || !data.archetypes[archetypeId]) {
                console.error('Data not available for archetype:', archetypeId);
                return;
            }

            const arch = data.archetypes[archetypeId];
            const def = archetypeDefinitions[archetypeId];

            // Get localized archetype data from i18n (with fallback to hardcoded def)
            const localizedArch = {
                name: TiageI18n.t(`archetypes.${archetypeId}.name`, arch.name),
                shortDef: TiageI18n.t(`archetypes.${archetypeId}.shortDef`, def?.shortDef || ''),
                longDef: TiageI18n.t(`archetypes.${archetypeId}.longDef`, def?.longDef || ''),
                keyPrinciples: TiageI18n.t(`archetypes.${archetypeId}.keyPrinciples`, def?.keyPrinciples || []),
                notTheSameAs: TiageI18n.t(`archetypes.${archetypeId}.notTheSameAs`, def?.notTheSameAs || []),
                variants: TiageI18n.t(`archetypes.${archetypeId}.variants`, def?.variants || [])
            };

            // Top navigation dots and swipe hint
            const swipeHint = TiageI18n.t('archetypeModal.swipeHint', '‚Üê Wischen zum Navigieren ‚Üí');
            let topNav = `
                <div class="definition-nav-dots" style="display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                    ${archetypeOrder.map((id, index) => `
                        <span class="definition-dot${index === currentDefinitionIndex ? ' active' : ''}"
                              onclick="navigateDefinitionToIndex(${index})"
                              style="width: 10px; height: 10px; border-radius: 50%; background: ${index === currentDefinitionIndex ? 'var(--primary)' : 'var(--border)'}; cursor: pointer; transition: all 0.2s;"></span>
                    `).join('')}
                </div>
                <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-bottom: 15px;">${swipeHint}</div>
            `;

            let modalContent = topNav + `
                <div class="modal-category">
                    <div class="modal-category-header">
                        <div class="modal-category-letter" style="background: ${arch.color}; width: 40px; height: 40px; font-size: 20px;">${icons[archetypeId]}</div>
                        <div class="modal-category-name">${localizedArch.name}</div>
                    </div>
                    <div class="modal-category-desc">${localizedArch.shortDef || ''}</div>
            `;

            if (def || localizedArch.longDef) {
                modalContent += `
                    <div class="definition-long" style="margin-top: 15px;">${localizedArch.longDef || ''}</div>
                `;

                const keyPrinciples = localizedArch.keyPrinciples;
                if (keyPrinciples && keyPrinciples.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">${TiageI18n.t('archetypeModal.keyPrinciples', 'Kernprinzipien')}</div>
                            <ul class="definition-list principles">
                                ${keyPrinciples.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }

                const notTheSameAs = localizedArch.notTheSameAs;
                if (notTheSameAs && notTheSameAs.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">${TiageI18n.t('archetypeModal.notTheSameAs', 'Das ist NICHT')}</div>
                            <ul class="definition-list not-same">
                                ${notTheSameAs.map(n => `<li>${n}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }

                const variants = localizedArch.variants;
                if (variants && variants.length > 0) {
                    modalContent += `
                        <div class="definition-section">
                            <div class="definition-section-title">${TiageI18n.t('archetypeModal.variants', 'Varianten')}</div>
                            <ul class="definition-list variants">
                                ${variants.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            // Add Pathos & Logos section
            const pathos = arch.pathos || '';
            const logos = arch.logos || '';

            if (pathos || logos) {
                modalContent += `
                    <div class="definition-section" style="margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px;">
                        <div class="definition-section-title" style="margin-bottom: 15px;">${TiageI18n.t('archetypeModal.pathosLogos', 'Pathos & Logos')}</div>
                `;

                if (pathos) {
                    modalContent += `
                        <div style="margin-bottom: 15px; padding: 12px; background: rgba(231,76,60,0.1); border-radius: 10px; border-left: 3px solid #e74c3c;">
                            <div style="color: #e74c3c; font-weight: 600; font-size: 13px; margin-bottom: 6px;">${TiageI18n.t('archetypeModal.pathosLabel', 'Pathos (Emotionale Ebene)')}</div>
                            <p style="color: var(--text-secondary); font-style: italic; line-height: 1.5; font-size: 12px; margin: 0;">${pathos}</p>
                        </div>
                    `;
                }

                if (logos) {
                    modalContent += `
                        <div style="padding: 12px; background: rgba(52,152,219,0.1); border-radius: 10px; border-left: 3px solid #3498db;">
                            <div style="color: #3498db; font-weight: 600; font-size: 13px; margin-bottom: 6px;">${TiageI18n.t('archetypeModal.logosLabel', 'Logos (Rationale Ebene)')}</div>
                            <p style="color: var(--text-secondary); font-style: italic; line-height: 1.5; font-size: 12px; margin: 0;">${logos}</p>
                        </div>
                    `;
                }

                modalContent += `</div>`;
            }

            modalContent += '</div>';

            // Add navigation dots and confirm button
            modalContent += `
                <div class="definition-nav-dots" style="display: flex; justify-content: center; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border);">
                    ${archetypeOrder.map((id, index) => `
                        <span class="definition-dot${index === currentDefinitionIndex ? ' active' : ''}"
                              onclick="navigateDefinitionToIndex(${index})"
                              style="width: 10px; height: 10px; border-radius: 50%; background: ${index === currentDefinitionIndex ? 'var(--primary)' : 'var(--border)'}; cursor: pointer; transition: all 0.2s;"></span>
                    `).join('')}
                </div>
                <div style="text-align: center; font-size: 11px; color: var(--text-muted); margin-top: 8px;">${swipeHint}</div>
                <button onclick="confirmDefinitionSelection()" style="
                    display: block;
                    width: 100%;
                    margin-top: 15px;
                    padding: 12px 20px;
                    background: var(--primary);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                    ${TiageI18n.t('archetypeModal.confirmSelection', 'Auswahl √ºbernehmen')}
                </button>
            `;

            const definitionLabel = TiageI18n.t('archetypeModal.definition', 'Definition');
            document.getElementById('definitionModalTitle').textContent = `${localizedArch.name} - ${definitionLabel}`;
            document.getElementById('definitionModalBody').innerHTML = modalContent;
        }

        function navigateDefinitionToIndex(index) {
            currentDefinitionIndex = index;
            const newArchetype = archetypeOrder[index];
            showArchetypeInfoByType(newArchetype);

            // Sync the new archetype to the dropdown selection
            if (currentDefinitionPerson === 'ich') {
                document.getElementById('ichSelect').value = newArchetype;
                document.getElementById('mobileIchSelect').value = newArchetype;
                currentArchetype = newArchetype;
                mobileIchArchetype = newArchetype;
            } else if (currentDefinitionPerson === 'partner') {
                document.getElementById('partnerSelect').value = newArchetype;
                document.getElementById('mobilePartnerSelect').value = newArchetype;
                selectedPartner = newArchetype;
                mobilePartnerArchetype = newArchetype;
            }
            updateComparisonView();
            // GFK automatisch aus Archetypen-Matching ableiten
            updateGfkFromArchetypes();
        }

        function confirmDefinitionSelection() {
            console.log('confirmDefinitionSelection called');
            console.log('currentDefinitionIndex:', currentDefinitionIndex);
            console.log('archetypeOrder:', archetypeOrder);

            const selectedArchetype = archetypeOrder[currentDefinitionIndex];
            console.log('selectedArchetype:', selectedArchetype);
            console.log('currentDefinitionPerson:', currentDefinitionPerson);

            if (currentDefinitionPerson === 'ich') {
                // Update main dropdown
                currentArchetype = selectedArchetype;
                const selectElement = document.getElementById('archetypeSelect');
                if (selectElement) {
                    selectElement.value = selectedArchetype;
                    // Dispatch change event to ensure listeners are notified
                    selectElement.dispatchEvent(new Event('change', { bubbles: true }));
                }
                console.log('Updated currentArchetype to:', currentArchetype);
                updateAll();
            } else {
                // Update partner selection
                console.log('Calling selectPartner with:', selectedArchetype);
                selectPartner(selectedArchetype);
            }

            // Close modal
            document.getElementById('definitionModal').classList.remove('active');
            document.body.style.overflow = '';
            console.log('Modal closed, selection complete');
        }

        // Get short definition for tooltip
        function getShortDef(archetypeId) {
            return archetypeDefinitions[archetypeId]?.shortDef || '';
        }

        // Store current match data for modal access
        let currentTopMatch = { id: null, score: 0 };
        let currentChallenge = { id: null, score: 0 };
        let modalContextPartner = null; // Track which partner to use in category modal
        let currentMatchModalView = localStorage.getItem('matchModalView') || 'pathos'; // pathos or logos
        let currentMatchModalData = null; // Store current modal data for toggle refresh

        // Match Modal Toggle Function
        function toggleMatchModalView(view) {
            currentMatchModalView = view;
            localStorage.setItem('matchModalView', view);

            // Update toggle button styles
            document.getElementById('matchTogglePathos').classList.toggle('active', view === 'pathos');
            document.getElementById('matchToggleLogos').classList.toggle('active', view === 'logos');

            // Refresh modal content if data is available
            if (currentMatchModalData) {
                const content = getMatchModalContent(
                    currentMatchModalData.partnerArch,
                    currentMatchModalData.interaction,
                    currentMatchModalData.scores,
                    currentMatchModalData.scoreColor,
                    currentMatchModalData.myArch
                );
                document.getElementById('modalBody').innerHTML = content;
            }
        }

        // Generate dynamic Pro items based on current view (Pathos/Logos)
        function generateDynamicPro(myArch, partnerArch, view) {
            const items = [];
            const ichId = myArch.id;
            const partnerId = partnerArch.id;

            if (view === 'pathos') {
                // Emotional/Pathos perspective - use PathosTextGenerator if available
                if (typeof PathosTextGenerator !== 'undefined') {
                    const resonance = PathosTextGenerator.calculateResonance?.(myArch, partnerArch) || {};
                    if (resonance.emotional > 0.6) items.push('Starke emotionale Resonanz zwischen euren Energien');
                    if (resonance.intuitive > 0.5) items.push('Intuitives Verst√§ndnis f√ºreinander');
                }
                // Fallback emotional pros
                if (ichId === partnerId) {
                    items.push('Tiefes Gef√ºhl des Verstandenwerdens');
                    items.push('Geteilte emotionale Sprache');
                }
                if (items.length === 0) {
                    items.push('Potenzial f√ºr emotionale Verbindung');
                    items.push('Raum f√ºr gegenseitiges Wachstum');
                }
            } else {
                // Rational/Logos perspective - use LogosTextGenerator if available
                if (typeof LogosTextGenerator !== 'undefined') {
                    const analysis = LogosTextGenerator.analyzeCompatibility?.(myArch, partnerArch) || {};
                    if (analysis.structuralMatch > 0.6) items.push('Kompatible Beziehungsstrukturen');
                    if (analysis.valueAlignment > 0.5) items.push('√úbereinstimmende Grundwerte');
                }
                // Fallback structural pros
                if (ichId === partnerId) {
                    items.push('Identische Beziehungsphilosophie');
                    items.push('Gleiche Erwartungen an Verbindlichkeit');
                }
                if (items.length === 0) {
                    items.push('Klare Kommunikationsbasis m√∂glich');
                    items.push('Strukturelle Anpassung machbar');
                }
            }
            return items;
        }

        // Generate dynamic Contra items based on current view (Pathos/Logos)
        function generateDynamicContra(myArch, partnerArch, view) {
            const items = [];
            const ichId = myArch.id;
            const partnerId = partnerArch.id;

            // Use IntegratedSynthesisTextGenerator for conflicts if available
            if (typeof IntegratedSynthesisTextGenerator !== 'undefined') {
                const conflicts = IntegratedSynthesisTextGenerator.identifyPartnerConflicts(
                    ichId, partnerId, null, null
                );

                if (view === 'pathos') {
                    // Emotional perspective on conflicts
                    conflicts.forEach(conflict => {
                        if (conflict.dynamics?.core_wound) {
                            items.push(conflict.dynamics.core_wound);
                        }
                    });
                    // Inner conflicts
                    const innerData = IntegratedSynthesisTextGenerator.data?.innerConflicts;
                    if (innerData?.[ichId]?.shadow) {
                        items.push(`Dein Schatten: ${innerData[ichId].shadow.substring(0, 80)}...`);
                    }
                } else {
                    // Rational perspective on conflicts
                    conflicts.forEach(conflict => {
                        items.push(`${conflict.title}: ${conflict.dynamics?.pattern || ''}`);
                    });
                }
            }

            // Fallback contras
            if (items.length === 0) {
                if (view === 'pathos') {
                    items.push('Emotionale Frequenzen k√∂nnen divergieren');
                    items.push('Risiko von Missverst√§ndnissen auf Gef√ºhlsebene');
                } else {
                    items.push('Unterschiedliche Erwartungen m√∂glich');
                    items.push('Kommunikationsarbeit erforderlich');
                }
            }

            return items;
        }

        // Generate synthesis section with psychological depth
        function generateSynthesisSection(myArch, partnerArch) {
            if (typeof IntegratedSynthesisTextGenerator === 'undefined') {
                return '';
            }

            const ichId = myArch.id;
            const partnerId = partnerArch.id;

            // Get inner conflicts
            const innerData = IntegratedSynthesisTextGenerator.data?.innerConflicts || {};
            const ichConflict = innerData[ichId];
            const partnerConflict = innerData[partnerId];

            let conflictHtml = '';

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // DEIN INNERER KONFLIKT - Mit voller Tiefe
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (ichConflict) {
                conflictHtml += `
                    <div class="match-modal-inner-conflict">
                        <div class="match-modal-inner-conflict-title">üîÆ Dein innerer Konflikt: ${ichConflict.core}</div>
                        <div class="match-modal-inner-conflict-text">${ichConflict.description}</div>
                        ${ichConflict.psychological ? `
                            <div style="margin-top: 10px; padding: 8px; background: rgba(255, 193, 7, 0.05); border-radius: 6px;">
                                <div style="font-size: 11px; color: #f39c12; font-weight: 600; margin-bottom: 4px;">üß† Psychologisch</div>
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5;">${ichConflict.psychological}</div>
                            </div>
                        ` : ''}
                        ${ichConflict.shadow ? `
                            <div style="margin-top: 8px; padding: 8px; background: rgba(128, 0, 128, 0.08); border-radius: 6px;">
                                <div style="font-size: 11px; color: #9b59b6; font-weight: 600; margin-bottom: 4px;">üåë Schattenseite</div>
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5;">${ichConflict.shadow}</div>
                            </div>
                        ` : ''}
                        ${ichConflict.growth ? `
                            <div style="margin-top: 8px; padding: 8px; background: rgba(39, 174, 96, 0.08); border-radius: 6px;">
                                <div style="font-size: 11px; color: #27ae60; font-weight: 600; margin-bottom: 4px;">üå± Wachstumspotenzial</div>
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5;">${ichConflict.growth}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // PARTNER-KONFLIKT - Mit voller Tiefe
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (partnerConflict && ichId !== partnerId) {
                conflictHtml += `
                    <div class="match-modal-inner-conflict" style="margin-top: 12px;">
                        <div class="match-modal-inner-conflict-title">üîÆ Partner-Konflikt: ${partnerConflict.core}</div>
                        <div class="match-modal-inner-conflict-text">${partnerConflict.description}</div>
                        ${partnerConflict.psychological ? `
                            <div style="margin-top: 10px; padding: 8px; background: rgba(255, 193, 7, 0.05); border-radius: 6px;">
                                <div style="font-size: 11px; color: #f39c12; font-weight: 600; margin-bottom: 4px;">üß† Psychologisch</div>
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5;">${partnerConflict.psychological}</div>
                            </div>
                        ` : ''}
                        ${partnerConflict.shadow ? `
                            <div style="margin-top: 8px; padding: 8px; background: rgba(128, 0, 128, 0.08); border-radius: 6px;">
                                <div style="font-size: 11px; color: #9b59b6; font-weight: 600; margin-bottom: 4px;">üåë Schattenseite</div>
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5;">${partnerConflict.shadow}</div>
                            </div>
                        ` : ''}
                        ${partnerConflict.growth ? `
                            <div style="margin-top: 8px; padding: 8px; background: rgba(39, 174, 96, 0.08); border-radius: 6px;">
                                <div style="font-size: 11px; color: #27ae60; font-weight: 600; margin-bottom: 4px;">üå± Wachstumspotenzial</div>
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5;">${partnerConflict.growth}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // Get partner conflicts (interpersonelle Spannungen)
            const partnerConflicts = IntegratedSynthesisTextGenerator.identifyPartnerConflicts(
                ichId, partnerId, null, null
            );

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // HAUPTSPANNUNGSFELD - Mit voller Tiefe
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            let partnerConflictHtml = '';
            if (partnerConflicts.length > 0) {
                const mainConflict = partnerConflicts[0];
                partnerConflictHtml = `
                    <div style="margin-top: 16px; padding: 12px; background: rgba(231, 76, 60, 0.08); border-radius: 8px; border: 1px solid rgba(231, 76, 60, 0.2);">
                        <div style="font-weight: 600; color: var(--danger); font-size: var(--font-sm); margin-bottom: 8px;">
                            ‚ö° Hauptspannungsfeld: ${mainConflict.title}
                        </div>

                        <!-- Dynamik-Sektion -->
                        <div style="margin-bottom: 12px;">
                            <div style="font-size: 11px; color: #e74c3c; font-weight: 600; margin-bottom: 6px;">üìä Dynamik</div>
                            ${mainConflict.dynamics?.pattern ? `
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5; margin-bottom: 6px;">
                                    <strong>Muster:</strong> ${mainConflict.dynamics.pattern}
                                </div>
                            ` : ''}
                            ${mainConflict.dynamics?.escalation ? `
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5; margin-bottom: 6px;">
                                    <strong>Eskalation:</strong> ${mainConflict.dynamics.escalation}
                                </div>
                            ` : ''}
                            ${mainConflict.dynamics?.core_wound ? `
                                <div style="font-size: var(--font-xs); color: #e74c3c; line-height: 1.5; padding: 6px; background: rgba(231,76,60,0.1); border-radius: 4px;">
                                    <strong>üíî Kernwunde:</strong> ${mainConflict.dynamics.core_wound}
                                </div>
                            ` : ''}
                        </div>

                        <!-- L√∂sungs-Sektion -->
                        <div style="padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="font-size: 11px; color: var(--success); font-weight: 600; margin-bottom: 6px;">üí° L√∂sungsweg</div>
                            ${mainConflict.resolution?.understanding ? `
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5; margin-bottom: 6px;">
                                    <strong>Verst√§ndnis:</strong> ${mainConflict.resolution.understanding}
                                </div>
                            ` : ''}
                            ${mainConflict.resolution?.practical ? `
                                <div style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5; margin-bottom: 6px;">
                                    <strong>Praktisch:</strong> ${mainConflict.resolution.practical}
                                </div>
                            ` : ''}
                            ${mainConflict.resolution?.growth ? `
                                <div style="font-size: var(--font-xs); color: var(--success); line-height: 1.5; padding: 6px; background: rgba(39,174,96,0.1); border-radius: 4px;">
                                    <strong>üå± Wachstum:</strong> ${mainConflict.resolution.growth}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            return `
                <div class="match-modal-section synthese">
                    <div class="match-modal-section-title">üéØ Psychologische Tiefe</div>
                    ${conflictHtml}
                    ${partnerConflictHtml}
                </div>
            `;
        }

        // Match Modal Functions
        function openMatchModal(type) {
            const matchData = type === 'top' ? currentTopMatch : currentChallenge;
            if (!matchData.id) return;

            // Set the modal context to use this match's partner
            modalContextPartner = matchData.id;

            const myArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[matchData.id];
            const interactionKey = `${currentArchetype}_${matchData.id}`;
            const interaction = data.interactions[interactionKey] || {};
            const scores = interaction.scores || {};

            const title = type === 'top' ? 'Top Match' : 'Challenge';
            const scoreColor = getScoreColor(matchData.score);

            // Store data for toggle refresh
            currentMatchModalData = {
                myArch,
                partnerArch,
                interaction,
                scores,
                scoreColor
            };

            // Initialize toggle buttons to current view state
            setTimeout(() => {
                const pathosBtn = document.getElementById('matchTogglePathos');
                const logosBtn = document.getElementById('matchToggleLogos');
                if (pathosBtn && logosBtn) {
                    pathosBtn.classList.toggle('active', currentMatchModalView === 'pathos');
                    logosBtn.classList.toggle('active', currentMatchModalView === 'logos');
                }
            }, 0);

            document.getElementById('modalTitle').textContent = `${myArch.name} + ${partnerArch.name}`;
            document.getElementById('modalBody').innerHTML = getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch);
            document.getElementById('categoryModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function getMatchModalContent(partnerArch, interaction, scores, scoreColor, myArch) {
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const overall = interaction.overall || 0;
            const isIdenticalType = myArch.id === partnerArch.id;

            const categoryBars = categories.map(cat => {
                const value = scores[cat]?.value || 0;
                const barClass = getBarClass(value);
                const name = categoryNames[cat] || cat;

                // Special note for identical types on category A (Beziehungsphilosophie)
                const isPhilosophyCategory = cat === 'A' && isIdenticalType;
                const specialNote = isPhilosophyCategory
                    ? '<div style="font-size: 10px; color: var(--success); margin-top: 2px;">Identische Grund√ºberzeugung</div>'
                    : '';

                return `
                    <div class="match-modal-bar-row clickable" onclick="openSingleCategoryModal('${cat}')">
                        <span class="match-modal-bar-label">${cat}</span>
                        <div class="match-modal-bar-container">
                            <div class="match-modal-bar ${barClass}" style="width: ${value}%">
                                <span class="match-modal-bar-value">${value}%</span>
                            </div>
                            ${specialNote}
                        </div>
                        <span class="match-modal-bar-name">${name}</span>
                    </div>
                `;
            }).join('');

            // Generate dynamic Pro/Contra based on current view (Pathos/Logos)
            const dynamicPro = generateDynamicPro(myArch, partnerArch, currentMatchModalView);
            const dynamicContra = generateDynamicContra(myArch, partnerArch, currentMatchModalView);

            // Combine static (from JSON) and dynamic items
            const staticPro = interaction.pro || [];
            const staticContra = interaction.contra || [];

            // Use dynamic items first, then add unique static items
            const combinedPro = [...dynamicPro];
            staticPro.forEach(p => {
                if (!combinedPro.some(dp => dp.toLowerCase().includes(p.toLowerCase().substring(0, 20)))) {
                    combinedPro.push(p);
                }
            });

            const combinedContra = [...dynamicContra];
            staticContra.forEach(c => {
                if (!combinedContra.some(dc => dc.toLowerCase().includes(c.toLowerCase().substring(0, 20)))) {
                    combinedContra.push(c);
                }
            });

            const proItems = combinedPro.map(p => `<li>${p}</li>`).join('') || '<li>Keine Daten</li>';
            const contraItems = combinedContra.map(c => `<li>${c}</li>`).join('') || '<li>Keine Daten</li>';

            // Perspective indicator
            const perspectiveLabel = currentMatchModalView === 'pathos'
                ? 'üî• Pathos-Perspektive (emotional)'
                : 'üß† Logos-Perspektive (rational)';

            // Generate synthesis section
            const synthesisSection = generateSynthesisSection(myArch, partnerArch);

            // Special banner for identical types
            const identicalTypeBanner = isIdenticalType ? `
                <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(46, 204, 113, 0.05));
                            border: 1px solid var(--success); border-radius: 10px; padding: 12px; margin-bottom: 15px; text-align: center;">
                    <div style="font-weight: 600; color: var(--success); margin-bottom: 4px;">‚úì Identischer Beziehungstyp</div>
                    <div style="font-size: var(--font-sm); color: var(--text-secondary);">
                        Ihr teilt dieselbe Grund√ºberzeugung √ºber Beziehungen
                    </div>
                </div>
            ` : '';

            const comboText = `${myArch.name} + ${partnerArch.name}`;
            const myDef = archetypeDefinitions[myArch.id]?.shortDef || '';
            const partnerDef = archetypeDefinitions[partnerArch.id]?.shortDef || '';

            return `
                <div class="modal-feedback-btn" onclick="openFeedbackModalWithContext('${comboText}')">
                    üí¨ Feedback zu ${comboText}
                </div>

                <div class="match-modal-header">
                    <div class="match-modal-icon" style="background: ${partnerArch.color}">${icons[partnerArch.id]}</div>
                    <div class="match-modal-info">
                        <h3 style="color: ${partnerArch.color}">
                            ${partnerArch.name}
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" title="Definition anzeigen">‚Ñπ</span>
                        </h3>
                        <p>${partnerArch.shortDescription || ''}</p>
                    </div>
                </div>

                ${identicalTypeBanner}

                <div class="type-definitions-compact" style="background: var(--bg-dark); border-radius: 10px; padding: 12px; margin-bottom: 15px; font-size: var(--font-sm);">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${myArch.color}; font-weight: 600;">${icons[myArch.id]} ${myArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${myArch.id}')" style="margin-left: 4px;">‚Ñπ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${myDef}</div>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <span style="color: ${partnerArch.color}; font-weight: 600;">${icons[partnerArch.id]} ${partnerArch.name}</span>
                            <span class="type-info-icon" onclick="openDefinitionModal('${partnerArch.id}')" style="margin-left: 4px;">‚Ñπ</span>
                            <div style="color: var(--text-muted); margin-top: 4px; line-height: 1.4;">${partnerDef}</div>
                        </div>
                    </div>
                </div>

                <div class="match-modal-score">
                    <span class="match-modal-score-label">Beziehungsqualit√§t ${isIdenticalType ? '(gleicher Typ)' : 'mit ' + myArch.name}</span>
                    <span class="match-modal-score-value" style="color: ${scoreColor}">${overall}</span>
                </div>

                <div class="match-modal-categories">
                    <div class="match-modal-categories-title">Kategorie-Bewertungen</div>
                    ${categoryBars}
                </div>

                <div class="match-modal-perspective">${perspectiveLabel}</div>

                <div class="match-modal-section pro">
                    <div class="match-modal-section-title">‚úì Was funktioniert</div>
                    <ul class="match-modal-list">${proItems}</ul>
                </div>

                <div class="match-modal-section contra">
                    <div class="match-modal-section-title">‚úó Herausforderungen</div>
                    <ul class="match-modal-list">${contraItems}</ul>
                </div>

                ${synthesisSection}
            `;
        }

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeCategoryModal();
            }
        });

        // ==========================================
        // FEEDBACK SYSTEM (entfernt - commentModal wird verwendet)
        // ==========================================
        // Leere Stubs um JavaScript-Fehler zu vermeiden
        function openFeedbackModal() { console.log('feedbackModal entfernt - bitte commentModal verwenden'); }
        function openFeedbackModalWithContext(ctx) { console.log('feedbackModal entfernt - bitte commentModal verwenden'); }
        function closeFeedbackModal(event) { }
        function initStarRatings() { }
        // submitFeedback entfernt - wird nicht mehr verwendet

        // Local storage backup - alles in tiage_comments
        function saveLocalFeedback(entry) {
            const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
            entry.timestamp = new Date().toISOString();
            entry.Typ = 'comment';  // Einheitlicher Typ
            stored.unshift(entry);
            localStorage.setItem('tiage_comments', JSON.stringify(stored));
        }

        function getLocalFeedback() {
            return JSON.parse(localStorage.getItem('tiage_comments') || '[]');
        }

        // Load and display feedback
        async function loadFeedback() {
            const container = document.getElementById('feedbackList');

            try {
                if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                    // Try to load from Google Sheets
                    const response = await fetch(GOOGLE_SCRIPT_URL);
                    const serverData = await response.json();
                    feedbackData = serverData.reverse(); // Newest first
                } else {
                    // Use local data only
                    feedbackData = getLocalFeedback();
                }
            } catch (error) {
                console.error('Load feedback error:', error);
                // Fallback to local
                feedbackData = getLocalFeedback();
            }

            // Populate type filter dropdowns
            populateTypeFilters();
            renderFeedbackList();
        }

        // Populate type dropdowns for filters
        function populateTypeFilters() {
            const archetypes = Object.values(data?.archetypes || {});
            const myTypeSelect = document.getElementById('filterMyType');
            const partnerTypeSelect = document.getElementById('filterPartnerType');

            const options = archetypes.map(a =>
                `<option value="${a.id}">${a.name}</option>`
            ).join('');

            myTypeSelect.innerHTML = `<option value="all">Alle Typen</option>${options}`;
            partnerTypeSelect.innerHTML = `<option value="all">Alle Partner</option>${options}`;
        }

        function renderFeedbackList() {
            const container = document.getElementById('feedbackList');

            // Apply all filters
            let filtered = feedbackData.filter(f => {
                const kontextId = (f.KontextID || f.kontextId || '').toLowerCase();
                const name = (f.Name || f.name || '').toLowerCase();
                const titel = (f.Titel || f.titel || '').toLowerCase();
                const kommentar = (f.Kommentar || f.kommentar || '').toLowerCase();
                const antwortAuf = f.AntwortAuf || f.antwortAuf || '';

                // Skip replies in main list (they'll be shown as threads)
                if (antwortAuf) return false;

                // Search filter
                if (feedbackFilters.search) {
                    const search = feedbackFilters.search.toLowerCase();
                    if (!name.includes(search) && !titel.includes(search) && !kommentar.includes(search)) {
                        return false;
                    }
                }

                // Type filters (parse from context ID like "Single (Ich) mit Duo")
                if (feedbackFilters.myType !== 'all' || feedbackFilters.partnerType !== 'all') {
                    const myTypeName = data?.archetypes?.[feedbackFilters.myType]?.name?.toLowerCase();
                    const partnerTypeName = data?.archetypes?.[feedbackFilters.partnerType]?.name?.toLowerCase();

                    if (feedbackFilters.myType !== 'all' && myTypeName) {
                        if (!kontextId.includes(myTypeName)) return false;
                    }
                    if (feedbackFilters.partnerType !== 'all' && partnerTypeName) {
                        if (!kontextId.includes('mit ' + partnerTypeName)) return false;
                    }
                }

                // Category filter
                if (feedbackFilters.category !== 'all') {
                    const cat = feedbackFilters.category;
                    if (cat === 'TM') {
                        if (!kontextId.includes('top match')) return false;
                    } else if (cat === 'CH') {
                        if (!kontextId.includes('challenge')) return false;
                    } else {
                        // Category A-F: check for category name
                        const catName = categoryNames[cat]?.toLowerCase();
                        if (catName && !kontextId.includes(catName)) return false;
                    }
                }

                return true;
            });

            // Sort
            if (feedbackFilters.sort === 'oldest') {
                filtered = filtered.reverse();
            } else if (feedbackFilters.sort === 'rating') {
                filtered.sort((a, b) => {
                    const aRating = (a.Verstand || a.verstand || 0) + (a.Gefuehl || a.gefuehl || 0);
                    const bRating = (b.Verstand || b.verstand || 0) + (b.Gefuehl || b.gefuehl || 0);
                    return bRating - aRating;
                });
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="feedback-empty">
                        ${feedbackData.length === 0
                            ? 'Noch kein Feedback vorhanden.<br>Sei der Erste!'
                            : 'Kein Feedback f√ºr diesen Filter.'}
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(f => renderFeedbackItem(f)).join('');
        }

        // Render single feedback item with replies
        function renderFeedbackItem(f, isReply = false) {
            const id = f.Id || f.id || f.timestamp || '';
            const kontextId = f.KontextID || f.kontextId || '-';
            const name = f.Name || f.name || 'Anonym';
            const titel = f.Titel || f.titel || '';
            const kommentar = f.Kommentar || f.kommentar || '';
            const verstand = f.Verstand || f.verstand || 0;
            const gefuehl = f.Gefuehl || f.gefuehl || 0;
            const timestamp = f.Timestamp || f.timestamp || '';

            // Find replies to this item
            const replies = feedbackData.filter(r =>
                (r.AntwortAuf || r.antwortAuf) === id
            );

            const timeStr = timestamp ? new Date(timestamp).toLocaleDateString('de-DE') : '';

            return `
                <div class="feedback-item ${isReply ? 'reply' : ''}" data-id="${id}">
                    <div class="feedback-item-header">
                        <span class="feedback-item-context">${kontextId}</span>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="feedback-item-name">${name}</span>
                            ${timeStr ? `<span class="feedback-timestamp">${timeStr}</span>` : ''}
                        </div>
                    </div>
                    <div class="feedback-item-title">${titel}</div>
                    ${kommentar ? `<div class="feedback-item-comment">${kommentar}</div>` : ''}
                    <div class="feedback-item-footer">
                        <div class="feedback-item-ratings">
                            <div class="feedback-rating">
                                <span>Verstand:</span>
                                <span class="stars">${'‚òÖ'.repeat(verstand)}${'‚òÜ'.repeat(5-verstand)}</span>
                            </div>
                            <div class="feedback-rating">
                                <span>Gef√ºhl:</span>
                                <span class="stars">${'‚òÖ'.repeat(gefuehl)}${'‚òÜ'.repeat(5-gefuehl)}</span>
                            </div>
                        </div>
                        <button class="feedback-reply-btn" onclick="openReplyModal('${id}', '${name}')">
                            ‚Ü© Antworten
                        </button>
                    </div>
                    ${replies.length > 0 ? `
                        <div class="feedback-replies">
                            ${replies.map(r => renderFeedbackItem(r, true)).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Open reply modal - uses commentModal (feedbackModal was removed)
        function openReplyModal(parentId, parentName) {
            replyToId = parentId;
            // Open comment modal for replies
            const modal = document.getElementById('commentModal');
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';

                // Reset form
                const nameInput = document.getElementById('commentName');
                const textInput = document.getElementById('commentText');
                if (nameInput) nameInput.value = '';
                if (textInput) {
                    textInput.value = '';
                    textInput.placeholder = `Antwort auf ${parentName}...`;
                }
            }
        }

        // Initialize advanced filters
        function initAdvancedFilters() {
            // Search input
            document.getElementById('feedbackSearch').addEventListener('input', (e) => {
                feedbackFilters.search = e.target.value;
                renderFeedbackList();
            });

            // Type selects
            document.getElementById('filterMyType').addEventListener('change', (e) => {
                feedbackFilters.myType = e.target.value;
                renderFeedbackList();
            });

            document.getElementById('filterPartnerType').addEventListener('change', (e) => {
                feedbackFilters.partnerType = e.target.value;
                renderFeedbackList();
            });

            // Category buttons
            document.querySelectorAll('.cat-filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.cat-filter-btn').forEach(b =>
                        b.classList.remove('active')
                    );
                    btn.classList.add('active');
                    feedbackFilters.category = btn.dataset.cat;
                    renderFeedbackList();
                });
            });

            // Sort select
            document.getElementById('filterSort').addEventListener('change', (e) => {
                feedbackFilters.sort = e.target.value;
                renderFeedbackList();
            });
        }

        // Initialize feedback system
        function initFeedbackSystem() {
            initStarRatings();
            initAdvancedFilters();
        }

        // Age Verification - Modal shows on EVERY visit (no localStorage)
        function checkAgeVerification() {
            // Modal always shows - no localStorage check
            const modal = document.getElementById('ageVerificationModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
                document.body.style.overflow = 'hidden';
            }
        }

        // Make confirmAge globally available - no localStorage storage
        window.confirmAge = function(isAdult) {
            console.log('confirmAge called with:', isAdult);
            if (isAdult) {
                var modal = document.getElementById('ageVerificationModal');
                if (modal) {
                    modal.classList.add('hidden');
                    modal.style.display = 'none';
                }
                document.body.style.overflow = 'auto';
            } else {
                window.location.href = 'https://www.google.com';
            }
        };

        // Also keep the regular function reference
        function confirmAge(isAdult) {
            window.confirmAge(isAdult);
        }

        // Initialize age verification - robust version with multiple fallbacks
        function initAgeVerification() {
            const modal = document.getElementById('ageVerificationModal');
            const yesButton = document.getElementById('ageVerifyYes');
            const noButton = document.getElementById('ageVerifyNo');

            // Helper function to handle age confirmation - no localStorage
            function handleAgeConfirm(isAdult, event) {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                console.log('handleAgeConfirm called:', isAdult);

                if (isAdult) {
                    if (modal) {
                        modal.classList.add('hidden');
                        modal.style.display = 'none';
                        modal.style.visibility = 'hidden';
                        modal.style.opacity = '0';
                        modal.style.pointerEvents = 'none';
                    }
                    document.body.style.overflow = 'auto';
                } else {
                    window.location.href = 'https://www.google.com';
                }
            }

            // Add event listeners to YES button
            if (yesButton) {
                yesButton.style.pointerEvents = 'auto';
                yesButton.style.cursor = 'pointer';
                yesButton.style.position = 'relative';
                yesButton.style.zIndex = '10002';

                // Remove old onclick to prevent double-firing
                yesButton.removeAttribute('onclick');

                // Add multiple event types for maximum compatibility
                yesButton.addEventListener('click', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });

                yesButton.addEventListener('touchend', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });

                // Also handle mousedown as fallback
                yesButton.addEventListener('mousedown', function(e) {
                    handleAgeConfirm(true, e);
                }, { passive: false, capture: true });
            }

            // Add event listeners to NO button
            if (noButton) {
                noButton.style.pointerEvents = 'auto';
                noButton.style.cursor = 'pointer';
                noButton.style.position = 'relative';
                noButton.style.zIndex = '10002';

                // Remove old onclick
                noButton.removeAttribute('onclick');

                noButton.addEventListener('click', function(e) {
                    handleAgeConfirm(false, e);
                }, { passive: false, capture: true });

                noButton.addEventListener('touchend', function(e) {
                    handleAgeConfirm(false, e);
                }, { passive: false, capture: true });
            }

            // Always show modal on page load - no localStorage check
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                modal.style.visibility = 'visible';
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
                document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
            }
        }

        // ========================================
        // Extended Dimensions Functions
        // ========================================

        function showDimensionTooltip(type) {
            // Try to get translated tooltip first, fall back to hardcoded
            let tooltip = TiageI18n.t(`tooltips.${type}`);
            if (!tooltip || typeof tooltip !== 'object' || !tooltip.title) {
                tooltip = dimensionTooltips[type];
            }
            if (!tooltip) return;

            document.getElementById('dimensionTooltipTitle').textContent = tooltip.title;
            document.getElementById('dimensionTooltipText').innerHTML = tooltip.text.replace(/\n/g, '<br>');
            document.getElementById('dimensionTooltipOverlay').classList.add('active');
        }

        function closeDimensionTooltip() {
            document.getElementById('dimensionTooltipOverlay').classList.remove('active');
        }

        // ========================================
        // Geschlecht Info Modal Functions
        // ========================================
        function showGeschlechtInfoModal() {
            document.getElementById('geschlechtInfoModal').classList.add('active');
        }

        function closeGeschlechtInfoModal() {
            document.getElementById('geschlechtInfoModal').classList.remove('active');
        }

        // ========================================
        // Dominanz Info Modal Functions
        // ========================================
        function showDominanzInfoModal() {
            document.getElementById('dominanzInfoModal').classList.add('active');
        }

        function closeDominanzInfoModal() {
            document.getElementById('dominanzInfoModal').classList.remove('active');
        }

        // ========================================
        // Orientierung Info Modal Functions
        // ========================================
        function showOrientierungInfoModal() {
            document.getElementById('orientierungInfoModal').classList.add('active');
        }

        function closeOrientierungInfoModal() {
            document.getElementById('orientierungInfoModal').classList.remove('active');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // GESCHLECHT PRIMARY/SECONDARY SYSTEM
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * Handle click on a Geschlecht button
         * Logic:
         * - First click = Primary (I indicator)
         * - Second click on different = Secondary (G indicator)
         * - Click on Primary = Clear both (primary and secondary)
         * - Click on Secondary = Clear only secondary
         */
        function handleGeschlechtClick(person, geschlechtValue, btn) {
            // Valid geschlecht values
            const validGeschlechtValues = ['cis_mann', 'cis_frau', 'trans_mann', 'trans_frau', 'nonbinaer', 'genderfluid', 'agender', 'intersex', 'divers'];

            // Ensure geschlecht has correct structure (migration from old format)
            if (!personDimensions[person].geschlecht ||
                !('primary' in personDimensions[person].geschlecht)) {
                personDimensions[person].geschlecht = { primary: null, secondary: null };
            }

            // Clean up invalid old values (e.g., 'm√§nnlich', 'weiblich' from old format)
            if (personDimensions[person].geschlecht.primary &&
                !validGeschlechtValues.includes(personDimensions[person].geschlecht.primary)) {
                console.log('[FIX] Clearing invalid primary value:', personDimensions[person].geschlecht.primary);
                personDimensions[person].geschlecht.primary = null;
            }
            if (personDimensions[person].geschlecht.secondary &&
                !validGeschlechtValues.includes(personDimensions[person].geschlecht.secondary)) {
                console.log('[FIX] Clearing invalid secondary value:', personDimensions[person].geschlecht.secondary);
                personDimensions[person].geschlecht.secondary = null;
            }

            const currentPrimary = personDimensions[person].geschlecht.primary;
            const currentSecondary = personDimensions[person].geschlecht.secondary;

            // DEBUG: Log what's happening
            console.log('[DEBUG] handleGeschlechtClick:', {
                person,
                geschlechtValue,
                currentPrimary,
                currentSecondary,
                typeOfPrimary: typeof currentPrimary,
                geschlechtObject: JSON.stringify(personDimensions[person].geschlecht),
                willSetAs: !currentPrimary ? 'PRIMARY' : (geschlechtValue === currentPrimary ? 'CLEAR' : 'SECONDARY')
            });

            if (geschlechtValue === currentPrimary) {
                // Click on Primary: Clear both
                personDimensions[person].geschlecht.primary = null;
                personDimensions[person].geschlecht.secondary = null;
            } else if (geschlechtValue === currentSecondary) {
                // Click on Secondary: Clear only secondary
                personDimensions[person].geschlecht.secondary = null;
            } else if (!currentPrimary) {
                // No primary yet: Set as primary (handles both null and undefined)
                personDimensions[person].geschlecht.primary = geschlechtValue;
            } else {
                // Primary exists, different value clicked: Set as secondary
                personDimensions[person].geschlecht.secondary = geschlechtValue;
            }

            // Sync with mobilePersonDimensions for mobile view consistency
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].geschlecht.primary = personDimensions[person].geschlecht.primary;
                mobilePersonDimensions[person].geschlecht.secondary = personDimensions[person].geschlecht.secondary;
            }

            // Sync with TiageState if available
            if (typeof TiageState !== 'undefined') {
                TiageState.set(`personDimensions.${person}.geschlecht`, personDimensions[person].geschlecht);
            }

            // Sync all UIs
            syncGeschlechtUI(person);

            // Remove needs-selection if primary is set
            const hasPrimary = personDimensions[person].geschlecht.primary !== null;
            document.querySelectorAll(`[data-dimension="${person}-geschlecht-new"], [data-dimension="mobile-${person}-geschlecht"], [data-dimension="${person}-geschlecht"]`).forEach(dim => {
                if (hasPrimary) {
                    dim.classList.remove('needs-selection');
                } else {
                    dim.classList.add('needs-selection');
                }
            });

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        /**
         * Sync Geschlecht UI across all views (Desktop, Mobile, Modal)
         */
        function syncGeschlechtUI(person) {
            const primary = personDimensions[person].geschlecht.primary;
            const secondary = personDimensions[person].geschlecht.secondary;

            // All geschlecht button selectors for this person
            const selectors = [
                `.geschlecht-grid[data-person="${person}"] .geschlecht-btn`,
                `#${person}-geschlecht-grid .geschlecht-btn`,
                `#mobile-${person}-geschlecht-grid .geschlecht-btn`,
                `#modal-${person}-geschlecht-grid .geschlecht-btn`
            ];

            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(btn => {
                    const value = btn.dataset.value;

                    // Remove all states
                    btn.classList.remove('primary-selected', 'secondary-selected');

                    // Remove existing indicators
                    const existingIndicator = btn.querySelector('.geschlecht-indicator');
                    if (existingIndicator) {
                        existingIndicator.remove();
                    }

                    // Add appropriate state and indicator
                    if (value === primary) {
                        btn.classList.add('primary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-primary';
                        indicator.textContent = 'P';
                        indicator.title = 'Prim√§r';
                        btn.appendChild(indicator);
                    } else if (value === secondary) {
                        btn.classList.add('secondary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-secondary';
                        indicator.textContent = 'S';
                        indicator.title = 'Sekund√§r';
                        btn.appendChild(indicator);
                    }
                });
            });

            // Also sync legacy radio buttons if they exist
            document.querySelectorAll(`input[name="${person}-geschlecht"]`).forEach(radio => {
                radio.checked = (radio.value === primary);
            });
            document.querySelectorAll(`input[name="${person}-geschlecht-new"]`).forEach(radio => {
                radio.checked = (radio.value === primary);
            });
            document.querySelectorAll(`input[name="mobile-${person}-geschlecht"]`).forEach(radio => {
                radio.checked = (radio.value === primary);
            });

            // Update collapsed summary for geschlecht
            updateGeschlechtSummary(person);
        }

        /**
         * Get summary text for geschlecht selection
         */
        function getGeschlechtSummary(person) {
            const primary = personDimensions[person].geschlecht.primary;
            const secondary = personDimensions[person].geschlecht.secondary;

            if (!primary) {
                return 'Geschlecht fehlt';
            }

            const parts = [];
            const primaryLabel = TiageI18n.t(`geschlecht.types.${primary}`, primary);
            parts.push(primaryLabel + ' (I)');

            if (secondary) {
                const secondaryLabel = TiageI18n.t(`geschlecht.types.${secondary}`, secondary);
                parts.push(secondaryLabel + ' (G)');
            }

            return '‚úì ' + parts.join(', ');
        }

        /**
         * Get summary text for geschlecht selection in grid (without 'fehlt' text)
         * Returns selected values in green, or empty string if nothing selected
         */
        function getGeschlechtGridSummary(person) {
            const primary = personDimensions[person].geschlecht.primary;
            const secondary = personDimensions[person].geschlecht.secondary;

            if (!primary) {
                return ''; // No 'fehlt' text for grid - only show selections
            }

            const parts = [];
            const primaryLabel = TiageI18n.t(`geschlecht.types.${primary}`, primary);
            parts.push(primaryLabel + ' (I)');

            if (secondary) {
                const secondaryLabel = TiageI18n.t(`geschlecht.types.${secondary}`, secondary);
                parts.push(secondaryLabel + ' (G)');
            }

            return '‚úì ' + parts.join(', ');
        }

        /**
         * Update header summary for geschlecht (only in header area, not in collapsed-summary)
         */
        function updateGeschlechtSummary(person) {
            const summaryText = getGeschlechtSummary(person);
            const gridSummaryText = getGeschlechtGridSummary(person);
            const isMissing = !personDimensions[person].geschlecht.primary;

            // Update header element (shows 'fehlt' if nothing selected) - Desktop and Mobile
            ['', 'mobile-'].forEach(prefix => {
                const headerId = `${prefix}${person}-header-geschlecht`;
                const header = document.getElementById(headerId);
                if (header) {
                    header.textContent = summaryText;
                    header.classList.toggle('missing', isMissing);
                }
            });

            // Update grid collapsed-summary (only shows selections in green, no 'fehlt')
            ['', 'mobile-'].forEach(prefix => {
                const summaryId = `${prefix}${person}-geschlecht-summary`;
                const summary = document.getElementById(summaryId);
                if (summary) {
                    summary.textContent = gridSummaryText;
                    summary.classList.toggle('has-selection', !isMissing);
                }
            });
        }

        /**
         * Check if geschlecht has any selection (primary)
         */
        function hasGeschlechtSelected(person) {
            return personDimensions[person].geschlecht.primary !== null;
        }

        /**
         * Handle hover on geschlecht button - highlight I or G in legend
         * Based on click logic: if no primary -> next click sets I, if primary exists -> next click sets G
         */
        function handleGeschlechtHover(person, geschlechtValue, isEntering) {
            const legendSelectors = [
                `#${person}-geschlecht-legend`,
                `#mobile-${person}-geschlecht-legend`
            ];

            legendSelectors.forEach(selector => {
                const legend = document.querySelector(selector);
                if (!legend) return;

                if (!isEntering) {
                    // Mouse left - remove all highlights
                    legend.classList.remove('highlight-p', 'highlight-s');
                    return;
                }

                // Mouse entered - determine which to highlight based on click logic
                const currentPrimary = personDimensions[person].geschlecht.primary;
                const currentSecondary = personDimensions[person].geschlecht.secondary;

                legend.classList.remove('highlight-p', 'highlight-s');

                if (geschlechtValue === currentPrimary || geschlechtValue === currentSecondary) {
                    // Hovering over already selected - highlight what would be affected
                    if (geschlechtValue === currentPrimary) {
                        legend.classList.add('highlight-p');
                    } else {
                        legend.classList.add('highlight-s');
                    }
                } else if (currentPrimary === null) {
                    // No primary yet: next click sets primary (P)
                    legend.classList.add('highlight-p');
                } else {
                    // Primary exists, different value: next click sets secondary (S)
                    legend.classList.add('highlight-s');
                }
            });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DYNAMISCHE BUTTON-GENERIERUNG (Harmonisierung Desktop/Mobile/Modal)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * Initialisiert alle Dimension-Buttons dynamisch
         * Ersetzt statische HTML-Buttons durch dynamisch generierte
         */
        function initDimensionButtons() {
            // Geschlechtsidentit√§t Optionen
            const geschlechtOptions = [
                { value: 'cis_mann', label: 'Cis Mann' },
                { value: 'cis_frau', label: 'Cis Frau' },
                { value: 'trans_mann', label: 'Trans Mann' },
                { value: 'trans_frau', label: 'Trans Frau' },
                { value: 'nonbinaer', label: 'Nonbin√§r' },
                { value: 'genderfluid', label: 'Genderfluid' },
                { value: 'agender', label: 'Agender' },
                { value: 'intersex', label: 'Intersex' },
                { value: 'divers', label: 'Divers' }
            ];

            // Dominanz Optionen
            const dominanzOptions = [
                { value: 'dominant', label: 'dominant' },
                { value: 'submissiv', label: 'submissiv' },
                { value: 'switch', label: 'switch' },
                { value: 'ausgeglichen', label: 'ausgeglichen' }
            ];

            // Orientierung Optionen
            const orientierungOptions = [
                { value: 'heterosexuell', label: 'heterosexuell' },
                { value: 'homosexuell', label: 'homosexuell' },
                { value: 'bisexuell', label: 'bisexuell' }
            ];

            // GFK Optionen (Gewaltfreie Kommunikation / NVC)
            const gfkOptions = [
                { value: 'niedrig', label: TiageI18n.t('dimensions.gfkLevels.niedrig', 'niedrig') },
                { value: 'mittel', label: TiageI18n.t('dimensions.gfkLevels.mittel', 'mittel') },
                { value: 'hoch', label: TiageI18n.t('dimensions.gfkLevels.hoch', 'hoch') }
            ];

            // Geschlecht-Grids bef√ºllen
            document.querySelectorAll('.geschlecht-grid').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;
                grid.innerHTML = geschlechtOptions.map(opt =>
                    `<button type="button" class="geschlecht-btn" data-value="${opt.value}" onclick="handleGeschlechtClick('${person}', '${opt.value}', this)">${opt.label}</button>`
                ).join('');
            });

            // Dominanz-Grids bef√ºllen (nur Desktop mit data-person)
            document.querySelectorAll('.dominanz-grid[data-person]').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;
                grid.innerHTML = dominanzOptions.map(opt =>
                    `<button type="button" class="dominanz-btn" data-value="${opt.value}" onclick="handleDominanzClick('${person}', '${opt.value}', this)">${opt.label}</button>`
                ).join('');
            });

            // Orientierung-Grids bef√ºllen (nur Desktop mit data-person)
            document.querySelectorAll('.orientierung-grid[data-person]').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;
                grid.innerHTML = orientierungOptions.map(opt =>
                    `<button type="button" class="orientierung-btn" data-value="${opt.value}" onclick="handleOrientierungClick('${person}', '${opt.value}', this)">${opt.label}</button>`
                ).join('');
            });

            // GFK-Grids bef√ºllen
            document.querySelectorAll('.gfk-grid[data-person]').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;
                grid.innerHTML = gfkOptions.map(opt =>
                    `<button type="button" class="gfk-btn" data-value="${opt.value}" onclick="handleGfkClick('${person}', '${opt.value}', this)">${opt.label}</button>`
                ).join('');
            });

            // UI mit gespeichertem State synchronisieren
            ['ich', 'partner'].forEach(person => {
                syncGeschlechtUI(person);
                syncDominanzUI(person);
                syncOrientierungUI(person);
                syncGfkUI(person);
            });
        }

        /**
         * Initialize geschlecht hover events for all grids
         */
        function initGeschlechtHoverEvents() {
            document.querySelectorAll('.geschlecht-grid').forEach(grid => {
                const person = grid.dataset.person;
                if (!person) return;

                grid.querySelectorAll('.geschlecht-btn').forEach(btn => {
                    const value = btn.dataset.value;

                    btn.addEventListener('mouseenter', () => {
                        handleGeschlechtHover(person, value, true);
                    });

                    btn.addEventListener('mouseleave', () => {
                        handleGeschlechtHover(person, value, false);
                    });
                });
            });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DOMINANZ PRIMARY/SECONDARY SYSTEM (same logic as Geschlechtsidentit√§t)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * Handle click on a Dominanz button
         * Logic (same as Geschlechtsidentit√§t):
         * - First click = Primary (I indicator)
         * - Second click on different = Secondary (G indicator)
         * - Click on Primary = Clear both (primary and secondary)
         * - Click on Secondary = Clear only secondary
         */
        function handleDominanzClick(person, dominanzValue, btn) {
            // Ensure dominanz has correct structure (migration from old format)
            if (!personDimensions[person].dominanz ||
                !('primary' in personDimensions[person].dominanz)) {
                personDimensions[person].dominanz = { primary: null, secondary: null };
            }

            const currentPrimary = personDimensions[person].dominanz.primary;
            const currentSecondary = personDimensions[person].dominanz.secondary;

            if (dominanzValue === currentPrimary) {
                // Click on Primary: Clear both
                personDimensions[person].dominanz.primary = null;
                personDimensions[person].dominanz.secondary = null;
            } else if (dominanzValue === currentSecondary) {
                // Click on Secondary: Clear only secondary
                personDimensions[person].dominanz.secondary = null;
            } else if (!currentPrimary) {
                // No primary yet: Set as primary (handles both null and undefined)
                personDimensions[person].dominanz.primary = dominanzValue;
            } else {
                // Primary exists, different value clicked: Set as secondary
                personDimensions[person].dominanz.secondary = dominanzValue;
            }

            // Sync with mobilePersonDimensions for mobile view consistency
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].dominanz.primary = personDimensions[person].dominanz.primary;
                mobilePersonDimensions[person].dominanz.secondary = personDimensions[person].dominanz.secondary;
            }

            // Sync with TiageState if available
            if (typeof TiageState !== 'undefined') {
                TiageState.set(`personDimensions.${person}.dominanz`, personDimensions[person].dominanz);
            }

            // Sync all UIs
            syncDominanzUI(person);

            // Remove needs-selection if primary is set
            const hasPrimary = personDimensions[person].dominanz.primary !== null;
            document.querySelectorAll(`[data-dimension="${person}-dominanz-multi"], [data-dimension="mobile-${person}-dominanz"], [data-dimension="${person}-dominanz"]`).forEach(dim => {
                if (hasPrimary) {
                    dim.classList.remove('needs-selection');
                } else {
                    dim.classList.add('needs-selection');
                }
            });

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        /**
         * GEMEINSAME Funktion: Sync UI f√ºr Dominanz oder Orientierung
         * Aktualisiert Buttons in Desktop, Mobile und Modal
         *
         * @param {string} person - 'ich' oder 'partner'
         * @param {string} dimension - 'dominanz' oder 'orientierung'
         */
        function syncDimensionUI(person, dimension) {
            const data = personDimensions[person][dimension];
            if (!data) return;

            const primary = data.primary;
            const secondary = data.secondary;

            // Button-Selektoren f√ºr diese Dimension
            const selectors = [
                `.${dimension}-grid[data-person="${person}"] .${dimension}-btn`,
                `#${person}-${dimension}-grid .${dimension}-btn`,
                `#mobile-${person}-${dimension}-grid .${dimension}-btn`,
                `#modal-${person}-${dimension}-grid .${dimension}-btn`
            ];

            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(btn => {
                    const value = btn.dataset.value;

                    // Alle States entfernen
                    btn.classList.remove('primary-selected', 'secondary-selected');

                    // Bestehende Indikatoren entfernen
                    const existingIndicator = btn.querySelector('.geschlecht-indicator');
                    if (existingIndicator) {
                        existingIndicator.remove();
                    }

                    // Passenden State und Indikator hinzuf√ºgen
                    if (value === primary) {
                        btn.classList.add('primary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-primary';
                        indicator.textContent = 'P';
                        indicator.title = 'Prim√§r';
                        btn.appendChild(indicator);
                    } else if (value === secondary) {
                        btn.classList.add('secondary-selected');
                        const indicator = document.createElement('span');
                        indicator.className = 'geschlecht-indicator indicator-secondary';
                        indicator.textContent = 'S';
                        indicator.title = 'Sekund√§r';
                        btn.appendChild(indicator);
                    }
                });
            });

            // Summary aktualisieren
            if (dimension === 'dominanz') {
                updateDominanzSummary(person);
            } else if (dimension === 'orientierung') {
                updateOrientierungSummary(person);
            }
        }

        // Wrapper f√ºr R√ºckw√§rtskompatibilit√§t
        function syncDominanzUI(person) {
            syncDimensionUI(person, 'dominanz');
        }

        /**
         * GEMEINSAME Funktion: Summary-Text f√ºr eine Dimension erstellen
         *
         * @param {string} person - 'ich' oder 'partner'
         * @param {string} dimension - 'dominanz' oder 'orientierung'
         * @param {boolean} showMissing - true = zeigt "fehlt", false = zeigt ""
         */
        function getDimensionSummary(person, dimension, showMissing = true) {
            const data = personDimensions[person][dimension];
            if (!data) return showMissing ? `${dimension} fehlt` : '';

            const primary = data.primary;
            const secondary = data.secondary;

            if (!primary) {
                // Dimension-Name mit Gro√übuchstabe f√ºr "fehlt" Text
                const label = dimension.charAt(0).toUpperCase() + dimension.slice(1);
                return showMissing ? `${label} fehlt` : '';
            }

            const parts = [primary + ' (I)'];
            if (secondary) {
                parts.push(secondary + ' (G)');
            }

            return '‚úì ' + parts.join(', ');
        }

        // Wrapper f√ºr R√ºckw√§rtskompatibilit√§t
        function getDominanzSummary(person) {
            return getDimensionSummary(person, 'dominanz', true);
        }

        function getDominanzGridSummary(person) {
            return getDimensionSummary(person, 'dominanz', false);
        }

        /**
         * Update header summary for dominanz (only in header area, not in collapsed-summary)
         */
        function updateDominanzSummary(person) {
            const summaryText = getDominanzSummary(person);
            const gridSummaryText = getDominanzGridSummary(person);
            const isMissing = !personDimensions[person].dominanz.primary;

            // Update header element (shows 'fehlt' if nothing selected) - Desktop and Mobile
            ['', 'mobile-'].forEach(prefix => {
                const headerId = `${prefix}${person}-header-dominanz`;
                const header = document.getElementById(headerId);
                if (header) {
                    header.textContent = summaryText;
                    header.classList.toggle('missing', isMissing);
                }
            });

            // Update grid collapsed-summary (only shows selections in green, no 'fehlt')
            ['', 'mobile-'].forEach(prefix => {
                const summaryId = `${prefix}${person}-dominanz-summary`;
                const summary = document.getElementById(summaryId);
                if (summary) {
                    summary.textContent = gridSummaryText;
                    summary.classList.toggle('has-selection', !isMissing);
                }
            });

            // Update needs-selection classes
            ['', 'mobile-', 'modal-'].forEach(prefix => {
                const dim = document.querySelector(`[data-dimension="${prefix}${person}-dominanz-multi"]`);
                if (dim) {
                    if (!isMissing) dim.classList.remove('needs-selection');
                    else dim.classList.add('needs-selection');
                }
            });
        }

        // Helper: Check if any dominanz is selected (for backwards compatibility)
        function hasAnyDominanzSelected(person) {
            return personDimensions[person].dominanz.primary !== null;
        }

        // Get the primary dominanz type (for backwards compatibility)
        function getPrimaryFaktDominanz(person) {
            return personDimensions[person].dominanz.primary;
        }

        // Get the primary orientierung type (for backwards compatibility)
        function getPrimaryFaktOrientierung(person) {
            return personDimensions[person].orientierung.primary;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ORIENTIERUNG PRIMARY/SECONDARY SYSTEM (same logic as Geschlechtsidentit√§t)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * Handle click on an Orientierung button
         * Logic (same as Geschlechtsidentit√§t):
         * - First click = Primary (I indicator)
         * - Second click on different = Secondary (G indicator)
         * - Click on Primary = Clear both (primary and secondary)
         * - Click on Secondary = Clear only secondary
         */
        function handleOrientierungClick(person, orientierungValue, btn) {
            // Ensure orientierung has correct structure (migration from old format)
            if (!personDimensions[person].orientierung ||
                !('primary' in personDimensions[person].orientierung)) {
                personDimensions[person].orientierung = { primary: null, secondary: null };
            }

            const currentPrimary = personDimensions[person].orientierung.primary;
            const currentSecondary = personDimensions[person].orientierung.secondary;

            if (orientierungValue === currentPrimary) {
                // Click on Primary: Clear both
                personDimensions[person].orientierung.primary = null;
                personDimensions[person].orientierung.secondary = null;
            } else if (orientierungValue === currentSecondary) {
                // Click on Secondary: Clear only secondary
                personDimensions[person].orientierung.secondary = null;
            } else if (!currentPrimary) {
                // No primary yet: Set as primary (handles both null and undefined)
                personDimensions[person].orientierung.primary = orientierungValue;
            } else {
                // Primary exists, different value clicked: Set as secondary
                personDimensions[person].orientierung.secondary = orientierungValue;
            }

            // Sync with mobilePersonDimensions for mobile view consistency
            if (typeof mobilePersonDimensions !== 'undefined') {
                mobilePersonDimensions[person].orientierung.primary = personDimensions[person].orientierung.primary;
                mobilePersonDimensions[person].orientierung.secondary = personDimensions[person].orientierung.secondary;
            }

            // Sync with TiageState if available
            if (typeof TiageState !== 'undefined') {
                TiageState.set(`personDimensions.${person}.orientierung`, personDimensions[person].orientierung);
            }

            // Sync all UIs
            syncOrientierungUI(person);

            // Remove needs-selection if primary is set
            const hasPrimary = personDimensions[person].orientierung.primary !== null;
            document.querySelectorAll(`[data-dimension="${person}-orientierung-multi"], [data-dimension="mobile-${person}-orientierung"], [data-dimension="${person}-orientierung"]`).forEach(dim => {
                if (hasPrimary) {
                    dim.classList.remove('needs-selection');
                } else {
                    dim.classList.add('needs-selection');
                }
            });

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        // Wrapper f√ºr R√ºckw√§rtskompatibilit√§t
        function syncOrientierungUI(person) {
            syncDimensionUI(person, 'orientierung');
        }

        // Wrapper f√ºr R√ºckw√§rtskompatibilit√§t (nutzen getDimensionSummary)
        function getOrientierungSummary(person) {
            return getDimensionSummary(person, 'orientierung', true);
        }

        function getOrientierungGridSummary(person) {
            return getDimensionSummary(person, 'orientierung', false);
        }

        /**
         * Update header summary for orientierung (only in header area, not in collapsed-summary)
         */
        function updateOrientierungSummary(person) {
            const summaryText = getOrientierungSummary(person);
            const gridSummaryText = getOrientierungGridSummary(person);
            const isMissing = !personDimensions[person].orientierung.primary;

            // Update header element (shows 'fehlt' if nothing selected) - Desktop and Mobile
            ['', 'mobile-'].forEach(prefix => {
                const headerId = `${prefix}${person}-header-orientierung`;
                const header = document.getElementById(headerId);
                if (header) {
                    header.textContent = summaryText;
                    header.classList.toggle('missing', isMissing);
                }
            });

            // Update grid collapsed-summary (only shows selections in green, no 'fehlt')
            ['', 'mobile-'].forEach(prefix => {
                const summaryId = `${prefix}${person}-orientierung-summary`;
                const summary = document.getElementById(summaryId);
                if (summary) {
                    summary.textContent = gridSummaryText;
                    summary.classList.toggle('has-selection', !isMissing);
                }
            });

            // Update needs-selection classes
            ['', 'mobile-', 'modal-'].forEach(prefix => {
                const dim = document.querySelector(`[data-dimension="${prefix}${person}-orientierung-multi"]`);
                if (dim) {
                    if (!isMissing) dim.classList.remove('needs-selection');
                    else dim.classList.add('needs-selection');
                }
            });
        }

        // Helper: Check if any orientierung is selected (for backwards compatibility)
        function hasAnyOrientierungSelected(person) {
            return personDimensions[person].orientierung.primary !== null;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MOBILE STATUS TOGGLE HANDLERS (Gelebt/Interessiert buttons)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * GEMEINSAME Funktion f√ºr Dominanz und Orientierung Status-Toggle
         * Reduziert Code-Duplizierung erheblich!
         *
         * @param {string} person - 'ich' oder 'partner'
         * @param {string} dimension - 'dominanz' oder 'orientierung'
         * @param {string} type - z.B. 'dominant', 'heterosexuell', etc.
         * @param {string} status - 'gelebt' (primary) oder 'interessiert' (secondary)
         */
        function handleStatusToggle(person, dimension, type, status) {
            // Sicherstellen, dass die Datenstruktur existiert
            if (!personDimensions[person][dimension] ||
                !('primary' in personDimensions[person][dimension])) {
                personDimensions[person][dimension] = { primary: null, secondary: null };
            }

            const data = personDimensions[person][dimension];
            const currentPrimary = data.primary;
            const currentSecondary = data.secondary;

            if (status === 'gelebt') {
                // Toggle primary (Gelebt)
                if (currentPrimary === type) {
                    // Schon primary ‚Üí entfernen
                    data.primary = null;
                    if (currentSecondary === type) {
                        data.secondary = null;
                    }
                } else {
                    // Als primary setzen
                    data.primary = type;
                    if (currentSecondary === type) {
                        data.secondary = null;
                    }
                }
            } else if (status === 'interessiert') {
                // Toggle secondary (Interessiert)
                if (currentSecondary === type) {
                    // Schon secondary ‚Üí entfernen
                    data.secondary = null;
                } else {
                    // Als secondary setzen (nur wenn nicht schon primary)
                    if (currentPrimary !== type) {
                        data.secondary = type;
                    }
                }
            }

            // Mit mobilePersonDimensions synchronisieren
            if (typeof mobilePersonDimensions !== 'undefined' &&
                mobilePersonDimensions[person]?.[dimension]) {
                mobilePersonDimensions[person][dimension].primary = data.primary;
                mobilePersonDimensions[person][dimension].secondary = data.secondary;
            }

            // Mit TiageState synchronisieren
            if (typeof TiageState !== 'undefined') {
                TiageState.set(`personDimensions.${person}.${dimension}`, data);
            }

            // UI synchronisieren (je nach Dimension)
            if (dimension === 'dominanz') {
                syncDominanzUI(person);
                syncMobileDominanzStatusButtons(person);
            } else if (dimension === 'orientierung') {
                syncOrientierungUI(person);
                syncMobileOrientierungStatusButtons(person);
            }

            // needs-selection aktualisieren
            const hasPrimary = data.primary !== null;
            document.querySelectorAll(`[data-dimension*="${person}-${dimension}"]`).forEach(dim => {
                dim.classList.toggle('needs-selection', !hasPrimary);
            });

            updateComparisonView();

            if (typeof saveSelectionToStorage === 'function') {
                saveSelectionToStorage();
            }
        }

        /**
         * Wrapper f√ºr Dominanz (beh√§lt alte onclick-Aufrufe funktionsf√§hig)
         */
        function handleDominanzStatusToggle(person, dominanzType, status, btn) {
            handleStatusToggle(person, 'dominanz', dominanzType, status);
        }

        /**
         * Wrapper f√ºr Orientierung (beh√§lt alte onclick-Aufrufe funktionsf√§hig)
         */
        function handleOrientierungStatusToggle(person, orientierungType, status, btn) {
            handleStatusToggle(person, 'orientierung', orientierungType, status);
        }

        /**
         * GEMEINSAME Funktion: Sync mobile status buttons f√ºr eine Dimension
         *
         * @param {string} person - 'ich' oder 'partner'
         * @param {string} dimension - 'dominanz' oder 'orientierung'
         */
        function syncMobileStatusButtons(person, dimension) {
            const data = personDimensions[person][dimension];
            if (!data) return;

            const primary = data.primary;
            const secondary = data.secondary;

            // Konfiguration f√ºr jede Dimension
            const config = {
                dominanz: {
                    types: ['dominant', 'submissiv', 'switch', 'ausgeglichen'],
                    abbrevs: ['dom', 'sub', 'sw', 'aus'],
                    letter: 'd'
                },
                orientierung: {
                    types: ['heterosexuell', 'homosexuell', 'bisexuell'],
                    abbrevs: ['het', 'hom', 'bi'],
                    letter: 'o'
                }
            };

            const { types, abbrevs, letter } = config[dimension];
            const prefix = person === 'ich' ? 'm-ich' : 'm-partner';

            types.forEach((type, i) => {
                const statusGroup = document.getElementById(`${prefix}-${letter}-${abbrevs[i]}-status`);
                if (!statusGroup) return;

                const gelebtBtn = statusGroup.querySelector('[data-status="gelebt"]');
                const interessiertBtn = statusGroup.querySelector('[data-status="interessiert"]');

                if (gelebtBtn) {
                    gelebtBtn.classList.toggle('active-gelebt', primary === type);
                }
                if (interessiertBtn) {
                    interessiertBtn.classList.toggle('active-interessiert', secondary === type);
                }
            });
        }

        // Wrapper f√ºr R√ºckw√§rtskompatibilit√§t
        function syncMobileDominanzStatusButtons(person) {
            syncMobileStatusButtons(person, 'dominanz');
        }

        function syncMobileOrientierungStatusButtons(person) {
            syncMobileStatusButtons(person, 'orientierung');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // GFK (Gewaltfreie Kommunikation) HANDLER
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * Handle click on a GFK button
         * GFK-Wert wird durch die App basierend auf Archetypen berechnet - nicht manuell umschaltbar.
         * Bei Klick wird ein erkl√§rendes Modal angezeigt.
         */
        function handleGfkClick(person, gfkValue, btn) {
            // GFK-Wert ist nicht manuell umschaltbar - zeige Erkl√§rungsmodal
            showGfkExplanationModal(gfkValue);
        }

        /**
         * GFK-Erkl√§rungen f√ºr die verschiedenen Level
         */
        const gfkLevelExplanations = {
            niedrig: {
                title: 'Niedrig',
                description: `
                    <p><strong>Niedrige Bed√ºrfnis-√úbereinstimmung</strong> bedeutet, dass die Kernbed√ºrfnisse der beiden Archetypen stark voneinander abweichen.</p>
                    <p>Dies kann zu Herausforderungen in der Kommunikation f√ºhren, da beide Partner unterschiedliche Priorit√§ten haben. Eine bewusste Auseinandersetzung mit den Bed√ºrfnissen des anderen ist hier besonders wichtig.</p>
                    <p>Typische Unterschiede betreffen oft:</p>
                    <ul style="margin-left: 20px; margin-top: 8px;">
                        <li>Freiheit vs. Sicherheit</li>
                        <li>Autonomie vs. N√§he</li>
                        <li>Stabilit√§t vs. Spontaneit√§t</li>
                    </ul>
                `
            },
            mittel: {
                title: 'Mittel',
                description: `
                    <p><strong>Mittlere Bed√ºrfnis-√úbereinstimmung</strong> zeigt eine teilweise Schnittmenge der Kernbed√ºrfnisse.</p>
                    <p>Es gibt sowohl gemeinsame Grundlagen als auch Bereiche, die Kompromissbereitschaft erfordern. Mit guter Kommunikation k√∂nnen diese Unterschiede als bereichernd erlebt werden.</p>
                    <p>Empfehlung: Fokussiert euch auf die gemeinsamen Bed√ºrfnisse und entwickelt Strategien f√ºr die unterschiedlichen Priorit√§ten.</p>
                `
            },
            hoch: {
                title: 'Hoch',
                description: `
                    <p><strong>Hohe Bed√ºrfnis-√úbereinstimmung</strong> bedeutet, dass beide Archetypen √§hnliche Kernbed√ºrfnisse priorisieren.</p>
                    <p>Dies schafft eine nat√ºrliche Basis f√ºr Verst√§ndnis und kann die Kommunikation erleichtern. Beide Partner sprechen oft intuitiv die gleiche "Bed√ºrfnis-Sprache".</p>
                    <p>Dies ist ein guter Ausgangspunkt - dennoch bleibt achtsame Kommunikation wichtig, da auch bei hoher √úbereinstimmung individuelle Unterschiede bestehen.</p>
                `
            }
        };

        /**
         * Zeigt das GFK-Erkl√§rungsmodal an
         */
        function showGfkExplanationModal(level) {
            const modal = document.getElementById('gfkExplanationModal');
            const badge = document.getElementById('gfkModalLevelBadge');
            const explanation = document.getElementById('gfkModalExplanation');

            if (!modal || !level) return;

            // Level-spezifische Daten
            const data = gfkLevelExplanations[level] || gfkLevelExplanations.niedrig;

            // Badge aktualisieren
            badge.textContent = data.title;
            badge.className = 'gfk-level-indicator gfk-level-' + level;

            // Erkl√§rung aktualisieren
            explanation.innerHTML = data.description;

            // Modal √∂ffnen
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        /**
         * Schlie√üt das GFK-Erkl√§rungsmodal
         */
        function closeGfkExplanationModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('gfkExplanationModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        /**
         * √ñffnet das Bed√ºrfnis-Vergleich Modal
         * @param {string} type - 'gemeinsam' oder 'unterschiedlich'
         */
        function openNeedsCompareModal(type) {
            const modal = document.getElementById('needsCompareModal');
            const body = document.getElementById('needsCompareModalBody');
            const title = document.getElementById('needsCompareModalTitle');

            if (!modal || !body) return;

            // Matching-Daten holen
            const ichArchetyp = (currentArchetype || '').replace('_', '-');
            const partnerArchetyp = (selectedPartner || '').replace('_', '-');

            if (!ichArchetyp || !partnerArchetyp || typeof GfkBeduerfnisse === 'undefined') {
                body.innerHTML = '<p style="color: var(--text-muted);">Keine Daten verf√ºgbar.</p>';
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                return;
            }

            const matching = GfkBeduerfnisse.berechneMatching(ichArchetyp, partnerArchetyp);
            const ichName = archetypeDefinitions[currentArchetype]?.name || 'ICH';
            const partnerName = archetypeDefinitions[selectedPartner]?.name || 'Partner';

            // Titel setzen
            if (type === 'gemeinsam') {
                title.textContent = 'Gemeinsame Bed√ºrfnisse';
            } else {
                title.textContent = 'Unterschiedliche Priorit√§ten';
            }

            // Daten f√ºr Anzeige vorbereiten
            const items = type === 'gemeinsam'
                ? (matching.topUebereinstimmungen || [])
                : (matching.topKonflikte || []);

            if (items.length === 0) {
                body.innerHTML = '<p style="color: var(--text-muted);">Keine Eintr√§ge vorhanden.</p>';
            } else {
                let html = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px;">
                        <div style="text-align: center; font-weight: 600; color: var(--success); font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">
                            ${ichName}
                        </div>
                        <div style="text-align: center; font-weight: 600; color: var(--danger); font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">
                            ${partnerName}
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                `;

                items.forEach(item => {
                    const label = TiageI18n.t(`needs.items.${item.id}`, item.label);
                    const wert1 = item.wert1 || 0;
                    const wert2 = item.wert2 || 0;
                    const diff = Math.abs(wert1 - wert2);

                    // Status-Icon und Farbe
                    let statusIcon, statusColor, statusText;
                    if (diff <= 15) {
                        statusIcon = '‚úì';
                        statusColor = '#22c55e';
                        statusText = '√úbereinstimmung';
                    } else if (diff <= 35) {
                        statusIcon = '~';
                        statusColor = '#eab308';
                        statusText = 'Komplement√§r';
                    } else {
                        statusIcon = '‚úó';
                        statusColor = '#ef4444';
                        statusText = 'Unterschied';
                    }

                    html += `
                        <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px; border-left: 3px solid ${statusColor};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                                <span style="font-weight: 500; color: var(--text-primary);">${label}</span>
                                <span style="color: ${statusColor}; font-size: 11px; font-weight: 600;">${statusIcon} ${statusText}</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="flex: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                                        <div style="width: ${wert1}%; height: 100%; background: var(--success); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px; text-align: right;">${wert1}%</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="flex: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                                        <div style="width: ${wert2}%; height: 100%; background: var(--danger); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-muted); min-width: 35px; text-align: right;">${wert2}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';

                // Info-Box hinzuf√ºgen
                const infoText = type === 'gemeinsam'
                    ? 'Gemeinsame Bed√ºrfnisse bilden das Fundament eurer Verbindung. Hier k√∂nnt ihr euch gegenseitig st√§rken.'
                    : 'Unterschiedliche Priorit√§ten zeigen Wachstumspotential. Diese Bereiche erfordern bewusste Kommunikation.';

                html += `
                    <div style="margin-top: 16px; padding: 12px; background: rgba(139,92,246,0.08); border-radius: 8px; border: 1px solid rgba(139,92,246,0.2);">
                        <p style="font-size: 12px; color: var(--text-secondary); margin: 0; line-height: 1.5;">${infoText}</p>
                    </div>
                `;

                body.innerHTML = html;
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        /**
         * Schlie√üt das Bed√ºrfnis-Vergleich Modal
         */
        function closeNeedsCompareModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('needsCompareModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // Aktueller Tab f√ºr das vollst√§ndige Modal
        let needsFullModalCurrentTab = 'gemeinsam';

        /**
         * √ñffnet das vollst√§ndige Bed√ºrfnis-Modal mit Toggle
         */
        function openNeedsFullModal() {
            needsFullModalCurrentTab = 'gemeinsam';
            renderNeedsFullModal();
        }

        /**
         * Wechselt den Tab im vollst√§ndigen Modal
         */
        function switchNeedsFullModalTab(tab) {
            needsFullModalCurrentTab = tab;
            renderNeedsFullModal();
        }

        /**
         * Rendert das vollst√§ndige Bed√ºrfnis-Modal
         */
        function renderNeedsFullModal() {
            const modal = document.getElementById('needsCompareModal');
            const body = document.getElementById('needsCompareModalBody');
            const title = document.getElementById('needsCompareModalTitle');

            if (!modal || !body) return;

            // Matching-Daten holen
            const ichArchetyp = (currentArchetype || '').replace('_', '-');
            const partnerArchetyp = (selectedPartner || '').replace('_', '-');

            if (!ichArchetyp || !partnerArchetyp || typeof GfkBeduerfnisse === 'undefined') {
                body.innerHTML = '<p style="color: var(--text-muted);">Keine Daten verf√ºgbar.</p>';
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                return;
            }

            const matching = GfkBeduerfnisse.berechneMatching(ichArchetyp, partnerArchetyp);
            const ichName = archetypeDefinitions[currentArchetype]?.name || 'ICH';
            const partnerName = archetypeDefinitions[selectedPartner]?.name || 'Partner';

            // Titel setzen
            title.textContent = 'Bed√ºrfnis-Vergleich';

            // Vollst√§ndige Listen aus details holen
            const type = needsFullModalCurrentTab;
            const items = type === 'gemeinsam'
                ? (matching.details?.uebereinstimmend || matching.topUebereinstimmungen || [])
                : (matching.details?.konflikt || matching.topKonflikte || []);

            // Toggle-Button HTML
            const toggleHtml = `
                <div style="display: flex; gap: 0; margin-bottom: 16px; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 4px;">
                    <button onclick="switchNeedsFullModalTab('gemeinsam')" style="flex: 1; padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; ${type === 'gemeinsam' ? 'background: #22c55e; color: white;' : 'background: transparent; color: var(--text-muted);'}">
                        Gemeinsame Bed√ºrfnisse
                    </button>
                    <button onclick="switchNeedsFullModalTab('unterschiedlich')" style="flex: 1; padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; transition: all 0.2s; ${type === 'unterschiedlich' ? 'background: #ef4444; color: white;' : 'background: transparent; color: var(--text-muted);'}">
                        Unterschiedliche Priorit√§ten
                    </button>
                </div>
            `;

            // Header mit Namen
            const headerHtml = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <div style="text-align: center; font-weight: 600; color: var(--success); font-size: 11px; text-transform: uppercase; letter-spacing: 1px;">
                        ${ichName}
                    </div>
                    <div style="text-align: center; font-weight: 600; color: var(--danger); font-size: 11px; text-transform: uppercase; letter-spacing: 1px;">
                        ${partnerName}
                    </div>
                </div>
            `;

            let listHtml = '';
            if (items.length === 0) {
                listHtml = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">Keine Eintr√§ge vorhanden.</p>';
            } else {
                listHtml = '<div style="display: flex; flex-direction: column; gap: 6px; max-height: 400px; overflow-y: auto;">';

                items.forEach(item => {
                    const label = TiageI18n.t(`needs.items.${item.id}`, item.label);
                    const wert1 = item.wert1 || 0;
                    const wert2 = item.wert2 || 0;
                    const diff = Math.abs(wert1 - wert2);

                    // Status-Icon und Farbe
                    let statusColor;
                    if (diff <= 15) {
                        statusColor = '#22c55e';
                    } else if (diff <= 35) {
                        statusColor = '#eab308';
                    } else {
                        statusColor = '#ef4444';
                    }

                    listHtml += `
                        <div style="background: rgba(255,255,255,0.03); border-radius: 6px; padding: 10px 12px; border-left: 3px solid ${statusColor};">
                            <div style="font-weight: 500; color: var(--text-primary); font-size: 13px; margin-bottom: 6px;">${label}</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="flex: 1; height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                                        <div style="width: ${wert1}%; height: 100%; background: var(--success); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-muted); min-width: 32px; text-align: right;">${wert1}%</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <div style="flex: 1; height: 5px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                                        <div style="width: ${wert2}%; height: 100%; background: var(--danger); border-radius: 3px;"></div>
                                    </div>
                                    <span style="font-size: 11px; color: var(--text-muted); min-width: 32px; text-align: right;">${wert2}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                listHtml += '</div>';
            }

            // Anzahl anzeigen
            const countHtml = `
                <div style="margin-top: 12px; text-align: center; font-size: 11px; color: var(--text-muted);">
                    ${items.length} ${type === 'gemeinsam' ? 'gemeinsame Bed√ºrfnisse' : 'unterschiedliche Priorit√§ten'}
                </div>
            `;

            body.innerHTML = toggleHtml + headerHtml + listHtml + countHtml;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        /**
         * Sync GFK UI across all views
         */
        function syncGfkUI(person) {
            const selected = personDimensions[person].gfk;

            // All GFK button selectors for this person
            const selectors = [
                `.gfk-grid[data-person="${person}"] .gfk-btn`,
                `#${person}-gfk-grid .gfk-btn`,
                `#mobile-${person}-gfk-grid .gfk-btn`
            ];

            selectors.forEach(selector => {
                document.querySelectorAll(selector).forEach(btn => {
                    const value = btn.dataset.value;

                    // Remove selection state
                    btn.classList.remove('selected', 'primary-selected');

                    // Add selected state if this is the chosen value
                    if (value === selected) {
                        btn.classList.add('selected', 'primary-selected');
                    }
                });
            });

            // Update summary text
            updateGfkSummary(person);
        }

        /**
         * Get GFK summary text
         */
        function getGfkSummary(person) {
            const gfk = personDimensions[person].gfk;
            if (!gfk) return 'GFK fehlt';
            return `GFK: ${gfk}`;
        }

        /**
         * Update GFK summary display
         */
        function updateGfkSummary(person) {
            const gfk = personDimensions[person].gfk;
            const isMissing = !gfk;

            // Update header element
            const headerId = `${person}-header-gfk`;
            const header = document.getElementById(headerId);
            if (header) {
                header.textContent = getGfkSummary(person);
                header.classList.toggle('missing', isMissing);
            }

            // Update grid collapsed-summary
            ['', 'mobile-'].forEach(prefix => {
                const summaryId = `${prefix}${person}-gfk-summary`;
                const summary = document.getElementById(summaryId);
                if (summary) {
                    summary.textContent = gfk ? `‚úì ${gfk}` : '';
                    summary.classList.toggle('has-selection', !isMissing);
                }
            });
        }

        // Helper: Check if GFK is selected
        function hasGfkSelected(person) {
            return personDimensions[person].gfk !== null;
        }

        // ========================================
        // GFK-Bed√ºrfnis-Matching (nach Marshall Rosenberg)
        // ========================================

        // Globale Variable f√ºr das letzte GFK-Matching-Ergebnis
        let lastGfkMatchingResult = null;

        /**
         * Berechnet das GFK-Bed√ºrfnis-Matching zwischen den ausgew√§hlten Profilen.
         * NEU v2.0: Ber√ºcksichtigt Archetyp + Dominanz + Geschlecht + Orientierung + Status
         *
         * Verwendet BeduerfnisModifikatoren f√ºr dynamische Profil-Berechnung
         */
        function updateGfkFromArchetypes() {
            if (typeof GfkBeduerfnisse === 'undefined') {
                console.warn('GFK: GfkBeduerfnisse nicht geladen');
                return;
            }

            const ichArchetype = currentArchetype;
            const partnerArchetype = selectedPartner;

            if (!ichArchetype || !partnerArchetype) return;

            // Archetyp-IDs normalisieren (duo_flex ‚Üí duo-flex)
            const ichNormalized = ichArchetype.replace('_', '-');
            const partnerNormalized = partnerArchetype.replace('_', '-');

            // Pr√ºfen ob BeduerfnisModifikatoren verf√ºgbar ist
            if (typeof BeduerfnisModifikatoren !== 'undefined' && GfkBeduerfnisse.archetypProfile) {
                // NEU: Dynamische Berechnung mit allen Dimensionen
                const matching = calculateDynamicBeduerfnisMatch(ichNormalized, partnerNormalized);
                if (matching) {
                    lastGfkMatchingResult = matching;
                    console.log(`GFK Bed√ºrfnis-Matching (dynamisch): ${ichNormalized} + ${partnerNormalized} ‚Üí Score=${matching.score}`);
                    console.log(`  Faktoren: Dominanz, Geschlecht, Orientierung ber√ºcksichtigt`);

                    // GFK-Level setzen (basierend auf Bed√ºrfnis-√úbereinstimmung)
                    personDimensions.ich.gfk = matching.level;
                    personDimensions.partner.gfk = matching.level;

                    // UI synchronisieren
                    syncGfkUI('ich');
                    syncGfkUI('partner');

                    // Bed√ºrfnis-Details anzeigen
                    updateGfkBeduerfnisDisplay(matching);
                    return;
                }
            }

            // Fallback: Altes System (nur Archetyp)
            const matching = GfkBeduerfnisse.berechneMatching(ichNormalized, partnerNormalized);

            if (matching.fehler) {
                console.warn('GFK Matching Fehler:', matching.fehler);
                return;
            }

            lastGfkMatchingResult = matching;

            console.log(`GFK Bed√ºrfnis-Matching (statisch): ${matching.archetyp1} + ${matching.archetyp2} ‚Üí Score=${matching.score} (${matching.level})`);

            // GFK-Level setzen (basierend auf Bed√ºrfnis-√úbereinstimmung)
            personDimensions.ich.gfk = matching.level;
            personDimensions.partner.gfk = matching.level;

            // UI synchronisieren
            syncGfkUI('ich');
            syncGfkUI('partner');

            // Bed√ºrfnis-Details anzeigen
            updateGfkBeduerfnisDisplay(matching);
        }

        /**
         * Berechnet dynamisches Bed√ºrfnis-Matching unter Ber√ºcksichtigung aller Dimensionen
         * @param {string} ichArchetyp - Normalisierter Archetyp-ID f√ºr "ich"
         * @param {string} partnerArchetyp - Normalisierter Archetyp-ID f√ºr "partner"
         * @returns {object|null} Matching-Ergebnis oder null bei Fehler
         */
        function calculateDynamicBeduerfnisMatch(ichArchetyp, partnerArchetyp) {
            // Basis-Bed√ºrfnisse laden
            const ichBasis = GfkBeduerfnisse.archetypProfile[ichArchetyp];
            const partnerBasis = GfkBeduerfnisse.archetypProfile[partnerArchetyp];

            if (!ichBasis || !ichBasis.kernbeduerfnisse || !partnerBasis || !partnerBasis.kernbeduerfnisse) {
                console.warn('Archetyp-Basis nicht gefunden:', ichArchetyp, partnerArchetyp);
                return null;
            }

            // Helper: Geschlecht extrahieren (primary)
            const extractGeschlecht = (g) => {
                if (!g) return 'divers';
                if (typeof g === 'string') return g;
                if (typeof g === 'object') return g.primary || 'divers';
                return 'divers';
            };

            // Helper: Geschlecht Secondary extrahieren
            const extractGeschlechtSecondary = (g) => {
                if (!g || typeof g !== 'object') return null;
                return g.secondary || null;
            };

            // Helper: Dominanz extrahieren
            const extractDominanz = (d) => {
                if (!d) return 'ausgeglichen';
                if (typeof d === 'string') return d;
                if (typeof d === 'object') return d.primary || 'ausgeglichen';
                return 'ausgeglichen';
            };

            // Helper: Orientierung extrahieren
            const extractOrientierung = (o) => {
                if (!o) return 'heterosexuell';
                if (typeof o === 'string') return o;
                if (typeof o === 'object') return o.primary || 'heterosexuell';
                return 'heterosexuell';
            };

            // Dimensionen f√ºr "ich" sammeln
            const ichDims = personDimensions.ich;
            const ichParams = {
                basisBed√ºrfnisse: ichBasis.kernbeduerfnisse,
                dominanz: extractDominanz(ichDims.dominanz),
                dominanzStatus: ichDims.dominanzStatus || 'gelebt',
                geschlechtPrimary: extractGeschlecht(ichDims.geschlecht),
                geschlechtPrimaryStatus: 'gelebt',
                geschlechtSecondary: extractGeschlechtSecondary(ichDims.geschlecht),
                geschlechtSecondaryStatus: 'gelebt',
                orientierung: extractOrientierung(ichDims.orientierung),
                orientierungStatus: ichDims.orientierungStatus || 'gelebt'
            };

            // Dimensionen f√ºr "partner" sammeln
            const partnerDims = personDimensions.partner;
            const partnerParams = {
                basisBed√ºrfnisse: partnerBasis.kernbeduerfnisse,
                dominanz: extractDominanz(partnerDims.dominanz),
                dominanzStatus: partnerDims.dominanzStatus || 'gelebt',
                geschlechtPrimary: extractGeschlecht(partnerDims.geschlecht),
                geschlechtPrimaryStatus: 'gelebt',
                geschlechtSecondary: extractGeschlechtSecondary(partnerDims.geschlecht),
                geschlechtSecondaryStatus: 'gelebt',
                orientierung: extractOrientierung(partnerDims.orientierung),
                orientierungStatus: partnerDims.orientierungStatus || 'gelebt'
            };

            // Debug-Log
            console.log('Bed√ºrfnis-Berechnung mit Dimensionen:', {
                ich: { archetyp: ichArchetyp, dominanz: ichParams.dominanz, geschlecht: ichParams.geschlechtPrimary, orientierung: ichParams.orientierung },
                partner: { archetyp: partnerArchetyp, dominanz: partnerParams.dominanz, geschlecht: partnerParams.geschlechtPrimary, orientierung: partnerParams.orientierung }
            });

            // Vollst√§ndige Bed√ºrfnis-Profile berechnen
            const ichProfil = BeduerfnisModifikatoren.berechneVollst√§ndigesBed√ºrfnisProfil(ichParams);
            const partnerProfil = BeduerfnisModifikatoren.berechneVollst√§ndigesBed√ºrfnisProfil(partnerParams);

            // √úbereinstimmung berechnen
            const result = BeduerfnisModifikatoren.berechne√úbereinstimmung(ichProfil, partnerProfil);

            // Level basierend auf Score bestimmen
            let level = 'niedrig';
            if (result.score >= 70) level = 'hoch';
            else if (result.score >= 40) level = 'mittel';

            // Ergebnis im erwarteten Format zur√ºckgeben
            return {
                score: result.score,
                level: level,
                archetyp1: ichArchetyp,
                archetyp2: partnerArchetyp,
                // Konvertiere zu erwarteten Strukturen f√ºr updateGfkBeduerfnisDisplay
                topUebereinstimmungen: result.gemeinsam.slice(0, 5).map(b => ({
                    label: formatBeduerfnisLabel(b.bed√ºrfnis),
                    key: b.bed√ºrfnis,
                    wert1: b.wert1,
                    wert2: b.wert2
                })),
                topKonflikte: result.unterschiedlich.slice(0, 5).map(b => ({
                    label: formatBeduerfnisLabel(b.bed√ºrfnis),
                    key: b.bed√ºrfnis,
                    wert1: b.wert1,
                    wert2: b.wert2
                })),
                komplementaer: result.komplementaer.slice(0, 5).map(b => ({
                    label: formatBeduerfnisLabel(b.bed√ºrfnis),
                    key: b.bed√ºrfnis,
                    wert1: b.wert1,
                    wert2: b.wert2
                })),
                // Zus√§tzliche Details
                profile: {
                    ich: ichProfil,
                    partner: partnerProfil
                },
                dynamisch: true
            };
        }

        /**
         * Formatiert Bed√ºrfnis-Keys in lesbare Labels
         */
        function formatBeduerfnisLabel(key) {
            if (!key) return '';
            // Underscore zu Leerzeichen, erster Buchstabe gro√ü
            return key.replace(/_/g, ' ')
                      .replace(/ae/g, '√§')
                      .replace(/oe/g, '√∂')
                      .replace(/ue/g, '√º')
                      .split(' ')
                      .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                      .join(' ');
        }

        /**
         * Zeigt die Bed√ºrfnis-Matching-Details in der UI an
         */
        function updateGfkBeduerfnisDisplay(matching) {
            const container = document.getElementById('gfk-beduerfnis-display');
            const mobileContainer = document.getElementById('mobile-gfk-beduerfnis-display');

            // Mindestens ein Container muss existieren
            if (!container && !mobileContainer) return;

            // Container sichtbar machen
            if (container) container.style.display = 'block';
            if (mobileContainer) mobileContainer.style.display = 'block';

            // Score-Farbe basierend auf Level
            const scoreColor = matching.level === 'hoch' ? '#22c55e' :
                              matching.level === 'mittel' ? '#eab308' : '#ef4444';

            // HTML generieren
            const beduerfnisLabel = TiageI18n.t('synthesisSection.beduerfnisUebereinstimmung', 'Bed√ºrfnis-√úbereinstimmung');
            let html = `
                <div class="gfk-matching-header" onclick="openNeedsFullModal()" style="cursor: pointer;" title="Klicken f√ºr vollst√§ndige Liste">
                    <div class="gfk-score-display">
                        <span class="gfk-score" style="color: ${scoreColor}">${matching.score}%</span>
                        <span class="gfk-level-label">${beduerfnisLabel}</span>
                    </div>
                </div>
            `;

            // Top √úbereinstimmungen
            if (matching.topUebereinstimmungen && matching.topUebereinstimmungen.length > 0) {
                const gemeinsameLabel = TiageI18n.t('synthesisSection.gemeinsameBeduerfnisse', 'Gemeinsame Bed√ºrfnisse');
                html += `
                    <div class="gfk-section gfk-matches">
                        <div class="gfk-section-title" style="color: #22c55e;">${TiageI18n.t('needs.sharedTitle', 'GEMEINSAME BED√úRFNISSE')}</div>
                        <div class="gfk-tags">
                            ${matching.topUebereinstimmungen.map(b => {
                                const translatedLabel = TiageI18n.t(`needs.items.${b.id}`, b.label);
                                return `<span class="gfk-tag gfk-tag-match">${translatedLabel}</span>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            // Konflikte
            if (matching.topKonflikte && matching.topKonflikte.length > 0) {
                const unterschiedlicheLabel = TiageI18n.t('synthesisSection.unterschiedlichePrioritaeten', 'Unterschiedliche Priorit√§ten');
                html += `
                    <div class="gfk-section gfk-conflicts">
                        <div class="gfk-section-title" style="color: #ef4444;">${TiageI18n.t('needs.differentTitle', 'UNTERSCHIEDLICHE PRIORIT√ÑTEN')}</div>
                        <div class="gfk-tags">
                            ${matching.topKonflikte.map(b => {
                                const translatedLabel = TiageI18n.t(`needs.items.${b.id}`, b.label);
                                return `<span class="gfk-tag gfk-tag-conflict" title="${matching.archetyp1}: ${b.wert1}% | ${matching.archetyp2}: ${b.wert2}%">${translatedLabel}</span>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }

            // Desktop und Mobile Container aktualisieren
            if (container) container.innerHTML = html;
            if (mobileContainer) mobileContainer.innerHTML = html;
        }

        /**
         * Gibt die Top-Bed√ºrfnisse f√ºr einen Archetyp zur√ºck
         */
        function getArchetypBeduerfnisse(archetyp) {
            if (typeof GfkBeduerfnisse === 'undefined') return [];
            const normalized = archetyp.replace('_', '-');
            return GfkBeduerfnisse.getTopBeduerfnisse(normalized, 5);
        }

        // ========================================
        // Desktop Selection Info Message
        // ========================================
        // Helper function to get geschlecht value from both string and object formats
        function getGeschlechtValue(g) {
            if (!g) return null;
            if (typeof g === 'string') return g;
            if (typeof g === 'object' && g.primary) return g.primary;
            return null;
        }

        function updateSelectionInfoMessage() {
            const infoElement = document.getElementById('desktopSelectionInfo');
            if (!infoElement) return;

            const missing = [];

            // Check ICH
            const ichMissing = [];
            if (!getGeschlechtValue(personDimensions.ich.geschlecht)) ichMissing.push('Geschlecht');
            if (!hasAnyDominanzSelected('ich')) ichMissing.push('Dominanz');
            if (!hasAnyOrientierungSelected('ich')) ichMissing.push('Orientierung');
            if (ichMissing.length > 0) {
                missing.push('DU: ' + ichMissing.join(', '));
            }

            // Check Partner
            const partnerMissing = [];
            if (!getGeschlechtValue(personDimensions.partner.geschlecht)) partnerMissing.push('Geschlecht');
            if (!hasAnyDominanzSelected('partner')) partnerMissing.push('Dominanz');
            if (!hasAnyOrientierungSelected('partner')) partnerMissing.push('Orientierung');
            if (partnerMissing.length > 0) {
                missing.push('PARTNER: ' + partnerMissing.join(', '));
            }

            // Update display
            if (missing.length > 0) {
                infoElement.textContent = 'Fehlende Auswahl - ' + missing.join(' | ');
                infoElement.classList.add('visible');
            } else {
                infoElement.textContent = '';
                infoElement.classList.remove('visible');
            }
        }

        function handleDimensionChange(person, dimension, value, element) {
            // Update state
            personDimensions[person][dimension] = value;

            // Remove needs-selection class from the parent group
            if (element) {
                const dimensionGroup = element.closest('.dimension-group, .dimension-status-group');
                if (dimensionGroup) {
                    dimensionGroup.classList.remove('needs-selection');
                }
            }

            // Visual feedback - highlight animation
            if (element) {
                const label = element.nextElementSibling;
                if (label) {
                    label.classList.add('highlight-change');
                    setTimeout(() => label.classList.remove('highlight-change'), 300);
                }
            }

            // Update overview box
            updateAnalysisOverview();

            // Re-run compatibility checks when dimensions change
            if (data) {
                updatePartnerView();
            }
        }

        function getGeschlechtKurz(geschlecht) {
            if (!geschlecht) return '?';

            // Neues Format: { primary, secondary }
            let primary = geschlecht;
            let secondary = null;
            if (typeof geschlecht === 'object') {
                primary = geschlecht.primary;
                secondary = geschlecht.secondary;
            }

            if (!primary) return '?';

            // Nutze TiageConfig wenn verf√ºgbar
            const getShort = (g) => {
                if (typeof TiageConfig !== 'undefined' && TiageConfig.GESCHLECHT_SHORT) {
                    return TiageConfig.GESCHLECHT_SHORT[g] || g;
                }
                // Fallback-Map
                const map = {
                    'cis_mann': 'CM',
                    'cis_frau': 'CF',
                    'trans_mann': 'TM',
                    'trans_frau': 'TF',
                    'nonbinaer': 'NB',
                    'genderfluid': 'GF',
                    'agender': 'AG',
                    'intersex': 'IS',
                    'divers': 'DI',
                    // Legacy-Support
                    'm√§nnlich': 'M',
                    'weiblich': 'W',
                    'non-bin√§r': 'NB'
                };
                return map[g] || g;
            };

            // Prim√§r + optional Sekund√§r anzeigen
            let result = getShort(primary);
            if (secondary) {
                result += '/' + getShort(secondary);
            }
            return result;
        }

        function getGeschlechtVoll(geschlecht) {
            if (!geschlecht) return null;

            let primary = geschlecht;
            let secondary = null;
            if (typeof geschlecht === 'object') {
                primary = geschlecht.primary;
                secondary = geschlecht.secondary;
            }

            if (!primary) return null;

            // Nutze i18n wenn verf√ºgbar, sonst Fallback-Map
            const getName = (g) => {
                if (typeof TiageI18n !== 'undefined') {
                    return TiageI18n.t(`geschlecht.types.${g}`, g);
                }
                // Fallback-Map
                const map = {
                    'cis_mann': 'Cis Mann',
                    'cis_frau': 'Cis Frau',
                    'trans_mann': 'Trans Mann',
                    'trans_frau': 'Trans Frau',
                    'nonbinaer': 'Nonbin√§r',
                    'genderfluid': 'Genderfluid',
                    'agender': 'Agender',
                    'intersex': 'Intersex',
                    'divers': 'Divers',
                    'm√§nnlich': 'Mann',
                    'weiblich': 'Frau',
                    'non-bin√§r': 'Nonbin√§r'
                };
                return map[g] || g;
            };

            let result = getName(primary);
            if (secondary) {
                result += ' (' + getName(secondary) + ')';
            }
            return result;
        }

        function getGeschlechtCategory(geschlecht) {
            // Extract primary gender from object format { primary: 'cis_mann', secondary: null }
            if (geschlecht && typeof geschlecht === 'object' && 'primary' in geschlecht) {
                geschlecht = geschlecht.primary;
            }
            // Gibt die Kategorie f√ºr Orientierungslogik zur√ºck
            if (typeof TiageConfig !== 'undefined' && TiageConfig.GESCHLECHT_CATEGORY) {
                return TiageConfig.GESCHLECHT_CATEGORY[geschlecht] || 'andere';
            }
            const map = {
                'cis_mann': 'maennlich',
                'cis_frau': 'weiblich',
                'trans_mann': 'maennlich',
                'trans_frau': 'weiblich',
                'nonbinaer': 'nonbinaer',
                'genderfluid': 'fluid',
                'agender': 'agender',
                // Legacy-Support
                'm√§nnlich': 'maennlich',
                'weiblich': 'weiblich',
                'non-bin√§r': 'nonbinaer'
            };
            return map[geschlecht] || 'andere';
        }

        function getDominanzKurz(dominanz) {
            // Handle multi-select object
            if (dominanz && typeof dominanz === 'object') {
                const parts = [];
                const map = { 'dominant': 'dom', 'submissiv': 'sub', 'switch': 'sw', 'ausgeglichen': 'ausg' };

                // New Primary/Secondary structure
                if ('primary' in dominanz) {
                    if (dominanz.primary) {
                        parts.push(map[dominanz.primary] || dominanz.primary);
                    }
                    if (dominanz.secondary) {
                        parts.push((map[dominanz.secondary] || dominanz.secondary) + '?');
                    }
                    return parts.length > 0 ? parts.join('+') : '?';
                }

                // Old format: { dominant: 'gelebt', submissiv: 'interessiert' }
                for (const [type, status] of Object.entries(dominanz)) {
                    if (status) {
                        let kurz = map[type] || type;
                        if (status === 'interessiert') kurz += '?';
                        parts.push(kurz);
                    }
                }

                return parts.length > 0 ? parts.join('+') : '?';
            }

            // Old single-value format (backwards compatibility)
            if (!dominanz) return '?';
            const map = {
                'dominant': 'dom',
                'submissiv': 'sub',
                'switch': 'sw',
                'ausgeglichen': 'ausg'
            };
            return map[dominanz] || dominanz;
        }

        function getOrientierungKurz(orientierung, status) {
            // Handle multi-select orientierung object
            if (orientierung && typeof orientierung === 'object') {
                const map = {
                    'heterosexuell': 'het',
                    'homosexuell': 'hom',
                    'bisexuell': 'bi'
                };
                const parts = [];
                // New Primary/Secondary structure
                if (orientierung.primary) {
                    parts.push(map[orientierung.primary] || orientierung.primary);
                }
                if (orientierung.secondary) {
                    parts.push(map[orientierung.secondary] || orientierung.secondary);
                }
                return parts.length > 0 ? parts.join('/') : '?';
            }

            // Backwards compatibility for old single-value format
            if (!orientierung) return '?';
            const map = {
                'heterosexuell': 'hetero',
                'homosexuell': 'homo',
                'bisexuell': 'bi'
            };
            let kurz = map[orientierung] || orientierung;
            if (status === 'interessiert') {
                kurz += '(?)';
            }
            return kurz;
        }

        function updateAnalysisOverview() {
            const ichType = data?.archetypes[currentArchetype]?.name || currentArchetype;
            const partnerType = data?.archetypes[selectedPartner]?.name || selectedPartner;

            const ichDims = personDimensions.ich;
            const partnerDims = personDimensions.partner;

            // Voller Geschlechtsname mit sekund√§rem in Klammern
            const ichGeschlecht = getGeschlechtVoll(ichDims.geschlecht);
            const partnerGeschlecht = getGeschlechtVoll(partnerDims.geschlecht);

            const ichInfo = `(${getDominanzKurz(ichDims.dominanz)}, ${getOrientierungKurz(ichDims.orientierung, ichDims.orientierungStatus)})`;
            const partnerInfo = `(${getDominanzKurz(partnerDims.dominanz)}, ${getOrientierungKurz(partnerDims.orientierung, partnerDims.orientierungStatus)})`;

            const content = document.getElementById('analysisOverviewContent');
            if (content) {
                // Nutze i18n f√ºr "Du:" / "You:"
                const youALabel = typeof TiageI18n !== 'undefined' ? TiageI18n.t('analysisOverview.youA', 'Du:') : 'Du:';
                const ichGeschlechtHtml = ichGeschlecht ? `<span class="geschlecht-info">${youALabel} ${ichGeschlecht}</span>` : '';
                const partnerGeschlechtHtml = partnerGeschlecht ? `<span class="geschlecht-info">${partnerGeschlecht}</span>` : '';

                content.innerHTML = `
                    <span class="type-name">${ichType}</span> ${ichGeschlechtHtml} <span class="dim-info">${ichInfo}</span>
                    <span> √ó </span>
                    <span class="type-name">${partnerType}</span> ${partnerGeschlechtHtml} <span class="dim-info">${partnerInfo}</span>
                `;
            }
        }

        // Make function globally available for i18n updates
        window.updateAnalysisOverview = updateAnalysisOverview;

        function initDimensionListeners() {
            // ICH dimensions
            document.querySelectorAll('input[name="ich-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('ich', 'geschlecht', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="ich-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleDominanzClick('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('ich', 'dominanzStatus', e.target.value, e.target));
            });

            // PARTNER dimensions
            document.querySelectorAll('input[name="partner-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('partner', 'geschlecht', e.target.value, e.target));
            });
            document.querySelectorAll('input[name="partner-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const dimensionGroup = e.target.closest('.dimension-group');
                    if (dimensionGroup) dimensionGroup.classList.remove('needs-selection');
                    handleDominanzClick('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => handleDimensionChange('partner', 'dominanzStatus', e.target.value, e.target));
            });
        }

        // ========================================
        // Pathos/Logos Check System
        // ========================================

        function checkPhysicalCompatibility(person1, person2) {
            // Extract primary gender from object format { primary: 'cis_mann', secondary: null }
            let g1 = person1.geschlecht;
            let g2 = person2.geschlecht;

            if (g1 && typeof g1 === 'object' && 'primary' in g1) {
                g1 = g1.primary;
            }
            if (g2 && typeof g2 === 'object' && 'primary' in g2) {
                g2 = g2.primary;
            }

            // Get orientierung as multi-select object
            const ori1 = person1.orientierung;
            const ori2 = person2.orientierung;

            // Collect all missing items
            const missingItems = [];

            if (!g1) missingItems.push('Ich: Geschlecht');
            if (!g2) missingItems.push('Partner: Geschlecht');

            // Handle multi-select orientierung
            const oriList1 = [];
            const oriList2 = [];

            if (ori1 && typeof ori1 === 'object') {
                // New format: { primary: 'homosexuell', secondary: 'heterosexuell' }
                if ('primary' in ori1) {
                    if (ori1.primary) oriList1.push({ type: ori1.primary, status: 'gelebt' });
                    if (ori1.secondary) oriList1.push({ type: ori1.secondary, status: 'interessiert' });
                } else {
                    // Old format: { heterosexuell: 'gelebt', homosexuell: 'interessiert' }
                    if (ori1.heterosexuell) oriList1.push({ type: 'heterosexuell', status: ori1.heterosexuell });
                    if (ori1.homosexuell) oriList1.push({ type: 'homosexuell', status: ori1.homosexuell });
                    if (ori1.bisexuell) oriList1.push({ type: 'bisexuell', status: ori1.bisexuell });
                }
            } else if (ori1 && typeof ori1 === 'string') {
                // Backwards compatibility for old single-value format
                oriList1.push({ type: ori1, status: person1.orientierungStatus || 'gelebt' });
            }

            if (ori2 && typeof ori2 === 'object') {
                // New format: { primary: 'homosexuell', secondary: 'heterosexuell' }
                if ('primary' in ori2) {
                    if (ori2.primary) oriList2.push({ type: ori2.primary, status: 'gelebt' });
                    if (ori2.secondary) oriList2.push({ type: ori2.secondary, status: 'interessiert' });
                } else {
                    // Old format: { heterosexuell: 'gelebt', homosexuell: 'interessiert' }
                    if (ori2.heterosexuell) oriList2.push({ type: 'heterosexuell', status: ori2.heterosexuell });
                    if (ori2.homosexuell) oriList2.push({ type: 'homosexuell', status: ori2.homosexuell });
                    if (ori2.bisexuell) oriList2.push({ type: 'bisexuell', status: ori2.bisexuell });
                }
            } else if (ori2 && typeof ori2 === 'string') {
                // Backwards compatibility for old single-value format
                oriList2.push({ type: ori2, status: person2.orientierungStatus || 'gelebt' });
            }

            // Check if orientierung is missing
            if (oriList1.length === 0) missingItems.push('Ich: Orientierung');
            if (oriList2.length === 0) missingItems.push('Partner: Orientierung');

            // Return incomplete if any items are missing
            if (missingItems.length > 0) {
                return {
                    result: 'unvollst√§ndig',
                    reason: 'Dimensionen unvollst√§ndig',
                    explanation: 'Es fehlt noch: ' + missingItems.join(', '),
                    missingItems: missingItems
                };
            }

            // Check all combinations
            let hasPossible = false;
            let hasUnsicher = false;
            let hasInteressiert = false;

            for (const o1 of oriList1) {
                for (const o2 of oriList2) {
                    const result = checkSingleOrientationPair(o1.type, o1.status, o2.type, o2.status, g1, g2);

                    if (result === 'm√∂glich') {
                        hasPossible = true;
                    } else if (result === 'unsicher') {
                        hasUnsicher = true;
                    }

                    if (o1.status === 'interessiert' || o2.status === 'interessiert') {
                        hasInteressiert = true;
                    }
                }
            }

            // Return best result
            if (hasPossible && !hasInteressiert) {
                return { result: 'm√∂glich', confidence: 'hoch' };
            }

            if (hasPossible && hasInteressiert) {
                return {
                    result: 'unsicher',
                    confidence: 'mittel',
                    explanation: 'Anziehung m√∂glich, aber mindestens eine Person ist in der Explorationsphase.',
                    note: 'Status "Interessiert" bedeutet Exploration'
                };
            }

            if (hasUnsicher) {
                return {
                    result: 'unsicher',
                    confidence: 'niedrig',
                    explanation: 'Anziehung ist theoretisch m√∂glich, aber unsicher.',
                    note: 'Exploration-Phase'
                };
            }

            return {
                result: 'unm√∂glich',
                reason: 'Inkompatible Orientierungen',
                explanation: 'Die sexuellen Orientierungen schlie√üen gegenseitige Anziehung aus.'
            };
        }

        // Helper: Check if gender is male category (includes cis and trans)
        function isMaleGender(gender) {
            if (!gender) return false;
            const g = gender.toLowerCase();
            return g === 'm√§nnlich' || g === 'cis_mann' || g === 'trans_mann' ||
                   g === 'mann' || g === 'male' || g === 'm';
        }

        // Helper: Check if gender is female category (includes cis and trans)
        function isFemaleGender(gender) {
            if (!gender) return false;
            const g = gender.toLowerCase();
            return g === 'weiblich' || g === 'cis_frau' || g === 'trans_frau' ||
                   g === 'frau' || g === 'female' || g === 'w' || g === 'f';
        }

        // Helper: Check if two genders are in the same category
        function isSameGenderCategory(g1, g2) {
            if (isMaleGender(g1) && isMaleGender(g2)) return true;
            if (isFemaleGender(g1) && isFemaleGender(g2)) return true;
            // Non-binary/other: compare directly
            return g1 === g2;
        }

        // Helper: Check if two genders are in different binary categories (male vs female)
        function isDifferentBinaryGender(g1, g2) {
            return (isMaleGender(g1) && isFemaleGender(g2)) ||
                   (isFemaleGender(g1) && isMaleGender(g2));
        }

        // Helper: Check single pair of orientations
        function checkSingleOrientationPair(type1, status1, type2, status2, g1, g2) {
            // Bisexuell is always compatible
            if (type1 === 'bisexuell' || type2 === 'bisexuell') {
                return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'm√∂glich';
            }

            // Both heterosexuell - need different gender categories (male + female)
            if (type1 === 'heterosexuell' && type2 === 'heterosexuell') {
                if (isDifferentBinaryGender(g1, g2)) {
                    return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'm√∂glich';
                } else {
                    return 'unm√∂glich'; // Same gender category, both hetero
                }
            }

            // Both homosexuell - need same gender category
            if (type1 === 'homosexuell' && type2 === 'homosexuell') {
                if (isSameGenderCategory(g1, g2)) {
                    return (status1 === 'interessiert' || status2 === 'interessiert') ? 'unsicher' : 'm√∂glich';
                } else {
                    return 'unm√∂glich'; // Different gender category, both homo
                }
            }

            // Mixed: hetero + homo - check if exploring
            if (status1 === 'interessiert' || status2 === 'interessiert') {
                return 'unsicher'; // Exploration could change things
            }
            return 'unm√∂glich';
        }

        function calculatePhilosophyCompatibility(type1, type2) {
            // Get the philosophy score (Category A) from the matrix
            const key = `${type1}_${type2}`;
            const interaction = data?.interactions[key];

            if (interaction && interaction.scores && interaction.scores.A) {
                return {
                    score: interaction.scores.A.value,
                    note: interaction.scores.A.note
                };
            }

            // Fallback if not found
            return { score: 50, note: 'Keine spezifischen Daten verf√ºgbar' };
        }

        function formatPersonSummary(person) {
            // Extract primary gender from object format { primary: 'cis_mann', secondary: null }
            let geschlecht = person.geschlecht || '?';
            if (geschlecht && typeof geschlecht === 'object' && 'primary' in geschlecht) {
                geschlecht = geschlecht.primary || '?';
            }

            // Handle Primary/Secondary orientierung structure
            let orientierungStr = '?';
            if (person.orientierung && typeof person.orientierung === 'object') {
                const parts = [];
                if (person.orientierung.primary) {
                    parts.push(person.orientierung.primary + ' (I)');
                }
                if (person.orientierung.secondary) {
                    parts.push(person.orientierung.secondary + ' (G)');
                }
                orientierungStr = parts.length > 0 ? parts.join(', ') : '?';
            } else if (person.orientierung) {
                // Backwards compatibility for old single-value format
                orientierungStr = person.orientierung;
            }

            return `${geschlecht}, ${orientierungStr}`;
        }

        function runCompatibilityChecks() {
            const person1 = {
                archetyp: currentArchetype,
                ...personDimensions.ich
            };
            const person2 = {
                archetyp: selectedPartner,
                ...personDimensions.partner
            };

            // Reset all warnings
            document.getElementById('pathosBlocker').classList.remove('active');
            document.getElementById('logosWarning').classList.remove('active');
            document.getElementById('pathosUncertain').classList.remove('active');
            document.getElementById('doubleWarning').classList.remove('active');
            document.getElementById('compatibilityContent').style.display = 'block';

            // 1. PATHOS CHECK
            const pathosCheck = checkPhysicalCompatibility(person1, person2);

            if (pathosCheck.result === 'unvollst√§ndig') {
                // Show Pathos Uncertain with incomplete message
                document.getElementById('pathosUncertain').classList.add('active');
                document.getElementById('pathosUncertainText').textContent =
                    pathosCheck.explanation;
                // Continue showing compatibility content since it's just incomplete
            }

            if (pathosCheck.result === 'unm√∂glich') {
                // SANFTER HINWEIS statt K.O.-Blocker
                // Zeige Warnung, aber blockiere nicht mehr
                document.getElementById('pathosBlocker').classList.add('active');
                // Content wird NICHT mehr versteckt - zeige den (niedrigen) Score
                // document.getElementById('compatibilityContent').style.display = 'none';

                document.getElementById('pathosBlockerReason').textContent =
                    `Hinweis: ${pathosCheck.reason} ‚Äì Resonanz ist sehr niedrig, aber nicht unm√∂glich.`;
                document.getElementById('pathosBlockerPerson1').textContent =
                    formatPersonSummary(person1);
                document.getElementById('pathosBlockerPerson2').textContent =
                    formatPersonSummary(person2);

                // Kein return mehr - weitermachen mit niedriger Resonanz!
                // return { blocked: true, reason: 'pathos' };
            }

            // 2. LOGOS CHECK
            const logosCheck = calculatePhilosophyCompatibility(person1.archetyp, person2.archetyp);
            const hasLogosWarning = logosCheck.score < 50;
            const hasPathosUncertain = pathosCheck.result === 'unsicher';

            // Handle different warning combinations
            if (hasPathosUncertain && hasLogosWarning) {
                // Double Warning
                document.getElementById('doubleWarning').classList.add('active');
                document.getElementById('doubleWarningPathos').textContent =
                    `${person2.orientierung} (${person2.orientierungStatus}) ‚Üí Exploration-Phase`;
                document.getElementById('doubleWarningLogos').textContent =
                    `Beziehungsphilosophie: ${logosCheck.score} ‚Üí ${data?.archetypes[person1.archetyp]?.name || person1.archetyp} vs. ${data?.archetypes[person2.archetyp]?.name || person2.archetyp}`;
            } else {
                // Single warnings
                if (hasLogosWarning) {
                    document.getElementById('logosWarning').classList.add('active');
                    const warningTitle = logosCheck.score < 30
                        ? 'Verstandsebene-Warnung: Fundamentale philosophische Unterschiede'
                        : 'Verstandsebene-Hinweis: Unterschiedliche philosophische Ans√§tze';
                    document.getElementById('logosWarningTitle').textContent = warningTitle;
                    document.getElementById('logosWarningSubtitle').textContent =
                        `Beziehungsphilosophie: ${logosCheck.score}`;
                    document.getElementById('logosWarningScore').textContent = `${logosCheck.score}`;
                    document.getElementById('logosWarningText').textContent = logosCheck.score < 30
                        ? 'Eure Grund√ºberzeugungen √ºber Beziehungen sind sehr unterschiedlich. Dies erfordert intensive Kommunikation und Kompromissbereitschaft.'
                        : 'Ihr habt verschiedene Vorstellungen von Beziehungen. Offene Kommunikation ist wichtig.';
                }

                if (hasPathosUncertain) {
                    document.getElementById('pathosUncertain').classList.add('active');
                    document.getElementById('pathosUncertainText').textContent =
                        `Mindestens eine Person ist in der Explorationsphase (Status: "Interessiert"). Die tats√§chliche k√∂rperliche Anziehung ist noch unklar.`;
                }
            }

            // 3. DISPLAY DIMENSION MODIFIERS
            const modifierSummaries = getModifierSummary(person1, person2);
            const modifierSummaryEl = document.getElementById('modifierSummary');
            const modifierContentEl = document.getElementById('modifierSummaryContent');

            if (modifierSummaries.length > 0) {
                modifierSummaryEl.classList.add('active');
                modifierContentEl.innerHTML = modifierSummaries.map(mod => {
                    const sign = mod.modifier > 0 ? '+' : '';
                    const modClass = mod.modifier > 0 ? 'positive' : (mod.modifier < 0 ? 'negative' : 'neutral');
                    const icon = mod.modifier > 0 ? '‚Üë' : (mod.modifier < 0 ? '‚Üì' : '‚Üí');
                    return `
                        <div class="modifier-summary-item">
                            <span class="modifier-icon">${icon}</span>
                            <span>${mod.description}</span>
                            <span class="modifier-badge ${modClass}">${sign}${mod.modifier}%</span>
                        </div>
                    `;
                }).join('');
            } else {
                modifierSummaryEl.classList.remove('active');
            }

            return {
                blocked: false,
                pathosCheck,
                logosCheck,
                warnings: { hasLogosWarning, hasPathosUncertain },
                modifiers: modifierSummaries
            };
        }

        function toggleLogosWarning() {
            const warning = document.getElementById('logosWarning');
            warning.classList.toggle('expanded');
        }

        function showPathosLogosInfo() {
            // Show info modal about Pathos vs Logos
            const title = 'Pathos vs. Logos';
            const content = `
                <div style="line-height: 1.6;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">GEF√úHLSEBENE (Emotion/K√∂rper)</h4>
                    <ul style="margin-bottom: 15px; padding-left: 20px;">
                        <li>K√∂rperliche und emotionale Anziehung</li>
                        <li>Sexuelle Orientierung</li>
                        <li>Nicht durch Lernen oder Kommunikation ver√§nderbar</li>
                        <li><strong>Ohne Gef√ºhlsebene:</strong> Keine romantische Beziehung m√∂glich</li>
                    </ul>

                    <h4 style="color: var(--warning); margin-bottom: 10px;">VERSTANDSEBENE (Philosophie/√úberzeugungen)</h4>
                    <ul style="margin-bottom: 15px; padding-left: 20px;">
                        <li>Beziehungsphilosophie und rationale √úberzeugungen</li>
                        <li>√úberzeugungen und Werte</li>
                        <li>Kann durch Kommunikation und Lernen ver√§ndert werden</li>
                        <li><strong>Ohne Verstandsebene:</strong> Schwierige, aber m√∂gliche Beziehung</li>
                    </ul>

                    <p style="font-style: italic; color: var(--text-muted);">
                        "Die Gef√ºhlsebene ist das Fundament - ohne k√∂rperliche Anziehung kann keine romantische Beziehung entstehen. Die Verstandsebene ist das Dach - es sch√ºtzt und strukturiert, kann aber umgebaut werden."
                    </p>
                </div>
            `;

            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('categoryModal').classList.add('active');
        }

        // ========================================
        // Dimensions Modifiers System
        // ========================================

        // Tag dimension relevance mapping
        const tagDimensionRelevance = {
            // KATEGORIE A: Beziehungsphilosophie - KEINE Dimensions-Einfl√ºsse!
            "exklusivitaets-erwartung": [],
            "offenheit-fuer-alternative-modelle": [],
            "beziehung-als-lebensinhalt": [],
            "primaerbeziehung-konzept": [],
            "commitment-tiefe": [],

            // KATEGORIE B: Werte-Alignment
            "fuehrung-und-initiative": ["dominanz"],
            "macht-balance": ["dominanz"],
            "emotionale-reziprozitaet": [],
            "eifersucht-umgang": [],
            "konfliktloesung": ["dominanz"],
            "emotionale-tiefe": [],

            // KATEGORIE C: N√§he-Distanz
            "entscheidungsfindung": ["dominanz"],
            "alltags-organisation": ["dominanz"],
            "autonomie-vs-gemeinsame-zeit": [],
            "finanzielle-organisation": ["dominanz"],
            "wohnform-flexibilitaet": [],
            "zeitmanagement": ["dominanz"],

            // KATEGORIE D: Autonomie
            "koerperliche-anziehung": ["geschlecht", "orientierung", "orientierungStatus"],
            "sexuelle-dominanz-dynamik": ["dominanz"],
            "experimentierfreude": ["orientierungStatus"],
            "intimitaets-frequenz": [],
            "koerperliche-naehe": [],
            "sexuelle-offenheit": ["orientierungStatus"],

            // KATEGORIE E: Kommunikation
            "kommunikations-stil": ["dominanz"],
            "konflikt-kommunikation": ["dominanz"],
            "beduerfnis-artikulation": [],
            "feedback-kultur": [],

            // KATEGORIE F: Soziale Kompatibilit√§t
            "philosophische-entwicklung": [],
            "anpassungsfaehigkeit": ["dominanz"],
            "krisenresilienz": ["dominanz"],
            "gemeinsame-vision": [],
            "soziales-umfeld": [],
            "gesellschaftliche-akzeptanz": []
        };

        // Calculate dominanz modifier
        function getDominanzModifier(dom1, dom2) {
            // Return 0 if either is null/undefined
            if (!dom1 || !dom2) return 0;

            // KOMPLEMENT√ÑR
            if ((dom1 === "dominant" && dom2 === "submissiv") ||
                (dom1 === "submissiv" && dom2 === "dominant")) {
                return 8;
            }
            // BEIDE GLEICH
            if (dom1 === dom2) {
                if (dom1 === "ausgeglichen") return 5;
                if (dom1 === "switch") return 3;
                if (dom1 === "dominant") return -5;
                if (dom1 === "submissiv") return -5;
            }
            // EINER FLEXIBEL
            if (dom1 === "switch" || dom2 === "switch" ||
                dom1 === "ausgeglichen" || dom2 === "ausgeglichen") {
                return 2;
            }
            return 0;
        }

        // Get dominanz modifier description
        // Basiert auf Forschung: Sadikaj et al. (2017), Tiedens & Fragale (2003)
        function getDominanzDescription(dom1, dom2, modifier) {
            if (modifier === 8) return `Komplement√§r (${dom1} √ó ${dom2}): Optimale Rollenverteilung - Forschung zeigt h√∂here Sympathie und Komfort`;
            if (modifier === 5) return `Beide ausgeglichen: Flexible Dynamik ohne starre Hierarchie`;
            if (modifier === 3) return `Beide switch: Wechselnde Dynamik mit situativer Anpassung`;
            if (modifier === -5 && dom1 === "dominant") return `Beide dominant: Machtkampf-Risiko - bewusste Kommunikationsregeln empfohlen`;
            if (modifier === -5 && dom1 === "submissiv") return `Beide submissiv: F√ºhrungsvakuum - klare Aufgabenteilung empfohlen`;
            if (modifier === 2) return `Flexibilit√§t: Ein Partner passt sich situativ an`;
            return "Neutral";
        }

        // Map tag to category
        function getTagCategory(tagId) {
            const mapping = {
                "exklusivitaets-erwartung": "A", "offenheit-fuer-alternative-modelle": "A",
                "beziehung-als-lebensinhalt": "A", "primaerbeziehung-konzept": "A", "commitment-tiefe": "A",
                "fuehrung-und-initiative": "B", "macht-balance": "B", "emotionale-reziprozitaet": "B",
                "eifersucht-umgang": "B", "konfliktloesung": "B", "emotionale-tiefe": "B",
                "entscheidungsfindung": "C", "alltags-organisation": "C", "autonomie-vs-gemeinsame-zeit": "C",
                "finanzielle-organisation": "C", "wohnform-flexibilitaet": "C", "zeitmanagement": "C",
                "koerperliche-anziehung": "D", "sexuelle-dominanz-dynamik": "D", "experimentierfreude": "D",
                "intimitaets-frequenz": "D", "koerperliche-naehe": "D", "sexuelle-offenheit": "D",
                "kommunikations-stil": "E", "konflikt-kommunikation": "E",
                "beduerfnis-artikulation": "E", "feedback-kultur": "E",
                "philosophische-entwicklung": "F", "anpassungsfaehigkeit": "F", "krisenresilienz": "F",
                "gemeinsame-vision": "F", "soziales-umfeld": "F", "gesellschaftliche-akzeptanz": "F"
            };
            return mapping[tagId] || null;
        }

        // Calculate tag score with modifiers
        function calculateTagWithModifiers(tagId, person1, person2, pathosCheck) {
            const interactionKey = `${person1.archetyp}_${person2.archetyp}`;
            const interaction = data?.interactions[interactionKey];
            const tagCategory = getTagCategory(tagId);
            let baseScore = interaction?.scores?.[tagCategory]?.value || 50;

            const relevantDims = tagDimensionRelevance[tagId] || [];
            if (relevantDims.length === 0) {
                return { score: baseScore, baseScore, modifier: 0, dims: [], desc: "Archetyp-basiert" };
            }

            let modifier = 0;
            let descriptions = [];

            // Dominanz modifier
            if (relevantDims.includes("dominanz")) {
                const domMod = getDominanzModifier(person1.dominanz, person2.dominanz);
                modifier += domMod;
                if (domMod !== 0) descriptions.push(getDominanzDescription(person1.dominanz, person2.dominanz, domMod));
            }

            // Physical compatibility (Pathos uncertainty)
            if (relevantDims.some(d => ["geschlecht", "orientierung", "orientierungStatus"].includes(d))) {
                if (pathosCheck?.result === "unsicher") {
                    modifier -= 10;
                    descriptions.push("Unsichere k√∂rperliche Anziehung");
                }
            }

            // Orientation status (exploration bonus)
            if (relevantDims.includes("orientierungStatus")) {
                if (person1.orientierungStatus === "interessiert" || person2.orientierungStatus === "interessiert") {
                    if (tagId === "experimentierfreude" || tagId === "sexuelle-offenheit") {
                        modifier += 5;
                        descriptions.push("Explorationsbonus");
                    }
                }
            }

            const finalScore = Math.round(baseScore + modifier);
            return {
                score: finalScore,
                baseScore,
                modifier,
                dims: relevantDims,
                desc: descriptions.length > 0 ? descriptions.join("; ") : "Keine Anpassung"
            };
        }

        // Calculate category with modifiers
        function calculateCategoryWithModifiers(catLetter, person1, person2, pathosCheck) {
            const categoryTags = Object.keys(tagDimensionRelevance).filter(t => getTagCategory(t) === catLetter);

            if (categoryTags.length === 0) {
                const interactionKey = `${person1.archetyp}_${person2.archetyp}`;
                const interaction = data?.interactions[interactionKey];
                return { score: interaction?.scores?.[catLetter]?.value || 50, modifier: 0, tags: [] };
            }

            let totalScore = 0, totalMod = 0;
            const tagDetails = [];

            for (const tagId of categoryTags) {
                const result = calculateTagWithModifiers(tagId, person1, person2, pathosCheck);
                totalScore += result.score;
                totalMod += result.modifier;
                tagDetails.push({ id: tagId, ...result });
            }

            return {
                score: Math.round(totalScore / categoryTags.length),
                modifier: Math.round(totalMod / categoryTags.length),
                tags: tagDetails
            };
        }

        // ========================================
        // NEW: 4-Factor Relationship Quality Model
        // ========================================

        // Factor 1: Archetype Match (40%) - from existing matrix
        function getArchetypeScore(type1, type2) {
            const key = `${type1}_${type2}`;
            const interaction = data?.interactions[key];
            return interaction?.overall || 50;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // Factor 2: Dominance Harmony (20% Gewichtung - Pathos/Gef√ºhl)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // Philosophische Grundlage: OSHO + Metaphysik der Qualit√§t (Pirsig)
        //
        // OSHO: "Nur Extreme k√∂nnen sich wirklich verlieben. Nur Extreme ziehen
        //        sich an. Je weiter sie voneinander entfernt sind, desto tiefer
        //        wird die Anziehung."
        //
        // OSHO: "Es gibt nur eine Energie - Tao. Sie funktioniert auf zwei Arten.
        //        Du kannst Konflikt ODER Harmonie zwischen beiden erschaffen."
        //
        // MOQ (Pirsig): Dynamische Qualit√§t entsteht durch Spannung zwischen
        //               Polen. Statische Qualit√§t bewahrt funktionierende Muster.
        //
        // Werte-Logik:
        // - 100%: Komplement√§re Polarit√§t (Dom‚ÜîSub) = maximale dynamische Qualit√§t
        // -  95%: Tao-Balance (Ausgeglichen‚ÜîAusgeglichen) = harmonische Einheit
        // -  90%: Flexible Dynamik (Switch‚ÜîSwitch) = spielerische Anpassung
        // -  85%: Pol + Balance = stabile Erg√§nzung
        // -  80%: Switch + Pol = Anpassung m√∂glich, aber Spannung
        // -  60%: Gleiche Pole (Dom‚ÜîDom, Sub‚ÜîSub) = Konflikt, fehlende Spannung
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DOMINANZ HARMONY MATRIX
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const dominanzHarmonyMatrix = {
            // KOMPLEMENT√ÑRE POLARIT√ÑT (100%)
            "dominant-submissiv": 100, "submissiv-dominant": 100,
            // TAO-BALANCE (90-95%)
            "ausgeglichen-ausgeglichen": 95, "switch-switch": 90,
            "switch-ausgeglichen": 88, "ausgeglichen-switch": 88,
            // POL + BALANCE (85%)
            "dominant-ausgeglichen": 85, "ausgeglichen-dominant": 85,
            "submissiv-ausgeglichen": 85, "ausgeglichen-submissiv": 85,
            // SWITCH + POL (80%)
            "switch-dominant": 80, "dominant-switch": 80,
            "switch-submissiv": 80, "submissiv-switch": 80,
            // GLEICHE POLE (55%)
            "dominant-dominant": 55, "submissiv-submissiv": 55
        };

        // Calculate harmony between two single dominanz types
        function calculateSingleDominanzHarmony(type1, status1, type2, status2) {
            const key = `${type1}-${type2}`;
            let baseScore = dominanzHarmonyMatrix[key] || dominanzHarmonyMatrix[`${type2}-${type1}`] || 75;

            // STATUS-MODIFIER: Reduzierte Konfidenz bei "interessiert"
            if (status1 === 'interessiert' || status2 === 'interessiert') {
                baseScore = Math.round(baseScore * 0.7);
            }

            return baseScore;
        }

        // Calculate best dominanz harmony for multi-select (finds best combination)
        function calculateDominanceHarmony(domObj1, domObj2) {
            // Handle old single-value format (backwards compatibility)
            if (typeof domObj1 === 'string' || typeof domObj2 === 'string') {
                return calculateSingleDominanzHarmony(domObj1, 'gelebt', domObj2, 'gelebt');
            }

            // Get selected dominanz preferences for each person (Primary/Secondary structure)
            const list1 = [];
            const list2 = [];

            if (domObj1) {
                if (domObj1.primary) list1.push({ type: domObj1.primary, status: 'primary' });
                if (domObj1.secondary) list1.push({ type: domObj1.secondary, status: 'secondary' });
            }

            if (domObj2) {
                if (domObj2.primary) list2.push({ type: domObj2.primary, status: 'primary' });
                if (domObj2.secondary) list2.push({ type: domObj2.secondary, status: 'secondary' });
            }

            // Default if no selections
            if (list1.length === 0 || list2.length === 0) return 75;

            // Find best combination
            let bestScore = 0;
            for (const d1 of list1) {
                for (const d2 of list2) {
                    const score = calculateSingleDominanzHarmony(d1.type, d1.status, d2.type, d2.status);
                    if (score > bestScore) {
                        bestScore = score;
                    }
                }
            }

            return bestScore;
        }

        // Factor 3: Orientation Compatibility (25%) - uses existing checkPhysicalCompatibility
        function calculateOrientationScore(person1, person2) {
            const pathosCheck = checkPhysicalCompatibility(person1, person2);

            if (pathosCheck.result === "unm√∂glich") {
                return 0;  // K.O.-Kriterium!
            }

            if (pathosCheck.result === "unsicher") {
                return 70;  // Exploration-Phase
            }

            return 100;  // Kompatibel
        }

        // Factor 4: Gender Attraction (15%)
        function calculateGenderAttraction(p1, p2) {
            // Extract primary gender from object format { primary: 'cis_mann', secondary: null }
            let g1 = p1.geschlecht;
            let g2 = p2.geschlecht;
            if (g1 && typeof g1 === 'object' && 'primary' in g1) g1 = g1.primary;
            if (g2 && typeof g2 === 'object' && 'primary' in g2) g2 = g2.primary;

            // Handle Primary/Secondary orientierung structure
            const oriList1 = [];
            const oriList2 = [];

            if (p1.orientierung && typeof p1.orientierung === 'object') {
                if (p1.orientierung.primary) oriList1.push(p1.orientierung.primary);
                if (p1.orientierung.secondary) oriList1.push(p1.orientierung.secondary);
            } else if (p1.orientierung) {
                oriList1.push(p1.orientierung);
            }

            if (p2.orientierung && typeof p2.orientierung === 'object') {
                if (p2.orientierung.primary) oriList2.push(p2.orientierung.primary);
                if (p2.orientierung.secondary) oriList2.push(p2.orientierung.secondary);
            } else if (p2.orientierung) {
                oriList2.push(p2.orientierung);
            }

            // Return default if values missing
            if (!g1 || !g2 || oriList1.length === 0 || oriList2.length === 0) return 75;

            // Check best combination
            let bestScore = 0;

            for (const o1 of oriList1) {
                for (const o2 of oriList2) {
                    const score = calculateSingleGenderAttraction(g1, o1, g2, o2);
                    if (score > bestScore) {
                        bestScore = score;
                    }
                }
            }

            return bestScore;
        }

        // Helper for single orientierung pair - nutzt Geschlechts-Kategorien
        function calculateSingleGenderAttraction(g1, o1, g2, o2) {
            // Konvertiere Geschlechter zu Kategorien f√ºr die Logik
            const cat1 = getGeschlechtCategory(g1);
            const cat2 = getGeschlechtCategory(g2);

            // Bi = immer 100% (angezogen von m√§nnlich und weiblich)
            if (o1 === "bisexuell" || o2 === "bisexuell") return 100;

            // Hetero: Angezogen vom "anderen" Geschlecht
            if (o1 === "heterosexuell" && o2 === "heterosexuell") {
                if ((cat1 === "maennlich" && cat2 === "weiblich") ||
                    (cat1 === "weiblich" && cat2 === "maennlich")) return 100;
                // Nonbin√§r, Fluid, Agender - partielle Kompatibilit√§t
                if (cat1 === "nonbinaer" || cat2 === "nonbinaer" ||
                    cat1 === "fluid" || cat2 === "fluid") return 80;
                if (cat1 === "agender" || cat2 === "agender") return 60;
                return 0;
            }

            // Homo: Angezogen vom "gleichen" Geschlecht
            if (o1 === "homosexuell" && o2 === "homosexuell") {
                if (cat1 === cat2 && cat1 !== "nonbinaer" && cat1 !== "fluid" && cat1 !== "agender") return 100;
                // Nonbin√§r mit Homo - angezogen von √§hnlichen
                if ((cat1 === "nonbinaer" && cat2 === "nonbinaer") ||
                    (cat1 === "fluid" && cat2 === "fluid")) return 90;
                if (cat1 === "nonbinaer" || cat2 === "nonbinaer" ||
                    cat1 === "fluid" || cat2 === "fluid") return 75;
                if (cat1 === "agender" || cat2 === "agender") return 60;
                return 0;
            }

            return 75;  // Gemischte Orientierungen
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // RESONANZ-BERECHNUNG (Meta-Dimension)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // R = 0.9 + [(M/100 √ó 0.5) + (B √ó 0.5)] √ó 0.2
        // wobei:
        //   M = Profil-Match (0-100%): √úbereinstimmung der 30 Attribute
        //   B = Balance (0-1): Harmonie zwischen Logos und Pathos
        // Ergebnis: R zwischen 0.9 und 1.1
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Die 30 Profil-Attribute in 3 Kategorien
        const PROFILE_ATTRIBUTES = {
            D: ['kinderWunsch', 'eheWunsch', 'wohnform', 'religion', 'karrierePrioritaet',
                'finanzPhilosophie', 'lebensstil', 'umzugsbereitschaft', 'zukunftsplanung', 'traditionenWichtigkeit'],
            E: ['kommunikationsstil', 'konfliktverhalten', 'emotionaleOffenheit', 'gespraechsBed√ºrfnis', 'feedbackStil',
                'entschuldigungen', 'streitVerhalten', 'versoehnung', 'kritikAnnehmen', 'humorKonflikte'],
            F: ['introExtro', 'familieWichtigkeit', 'freundeskreis', 'oeffentlichkeit', 'alleinzeit',
                'events', 'reisen', 'hobbys', 'wochenende', 'netzwerkGroesse']
        };

        /**
         * Berechnet den Profil-Match-Score (M)
         * Vergleicht die 30 Attribute zweier psychologischer Profile
         * @returns {number} Match-Prozent 0-100
         */
        function calculateProfilMatch(person1, person2) {
            // Profile-Key generieren basierend auf Archetyp-Geschlecht-Dominanz-Orientierung
            const profile1Key = getProfileKey(person1);
            const profile2Key = getProfileKey(person2);

            // Profile aus psychologicalProfiles laden (falls verf√ºgbar)
            if (typeof psychologicalProfiles === 'undefined') {
                // Fallback: Sch√§tze Match basierend auf Archetyp-√Ñhnlichkeit
                return estimateProfilMatch(person1, person2);
            }

            const profile1 = psychologicalProfiles[profile1Key];
            const profile2 = psychologicalProfiles[profile2Key];

            if (!profile1 || !profile2) {
                return estimateProfilMatch(person1, person2);
            }

            // Z√§hle √ºbereinstimmende Attribute
            let matches = 0;
            const allAttributes = [...PROFILE_ATTRIBUTES.D, ...PROFILE_ATTRIBUTES.E, ...PROFILE_ATTRIBUTES.F];

            for (const attr of allAttributes) {
                if (profile1[attr] && profile2[attr]) {
                    if (profile1[attr] === profile2[attr]) {
                        matches++;
                    } else if (areAttributesCompatible(attr, profile1[attr], profile2[attr])) {
                        matches += 0.5; // Partielle √úbereinstimmung
                    }
                }
            }

            return Math.round((matches / 30) * 100);
        }

        /**
         * Generiert den Profile-Key f√ºr eine Person
         */
        function getProfileKey(person) {
            const geschlecht = getGeschlechtCategory(person.geschlecht);
            const geschlechtLabel = geschlecht === 'maennlich' ? 'm√§nnlich' :
                                   geschlecht === 'weiblich' ? 'weiblich' : 'nonbin√§r';

            // Prim√§re Dominanz ermitteln
            let dominanz = 'ausgeglichen';
            if (person.dominanz && typeof person.dominanz === 'object') {
                // New format: { primary: 'dominant', secondary: 'submissiv' }
                if ('primary' in person.dominanz) {
                    dominanz = person.dominanz.primary || 'ausgeglichen';
                } else {
                    // Old format: { dominant: 'gelebt', submissiv: 'interessiert' }
                    for (const [type, status] of Object.entries(person.dominanz)) {
                        if (status === 'gelebt') {
                            dominanz = type;
                            break;
                        }
                    }
                }
            } else if (person.dominanz) {
                dominanz = person.dominanz;
            }

            // Prim√§re Orientierung ermitteln
            let orientierung = 'heterosexuell';
            if (person.orientierung && typeof person.orientierung === 'object') {
                // New format: { primary: 'homosexuell', secondary: 'heterosexuell' }
                if ('primary' in person.orientierung) {
                    orientierung = person.orientierung.primary || 'heterosexuell';
                } else {
                    // Old format: { heterosexuell: 'gelebt', homosexuell: 'interessiert' }
                    for (const [type, status] of Object.entries(person.orientierung)) {
                        if (status === 'gelebt') {
                            orientierung = type;
                            break;
                        }
                    }
                }
            } else if (person.orientierung) {
                orientierung = person.orientierung;
            }

            return `${person.archetyp}-${geschlechtLabel}-${dominanz}-${orientierung}`;
        }

        /**
         * Sch√§tzt den Profil-Match wenn keine exakten Profile verf√ºgbar
         * Basiert auf Archetyp-√Ñhnlichkeit und Dimension-√úbereinstimmungen
         */
        function estimateProfilMatch(person1, person2) {
            let score = 50; // Basis

            // Gleicher Archetyp = +30
            if (person1.archetyp === person2.archetyp) {
                score += 30;
            } else {
                // √Ñhnliche Archetypen (aus Matrix ableitbar)
                const archetypeScore = getArchetypeScore(person1.archetyp, person2.archetyp);
                score += Math.round((archetypeScore - 50) * 0.3);
            }

            // Gleiche Dominanz-Orientierung = +10
            const dom1 = getPrimaryDominanz(person1.dominanz);
            const dom2 = getPrimaryDominanz(person2.dominanz);
            if (dom1 === dom2) score += 10;

            // √Ñhnliche Orientierung = +10
            const ori1 = getPrimaryOrientierung(person1.orientierung);
            const ori2 = getPrimaryOrientierung(person2.orientierung);
            if (ori1 === ori2) score += 10;

            return Math.min(100, Math.max(0, score));
        }

        /**
         * Pr√ºft ob zwei Attribut-Werte kompatibel sind (partielle √úbereinstimmung)
         */
        function areAttributesCompatible(attr, val1, val2) {
            // Kompatibilit√§ts-Gruppen f√ºr bestimmte Attribute
            const compatGroups = {
                'wohnform': [['alleine', 'zusammen'], ['getrennt', 'zusammen']],
                'lebensstil': [['durchschnittlich', 'bescheiden'], ['durchschnittlich', 'luxuri√∂s']],
                'kommunikationsstil': [['direkt', 'ausgewogen'], ['indirekt', 'ausgewogen']],
                'introExtro': [['ambivert', 'introvertiert'], ['ambivert', 'extrovertiert']]
            };

            if (compatGroups[attr]) {
                for (const group of compatGroups[attr]) {
                    if (group.includes(val1) && group.includes(val2)) {
                        return true;
                    }
                }
            }

            return false;
        }

        /**
         * Helper: Prim√§re Dominanz aus Objekt ermitteln
         */
        function getPrimaryDominanz(dominanz) {
            if (!dominanz || typeof dominanz !== 'object') return dominanz || 'ausgeglichen';
            // New format: { primary: 'dominant', secondary: 'submissiv' }
            if ('primary' in dominanz) {
                return dominanz.primary || 'ausgeglichen';
            }
            // Old format: { dominant: 'gelebt', submissiv: 'interessiert' }
            for (const [type, status] of Object.entries(dominanz)) {
                if (status === 'gelebt') return type;
            }
            return 'ausgeglichen';
        }

        /**
         * Helper: Prim√§re Orientierung aus Objekt ermitteln
         */
        function getPrimaryOrientierung(orientierung) {
            if (!orientierung || typeof orientierung !== 'object') return orientierung || 'heterosexuell';
            // New format: { primary: 'homosexuell', secondary: 'heterosexuell' }
            if ('primary' in orientierung) {
                return orientierung.primary || 'heterosexuell';
            }
            // Old format: { heterosexuell: 'gelebt', homosexuell: 'interessiert' }
            for (const [type, status] of Object.entries(orientierung)) {
                if (status === 'gelebt') return type;
            }
            return 'heterosexuell';
        }

        /**
         * Berechnet die Logos-Pathos-Balance (B)
         * B = (100 - |Logos - Pathos|) / 100
         * @returns {number} Balance 0.0-1.0
         */
        function calculateLogosPathosBalance(archetypeScore, orientationScore, dominanceScore, genderScore) {
            // Logos = Archetyp-Score
            const logos = archetypeScore;

            // Pathos = Durchschnitt der drei Pathos-Faktoren
            const pathos = (orientationScore + dominanceScore + genderScore) / 3;

            // Differenz
            const differenz = Math.abs(logos - pathos);

            // Balance: Je geringer die Differenz, desto h√∂her die Balance
            const balance = (100 - differenz) / 100;

            return Math.max(0, Math.min(1, balance));
        }

        /**
         * Berechnet den Resonanz-Koeffizienten (R)
         * R = 0.9 + [(M/100 √ó 0.35) + (B √ó 0.35) + (K √ó 0.30)] √ó 0.2
         *
         * K = GFK-Kommunikationsfaktor (0-1)
         *     - Beide hoch: 1.0
         *     - Hoch+Mittel: 0.75
         *     - Beide mittel: 0.5
         *     - Asymmetrisch: 0.25
         *     - Beide niedrig: 0.0
         *
         * @returns {object} { R: 0.9-1.1, M: 0-100, B: 0-1, K: 0-1, interpretation: string }
         */
        function calculateResonanz(person1, person2, archetypeScore, orientationScore, dominanceScore, genderScore) {
            // Komponente 1: Profil-Match (M)
            const M = calculateProfilMatch(person1, person2);

            // Komponente 2: Logos-Pathos-Balance (B)
            const B = calculateLogosPathosBalance(archetypeScore, orientationScore, dominanceScore, genderScore);

            // Komponente 3: GFK-Kommunikationsfaktor (K)
            const K = calculateGfkFactor();

            // Gesamtformel: R = 0.9 + [(M/100 √ó 0.35) + (B √ó 0.35) + (K √ó 0.30)] √ó 0.2
            // GFK bekommt 30% weil Kommunikation fundamental f√ºr Resonanz ist
            const R = 0.9 + ((M / 100 * 0.35) + (B * 0.35) + (K * 0.30)) * 0.2;

            // Interpretation
            let interpretation;
            if (R >= 1.08) {
                interpretation = 'Starke Harmonie';
            } else if (R >= 1.03) {
                interpretation = 'Leichte Harmonie';
            } else if (R >= 0.97) {
                interpretation = 'Neutral';
            } else if (R >= 0.93) {
                interpretation = 'Leichte Dissonanz';
            } else {
                interpretation = 'Starke Dissonanz';
            }

            return {
                R: Math.round(R * 100) / 100,
                M: M,
                B: Math.round(B * 100) / 100,
                K: Math.round(K * 100) / 100,
                interpretation: interpretation
            };
        }

        /**
         * Berechnet den GFK-Kommunikationsfaktor (K)
         * Basiert auf der GFK-Kompetenz beider Partner
         * @returns {number} 0-1, wobei 1 = optimale Kommunikationsbasis
         */
        function calculateGfkFactor() {
            const ichGfk = personDimensions.ich?.gfk;
            const partnerGfk = personDimensions.partner?.gfk;

            // Wenn einer nicht ausgew√§hlt: neutral (0.5)
            if (!ichGfk || !partnerGfk) {
                return 0.5;
            }

            // GFK-Werte in numerische Werte umwandeln
            const gfkValues = { 'hoch': 3, 'mittel': 2, 'niedrig': 1 };
            const v1 = gfkValues[ichGfk] || 2;
            const v2 = gfkValues[partnerGfk] || 2;

            // Kombinationswerte (Summe: 2-6)
            const sum = v1 + v2;
            const min = Math.min(v1, v2);

            // Faktor-Mapping:
            // 6 (hoch+hoch): 1.0
            // 5 (hoch+mittel): 0.75
            // 4 (mittel+mittel oder hoch+niedrig): 0.5 oder 0.4
            // 3 (mittel+niedrig): 0.25
            // 2 (niedrig+niedrig): 0.0

            if (sum === 6) return 1.0;              // hoch + hoch
            if (sum === 5) return 0.75;             // hoch + mittel
            if (sum === 4 && min === 2) return 0.5; // mittel + mittel
            if (sum === 4 && min === 1) return 0.35; // hoch + niedrig (asymmetrisch)
            if (sum === 3) return 0.2;              // mittel + niedrig
            return 0.0;                             // niedrig + niedrig
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // HAUPTBERECHNUNG: 5-Faktoren Beziehungsqualit√§t (inkl. Resonanz)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // Philosophische Grundlage: Tiage-Modell + MOQ (Pirsig) + OSHO
        //
        // GEWICHTUNG LOGOS vs. PATHOS (40:60)
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // Pirsig (MOQ): "Qualit√§t ist die Quelle von Subjekt und Objekt."
        //               Statische Qualit√§t (Logos) = Fundament, bewahrt Muster
        //               Dynamische Qualit√§t (Pathos) = Antrieb, erzeugt Anziehung
        //
        // OSHO: "Balance zwischen allen Polarit√§ten ist Gesundheit."
        //       "Gef√ºhl ist der Antrieb, Verstand gibt Struktur."
        //
        // Tiage: Verbindet rationale Reflexion (Logos) mit emotionaler
        //        Resonanz (Pathos) zu einem ganzheitlichen Modell.
        //
        // FAKTOR-BEGR√úNDUNG:
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // 1. Archetyp (40% - Logos/Verstand):
        //    ‚Üí Fundamentale Beziehungsphilosophie
        //    ‚Üí Statische Qualit√§t: "Wie wollen wir Beziehung leben?"
        //    ‚Üí H√∂chste Gewichtung weil strukturgebend
        //
        // 2. Orientierung (25% - Pathos/Gef√ºhl):
        //    ‚Üí K√∂rperliche Anziehungsm√∂glichkeit
        //    ‚Üí Dynamische Qualit√§t: Polarit√§t der Begierde
        //    ‚Üí OSHO: "Extreme ziehen sich an"
        //
        // 3. Dominanz (20% - Pathos/Gef√ºhl):
        //    ‚Üí Energetische Dynamik der Interaktion
        //    ‚Üí Dynamische Qualit√§t: F√ºhren/Folgen-Balance
        //    ‚Üí OSHO: "Tao - eine Energie, zwei Ausdrucksformen"
        //
        // 4. Geschlecht (15% - Pathos/Gef√ºhl):
        //    ‚Üí Gender-Chemie als Feinabstimmung
        //    ‚Üí Erg√§nzt Orientierung mit Nuancen (z.B. non-bin√§r)
        //    ‚Üí Niedrigste Gewichtung: weniger fundamental als Philosophie
        //
        // SUMME: Logos 40% + Pathos 60% = 100%
        // ‚Üí Gef√ºhl als Antrieb, Verstand als Fundament
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function calculateRelationshipQuality(person1, person2) {
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // NEUE ZENTRALE BERECHNUNG mit Resonanz
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // Formel: Q = [(A √ó w‚Çê) + (O √ó w‚Çí) + (D √ó w·µà) + (G √ó w·µç)] √ó R
            //
            // R = Resonanz-Koeffizient (0.9 - 1.1)
            // Kein harter K.O. mehr - sanfte Abstufung durch Resonanz

            const orientationScore = calculateOrientationScore(person1, person2);

            if (orientationScore === 0) {
                return {
                    score: 0,
                    blocked: true,
                    reason: "Keine k√∂rperliche Anziehung m√∂glich",
                    breakdown: {
                        archetyp: 0,
                        dominanz: 0,
                        orientierung: 0,
                        geschlecht: 0
                    },
                    resonanz: { R: 0.9, M: 0, B: 0, interpretation: 'Blockiert' }
                };
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // EBENE 2: 4-Faktoren Qualit√§tsberechnung
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            const archetypeScore = getArchetypeScore(person1.archetyp, person2.archetyp);
            const dominanceScore = calculateDominanceHarmony(person1.dominanz, person2.dominanz);
            const genderScore = calculateGenderAttraction(person1, person2);

            // Gewichtete Basis-Summe nach Logos/Pathos-Prinzip
            const baseScore =
                (archetypeScore * 0.40) +      // 40% Logos - Beziehungsphilosophie
                (orientationScore * 0.25) +    // 25% Pathos - K√∂rperliche Polarit√§t
                (dominanceScore * 0.20) +      // 20% Pathos - Energetische Dynamik
                (genderScore * 0.15);          // 15% Pathos - Gender-Chemie

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // EBENE 3: Resonanz als Meta-Dimension
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // R moduliert das Gesamtergebnis (0.9 - 1.1)
            // Formel: Q = baseScore √ó R

            const resonanzResult = calculateResonanz(
                person1, person2,
                archetypeScore, orientationScore, dominanceScore, genderScore
            );

            // Finale Qualit√§t mit Resonanz-Modulation
            const totalScore = baseScore * resonanzResult.R;

            // Logos/Pathos Breakdown f√ºr UI
            const logos = archetypeScore;
            const pathos = (orientationScore + dominanceScore + genderScore) / 3;

            return {
                score: Math.round(totalScore),
                baseScore: Math.round(baseScore),
                blocked: false,
                breakdown: {
                    archetyp: archetypeScore,
                    dominanz: dominanceScore,
                    orientierung: orientationScore,
                    geschlecht: genderScore
                },
                resonanz: resonanzResult,
                logos: logos,
                pathos: pathos
            };
        }

        // Calculate overall with 4-factor model + category details for UI
        function calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck) {
            // Use new 4-factor model for overall score
            const qualityResult = calculateRelationshipQuality(person1, person2);

            // Calculate category scores for UI display (radar chart, category bars)
            const categories = {};

            // Category A: Philosophy score from matrix
            categories.A = { score: logosCheck.score, modifier: 0, note: "Rein archetyp-basiert" };

            // Other categories with modifiers (for UI display)
            for (const cat of ['B', 'C', 'D', 'E', 'F']) {
                const result = calculateCategoryWithModifiers(cat, person1, person2, pathosCheck);
                categories[cat] = result;
            }

            return {
                overall: qualityResult.score,  // NEW: 4-factor score
                categories,                     // Keep for UI
                breakdown: qualityResult.breakdown  // NEW: factor breakdown
            };
        }

        // Get modifier summary for UI
        function getModifierSummary(person1, person2) {
            const summaries = [];
            const domMod = getDominanzModifier(person1.dominanz, person2.dominanz);
            if (domMod !== 0) {
                summaries.push({
                    type: "Dominanz",
                    modifier: domMod,
                    description: getDominanzDescription(person1.dominanz, person2.dominanz, domMod)
                });
            }
            return summaries;
        }

        // ========================================
        // NEW: Side-by-Side Comparison Functions
        // ========================================

        // Navigate through archetypes with forward/backward buttons
        function navigateArchetype(person, direction) {
            const selectId = person === 'ich' ? 'ichSelect' : 'partnerSelect';
            const mobileSelectId = person === 'ich' ? 'mobileIchSelect' : 'mobilePartnerSelect';
            const select = document.getElementById(selectId);
            const mobileSelect = document.getElementById(mobileSelectId);

            // Use whichever select is visible/available
            const activeSelect = select || mobileSelect;
            if (!activeSelect) return;

            const currentIndex = activeSelect.selectedIndex;
            const optionsCount = activeSelect.options.length;
            let newIndex = currentIndex + direction;

            // Wrap around
            if (newIndex < 0) newIndex = optionsCount - 1;
            if (newIndex >= optionsCount) newIndex = 0;

            // Update both desktop and mobile selects
            if (select) select.selectedIndex = newIndex;
            if (mobileSelect) mobileSelect.selectedIndex = newIndex;

            // Update global state variables
            const newValue = activeSelect.options[newIndex].value;
            if (person === 'ich') {
                currentArchetype = newValue;
                mobileIchArchetype = newValue;
            } else {
                selectedPartner = newValue;
                mobilePartnerArchetype = newValue;
            }

            // Trigger change event on the active select
            activeSelect.dispatchEvent(new Event('change'));

            // Update archetype grid
            updateArchetypeGrid(person, newValue);
        }

        // Function to select archetype from grid click
        function selectArchetypeFromGrid(person, archetype) {
            const selectId = person === 'ich' ? 'ichSelect' : 'partnerSelect';
            const mobileSelectId = person === 'ich' ? 'mobileIchSelect' : 'mobilePartnerSelect';
            const select = document.getElementById(selectId);
            const mobileSelect = document.getElementById(mobileSelectId);

            // Update select elements
            if (select) {
                for (let i = 0; i < select.options.length; i++) {
                    if (select.options[i].value === archetype) {
                        select.selectedIndex = i;
                        break;
                    }
                }
            }
            if (mobileSelect) {
                for (let i = 0; i < mobileSelect.options.length; i++) {
                    if (mobileSelect.options[i].value === archetype) {
                        mobileSelect.selectedIndex = i;
                        break;
                    }
                }
            }

            // Update global state variables
            if (person === 'ich') {
                currentArchetype = archetype;
                mobileIchArchetype = archetype;
            } else {
                selectedPartner = archetype;
                mobilePartnerArchetype = archetype;
            }

            // Update archetype grid highlighting
            updateArchetypeGrid(person, archetype);

            // Trigger change event
            const activeSelect = select || mobileSelect;
            if (activeSelect) {
                activeSelect.dispatchEvent(new Event('change'));
            }
        }

        // Function to update archetype grid highlighting
        function updateArchetypeGrid(person, archetype) {
            // Desktop grid IDs
            const gridId = person === 'ich' ? 'ich-archetype-grid' : 'partner-archetype-grid';
            // Mobile grid IDs
            const mobileGridId = person === 'ich' ? 'mobile-ich-archetype-grid' : 'mobile-partner-archetype-grid';

            // Update all grids (desktop and mobile)
            [gridId, mobileGridId].forEach(id => {
                const grid = document.getElementById(id);
                if (!grid) return;

                // Remove active class from all items
                grid.querySelectorAll('.archetype-symbol-item').forEach(item => {
                    item.classList.remove('active');
                });

                // Add active class to selected item
                const selectedItem = grid.querySelector(`.archetype-symbol-item[data-archetype="${archetype}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('active');
                }
            });
        }

        // Navigation auf Seite 2 (Ergebnis) - ruft navigateArchetype auf und aktualisiert Seite 2
        function navigateArchetypeOnPage2(person, direction) {
            navigateArchetype(person, direction);
            // Seite 2 explizit aktualisieren
            updateMobileResultPage();
        }

        // Navigation auf Seite 3 (Kategorien) - ruft navigateArchetype auf und aktualisiert Seite 3
        function navigateArchetypeOnPage3(person, direction) {
            navigateArchetype(person, direction);
            // Seite 3 explizit aktualisieren
            updateMobilePage3();
        }

        // Aktualisiert die Anzeige auf Mobile Seite 3
        function updateMobilePage3() {
            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];

            const ichEl = document.getElementById('mobileResultIch3');
            const partnerEl = document.getElementById('mobileResultPartner3');

            if (ichEl) ichEl.textContent = ichArch?.name || currentArchetype;
            if (partnerEl) partnerEl.textContent = partnerArch?.name || selectedPartner;
        }

        // Variable f√ºr aktuelle Kategorie im Modal
        let currentDisplayedCategory = 'A';

        // Navigation f√ºr CategoryModal - wechselt beide Archetypen (ICH)
        function navigateCategoryArchetype(direction) {
            navigateArchetype('ich', direction);
            // CategoryModal neu laden mit aktueller Kategorie
            showCategoryDetails(currentDisplayedCategory);
            // Alle Ansichten aktualisieren
            updateComparisonView();
        }

        function initComparisonLayout() {
            // ICH select
            const ichSelect = document.getElementById('ichSelect');
            if (ichSelect) {
                ichSelect.addEventListener('change', (e) => {
                    currentArchetype = e.target.value;
                    // Sync with old select if exists
                    const oldSelect = document.getElementById('archetypeSelect');
                    if (oldSelect) oldSelect.value = e.target.value;
                    updateArchetypeGrid('ich', e.target.value);
                    updateComparisonView();
                    // GFK automatisch aus Archetypen-Matching ableiten
                    updateGfkFromArchetypes();
                });
            }

            // Partner select
            const partnerSelect = document.getElementById('partnerSelect');
            if (partnerSelect) {
                partnerSelect.addEventListener('change', (e) => {
                    selectedPartner = e.target.value;
                    updateArchetypeGrid('partner', e.target.value);
                    updateComparisonView();
                    // GFK automatisch aus Archetypen-Matching ableiten
                    updateGfkFromArchetypes();
                });
            }

            // ICH compact dimensions
            document.querySelectorAll('input[name="ich-geschlecht-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    // Use handleGeschlechtClick to maintain consistent object format
                    handleGeschlechtClick('ich', e.target.value, e.target);
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzClick('ich', e.target.value);
                });
            });
            document.querySelectorAll('input[name="ich-dominanz-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.ich.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });

            // Partner compact dimensions
            document.querySelectorAll('input[name="partner-geschlecht-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    // Use handleGeschlechtClick to maintain consistent object format
                    handleGeschlechtClick('partner', e.target.value, e.target);
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzClick('partner', e.target.value);
                });
            });
            document.querySelectorAll('input[name="partner-dominanz-status-new"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    personDimensions.partner.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    updateAnalysisOverview();
                    updateComparisonView();
                });
            });

            // Initial Score-Circle Update beim Start
            updateComparisonView();
        }

        function updateComparisonView() {
            if (!data) return;

            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];

            // NEU: GFK-Bed√ºrfnis-Matching mit allen Dimensionen neu berechnen
            updateGfkFromArchetypes();

            // Update type names
            document.getElementById('resultIchType').textContent = ichArch?.name || currentArchetype;
            document.getElementById('resultPartnerType').textContent = partnerArch?.name || selectedPartner;

            // Calculate compatibility
            const person1 = { archetyp: currentArchetype, ...personDimensions.ich };
            const person2 = { archetyp: selectedPartner, ...personDimensions.partner };

            const pathosCheck = checkPhysicalCompatibility(person1, person2);
            const logosCheck = calculatePhilosophyCompatibility(currentArchetype, selectedPartner);

            // Update warnings
            const warningsContainer = document.getElementById('warningsContainer');
            warningsContainer.innerHTML = '';

            if (pathosCheck.result === 'unvollst√§ndig') {
                let warningHTML = '<div class="warning-box incomplete-warning">‚ö†Ô∏è Es fehlt noch:';
                if (pathosCheck.missingItems && pathosCheck.missingItems.length > 0) {
                    warningHTML += '<ul style="margin: 5px 0 0 20px; padding: 0;">';
                    pathosCheck.missingItems.forEach(item => {
                        warningHTML += `<li>${item}</li>`;
                    });
                    warningHTML += '</ul>';
                }
                warningHTML += '</div>';
                warningsContainer.innerHTML = warningHTML;
            } else if (pathosCheck.result === 'unm√∂glich') {
                warningsContainer.innerHTML = `<div class="warning-box pathos-warning">üö´ Keine emotionale/k√∂rperliche Anziehung: ${pathosCheck.reason}</div>`;
            } else if (pathosCheck.result === 'unsicher') {
                warningsContainer.innerHTML = `<div class="warning-box logos-warning">‚ö†Ô∏è Unsichere k√∂rperliche Anziehung (Exploration-Phase)</div>`;
            }

            // Warnung bei unsicherem Dominanz-Status (pr√ºfe ob mindestens eine Auswahl "interessiert" ist)
            const hasInteressiert1 = person1.dominanz && Object.values(person1.dominanz).some(s => s === 'interessiert');
            const hasInteressiert2 = person2.dominanz && Object.values(person2.dominanz).some(s => s === 'interessiert');
            if (hasInteressiert1 || hasInteressiert2) {
                warningsContainer.innerHTML += `<div class="warning-box logos-warning">‚ö†Ô∏è Unsichere Dominanz-Dynamik (Exploration-Phase ‚Äì reduzierte Konfidenz)</div>`;
            }

            if (logosCheck.score < 50) {
                warningsContainer.innerHTML += `<div class="warning-box logos-warning">‚ö†Ô∏è Verstandsebene-Warnung: Philosophie nur ${logosCheck.score}</div>`;
            }

            // If dimensions incomplete, show empty state and return
            if (pathosCheck.result === 'unvollst√§ndig') {
                // Clear all expandable sections
                const percentage = document.getElementById('resultPercentage');
                const progressFill = document.getElementById('resultProgressFill');
                percentage.textContent = '‚Äì';
                percentage.className = 'result-percentage';
                progressFill.style.width = '0%';

                // Update desktop circle for incomplete state
                const desktopCircle = document.getElementById('desktopCirclePercentage');
                if (desktopCircle) desktopCircle.textContent = '‚Äì';
                const desktopScoreCircle = document.getElementById('desktopScoreCircle');
                if (desktopScoreCircle) desktopScoreCircle.style.background = 'transparent';

                const categoryBars = document.getElementById('expandCategoryBars');
                if (categoryBars) categoryBars.innerHTML = '<p style="color: var(--text-muted); font-style: italic; text-align: center; padding: 20px;">Bitte alle Dimensionen ausw√§hlen</p>';

                const expandRadar = document.getElementById('expandRadarChart');
                if (expandRadar) expandRadar.innerHTML = '';

                const desktopScoreNoteIncomplete = document.getElementById('desktopScoreNote');
                if (desktopScoreNoteIncomplete) desktopScoreNoteIncomplete.textContent = 'Bitte alle Dimensionen ausw√§hlen.';

                // Update Score-Circle auch bei unvollst√§ndigen Dimensionen
                updateSyntheseScoreCycle();
                return;
            }

            // Calculate overall score
            let overallScore = 0;
            let qualityBreakdown = { archetyp: 0, dominanz: 0, orientierung: 0, geschlecht: 0 };

            if (pathosCheck.result !== 'unm√∂glich') {
                const result = calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck);
                overallScore = result.overall;
                qualityBreakdown = result.breakdown || qualityBreakdown;

                // Update expandable category bars
                updateExpandableCategoryBars(result.categories);
            }

            // Update 4-Factor Breakdown (Desktop)
            const factorArchetyp = document.getElementById('desktopFactorArchetyp');
            const factorDominanz = document.getElementById('desktopFactorDominanz');
            const factorOrientierung = document.getElementById('desktopFactorOrientierung');
            const factorGeschlecht = document.getElementById('desktopFactorGeschlecht');

            if (factorArchetyp) factorArchetyp.textContent = qualityBreakdown.archetyp;
            if (factorDominanz) factorDominanz.textContent = qualityBreakdown.dominanz;
            if (factorOrientierung) factorOrientierung.textContent = qualityBreakdown.orientierung;
            if (factorGeschlecht) factorGeschlecht.textContent = qualityBreakdown.geschlecht;

            // Update expandable desktop factor content
            updateDesktopFactorContent();

            // Update result bar
            const percentage = document.getElementById('resultPercentage');
            const progressFill = document.getElementById('resultProgressFill');

            percentage.textContent = overallScore;
            progressFill.style.width = Math.min(100, overallScore) + '%';

            // Update desktop score circle
            const desktopCircle = document.getElementById('desktopCirclePercentage');
            if (desktopCircle) {
                desktopCircle.textContent = overallScore;
            }

            // Set color based on score (3-Stufen-Skala: 70/50)
            let colorClass = 'low';
            let color = 'var(--danger)';
            if (overallScore >= 70) { colorClass = 'good'; color = 'var(--primary)'; }
            else if (overallScore >= 50) { colorClass = 'moderate'; color = 'var(--warning)'; }

            percentage.className = 'result-percentage ' + colorClass;
            progressFill.style.background = color;

            // Update desktop circle color
            const desktopScoreCircle = document.getElementById('desktopScoreCircle');
            if (desktopScoreCircle) {
                desktopScoreCircle.style.background = 'transparent';
            }

            // Update Desktop Score Note (direkt beim Kreis) - 3-Stufen-Skala
            const desktopScoreNote = document.getElementById('desktopScoreNote');
            if (desktopScoreNote) {
                let noteText = '';
                let quoteText = '';
                if (pathosCheck.result === 'unm√∂glich') {
                    noteText = 'Keine Basis f√ºr Resonanz vorhanden.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + overallScore + ' ‚Äì keine kompatible Basis vorhanden, deren Muster sich ausschlie√üen.';
                } else if (overallScore >= 70) {
                    noteText = 'Gute Resonanz ‚Äì Muster erg√§nzen sich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + overallScore + ' ‚Äì eine gute Resonanz zwischen zwei Menschen, deren Muster sich erg√§nzen.';
                } else if (overallScore >= 50) {
                    noteText = 'Basis vorhanden, Arbeit erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + overallScore + ' ‚Äì eine Basis ist vorhanden, erfordert aber bewusste Arbeit und Kommunikation.';
                } else {
                    noteText = 'Bewusste Reflexion erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + overallScore + ' ‚Äì bewusste Reflexion und offene Kommunikation sind erforderlich.';
                }
                desktopScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
            }

            // Update Radar Chart
            const interactionKey = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions?.[interactionKey] || {};
            drawRadarChart(interaction.scores || {}, partnerArch?.color || '#457B9D');

            // Update Desktop Selection Info Message
            updateSelectionInfoMessage();

            // Update Score-Circle auf der Hauptseite
            updateSyntheseScoreCycle();
        }

        // Universelle Funktion f√ºr Kategorien-Balken (Mobile & Desktop)
        const categoryNamesMap = {
            A: 'Beziehungsphilosophie',
            B: 'Werte-Alignment',
            C: 'N√§he-Distanz',
            D: 'Autonomie',
            E: 'Kommunikation',
            F: 'Soziale Kompatibilit√§t'
        };

        function renderCategoryBars(containerId, categories) {
            const container = document.getElementById(containerId);
            if (!container) return;

            let html = '';
            for (const [cat, catData] of Object.entries(categories)) {
                const score = catData.score || 0;
                let colorClass = 'low';
                if (score >= 70) colorClass = 'good';
                else if (score >= 50) colorClass = 'moderate';

                html += `
                    <div class="category-bar-row clickable-bar" style="margin-bottom: 12px; cursor: pointer; padding: 8px; border-radius: 8px; transition: background 0.2s;" onclick="showCategoryDetails('${cat}')" onmouseover="this.style.background='rgba(255,255,255,0.05)'" onmouseout="this.style.background='transparent'">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px; align-items: center;">
                            <span style="font-size: 12px; color: var(--text-secondary);">${cat}: ${categoryNamesMap[cat]}</span>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; font-weight: 600;" class="${colorClass}">${score}%</span>
                                <span style="font-size: 10px; color: var(--text-muted);">‚Ñπ</span>
                            </div>
                        </div>
                        <div style="height: 6px; background: var(--bg-dark); border-radius: 3px; overflow: hidden;">
                            <div style="height: 100%; width: ${score}%; background: var(--${colorClass === 'good' ? 'primary' : colorClass === 'moderate' ? 'warning' : 'danger'}); border-radius: 3px;"></div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        // Desktop: Wrapper f√ºr Kompatibilit√§t
        function updateExpandableCategoryBars(categories) {
            renderCategoryBars('expandCategoryBars', categories);
        }

        function showArchetypeInfo(person) {
            console.log('showArchetypeInfo called with:', person);
            const archetype = person === 'ich' ? currentArchetype : selectedPartner;
            console.log('archetype:', archetype, 'data:', data);
            if (!data || !data.archetypes || !data.archetypes[archetype]) {
                console.error('Data not available for archetype:', archetype);
                return;
            }

            // Set current index for swipe navigation
            currentDefinitionIndex = archetypeOrder.indexOf(archetype);
            if (currentDefinitionIndex === -1) currentDefinitionIndex = 0;
            currentDefinitionPerson = person;

            // Use the shared function to render content
            showArchetypeInfoByType(archetype);

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Add touch swipe support
            const modal = document.querySelector('#definitionModal .modal');
            modal.ontouchstart = handleDefinitionTouchStart;
            modal.ontouchend = handleDefinitionTouchEnd;
        }

        function showCategoryDetails(cat) {
            if (!data || !data.categories || !data.categories[cat]) return;

            // Aktuelle Kategorie speichern f√ºr Navigation
            currentDisplayedCategory = cat;

            const catInfo = data.categories[cat];
            const catNames = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'N√§he-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilit√§t'
            };

            const ichArch = data.archetypes[currentArchetype];
            const partnerArch = data.archetypes[selectedPartner];
            const key = `${currentArchetype}_${selectedPartner}`;
            const interaction = data.interactions?.[key] || {};
            const catScore = interaction.scores?.[cat]?.value || 0;

            let scoreClass = 'low';
            let scoreText = 'Herausfordernd';
            if (catScore >= 70) { scoreClass = 'good'; scoreText = 'Gut'; }
            else if (catScore >= 50) { scoreClass = 'moderate'; scoreText = 'Mittel'; }

            let modalContent = `
                <div class="modal-category">
                    <div style="background: rgba(69,123,157,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="color: var(--text-secondary); font-size: 12px;">Aktuelle Kombination</span>
                            <span style="font-size: 18px; font-weight: 700; color: var(--${scoreClass === 'good' ? 'primary' : scoreClass === 'moderate' ? 'warning' : 'danger'});">${catScore}%</span>
                        </div>
                        <div style="font-size: 14px; font-weight: 600; color: var(--text-primary);">
                            <span style="color: #2ecc71;">${ichArch?.name || currentArchetype}</span>
                            <span style="color: var(--text-muted);"> √ó </span>
                            <span style="color: #e74c3c;">${partnerArch?.name || selectedPartner}</span>
                        </div>
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">${scoreText} in dieser Kategorie</div>
                    </div>

                    <div class="modal-category-header">
                        <div class="modal-category-letter">${cat}</div>
                        <div class="modal-category-name">${catNames[cat]}</div>
                    </div>
                    <div class="modal-category-desc">${catInfo.description || 'Keine Beschreibung verf√ºgbar.'}</div>
            `;

            if (catInfo.subDimensions && catInfo.subDimensions.length > 0) {
                modalContent += `
                    <div class="definition-section">
                        <div class="definition-section-title">Subdimensionen <span style="font-size: 10px; color: var(--text-muted);">(klicken f√ºr Details)</span></div>
                        <ul class="definition-list variants clickable-subs">
                            ${catInfo.subDimensions.map(sub => `<li onclick="showSubDimensionInfo('${cat}', '${sub.replace(/'/g, "\\'")}')" style="cursor: pointer; padding: 8px; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">${sub} <span style="color: var(--text-muted); font-size: 10px;">‚Üí</span></li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            modalContent += '</div>';

            document.getElementById('modalTitle').textContent = `Qualit√§tsmuster ${cat}: ${catNames[cat]}`;
            document.getElementById('modalBody').innerHTML = modalContent;
            document.getElementById('categoryModal').classList.add('active');
        }

        const subDimensionData = {
            "Exklusivit√§ts-Erwartung": {
                was: "Die Erwartung, der einzige romantische/sexuelle Partner zu sein.",
                warum: "Diese Dimension ist fundamental, weil unterschiedliche Erwartungen zu Entt√§uschung, Eifersucht und Vertrauensbr√ºchen f√ºhren k√∂nnen.",
                wozu: "Klare Erwartungen verhindern Missverst√§ndnisse und schaffen eine gemeinsame Basis f√ºr die Beziehungsgestaltung.",
                archetypen: {
                    single: "Flexibel - keine feste Erwartung, offen f√ºr verschiedene Modelle",
                    duo: "Hohe Erwartung an vollst√§ndige Exklusivit√§t",
                    duo_flex: "Grunds√§tzlich exklusiv, aber mit Ausnahmen nach Absprache",
                    solopoly: "Keine Exklusivit√§tserwartung - jede Beziehung ist eigenst√§ndig",
                    polyamor: "Bewusste Nicht-Exklusivit√§t mit klaren Strukturen",
                    ra: "Keine normativen Exklusivit√§tserwartungen - alles verhandelbar",
                    lat: "Flexibel - Exklusivit√§t ist unabh√§ngig von Wohnsituation",
                    aromantisch: "Romantische Exklusivit√§t nicht relevant - andere Verbindungen z√§hlen"
                }
            },
            "Offenheit f√ºr alternative Modelle": {
                was: "Die Bereitschaft, nicht-traditionelle Beziehungsformen zu akzeptieren oder auszuprobieren.",
                warum: "Unterschiedliche Offenheit kann zu Konflikten f√ºhren, wenn ein Partner expandieren m√∂chte und der andere nicht.",
                wozu: "Gemeinsame Offenheit erm√∂glicht Wachstum und Anpassung der Beziehung an ver√§nderte Bed√ºrfnisse.",
                archetypen: {
                    single: "Oft sehr offen - keine festgelegte Struktur",
                    duo: "Tendenziell geschlossen - Monogamie als Ideal",
                    duo_flex: "Moderat offen - bereit f√ºr situative Anpassungen",
                    solopoly: "Sehr offen - lebt bereits alternatives Modell",
                    polyamor: "Strukturiert offen - klare Rahmen f√ºr Vielfalt",
                    ra: "Maximal offen - alle Normen werden hinterfragt",
                    lat: "Moderat offen - alternative Wohnform wird bereits gelebt",
                    aromantisch: "Offen f√ºr alternative Beziehungsformen - Romantik ist nicht zentral"
                }
            },
            "Beziehung als Lebensinhalt vs. Lebensbereich": {
                was: "Wie zentral ist die Beziehung im Leben? Ist sie alles oder ein Teil von vielem?",
                warum: "Wenn einer die Beziehung als Lebensmittelpunkt sieht und der andere als Nebensache, entstehen ungleiche Investitionen.",
                wozu: "√Ñhnliche Priorisierung schafft Balance und verhindert das Gef√ºhl von Vernachl√§ssigung oder √úberforderung.",
                archetypen: {
                    single: "Lebensbereich - das eigene Leben steht im Zentrum",
                    duo: "Oft Lebensinhalt - die Beziehung ist sehr wichtig",
                    duo_flex: "Wichtiger Lebensbereich mit hoher Priorit√§t",
                    solopoly: "Klar Lebensbereich - das Selbst bleibt Zentrum",
                    polyamor: "Wichtiger Lebensbereich - aber mit mehreren Beziehungen",
                    ra: "Lebensbereich - Autonomie und Selbstbestimmung zentral",
                    lat: "Wichtiger Lebensbereich - aber eigener Raum ist essentiell",
                    aromantisch: "Lebensbereich - Freundschaften und andere Verbindungen zentral"
                }
            },
            "Definition von Treue": {
                was: "Was bedeutet 'treu sein' konkret? K√∂rperliche Exklusivit√§t, emotionale Treue, oder Ehrlichkeit?",
                warum: "Unterschiedliche Definitionen f√ºhren oft zu den schmerzhaftesten Missverst√§ndnissen in Beziehungen.",
                wozu: "Eine gemeinsame Definition von Treue schafft Klarheit und Vertrauen - unabh√§ngig davon, wie sie aussieht.",
                archetypen: {
                    single: "Flexibel - Treue ist kontextabh√§ngig",
                    duo: "Klassisch - k√∂rperliche UND emotionale Exklusivit√§t",
                    duo_flex: "Angepasst - emotionale Treue wichtiger als k√∂rperliche",
                    solopoly: "Neu definiert - Treue = Ehrlichkeit und Transparenz",
                    polyamor: "Strukturiert - Treue zu vereinbarten Regeln und Grenzen",
                    ra: "Individuell definiert - Treue ist nicht normativ vorgegeben",
                    lat: "Emotionale Treue wichtig - unabh√§ngig von Wohnsituation",
                    aromantisch: "Treue zu Absprachen - romantische Treue nicht relevant"
                }
            },
            "Ethische Grundhaltung": {
                was: "Die gemeinsamen Werte wie Ehrlichkeit, Respekt, Consent und Fairness.",
                warum: "Unterschiedliche ethische Grundhaltungen untergraben das Fundament jeder Beziehung und f√ºhren zu Vertrauensverlust.",
                wozu: "Geteilte ethische Werte schaffen ein sicheres Fundament f√ºr alle anderen Aspekte der Beziehung.",
                archetypen: {
                    single: "Individuell gepr√§gt - eigene ethische Standards",
                    duo: "Traditionell - gesellschaftliche Normen als Leitfaden",
                    duo_flex: "Reflektiert - bewusste Auseinandersetzung mit Normen",
                    solopoly: "Progressiv - aktive ethische Reflexion",
                    polyamor: "Strukturiert ethisch - klare Regeln f√ºr fairen Umgang",
                    ra: "Anarchisch-ethisch - Normen werden radikal hinterfragt",
                    lat: "Autonom-ethisch - Respekt vor individuellem Raum",
                    aromantisch: "Authentisch - Ehrlichkeit √ºber eigene Grenzen"
                }
            },
            "Verantwortungsbewusstsein": {
                was: "Die Bereitschaft, Verantwortung f√ºr eigene Handlungen und deren Auswirkungen zu √ºbernehmen.",
                warum: "Ohne Verantwortungsbewusstsein werden Fehler wiederholt und Partner verletzt.",
                wozu: "Verantwortung erm√∂glicht Wachstum, Reparatur nach Konflikten und nachhaltige Beziehungsqualit√§t.",
                archetypen: {
                    single: "Prim√§r f√ºr sich selbst verantwortlich",
                    duo: "Hohe gegenseitige Verantwortung erwartet",
                    duo_flex: "Balancierte Verantwortung mit Flexibilit√§t",
                    solopoly: "Selbstverantwortung betont, aber fair zu Partnern",
                    polyamor: "Komplexe Verantwortung f√ºr mehrere Beziehungen",
                    ra: "Hohe Selbstverantwortung - keine normativen Erwartungen",
                    lat: "Verantwortung f√ºr Beziehungsqualit√§t trotz Distanz",
                    aromantisch: "Verantwortung f√ºr klare Kommunikation der Grenzen"
                }
            },
            "Emotionale Verschmelzungs-Tendenz": {
                was: "Das Bed√ºrfnis, emotional mit dem Partner zu verschmelzen - von 'wir sind eins' bis 'wir sind zwei'.",
                warum: "Starke Unterschiede f√ºhren dazu, dass einer sich eingeengt und der andere sich abgelehnt f√ºhlt.",
                wozu: "√Ñhnliche Verschmelzungs-Pr√§ferenzen erm√∂glichen eine N√§he, die sich f√ºr beide richtig anf√ºhlt.",
                archetypen: {
                    single: "Niedrig - Autonomie steht vor Verschmelzung",
                    duo: "Oft hoch - 'Wir' als zentrale Identit√§t",
                    duo_flex: "Moderat - N√§he mit Grenzen",
                    solopoly: "Niedrig - bewusste Distanz zu Verschmelzung",
                    polyamor: "Differenziert - unterschiedlich mit verschiedenen Partnern",
                    ra: "Niedrig - Autonomie ist zentraler Wert",
                    lat: "Moderat - emotionale N√§he ohne r√§umliche Verschmelzung",
                    aromantisch: "Niedrig - romantische Verschmelzung nicht gew√ºnscht"
                }
            },
            "Physische N√§he-Bed√ºrfnisse": {
                was: "Wie viel k√∂rperliche Pr√§senz und N√§he braucht man? Zusammenleben, t√§glicher Kontakt, w√∂chentlich?",
                warum: "Mismatches f√ºhren zu Einsamkeit (bei zu wenig) oder Erstickung (bei zu viel).",
                wozu: "Abgestimmte N√§he-Bed√ºrfnisse erm√∂glichen, dass beide sich gesehen und respektiert f√ºhlen.",
                archetypen: {
                    single: "Flexibel - kein konstantes N√§he-Bed√ºrfnis",
                    duo: "Hoch - oft Wunsch nach Zusammenleben",
                    duo_flex: "Moderat bis hoch mit Freiraum-Phasen",
                    solopoly: "Bewusst niedrig - eigener Wohnraum wichtig",
                    polyamor: "Komplex - unterschiedliche N√§he mit verschiedenen Partnern",
                    ra: "Individuell verhandelbar - keine normativen Erwartungen",
                    lat: "Bewusst niedrig - getrennte Wohnungen als Prinzip",
                    aromantisch: "Variabel - nicht an romantische N√§he gebunden"
                }
            },
            "F√§higkeit, Raum zu geben": {
                was: "Die F√§higkeit, dem Partner Freiraum zu lassen ohne sich vernachl√§ssigt oder unsicher zu f√ºhlen.",
                warum: "Ohne diese F√§higkeit entstehen Kontrolle, Eifersucht und Erstickung der Beziehung.",
                wozu: "Raum geben k√∂nnen erm√∂glicht individuelle Entwicklung innerhalb der Beziehung.",
                archetypen: {
                    single: "Hoch - Raum ist selbstverst√§ndlich",
                    duo: "Muss oft gelernt werden - N√§he ist Standard",
                    duo_flex: "Bewusst entwickelt - wichtig f√ºr das Modell",
                    solopoly: "Sehr hoch - Teil der Grundphilosophie",
                    polyamor: "Essentiell - strukturell eingebaut",
                    ra: "Maximal - Autonomie als h√∂chster Wert",
                    lat: "Sehr hoch - r√§umlicher Freiraum ist zentral",
                    aromantisch: "Hoch - respektiert nicht-romantische Grenzen"
                }
            },
            "Individuelle Freiheit": {
                was: "Der Wert, den man pers√∂nlicher Freiheit in der Beziehung beimisst - eigene Entscheidungen, Hobbies, Freunde.",
                warum: "Unterschiedliche Freiheitsbed√ºrfnisse f√ºhren zu Machtk√§mpfen oder Entfremdung.",
                wozu: "Respektierte Freiheit erm√∂glicht authentisches Selbst und verhindert Resentment.",
                archetypen: {
                    single: "Maximale Freiheit - das Kernbed√ºrfnis",
                    duo: "Eingeschr√§nkt - Kompromisse erwartet",
                    duo_flex: "Balanciert - Freiheit mit R√ºcksichtnahme",
                    solopoly: "Maximal - Autonomie ist nicht verhandelbar",
                    polyamor: "Hoch - aber mit Verantwortung verbunden",
                    ra: "Maximal - Freiheit von allen Normen",
                    lat: "Hoch - r√§umliche Autonomie garantiert Freiheit",
                    aromantisch: "Hoch - Freiheit von romantischen Erwartungen"
                }
            },
            "Entscheidungsautonomie": {
                was: "Wer entscheidet was? Wie viel Mitsprache hat der Partner bei pers√∂nlichen Entscheidungen?",
                warum: "Konflikte entstehen, wenn einer Kontrolle erwartet und der andere Autonomie braucht.",
                wozu: "Klare Entscheidungsstrukturen verhindern Machtk√§mpfe und schaffen Klarheit.",
                archetypen: {
                    single: "Vollst√§ndig - alle Entscheidungen selbst",
                    duo: "Oft geteilt - wichtige Dinge gemeinsam",
                    duo_flex: "Hybrid - manche gemeinsam, manche allein",
                    solopoly: "Hoch - Autonomie auch in der Beziehung",
                    polyamor: "Komplex - unterschiedlich je nach Beziehung",
                    ra: "Maximal - keine externen Vorgaben akzeptiert",
                    lat: "Hoch - eigene Entscheidungen im eigenen Raum",
                    aromantisch: "Hoch - Entscheidungen nicht an romantischen Normen orientiert"
                }
            },
            "Akzeptanz der Autonomie des anderen": {
                was: "Die F√§higkeit zu akzeptieren, dass der Partner eigene Entscheidungen trifft - auch wenn man nicht zustimmt.",
                warum: "Fehlende Akzeptanz f√ºhrt zu Kontrolle, Manipulation und Vertrauensverlust.",
                wozu: "Akzeptanz erm√∂glicht echte Partnerschaft statt Abh√§ngigkeit.",
                archetypen: {
                    single: "Hoch - Autonomie wird gesch√§tzt",
                    duo: "Muss oft gelernt werden",
                    duo_flex: "Bewusst entwickelt",
                    solopoly: "Sehr hoch - zentral f√ºr das Modell",
                    polyamor: "Essentiell - ohne geht es nicht",
                    ra: "Maximal - Grundprinzip der Beziehungsphilosophie",
                    lat: "Hoch - respektiert r√§umliche Autonomie des anderen",
                    aromantisch: "Hoch - akzeptiert nicht-romantische Bed√ºrfnisse"
                }
            },
            "Kommunikationstiefe": {
                was: "Wie tief gehen Gespr√§che? Von Alltag bis zu √Ñngsten, Tr√§umen und Verletzlichkeit.",
                warum: "Unterschiedliche Tiefen-Pr√§ferenzen f√ºhren zu Frustration - einer will mehr, einer weniger.",
                wozu: "Passende Kommunikationstiefe schafft echte Verbindung und Verst√§ndnis.",
                archetypen: {
                    single: "Variabel - je nach Beziehung",
                    duo: "Oft hoch - alles teilen als Ideal",
                    duo_flex: "Selektiv tief - wichtiges wird geteilt",
                    solopoly: "Bewusst tief - Kommunikation ist essentiell",
                    polyamor: "Hoch - Komplexit√§t erfordert Kommunikation",
                    ra: "Individuell - keine normativen Erwartungen an Tiefe",
                    lat: "Qualit√§tsfokussiert - tiefe Gespr√§che in begrenzter Zeit",
                    aromantisch: "Authentisch - tiefe Verbindung ohne romantische Komponente"
                }
            },
            "Konfliktf√§higkeit": {
                was: "Wie geht man mit Konflikten um? Vermeidung, Eskalation, konstruktive L√∂sung?",
                warum: "Unterschiedliche Stile f√ºhren dazu, dass Konflikte ungel√∂st bleiben oder eskalieren.",
                wozu: "Kompatible Konfliktf√§higkeit erm√∂glicht Wachstum durch Krisen statt Zerst√∂rung.",
                archetypen: {
                    single: "Kann Konflikte vermeiden durch Distanz",
                    duo: "Muss Konflikte l√∂sen - kein Entkommen",
                    duo_flex: "Flexibel - manchmal Distanz, manchmal L√∂sung",
                    solopoly: "Klar - bei Unl√∂sbarkeit kann man gehen",
                    polyamor: "Entwickelt - Kommunikation als L√∂sung",
                    ra: "Individuell - keine externen Konfliktl√∂sungsmodelle",
                    lat: "Distanz m√∂glich - r√§umliche Trennung als Puffer",
                    aromantisch: "Sachlich - nicht-romantische Konfliktl√∂sung"
                }
            },
            "Emotionale Transparenz": {
                was: "Wie offen teilt man Gef√ºhle? Alles aussprechen oder manches f√ºr sich behalten?",
                warum: "Unterschiede f√ºhren zu Missverst√§ndnissen - einer f√ºhlt sich verschlossen, der andere √ºberfordert.",
                wozu: "Abgestimmte Transparenz schafft Vertrauen ohne √úberforderung.",
                archetypen: {
                    single: "Selektiv - teilt was n√∂tig ist",
                    duo: "Oft hohe Erwartung an Transparenz",
                    duo_flex: "Balanciert - wichtiges wird geteilt",
                    solopoly: "Hoch - Ehrlichkeit ist zentral",
                    polyamor: "Sehr hoch - Basis des Modells",
                    ra: "Individuell - keine normativen Transparenz-Erwartungen",
                    lat: "Qualitativ - tiefe Gespr√§che in begrenzter Zeit",
                    aromantisch: "Ehrlich - klar √ºber eigene Grenzen"
                }
            },
            "Gesellschaftliche Akzeptanz": {
                was: "Wie wichtig ist es, dass Familie, Freunde und Gesellschaft die Beziehung akzeptieren?",
                warum: "Unterschiedliche Wichtigkeit f√ºhrt zu Konflikten √ºber 'Outing' und √∂ffentliches Auftreten.",
                wozu: "√Ñhnliche Wichtigkeit erm√∂glicht einen gemeinsamen Umgang mit dem sozialen Umfeld.",
                archetypen: {
                    single: "Unkompliziert - gesellschaftlich akzeptiert",
                    duo: "Sehr wichtig - passt zur Norm",
                    duo_flex: "Moderat - gewisse Erkl√§rungen n√∂tig",
                    solopoly: "Weniger wichtig - lebt gegen die Norm",
                    polyamor: "Komplex - manche Offenheit, manche Diskretion",
                    ra: "Unwichtig - gesellschaftliche Normen werden abgelehnt",
                    lat: "Erkl√§rungsbed√ºrftig - 'Warum wohnt ihr nicht zusammen?'",
                    aromantisch: "Herausfordernd - romantische Norm ist tief verankert"
                }
            },
            "Integration in soziale Kreise": {
                was: "Wie wird die Beziehung in Freundeskreis, Familie und Arbeit integriert und pr√§sentiert?",
                warum: "Unterschiede f√ºhren zu Frustration - einer will pr√§sentieren, der andere verstecken.",
                wozu: "Gemeinsame Strategien f√ºr soziale Integration schaffen ein einheitliches Auftreten.",
                archetypen: {
                    single: "Einfach - keine komplexe Integration n√∂tig",
                    duo: "Vollst√§ndig - Partner wird √ºberall eingef√ºhrt",
                    duo_flex: "Weitgehend - mit gewissen Grenzen",
                    solopoly: "Selektiv - nicht √ºberall erkl√§rbar",
                    polyamor: "Komplex - unterschiedlich je nach Umfeld",
                    ra: "Individuell - Integration nach eigenen Regeln",
                    lat: "Erkl√§rungsbed√ºrftig - getrennte Wohnungen irritieren",
                    aromantisch: "Herausfordernd - 'Nur Freunde?' wird oft missverstanden"
                }
            },
            "Umgang mit Stigma": {
                was: "Wie geht man mit negativen Reaktionen auf die Beziehungsform um? Erkl√§ren, ignorieren, k√§mpfen?",
                warum: "Unterschiedliche Strategien f√ºhren zu Konflikten dar√ºber, wie man als Paar auftritt.",
                wozu: "Gemeinsame Strategie st√§rkt die Beziehung gegen √§u√üeren Druck.",
                archetypen: {
                    single: "Kaum Stigma - gesellschaftlich normal",
                    duo: "Kein Stigma - das Ideal der Gesellschaft",
                    duo_flex: "Leichtes Stigma - 'offene Beziehung'",
                    solopoly: "Erhebliches Stigma - schwer erkl√§rbar",
                    polyamor: "Stigma vorhanden - aber zunehmend bekannt",
                    ra: "Hohes Stigma - radikale Position wird missverstanden",
                    lat: "Moderates Stigma - 'echte' Beziehung in Frage gestellt",
                    aromantisch: "Hohes Stigma - wird als Defizit wahrgenommen"
                }
            }
        };

        function showSubDimensionInfo(cat, subName) {
            const subData = subDimensionData[subName] || { was: "Keine Beschreibung verf√ºgbar.", warum: "", wozu: "", archetypen: {} };
            const catNames = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'N√§he-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilit√§t'
            };

            const ichArch = data?.archetypes?.[currentArchetype];
            const partnerArch = data?.archetypes?.[selectedPartner];
            const ichId = currentArchetype;
            const partnerId = selectedPartner;

            const ichPerspektive = subData.archetypen?.[ichId] || "Keine Daten";
            const partnerPerspektive = subData.archetypen?.[partnerId] || "Keine Daten";

            let modalContent = `
                <div style="background: rgba(69,123,157,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted);">Teil von Qualit√§tsmuster ${cat}: ${catNames[cat]}</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WAS?</div>
                    <p style="color: var(--text-primary); line-height: 1.5;">${subData.was}</p>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WARUM WICHTIG?</div>
                    <p style="color: var(--text-secondary); line-height: 1.5;">${subData.warum}</p>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">WOZU?</div>
                    <p style="color: var(--text-secondary); line-height: 1.5;">${subData.wozu}</p>
                </div>

                <div style="background: rgba(46,204,113,0.1); padding: 12px; border-radius: 10px; margin-bottom: 10px;">
                    <div style="font-size: 12px; color: #2ecc71; font-weight: 600; margin-bottom: 8px;">ICH (${ichArch?.name || ichId}):</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${ichPerspektive}</p>
                </div>

                <div style="background: rgba(231,76,60,0.1); padding: 12px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="font-size: 12px; color: #e74c3c; font-weight: 600; margin-bottom: 8px;">PARTNER (${partnerArch?.name || partnerId}):</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${partnerPerspektive}</p>
                </div>

                <div style="background: rgba(108, 117, 125, 0.1); padding: 12px; border-radius: 10px;">
                    <div style="font-size: 12px; color: #6c757d; font-weight: 600; margin-bottom: 8px;">BEDEUTUNG F√úR EURE KOMBINATION:</div>
                    <p style="color: var(--text-secondary); font-size: 12px; line-height: 1.5;">${generateCombinationAnalysis(ichId, partnerId, subName, subData)}</p>
                </div>
            `;

            document.getElementById('modalTitle').textContent = subName;
            document.getElementById('modalBody').innerHTML = modalContent;
        }

        function generateCombinationAnalysis(ichId, partnerId, subName, subData) {
            if (ichId === partnerId) {
                return `Da ihr beide denselben Archetyp habt, solltet ihr hier √§hnliche Vorstellungen haben. Das reduziert Konfliktpotential in dieser Dimension erheblich.`;
            }

            const polyTypes = ['solopoly', 'polyamor', 'ra'];
            const monoTypes = ['single', 'duo', 'duo_flex', 'lat', 'aromantisch'];
            const ichIsPoly = polyTypes.includes(ichId);
            const partnerIsPoly = polyTypes.includes(partnerId);

            if (ichIsPoly !== partnerIsPoly) {
                return `Hier treffen fundamental unterschiedliche Weltanschauungen aufeinander. Ein Poly-Typ und ein Mono-Typ haben oft gegens√§tzliche Perspektiven auf "${subName}". Intensive Kommunikation und gegenseitiges Verst√§ndnis sind essentiell.`;
            }

            if (ichIsPoly && partnerIsPoly) {
                return `Als zwei Poly-Typen teilt ihr grunds√§tzlich √§hnliche Werte in dieser Dimension. Die Unterschiede liegen eher in der konkreten Ausgestaltung als in den Grundprinzipien.`;
            }

            return `Eure Archetypen haben unterschiedliche Schwerpunkte in dieser Dimension. Offene Gespr√§che dar√ºber, was euch beiden wichtig ist, helfen, gemeinsame L√∂sungen zu finden.`;
        }

        // NEU: Generiere dynamische Pro/Contra aus Micro-Statements
        function generateDynamicProContra(type1, type2, dims1, dims2) {
            const pro = [];
            const contra = [];

            // 1. Archetyp-basierte Pro/Contra
            const archStatements = getArchetypeStatements(type1, type2);
            if (archStatements) {
                pro.push(...(archStatements.pro || []));
                contra.push(...(archStatements.contra || []));
            }

            // 2. Dominanz-basierte Pro/Contra hinzuf√ºgen
            const domStatements = getDominanceStatements(dims1?.dominanz, dims2?.dominanz);
            if (domStatements && domStatements.pro) {
                // F√ºge nur die relevantesten hinzu, um Doppelungen zu vermeiden
                domStatements.pro.slice(0, 2).forEach(p => {
                    if (!pro.includes(p)) pro.push(p);
                });
            }
            if (domStatements && domStatements.contra) {
                domStatements.contra.slice(0, 2).forEach(c => {
                    if (!contra.includes(c)) contra.push(c);
                });
            }

            return { pro, contra };
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // KOMBINIERTES SYNTHESE-SYSTEM (A+B+C)
        // A) Score ‚Üí Tonalit√§t (positiv/neutral/kritisch)
        // B) Hash aus 4 Faktoren ‚Üí deterministische Variation
        // C) 6 Kategorien + Templates ‚Üí Zusammenf√ºhrung
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * Berechnet einen deterministischen Hash aus den 4 Faktoren
         * Gibt einen Index zur√ºck, der f√ºr Statement-Auswahl verwendet wird
         */
        function getFactorHash(archetypScore, dominanzScore, orientierungScore, geschlechtScore) {
            // Einfacher aber deterministischer Hash basierend auf allen 4 Faktoren
            const combined = (archetypScore * 1000000) + (dominanzScore * 10000) + (orientierungScore * 100) + geschlechtScore;
            // Verwende Modulo um einen Index zu bekommen
            return combined;
        }

        /**
         * W√§hlt ein Statement deterministisch aus einem Array basierend auf Hash
         */
        function selectStatementByHash(statements, hash) {
            if (!statements || statements.length === 0) return null;
            const index = hash % statements.length;
            return statements[index];
        }

        /**
         * Bestimmt die Tonalit√§t basierend auf dem Gesamtscore
         * @returns 'positiv' | 'neutral' | 'kritisch'
         */
        function getTonality(score) {
            if (score >= 70) return 'positiv';
            if (score >= 50) return 'neutral';
            return 'kritisch';
        }

        /**
         * Tonalit√§ts-Templates f√ºr die Synthese-Einleitungen
         */
        const tonalityTemplates = {
            positiv: {
                pathos: [
                    "Eine vielversprechende Resonanz entsteht zwischen euch.",
                    "Die emotionale Chemie deutet auf tiefes Potenzial hin.",
                    "Eure Energien harmonieren auf einer fundamentalen Ebene."
                ],
                logos: [
                    "Die strukturelle Kompatibilit√§t bildet eine solide Basis.",
                    "Eure Beziehungsphilosophien erg√§nzen sich konstruktiv.",
                    "Das rationale Fundament erm√∂glicht fruchtbare Kommunikation."
                ]
            },
            neutral: {
                pathos: [
                    "Eine interessante Dynamik entfaltet sich zwischen euch.",
                    "Die emotionale Landschaft bietet sowohl Chancen als auch Herausforderungen.",
                    "Eure Energien begegnen sich ‚Äì was daraus wird, liegt in euren H√§nden."
                ],
                logos: [
                    "Die strukturellen Unterschiede erfordern bewusste Navigation.",
                    "Eure Beziehungsvorstellungen haben √úberschneidungen, aber auch Differenzen.",
                    "Dialog und Kl√§rung werden wichtig sein f√ºr das gegenseitige Verst√§ndnis."
                ]
            },
            kritisch: {
                pathos: [
                    "Die emotionalen Welten prallen aufeinander.",
                    "Spannungen auf der Gef√ºhlsebene sind zu erwarten.",
                    "Die unterschiedlichen emotionalen Bed√ºrfnisse erfordern besondere Achtsamkeit."
                ],
                logos: [
                    "Fundamentale Unterschiede in den Beziehungsvorstellungen werden sichtbar.",
                    "Die strukturellen Differenzen stellen eine erhebliche Herausforderung dar.",
                    "Grundlegende Gespr√§che √ºber Erwartungen sind unerl√§sslich."
                ]
            }
        };

        /**
         * Kategorie-spezifische Synthese-Bausteine f√ºr die 6 Bereiche
         */
        const categorySynthesisTemplates = {
            A: { // Beziehungsphilosophie
                name: "Beziehungsphilosophie",
                positiv: "Eure Grundhaltungen zu Beziehungen harmonieren.",
                neutral: "Eure Beziehungsphilosophien haben gemeinsame Punkte, aber auch Unterschiede.",
                kritisch: "Fundamentale Differenzen in der Beziehungsphilosophie erfordern Kl√§rung."
            },
            B: { // Werte-Alignment
                name: "Werte-Alignment",
                positiv: "Geteilte Werte bilden ein stabiles Fundament.",
                neutral: "Manche Werte teilt ihr, andere unterscheiden sich.",
                kritisch: "Unterschiedliche Wertevorstellungen k√∂nnen zu Konflikten f√ºhren."
            },
            C: { // N√§he-Distanz
                name: "N√§he-Distanz",
                positiv: "Eure Bed√ºrfnisse nach N√§he und Raum passen gut zusammen.",
                neutral: "Die Balance zwischen N√§he und Distanz wird Kommunikation erfordern.",
                kritisch: "Unterschiedliche N√§he-Distanz-Bed√ºrfnisse k√∂nnen Spannung erzeugen."
            },
            D: { // Autonomie
                name: "Autonomie",
                positiv: "Ihr respektiert gegenseitig eure Unabh√§ngigkeit.",
                neutral: "Das Autonomie-Verst√§ndnis bedarf weiterer Abstimmung.",
                kritisch: "Konfliktpotenzial bei unterschiedlichen Autonomie-Erwartungen."
            },
            E: { // Kommunikation
                name: "Kommunikation",
                positiv: "Die Basis f√ºr fruchtbaren Dialog ist gegeben.",
                neutral: "Kommunikationsstile unterscheiden sich ‚Äì Anpassung m√∂glich.",
                kritisch: "Unterschiedliche Kommunikationsweisen k√∂nnen Missverst√§ndnisse erzeugen."
            },
            F: { // Soziale Kompatibilit√§t
                name: "Soziale Kompatibilit√§t",
                positiv: "Soziale Vorstellungen und Umfelder harmonieren.",
                neutral: "Soziale Kompatibilit√§t ist teilweise gegeben.",
                kritisch: "Unterschiedliche soziale Erwartungen k√∂nnen belasten."
            }
        };

        /**
         * Generiert detaillierte Pathos-Inhalte mit ICH/Partner/Synthese Struktur
         * Nutzt PathosTextGenerator f√ºr flie√üende, poetische Texte
         * @returns {Object} { ich, partner, synthese, resonanz }
         */
        function generateDetailedPathos(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            const ichId = ichArch?.id || currentArchetype || '';
            const partnerId = partnerArch?.id || selectedPartner || '';

            // Berechne die 4 Faktor-Scores
            const person1 = {
                archetyp: ichId,
                dominanz: personDimensions.ich?.dominanz,
                orientierung: personDimensions.ich?.orientierung,
                geschlecht: personDimensions.ich?.geschlecht,
                orientierungStatus: personDimensions.ich?.orientierungStatus
            };
            const person2 = {
                archetyp: partnerId,
                dominanz: personDimensions.partner?.dominanz,
                orientierung: personDimensions.partner?.orientierung,
                geschlecht: personDimensions.partner?.geschlecht,
                orientierungStatus: personDimensions.partner?.orientierungStatus
            };

            // Hole Score-Breakdown
            const qualityResult = calculateRelationshipQuality(person1, person2);
            const breakdown = qualityResult.breakdown || { archetyp: 50, dominanz: 75, orientierung: 100, geschlecht: 100 };
            const overallScore = qualityResult.score || 50;
            const resonanzData = qualityResult.resonanz;
            const tonality = getTonality(overallScore);

            // Hole Statement-Quellen
            const archStatements = getArchetypeStatements(ichId, partnerId);
            const domStatements = getDominanceStatements(person1.dominanz, person2.dominanz);
            const orientStatements = getOrientierungStatements(person1.orientierung, person2.orientierung, person1.geschlecht, person2.geschlecht);

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // NUTZE PATHOS TEXT GENERATOR (wenn verf√ºgbar)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (typeof PathosTextGenerator !== 'undefined') {
                // Generiere deterministischen Hash f√ºr Varianz
                const seed = PathosTextGenerator.generateHash(
                    ichId, partnerId,
                    person1.dominanz || 'none',
                    person2.dominanz || 'none',
                    overallScore
                );

                // ICH BRINGT MIT - Poetischer Flie√ütext
                const ichText = PathosTextGenerator.generatePersonText(
                    ichArch,
                    personDimensions.ich,
                    ichName,
                    seed
                );

                // PARTNER BRINGT MIT - Poetischer Flie√ütext
                const partnerText = PathosTextGenerator.generatePersonText(
                    partnerArch,
                    personDimensions.partner,
                    partnerName,
                    seed + 100
                );

                // DARAUS ENTSTEHT - Poetische Synthese
                const syntheseText = PathosTextGenerator.generateSyntheseText({
                    ichArch,
                    partnerArch,
                    ichName,
                    partnerName,
                    ichDimensions: personDimensions.ich,
                    partnerDimensions: personDimensions.partner,
                    overallScore,
                    archStatements,
                    domStatements,
                    orientStatements,
                    seed
                });

                // RESONANZ - Poetische Interpretation
                let resonanzText = null;
                if (resonanzData && resonanzData.R !== undefined) {
                    resonanzText = PathosTextGenerator.generateResonanzText(
                        resonanzData.R,
                        seed + 200
                    );
                }

                return {
                    ich: ichText,
                    partner: partnerText,
                    synthese: syntheseText,
                    resonanz: resonanzText,
                    score: overallScore,
                    tonality: tonality
                };
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // FALLBACK: Original-Logik (wenn PathosTextGenerator nicht geladen)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const hash = getFactorHash(breakdown.archetyp, breakdown.dominanz, breakdown.orientierung, breakdown.geschlecht);

            // ICH BRINGT MIT
            const ichParts = [];
            if (ichArch?.pirsig?.dynamicQuality !== undefined) {
                const dynQual = ichArch.pirsig.dynamicQuality;
                if (dynQual >= 0.7) {
                    ichParts.push(`${ichName} bringt eine hohe dynamische Energie mit ‚Äì offen f√ºr Ver√§nderung und spontane Verbindung.`);
                } else if (dynQual >= 0.4) {
                    ichParts.push(`${ichName} balanciert zwischen Stabilit√§t und Beweglichkeit in der emotionalen Welt.`);
                } else {
                    ichParts.push(`${ichName} sucht emotionale Tiefe durch Best√§ndigkeit und vertraute Muster.`);
                }
            }
            if (ichArch?.osho?.naturalness >= 0.7) {
                ichParts.push(`Emotionale Authentizit√§t steht im Vordergrund ‚Äì ${ichName} folgt dem nat√ºrlichen Fluss der Gef√ºhle.`);
            }
            const ichDom = person1.dominanz;
            if (ichDom) {
                const domText = {
                    'dominant': `Als F√ºhrende/r tr√§gt ${ichName} eine aktive emotionale Energie.`,
                    'submissiv': `${ichName} bringt eine empf√§ngliche, hingebungsvolle Qualit√§t mit.`,
                    'switch': `${ichName} ist flexibel in der emotionalen Dynamik ‚Äì mal f√ºhrend, mal folgend.`,
                    'ausgeglichen': `${ichName} strebt nach emotionalem Gleichgewicht in der Verbindung.`
                };
                if (domText[ichDom]) ichParts.push(domText[ichDom]);
            }
            if (ichArch?.coreValues?.length) {
                ichParts.push(`Kernwerte wie ${ichArch.coreValues.slice(0, 2).join(' und ')} pr√§gen das emotionale Erleben.`);
            }

            // PARTNER BRINGT MIT
            const partnerParts = [];
            if (partnerArch?.pirsig?.dynamicQuality !== undefined) {
                const dynQual = partnerArch.pirsig.dynamicQuality;
                if (dynQual >= 0.7) {
                    partnerParts.push(`${partnerName} bringt eine hohe dynamische Energie mit ‚Äì offen f√ºr Ver√§nderung und spontane Verbindung.`);
                } else if (dynQual >= 0.4) {
                    partnerParts.push(`${partnerName} balanciert zwischen Stabilit√§t und Beweglichkeit in der emotionalen Welt.`);
                } else {
                    partnerParts.push(`${partnerName} sucht emotionale Tiefe durch Best√§ndigkeit und vertraute Muster.`);
                }
            }
            if (partnerArch?.osho?.naturalness >= 0.7) {
                partnerParts.push(`Emotionale Authentizit√§t steht im Vordergrund ‚Äì ${partnerName} folgt dem nat√ºrlichen Fluss der Gef√ºhle.`);
            }
            const partnerDom = person2.dominanz;
            if (partnerDom) {
                const domText = {
                    'dominant': `Als F√ºhrende/r tr√§gt ${partnerName} eine aktive emotionale Energie.`,
                    'submissiv': `${partnerName} bringt eine empf√§ngliche, hingebungsvolle Qualit√§t mit.`,
                    'switch': `${partnerName} ist flexibel in der emotionalen Dynamik ‚Äì mal f√ºhrend, mal folgend.`,
                    'ausgeglichen': `${partnerName} strebt nach emotionalem Gleichgewicht in der Verbindung.`
                };
                if (domText[partnerDom]) partnerParts.push(domText[partnerDom]);
            }
            if (partnerArch?.coreValues?.length) {
                partnerParts.push(`Kernwerte wie ${partnerArch.coreValues.slice(0, 2).join(' und ')} pr√§gen das emotionale Erleben.`);
            }

            // SYNTHESE
            const syntheseParts = [];
            const tonalityIntro = selectStatementByHash(tonalityTemplates[tonality].pathos, hash);
            if (tonalityIntro) syntheseParts.push(tonalityIntro);
            if (archStatements?.pathos) {
                const allPathos = [...(archStatements.pathos.gemeinsam || []), ...(archStatements.pathos.spannung || [])];
                const selected = selectStatementByHash(allPathos, hash + 7);
                if (selected) syntheseParts.push(selected);
            }
            if (domStatements?.pathos?.length) {
                syntheseParts.push(selectStatementByHash(domStatements.pathos, hash + 11));
            }
            const ichDyn = ichArch?.pirsig?.dynamicQuality || 0.5;
            const partnerDyn = partnerArch?.pirsig?.dynamicQuality || 0.5;
            if (Math.abs(ichDyn - partnerDyn) < 0.2) {
                syntheseParts.push(`Beide schwingen auf einer √§hnlichen emotionalen Frequenz.`);
            }
            if (syntheseParts.length === 0) {
                syntheseParts.push(`${ichName} und ${partnerName} k√∂nnen emotional zueinander finden.`);
            }

            // RESONANZ
            let resonanzText = null;
            if (resonanzData?.R !== undefined) {
                const R = resonanzData.R;
                if (R >= 1.05) resonanzText = `Hohe emotionale Resonanz (R=${R.toFixed(2)}): Pathos und Logos harmonieren.`;
                else if (R >= 0.95) resonanzText = `Gute Resonanz (R=${R.toFixed(2)}): Emotionale und rationale Ebene im Gleichgewicht.`;
                else resonanzText = `Resonanz R=${R.toFixed(2)}: Die Wellenl√§ngen sind noch nicht vollst√§ndig abgestimmt.`;
            }

            return {
                ich: ichParts.join(' '),
                partner: partnerParts.join(' '),
                synthese: syntheseParts.join(' '),
                resonanz: resonanzText,
                score: overallScore,
                tonality: tonality
            };
        }

        // Legacy-Wrapper f√ºr Kompatibilit√§t
        function generateCombinedPathos(ichArch, partnerArch) {
            const detailed = generateDetailedPathos(ichArch, partnerArch);
            return detailed.synthese;
        }

        /**
         * Generiert detaillierte Logos-Inhalte mit ICH/Partner/Synthese Struktur
         * Nutzt LogosTextGenerator f√ºr flie√üende, analytische Texte
         * @returns {Object} { ich, partner, synthese, resonanz }
         */
        function generateDetailedLogos(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            const ichId = ichArch?.id || currentArchetype || '';
            const partnerId = partnerArch?.id || selectedPartner || '';

            // Berechne die 4 Faktor-Scores
            const person1 = {
                archetyp: ichId,
                dominanz: personDimensions.ich?.dominanz,
                orientierung: personDimensions.ich?.orientierung,
                geschlecht: personDimensions.ich?.geschlecht,
                orientierungStatus: personDimensions.ich?.orientierungStatus
            };
            const person2 = {
                archetyp: partnerId,
                dominanz: personDimensions.partner?.dominanz,
                orientierung: personDimensions.partner?.orientierung,
                geschlecht: personDimensions.partner?.geschlecht,
                orientierungStatus: personDimensions.partner?.orientierungStatus
            };

            // Hole Score-Breakdown
            const qualityResult = calculateRelationshipQuality(person1, person2);
            const breakdown = qualityResult.breakdown || { archetyp: 50, dominanz: 75, orientierung: 100, geschlecht: 100 };
            const overallScore = qualityResult.score || 50;
            const resonanzData = qualityResult.resonanz;
            const tonality = getTonality(overallScore);

            // Get category scores
            const key = `${ichId}_${partnerId}`;
            const interaction = data?.interactions?.[key];
            const categoryScores = interaction?.scores || {};

            // Hole Statement-Quellen
            const archStatements = getArchetypeStatements(ichId, partnerId);

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // NUTZE LOGOS TEXT GENERATOR (wenn verf√ºgbar)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (typeof LogosTextGenerator !== 'undefined') {
                // Generiere deterministischen Hash f√ºr Varianz
                const seed = LogosTextGenerator.generateHash(
                    ichId, partnerId,
                    person1.dominanz || 'none',
                    person2.dominanz || 'none',
                    overallScore
                );

                // ICH BRINGT MIT - Analytischer Flie√ütext
                const ichText = LogosTextGenerator.generatePersonText(
                    ichArch,
                    personDimensions.ich,
                    ichName,
                    seed
                );

                // PARTNER BRINGT MIT - Analytischer Flie√ütext
                const partnerText = LogosTextGenerator.generatePersonText(
                    partnerArch,
                    personDimensions.partner,
                    partnerName,
                    seed + 100
                );

                // DARAUS ENTSTEHT - Analytische Synthese
                const syntheseText = LogosTextGenerator.generateSyntheseText({
                    ichArch,
                    partnerArch,
                    ichName,
                    partnerName,
                    ichDimensions: personDimensions.ich,
                    partnerDimensions: personDimensions.partner,
                    overallScore,
                    archStatements,
                    categoryScores,
                    seed
                });

                // RESONANZ - Analytische Interpretation
                let resonanzText = null;
                if (resonanzData && resonanzData.R !== undefined) {
                    resonanzText = LogosTextGenerator.generateResonanzText(
                        resonanzData.R,
                        seed + 200
                    );
                }

                return {
                    ich: ichText,
                    partner: partnerText,
                    synthese: syntheseText,
                    resonanz: resonanzText,
                    score: overallScore,
                    tonality: tonality
                };
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // FALLBACK: Original-Logik (wenn LogosTextGenerator nicht geladen)
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const hash = getFactorHash(breakdown.archetyp, breakdown.dominanz, breakdown.orientierung, breakdown.geschlecht);

            // ICH BRINGT MIT
            const ichParts = [];
            if (ichArch?.pirsig?.staticQuality !== undefined) {
                const statQual = ichArch.pirsig.staticQuality;
                if (statQual >= 0.7) {
                    ichParts.push(`${ichName} bringt klare Strukturen und feste Werte mit ‚Äì Verl√§sslichkeit ist ein Grundpfeiler.`);
                } else if (statQual >= 0.4) {
                    ichParts.push(`${ichName} balanciert zwischen festen √úberzeugungen und Offenheit f√ºr neue Perspektiven.`);
                } else {
                    ichParts.push(`${ichName} bevorzugt Flexibilit√§t √ºber starre Regeln.`);
                }
            }
            if (ichArch?.coreValues?.length) {
                ichParts.push(`Kernwerte: ${ichArch.coreValues.slice(0, 3).join(', ')}.`);
            }
            if (ichArch?.avoids?.length) {
                ichParts.push(`Vermeidet: ${ichArch.avoids.slice(0, 2).join(' und ')}.`);
            }
            const ichGfk = personDimensions.ich?.gfk;
            if (ichGfk) {
                const gfkText = {
                    'hoch': `GFK-Kompetenz: hoch.`,
                    'mittel': `GFK-Kompetenz: mittel.`,
                    'niedrig': `GFK-Kompetenz: niedrig.`
                };
                if (gfkText[ichGfk]) ichParts.push(gfkText[ichGfk]);
            }

            // PARTNER BRINGT MIT
            const partnerParts = [];
            if (partnerArch?.pirsig?.staticQuality !== undefined) {
                const statQual = partnerArch.pirsig.staticQuality;
                if (statQual >= 0.7) {
                    partnerParts.push(`${partnerName} bringt klare Strukturen und feste Werte mit.`);
                } else if (statQual >= 0.4) {
                    partnerParts.push(`${partnerName} balanciert zwischen Struktur und Flexibilit√§t.`);
                } else {
                    partnerParts.push(`${partnerName} bevorzugt adaptive Strukturen.`);
                }
            }
            if (partnerArch?.coreValues?.length) {
                partnerParts.push(`Kernwerte: ${partnerArch.coreValues.slice(0, 3).join(', ')}.`);
            }
            if (partnerArch?.avoids?.length) {
                partnerParts.push(`Vermeidet: ${partnerArch.avoids.slice(0, 2).join(' und ')}.`);
            }
            const partnerGfk = personDimensions.partner?.gfk;
            if (partnerGfk) {
                const gfkText = {
                    'hoch': `GFK-Kompetenz: hoch.`,
                    'mittel': `GFK-Kompetenz: mittel.`,
                    'niedrig': `GFK-Kompetenz: niedrig.`
                };
                if (gfkText[partnerGfk]) partnerParts.push(gfkText[partnerGfk]);
            }

            // SYNTHESE
            const syntheseParts = [];
            const tonalityIntro = selectStatementByHash(tonalityTemplates[tonality].logos, hash);
            if (tonalityIntro) syntheseParts.push(tonalityIntro);
            if (archStatements?.logos) {
                const allLogos = [...(archStatements.logos.gemeinsam || []), ...(archStatements.logos.unterschied || [])];
                const selected = selectStatementByHash(allLogos, hash + 7);
                if (selected) syntheseParts.push(selected);
            }
            const ichStat = ichArch?.pirsig?.staticQuality || 0.5;
            const partnerStat = partnerArch?.pirsig?.staticQuality || 0.5;
            if (Math.abs(ichStat - partnerStat) < 0.2) {
                syntheseParts.push(`√Ñhnliches Strukturbed√ºrfnis erleichtert die Abstimmung.`);
            }
            if (syntheseParts.length === 0) {
                syntheseParts.push(`${ichName} und ${partnerName} haben Potenzial f√ºr eine tragf√§hige Basis.`);
            }

            // RESONANZ
            let resonanzText = null;
            if (resonanzData?.R !== undefined) {
                const R = resonanzData.R;
                if (R >= 1.05) resonanzText = `Resonanz R=${R.toFixed(2)}: Hohe strukturelle √úbereinstimmung.`;
                else if (R >= 0.95) resonanzText = `Resonanz R=${R.toFixed(2)}: Gute Kompatibilit√§t.`;
                else resonanzText = `Resonanz R=${R.toFixed(2)}: Erfordert bewusste Abstimmung.`;
            }

            return {
                ich: ichParts.join(' '),
                partner: partnerParts.join(' '),
                synthese: syntheseParts.join(' '),
                resonanz: resonanzText,
                score: overallScore,
                tonality: tonality
            };
        }

        // Legacy-Wrapper f√ºr Kompatibilit√§t
        function generateCombinedLogos(ichArch, partnerArch) {
            const detailed = generateDetailedLogos(ichArch, partnerArch);
            return detailed.synthese;
        }

        // Legacy-Funktion f√ºr Kompatibilit√§t (wird nicht mehr verwendet)
        function generateCombinedLogos_legacy(ichArch, partnerArch) {
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';
            // Use global archetype keys as IDs since archetypeDefinitions doesn't have id property
            const ichId = ichArch?.id || currentArchetype || '';
            const partnerId = partnerArch?.id || selectedPartner || '';

            // Get philosophy score from compatibility matrix
            const key = `${ichId}_${partnerId}`;
            const interaction = data?.interactions?.[key];
            const philScore = interaction?.scores?.A?.value || interaction?.overall || 50;

            // Hole Statements aus der Datenbank
            const archStatements = getArchetypeStatements(ichId, partnerId);
            const domStatements = getDominanceStatements(
                personDimensions.ich?.dominanz,
                personDimensions.partner?.dominanz
            );
            const orientStatements = getOrientierungStatements(
                personDimensions.ich?.orientierung,
                personDimensions.partner?.orientierung,
                personDimensions.ich?.geschlecht,
                personDimensions.partner?.geschlecht
            );
            const statusStmts = getStatusStatements(
                personDimensions.ich,
                personDimensions.partner
            );

            const textParts = [];

            // Archetyp-basierte Logos-Statements
            if (archStatements?.logos) {
                if (archStatements.logos.gemeinsam?.length) {
                    textParts.push(archStatements.logos.gemeinsam[0]);
                }
                if (archStatements.logos.unterschied?.length && philScore < 70) {
                    textParts.push(archStatements.logos.unterschied[0]);
                }
            }

            // Dominanz-basierte Logos-Statements (nur wenn nicht default)
            if (domStatements?.logos?.length && domStatements !== dominanceStatements.default) {
                textParts.push(domStatements.logos[0]);
            }

            // Orientierungs-basierte Logos-Statements hinzuf√ºgen (nur wenn nicht default)
            if (orientStatements?.logos?.length && orientStatements !== orientierungStatements.default) {
                textParts.push(orientStatements.logos[0]);
            }

            // Status-basierte Logos-Statements hinzuf√ºgen (Pirsig-Perspektive)
            if (statusStmts?.logos?.length && statusStmts !== statusStatements.default) {
                textParts.push(statusStmts.logos[0]);
            }

            // Fallback mit Philosophie-Score
            if (textParts.length === 0) {
                if (philScore >= 80) {
                    return `${ichName} und ${partnerName} teilen viele rationale Grund√ºberzeugungen √ºber Beziehungen (Philosophie-Score: ${philScore}%). Das bildet eine solide Basis f√ºr konstruktive Gespr√§che.`;
                } else if (philScore < 50) {
                    return `${ichName} und ${partnerName} haben unterschiedliche rationale Vorstellungen von Beziehungen (Philosophie-Score: ${philScore}%). Grundlegende Gespr√§che √ºber Erwartungen sind wichtig.`;
                }
                return `${ichName} und ${partnerName} haben einige √úberschneidungen in ihren rationalen Beziehungsvorstellungen (Philosophie-Score: ${philScore}%), aber auch Unterschiede, die Kommunikation erfordern.`;
            }

            return textParts.join(' ');
        }

        // ========================================
        // MOBILE MULTI-PAGE FUNCTIONS
        // ========================================

        let currentMobilePage = 1;
        let mobilePersonDimensions = {
            ich: {
                geschlecht: { primary: null, secondary: null },
                dominanz: { primary: null, secondary: null },
                orientierung: { primary: null, secondary: null }
            },
            partner: {
                geschlecht: { primary: null, secondary: null },
                dominanz: { primary: null, secondary: null },
                orientierung: { primary: null, secondary: null }
            }
        };
        let mobileIchArchetype = 'single';
        let mobilePartnerArchetype = 'duo';
        let mobileTouchStartX = 0;
        let mobileTouchEndX = 0;

        function getMissingDimensions() {
            // Check if we're in mobile mode
            const isMobile = window.innerWidth <= 768;
            const dimensions = isMobile ? mobilePersonDimensions : personDimensions;
            const missing = [];

            // Check ICH dimensions
            // Geschlecht ist jetzt { primary, secondary } - nur primary ist erforderlich
            if (!dimensions.ich.geschlecht || !dimensions.ich.geschlecht.primary) {
                missing.push('Ich: Geschlecht');
            }
            if (dimensions.ich.dominanz === null) {
                missing.push('Ich: Dominanz');
            }
            if (dimensions.ich.orientierung === null) {
                missing.push('Ich: Orientierung');
            }
            if (dimensions.ich.orientierungStatus === null) {
                missing.push('Ich: Orientierung-Status');
            }

            // Check PARTNER dimensions
            if (!dimensions.partner.geschlecht || !dimensions.partner.geschlecht.primary) {
                missing.push('Partner: Geschlecht');
            }
            if (dimensions.partner.dominanz === null) {
                missing.push('Partner: Dominanz');
            }
            if (dimensions.partner.orientierung === null) {
                missing.push('Partner: Orientierung');
            }
            if (dimensions.partner.orientierungStatus === null) {
                missing.push('Partner: Orientierung-Status');
            }

            return missing;
        }

        function validateDimensionsComplete() {
            return getMissingDimensions().length === 0;
        }

        function showValidationWarning() {
            // Find or create warning element
            let warning = document.getElementById('dimensionWarning');
            if (warning) {
                warning.remove();
            }

            const missingItems = getMissingDimensions();

            warning = document.createElement('div');
            warning.id = 'dimensionWarning';
            warning.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(231, 76, 60, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideDown 0.3s ease;
                max-width: 90%;
                text-align: left;
            `;

            // Build message with missing items
            let messageHTML = '<div style="margin-bottom: 8px;">‚ö†Ô∏è Es fehlt noch:</div>';
            messageHTML += '<ul style="margin: 0; padding-left: 20px; font-weight: normal; font-size: 13px;">';
            missingItems.forEach(item => {
                messageHTML += `<li>${item}</li>`;
            });
            messageHTML += '</ul>';

            warning.innerHTML = messageHTML;
            document.body.appendChild(warning);

            // Auto-remove after 4 seconds (slightly longer for reading)
            setTimeout(() => {
                warning.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => warning.remove(), 300);
            }, 4000);
        }

        function mobileGoToPage(pageNumber, skipPushState = false) {
            // Validate before moving to page 3 (Synthese) - ensure all dimensions are complete
            if (currentMobilePage === 2 && pageNumber === 3 && !validateDimensionsComplete()) {
                showValidationWarning();
                return;
            }

            // Hide all pages
            document.querySelectorAll('.mobile-page').forEach(p => {
                p.classList.remove('active');
            });

            // Show target page
            const targetPage = document.getElementById(`mobilePage${pageNumber}`);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update dots
            document.querySelectorAll('.page-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === pageNumber - 1);
            });

            currentMobilePage = pageNumber;

            // Update page content when navigating
            if (pageNumber === 3) {
                updateMobileResultPage();
            }

            // Push to browser history for back button navigation (only for forward navigation)
            if (!skipPushState) {
                history.pushState({ mobilePage: pageNumber }, '', `#seite${pageNumber}`);
            }

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function initMobileSwipe() {
            const mobileContainer = document.getElementById('mobileMultipage');
            if (!mobileContainer) return;

            mobileContainer.addEventListener('touchstart', (e) => {
                mobileTouchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            mobileContainer.addEventListener('touchend', (e) => {
                mobileTouchEndX = e.changedTouches[0].screenX;
                handleMobileSwipe();
            }, { passive: true });
        }

        function handleMobileSwipe() {
            const swipeThreshold = 100;
            const diff = mobileTouchStartX - mobileTouchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0 && currentMobilePage < 3) {
                    // Swipe left -> next page (max 3 pages)
                    mobileGoToPage(currentMobilePage + 1);
                } else if (diff < 0 && currentMobilePage > 1) {
                    // Swipe right -> previous page
                    mobileGoToPage(currentMobilePage - 1);
                }
            }
        }

        function initMobileDimensionListeners() {
            // ICH Select
            const mobileIchSelect = document.getElementById('mobileIchSelect');
            if (mobileIchSelect) {
                mobileIchSelect.addEventListener('change', (e) => {
                    mobileIchArchetype = e.target.value;
                    // Sync with desktop
                    const desktopSelect = document.getElementById('ichSelect');
                    if (desktopSelect) desktopSelect.value = e.target.value;
                    currentArchetype = e.target.value;
                    updateComparisonView();
                    // GFK automatisch aus Archetypen-Matching ableiten
                    updateGfkFromArchetypes();
                });
            }

            // Partner Select
            const mobilePartnerSelect = document.getElementById('mobilePartnerSelect');
            if (mobilePartnerSelect) {
                mobilePartnerSelect.addEventListener('change', (e) => {
                    mobilePartnerArchetype = e.target.value;
                    // Sync with desktop
                    const desktopSelect = document.getElementById('partnerSelect');
                    if (desktopSelect) desktopSelect.value = e.target.value;
                    selectedPartner = e.target.value;
                    updateComparisonView();
                    // GFK automatisch aus Archetypen-Matching ableiten
                    updateGfkFromArchetypes();
                });
            }

            // ICH Dimensions
            document.querySelectorAll('input[name="mobile-ich-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    // Use handleGeschlechtClick to maintain consistent object format
                    handleGeschlechtClick('ich', e.target.value, e.target);
                });
            });
            document.querySelectorAll('input[name="mobile-ich-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzClick('ich', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-ich-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.ich.dominanzStatus = e.target.value;
                    personDimensions.ich.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('ich-dominanz-status-new', e.target.value);
                    updateComparisonView();
                });
            });

            // Partner Dimensions
            document.querySelectorAll('input[name="mobile-partner-geschlecht"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    // Use handleGeschlechtClick to maintain consistent object format
                    handleGeschlechtClick('partner', e.target.value, e.target);
                });
            });
            document.querySelectorAll('input[name="mobile-partner-dominanz"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    handleDominanzClick('partner', e.target.value, true);
                });
            });
            document.querySelectorAll('input[name="mobile-partner-dominanz-status"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    mobilePersonDimensions.partner.dominanzStatus = e.target.value;
                    personDimensions.partner.dominanzStatus = e.target.value;
                    e.target.closest('.compact-dimension').classList.remove('needs-selection');
                    syncDimensionToDesktop('partner-dominanz-status-new', e.target.value);
                    updateComparisonView();
                });
            });
        }

        function syncDimensionToDesktop(name, value) {
            const desktopRadio = document.querySelector(`input[name="${name}"][value="${value}"]`);
            if (desktopRadio) {
                desktopRadio.checked = true;
                const container = desktopRadio.closest('.compact-dimension');
                if (container) container.classList.remove('needs-selection');
            }
        }

        function updateMobileResultPage() {
            if (!data) return;

            const ichArch = data.archetypes[mobileIchArchetype || currentArchetype];
            const partnerArch = data.archetypes[mobilePartnerArchetype || selectedPartner];

            // Update type names
            document.getElementById('mobileResultIch').textContent = ichArch?.name || mobileIchArchetype;
            document.getElementById('mobileResultPartner').textContent = partnerArch?.name || mobilePartnerArchetype;

            // Calculate scores - use mobilePersonDimensions for consistency with tooltips
            const dims = mobilePersonDimensions;
            const person1 = { archetyp: mobileIchArchetype || currentArchetype, ...dims.ich };
            const person2 = { archetyp: mobilePartnerArchetype || selectedPartner, ...dims.partner };

            // Check if both genders are selected before calculating
            // Support both string format ('cis_mann') and object format ({ primary: 'cis_mann' })
            const g1Raw = dims.ich.geschlecht;
            const g2Raw = dims.partner.geschlecht;
            const g1 = (typeof g1Raw === 'string') ? g1Raw : (g1Raw && g1Raw.primary);
            const g2 = (typeof g2Raw === 'string') ? g2Raw : (g2Raw && g2Raw.primary);

            // Check if any orientierung is selected for both (Primary/Secondary structure)
            const hasOri1 = dims.ich.orientierung && dims.ich.orientierung.primary;
            const hasOri2 = dims.partner.orientierung && dims.partner.orientierung.primary;

            // Check if any dominanz is selected for both (Primary/Secondary structure)
            const hasDom1 = dims.ich.dominanz && dims.ich.dominanz.primary;
            const hasDom2 = dims.partner.dominanz && dims.partner.dominanz.primary;

            const isIncomplete = !g1 || !g2 || !hasOri1 || !hasOri2 || !hasDom1 || !hasDom2;

            const qualityResult = isIncomplete ?
                { score: 0, blocked: false, incomplete: true, breakdown: { archetyp: 0, dominanz: 0, orientierung: 0, geschlecht: 0 } } :
                calculateRelationshipQuality(person1, person2);

            // Update score circle
            const scoreCircle = document.getElementById('mobileScoreCircle');

            // Set score circle color and content
            // Kein harter K.O. mehr - sanfte Abstufung durch Resonanz
            if (qualityResult.incomplete) {
                scoreCircle.textContent = '‚Äì';
            } else {
                scoreCircle.textContent = qualityResult.score;
            }
            scoreCircle.style.background = 'transparent';

            // Sync score to resultPercentage for Tiage's Synthese modal
            const resultPercentageEl = document.getElementById('resultPercentage');
            if (resultPercentageEl) {
                resultPercentageEl.textContent = qualityResult.incomplete ? '‚Äì' : qualityResult.score;
            }

            // Update Mobile Score Note (direkt beim Kreis)
            const mobileScoreNote = document.getElementById('mobileScoreNote');
            if (mobileScoreNote) {
                let noteText = '';
                let quoteText = '';
                const score = qualityResult.score;
                if (qualityResult.incomplete) {
                    noteText = 'Bitte alle Dimensionen ausw√§hlen.';
                    mobileScoreNote.textContent = noteText;
                } else if (score < 30) {
                    // Sehr niedrige Resonanz - sanfter Hinweis statt K.O.
                    noteText = 'Sehr niedrige Resonanz ‚Äì gro√üe Unterschiede.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + score + '% ‚Äì die Muster unterscheiden sich stark, was intensive Kommunikation erfordert.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else if (score >= 80) {
                    noteText = 'Hohe Resonanz ‚Äì Muster erg√§nzen sich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + score + '% ‚Äì eine hohe Resonanz zwischen zwei Menschen, deren Muster sich erg√§nzen und verst√§rken.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else if (score >= 65) {
                    noteText = 'Solide Balance mit Potenzial.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + score + '% ‚Äì eine solide Balance mit Entwicklungspotenzial f√ºr beide Partner.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else if (score >= 50) {
                    noteText = 'Basis vorhanden, Arbeit erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + score + '% ‚Äì eine Basis ist vorhanden, erfordert aber bewusste Arbeit und Kommunikation.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                } else {
                    noteText = 'Bewusste Reflexion erforderlich.';
                    quoteText = 'Diese Beziehung zeigt eine Qualit√§t von ' + score + '% ‚Äì bewusste Reflexion und offene Kommunikation sind erforderlich.';
                    mobileScoreNote.innerHTML = '<strong>' + noteText + '</strong><br><span style="font-style: italic; opacity: 0.85; font-size: 0.9em;">"' + quoteText + '"</span>';
                }
            }
        }

        function updateMobileProContraPage() {
            if (!data) return;

            const ichArch = data.archetypes[mobileIchArchetype || currentArchetype];
            const partnerArch = data.archetypes[mobilePartnerArchetype || selectedPartner];

            // Update title
            const title = document.getElementById('mobileProContraTitle');
            if (title) {
                title.textContent = `${ichArch?.name || 'ICH'} √ó ${partnerArch?.name || 'PARTNER'}`;
            }

            // Get interaction data
            const interactionKey = `${mobileIchArchetype || currentArchetype}_${mobilePartnerArchetype || selectedPartner}`;
            const interaction = data.interactions?.[interactionKey];

            const proList = document.getElementById('mobileProList');
            const contraList = document.getElementById('mobileContraList');

            if (interaction) {
                // Pro list
                if (proList && interaction.pros?.length) {
                    proList.innerHTML = interaction.pros.map(p => `<li>${p}</li>`).join('');
                } else if (proList) {
                    proList.innerHTML = '<li>Keine spezifischen Vorteile bekannt</li>';
                }

                // Contra list
                if (contraList && interaction.contras?.length) {
                    contraList.innerHTML = interaction.contras.map(c => `<li>${c}</li>`).join('');
                } else if (contraList) {
                    contraList.innerHTML = '<li>Keine spezifischen Herausforderungen bekannt</li>';
                }
            } else {
                if (proList) proList.innerHTML = '<li>Keine Daten verf√ºgbar</li>';
                if (contraList) contraList.innerHTML = '<li>Keine Daten verf√ºgbar</li>';
            }
        }

        function updateMobileCategoriesPage() {
            if (!data) return;

            const container = document.getElementById('mobileCategoriesAccordion');
            if (!container) return;

            const person1 = { archetyp: mobileIchArchetype || currentArchetype, ...personDimensions.ich };
            const person2 = { archetyp: mobilePartnerArchetype || selectedPartner, ...personDimensions.partner };

            const pathosCheck = checkPhysicalCompatibility(person1, person2);
            const logosCheck = calculatePhilosophyCompatibility(person1.archetyp, person2.archetyp);
            const result = calculateOverallWithModifiers(person1, person2, pathosCheck, logosCheck);

            const categoryNamesMap = {
                A: 'Beziehungsphilosophie',
                B: 'Werte-Alignment',
                C: 'N√§he-Distanz',
                D: 'Autonomie',
                E: 'Kommunikation',
                F: 'Soziale Kompatibilit√§t'
            };

            const categoryDescMap = {
                A: '√úbereinstimmung in den grundlegenden Beziehungsvorstellungen und -erwartungen.',
                B: 'Wie gut eure moralischen und ethischen Werte √ºbereinstimmen.',
                C: 'Balance zwischen Bed√ºrfnis nach N√§he und Freiraum.',
                D: 'Respekt f√ºr individuelle Unabh√§ngigkeit und Selbstbestimmung.',
                E: 'F√§higkeit zur offenen und ehrlichen Kommunikation.',
                F: 'Kompatibilit√§t im sozialen Umfeld und gesellschaftlicher Akzeptanz.'
            };

            // FEATURE 2: Category explanations
            function getCategoryExplanation(cat, score, ich, partner) {
                const ichName = data?.archetypes?.[ich]?.name || ich;
                const partnerName = data?.archetypes?.[partner]?.name || partner;

                const explanations = {
                    A: () => {
                        if (ich === partner) {
                            return `${ichName} und ${partnerName} teilen dieselbe Beziehungsphilosophie (100% √úbereinstimmung). Beide haben identische Grund√ºberzeugungen √ºber Beziehungsstrukturen, was eine solide Basis bietet.`;
                        }
                        if (score >= 80) {
                            return `${ichName} und ${partnerName} haben sehr √§hnliche Beziehungsphilosophien (${score}%). Die Grund√ºberzeugungen passen gut zusammen und schaffen eine harmonische Basis.`;
                        } else if (score >= 60) {
                            return `${ichName} (sucht ${ichName === 'Single' ? 'Freiheit' : ichName === 'Duo' ? 'Exklusivit√§t' : 'Flexibilit√§t'}) und ${partnerName} (sucht ${partnerName === 'Single' ? 'Freiheit' : partnerName === 'Duo' ? 'Exklusivit√§t' : 'Flexibilit√§t'}) haben unterschiedliche, aber vereinbare Beziehungsphilosophien (${score}%). Mit Kommunikation und Verst√§ndnis ist eine Br√ºcke m√∂glich.`;
                        } else {
                            return `${ichName} und ${partnerName} haben fundamentale philosophische Unterschiede (${score}%). Die Beziehungsvorstellungen weichen stark voneinander ab. Intensive Kommunikation und gro√üe Kompromisse sind n√∂tig.`;
                        }
                    },
                    B: () => `Diese Kategorie misst, wie gut eure moralischen Werte √ºbereinstimmen. Ein Score von ${score}% zeigt ${score >= 70 ? 'starke' : score >= 50 ? 'moderate' : 'schwache'} √úbereinstimmung in ethischen Grundfragen.`,
                    C: () => `N√§he-Distanz bewertet das Gleichgewicht zwischen Zusammensein und Freiraum. Bei ${score}% gibt es ${score >= 70 ? 'eine harmonische Balance' : score >= 50 ? 'moderate Abstimmung n√∂tig' : 'deutliche Unterschiede in den Bed√ºrfnissen'}.`,
                    D: () => `Autonomie misst den Respekt f√ºr individuelle Freiheit. ${score}% bedeutet ${score >= 70 ? 'hohe gegenseitige Wertsch√§tzung' : score >= 50 ? 'moderate √úbereinstimmung' : 'Spannungen durch unterschiedliche Autonomie-Bed√ºrfnisse'}.`,
                    E: () => `Kommunikation bewertet Offenheit und Ehrlichkeit. Ein Score von ${score}% zeigt ${score >= 70 ? 'exzellente Kommunikationsbasis' : score >= 50 ? 'solide, aber ausbauf√§hige Kommunikation' : 'Herausforderungen in der Verst√§ndigung'}.`,
                    F: () => `Soziale Kompatibilit√§t bewertet gesellschaftliche Akzeptanz und Umfeld-Passung. ${score}% bedeutet ${score >= 70 ? 'sehr gute soziale Harmonie' : score >= 50 ? 'akzeptable soziale Integration' : 'potenzielle soziale Herausforderungen'}.`
                };

                return explanations[cat] ? explanations[cat]() : '';
            }

            let html = '';
            for (const [cat, catData] of Object.entries(result.categories)) {
                const score = catData.score || 0;
                const barClass = score >= 80 ? 'bar-excellent' : score >= 65 ? 'bar-good' : score >= 50 ? 'bar-medium' : 'bar-low';
                const explanation = getCategoryExplanation(cat, score, person1.archetyp, person2.archetyp);

                html += `
                    <div class="category-accordion-item">
                        <div class="category-accordion-header" onclick="toggleMobileCategory(this)">
                            <span class="category-accordion-letter">${cat}</span>
                            <span class="category-accordion-name">${categoryNamesMap[cat] || cat}</span>
                            <span class="category-accordion-score">${score}%</span>
                            <span class="category-accordion-icon">‚ñº</span>
                        </div>
                        <div class="category-accordion-content">
                            <div class="category-accordion-inner">
                                <p class="category-accordion-desc">${categoryDescMap[cat] || ''}</p>
                                <div style="margin-top: 10px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                                    <div class="${barClass}" style="height: 100%; width: ${score}%; border-radius: 4px;"></div>
                                </div>
                                <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; border-left: 3px solid var(--primary);">
                                    <h4 style="font-size: var(--font-sm); color: var(--text-primary); margin-bottom: 8px;">Warum ${score}%?</h4>
                                    <p style="font-size: var(--font-xs); color: var(--text-secondary); line-height: 1.5; margin: 0;">${explanation}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function toggleMobileCategory(header) {
            const item = header.closest('.category-accordion-item');
            if (item) {
                item.classList.toggle('open');
            }
        }

        function checkAndShowMobileLayout() {
            const isMobile = window.innerWidth <= 768;
            const desktopView = document.getElementById('comparisonView');
            const mobileView = document.getElementById('mobileMultipage');

            if (isMobile) {
                if (desktopView) desktopView.style.display = 'none';
                if (mobileView) mobileView.style.display = 'block';
            } else {
                if (desktopView) desktopView.style.display = 'block';
                if (mobileView) mobileView.style.display = 'none';
            }
        }

        function initMobileLayout() {
            initMobileSwipe();
            initMobileDimensionListeners();
            checkAndShowMobileLayout();

            // Listen for window resize
            window.addEventListener('resize', checkAndShowMobileLayout);

            // Initialize browser history for back button support
            initBrowserHistoryNavigation();
        }

        function initBrowserHistoryNavigation() {
            // Set initial state without adding to history
            history.replaceState({ mobilePage: 1 }, '', '#seite1');

            // Handle browser back/forward button
            window.addEventListener('popstate', function(event) {
                // First, close any open modals when going back
                const factorModal = document.getElementById('factorModal');
                const helpModal = document.getElementById('helpModal');
                const commentModal = document.getElementById('commentModal');
                const proContraModal = document.getElementById('proContraModal');

                // Check if we're returning FROM a modal state (current modal should close)
                if (factorModal && factorModal.classList.contains('active')) {
                    closeFactorModal(null, true);
                }
                if (helpModal && helpModal.classList.contains('active')) {
                    closeHelpModal(null, true);
                }
                if (commentModal && commentModal.classList.contains('active')) {
                    closeCommentModal(null, true);
                }
                if (proContraModal && proContraModal.classList.contains('active')) {
                    closeProContraModal(null, true);
                }

                // Navigate to the correct page
                if (event.state && event.state.mobilePage) {
                    // Only change page if we're not on a modal state
                    if (!event.state.modal) {
                        mobileGoToPage(event.state.mobilePage, true);
                    }
                } else {
                    // If no state, go to page 1
                    mobileGoToPage(1, true);
                }
            });

            // Handle initial load with hash (e.g., direct link to #seite2)
            const hash = window.location.hash;
            if (hash && hash.startsWith('#seite')) {
                const pageNum = parseInt(hash.replace('#seite', ''));
                if (pageNum >= 1 && pageNum <= 3) {
                    // Delay to ensure DOM is ready
                    setTimeout(() => {
                        // For page 2 and 3, we need valid selections - go to page 1 first
                        if (pageNum > 1) {
                            mobileGoToPage(1, true);
                        }
                    }, 100);
                }
            }
        }

        /**
         * Load saved dimensions from TiageState into local personDimensions variable
         * This ensures the UI reflects any previously saved selections
         */
        function loadDimensionsFromState() {
            if (typeof TiageState === 'undefined') return;

            // Load from TiageState
            TiageState.loadFromStorage();

            ['ich', 'partner'].forEach(person => {
                const savedDims = TiageState.get(`personDimensions.${person}`);
                if (!savedDims) return;

                // Sync geschlecht
                if (savedDims.geschlecht) {
                    // Handle both old format (string) and new format (object with primary/secondary)
                    if (typeof savedDims.geschlecht === 'object' && 'primary' in savedDims.geschlecht) {
                        personDimensions[person].geschlecht = savedDims.geschlecht;
                    } else if (typeof savedDims.geschlecht === 'string') {
                        // Old format: string like "cis_frau" - convert to new format as primary
                        personDimensions[person].geschlecht = { primary: savedDims.geschlecht, secondary: null };
                    }
                }

                // Sync dominanz - handle both formats
                if (savedDims.dominanz) {
                    if (typeof savedDims.dominanz === 'object') {
                        // New format: { primary: 'dominant', secondary: null }
                        if ('primary' in savedDims.dominanz) {
                            personDimensions[person].dominanz = savedDims.dominanz;
                        } else {
                            // Old format: { dominant: 'gelebt', submissiv: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(savedDims.dominanz)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions[person].dominanz = { primary, secondary };
                        }
                    }
                }

                // Sync orientierung - handle both formats
                if (savedDims.orientierung) {
                    if (typeof savedDims.orientierung === 'object') {
                        // New format: { primary: 'heterosexuell', secondary: null }
                        if ('primary' in savedDims.orientierung) {
                            personDimensions[person].orientierung = savedDims.orientierung;
                        } else {
                            // Old format: { heterosexuell: 'gelebt', homosexuell: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(savedDims.orientierung)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions[person].orientierung = { primary, secondary };
                        }
                    }
                }

                // Sync GFK if present
                if (savedDims.gfk) {
                    personDimensions[person].gfk = savedDims.gfk;
                }
            });
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            checkAgeVerification();
            initAgeVerification();
            initFeedbackSystem();
            initDimensionListeners();
            initComparisonLayout();
            initMobileLayout();
            // Load saved dimensions from TiageState BEFORE initializing buttons
            loadDimensionsFromState();
            initDimensionButtons();
            initGeschlechtHoverEvents();
            // Initialize all summary displays in header
            updateGeschlechtSummary('ich');
            updateGeschlechtSummary('partner');
            updateDominanzSummary('ich');
            updateDominanzSummary('partner');
            updateOrientierungSummary('ich');
            updateOrientierungSummary('partner');
            // GFK automatisch aus Archetypen-Matching setzen
            updateGfkFromArchetypes();
        });

        // ========================================
        // FEATURE 1: Factor Detail Modal
        // ========================================

        const factorExplanations = {
            archetyp: {
                title: 'Archetyp-√úbereinstimmung',
                subtitle: '(Beziehungsphilosophie - Verstand&Logos)',
                getExplanation: (ich, partner, score) => {
                    const ichName = data?.archetypes?.[ich]?.name || ich;
                    const partnerName = data?.archetypes?.[partner]?.name || partner;

                    if (ich === partner) {
                        return `${ichName} und ${partnerName} teilen dieselbe Beziehungsphilosophie. Beide haben identische Grund√ºberzeugungen √ºber Beziehungsstrukturen.`;
                    }

                    if (score >= 80) {
                        return `${ichName} und ${partnerName} haben sehr √§hnliche Beziehungsphilosophien. Die Grund√ºberzeugungen passen gut zusammen und erfordern nur minimale Kompromisse.`;
                    } else if (score >= 60) {
                        return `${ichName} und ${partnerName} haben unterschiedliche, aber kompatible Beziehungsphilosophien. Beide Archetypen k√∂nnen sich mit Kommunikation und Verst√§ndnis erg√§nzen.`;
                    } else {
                        return `${ichName} und ${partnerName} haben fundamentale philosophische Unterschiede. Die Beziehungsvorstellungen weichen stark voneinander ab und erfordern intensive Kommunikation.`;
                    }
                },
                getMeaning: (score, ich, partner) => {
                    const ichName = data?.archetypes?.[ich]?.name || ich;
                    const partnerName = data?.archetypes?.[partner]?.name || partner;
                    const rhetoricNote = { title: 'üí° Warum Logos (Verstand)?', desc: 'Archetypen basieren auf rationalen Beziehungsphilosophien und bewussten √úberzeugungen ‚Äì sie sprechen den Verstand an, nicht das Gef√ºhl.' };

                    if (ich === partner) {
                        return [
                            rhetoricNote,
                            { title: `üìå In dieser Kombination teilen beide denselben Archetyp "${ichName}" ‚Äì maximale philosophische √úbereinstimmung.`, desc: '' },
                            { title: 'Gleiche Grund√ºberzeugungen', desc: 'Beide haben identische Vorstellungen davon, wie eine Beziehung funktionieren sollte.' },
                            { title: 'Intuitive Verst√§ndigung', desc: 'Die gemeinsame Basis erm√∂glicht tiefes gegenseitiges Verstehen ohne lange Erkl√§rungen.' },
                            { title: 'Nat√ºrliche Harmonie', desc: 'Keine grunds√§tzlichen Konflikte durch unterschiedliche Beziehungsphilosophien.' }
                        ];
                    }

                    if (score >= 80) {
                        return [
                            rhetoricNote,
                            { title: `üìå In dieser Kombination von "${ichName}" und "${partnerName}" erg√§nzen sich die Beziehungsphilosophien sehr gut.`, desc: '' },
                            { title: 'Hohe philosophische √úbereinstimmung', desc: 'Beide teilen √§hnliche Grundwerte und Beziehungsideale.' },
                            { title: 'Wenige grunds√§tzliche Konflikte', desc: 'Weltanschauung und Lebensziele sind weitgehend kompatibel.' },
                            { title: '√Ñhnliche Erwartungen an die Beziehung', desc: 'Was beide von Partnerschaft erwarten, deckt sich gut.' }
                        ];
                    } else if (score >= 60) {
                        return [
                            rhetoricNote,
                            { title: `üìå In dieser Kombination von "${ichName}" und "${partnerName}" gibt es sowohl Gemeinsamkeiten als auch deutliche Unterschiede.`, desc: '' },
                            { title: 'Mittlere philosophische √úbereinstimmung', desc: 'Grundwerte √ºberlappen, aber es gibt Unterschiede.' },
                            { title: 'Kompromisse und Kommunikation n√∂tig', desc: 'Unterschiedliche Priorit√§ten erfordern regelm√§√üigen Austausch.' },
                            { title: 'Unterschiedliche, aber vereinbare Bed√ºrfnisse', desc: 'Mit Flexibilit√§t k√∂nnen beide Seiten zufrieden sein.' }
                        ];
                    } else {
                        return [
                            rhetoricNote,
                            { title: `üìå In dieser Kombination von "${ichName}" und "${partnerName}" prallen grundlegend verschiedene Beziehungsphilosophien aufeinander.`, desc: '' },
                            { title: 'Niedrige philosophische √úbereinstimmung', desc: 'Grunds√§tzlich verschiedene Sichtweisen auf Beziehung.' },
                            { title: 'Intensive Kommunikation erforderlich', desc: 'Ohne bewusste Arbeit entstehen leicht Missverst√§ndnisse.' },
                            { title: 'Fundamentale Kompromisse notwendig', desc: 'Beide m√ºssen auf wichtige eigene Bed√ºrfnisse verzichten k√∂nnen.' }
                        ];
                    }
                }
            },
            dominanz: {
                title: 'Dominanz-Harmonie',
                subtitle: '(Emotionale Dynamik - Gef√ºhl&Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichDomObj = dims.ich.dominanz;
                    const partnerDomObj = dims.partner.dominanz;

                    // Translate values to German labels for display
                    const domLabels = {
                        'dominant': 'dominant',
                        'submissiv': 'submissiv',
                        'switch': 'Switch',
                        'ausgeglichen': 'ausgeglichen'
                    };

                    // Harmony matrix for finding best combination
                    const harmonyMatrix = {
                        "dominant-submissiv": 100, "submissiv-dominant": 100,
                        "ausgeglichen-ausgeglichen": 95, "switch-switch": 90,
                        "switch-ausgeglichen": 88, "ausgeglichen-switch": 88,
                        "dominant-ausgeglichen": 85, "ausgeglichen-dominant": 85,
                        "submissiv-ausgeglichen": 85, "ausgeglichen-submissiv": 85,
                        "switch-dominant": 80, "dominant-switch": 80,
                        "switch-submissiv": 80, "submissiv-switch": 80,
                        "dominant-dominant": 55, "submissiv-submissiv": 55
                    };

                    // Helper to get all selections with status
                    const getAllSelections = (domObj) => {
                        if (!domObj || typeof domObj !== 'object') return [];
                        const selections = [];
                        for (const [type, status] of Object.entries(domObj)) {
                            if (status) selections.push({ type, status });
                        }
                        return selections;
                    };

                    const ichSelections = getAllSelections(ichDomObj);
                    const partnerSelections = getAllSelections(partnerDomObj);

                    if (ichSelections.length === 0 || partnerSelections.length === 0) {
                        return 'Bitte w√§hle f√ºr beide Personen mindestens eine Dominanz-Tendenz.';
                    }

                    // Find best combination across ALL selections (primary + secondary)
                    let bestCombo = null;
                    let bestScore = 0;
                    for (const ichSel of ichSelections) {
                        for (const partnerSel of partnerSelections) {
                            const key = `${ichSel.type}-${partnerSel.type}`;
                            let baseScore = harmonyMatrix[key] || harmonyMatrix[`${partnerSel.type}-${ichSel.type}`] || 75;
                            // Reduce score if either is "interessiert"
                            const hasInteressiert = ichSel.status === 'interessiert' || partnerSel.status === 'interessiert';
                            const adjustedScore = hasInteressiert ? Math.round(baseScore * 0.7) : baseScore;
                            if (adjustedScore > bestScore) {
                                bestScore = adjustedScore;
                                bestCombo = { ich: ichSel, partner: partnerSel, hasInteressiert, baseScore };
                            }
                        }
                    }

                    if (!bestCombo) {
                        return 'Keine kompatible Dominanz-Kombination gefunden.';
                    }

                    const ichType = bestCombo.ich.type;
                    const partnerType = bestCombo.partner.type;
                    const ichStatusLabel = bestCombo.ich.status === 'gelebt' ? 'Gelebt' : 'Interessiert';
                    const partnerStatusLabel = bestCombo.partner.status === 'gelebt' ? 'Gelebt' : 'Interessiert';

                    // Build explanation based on best combination
                    let explanation = `Beste Kombination: ${domLabels[ichType]} (${ichStatusLabel}) ‚Üî ${domLabels[partnerType]} (${partnerStatusLabel}). `;

                    if (ichType === partnerType) {
                        if (ichType === 'ausgeglichen' || ichType === 'switch') {
                            explanation += `Beide bevorzugen ${domLabels[ichType]} - flexible Dynamik m√∂glich.`;
                        } else if (ichType === 'dominant') {
                            explanation += `Beide dominant - Machtkampf-Risiko, aber mit Kommunikation machbar.`;
                        } else if (ichType === 'submissiv') {
                            explanation += `Beide submissiv - F√ºhrungsvakuum-Risiko, klare Absprachen wichtig.`;
                        }
                    } else if ((ichType === 'dominant' && partnerType === 'submissiv') ||
                               (ichType === 'submissiv' && partnerType === 'dominant')) {
                        explanation += `Perfekte Komplementarit√§t in der emotionalen Dynamik!`;
                    } else {
                        explanation += `Interessante Dynamik mit Flexibilit√§tspotential.`;
                    }

                    // Add warning if best combo uses "interessiert"
                    if (bestCombo.hasInteressiert) {
                        explanation += ` ‚ö†Ô∏è Exploration-Phase: Reduzierte Konfidenz (${bestCombo.baseScore}% ‚Üí ${bestScore}%).`;
                    }

                    return explanation;
                },
                getMeaning: (score) => {
                    const rhetoricNote = { title: 'üí° Warum Pathos (Gef√ºhl)?', desc: 'Dominanz-Dynamik wirkt auf der emotionalen Ebene ‚Äì wer f√ºhrt, wer folgt, entsteht aus Gef√ºhl und Instinkt, nicht aus rationaler √úberlegung.' };
                    if (score >= 80) {
                        return [
                            rhetoricNote,
                            { title: 'Harmonische emotionale Dynamik', desc: 'Die Rollen (F√ºhren/Folgen) erg√§nzen sich nat√ºrlich ohne Reibung.' },
                            { title: 'Nat√ºrliche Rollenverteilung', desc: 'Entscheidungen und Verantwortung flie√üen organisch zwischen beiden.' },
                            { title: 'Geringe Reibungspunkte', desc: 'Wenig Konflikte um Kontrolle oder Passivit√§t zu erwarten.' }
                        ];
                    } else if (score >= 60) {
                        return [
                            rhetoricNote,
                            { title: 'Funktionale emotionale Dynamik', desc: 'Die Rollen funktionieren, sind aber nicht perfekt komplement√§r.' },
                            { title: 'Flexible Anpassung m√∂glich', desc: 'Mit gegenseitigem Verst√§ndnis kann Balance gefunden werden.' },
                            { title: 'Gelegentliche Abstimmung n√∂tig', desc: 'Manchmal braucht es Gespr√§che √ºber Erwartungen und Bed√ºrfnisse.' }
                        ];
                    } else {
                        // Forschungsbasiert: Sadikaj et al. (2017) - Machtk√§mpfe bei gleicher Polarit√§t
                        return [
                            rhetoricNote,
                            { title: 'Machtkampf- oder F√ºhrungsvakuum-Risiko', desc: 'Beide dominant = Konkurrenzk√§mpfe. Beide submissiv = keiner √ºbernimmt F√ºhrung.' },
                            { title: 'Bewusste Kommunikationsregeln wichtig', desc: 'Klare Absprachen n√∂tig, wer wann welche Rolle √ºbernimmt.' },
                            { title: 'Klare Aufgabenteilung empfohlen', desc: 'Definierte Verantwortungsbereiche reduzieren Konflikte.' }
                        ];
                    }
                }
            },
            orientierung: {
                title: 'Orientierungs-Kompatibilit√§t',
                subtitle: '(K√∂rperliche Anziehung - Gef√ºhl&Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichOri = dims.ich.orientierung;
                    const partnerOri = dims.partner.orientierung;

                    // Translate values to German labels for display
                    const oriLabels = {
                        'heterosexuell': 'heterosexuell',
                        'homosexuell': 'homosexuell',
                        'bisexuell': 'bisexuell'
                    };
                    const ichLabel = oriLabels[ichOri] || ichOri || 'nicht gew√§hlt';
                    const partnerLabel = oriLabels[partnerOri] || partnerOri || 'nicht gew√§hlt';

                    if (score === 100) {
                        return `${ichLabel} und ${partnerLabel} - perfekte Kompatibilit√§t! K√∂rperliche Anziehung ist definitiv m√∂glich.`;
                    } else if (score >= 50) {
                        return `${ichLabel} und ${partnerLabel} - Anziehung ist m√∂glich, besonders wenn mindestens eine Person bisexuell orientiert ist.`;
                    } else {
                        return `${ichLabel} und ${partnerLabel} - Keine k√∂rperliche Anziehung m√∂glich aufgrund der sexuellen Orientierungen.`;
                    }
                },
                getMeaning: (score) => {
                    const rhetoricNote = { title: 'üí° Warum Pathos (Gef√ºhl)?', desc: 'Sexuelle Orientierung bestimmt, wen wir k√∂rperlich anziehend finden ‚Äì ein tiefes, unbewusstes Gef√ºhl, keine rationale Wahl.' };
                    if (score === 100) {
                        return [
                            rhetoricNote,
                            { title: 'Vollst√§ndige k√∂rperliche Kompatibilit√§t', desc: 'Die sexuellen Orientierungen beider passen ideal zusammen.' },
                            { title: 'Keine Barrieren f√ºr Anziehung', desc: 'Beide k√∂nnen sich potenziell zueinander hingezogen f√ºhlen.' },
                            { title: 'Basis f√ºr romantische Beziehung vorhanden', desc: 'K√∂rperliche Anziehung kann Grundlage f√ºr mehr sein.' }
                        ];
                    } else if (score >= 50) {
                        return [
                            rhetoricNote,
                            { title: 'M√∂gliche k√∂rperliche Kompatibilit√§t', desc: 'Unter bestimmten Umst√§nden ist Anziehung m√∂glich.' },
                            { title: 'Anziehung kann entstehen', desc: 'Nicht automatisch, aber nicht ausgeschlossen.' },
                            { title: 'H√§ngt von individuellen Pr√§ferenzen ab', desc: 'Pers√∂nliche Neigungen spielen gr√∂√üere Rolle.' }
                        ];
                    } else {
                        return [
                            rhetoricNote,
                            { title: 'Keine k√∂rperliche Kompatibilit√§t', desc: 'Die Orientierungen schlie√üen gegenseitige Anziehung aus.' },
                            { title: 'Romantische Beziehung nicht m√∂glich', desc: 'Keine Basis f√ºr eine intime Partnerschaft.' },
                            { title: 'Freundschaft m√∂glich', desc: 'Eine platonische Verbindung bleibt eine Option.' }
                        ];
                    }
                }
            },
            geschlecht: {
                title: 'Geschlechts-Attraktion',
                subtitle: '(Gender-Chemie - Gef√ºhl&Pathos)',
                getExplanation: (ich, partner, score, dimensions) => {
                    // Use passed dimensions, fallback to mobilePersonDimensions for backward compatibility
                    const dims = dimensions || mobilePersonDimensions;
                    const ichG = dims.ich.geschlecht;
                    const partnerG = dims.partner.geschlecht;

                    // Translate values to German labels for display
                    const genderLabels = {
                        'm√§nnlich': 'm√§nnlich',
                        'weiblich': 'weiblich',
                        'non-bin√§r': 'non-bin√§r'
                    };
                    const ichLabel = genderLabels[ichG] || ichG || 'nicht gew√§hlt';
                    const partnerLabel = genderLabels[partnerG] || partnerG || 'nicht gew√§hlt';

                    if (score === 100) {
                        return `Die Geschlechterkonstellation ${ichLabel} √ó ${partnerLabel} passt perfekt zu den angegebenen Orientierungen.`;
                    } else if (score >= 50) {
                        return `Die Geschlechterkonstellation ${ichLabel} √ó ${partnerLabel} ist mit den angegebenen Orientierungen grunds√§tzlich kompatibel.`;
                    } else {
                        return `Die Geschlechterkonstellation ${ichLabel} √ó ${partnerLabel} passt nicht zu den angegebenen Orientierungen.`;
                    }
                },
                getMeaning: (score) => {
                    const rhetoricNote = { title: 'üí° Warum Pathos (Gef√ºhl)?', desc: 'Gender-Chemie ist die instinktive Reaktion auf das Geschlecht des anderen ‚Äì ein unbewusstes Gef√ºhl, das k√∂rperliche Anziehung ausl√∂st oder blockiert.' };
                    if (score === 100) {
                        return [
                            rhetoricNote,
                            { title: 'Ideale Geschlechterkonstellation', desc: 'Die Geschlechter-Kombination passt perfekt zu beiden Orientierungen.' },
                            { title: 'Maximale Anziehungskraft m√∂glich', desc: 'Gender-Chemie kann voll entfaltet werden.' },
                            { title: 'Keine gender-bezogenen Barrieren', desc: 'Die Geschlechter bilden keine H√ºrde f√ºr Anziehung.' }
                        ];
                    } else if (score >= 50) {
                        return [
                            rhetoricNote,
                            { title: 'Akzeptable Geschlechterkonstellation', desc: 'Nicht optimal, aber funktional f√ºr Anziehung.' },
                            { title: 'Anziehung m√∂glich', desc: 'Kann entstehen, ist aber nicht garantiert.' },
                            { title: 'Individuelle Pr√§ferenzen entscheidend', desc: 'Pers√∂nliche Vorlieben bestimmen den Ausgang.' }
                        ];
                    } else {
                        return [
                            rhetoricNote,
                            { title: 'Inkompatible Geschlechterkonstellation', desc: 'Die Geschlechter-Kombination passt nicht zu den Orientierungen.' },
                            { title: 'Anziehung unwahrscheinlich', desc: 'K√∂rperliche Chemie wird kaum entstehen.' },
                            { title: 'Orientierung passt nicht', desc: 'Die Pr√§ferenzen zeigen in andere Richtungen.' }
                        ];
                    }
                }
            }
        };

        function openFactorModal(factorType, source = 'mobile') {
            const factor = factorExplanations[factorType];
            if (!factor) return;

            // Store current factor type and source for navigation
            currentFactorType = factorType;
            currentFactorSource = source;

            const ich = mobileIchArchetype;
            const partner = mobilePartnerArchetype;

            // Use correct dimensions based on source
            const dimensions = source === 'desktop' ? personDimensions : mobilePersonDimensions;

            // Get score from display - support both mobile and desktop
            const prefix = source === 'desktop' ? 'desktopFactor' : 'mobileFactor';
            let score = 0;
            if (factorType === 'archetyp') {
                score = parseInt(document.getElementById(prefix + 'Archetyp').textContent) || 0;
            } else if (factorType === 'dominanz') {
                score = parseInt(document.getElementById(prefix + 'Dominanz').textContent) || 0;
            } else if (factorType === 'orientierung') {
                score = parseInt(document.getElementById(prefix + 'Orientierung').textContent) || 0;
            } else if (factorType === 'geschlecht') {
                score = parseInt(document.getElementById(prefix + 'Geschlecht').textContent) || 0;
            }

            // Update modal content
            document.getElementById('factorModalTitle').textContent = factor.title;
            document.getElementById('factorModalSubtitle').textContent = factor.subtitle;

            // Update archetype navigation display
            updateFactorModalArchetypeDisplay();

            // Show combination code for archetyp and dominanz factors
            const comboCodeEl = document.getElementById('factorModalComboCode');
            if (factorType === 'archetyp' && ich && partner) {
                const comboCode = `${ich}_${partner}`;
                comboCodeEl.textContent = `Code: ${comboCode}`;
                comboCodeEl.style.display = 'inline-block';
            } else if (factorType === 'dominanz') {
                // Get dominanz and orientierung selections for combo code
                const ichDom = dimensions.ich.dominanz;
                const partnerDom = dimensions.partner.dominanz;
                const ichOri = dimensions.ich.orientierung;
                const partnerOri = dimensions.partner.orientierung;
                const domAbbrev = { 'dominant': 'Dom', 'submissiv': 'Sub', 'switch': 'Swi', 'ausgeglichen': 'Aus' };
                const oriAbbrev = { 'heterosexuell': 'Het', 'homosexuell': 'Hom', 'bisexuell': 'Bi' };

                const getSelectedDom = (domObj) => {
                    if (!domObj) return null;
                    for (const [type, status] of Object.entries(domObj)) {
                        if (status) return domAbbrev[type] || type;
                    }
                    return null;
                };

                const getSelectedOri = (oriObj) => {
                    if (!oriObj) return null;
                    for (const [type, status] of Object.entries(oriObj)) {
                        if (status) return oriAbbrev[type] || type;
                    }
                    return null;
                };

                const ichDomCode = getSelectedDom(ichDom);
                const partnerDomCode = getSelectedDom(partnerDom);
                const ichOriCode = getSelectedOri(ichOri);
                const partnerOriCode = getSelectedOri(partnerOri);

                // Build code: Orientierung-Dominanz for each person
                const ichCode = [ichOriCode, ichDomCode].filter(Boolean).join('-');
                const partnerCode = [partnerOriCode, partnerDomCode].filter(Boolean).join('-');

                if (ichCode && partnerCode) {
                    comboCodeEl.textContent = `Code: ${ichCode}_${partnerCode}`;
                    comboCodeEl.style.display = 'inline-block';
                } else if (ichDomCode && partnerDomCode) {
                    // Fallback to just dominanz if orientierung not selected
                    comboCodeEl.textContent = `Code: ${ichDomCode}_${partnerDomCode}`;
                    comboCodeEl.style.display = 'inline-block';
                } else {
                    comboCodeEl.style.display = 'none';
                }
            } else {
                comboCodeEl.style.display = 'none';
            }

            document.getElementById('factorModalScore').textContent = score;
            document.getElementById('factorModalExplanation').textContent = factor.getExplanation(ich, partner, score, dimensions);

            const meaningList = document.getElementById('factorModalMeaning');
            meaningList.innerHTML = '';
            factor.getMeaning(score, ich, partner).forEach(item => {
                const li = document.createElement('li');
                // Support both old (string) and new (object with title+desc) formats
                if (typeof item === 'object' && item.title) {
                    li.innerHTML = `<strong>${item.title}</strong>${item.desc ? ` ‚Äì ${item.desc}` : ''}`;
                } else {
                    li.textContent = item;
                }
                meaningList.appendChild(li);
            });

            // Show modal
            document.getElementById('factorModal').classList.add('active');
            // Push state for back button to close modal
            history.pushState({ mobilePage: currentMobilePage, modal: 'factor' }, '', `#seite${currentMobilePage}-factor`);
        }

        function closeFactorModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('factorModal').classList.remove('active');
            // Go back in history if not triggered by back button
            if (!skipHistoryBack && history.state && history.state.modal === 'factor') {
                history.back();
            }
        }

        // Pro/Contra Modal Functions
        function openProContraModal() {
            console.log('openProContraModal called');
            const modal = document.getElementById('proContraModal');
            console.log('proContraModal element:', modal);
            if (!modal) {
                console.error('proContraModal not found!');
                return;
            }

            // Update archetype display
            updateProContraModalArchetypeDisplay();

            // Update score and pro/contra lists
            updateProContraModalContent();

            modal.classList.add('active');
            console.log('proContraModal activated, classList:', modal.classList.toString());
            history.pushState({ mobilePage: currentMobilePage, modal: 'procontra' }, '', `#seite${currentMobilePage}-procontra`);
        }

        function closeProContraModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('proContraModal').classList.remove('active');
            if (!skipHistoryBack && history.state && history.state.modal === 'procontra') {
                history.back();
            }
        }

        function updateProContraModalArchetypeDisplay() {
            const ichDisplay = document.getElementById('proContraModalIch');
            const partnerDisplay = document.getElementById('proContraModalPartner');
            if (ichDisplay) ichDisplay.textContent = archetypeDefinitions[currentArchetype]?.name || currentArchetype;
            if (partnerDisplay) partnerDisplay.textContent = archetypeDefinitions[selectedPartner]?.name || selectedPartner;
        }

        function updateProContraModalContent() {
            const scoreDisplay = document.getElementById('proContraModalScore');
            const proList = document.getElementById('proContraModalProList');
            const contraList = document.getElementById('proContraModalContraList');

            if (!scoreDisplay || !proList || !contraList) return;

            // Get current score
            const percentage = document.getElementById('resultPercentage');
            const currentScore = percentage ? percentage.textContent : '0%';
            scoreDisplay.textContent = currentScore;

            // Set color based on score
            const scoreValue = parseInt(currentScore) || 0;
            if (scoreValue >= 80) {
                scoreDisplay.style.color = 'var(--success)';
            } else if (scoreValue >= 65) {
                scoreDisplay.style.color = 'var(--primary)';
            } else if (scoreValue >= 50) {
                scoreDisplay.style.color = 'var(--warning)';
            } else {
                scoreDisplay.style.color = 'var(--danger)';
            }

            // Generate Pro/Contra directly
            const dynamicProContra = generateDynamicProContra(
                currentArchetype,
                selectedPartner,
                personDimensions.ich,
                personDimensions.partner
            );

            if (dynamicProContra.pro && dynamicProContra.pro.length > 0) {
                proList.innerHTML = dynamicProContra.pro.slice(0, 5).map(s => `<li>${s}</li>`).join('');
            } else {
                proList.innerHTML = '<li style="color: var(--text-muted);">Keine Daten verf√ºgbar</li>';
            }

            if (dynamicProContra.contra && dynamicProContra.contra.length > 0) {
                contraList.innerHTML = dynamicProContra.contra.slice(0, 5).map(c => `<li>${c}</li>`).join('');
            } else {
                contraList.innerHTML = '<li style="color: var(--text-muted);">Keine Daten verf√ºgbar</li>';
            }
        }

        function navigateProContraArchetype(person, direction) {
            // Use the same logic as navigateArchetype
            navigateArchetype(person, direction);

            // Update the modal displays
            updateProContraModalArchetypeDisplay();
            updateProContraModalContent();
        }

        // Pathos/Logos Modal Functions
        let currentPathosLogosType = localStorage.getItem('pathosLogosType') || 'pathos'; // Sticky: 'pathos' or 'logos'
        let currentPathosLogosContent = { pathos: '', logos: '' };

        function openPathosLogosModal(type = null) {
            const modal = document.getElementById('pathosLogosModal');
            if (!modal) return;

            // Use sticky type if no type specified
            if (type === null) {
                type = currentPathosLogosType;
            }
            currentPathosLogosType = type;

            // Get current archetypes
            const ichArch = archetypeDefinitions[currentArchetype];
            const partnerArch = archetypeDefinitions[selectedPartner];

            // Update archetype display
            const ichDisplay = document.getElementById('pathosLogosModalIch');
            const partnerDisplay = document.getElementById('pathosLogosModalPartner');
            if (ichDisplay) ichDisplay.textContent = ichArch?.name || currentArchetype;
            if (partnerDisplay) partnerDisplay.textContent = partnerArch?.name || selectedPartner;

            // Generate content
            currentPathosLogosContent.pathos = generateCombinedPathos(ichArch, partnerArch);
            currentPathosLogosContent.logos = generateCombinedLogos(ichArch, partnerArch);

            // Show the selected type
            showPathosLogosContent(type);

            // Update Score Cycle
            updateSyntheseScoreCycle();

            modal.classList.add('active');
            history.pushState({ mobilePage: currentMobilePage, modal: 'pathoslogos' }, '', `#seite${currentMobilePage}-pathoslogos`);
        }

        function closePathosLogosModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('pathosLogosModal').classList.remove('active');
            if (!skipHistoryBack && history.state && history.state.modal === 'pathoslogos') {
                history.back();
            }
        }

        function showPathosLogosContent(type) {
            currentPathosLogosType = type;
            // Save to localStorage for sticky behavior
            localStorage.setItem('pathosLogosType', type);

            const titleEl = document.getElementById('pathosLogosModalTitle');
            const iconEl = document.getElementById('pathosLogosIcon');
            const categoryEl = document.getElementById('pathosLogosCategory');
            const subtitleEl = document.getElementById('pathosLogosSubtitle');
            const contentEl = document.getElementById('pathosLogosModalContent');
            const archetypeContextEl = document.getElementById('pathosLogosArchetypeContext');
            const pathosBtn = document.getElementById('pathosLogosTogglePathos');
            const logosBtn = document.getElementById('pathosLogosToggleLogos');
            const modalPathosBtn = document.getElementById('modalPathosBtn');
            const modalLogosBtn = document.getElementById('modalLogosBtn');

            // Reset all button styles (for sticky side buttons)
            [pathosBtn, logosBtn].forEach(btn => {
                if (btn) {
                    btn.style.background = 'rgba(30,30,35,0.95)';
                    btn.style.color = 'var(--text-muted)';
                    btn.style.border = '1px solid var(--border)';
                }
            });

            // Reset modal header button styles
            [modalPathosBtn, modalLogosBtn].forEach(btn => {
                if (btn) btn.classList.remove('active');
            });

            if (type === 'pathos') {
                titleEl.textContent = "Tiage's Synthese";
                iconEl.textContent = 'üî•';
                categoryEl.textContent = 'Dynamische Qualit√§t (Pirsig)';
                subtitleEl.textContent = 'Pathos ‚Äì Emotionale Resonanz';
                archetypeContextEl.style.display = 'flex';
                contentEl.innerHTML = getPathosContent();
                pathosBtn.style.background = 'rgba(231,111,81,0.3)';
                pathosBtn.style.color = 'var(--text-primary)';
                pathosBtn.style.border = '1px solid #E76F51';
                if (modalPathosBtn) modalPathosBtn.classList.add('active');
            } else if (type === 'logos') {
                titleEl.textContent = "Tiage's Synthese";
                iconEl.textContent = 'üß†';
                categoryEl.textContent = 'Statische Qualit√§t (Pirsig)';
                subtitleEl.textContent = 'Logos ‚Äì Rationale Struktur';
                archetypeContextEl.style.display = 'flex';
                contentEl.innerHTML = getLogosContent();
                logosBtn.style.background = 'rgba(100,149,237,0.3)';
                logosBtn.style.color = 'var(--text-primary)';
                logosBtn.style.border = '1px solid #6495ED';
                if (modalLogosBtn) modalLogosBtn.classList.add('active');
            }
        }

        /**
         * Generiert HTML f√ºr GFK-Bed√ºrfnis-Tags im Pathos/Logos Modal
         * VEREINHEITLICHT: Nutzt berechneMatching (diff <= 15) statt analysiereWerBringtWasMit
         * @param {string} type - 'pathos' oder 'logos'
         * @returns {Object} HTML-Strings f√ºr gemeinsamSection, dynamikSection
         */
        function getGfkBeduerfnisAnalyse(type) {
            const result = {
                ichTags: '',
                partnerTags: '',
                gemeinsamSection: '',
                wachstumSection: '',
                dynamikSection: ''
            };

            // Pr√ºfen ob GfkBeduerfnisse verf√ºgbar ist
            if (typeof GfkBeduerfnisse === 'undefined') {
                return result;
            }

            // Archetyp-IDs normalisieren
            const ichArchetyp = (currentArchetype || '').replace('_', '-');
            const partnerArchetyp = (selectedPartner || '').replace('_', '-');

            if (!ichArchetyp || !partnerArchetyp) return result;

            // VEREINHEITLICHT: berechneMatching verwenden (gleiche Logik wie GFK-Matching oben)
            const matching = GfkBeduerfnisse.berechneMatching(ichArchetyp, partnerArchetyp);
            if (matching.fehler) return result;

            // Tag-Style
            const tagStyle = `display: inline-block; padding: 3px 8px; margin: 2px; border-radius: 10px; font-size: 11px; font-weight: 500;`;
            const tagStyleMatch = `${tagStyle} background: rgba(34,197,94,0.15); border: 1px solid rgba(34,197,94,0.5); color: #22c55e;`;

            // Gemeinsame Bed√ºrfnisse Section - gefiltert nach pathos/logos
            const gemeinsam = (matching.topUebereinstimmungen || []).filter(b => {
                const pl = GfkBeduerfnisse.getPathosLogos ? GfkBeduerfnisse.getPathosLogos(b.id) : null;
                return !pl || pl === type; // Wenn keine Zuordnung, zeige in beiden
            });

            if (gemeinsam.length > 0) {
                const tags = gemeinsam.slice(0, 5).map(b => {
                    const translatedLabel = TiageI18n.t(`needs.items.${b.id}`, b.label);
                    return `<span style="${tagStyleMatch}">${translatedLabel}</span>`;
                }).join('');
                const sectionTitle = type === 'pathos'
                    ? TiageI18n.t('needs.sharedTitle', 'GEMEINSAME BED√úRFNISSE')
                    : TiageI18n.t('needs.valuesTitle', 'GEMEINSAME WERTE');
                result.gemeinsamSection = `
                <div style="margin-bottom: 16px;">
                    <div style="padding: 12px; background: rgba(34,197,94,0.08); border-radius: 10px; border: 1px solid rgba(34,197,94,0.25);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="font-size: 14px;">ü§ù</span>
                            <span style="font-size: 11px; color: #22c55e; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">${sectionTitle}</span>
                        </div>
                        <div>${tags}</div>
                    </div>
                </div>`;
            }

            // Dynamik + Wachstum als kombinierter Flie√ütext
            // Dynamik: Aus gemeinsam mit Kategorie 'dynamik'
            const dynamikNeeds = (matching.details?.uebereinstimmend || []).filter(b => {
                const def = GfkBeduerfnisse.definitionen?.[b.id];
                return def?.kategorie === 'dynamik';
            });

            // Wachstum: Aus Konflikten (einer stark, anderer schwach)
            const wachstum = (matching.topKonflikte || []).slice(0, 3);

            if (dynamikNeeds.length > 0 || wachstum.length > 0) {
                const dynamikNames = dynamikNeeds.slice(0, 2).map(b => {
                    const label = TiageI18n.t(`needs.items.${b.id}`, b.label);
                    return `<span style="color: #8B5CF6; font-weight: 500;">${label}</span>`;
                });

                const wachstumNames = wachstum.slice(0, 2).map(b => {
                    const label = TiageI18n.t(`needs.items.${b.id}`, b.label);
                    return `<span style="color: #a855f7; font-weight: 500;">${label}</span>`;
                });

                let sentence = '';
                if (dynamikNames.length > 0 && wachstumNames.length > 0) {
                    const dynamikPart = dynamikNames.length > 1 ? `${dynamikNames[0]} und ${dynamikNames[1]}` : dynamikNames[0];
                    const wachstumPart = wachstumNames.length > 1 ? `${wachstumNames[0]} und ${wachstumNames[1]}` : wachstumNames[0];
                    sentence = `Eure Dynamik lebt von ${dynamikPart} ‚Äì hier liegt Wachstumspotential in ${wachstumPart}.`;
                } else if (dynamikNames.length > 0) {
                    const dynamikPart = dynamikNames.length > 1 ? `${dynamikNames[0]} und ${dynamikNames[1]}` : dynamikNames[0];
                    sentence = `Eure Dynamik entfaltet sich durch ${dynamikPart}.`;
                } else if (wachstumNames.length > 0) {
                    const wachstumPart = wachstumNames.length > 1 ? `${wachstumNames[0]} und ${wachstumNames[1]}` : wachstumNames[0];
                    sentence = `Wachstumspotential zeigt sich in ${wachstumPart}.`;
                }

                if (sentence) {
                    result.dynamikSection = `<p style="margin-top: 12px; font-size: 13px; line-height: 1.6; color: var(--text-secondary);">${sentence}</p>`;
                }
            }

            return result;
        }

        /**
         * Generiert das Jung+GFK kombinierte Statement f√ºr die psychologische Einordnung
         * C.G. Jung: Logos ‚Üí "Denken", Pathos ‚Üí "F√ºhlen"
         * GFK (Rosenberg): Logos ‚Üí Klarheit, Ordnung, Kompetenz; Pathos ‚Üí Harmonie, Empathie, Verbundenheit
         */
        function generateJungGfkStatement() {
            // Pr√ºfen ob GfkBeduerfnisse verf√ºgbar ist
            if (typeof GfkBeduerfnisse === 'undefined') {
                return '';
            }

            // Archetyp-IDs und Namen holen
            const ichArchetyp = (currentArchetype || '').replace('_', '-');
            const partnerArchetyp = (selectedPartner || '').replace('_', '-');
            const ichArch = archetypeDefinitions[currentArchetype];
            const partnerArch = archetypeDefinitions[selectedPartner];
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';

            if (!ichArchetyp || !partnerArchetyp) return '';

            // Pathos/Logos Scores berechnen
            const scores = GfkBeduerfnisse.berechnePathosLogosScores(ichArchetyp, partnerArchetyp);
            const pathosScore = scores.pathos || 50;
            const logosScore = scores.logos || 50;

            // Jung-Funktion ableiten (wer tendiert wohin?)
            // Person A: Vergleiche individuelle St√§rken
            const analyseA = GfkBeduerfnisse.analysiereWerBringtWasMit(ichArchetyp, ichArchetyp);
            const analyseB = GfkBeduerfnisse.analysiereWerBringtWasMit(partnerArchetyp, partnerArchetyp);

            // Logos-St√§rke = Anzahl starker Logos-Bed√ºrfnisse
            const ichLogosStaerke = (analyseA.ich?.staerken?.logos?.length || 0);
            const ichPathosStaerke = (analyseA.ich?.staerken?.pathos?.length || 0);
            const partnerLogosStaerke = (analyseB.ich?.staerken?.logos?.length || 0);
            const partnerPathosStaerke = (analyseB.ich?.staerken?.pathos?.length || 0);

            // Jung-Funktion bestimmen
            const jungFunktionA = ichLogosStaerke >= ichPathosStaerke ? 'Denken' : 'F√ºhlen';
            const jungFunktionB = partnerLogosStaerke >= partnerPathosStaerke ? 'Denken' : 'F√ºhlen';

            // GFK-Bed√ºrfnisse sammeln
            const gfkAnalyse = GfkBeduerfnisse.analysiereWerBringtWasMit(ichArchetyp, partnerArchetyp);
            if (gfkAnalyse.fehler) return '';

            // Top-Bed√ºrfnisse f√ºr die Liste (kombiniert Pathos + Logos)
            const gemeinsamPathos = (gfkAnalyse.gemeinsam?.pathos || []).slice(0, 2);
            const gemeinsamLogos = (gfkAnalyse.gemeinsam?.logos || []).slice(0, 2);
            const allGemeinsam = [...gemeinsamPathos, ...gemeinsamLogos];
            const beduerfnisListe = allGemeinsam.map(b => b.label).join(', ') || 'Wertsch√§tzung, Vertrauen';

            // Jung-Dynamik-Text generieren
            let jungDynamikText = '';
            if (jungFunktionA === jungFunktionB) {
                if (jungFunktionA === 'Denken') {
                    jungDynamikText = 'Beide operieren prim√§r aus der rationalen Funktion ‚Äì eine analytische Partnerschaft mit klarem Fokus auf Struktur und Werte.';
                } else {
                    jungDynamikText = 'Beide operieren prim√§r aus der Gef√ºhlsfunktion ‚Äì eine empathische Verbindung mit starkem emotionalem Fundament.';
                }
            } else {
                jungDynamikText = 'Diese komplement√§re Konstellation vereint Ratio und Emotion ‚Äì eine fruchtbare Spannung, die beide Seiten bereichern kann.';
            }

            // HTML generieren
            return `
            <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, rgba(139,92,246,0.08), rgba(59,130,246,0.05)); border-radius: 12px; border: 1px solid rgba(139,92,246,0.25);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <span style="font-size: 16px;">üß¨</span>
                    <span style="font-size: 12px; color: #8B5CF6; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">PSYCHOLOGISCHE EINORDNUNG</span>
                </div>
                <p style="font-size: 13px; line-height: 1.7; margin: 0; color: var(--text-secondary);">
                    Aus Sicht der Tiefenpsychologie (C.G. Jung): <strong style="color: var(--text-primary);">${ichName}</strong> tendiert zur <em style="color: #8B5CF6;">${jungFunktionA}</em>-Funktion, <strong style="color: var(--text-primary);">${partnerName}</strong> zur <em style="color: #8B5CF6;">${jungFunktionB}</em>-Funktion. ${jungDynamikText}
                </p>
                <p style="font-size: 13px; line-height: 1.7; margin: 12px 0 0 0; color: var(--text-secondary);">
                    Die damit verbundenen Grundbed√ºrfnisse (nach Rosenberg) ‚Äì <span style="color: #22c55e; font-weight: 500;">${beduerfnisListe}</span> ‚Äì bilden das emotionale Fundament dieser Verbindung.
                </p>
            </div>`;
        }

        function getPathosContent() {
            const ichArch = archetypeDefinitions[currentArchetype];
            const partnerArch = archetypeDefinitions[selectedPartner];
            const detailed = generateDetailedPathos(ichArch, partnerArch);
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';

            // GFK-Bed√ºrfnis-Analyse holen
            const gfkAnalyse = getGfkBeduerfnisAnalyse('pathos');

            const creativityLabel = TiageI18n.t('synthesisSection.creativity', 'CREATIVITY');

            // Dynamik+Wachstum kombiniert als Flie√ütext
            const dynamikWachstumText = gfkAnalyse.dynamikSection || '';

            let html = `
                <!-- GEMEINSAME BED√úRFNISSE -->
                ${gfkAnalyse.gemeinsamSection}

                <!-- CREATIVITY -->
                <div style="margin-bottom: 16px;">
                    <div style="padding: 14px; background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(231,111,81,0.08)); border-radius: 10px; border: 1px solid rgba(231,111,81,0.3);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <span style="font-size: 14px;">üî•</span>
                            <span style="font-size: 11px; color: #FFD700; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">${creativityLabel}</span>
                        </div>
                        <p style="font-size: 14px; margin: 0; line-height: 1.6; font-style: italic;">${detailed.synthese}</p>
                        ${dynamikWachstumText}
                    </div>
                </div>`;

            // PSYCHOLOGISCHE EINORDNUNG (Jung + GFK)
            html += generateJungGfkStatement();

            return html;
        }

        function getLogosContent() {
            const ichArch = archetypeDefinitions[currentArchetype];
            const partnerArch = archetypeDefinitions[selectedPartner];
            const detailed = generateDetailedLogos(ichArch, partnerArch);
            const ichName = ichArch?.name || 'ICH';
            const partnerName = partnerArch?.name || 'Partner';

            // GFK-Bed√ºrfnis-Analyse holen
            const gfkAnalyse = getGfkBeduerfnisAnalyse('logos');

            const creativityLabel = TiageI18n.t('synthesisSection.creativity', 'CREATIVITY');

            // Dynamik+Wachstum kombiniert als Flie√ütext
            const dynamikWachstumText = gfkAnalyse.dynamikSection || '';

            let html = `
                <!-- GEMEINSAME WERTE -->
                ${gfkAnalyse.gemeinsamSection}

                <!-- CREATIVITY -->
                <div style="margin-bottom: 16px;">
                    <div style="padding: 14px; background: linear-gradient(135deg, rgba(100,149,237,0.1), rgba(69,123,157,0.08)); border-radius: 10px; border: 1px solid rgba(69,123,157,0.3);">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <span style="font-size: 14px;">üß†</span>
                            <span style="font-size: 11px; color: #6495ED; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">${creativityLabel}</span>
                        </div>
                        <p style="font-size: 14px; margin: 0; line-height: 1.6; font-style: italic;">${detailed.synthese}</p>
                        ${dynamikWachstumText}
                    </div>
                </div>`;

            // PSYCHOLOGISCHE EINORDNUNG (Jung + GFK)
            html += generateJungGfkStatement();

            return html;
        }

        // Navigate archetypes within Pathos/Logos Modal
        function navigatePathosLogosArchetype(person, direction) {
            const archetypes = archetypeOrder;
            let currentIndex;

            if (person === 'ich') {
                currentIndex = archetypes.indexOf(currentArchetype);
                currentIndex = (currentIndex + direction + archetypes.length) % archetypes.length;
                currentArchetype = archetypes[currentIndex];
                mobileIchArchetype = archetypes[currentIndex];

                // Sync dropdowns
                const ichSelect = document.getElementById('ichSelect');
                const mobileIchSelect = document.getElementById('mobileIchSelect');
                if (ichSelect) ichSelect.value = currentArchetype;
                if (mobileIchSelect) mobileIchSelect.value = currentArchetype;
            } else {
                currentIndex = archetypes.indexOf(selectedPartner);
                currentIndex = (currentIndex + direction + archetypes.length) % archetypes.length;
                selectedPartner = archetypes[currentIndex];
                mobilePartnerArchetype = archetypes[currentIndex];

                // Sync dropdowns
                const partnerSelect = document.getElementById('partnerSelect');
                const mobilePartnerSelect = document.getElementById('mobilePartnerSelect');
                if (partnerSelect) partnerSelect.value = selectedPartner;
                if (mobilePartnerSelect) mobilePartnerSelect.value = selectedPartner;
            }

            // Update the modal display
            const ichArch = archetypeDefinitions[currentArchetype];
            const partnerArch = archetypeDefinitions[selectedPartner];

            const ichDisplay = document.getElementById('pathosLogosModalIch');
            const partnerDisplay = document.getElementById('pathosLogosModalPartner');
            if (ichDisplay) ichDisplay.textContent = ichArch?.name || currentArchetype;
            if (partnerDisplay) partnerDisplay.textContent = partnerArch?.name || selectedPartner;

            // Regenerate content with new archetypes
            currentPathosLogosContent.pathos = generateCombinedPathos(ichArch, partnerArch);
            currentPathosLogosContent.logos = generateCombinedLogos(ichArch, partnerArch);

            // Refresh the displayed content
            showPathosLogosContent(currentPathosLogosType);

            // Save to localStorage and update main view
            saveSelectionToStorage();
            if (typeof updateComparisonView === 'function') updateComparisonView();
            if (typeof updateMobileCardsContent === 'function') updateMobileCardsContent();

            // Update Score Cycle with new score
            updateSyntheseScoreCycle();
        }

        function getTiageTheoryContent() {
            return `
                <div style="space-y: 20px;">
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Die Synthese</h4>
                        <p style="margin-bottom: 10px;">Das Tiage-Beziehungsmodell verbindet zwei philosophische Traditionen zu einem praktischen Analyse-Tool:</p>
                        <ul style="padding-left: 20px; margin-bottom: 15px;">
                            <li style="margin-bottom: 6px;"><strong>Robert M. Pirsig (MOQ):</strong> Metaphysik der Qualit√§t ‚Äì statische vs. dynamische Qualit√§t als Grundstruktur</li>
                            <li style="margin-bottom: 6px;"><strong>OSHO:</strong> Bewusstsein durch Meditation ‚Äì Polarit√§t, Balance, Schwingung</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 8px; border-left: 3px solid var(--primary);">
                        <h4 style="color: var(--text-primary); margin-bottom: 10px; font-size: 14px;">Logos vs. Pathos (40:60)</h4>
                        <p style="margin-bottom: 8px;"><strong style="color: var(--text-muted);">Logos (40%):</strong> Die rationale, strukturgebende Dimension. Pirsig nennt dies "statische Qualit√§t" ‚Äì bew√§hrte Muster, die Stabilit√§t schaffen.</p>
                        <p><strong style="color: var(--text-muted);">Pathos (60%):</strong> Die emotionale, anziehende Dimension. Pirsig nennt dies "dynamische Qualit√§t" ‚Äì die Kraft, die Ver√§nderung und Wachstum antreibt.</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Tiage's Widerspruch zu Pirsig</h4>
                        <p style="margin-bottom: 10px;">Pirsig argumentierte, dass Definitionen die unmittelbare Qualit√§t des Erlebens zerst√∂ren.</p>
                        <p style="margin-bottom: 10px;"><strong>Diese App basiert auf der gegenteiligen Erfahrung:</strong></p>
                        <p style="font-style: italic; padding: 10px; background: rgba(255,255,255,0.03); border-radius: 6px;">"Definition und Erleben sind nicht getrennt. Sie entstehen gleichzeitig ‚Äì im Dialog, in Resonanz, in extremer K√ºrze."</p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">OSHO & Dialog als Meditation</h4>
                        <p style="margin-bottom: 10px;">OSHOs Philosophie verbindet sich mit Tiages Widerspruch:</p>
                        <ul style="padding-left: 20px;">
                            <li style="margin-bottom: 6px;"><strong>OSHO:</strong> "Worte k√∂nnen lebendig sein, wenn Bewusstheit dahinter steht."</li>
                            <li style="margin-bottom: 6px;"><strong>Tiage:</strong> Im bewussten Dialog <em>ist</em> die Definition das Erleben.</li>
                        </ul>
                        <p style="margin-top: 10px; font-style: italic; color: var(--text-muted);">Die Qualit√§t entsteht nicht trotz der Sprache, sondern durch sie ‚Äì wenn zwei Menschen auf derselben Wellenl√§nge schwingen.</p>
                    </div>

                    <div style="text-align: center; padding-top: 10px; border-top: 1px solid var(--border);">
                        <p style="font-size: 12px; color: var(--text-muted);">Tiage's Beitrag: Die Verbindung beider Philosophien zu einem konkreten Beziehungs-Rechner mit eigener Gewichtung (40:60 Logos:Pathos) und 6 Archetypen.</p>
                    </div>
                </div>
            `;
        }

        // Factor Modal Archetype Navigation
        let currentFactorType = null;
        let currentFactorSource = 'mobile';

        function navigateFactorArchetype(person, direction) {
            // Get current archetype for the person
            let currentArch;
            if (person === 'ich') {
                currentArch = mobileIchArchetype;
            } else {
                currentArch = mobilePartnerArchetype;
            }

            // Find current index and calculate new index
            let currentIdx = archetypeOrder.indexOf(currentArch);
            if (currentIdx === -1) currentIdx = 0;

            let newIndex = currentIdx + direction;
            if (newIndex < 0) newIndex = archetypeOrder.length - 1;
            if (newIndex >= archetypeOrder.length) newIndex = 0;

            const newArchetype = archetypeOrder[newIndex];

            // Update the actual selections and sync both mobile and desktop
            if (person === 'ich') {
                mobileIchArchetype = newArchetype;
                currentArchetype = newArchetype; // Sync desktop variable
                // Update mobile and desktop select elements
                const mobileSelect = document.getElementById('mobileIchSelect');
                const desktopSelect = document.getElementById('ichSelect');
                if (mobileSelect) mobileSelect.value = newArchetype;
                if (desktopSelect) desktopSelect.value = newArchetype;
            } else {
                mobilePartnerArchetype = newArchetype;
                selectedPartner = newArchetype; // Sync desktop variable
                // Update mobile and desktop select elements
                const mobileSelect = document.getElementById('mobilePartnerSelect');
                const desktopSelect = document.getElementById('partnerSelect');
                if (mobileSelect) mobileSelect.value = newArchetype;
                if (desktopSelect) desktopSelect.value = newArchetype;
            }

            // Update the display in the modal
            updateFactorModalArchetypeDisplay();

            // Preserve selection state: sync Dominanz and Orientierung UI with stored state
            syncDominanzUI('ich');
            syncDominanzUI('partner');
            syncOrientierungUI('ich');
            syncOrientierungUI('partner');

            // Trigger full recalculation for both mobile and desktop views
            if (typeof updateComparisonView === 'function') {
                updateComparisonView();
            }
            if (typeof updateMobileResultPage === 'function') {
                updateMobileResultPage();
            }
            if (typeof updateMobileProContraPage === 'function') {
                updateMobileProContraPage();
            }

            // Recalculate and update the modal content after views are updated
            if (currentFactorType) {
                // Get updated score from display elements
                const prefix = currentFactorSource === 'desktop' ? 'desktopFactor' : 'mobileFactor';
                let score = 0;
                if (currentFactorType === 'archetyp') {
                    score = parseInt(document.getElementById(prefix + 'Archetyp')?.textContent) || 0;
                } else if (currentFactorType === 'dominanz') {
                    score = parseInt(document.getElementById(prefix + 'Dominanz')?.textContent) || 0;
                } else if (currentFactorType === 'orientierung') {
                    score = parseInt(document.getElementById(prefix + 'Orientierung')?.textContent) || 0;
                } else if (currentFactorType === 'geschlecht') {
                    score = parseInt(document.getElementById(prefix + 'Geschlecht')?.textContent) || 0;
                }

                const factor = factorExplanations[currentFactorType];
                if (factor) {
                    const ich = mobileIchArchetype;
                    const partner = mobilePartnerArchetype;
                    const dimensions = currentFactorSource === 'desktop' ? personDimensions : mobilePersonDimensions;

                    document.getElementById('factorModalScore').textContent = score;
                    document.getElementById('factorModalExplanation').textContent = factor.getExplanation(ich, partner, score, dimensions);

                    const meaningList = document.getElementById('factorModalMeaning');
                    meaningList.innerHTML = '';
                    factor.getMeaning(score, ich, partner).forEach(item => {
                        const li = document.createElement('li');
                        // Support both old (string) and new (object with title+desc) formats
                        if (typeof item === 'object' && item.title) {
                            li.innerHTML = `<strong>${item.title}</strong>${item.desc ? ` ‚Äì ${item.desc}` : ''}`;
                        } else {
                            li.textContent = item;
                        }
                        meaningList.appendChild(li);
                    });
                }
            }
        }

        function updateFactorModalArchetypeDisplay() {
            const ichCodeEl = document.getElementById('factorModalIchCode');
            const partnerCodeEl = document.getElementById('factorModalPartnerCode');

            if (ichCodeEl) {
                const ichDef = archetypeDefinitions[mobileIchArchetype];
                ichCodeEl.textContent = ichDef ? ichDef.name : mobileIchArchetype;
            }
            if (partnerCodeEl) {
                const partnerDef = archetypeDefinitions[mobilePartnerArchetype];
                partnerCodeEl.textContent = partnerDef ? partnerDef.name : mobilePartnerArchetype;
            }

            // Update combo code if visible
            const comboCodeEl = document.getElementById('factorModalComboCode');
            if (comboCodeEl && comboCodeEl.style.display !== 'none') {
                comboCodeEl.textContent = `Code: ${mobileIchArchetype}_${mobilePartnerArchetype}`;
            }
        }

        // ========================================
        // HELP MODAL FUNCTIONS
        // ========================================

        // Flag to track if help content has been loaded
        let helpContentLoaded = false;

        async function openHelpModal() {
            console.log('openHelpModal called');
            const modal = document.getElementById('helpModal');
            console.log('helpModal element:', modal);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
                console.log('helpModal activated');
                // Push state for back button to close modal
                history.pushState({ mobilePage: currentMobilePage, modal: 'help' }, '', `#seite${currentMobilePage}-help`);

                // Load Markdown content dynamically on first open
                if (!helpContentLoaded && typeof MarkdownLoader !== 'undefined') {
                    const contentContainer = modal.querySelector('.help-modal-content');
                    if (contentContainer) {
                        try {
                            // Load help guide from Markdown
                            await MarkdownLoader.loadInto('docs/help-guide.md', contentContainer, true);
                            helpContentLoaded = true;
                            console.log('Help content loaded from Markdown');
                        } catch (error) {
                            console.error('Failed to load help content:', error);
                            // Keep static content as fallback
                        }
                    }
                }
            } else {
                console.error('helpModal element not found!');
            }
        }

        function closeHelpModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('helpModal').classList.remove('active');
            document.body.style.overflow = '';
            // Go back in history if not triggered by back button
            if (!skipHistoryBack && history.state && history.state.modal === 'help') {
                history.back();
            }
        }

        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const factorModal = document.getElementById('factorModal');
                if (factorModal && factorModal.classList.contains('active')) {
                    closeFactorModal();
                    return;
                }
                const helpModal = document.getElementById('helpModal');
                if (helpModal && helpModal.classList.contains('active')) {
                    closeHelpModal();
                    return;
                }
                const commentModal = document.getElementById('commentModal');
                if (commentModal && commentModal.classList.contains('active')) {
                    closeCommentModal();
                    return;
                }
            }
        });

        // ========================================
        // COMMENT MODAL FUNCTIONS
        // ========================================

        function openCommentModal() {
            document.getElementById('commentModal').classList.add('active');
            // Push state for back button to close modal
            history.pushState({ mobilePage: currentMobilePage, modal: 'comment' }, '', `#seite${currentMobilePage}-comment`);
        }

        function closeCommentModal(event, skipHistoryBack = false) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('commentModal').classList.remove('active');
            // Reset form
            document.getElementById('commentName').value = '';
            document.getElementById('commentType').value = 'frage';
            document.getElementById('commentText').value = '';
            // Go back in history if not triggered by back button
            if (!skipHistoryBack && history.state && history.state.modal === 'comment') {
                history.back();
            }
        }

        async function submitComment() {
            const name = document.getElementById('commentName').value.trim();
            const typ = document.getElementById('commentType').value;
            const text = document.getElementById('commentText').value.trim();

            // Validation
            if (!name) {
                alert('Bitte gib deinen Namen/K√ºrzel ein.');
                return;
            }
            if (!text) {
                alert('Bitte schreibe einen Kommentar.');
                return;
            }

            const commentEntry = {
                type: 'comment',  // Wichtig f√ºr das Google Script
                id: 'com_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                name: name,
                kommentarTyp: typ,
                kommentar: text,
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent.substring(0, 100),
                page: 'hilfe-modal'
            };

            const submitBtn = document.getElementById('commentSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sende...';

            try {
                if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(commentEntry)
                    });
                }

                // Also save locally as backup
                const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
                stored.unshift(commentEntry);
                localStorage.setItem('tiage_comments', JSON.stringify(stored));

                alert('Danke f√ºr deinen Kommentar!');
                closeCommentModal();

            } catch (error) {
                console.error('Comment error:', error);
                // Save locally on error
                const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
                stored.unshift(commentEntry);
                localStorage.setItem('tiage_comments', JSON.stringify(stored));
                alert('Kommentar lokal gespeichert. (Server nicht erreichbar)');
                closeCommentModal();
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Absenden';
        }

        // ========================================
        // COMMENTS LIST MODAL FUNCTIONS
        // ========================================

        let allCommentsData = [];
        let currentSearchQuery = '';

        function openCommentsListModal() {
            console.log('openCommentsListModal called');
            document.getElementById('commentsListModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset search field
            const searchInput = document.getElementById('commentsSearchInput');
            if (searchInput) searchInput.value = '';
            currentSearchQuery = '';
            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) clearBtn.classList.remove('visible');
            const resultsDiv = document.getElementById('commentsSearchResults');
            if (resultsDiv) resultsDiv.style.display = 'none';

            loadAllComments();
        }

        function closeCommentsListModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('commentsListModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        async function loadAllComments() {
            const container = document.getElementById('commentsListBody');
            container.innerHTML = '<div class="no-comments"><div class="no-comments-icon">‚è≥</div><p>Lade Kommentare...</p></div>';

            try {
                // Load from localStorage - nur eine Quelle: tiage_comments
                const localComments = JSON.parse(localStorage.getItem('tiage_comments') || '[]');

                // Deduplizierung basierend auf Name + Titel + Text
                const seen = new Set();
                const getUniqueKey = (item) => {
                    const name = (item.Name || item.name || '').toLowerCase().trim();
                    const titel = (item.Titel || item.titel || '').toLowerCase().trim();
                    const text = (item.Kommentar || item.kommentar || item.text || item.comment || '').toLowerCase().trim();
                    return `${name}|${titel}|${text}`;
                };

                allCommentsData = [];

                // Add local comments
                localComments.forEach(item => {
                    const key = getUniqueKey(item);
                    if (!seen.has(key)) {
                        seen.add(key);
                        allCommentsData.push(item);
                    }
                });

                // Try to load from server if available
                if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                    try {
                        const response = await fetch(GOOGLE_SCRIPT_URL);
                        const serverData = await response.json();
                        // Merge server data (avoiding duplicates)
                        serverData.forEach(item => {
                            const key = getUniqueKey(item);
                            if (!seen.has(key)) {
                                seen.add(key);
                                allCommentsData.push(item);
                            }
                        });
                    } catch (e) {
                        console.log('Server not available, using local data only');
                    }
                }

                // Sort by date (newest first)
                allCommentsData.sort((a, b) => {
                    const dateA = new Date(a.timestamp || a.Timestamp || a.datum || 0);
                    const dateB = new Date(b.timestamp || b.Timestamp || b.datum || 0);
                    return dateB - dateA;
                });

                renderCommentsList();
            } catch (error) {
                console.error('Error loading comments:', error);
                container.innerHTML = '<div class="no-comments"><div class="no-comments-icon">‚ùå</div><p>Fehler beim Laden der Kommentare</p></div>';
            }
        }

        function renderCommentsList() {
            const container = document.getElementById('commentsListBody');

            if (allCommentsData.length === 0) {
                container.innerHTML = `
                    <div class="no-comments">
                        <div class="no-comments-icon">üí¨</div>
                        <p>Noch keine Kommentare vorhanden.</p>
                        <p style="font-size: 12px; margin-top: 10px;">Sei der Erste, der einen Kommentar hinterl√§sst!</p>
                    </div>
                `;
                return;
            }

            // Separate main comments from replies
            const mainComments = allCommentsData.filter(c => !(c.AntwortAuf || c.antwortAuf || c.replyTo));
            const replies = allCommentsData.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));

            let html = '';

            mainComments.forEach((comment, index) => {
                const id = comment.id || comment.ID || `comment-${index}`;
                const name = comment.Name || comment.name || 'Anonym';
                const titel = comment.Titel || comment.titel || comment.type || '';
                const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
                const kontext = comment.KontextID || comment.kontextId || comment.context || '';
                const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
                const timestamp = comment.timestamp || comment.Timestamp || comment.datum;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                // Find replies to this comment
                const commentReplies = replies.filter(r =>
                    (r.AntwortAuf || r.antwortAuf || r.replyTo) === id
                );

                html += `
                    <div class="comment-card" data-id="${id}">
                        <div class="comment-card-header">
                            <div>
                                <span class="comment-author">${escapeHtml(name)}</span>
                                <span class="comment-date">${date}</span>
                            </div>
                            <span class="comment-type-badge type-${typ || 'comment'}">${getTypeBadge(typ)}</span>
                        </div>
                        <div class="comment-card-body">
                            ${titel ? `<div class="comment-title">${escapeHtml(titel)}</div>` : ''}
                            <div class="comment-text">${escapeHtml(text)}</div>
                            ${kontext ? `<div class="comment-context">üìç Kontext: ${escapeHtml(kontext)}</div>` : ''}
                        </div>
                        ${commentReplies.length > 0 ? renderReplies(commentReplies) : ''}
                        <div class="comment-card-footer">
                            <span style="font-size: 11px; color: var(--text-muted);">${commentReplies.length} Antwort${commentReplies.length !== 1 ? 'en' : ''}</span>
                            <button class="reply-btn" onclick="toggleReplyForm('${id}')">‚Ü© Antworten</button>
                        </div>
                        <div class="reply-form" id="reply-form-${id}">
                            <input type="text" id="reply-name-${id}" placeholder="Dein Name" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                            <textarea id="reply-text-${id}" placeholder="Deine Antwort..."></textarea>
                            <div class="reply-form-buttons">
                                <button class="reply-cancel-btn" onclick="toggleReplyForm('${id}')">Abbrechen</button>
                                <button class="reply-submit-btn" onclick="submitReply('${id}')">Antworten</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderReplies(replies) {
            let html = '<div class="replies-section">';
            replies.forEach(reply => {
                const name = reply.Name || reply.name || 'Anonym';
                const text = reply.Kommentar || reply.kommentar || reply.text || '';
                const timestamp = reply.timestamp || reply.Timestamp;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                html += `
                    <div class="reply-card">
                        <div class="reply-header">
                            <span class="reply-author">${escapeHtml(name)}</span>
                            <span class="reply-date">${date}</span>
                        </div>
                        <div class="reply-text">${escapeHtml(text)}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        // Convert wildcard pattern to regex
        function wildcardToRegex(pattern) {
            // Escape special regex characters except *
            const escaped = pattern.replace(/[.+?^${}()|[\]\\]/g, '\\$&');
            // Convert * to .* for wildcard matching
            const regex = escaped.replace(/\*/g, '.*');
            return new RegExp(regex, 'i'); // Case insensitive
        }

        // Check if a comment matches the search query
        function commentMatchesSearch(comment, query) {
            if (!query || query.trim() === '') return true;

            const searchPattern = wildcardToRegex(query.trim());

            // Get all searchable fields
            const name = comment.Name || comment.name || '';
            const titel = comment.Titel || comment.titel || comment.type || '';
            const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
            const kontext = comment.KontextID || comment.kontextId || comment.context || '';
            const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
            const typLabel = getTypeBadge(typ);

            // Check if any field matches
            return searchPattern.test(name) ||
                   searchPattern.test(titel) ||
                   searchPattern.test(text) ||
                   searchPattern.test(kontext) ||
                   searchPattern.test(typ) ||
                   searchPattern.test(typLabel);
        }

        // Filter and render comments based on search query
        function filterComments(query) {
            currentSearchQuery = query;

            // Update clear button visibility
            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) {
                clearBtn.classList.toggle('visible', query.length > 0);
            }

            renderFilteredComments();
        }

        // Clear search and show all comments
        function clearCommentsSearch() {
            const input = document.getElementById('commentsSearchInput');
            if (input) {
                input.value = '';
            }
            currentSearchQuery = '';

            const clearBtn = document.getElementById('commentsSearchClear');
            if (clearBtn) {
                clearBtn.classList.remove('visible');
            }

            const resultsDiv = document.getElementById('commentsSearchResults');
            if (resultsDiv) {
                resultsDiv.style.display = 'none';
            }

            renderCommentsList();
        }

        // Render comments with current filter applied
        function renderFilteredComments() {
            const container = document.getElementById('commentsListBody');
            const resultsDiv = document.getElementById('commentsSearchResults');

            if (!currentSearchQuery || currentSearchQuery.trim() === '') {
                if (resultsDiv) resultsDiv.style.display = 'none';
                renderCommentsList();
                return;
            }

            // Filter comments
            const filteredComments = allCommentsData.filter(c => commentMatchesSearch(c, currentSearchQuery));

            // Show results count
            if (resultsDiv) {
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = `${filteredComments.length} von ${allCommentsData.length} Kommentare${filteredComments.length !== 1 ? 'n' : ''} gefunden`;
            }

            if (filteredComments.length === 0) {
                container.innerHTML = `
                    <div class="no-comments">
                        <div class="no-comments-icon">üîç</div>
                        <p>Keine Kommentare gefunden.</p>
                        <p style="font-size: 12px; margin-top: 10px;">Versuche einen anderen Suchbegriff oder verwende * als Platzhalter.</p>
                    </div>
                `;
                return;
            }

            // Separate main comments from replies
            const mainComments = filteredComments.filter(c => !(c.AntwortAuf || c.antwortAuf || c.replyTo));
            const allReplies = allCommentsData.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));
            const filteredReplies = filteredComments.filter(c => (c.AntwortAuf || c.antwortAuf || c.replyTo));

            let html = '';

            // Render matching main comments
            mainComments.forEach((comment, index) => {
                const id = comment.id || comment.ID || `comment-${index}`;
                const name = comment.Name || comment.name || 'Anonym';
                const titel = comment.Titel || comment.titel || comment.type || '';
                const text = comment.Kommentar || comment.kommentar || comment.text || comment.comment || '';
                const kontext = comment.KontextID || comment.kontextId || comment.context || '';
                const typ = comment.Typ || comment.typ || comment.kommentarTyp || comment.type || 'comment';
                const timestamp = comment.timestamp || comment.Timestamp || comment.datum;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                // Find all replies to this comment (not filtered)
                const commentReplies = allReplies.filter(r =>
                    (r.AntwortAuf || r.antwortAuf || r.replyTo) === id
                );

                html += `
                    <div class="comment-card" data-id="${id}">
                        <div class="comment-card-header">
                            <div>
                                <span class="comment-author">${highlightMatch(escapeHtml(name), currentSearchQuery)}</span>
                                <span class="comment-date">${date}</span>
                            </div>
                            <span class="comment-type-badge type-${typ || 'comment'}">${getTypeBadge(typ)}</span>
                        </div>
                        <div class="comment-card-body">
                            ${titel ? `<div class="comment-title">${highlightMatch(escapeHtml(titel), currentSearchQuery)}</div>` : ''}
                            <div class="comment-text">${highlightMatch(escapeHtml(text), currentSearchQuery)}</div>
                            ${kontext ? `<div class="comment-context">üìç Kontext: ${highlightMatch(escapeHtml(kontext), currentSearchQuery)}</div>` : ''}
                        </div>
                        ${commentReplies.length > 0 ? renderRepliesWithHighlight(commentReplies, currentSearchQuery) : ''}
                        <div class="comment-card-footer">
                            <span style="font-size: 11px; color: var(--text-muted);">${commentReplies.length} Antwort${commentReplies.length !== 1 ? 'en' : ''}</span>
                            <button class="reply-btn" onclick="toggleReplyForm('${id}')">‚Ü© Antworten</button>
                        </div>
                        <div class="reply-form" id="reply-form-${id}">
                            <input type="text" id="reply-name-${id}" placeholder="Dein Name" style="width: 100%; padding: 8px; margin-bottom: 10px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                            <textarea id="reply-text-${id}" placeholder="Deine Antwort..."></textarea>
                            <div class="reply-form-buttons">
                                <button class="reply-cancel-btn" onclick="toggleReplyForm('${id}')">Abbrechen</button>
                                <button class="reply-submit-btn" onclick="submitReply('${id}')">Antworten</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            // Also show replies that match but their parent doesn't
            const orphanReplies = filteredReplies.filter(reply => {
                const parentId = reply.AntwortAuf || reply.antwortAuf || reply.replyTo;
                return !mainComments.some(c => (c.id || c.ID) === parentId);
            });

            if (orphanReplies.length > 0) {
                html += `<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border);">
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 10px;">Passende Antworten:</div>
                `;
                orphanReplies.forEach(reply => {
                    const name = reply.Name || reply.name || 'Anonym';
                    const text = reply.Kommentar || reply.kommentar || reply.text || '';
                    const timestamp = reply.timestamp || reply.Timestamp;
                    const date = timestamp ? formatCommentDate(timestamp) : '';

                    html += `
                        <div class="reply-card" style="margin-left: 0; background: var(--bg-secondary); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <div class="reply-header">
                                <span class="reply-author">${highlightMatch(escapeHtml(name), currentSearchQuery)}</span>
                                <span class="reply-date">${date}</span>
                            </div>
                            <div class="reply-text">${highlightMatch(escapeHtml(text), currentSearchQuery)}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            container.innerHTML = html;
        }

        // Highlight matching text in search results
        function highlightMatch(text, query) {
            if (!query || query.trim() === '') return text;

            try {
                const pattern = wildcardToRegex(query.trim());
                return text.replace(pattern, match => `<span class="search-highlight">${match}</span>`);
            } catch (e) {
                return text;
            }
        }

        // Render replies with search highlighting
        function renderRepliesWithHighlight(replies, query) {
            let html = '<div class="replies-section">';
            replies.forEach(reply => {
                const name = reply.Name || reply.name || 'Anonym';
                const text = reply.Kommentar || reply.kommentar || reply.text || '';
                const timestamp = reply.timestamp || reply.Timestamp;
                const date = timestamp ? formatCommentDate(timestamp) : '';

                html += `
                    <div class="reply-card">
                        <div class="reply-header">
                            <span class="reply-author">${highlightMatch(escapeHtml(name), query)}</span>
                            <span class="reply-date">${date}</span>
                        </div>
                        <div class="reply-text">${highlightMatch(escapeHtml(text), query)}</div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function toggleReplyForm(commentId) {
            const form = document.getElementById(`reply-form-${commentId}`);
            if (form) {
                form.classList.toggle('active');
            }
        }

        async function submitReply(parentId) {
            const nameInput = document.getElementById(`reply-name-${parentId}`);
            const textInput = document.getElementById(`reply-text-${parentId}`);

            const name = nameInput?.value.trim() || 'Anonym';
            const text = textInput?.value.trim();

            if (!text) {
                alert('Bitte gib eine Antwort ein.');
                return;
            }

            const reply = {
                id: 'reply_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                Name: name,
                Kommentar: text,
                AntwortAuf: parentId,
                timestamp: new Date().toISOString(),
                Typ: 'antwort'
            };

            // Save locally
            const stored = JSON.parse(localStorage.getItem('tiage_comments') || '[]');
            stored.push(reply);
            localStorage.setItem('tiage_comments', JSON.stringify(stored));

            // Try to save to server
            if (typeof GOOGLE_SCRIPT_URL !== 'undefined' && GOOGLE_SCRIPT_URL) {
                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(reply)
                    });
                } catch (e) {
                    console.log('Server save failed, reply saved locally');
                }
            }

            // Clear form and reload
            if (nameInput) nameInput.value = '';
            if (textInput) textInput.value = '';
            toggleReplyForm(parentId);

            // Reload comments
            loadAllComments();
        }

        function formatCommentDate(timestamp) {
            try {
                const date = new Date(timestamp);
                return date.toLocaleDateString('de-DE', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return '';
            }
        }

        function getTypeBadge(typ) {
            const types = {
                'frage': 'Frage',
                'feedback': 'Comment',  // Feedback = Comment (vereinheitlicht)
                'fehler': 'Fehler',
                'verbesserung': 'Vorschlag',
                'doku': 'Doku',
                'antwort': 'Antwort',
                'comment': 'Comment'
            };
            return types[typ] || 'Comment';  // Default ist jetzt "Comment"
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ========================================
        // FEATURE 4: Archetype Info Modal (merged with definitionModal)
        // ========================================

        function openArchetypeInfo(archetypeId, person = null) {
            // Redirect to definitionModal (zusammengef√ºhrt)
            console.log('openArchetypeInfo called with:', archetypeId, 'person:', person);

            // Track which person this modal is for
            currentDefinitionPerson = person;

            // Update current index
            currentDefinitionIndex = archetypeOrder.indexOf(archetypeId);
            if (currentDefinitionIndex === -1) currentDefinitionIndex = 0;

            // Use the detailed definition modal
            showArchetypeInfoByType(archetypeId);

            document.getElementById('definitionModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Add touch swipe support
            const modal = document.querySelector('#definitionModal .modal');
            modal.ontouchstart = handleDefinitionTouchStart;
            modal.ontouchend = handleDefinitionTouchEnd;
        }

        // ========================================
        // FEATURE 5: LocalStorage Persistence
        // ========================================

        function saveSelectionToStorage() {
            const selection = {
                ich: {
                    archetyp: mobileIchArchetype,
                    geschlecht: personDimensions.ich.geschlecht,
                    dominanz: personDimensions.ich.dominanz, // Multi-select object
                    orientierung: personDimensions.ich.orientierung // Multi-select object
                },
                partner: {
                    archetyp: mobilePartnerArchetype,
                    geschlecht: personDimensions.partner.geschlecht,
                    dominanz: personDimensions.partner.dominanz, // Multi-select object
                    orientierung: personDimensions.partner.orientierung // Multi-select object
                }
            };

            try {
                localStorage.setItem('tiage-selection', JSON.stringify(selection));
            } catch (e) {
                console.warn('LocalStorage not available:', e);
            }
        }

        function loadSelectionFromStorage() {
            try {
                const saved = localStorage.getItem('tiage-selection');
                if (!saved) return false;

                const selection = JSON.parse(saved);

                // Restore ICH
                if (selection.ich) {
                    mobileIchArchetype = selection.ich.archetyp;
                    currentArchetype = selection.ich.archetyp;
                    document.getElementById('mobileIchSelect').value = selection.ich.archetyp;
                    const ichSelect = document.getElementById('ichSelect');
                    if (ichSelect) ichSelect.value = selection.ich.archetyp;

                    if (selection.ich.geschlecht) {
                        // Handle new primary/secondary format
                        if (typeof selection.ich.geschlecht === 'object' && 'primary' in selection.ich.geschlecht) {
                            // New format: { primary: 'cis-mann', secondary: null }
                            personDimensions.ich.geschlecht = selection.ich.geschlecht;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.geschlecht = selection.ich.geschlecht;
                            }
                        } else {
                            // Old format: string like "cis-mann" - convert to new format
                            personDimensions.ich.geschlecht = { primary: selection.ich.geschlecht, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.geschlecht = { primary: selection.ich.geschlecht, secondary: null };
                            }
                        }
                        // Sync UI
                        if (typeof syncGeschlechtUI === 'function') {
                            syncGeschlechtUI('ich');
                        }
                        if (personDimensions.ich.geschlecht.primary) {
                            const dimension = document.querySelector('[data-dimension="ich-geschlecht-new"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.ich.dominanz) {
                        // Handle new primary/secondary format
                        if (typeof selection.ich.dominanz === 'object' && 'primary' in selection.ich.dominanz) {
                            // New format: { primary: 'dominant', secondary: null }
                            personDimensions.ich.dominanz = selection.ich.dominanz;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.dominanz = selection.ich.dominanz;
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('ich');
                            }
                            if (selection.ich.dominanz.primary) {
                                const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.ich.dominanz === 'object') {
                            // Old format: { dominant: 'gelebt', submissiv: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.ich.dominanz)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.ich.dominanz = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.dominanz = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('ich');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.ich.dominanz = { primary: selection.ich.dominanz, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.dominanz = { primary: selection.ich.dominanz, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('ich');
                            }
                            const dimension = document.querySelector('[data-dimension="ich-dominanz-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.ich.orientierung) {
                        // Handle new primary/secondary format
                        if (typeof selection.ich.orientierung === 'object' && 'primary' in selection.ich.orientierung) {
                            // New format: { primary: 'heterosexuell', secondary: null }
                            personDimensions.ich.orientierung = selection.ich.orientierung;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.orientierung = selection.ich.orientierung;
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('ich');
                            }
                            if (selection.ich.orientierung.primary) {
                                const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.ich.orientierung === 'object') {
                            // Old format: { heterosexuell: 'gelebt', homosexuell: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.ich.orientierung)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.ich.orientierung = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.orientierung = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('ich');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.ich.orientierung = { primary: selection.ich.orientierung, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.ich.orientierung = { primary: selection.ich.orientierung, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('ich');
                            }
                            const dimension = document.querySelector('[data-dimension="ich-orientierung-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }
                }

                // Restore PARTNER
                if (selection.partner) {
                    mobilePartnerArchetype = selection.partner.archetyp;
                    selectedPartner = selection.partner.archetyp;
                    document.getElementById('mobilePartnerSelect').value = selection.partner.archetyp;
                    const partnerSelect = document.getElementById('partnerSelect');
                    if (partnerSelect) partnerSelect.value = selection.partner.archetyp;

                    if (selection.partner.geschlecht) {
                        // Handle new primary/secondary format
                        if (typeof selection.partner.geschlecht === 'object' && 'primary' in selection.partner.geschlecht) {
                            // New format: { primary: 'cis-mann', secondary: null }
                            personDimensions.partner.geschlecht = selection.partner.geschlecht;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.geschlecht = selection.partner.geschlecht;
                            }
                        } else {
                            // Old format: string like "cis-mann" - convert to new format
                            personDimensions.partner.geschlecht = { primary: selection.partner.geschlecht, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.geschlecht = { primary: selection.partner.geschlecht, secondary: null };
                            }
                        }
                        // Sync UI
                        if (typeof syncGeschlechtUI === 'function') {
                            syncGeschlechtUI('partner');
                        }
                        if (personDimensions.partner.geschlecht.primary) {
                            const dimension = document.querySelector('[data-dimension="partner-geschlecht-new"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.partner.dominanz) {
                        // Handle new primary/secondary format
                        if (typeof selection.partner.dominanz === 'object' && 'primary' in selection.partner.dominanz) {
                            // New format: { primary: 'dominant', secondary: null }
                            personDimensions.partner.dominanz = selection.partner.dominanz;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.dominanz = selection.partner.dominanz;
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('partner');
                            }
                            if (selection.partner.dominanz.primary) {
                                const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.partner.dominanz === 'object') {
                            // Old format: { dominant: 'gelebt', submissiv: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.partner.dominanz)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.partner.dominanz = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.dominanz = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('partner');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.partner.dominanz = { primary: selection.partner.dominanz, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.dominanz = { primary: selection.partner.dominanz, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncDominanzUI === 'function') {
                                syncDominanzUI('partner');
                            }
                            const dimension = document.querySelector('[data-dimension="partner-dominanz-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }

                    if (selection.partner.orientierung) {
                        // Handle new primary/secondary format
                        if (typeof selection.partner.orientierung === 'object' && 'primary' in selection.partner.orientierung) {
                            // New format: { primary: 'heterosexuell', secondary: null }
                            personDimensions.partner.orientierung = selection.partner.orientierung;
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.orientierung = selection.partner.orientierung;
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('partner');
                            }
                            if (selection.partner.orientierung.primary) {
                                const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else if (typeof selection.partner.orientierung === 'object') {
                            // Old format: { heterosexuell: 'gelebt', homosexuell: null, ... }
                            // Convert to new format
                            let primary = null;
                            let secondary = null;
                            for (const [type, status] of Object.entries(selection.partner.orientierung)) {
                                if (status === 'gelebt' && !primary) {
                                    primary = type;
                                } else if (status === 'interessiert' && !secondary) {
                                    secondary = type;
                                }
                            }
                            personDimensions.partner.orientierung = { primary, secondary };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.orientierung = { primary, secondary };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('partner');
                            }
                            if (primary) {
                                const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                                if (dimension) dimension.classList.remove('needs-selection');
                            }
                        } else {
                            // Legacy: string format - convert to new primary/secondary format
                            personDimensions.partner.orientierung = { primary: selection.partner.orientierung, secondary: null };
                            if (typeof mobilePersonDimensions !== 'undefined') {
                                mobilePersonDimensions.partner.orientierung = { primary: selection.partner.orientierung, secondary: null };
                            }
                            // Sync UI
                            if (typeof syncOrientierungUI === 'function') {
                                syncOrientierungUI('partner');
                            }
                            const dimension = document.querySelector('[data-dimension="partner-orientierung-multi"]');
                            if (dimension) dimension.classList.remove('needs-selection');
                        }
                    }
                }

                // Sync mobilePersonDimensions to personDimensions for desktop view
                personDimensions.ich = { ...mobilePersonDimensions.ich };
                personDimensions.partner = { ...mobilePersonDimensions.partner };

                // Sync all UIs (Desktop, Mobile, Modal) for dominanz
                if (typeof syncDominanzUI === 'function') {
                    syncDominanzUI('ich');
                    syncDominanzUI('partner');
                }

                // Sync all UIs (Desktop, Mobile, Modal) for orientierung
                if (typeof syncOrientierungUI === 'function') {
                    syncOrientierungUI('ich');
                    syncOrientierungUI('partner');
                }

                // Update comparison view with loaded data
                if (typeof updateComparisonView === 'function') {
                    updateComparisonView();
                }

                // Sync archetype grid highlighting with loaded selections
                if (typeof updateArchetypeGrid === 'function') {
                    if (selection.ich && selection.ich.archetyp) {
                        updateArchetypeGrid('ich', selection.ich.archetyp);
                    }
                    if (selection.partner && selection.partner.archetyp) {
                        updateArchetypeGrid('partner', selection.partner.archetyp);
                    }
                }

                return true;
            } catch (e) {
                console.warn('Failed to load from LocalStorage:', e);
                return false;
            }
        }

        function resetAll() {
            if (!confirm('M√∂chtest du wirklich alle Eingaben zur√ºcksetzen?')) {
                return;
            }

            // Clear LocalStorage
            try {
                localStorage.removeItem('tiage-selection');
            } catch (e) {
                console.warn('LocalStorage not available:', e);
            }

            // Reset mobile selections
            mobileIchArchetype = 'single';
            mobilePartnerArchetype = 'duo';
            const emptyDimension = { primary: null, secondary: null };
            mobilePersonDimensions = {
                ich: { geschlecht: { ...emptyDimension }, dominanz: { ...emptyDimension }, orientierung: { ...emptyDimension } },
                partner: { geschlecht: { ...emptyDimension }, dominanz: { ...emptyDimension }, orientierung: { ...emptyDimension } }
            };

            // Reset personDimensions for desktop
            personDimensions.ich = { geschlecht: { ...emptyDimension }, dominanz: { ...emptyDimension }, orientierung: { ...emptyDimension } };
            personDimensions.partner = { geschlecht: { ...emptyDimension }, dominanz: { ...emptyDimension }, orientierung: { ...emptyDimension } };

            // Reset dropdowns
            document.getElementById('mobileIchSelect').value = 'single';
            document.getElementById('mobilePartnerSelect').value = 'duo';

            // Reset all radio buttons
            document.querySelectorAll('.mobile-page input[type="radio"]').forEach(radio => {
                radio.checked = false;
                const dimension = radio.closest('.compact-dimension');
                if (dimension) {
                    dimension.classList.add('needs-selection');
                }
            });

            // Reset Desktop, Mobile and Modal multi-select checkboxes and status dropdowns
            const shortIds = ['dom', 'sub', 'sw', 'aus'];
            ['ich', 'partner'].forEach(person => {
                shortIds.forEach(shortId => {
                    // Desktop
                    const checkbox = document.getElementById(person + '-d-' + shortId);
                    if (checkbox) checkbox.checked = false;
                    const statusSelect = document.getElementById(person + '-d-' + shortId + '-status');
                    if (statusSelect) {
                        statusSelect.style.display = 'none';
                        statusSelect.value = 'gelebt';
                    }
                    // Mobile
                    const mobileCheckbox = document.getElementById('m-' + person + '-d-' + shortId);
                    if (mobileCheckbox) mobileCheckbox.checked = false;
                    const mobileStatusSelect = document.getElementById('m-' + person + '-d-' + shortId + '-status');
                    if (mobileStatusSelect) {
                        mobileStatusSelect.style.display = 'none';
                        mobileStatusSelect.value = 'gelebt';
                    }
                    // Modal
                    const modalCheckbox = document.getElementById('modal-' + person + '-d-' + shortId);
                    if (modalCheckbox) modalCheckbox.checked = false;
                    const modalStatusSelect = document.getElementById('modal-' + person + '-d-' + shortId + '-status');
                    if (modalStatusSelect) {
                        modalStatusSelect.style.display = 'none';
                        modalStatusSelect.value = 'gelebt';
                    }
                });
                // Mark dominanz as needing selection (Desktop, Mobile & Modal)
                const dimension = document.querySelector('[data-dimension="' + person + '-dominanz-multi"]');
                if (dimension) dimension.classList.add('needs-selection');
                const mobileDimension = document.querySelector('[data-dimension="mobile-' + person + '-dominanz-multi"]');
                if (mobileDimension) mobileDimension.classList.add('needs-selection');
                const modalDimension = document.querySelector('[data-dimension="modal-' + person + '-dominanz-multi"]');
                if (modalDimension) modalDimension.classList.add('needs-selection');

                // Mark orientierung as needing selection (Desktop, Mobile & Modal)
                const orientDimension = document.querySelector('[data-dimension="' + person + '-orientierung-multi"]');
                if (orientDimension) orientDimension.classList.add('needs-selection');
                const mobileOrientDimension = document.querySelector('[data-dimension="mobile-' + person + '-orientierung-multi"]');
                if (mobileOrientDimension) mobileOrientDimension.classList.add('needs-selection');
                const modalOrientDimension = document.querySelector('[data-dimension="modal-' + person + '-orientierung-multi"]');
                if (modalOrientDimension) modalOrientDimension.classList.add('needs-selection');
            });

            // Go to page 1
            mobileGoToPage(1);

            // Show confirmation
            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(46, 204, 113, 0.95);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 14px;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            warning.textContent = '‚úì Alle Eingaben wurden zur√ºckgesetzt';
            document.body.appendChild(warning);

            setTimeout(() => warning.remove(), 3000);
        }

        // Auto-save on changes
        function initAutoSave() {
            // Save on archetype change
            document.getElementById('mobileIchSelect')?.addEventListener('change', saveSelectionToStorage);
            document.getElementById('mobilePartnerSelect')?.addEventListener('change', saveSelectionToStorage);

            // Save on dimension change
            document.querySelectorAll('.mobile-page input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', saveSelectionToStorage);
            });
        }

        // Load saved data on startup
        setTimeout(() => {
            loadSelectionFromStorage();
            initAutoSave();
        }, 500);

        // Update comparison view when data is loaded
        const originalLoadData = loadData;
        async function loadDataAndUpdateComparison() {
            await originalLoadData();
            setTimeout(() => {
                updateComparisonView();
                updateSyntheseScoreCycle();
            }, 100);
        }
        loadDataAndUpdateComparison();

        // Make key functions globally accessible for onclick handlers
        window.openHelpModal = openHelpModal;
        window.closeHelpModal = closeHelpModal;
        window.showArchetypeInfo = showArchetypeInfo;
        window.openArchetypeInfo = openArchetypeInfo;
        window.openFactorModal = openFactorModal;
        window.closeFactorModal = closeFactorModal;
        window.navigateFactorArchetype = navigateFactorArchetype;
        window.closeCategoryModal = closeCategoryModal;
        window.closeDefinitionModal = closeDefinitionModal;
        window.navigateDefinition = navigateDefinition;
        window.navigateDefinitionToIndex = navigateDefinitionToIndex;
        window.showArchetypeInfoByType = showArchetypeInfoByType;
        window.openCommentModal = openCommentModal;
        window.closeCommentModal = closeCommentModal;
        window.closeFeedbackModal = closeFeedbackModal;
        window.navigateArchetype = navigateArchetype;
        window.openCommentsListModal = openCommentsListModal;
        window.closeCommentsListModal = closeCommentsListModal;
        window.toggleReplyForm = toggleReplyForm;
        window.submitReply = submitReply;
        // Pro/Contra Modal functions
        window.openProContraModal = openProContraModal;
        window.closeProContraModal = closeProContraModal;
        window.navigateProContraArchetype = navigateProContraArchetype;

        // Archetype selection functions (critical for main page buttons)
        window.selectArchetypeFromGrid = selectArchetypeFromGrid;
        window.updateArchetypeGrid = updateArchetypeGrid;
        window.navigateArchetypeOnPage2 = navigateArchetypeOnPage2;
        window.navigateArchetypeOnPage3 = navigateArchetypeOnPage3;

        // Pathos/Logos Modal functions
        window.closePathosLogosModal = closePathosLogosModal;
        window.showPathosLogosContent = showPathosLogosContent;
        window.navigatePathosLogosArchetype = navigatePathosLogosArchetype;

        // Dimension toggle and collapse functions
        window.toggleAllDimensionsCollapse = toggleAllDimensionsCollapse;
        window.toggleDimensionCollapse = toggleDimensionCollapse;
        window.showDimensionTooltip = showDimensionTooltip;
        window.closeDimensionTooltip = closeDimensionTooltip;
        window.showGeschlechtInfoModal = showGeschlechtInfoModal;
        window.closeGeschlechtInfoModal = closeGeschlechtInfoModal;
        window.showDominanzInfoModal = showDominanzInfoModal;
        window.closeDominanzInfoModal = closeDominanzInfoModal;
        window.showOrientierungInfoModal = showOrientierungInfoModal;
        window.closeOrientierungInfoModal = closeOrientierungInfoModal;
        window.closeGfkExplanationModal = closeGfkExplanationModal;

        // Dimension click handlers
        window.handleGeschlechtClick = handleGeschlechtClick;
        window.handleDominanzClick = handleDominanzClick;
        window.handleOrientierungClick = handleOrientierungClick;
        window.handleGfkClick = handleGfkClick;

        // Mobile status toggle handlers (Gelebt/Interessiert buttons)
        window.handleDominanzStatusToggle = handleDominanzStatusToggle;
        window.handleOrientierungStatusToggle = handleOrientierungStatusToggle;
        window.syncMobileDominanzStatusButtons = syncMobileDominanzStatusButtons;
        window.syncMobileOrientierungStatusButtons = syncMobileOrientierungStatusButtons;

        // Pathos/Logos Modal open function
        window.openPathosLogosModal = openPathosLogosModal;

        // Comment and feedback functions
        window.submitComment = submitComment;
        window.clearCommentsSearch = clearCommentsSearch;

        // Partner selection
        window.selectPartner = selectPartner;

        // Navigation functions (for nav dots and carousel)
        window.navigatePrev = navigatePrev;
        window.navigateNext = navigateNext;
        window.scrollToCard = scrollToCard;

        // i18n translation update function (for language toggle button)
        window.updateAllTranslations = updateAllTranslations;

        // Additional modal functions
        window.openCategoryModal = openCategoryModal;
        window.openDefinitionModal = openDefinitionModal;
        window.openMatchModal = openMatchModal;

        // Category and tag related functions
        window.openSingleCategoryModal = openSingleCategoryModal;
        window.navigateCategoryPrev = navigateCategoryPrev;
        window.navigateCategoryNext = navigateCategoryNext;
        window.navigateCategoryArchetype = navigateCategoryArchetype;
        window.showCategoryDetails = showCategoryDetails;
        window.openTagTooltip = openTagTooltip;
        window.closeTagTooltip = closeTagTooltip;

        // Definition modal functions
        window.navigateDefinitionModal = navigateDefinitionModal;
        window.confirmDefinitionSelection = confirmDefinitionSelection;

        // Match modal functions
        window.toggleMatchModalView = toggleMatchModalView;

        // Feedback and reply functions
        window.openFeedbackModalWithContext = openFeedbackModalWithContext;
        window.openReplyModal = openReplyModal;

        // Pathos/Logos info functions
        window.toggleLogosWarning = toggleLogosWarning;
        window.showPathosLogosInfo = showPathosLogosInfo;
        window.showSubDimensionInfo = showSubDimensionInfo;

        // Mobile navigation functions
        window.mobileGoToPage = mobileGoToPage;
        window.toggleMobileCategory = toggleMobileCategory;

        // Utility functions
        window.toggleCollapsible = toggleCollapsible;
        window.resetAll = resetAll;

        // Wrapper functions for secondary interessiert buttons (used in modal)
        // These call the status toggle with 'interessiert' as the status
        window.handleSecondaryInteressiert = function(person, dominanzType, btn) {
            handleDominanzStatusToggle(person, dominanzType, 'interessiert', btn);
        };
        window.handleOrientierungSecondaryInteressiert = function(person, orientierungType, btn) {
            handleOrientierungStatusToggle(person, orientierungType, 'interessiert', btn);
        };

        console.log('All modal functions are now globally available');
    </script>
</body>
</html>
